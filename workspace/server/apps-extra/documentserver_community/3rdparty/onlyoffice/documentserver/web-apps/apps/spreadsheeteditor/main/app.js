/*!
 * Copyright (c) Ascensio System SIA 2022. All rights reserved
 *
 * http://www.onlyoffice.com 
 *
 * Version: 7.2.1 (build:34)
 */
if(function(){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},e=t._,i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,s=i.push,a=i.slice,l=n.toString,r=n.hasOwnProperty,c=Array.isArray,d=Object.keys,h=Object.create,p=function(){},m=function(t){return t instanceof m?t:this instanceof m?void(this._wrapped=t):new m(t)};"undefined"==typeof exports||exports.nodeType?t._=m:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=m),exports._=m),m.VERSION="1.8.3";var u,g=function(t,e,i){if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case null:case 3:return function(i,n,o){return t.call(e,i,n,o)};case 4:return function(i,n,o,s){return t.call(e,i,n,o,s)}}return function(){return t.apply(e,arguments)}},f=function(t,e,i){return m.iteratee!==u?m.iteratee(t,e):null==t?m.identity:m.isFunction(t)?g(t,e,i):m.isObject(t)&&!m.isArray(t)?m.matcher(t):m.property(t)};m.iteratee=u=function(t,e){return f(t,e,1/0)};var b=function(t,e){return e=null==e?t.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var s=Array(e+1);for(o=0;o<e;o++)s[o]=arguments[o];return s[e]=n,t.apply(this,s)}},C=function(t){if(!m.isObject(t))return{};if(h)return h(t);p.prototype=t;var e=new p;return p.prototype=null,e},v=function(t){return function(e){return null==e?void 0:e[t]}},_=function(t,e){for(var i=e.length,n=0;n<i;n++){if(null==t)return;t=t[e[n]]}return i?t:void 0},x=Math.pow(2,53)-1,y=v("length"),w=function(t){var e=y(t);return"number"==typeof e&&e>=0&&e<=x};m.each=m.forEach=function(t,e,i){var n,o;if(e=g(e,i),w(t))for(n=0,o=t.length;n<o;n++)e(t[n],n,t);else{var s=m.keys(t);for(n=0,o=s.length;n<o;n++)e(t[s[n]],s[n],t)}return t},m.map=m.collect=function(t,e,i){e=f(e,i);for(var n=!w(t)&&m.keys(t),o=(n||t).length,s=Array(o),a=0;a<o;a++){var l=n?n[a]:a;s[a]=e(t[l],l,t)}return s};var S=function(t){var e=function(e,i,n,o){var s=!w(e)&&m.keys(e),a=(s||e).length,l=t>0?0:a-1;for(o||(n=e[s?s[l]:l],l+=t);l>=0&&l<a;l+=t){var r=s?s[l]:l;n=i(n,e[r],r,e)}return n};return function(t,i,n,o){var s=arguments.length>=3;return e(t,g(i,o,4),n,s)}};m.reduce=m.foldl=m.inject=S(1),m.reduceRight=m.foldr=S(-1),m.find=m.detect=function(t,e,i){var n=(w(t)?m.findIndex:m.findKey)(t,e,i);if(void 0!==n&&-1!==n)return t[n]},m.filter=m.select=function(t,e,i){var n=[];return e=f(e,i),m.each(t,(function(t,i,o){e(t,i,o)&&n.push(t)})),n},m.reject=function(t,e,i){return m.filter(t,m.negate(f(e)),i)},m.every=m.all=function(t,e,i){e=f(e,i);for(var n=!w(t)&&m.keys(t),o=(n||t).length,s=0;s<o;s++){var a=n?n[s]:s;if(!e(t[a],a,t))return!1}return!0},m.some=m.any=function(t,e,i){e=f(e,i);for(var n=!w(t)&&m.keys(t),o=(n||t).length,s=0;s<o;s++){var a=n?n[s]:s;if(e(t[a],a,t))return!0}return!1},m.contains=m.includes=m.include=function(t,e,i,n){return w(t)||(t=m.values(t)),("number"!=typeof i||n)&&(i=0),m.indexOf(t,e,i)>=0},m.invoke=b((function(t,e,i){var n,o;return m.isFunction(e)?o=e:m.isArray(e)&&(n=e.slice(0,-1),e=e[e.length-1]),m.map(t,(function(t){var s=o;if(!s){if(n&&n.length&&(t=_(t,n)),null==t)return;s=t[e]}return null==s?s:s.apply(t,i)}))})),m.pluck=function(t,e){return m.map(t,m.property(e))},m.where=function(t,e){return m.filter(t,m.matcher(e))},m.findWhere=function(t,e){return m.find(t,m.matcher(e))},m.max=function(t,e,i){var n,o,s=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var l=0,r=(t=w(t)?t:m.values(t)).length;l<r;l++)null!=(n=t[l])&&n>s&&(s=n);else e=f(e,i),m.each(t,(function(t,i,n){((o=e(t,i,n))>a||o===-1/0&&s===-1/0)&&(s=t,a=o)}));return s},m.min=function(t,e,i){var n,o,s=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var l=0,r=(t=w(t)?t:m.values(t)).length;l<r;l++)null!=(n=t[l])&&n<s&&(s=n);else e=f(e,i),m.each(t,(function(t,i,n){((o=e(t,i,n))<a||o===1/0&&s===1/0)&&(s=t,a=o)}));return s},m.shuffle=function(t){return m.sample(t,1/0)},m.sample=function(t,e,i){if(null==e||i)return w(t)||(t=m.values(t)),t[m.random(t.length-1)];var n=w(t)?m.clone(t):m.values(t),o=y(n);e=Math.max(Math.min(e,o),0);for(var s=o-1,a=0;a<e;a++){var l=m.random(a,s),r=n[a];n[a]=n[l],n[l]=r}return n.slice(0,e)},m.sortBy=function(t,e,i){var n=0;return e=f(e,i),m.pluck(m.map(t,(function(t,i,o){return{value:t,index:n++,criteria:e(t,i,o)}})).sort((function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index})),"value")};var A=function(t,e){return function(i,n,o){var s=e?[[],[]]:{};return n=f(n,o),m.each(i,(function(e,o){var a=n(e,o,i);t(s,e,a)})),s}};m.groupBy=A((function(t,e,i){m.has(t,i)?t[i].push(e):t[i]=[e]})),m.indexBy=A((function(t,e,i){t[i]=e})),m.countBy=A((function(t,e,i){m.has(t,i)?t[i]++:t[i]=1}));var k=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;m.toArray=function(t){return t?m.isArray(t)?a.call(t):m.isString(t)?t.match(k):w(t)?m.map(t,m.identity):m.values(t):[]},m.size=function(t){return null==t?0:w(t)?t.length:m.keys(t).length},m.partition=A((function(t,e,i){t[i?0:1].push(e)}),!0),m.first=m.head=m.take=function(t,e,i){if(!(null==t||t.length<1))return null==e||i?t[0]:m.initial(t,t.length-e)},m.initial=function(t,e,i){return a.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},m.last=function(t,e,i){if(!(null==t||t.length<1))return null==e||i?t[t.length-1]:m.rest(t,Math.max(0,t.length-e))},m.rest=m.tail=m.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},m.compact=function(t){return m.filter(t,Boolean)};var T=function(t,e,i,n){for(var o=(n=n||[]).length,s=0,a=y(t);s<a;s++){var l=t[s];if(w(l)&&(m.isArray(l)||m.isArguments(l)))if(e)for(var r=0,c=l.length;r<c;)n[o++]=l[r++];else T(l,e,i,n),o=n.length;else i||(n[o++]=l)}return n};m.flatten=function(t,e){return T(t,e,!1)},m.without=b((function(t,e){return m.difference(t,e)})),m.uniq=m.unique=function(t,e,i,n){m.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=f(i,n));for(var o=[],s=[],a=0,l=y(t);a<l;a++){var r=t[a],c=i?i(r,a,t):r;e?(a&&s===c||o.push(r),s=c):i?m.contains(s,c)||(s.push(c),o.push(r)):m.contains(o,r)||o.push(r)}return o},m.union=b((function(t){return m.uniq(T(t,!0,!0))})),m.intersection=function(t){for(var e=[],i=arguments.length,n=0,o=y(t);n<o;n++){var s=t[n];if(!m.contains(e,s)){var a;for(a=1;a<i&&m.contains(arguments[a],s);a++);a===i&&e.push(s)}}return e},m.difference=b((function(t,e){return e=T(e,!0,!0),m.filter(t,(function(t){return!m.contains(e,t)}))})),m.unzip=function(t){for(var e=t&&m.max(t,y).length||0,i=Array(e),n=0;n<e;n++)i[n]=m.pluck(t,n);return i},m.zip=b(m.unzip),m.object=function(t,e){for(var i={},n=0,o=y(t);n<o;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i};var I=function(t){return function(e,i,n){i=f(i,n);for(var o=y(e),s=t>0?0:o-1;s>=0&&s<o;s+=t)if(i(e[s],s,e))return s;return-1}};m.findIndex=I(1),m.findLastIndex=I(-1),m.sortedIndex=function(t,e,i,n){for(var o=(i=f(i,n,1))(e),s=0,a=y(t);s<a;){var l=Math.floor((s+a)/2);i(t[l])<o?s=l+1:a=l}return s};var E=function(t,e,i){return function(n,o,s){var l=0,r=y(n);if("number"==typeof s)t>0?l=s>=0?s:Math.max(s+r,l):r=s>=0?Math.min(s+1,r):s+r+1;else if(i&&s&&r)return n[s=i(n,o)]===o?s:-1;if(o!=o)return(s=e(a.call(n,l,r),m.isNaN))>=0?s+l:-1;for(s=t>0?l:r-1;s>=0&&s<r;s+=t)if(n[s]===o)return s;return-1}};m.indexOf=E(1,m.findIndex,m.sortedIndex),m.lastIndexOf=E(-1,m.findLastIndex),m.range=function(t,e,i){null==e&&(e=t||0,t=0),i||(i=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/i),0),o=Array(n),s=0;s<n;s++,t+=i)o[s]=t;return o},m.chunk=function(t,e){if(null==e||e<1)return[];for(var i=[],n=0,o=t.length;n<o;)i.push(a.call(t,n,n+=e));return i};var D=function(t,e,i,n,o){if(!(n instanceof e))return t.apply(i,o);var s=C(t.prototype),a=t.apply(s,o);return m.isObject(a)?a:s};m.bind=b((function(t,e,i){if(!m.isFunction(t))throw new TypeError("Bind must be called on a function");var n=b((function(o){return D(t,n,e,this,i.concat(o))}));return n})),m.partial=b((function(t,e){var i=m.partial.placeholder,n=function(){for(var o=0,s=e.length,a=Array(s),l=0;l<s;l++)a[l]=e[l]===i?arguments[o++]:e[l];for(;o<arguments.length;)a.push(arguments[o++]);return D(t,n,this,this,a)};return n})),m.partial.placeholder=m,m.bindAll=b((function(t,e){var i=(e=T(e,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=e[i];t[n]=m.bind(t[n],t)}})),m.memoize=function(t,e){var i=function(n){var o=i.cache,s=""+(e?e.apply(this,arguments):n);return m.has(o,s)||(o[s]=t.apply(this,arguments)),o[s]};return i.cache={},i},m.delay=b((function(t,e,i){return setTimeout((function(){return t.apply(null,i)}),e)})),m.defer=m.partial(m.delay,m,1),m.throttle=function(t,e,i){var n,o,s,a,l=0;i||(i={});var r=function(){l=!1===i.leading?0:m.now(),n=null,a=t.apply(o,s),n||(o=s=null)},c=function(){var c=m.now();l||!1!==i.leading||(l=c);var d=e-(c-l);return o=this,s=arguments,d<=0||d>e?(n&&(clearTimeout(n),n=null),l=c,a=t.apply(o,s),n||(o=s=null)):n||!1===i.trailing||(n=setTimeout(r,d)),a};return c.cancel=function(){clearTimeout(n),l=0,n=o=s=null},c},m.debounce=function(t,e,i){var n,o,s=function(e,i){n=null,i&&(o=t.apply(e,i))},a=b((function(a){if(n&&clearTimeout(n),i){var l=!n;n=setTimeout(s,e),l&&(o=t.apply(this,a))}else n=m.delay(s,e,this,a);return o}));return a.cancel=function(){clearTimeout(n),n=null},a},m.wrap=function(t,e){return m.partial(e,t)},m.negate=function(t){return function(){return!t.apply(this,arguments)}},m.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},m.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},m.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}},m.once=m.partial(m.before,2),m.restArgs=b;var P=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],R=function(t,e){var i=F.length,o=t.constructor,s=m.isFunction(o)&&o.prototype||n,a="constructor";for(m.has(t,a)&&!m.contains(e,a)&&e.push(a);i--;)(a=F[i])in t&&t[a]!==s[a]&&!m.contains(e,a)&&e.push(a)};m.keys=function(t){if(!m.isObject(t))return[];if(d)return d(t);var e=[];for(var i in t)m.has(t,i)&&e.push(i);return P&&R(t,e),e},m.allKeys=function(t){if(!m.isObject(t))return[];var e=[];for(var i in t)e.push(i);return P&&R(t,e),e},m.values=function(t){for(var e=m.keys(t),i=e.length,n=Array(i),o=0;o<i;o++)n[o]=t[e[o]];return n},m.mapObject=function(t,e,i){e=f(e,i);for(var n=m.keys(t),o=n.length,s={},a=0;a<o;a++){var l=n[a];s[l]=e(t[l],l,t)}return s},m.pairs=function(t){for(var e=m.keys(t),i=e.length,n=Array(i),o=0;o<i;o++)n[o]=[e[o],t[e[o]]];return n},m.invert=function(t){for(var e={},i=m.keys(t),n=0,o=i.length;n<o;n++)e[t[i[n]]]=i[n];return e},m.functions=m.methods=function(t){var e=[];for(var i in t)m.isFunction(t[i])&&e.push(i);return e.sort()};var V=function(t,e){return function(i){var n=arguments.length;if(e&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var s=arguments[o],a=t(s),l=a.length,r=0;r<l;r++){var c=a[r];e&&void 0!==i[c]||(i[c]=s[c])}return i}};m.extend=V(m.allKeys),m.extendOwn=m.assign=V(m.keys),m.findKey=function(t,e,i){e=f(e,i);for(var n,o=m.keys(t),s=0,a=o.length;s<a;s++)if(e(t[n=o[s]],n,t))return n};var M,U,L=function(t,e,i){return e in i};m.pick=b((function(t,e){var i={},n=e[0];if(null==t)return i;m.isFunction(n)?(e.length>1&&(n=g(n,e[1])),e=m.allKeys(t)):(n=L,e=T(e,!1,!1),t=Object(t));for(var o=0,s=e.length;o<s;o++){var a=e[o],l=t[a];n(l,a,t)&&(i[a]=l)}return i})),m.omit=b((function(t,e){var i,n=e[0];return m.isFunction(n)?(n=m.negate(n),e.length>1&&(i=e[1])):(e=m.map(T(e,!1,!1),String),n=function(t,i){return!m.contains(e,i)}),m.pick(t,n,i)})),m.defaults=V(m.allKeys,!0),m.create=function(t,e){var i=C(t);return e&&m.extendOwn(i,e),i},m.clone=function(t){return m.isObject(t)?m.isArray(t)?t.slice():m.extend({},t):t},m.tap=function(t,e){return e(t),t},m.isMatch=function(t,e){var i=m.keys(e),n=i.length;if(null==t)return!n;for(var o=Object(t),s=0;s<n;s++){var a=i[s];if(e[a]!==o[a]||!(a in o))return!1}return!0},M=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&U(t,e,i,n)},U=function(t,e,i,n){t instanceof m&&(t=t._wrapped),e instanceof m&&(e=e._wrapped);var s=l.call(t);if(s!==l.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return o.valueOf.call(t)===o.valueOf.call(e)}var a="[object Array]"===s;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var r=t.constructor,c=e.constructor;if(r!==c&&!(m.isFunction(r)&&r instanceof r&&m.isFunction(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}n=n||[];for(var d=(i=i||[]).length;d--;)if(i[d]===t)return n[d]===e;if(i.push(t),n.push(e),a){if((d=t.length)!==e.length)return!1;for(;d--;)if(!M(t[d],e[d],i,n))return!1}else{var h,p=m.keys(t);if(d=p.length,m.keys(e).length!==d)return!1;for(;d--;)if(h=p[d],!m.has(e,h)||!M(t[h],e[h],i,n))return!1}return i.pop(),n.pop(),!0},m.isEqual=function(t,e){return M(t,e)},m.isEmpty=function(t){return null==t||(w(t)&&(m.isArray(t)||m.isString(t)||m.isArguments(t))?0===t.length:0===m.keys(t).length)},m.isElement=function(t){return!(!t||1!==t.nodeType)},m.isArray=c||function(t){return"[object Array]"===l.call(t)},m.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},m.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],(function(t){m["is"+t]=function(e){return l.call(e)==="[object "+t+"]"}})),m.isArguments(arguments)||(m.isArguments=function(t){return m.has(t,"callee")});var B=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof B&&(m.isFunction=function(t){return"function"==typeof t||!1}),m.isFinite=function(t){return!m.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},m.isNaN=function(t){return m.isNumber(t)&&isNaN(t)},m.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===l.call(t)},m.isNull=function(t){return null===t},m.isUndefined=function(t){return void 0===t},m.has=function(t,e){if(!m.isArray(e))return null!=t&&r.call(t,e);for(var i=e.length,n=0;n<i;n++){var o=e[n];if(null==t||!r.call(t,o))return!1;t=t[o]}return!!i},m.noConflict=function(){return t._=e,this},m.identity=function(t){return t},m.constant=function(t){return function(){return t}},m.noop=function(){},m.property=function(t){return m.isArray(t)?function(e){return _(e,t)}:v(t)},m.propertyOf=function(t){return null==t?function(){}:function(e){return m.isArray(e)?_(t,e):t[e]}},m.matcher=m.matches=function(t){return t=m.extendOwn({},t),function(e){return m.isMatch(e,t)}},m.times=function(t,e,i){var n=Array(Math.max(0,t));e=g(e,i,1);for(var o=0;o<t;o++)n[o]=e(o);return n},m.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},m.now=Date.now||function(){return(new Date).getTime()};var O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=m.invert(O),H=function(t){var e=function(e){return t[e]},i="(?:"+m.keys(t).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(o,e):t}};m.escape=H(O),m.unescape=H(N),m.result=function(t,e,i){m.isArray(e)||(e=[e]);var n=e.length;if(!n)return m.isFunction(i)?i.call(t):i;for(var o=0;o<n;o++){var s=null==t?void 0:t[e[o]];void 0===s&&(s=i,o=n),t=m.isFunction(s)?s.call(t):s}return t};var $=0;m.uniqueId=function(t){var e=++$+"";return t?t+e:e},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var G=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},W=/\\|'|\r|\n|\u2028|\u2029/g,j=function(t){return"\\"+z[t]};m.template=function(t,e,i){!e&&i&&(e=i),e=m.defaults({},e,m.templateSettings);var n,o=RegExp([(e.escape||G).source,(e.interpolate||G).source,(e.evaluate||G).source].join("|")+"|$","g"),s=0,a="__p+='";t.replace(o,(function(e,i,n,o,l){return a+=t.slice(s,l).replace(W,j),s=l+e.length,i?a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":o&&(a+="';\n"+o+"\n__p+='"),e})),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var l=function(t){return n.call(this,t,m)},r=e.variable||"obj";return l.source="function("+r+"){\n"+a+"}",l},m.chain=function(t){var e=m(t);return e._chain=!0,e};var q=function(t,e){return t._chain?m(e).chain():e};m.mixin=function(t){return m.each(m.functions(t),(function(e){var i=m[e]=t[e];m.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),q(this,i.apply(m,t))}})),m},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=i[t];m.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],q(this,i)}})),m.each(["concat","join","slice"],(function(t){var e=i[t];m.prototype[t]=function(){return q(this,e.apply(this._wrapped,arguments))}})),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return String(this._wrapped)},"function"==typeof define&&define.amd&&define("underscore",[],(function(){return m}))}(),function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,(function(t,e){"use strict";var i=[],n=Object.getPrototypeOf,o=i.slice,s=i.flat?function(t){return i.flat.call(t)}:function(t){return i.concat.apply([],t)},a=i.push,l=i.indexOf,r={},c=r.toString,d=r.hasOwnProperty,h=d.toString,p=h.call(Object),m={},u=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},g=function(t){return null!=t&&t===t.window},f=t.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function C(t,e,i){var n,o,s=(i=i||f).createElement("script");if(s.text=t,e)for(n in b)(o=e[n]||e.getAttribute&&e.getAttribute(n))&&s.setAttribute(n,o);i.head.appendChild(s).parentNode.removeChild(s)}function v(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?r[c.call(t)]||"object":typeof t}var _="3.5.1",x=function(t,e){return new x.fn.init(t,e)};function y(t){var e=!!t&&"length"in t&&t.length,i=v(t);return!u(t)&&!g(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}x.fn=x.prototype={jquery:_,constructor:x,length:0,toArray:function(){return o.call(this)},get:function(t){return null==t?o.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=x.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return x.each(this,t)},map:function(t){return this.pushStack(x.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(x.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(x.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:i.sort,splice:i.splice},x.extend=x.fn.extend=function(){var t,e,i,n,o,s,a=arguments[0]||{},l=1,r=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[l]||{},l++),"object"==typeof a||u(a)||(a={}),l===r&&(a=this,l--);l<r;l++)if(null!=(t=arguments[l]))for(e in t)n=t[e],"__proto__"!==e&&a!==n&&(c&&n&&(x.isPlainObject(n)||(o=Array.isArray(n)))?(i=a[e],s=o&&!Array.isArray(i)?[]:o||x.isPlainObject(i)?i:{},o=!1,a[e]=x.extend(c,s,n)):void 0!==n&&(a[e]=n));return a},x.extend({expando:"jQuery"+(_+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==c.call(t))&&(!(e=n(t))||"function"==typeof(i=d.call(e,"constructor")&&e.constructor)&&h.call(i)===p)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){C(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,n=0;if(y(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},makeArray:function(t,e){var i=e||[];return null!=t&&(y(Object(t))?x.merge(i,"string"==typeof t?[t]:t):a.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:l.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,o=t.length;n<i;n++)t[o++]=e[n];return t.length=o,t},grep:function(t,e,i){for(var n=[],o=0,s=t.length,a=!i;o<s;o++)!e(t[o],o)!==a&&n.push(t[o]);return n},map:function(t,e,i){var n,o,a=0,l=[];if(y(t))for(n=t.length;a<n;a++)null!=(o=e(t[a],a,i))&&l.push(o);else for(a in t)null!=(o=e(t[a],a,i))&&l.push(o);return s(l)},guid:1,support:m}),"function"==typeof Symbol&&(x.fn[Symbol.iterator]=i[Symbol.iterator]),x.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){r["[object "+e+"]"]=e.toLowerCase()}));var w=function(t){var e,i,n,o,s,a,l,r,c,d,h,p,m,u,g,f,b,C,v,_="sizzle"+1*new Date,x=t.document,y=0,w=0,S=rt(),A=rt(),k=rt(),T=rt(),I=function(t,e){return t===e&&(h=!0),0},E={}.hasOwnProperty,D=[],P=D.pop,F=D.push,R=D.push,V=D.slice,M=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},U="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",O="\\[[\\x20\\t\\r\\n\\f]*("+B+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+L+"*\\]",N=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",H=new RegExp(L+"+","g"),$=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),G=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),z=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),W=new RegExp(L+"|>"),j=new RegExp(N),q=new RegExp("^"+B+"$"),K={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+U+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,X=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),it=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},nt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ot=function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},st=function(){p()},at=_t((function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{R.apply(D=V.call(x.childNodes),x.childNodes),D[x.childNodes.length].nodeType}catch(t){R={apply:D.length?function(t,e){F.apply(t,V.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}function lt(t,e,n,o){var s,l,c,d,h,u,b,C=e&&e.ownerDocument,x=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==x&&9!==x&&11!==x)return n;if(!o&&(p(e),e=e||m,g)){if(11!==x&&(h=Q.exec(t)))if(s=h[1]){if(9===x){if(!(c=e.getElementById(s)))return n;if(c.id===s)return n.push(c),n}else if(C&&(c=C.getElementById(s))&&v(e,c)&&c.id===s)return n.push(c),n}else{if(h[2])return R.apply(n,e.getElementsByTagName(t)),n;if((s=h[3])&&i.getElementsByClassName&&e.getElementsByClassName)return R.apply(n,e.getElementsByClassName(s)),n}if(i.qsa&&!T[t+" "]&&(!f||!f.test(t))&&(1!==x||"object"!==e.nodeName.toLowerCase())){if(b=t,C=e,1===x&&(W.test(t)||z.test(t))){for((C=tt.test(t)&&bt(e.parentNode)||e)===e&&i.scope||((d=e.getAttribute("id"))?d=d.replace(nt,ot):e.setAttribute("id",d=_)),l=(u=a(t)).length;l--;)u[l]=(d?"#"+d:":scope")+" "+vt(u[l]);b=u.join(",")}try{return R.apply(n,C.querySelectorAll(b)),n}catch(e){T(t,!0)}finally{d===_&&e.removeAttribute("id")}}}return r(t.replace($,"$1"),e,n,o)}function rt(){var t=[];return function e(i,o){return t.push(i+" ")>n.cacheLength&&delete e[t.shift()],e[i+" "]=o}}function ct(t){return t[_]=!0,t}function dt(t){var e=m.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ht(t,e){for(var i=t.split("|"),o=i.length;o--;)n.attrHandle[i[o]]=e}function pt(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function mt(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ut(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function gt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&at(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ft(t){return ct((function(e){return e=+e,ct((function(i,n){for(var o,s=t([],i.length,e),a=s.length;a--;)i[o=s[a]]&&(i[o]=!(n[o]=i[o]))}))}))}function bt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=lt.support={},s=lt.isXML=function(t){var e=t.namespaceURI,i=(t.ownerDocument||t).documentElement;return!Y.test(e||i&&i.nodeName||"HTML")},p=lt.setDocument=function(t){var e,o,a=t?t.ownerDocument||t:x;return a!=m&&9===a.nodeType&&a.documentElement?(u=(m=a).documentElement,g=!s(m),x!=m&&(o=m.defaultView)&&o.top!==o&&(o.addEventListener?o.addEventListener("unload",st,!1):o.attachEvent&&o.attachEvent("onunload",st)),i.scope=dt((function(t){return u.appendChild(t).appendChild(m.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length})),i.attributes=dt((function(t){return t.className="i",!t.getAttribute("className")})),i.getElementsByTagName=dt((function(t){return t.appendChild(m.createComment("")),!t.getElementsByTagName("*").length})),i.getElementsByClassName=Z.test(m.getElementsByClassName),i.getById=dt((function(t){return u.appendChild(t).id=_,!m.getElementsByName||!m.getElementsByName(_).length})),i.getById?(n.filter.ID=function(t){var e=t.replace(et,it);return function(t){return t.getAttribute("id")===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i=e.getElementById(t);return i?[i]:[]}}):(n.filter.ID=function(t){var e=t.replace(et,it);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i,n,o,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(o=e.getElementsByName(t),n=0;s=o[n++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),n.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],o=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[o++];)1===i.nodeType&&n.push(i);return n}return s},n.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},b=[],f=[],(i.qsa=Z.test(m.querySelectorAll))&&(dt((function(t){var e;u.appendChild(t).innerHTML="<a id='"+_+"'></a><select id='"+_+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&f.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),t.querySelectorAll("[selected]").length||f.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+U+")"),t.querySelectorAll("[id~="+_+"-]").length||f.push("~="),(e=m.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||f.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),t.querySelectorAll(":checked").length||f.push(":checked"),t.querySelectorAll("a#"+_+"+*").length||f.push(".#.+[+~]"),t.querySelectorAll("\\\f"),f.push("[\\r\\n\\f]")})),dt((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=m.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&f.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&f.push(":enabled",":disabled"),u.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&f.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),f.push(",.*:")}))),(i.matchesSelector=Z.test(C=u.matches||u.webkitMatchesSelector||u.mozMatchesSelector||u.oMatchesSelector||u.msMatchesSelector))&&dt((function(t){i.disconnectedMatch=C.call(t,"*"),C.call(t,"[s!='']:x"),b.push("!=",N)})),f=f.length&&new RegExp(f.join("|")),b=b.length&&new RegExp(b.join("|")),e=Z.test(u.compareDocumentPosition),v=e||Z.test(u.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},I=e?function(t,e){if(t===e)return h=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===n?t==m||t.ownerDocument==x&&v(x,t)?-1:e==m||e.ownerDocument==x&&v(x,e)?1:d?M(d,t)-M(d,e):0:4&n?-1:1)}:function(t,e){if(t===e)return h=!0,0;var i,n=0,o=t.parentNode,s=e.parentNode,a=[t],l=[e];if(!o||!s)return t==m?-1:e==m?1:o?-1:s?1:d?M(d,t)-M(d,e):0;if(o===s)return pt(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)l.unshift(i);for(;a[n]===l[n];)n++;return n?pt(a[n],l[n]):a[n]==x?-1:l[n]==x?1:0},m):m},lt.matches=function(t,e){return lt(t,null,null,e)},lt.matchesSelector=function(t,e){if(p(t),i.matchesSelector&&g&&!T[e+" "]&&(!b||!b.test(e))&&(!f||!f.test(e)))try{var n=C.call(t,e);if(n||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){T(e,!0)}return lt(e,m,null,[t]).length>0},lt.contains=function(t,e){return(t.ownerDocument||t)!=m&&p(t),v(t,e)},lt.attr=function(t,e){(t.ownerDocument||t)!=m&&p(t);var o=n.attrHandle[e.toLowerCase()],s=o&&E.call(n.attrHandle,e.toLowerCase())?o(t,e,!g):void 0;return void 0!==s?s:i.attributes||!g?t.getAttribute(e):(s=t.getAttributeNode(e))&&s.specified?s.value:null},lt.escape=function(t){return(t+"").replace(nt,ot)},lt.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},lt.uniqueSort=function(t){var e,n=[],o=0,s=0;if(h=!i.detectDuplicates,d=!i.sortStable&&t.slice(0),t.sort(I),h){for(;e=t[s++];)e===t[s]&&(o=n.push(s));for(;o--;)t.splice(n[o],1)}return d=null,t},o=lt.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=o(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=o(e);return i},n=lt.selectors={cacheLength:50,createPseudo:ct,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,it),t[3]=(t[3]||t[4]||t[5]||"").replace(et,it),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||lt.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&lt.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return K.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&j.test(i)&&(e=a(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,it).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=S[t+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+t+"("+L+"|$)"))&&S(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(n){var o=lt.attr(n,t);return null==o?"!="===e:!e||(o+="","="===e?o===i:"!="===e?o!==i:"^="===e?i&&0===o.indexOf(i):"*="===e?i&&o.indexOf(i)>-1:"$="===e?i&&o.slice(-i.length)===i:"~="===e?(" "+o.replace(H," ")+" ").indexOf(i)>-1:"|="===e&&(o===i||o.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,n,o){var s="nth"!==t.slice(0,3),a="last"!==t.slice(-4),l="of-type"===e;return 1===n&&0===o?function(t){return!!t.parentNode}:function(e,i,r){var c,d,h,p,m,u,g=s!==a?"nextSibling":"previousSibling",f=e.parentNode,b=l&&e.nodeName.toLowerCase(),C=!r&&!l,v=!1;if(f){if(s){for(;g;){for(p=e;p=p[g];)if(l?p.nodeName.toLowerCase()===b:1===p.nodeType)return!1;u=g="only"===t&&!u&&"nextSibling"}return!0}if(u=[a?f.firstChild:f.lastChild],a&&C){for(v=(m=(c=(d=(h=(p=f)[_]||(p[_]={}))[p.uniqueID]||(h[p.uniqueID]={}))[t]||[])[0]===y&&c[1])&&c[2],p=m&&f.childNodes[m];p=++m&&p&&p[g]||(v=m=0)||u.pop();)if(1===p.nodeType&&++v&&p===e){d[t]=[y,m,v];break}}else if(C&&(v=m=(c=(d=(h=(p=e)[_]||(p[_]={}))[p.uniqueID]||(h[p.uniqueID]={}))[t]||[])[0]===y&&c[1]),!1===v)for(;(p=++m&&p&&p[g]||(v=m=0)||u.pop())&&((l?p.nodeName.toLowerCase()!==b:1!==p.nodeType)||!++v||(C&&((d=(h=p[_]||(p[_]={}))[p.uniqueID]||(h[p.uniqueID]={}))[t]=[y,v]),p!==e)););return(v-=o)===n||v%n==0&&v/n>=0}}},PSEUDO:function(t,e){var i,o=n.pseudos[t]||n.setFilters[t.toLowerCase()]||lt.error("unsupported pseudo: "+t);return o[_]?o(e):o.length>1?(i=[t,t,"",e],n.setFilters.hasOwnProperty(t.toLowerCase())?ct((function(t,i){for(var n,s=o(t,e),a=s.length;a--;)t[n=M(t,s[a])]=!(i[n]=s[a])})):function(t){return o(t,0,i)}):o}},pseudos:{not:ct((function(t){var e=[],i=[],n=l(t.replace($,"$1"));return n[_]?ct((function(t,e,i,o){for(var s,a=n(t,null,o,[]),l=t.length;l--;)(s=a[l])&&(t[l]=!(e[l]=s))})):function(t,o,s){return e[0]=t,n(e,null,s,i),e[0]=null,!i.pop()}})),has:ct((function(t){return function(e){return lt(t,e).length>0}})),contains:ct((function(t){return t=t.replace(et,it),function(e){return(e.textContent||o(e)).indexOf(t)>-1}})),lang:ct((function(t){return q.test(t||"")||lt.error("unsupported lang: "+t),t=t.replace(et,it).toLowerCase(),function(e){var i;do{if(i=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===u},focus:function(t){return t===m.activeElement&&(!m.hasFocus||m.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:gt(!1),disabled:gt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!n.pseudos.empty(t)},header:function(t){return J.test(t.nodeName)},input:function(t){return X.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:ft((function(){return[0]})),last:ft((function(t,e){return[e-1]})),eq:ft((function(t,e,i){return[i<0?i+e:i]})),even:ft((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:ft((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:ft((function(t,e,i){for(var n=i<0?i+e:i>e?e:i;--n>=0;)t.push(n);return t})),gt:ft((function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t}))}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[e]=mt(e);for(e in{submit:!0,reset:!0})n.pseudos[e]=ut(e);function Ct(){}function vt(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function _t(t,e,i){var n=e.dir,o=e.next,s=o||n,a=i&&"parentNode"===s,l=w++;return e.first?function(e,i,o){for(;e=e[n];)if(1===e.nodeType||a)return t(e,i,o);return!1}:function(e,i,r){var c,d,h,p=[y,l];if(r){for(;e=e[n];)if((1===e.nodeType||a)&&t(e,i,r))return!0}else for(;e=e[n];)if(1===e.nodeType||a)if(d=(h=e[_]||(e[_]={}))[e.uniqueID]||(h[e.uniqueID]={}),o&&o===e.nodeName.toLowerCase())e=e[n]||e;else{if((c=d[s])&&c[0]===y&&c[1]===l)return p[2]=c[2];if(d[s]=p,p[2]=t(e,i,r))return!0}return!1}}function xt(t){return t.length>1?function(e,i,n){for(var o=t.length;o--;)if(!t[o](e,i,n))return!1;return!0}:t[0]}function yt(t,e,i,n,o){for(var s,a=[],l=0,r=t.length,c=null!=e;l<r;l++)(s=t[l])&&(i&&!i(s,n,o)||(a.push(s),c&&e.push(l)));return a}function wt(t,e,i,n,o,s){return n&&!n[_]&&(n=wt(n)),o&&!o[_]&&(o=wt(o,s)),ct((function(s,a,l,r){var c,d,h,p=[],m=[],u=a.length,g=s||function(t,e,i){for(var n=0,o=e.length;n<o;n++)lt(t,e[n],i);return i}(e||"*",l.nodeType?[l]:l,[]),f=!t||!s&&e?g:yt(g,p,t,l,r),b=i?o||(s?t:u||n)?[]:a:f;if(i&&i(f,b,l,r),n)for(c=yt(b,m),n(c,[],l,r),d=c.length;d--;)(h=c[d])&&(b[m[d]]=!(f[m[d]]=h));if(s){if(o||t){if(o){for(c=[],d=b.length;d--;)(h=b[d])&&c.push(f[d]=h);o(null,b=[],c,r)}for(d=b.length;d--;)(h=b[d])&&(c=o?M(s,h):p[d])>-1&&(s[c]=!(a[c]=h))}}else b=yt(b===a?b.splice(u,b.length):b),o?o(null,a,b,r):R.apply(a,b)}))}function St(t){for(var e,i,o,s=t.length,a=n.relative[t[0].type],l=a||n.relative[" "],r=a?1:0,d=_t((function(t){return t===e}),l,!0),h=_t((function(t){return M(e,t)>-1}),l,!0),p=[function(t,i,n){var o=!a&&(n||i!==c)||((e=i).nodeType?d(t,i,n):h(t,i,n));return e=null,o}];r<s;r++)if(i=n.relative[t[r].type])p=[_t(xt(p),i)];else{if((i=n.filter[t[r].type].apply(null,t[r].matches))[_]){for(o=++r;o<s&&!n.relative[t[o].type];o++);return wt(r>1&&xt(p),r>1&&vt(t.slice(0,r-1).concat({value:" "===t[r-2].type?"*":""})).replace($,"$1"),i,r<o&&St(t.slice(r,o)),o<s&&St(t=t.slice(o)),o<s&&vt(t))}p.push(i)}return xt(p)}return Ct.prototype=n.filters=n.pseudos,n.setFilters=new Ct,a=lt.tokenize=function(t,e){var i,o,s,a,l,r,c,d=A[t+" "];if(d)return e?0:d.slice(0);for(l=t,r=[],c=n.preFilter;l;){for(a in i&&!(o=G.exec(l))||(o&&(l=l.slice(o[0].length)||l),r.push(s=[])),i=!1,(o=z.exec(l))&&(i=o.shift(),s.push({value:i,type:o[0].replace($," ")}),l=l.slice(i.length)),n.filter)!(o=K[a].exec(l))||c[a]&&!(o=c[a](o))||(i=o.shift(),s.push({value:i,type:a,matches:o}),l=l.slice(i.length));if(!i)break}return e?l.length:l?lt.error(t):A(t,r).slice(0)},l=lt.compile=function(t,e){var i,o=[],s=[],l=k[t+" "];if(!l){for(e||(e=a(t)),i=e.length;i--;)(l=St(e[i]))[_]?o.push(l):s.push(l);l=k(t,function(t,e){var i=e.length>0,o=t.length>0,s=function(s,a,l,r,d){var h,u,f,b=0,C="0",v=s&&[],_=[],x=c,w=s||o&&n.find.TAG("*",d),S=y+=null==x?1:Math.random()||.1,A=w.length;for(d&&(c=a==m||a||d);C!==A&&null!=(h=w[C]);C++){if(o&&h){for(u=0,a||h.ownerDocument==m||(p(h),l=!g);f=t[u++];)if(f(h,a||m,l)){r.push(h);break}d&&(y=S)}i&&((h=!f&&h)&&b--,s&&v.push(h))}if(b+=C,i&&C!==b){for(u=0;f=e[u++];)f(v,_,a,l);if(s){if(b>0)for(;C--;)v[C]||_[C]||(_[C]=P.call(r));_=yt(_)}R.apply(r,_),d&&!s&&_.length>0&&b+e.length>1&&lt.uniqueSort(r)}return d&&(y=S,c=x),v};return i?ct(s):s}(s,o)),l.selector=t}return l},r=lt.select=function(t,e,i,o){var s,r,c,d,h,p="function"==typeof t&&t,m=!o&&a(t=p.selector||t);if(i=i||[],1===m.length){if((r=m[0]=m[0].slice(0)).length>2&&"ID"===(c=r[0]).type&&9===e.nodeType&&g&&n.relative[r[1].type]){if(!(e=(n.find.ID(c.matches[0].replace(et,it),e)||[])[0]))return i;p&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(s=K.needsContext.test(t)?0:r.length;s--&&(c=r[s],!n.relative[d=c.type]);)if((h=n.find[d])&&(o=h(c.matches[0].replace(et,it),tt.test(r[0].type)&&bt(e.parentNode)||e))){if(r.splice(s,1),!(t=o.length&&vt(r)))return R.apply(i,o),i;break}}return(p||l(t,m))(o,e,!g,i,!e||tt.test(t)&&bt(e.parentNode)||e),i},i.sortStable=_.split("").sort(I).join("")===_,i.detectDuplicates=!!h,p(),i.sortDetached=dt((function(t){return 1&t.compareDocumentPosition(m.createElement("fieldset"))})),dt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ht("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),i.attributes&&dt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ht("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),dt((function(t){return null==t.getAttribute("disabled")}))||ht(U,(function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null})),lt}(t);x.find=w,x.expr=w.selectors,x.expr[":"]=x.expr.pseudos,x.uniqueSort=x.unique=w.uniqueSort,x.text=w.getText,x.isXMLDoc=w.isXML,x.contains=w.contains,x.escapeSelector=w.escape;var S=function(t,e,i){for(var n=[],o=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&x(t).is(i))break;n.push(t)}return n},A=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},k=x.expr.match.needsContext;function T(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var I=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function E(t,e,i){return u(e)?x.grep(t,(function(t,n){return!!e.call(t,n,t)!==i})):e.nodeType?x.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?x.grep(t,(function(t){return l.call(e,t)>-1!==i})):x.filter(e,t,i)}x.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?x.find.matchesSelector(n,t)?[n]:[]:x.find.matches(t,x.grep(e,(function(t){return 1===t.nodeType})))},x.fn.extend({find:function(t){var e,i,n=this.length,o=this;if("string"!=typeof t)return this.pushStack(x(t).filter((function(){for(e=0;e<n;e++)if(x.contains(o[e],this))return!0})));for(i=this.pushStack([]),e=0;e<n;e++)x.find(t,o[e],i);return n>1?x.uniqueSort(i):i},filter:function(t){return this.pushStack(E(this,t||[],!1))},not:function(t){return this.pushStack(E(this,t||[],!0))},is:function(t){return!!E(this,"string"==typeof t&&k.test(t)?x(t):t||[],!1).length}});var D,P=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(x.fn.init=function(t,e,i){var n,o;if(!t)return this;if(i=i||D,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:P.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof x?e[0]:e,x.merge(this,x.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:f,!0)),I.test(n[1])&&x.isPlainObject(e))for(n in e)u(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(o=f.getElementById(n[2]))&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):u(t)?void 0!==i.ready?i.ready(t):t(x):x.makeArray(t,this)}).prototype=x.fn,D=x(f);var F=/^(?:parents|prev(?:Until|All))/,R={children:!0,contents:!0,next:!0,prev:!0};function V(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}x.fn.extend({has:function(t){var e=x(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(x.contains(this,e[t]))return!0}))},closest:function(t,e){var i,n=0,o=this.length,s=[],a="string"!=typeof t&&x(t);if(!k.test(t))for(;n<o;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&x.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?x.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?l.call(x(t),this[0]):l.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(x.uniqueSort(x.merge(this.get(),x(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),x.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return S(t,"parentNode")},parentsUntil:function(t,e,i){return S(t,"parentNode",i)},next:function(t){return V(t,"nextSibling")},prev:function(t){return V(t,"previousSibling")},nextAll:function(t){return S(t,"nextSibling")},prevAll:function(t){return S(t,"previousSibling")},nextUntil:function(t,e,i){return S(t,"nextSibling",i)},prevUntil:function(t,e,i){return S(t,"previousSibling",i)},siblings:function(t){return A((t.parentNode||{}).firstChild,t)},children:function(t){return A(t.firstChild)},contents:function(t){return null!=t.contentDocument&&n(t.contentDocument)?t.contentDocument:(T(t,"template")&&(t=t.content||t),x.merge([],t.childNodes))}},(function(t,e){x.fn[t]=function(i,n){var o=x.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(o=x.filter(n,o)),this.length>1&&(R[t]||x.uniqueSort(o),F.test(t)&&o.reverse()),this.pushStack(o)}}));var M=/[^\x20\t\r\n\f]+/g;function U(t){return t}function L(t){throw t}function B(t,e,i,n){var o;try{t&&u(o=t.promise)?o.call(t).done(e).fail(i):t&&u(o=t.then)?o.call(t,e,i):e.apply(void 0,[t].slice(n))}catch(t){i.apply(void 0,[t])}}x.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return x.each(t.match(M)||[],(function(t,i){e[i]=!0})),e}(t):x.extend({},t);var e,i,n,o,s=[],a=[],l=-1,r=function(){for(o=o||t.once,n=e=!0;a.length;l=-1)for(i=a.shift();++l<s.length;)!1===s[l].apply(i[0],i[1])&&t.stopOnFalse&&(l=s.length,i=!1);t.memory||(i=!1),e=!1,o&&(s=i?[]:"")},c={add:function(){return s&&(i&&!e&&(l=s.length-1,a.push(i)),function e(i){x.each(i,(function(i,n){u(n)?t.unique&&c.has(n)||s.push(n):n&&n.length&&"string"!==v(n)&&e(n)}))}(arguments),i&&!e&&r()),this},remove:function(){return x.each(arguments,(function(t,e){for(var i;(i=x.inArray(e,s,i))>-1;)s.splice(i,1),i<=l&&l--})),this},has:function(t){return t?x.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return o=a=[],s=i="",this},disabled:function(){return!s},lock:function(){return o=a=[],i||e||(s=i=""),this},locked:function(){return!!o},fireWith:function(t,i){return o||(i=[t,(i=i||[]).slice?i.slice():i],a.push(i),e||r()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},x.extend({Deferred:function(e){var i=[["notify","progress",x.Callbacks("memory"),x.Callbacks("memory"),2],["resolve","done",x.Callbacks("once memory"),x.Callbacks("once memory"),0,"resolved"],["reject","fail",x.Callbacks("once memory"),x.Callbacks("once memory"),1,"rejected"]],n="pending",o={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return x.Deferred((function(e){x.each(i,(function(i,n){var o=u(t[n[4]])&&t[n[4]];s[n[1]]((function(){var t=o&&o.apply(this,arguments);t&&u(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[n[0]+"With"](this,o?[t]:arguments)}))})),t=null})).promise()},then:function(e,n,o){var s=0;function a(e,i,n,o){return function(){var l=this,r=arguments,c=function(){var t,c;if(!(e<s)){if((t=n.apply(l,r))===i.promise())throw new TypeError("Thenable self-resolution");c=t&&("object"==typeof t||"function"==typeof t)&&t.then,u(c)?o?c.call(t,a(s,i,U,o),a(s,i,L,o)):(s++,c.call(t,a(s,i,U,o),a(s,i,L,o),a(s,i,U,i.notifyWith))):(n!==U&&(l=void 0,r=[t]),(o||i.resolveWith)(l,r))}},d=o?c:function(){try{c()}catch(t){x.Deferred.exceptionHook&&x.Deferred.exceptionHook(t,d.stackTrace),e+1>=s&&(n!==L&&(l=void 0,r=[t]),i.rejectWith(l,r))}};e?d():(x.Deferred.getStackHook&&(d.stackTrace=x.Deferred.getStackHook()),t.setTimeout(d))}}return x.Deferred((function(t){i[0][3].add(a(0,t,u(o)?o:U,t.notifyWith)),i[1][3].add(a(0,t,u(e)?e:U)),i[2][3].add(a(0,t,u(n)?n:L))})).promise()},promise:function(t){return null!=t?x.extend(t,o):o}},s={};return x.each(i,(function(t,e){var a=e[2],l=e[5];o[e[1]]=a.add,l&&a.add((function(){n=l}),i[3-t][2].disable,i[3-t][3].disable,i[0][2].lock,i[0][3].lock),a.add(e[3].fire),s[e[0]]=function(){return s[e[0]+"With"](this===s?void 0:this,arguments),this},s[e[0]+"With"]=a.fireWith})),o.promise(s),e&&e.call(s,s),s},when:function(t){var e=arguments.length,i=e,n=Array(i),s=o.call(arguments),a=x.Deferred(),l=function(t){return function(i){n[t]=this,s[t]=arguments.length>1?o.call(arguments):i,--e||a.resolveWith(n,s)}};if(e<=1&&(B(t,a.done(l(i)).resolve,a.reject,!e),"pending"===a.state()||u(s[i]&&s[i].then)))return a.then();for(;i--;)B(s[i],l(i),a.reject);return a.promise()}});var O=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;x.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&O.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},x.readyException=function(e){t.setTimeout((function(){throw e}))};var N=x.Deferred();function H(){f.removeEventListener("DOMContentLoaded",H),t.removeEventListener("load",H),x.ready()}x.fn.ready=function(t){return N.then(t).catch((function(t){x.readyException(t)})),this},x.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--x.readyWait:x.isReady)||(x.isReady=!0,!0!==t&&--x.readyWait>0||N.resolveWith(f,[x]))}}),x.ready.then=N.then,"complete"===f.readyState||"loading"!==f.readyState&&!f.documentElement.doScroll?t.setTimeout(x.ready):(f.addEventListener("DOMContentLoaded",H),t.addEventListener("load",H));var $=function(t,e,i,n,o,s,a){var l=0,r=t.length,c=null==i;if("object"===v(i))for(l in o=!0,i)$(t,e,l,i[l],!0,s,a);else if(void 0!==n&&(o=!0,u(n)||(a=!0),c&&(a?(e.call(t,n),e=null):(c=e,e=function(t,e,i){return c.call(x(t),i)})),e))for(;l<r;l++)e(t[l],i,a?n:n.call(t[l],l,e(t[l],i)));return o?t:c?e.call(t):r?e(t[0],i):s},G=/^-ms-/,z=/-([a-z])/g;function W(t,e){return e.toUpperCase()}function j(t){return t.replace(G,"ms-").replace(z,W)}var q=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function K(){this.expando=x.expando+K.uid++}K.uid=1,K.prototype={cache:function(t){var e=t[this.expando];return e||(e={},q(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,o=this.cache(t);if("string"==typeof e)o[j(e)]=i;else for(n in e)o[j(n)]=e[n];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][j(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){i=(e=Array.isArray(e)?e.map(j):(e=j(e))in n?[e]:e.match(M)||[]).length;for(;i--;)delete n[e[i]]}(void 0===e||x.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!x.isEmptyObject(e)}};var Y=new K,X=new K,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function Q(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(Z,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:J.test(t)?JSON.parse(t):t)}(i)}catch(t){}X.set(t,e,i)}else i=void 0;return i}x.extend({hasData:function(t){return X.hasData(t)||Y.hasData(t)},data:function(t,e,i){return X.access(t,e,i)},removeData:function(t,e){X.remove(t,e)},_data:function(t,e,i){return Y.access(t,e,i)},_removeData:function(t,e){Y.remove(t,e)}}),x.fn.extend({data:function(t,e){var i,n,o,s=this[0],a=s&&s.attributes;if(void 0===t){if(this.length&&(o=X.get(s),1===s.nodeType&&!Y.get(s,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&0===(n=a[i].name).indexOf("data-")&&(n=j(n.slice(5)),Q(s,n,o[n]));Y.set(s,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each((function(){X.set(this,t)})):$(this,(function(e){var i;if(s&&void 0===e)return void 0!==(i=X.get(s,t))||void 0!==(i=Q(s,t))?i:void 0;this.each((function(){X.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){X.remove(this,t)}))}}),x.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=Y.get(t,e),i&&(!n||Array.isArray(i)?n=Y.access(t,e,x.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=x.queue(t,e),n=i.length,o=i.shift(),s=x._queueHooks(t,e);"inprogress"===o&&(o=i.shift(),n--),o&&("fx"===e&&i.unshift("inprogress"),delete s.stop,o.call(t,(function(){x.dequeue(t,e)}),s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Y.get(t,i)||Y.access(t,i,{empty:x.Callbacks("once memory").add((function(){Y.remove(t,[e+"queue",i])}))})}}),x.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?x.queue(this[0],t):void 0===e?this:this.each((function(){var i=x.queue(this,t,e);x._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&x.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){x.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,o=x.Deferred(),s=this,a=this.length,l=function(){--n||o.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(i=Y.get(s[a],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(l));return l(),o.promise(e)}});var tt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,et=new RegExp("^(?:([+-])=|)("+tt+")([a-z%]*)$","i"),it=["Top","Right","Bottom","Left"],nt=f.documentElement,ot=function(t){return x.contains(t.ownerDocument,t)},st={composed:!0};nt.getRootNode&&(ot=function(t){return x.contains(t.ownerDocument,t)||t.getRootNode(st)===t.ownerDocument});var at=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&ot(t)&&"none"===x.css(t,"display")};function lt(t,e,i,n){var o,s,a=20,l=n?function(){return n.cur()}:function(){return x.css(t,e,"")},r=l(),c=i&&i[3]||(x.cssNumber[e]?"":"px"),d=t.nodeType&&(x.cssNumber[e]||"px"!==c&&+r)&&et.exec(x.css(t,e));if(d&&d[3]!==c){for(r/=2,c=c||d[3],d=+r||1;a--;)x.style(t,e,d+c),(1-s)*(1-(s=l()/r||.5))<=0&&(a=0),d/=s;d*=2,x.style(t,e,d+c),i=i||[]}return i&&(d=+d||+r||0,o=i[1]?d+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=d,n.end=o)),o}var rt={};function ct(t){var e,i=t.ownerDocument,n=t.nodeName,o=rt[n];return o||(e=i.body.appendChild(i.createElement(n)),o=x.css(e,"display"),e.parentNode.removeChild(e),"none"===o&&(o="block"),rt[n]=o,o)}function dt(t,e){for(var i,n,o=[],s=0,a=t.length;s<a;s++)(n=t[s]).style&&(i=n.style.display,e?("none"===i&&(o[s]=Y.get(n,"display")||null,o[s]||(n.style.display="")),""===n.style.display&&at(n)&&(o[s]=ct(n))):"none"!==i&&(o[s]="none",Y.set(n,"display",i)));for(s=0;s<a;s++)null!=o[s]&&(t[s].style.display=o[s]);return t}x.fn.extend({show:function(){return dt(this,!0)},hide:function(){return dt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){at(this)?x(this).show():x(this).hide()}))}});var ht,pt,mt=/^(?:checkbox|radio)$/i,ut=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,gt=/^$|^module$|\/(?:java|ecma)script/i;ht=f.createDocumentFragment().appendChild(f.createElement("div")),(pt=f.createElement("input")).setAttribute("type","radio"),pt.setAttribute("checked","checked"),pt.setAttribute("name","t"),ht.appendChild(pt),m.checkClone=ht.cloneNode(!0).cloneNode(!0).lastChild.checked,ht.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!ht.cloneNode(!0).lastChild.defaultValue,ht.innerHTML="<option></option>",m.option=!!ht.lastChild;var ft={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function bt(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&T(t,e)?x.merge([t],i):i}function Ct(t,e){for(var i=0,n=t.length;i<n;i++)Y.set(t[i],"globalEval",!e||Y.get(e[i],"globalEval"))}ft.tbody=ft.tfoot=ft.colgroup=ft.caption=ft.thead,ft.th=ft.td,m.option||(ft.optgroup=ft.option=[1,"<select multiple='multiple'>","</select>"]);var vt=/<|&#?\w+;/;function _t(t,e,i,n,o){for(var s,a,l,r,c,d,h=e.createDocumentFragment(),p=[],m=0,u=t.length;m<u;m++)if((s=t[m])||0===s)if("object"===v(s))x.merge(p,s.nodeType?[s]:s);else if(vt.test(s)){for(a=a||h.appendChild(e.createElement("div")),l=(ut.exec(s)||["",""])[1].toLowerCase(),r=ft[l]||ft._default,a.innerHTML=r[1]+x.htmlPrefilter(s)+r[2],d=r[0];d--;)a=a.lastChild;x.merge(p,a.childNodes),(a=h.firstChild).textContent=""}else p.push(e.createTextNode(s));for(h.textContent="",m=0;s=p[m++];)if(n&&x.inArray(s,n)>-1)o&&o.push(s);else if(c=ot(s),a=bt(h.appendChild(s),"script"),c&&Ct(a),i)for(d=0;s=a[d++];)gt.test(s.type||"")&&i.push(s);return h}var xt=/^key/,yt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,wt=/^([^.]*)(?:\.(.+)|)/;function St(){return!0}function At(){return!1}function kt(t,e){return t===function(){try{return f.activeElement}catch(t){}}()==("focus"===e)}function Tt(t,e,i,n,o,s){var a,l;if("object"==typeof e){for(l in"string"!=typeof i&&(n=n||i,i=void 0),e)Tt(t,l,i,n,e[l],s);return t}if(null==n&&null==o?(o=i,n=i=void 0):null==o&&("string"==typeof i?(o=n,n=void 0):(o=n,n=i,i=void 0)),!1===o)o=At;else if(!o)return t;return 1===s&&(a=o,o=function(t){return x().off(t),a.apply(this,arguments)},o.guid=a.guid||(a.guid=x.guid++)),t.each((function(){x.event.add(this,e,o,n,i)}))}function It(t,e,i){i?(Y.set(t,e,!1),x.event.add(t,e,{namespace:!1,handler:function(t){var n,s,a=Y.get(this,e);if(1&t.isTrigger&&this[e]){if(a.length)(x.event.special[e]||{}).delegateType&&t.stopPropagation();else if(a=o.call(arguments),Y.set(this,e,a),n=i(this,e),this[e](),a!==(s=Y.get(this,e))||n?Y.set(this,e,!1):s={},a!==s)return t.stopImmediatePropagation(),t.preventDefault(),s.value}else a.length&&(Y.set(this,e,{value:x.event.trigger(x.extend(a[0],x.Event.prototype),a.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===Y.get(t,e)&&x.event.add(t,e,St)}x.event={global:{},add:function(t,e,i,n,o){var s,a,l,r,c,d,h,p,m,u,g,f=Y.get(t);if(q(t))for(i.handler&&(i=(s=i).handler,o=s.selector),o&&x.find.matchesSelector(nt,o),i.guid||(i.guid=x.guid++),(r=f.events)||(r=f.events=Object.create(null)),(a=f.handle)||(a=f.handle=function(e){return void 0!==x&&x.event.triggered!==e.type?x.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(M)||[""]).length;c--;)m=g=(l=wt.exec(e[c])||[])[1],u=(l[2]||"").split(".").sort(),m&&(h=x.event.special[m]||{},m=(o?h.delegateType:h.bindType)||m,h=x.event.special[m]||{},d=x.extend({type:m,origType:g,data:n,handler:i,guid:i.guid,selector:o,needsContext:o&&x.expr.match.needsContext.test(o),namespace:u.join(".")},s),(p=r[m])||((p=r[m]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(t,n,u,a)||t.addEventListener&&t.addEventListener(m,a)),h.add&&(h.add.call(t,d),d.handler.guid||(d.handler.guid=i.guid)),o?p.splice(p.delegateCount++,0,d):p.push(d),x.event.global[m]=!0)},remove:function(t,e,i,n,o){var s,a,l,r,c,d,h,p,m,u,g,f=Y.hasData(t)&&Y.get(t);if(f&&(r=f.events)){for(c=(e=(e||"").match(M)||[""]).length;c--;)if(m=g=(l=wt.exec(e[c])||[])[1],u=(l[2]||"").split(".").sort(),m){for(h=x.event.special[m]||{},p=r[m=(n?h.delegateType:h.bindType)||m]||[],l=l[2]&&new RegExp("(^|\\.)"+u.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=p.length;s--;)d=p[s],!o&&g!==d.origType||i&&i.guid!==d.guid||l&&!l.test(d.namespace)||n&&n!==d.selector&&("**"!==n||!d.selector)||(p.splice(s,1),d.selector&&p.delegateCount--,h.remove&&h.remove.call(t,d));a&&!p.length&&(h.teardown&&!1!==h.teardown.call(t,u,f.handle)||x.removeEvent(t,m,f.handle),delete r[m])}else for(m in r)x.event.remove(t,m+e[c],i,n,!0);x.isEmptyObject(r)&&Y.remove(t,"handle events")}},dispatch:function(t){var e,i,n,o,s,a,l=new Array(arguments.length),r=x.event.fix(t),c=(Y.get(this,"events")||Object.create(null))[r.type]||[],d=x.event.special[r.type]||{};for(l[0]=r,e=1;e<arguments.length;e++)l[e]=arguments[e];if(r.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,r)){for(a=x.event.handlers.call(this,r,c),e=0;(o=a[e++])&&!r.isPropagationStopped();)for(r.currentTarget=o.elem,i=0;(s=o.handlers[i++])&&!r.isImmediatePropagationStopped();)r.rnamespace&&!1!==s.namespace&&!r.rnamespace.test(s.namespace)||(r.handleObj=s,r.data=s.data,void 0!==(n=((x.event.special[s.origType]||{}).handle||s.handler).apply(o.elem,l))&&!1===(r.result=n)&&(r.preventDefault(),r.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,r),r.result}},handlers:function(t,e){var i,n,o,s,a,l=[],r=e.delegateCount,c=t.target;if(r&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(s=[],a={},i=0;i<r;i++)void 0===a[o=(n=e[i]).selector+" "]&&(a[o]=n.needsContext?x(o,this).index(c)>-1:x.find(o,this,null,[c]).length),a[o]&&s.push(n);s.length&&l.push({elem:c,handlers:s})}return c=this,r<e.length&&l.push({elem:c,handlers:e.slice(r)}),l},addProp:function(t,e){Object.defineProperty(x.Event.prototype,t,{enumerable:!0,configurable:!0,get:u(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[x.expando]?t:new x.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return mt.test(e.type)&&e.click&&T(e,"input")&&It(e,"click",St),!1},trigger:function(t){var e=this||t;return mt.test(e.type)&&e.click&&T(e,"input")&&It(e,"click"),!0},_default:function(t){var e=t.target;return mt.test(e.type)&&e.click&&T(e,"input")&&Y.get(e,"click")||T(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},x.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},x.Event=function(t,e){if(!(this instanceof x.Event))return new x.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?St:At,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&x.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[x.expando]=!0},x.Event.prototype={constructor:x.Event,isDefaultPrevented:At,isPropagationStopped:At,isImmediatePropagationStopped:At,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=St,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=St,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=St,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},x.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&xt.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&yt.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},x.event.addProp),x.each({focus:"focusin",blur:"focusout"},(function(t,e){x.event.special[t]={setup:function(){return It(this,t,kt),!1},trigger:function(){return It(this,t),!0},delegateType:e}})),x.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){x.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,o=t.relatedTarget,s=t.handleObj;return o&&(o===n||x.contains(n,o))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}})),x.fn.extend({on:function(t,e,i,n){return Tt(this,t,e,i,n)},one:function(t,e,i,n){return Tt(this,t,e,i,n,1)},off:function(t,e,i){var n,o;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,x(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=At),this.each((function(){x.event.remove(this,t,i,e)}))}});var Et=/<script|<style|<link/i,Dt=/checked\s*(?:[^=]|=\s*.checked.)/i,Pt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ft(t,e){return T(t,"table")&&T(11!==e.nodeType?e:e.firstChild,"tr")&&x(t).children("tbody")[0]||t}function Rt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Vt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Mt(t,e){var i,n,o,s,a,l;if(1===e.nodeType){if(Y.hasData(t)&&(l=Y.get(t).events))for(o in Y.remove(e,"handle events"),l)for(i=0,n=l[o].length;i<n;i++)x.event.add(e,o,l[o][i]);X.hasData(t)&&(s=X.access(t),a=x.extend({},s),X.set(e,a))}}function Ut(t,e){var i=e.nodeName.toLowerCase();"input"===i&&mt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function Lt(t,e,i,n){e=s(e);var o,a,l,r,c,d,h=0,p=t.length,g=p-1,f=e[0],b=u(f);if(b||p>1&&"string"==typeof f&&!m.checkClone&&Dt.test(f))return t.each((function(o){var s=t.eq(o);b&&(e[0]=f.call(this,o,s.html())),Lt(s,e,i,n)}));if(p&&(a=(o=_t(e,t[0].ownerDocument,!1,t,n)).firstChild,1===o.childNodes.length&&(o=a),a||n)){for(r=(l=x.map(bt(o,"script"),Rt)).length;h<p;h++)c=o,h!==g&&(c=x.clone(c,!0,!0),r&&x.merge(l,bt(c,"script"))),i.call(t[h],c,h);if(r)for(d=l[l.length-1].ownerDocument,x.map(l,Vt),h=0;h<r;h++)c=l[h],gt.test(c.type||"")&&!Y.access(c,"globalEval")&&x.contains(d,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?x._evalUrl&&!c.noModule&&x._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},d):C(c.textContent.replace(Pt,""),c,d))}return t}function Bt(t,e,i){for(var n,o=e?x.filter(e,t):t,s=0;null!=(n=o[s]);s++)i||1!==n.nodeType||x.cleanData(bt(n)),n.parentNode&&(i&&ot(n)&&Ct(bt(n,"script")),n.parentNode.removeChild(n));return t}x.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var n,o,s,a,l=t.cloneNode(!0),r=ot(t);if(!(m.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||x.isXMLDoc(t)))for(a=bt(l),n=0,o=(s=bt(t)).length;n<o;n++)Ut(s[n],a[n]);if(e)if(i)for(s=s||bt(t),a=a||bt(l),n=0,o=s.length;n<o;n++)Mt(s[n],a[n]);else Mt(t,l);return(a=bt(l,"script")).length>0&&Ct(a,!r&&bt(t,"script")),l},cleanData:function(t){for(var e,i,n,o=x.event.special,s=0;void 0!==(i=t[s]);s++)if(q(i)){if(e=i[Y.expando]){if(e.events)for(n in e.events)o[n]?x.event.remove(i,n):x.removeEvent(i,n,e.handle);i[Y.expando]=void 0}i[X.expando]&&(i[X.expando]=void 0)}}}),x.fn.extend({detach:function(t){return Bt(this,t,!0)},remove:function(t){return Bt(this,t)},text:function(t){return $(this,(function(t){return void 0===t?x.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Lt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ft(this,t).appendChild(t)}))},prepend:function(){return Lt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Ft(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Lt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Lt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(x.cleanData(bt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return x.clone(this,t,e)}))},html:function(t){return $(this,(function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Et.test(t)&&!ft[(ut.exec(t)||["",""])[1].toLowerCase()]){t=x.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(x.cleanData(bt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Lt(this,arguments,(function(e){var i=this.parentNode;x.inArray(this,t)<0&&(x.cleanData(bt(this)),i&&i.replaceChild(e,this))}),t)}}),x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){x.fn[t]=function(t){for(var i,n=[],o=x(t),s=o.length-1,l=0;l<=s;l++)i=l===s?this:this.clone(!0),x(o[l])[e](i),a.apply(n,i.get());return this.pushStack(n)}}));var Ot=new RegExp("^("+tt+")(?!px)[a-z%]+$","i"),Nt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Ht=function(t,e,i){var n,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];for(o in n=i.call(t),e)t.style[o]=s[o];return n},$t=new RegExp(it.join("|"),"i");function Gt(t,e,i){var n,o,s,a,l=t.style;return(i=i||Nt(t))&&(""!==(a=i.getPropertyValue(e)||i[e])||ot(t)||(a=x.style(t,e)),!m.pixelBoxStyles()&&Ot.test(a)&&$t.test(e)&&(n=l.width,o=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=a,a=i.width,l.width=n,l.minWidth=o,l.maxWidth=s)),void 0!==a?a+"":a}function zt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function e(){if(d){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",nt.appendChild(c).appendChild(d);var e=t.getComputedStyle(d);n="1%"!==e.top,r=12===i(e.marginLeft),d.style.right="60%",a=36===i(e.right),o=36===i(e.width),d.style.position="absolute",s=12===i(d.offsetWidth/3),nt.removeChild(c),d=null}}function i(t){return Math.round(parseFloat(t))}var n,o,s,a,l,r,c=f.createElement("div"),d=f.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,x.extend(m,{boxSizingReliable:function(){return e(),o},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),r},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,i,n,o;return null==l&&(e=f.createElement("table"),i=f.createElement("tr"),n=f.createElement("div"),e.style.cssText="position:absolute;left:-11111px",i.style.height="1px",n.style.height="9px",nt.appendChild(e).appendChild(i).appendChild(n),o=t.getComputedStyle(i),l=parseInt(o.height)>3,nt.removeChild(e)),l}}))}();var Wt=["Webkit","Moz","ms"],jt=f.createElement("div").style,qt={};function Kt(t){var e=x.cssProps[t]||qt[t];return e||(t in jt?t:qt[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=Wt.length;i--;)if((t=Wt[i]+e)in jt)return t}(t)||t)}var Yt=/^(none|table(?!-c[ea]).+)/,Xt=/^--/,Jt={position:"absolute",visibility:"hidden",display:"block"},Zt={letterSpacing:"0",fontWeight:"400"};function Qt(t,e,i){var n=et.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function te(t,e,i,n,o,s){var a="width"===e?1:0,l=0,r=0;if(i===(n?"border":"content"))return 0;for(;a<4;a+=2)"margin"===i&&(r+=x.css(t,i+it[a],!0,o)),n?("content"===i&&(r-=x.css(t,"padding"+it[a],!0,o)),"margin"!==i&&(r-=x.css(t,"border"+it[a]+"Width",!0,o))):(r+=x.css(t,"padding"+it[a],!0,o),"padding"!==i?r+=x.css(t,"border"+it[a]+"Width",!0,o):l+=x.css(t,"border"+it[a]+"Width",!0,o));return!n&&s>=0&&(r+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-r-l-.5))||0),r}function ee(t,e,i){var n=Nt(t),o=(!m.boxSizingReliable()||i)&&"border-box"===x.css(t,"boxSizing",!1,n),s=o,a=Gt(t,e,n),l="offset"+e[0].toUpperCase()+e.slice(1);if(Ot.test(a)){if(!i)return a;a="auto"}return(!m.boxSizingReliable()&&o||!m.reliableTrDimensions()&&T(t,"tr")||"auto"===a||!parseFloat(a)&&"inline"===x.css(t,"display",!1,n))&&t.getClientRects().length&&(o="border-box"===x.css(t,"boxSizing",!1,n),(s=l in t)&&(a=t[l])),(a=parseFloat(a)||0)+te(t,e,i||(o?"border":"content"),s,n,a)+"px"}function ie(t,e,i,n,o){return new ie.prototype.init(t,e,i,n,o)}x.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Gt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,s,a,l=j(e),r=Xt.test(e),c=t.style;if(r||(e=Kt(l)),a=x.cssHooks[e]||x.cssHooks[l],void 0===i)return a&&"get"in a&&void 0!==(o=a.get(t,!1,n))?o:c[e];"string"===(s=typeof i)&&(o=et.exec(i))&&o[1]&&(i=lt(t,e,o),s="number"),null!=i&&i==i&&("number"!==s||r||(i+=o&&o[3]||(x.cssNumber[l]?"":"px")),m.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),a&&"set"in a&&void 0===(i=a.set(t,i,n))||(r?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,n){var o,s,a,l=j(e);return Xt.test(e)||(e=Kt(l)),(a=x.cssHooks[e]||x.cssHooks[l])&&"get"in a&&(o=a.get(t,!0,i)),void 0===o&&(o=Gt(t,e,n)),"normal"===o&&e in Zt&&(o=Zt[e]),""===i||i?(s=parseFloat(o),!0===i||isFinite(s)?s||0:o):o}}),x.each(["height","width"],(function(t,e){x.cssHooks[e]={get:function(t,i,n){if(i)return!Yt.test(x.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?ee(t,e,n):Ht(t,Jt,(function(){return ee(t,e,n)}))},set:function(t,i,n){var o,s=Nt(t),a=!m.scrollboxSize()&&"absolute"===s.position,l=(a||n)&&"border-box"===x.css(t,"boxSizing",!1,s),r=n?te(t,e,n,l,s):0;return l&&a&&(r-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-te(t,e,"border",!1,s)-.5)),r&&(o=et.exec(i))&&"px"!==(o[3]||"px")&&(t.style[e]=i,i=x.css(t,e)),Qt(0,i,r)}}})),x.cssHooks.marginLeft=zt(m.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Gt(t,"marginLeft"))||t.getBoundingClientRect().left-Ht(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),x.each({margin:"",padding:"",border:"Width"},(function(t,e){x.cssHooks[t+e]={expand:function(i){for(var n=0,o={},s="string"==typeof i?i.split(" "):[i];n<4;n++)o[t+it[n]+e]=s[n]||s[n-2]||s[0];return o}},"margin"!==t&&(x.cssHooks[t+e].set=Qt)})),x.fn.extend({css:function(t,e){return $(this,(function(t,e,i){var n,o,s={},a=0;if(Array.isArray(e)){for(n=Nt(t),o=e.length;a<o;a++)s[e[a]]=x.css(t,e[a],!1,n);return s}return void 0!==i?x.style(t,e,i):x.css(t,e)}),t,e,arguments.length>1)}}),x.Tween=ie,ie.prototype={constructor:ie,init:function(t,e,i,n,o,s){this.elem=t,this.prop=i,this.easing=o||x.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=s||(x.cssNumber[i]?"":"px")},cur:function(){var t=ie.propHooks[this.prop];return t&&t.get?t.get(this):ie.propHooks._default.get(this)},run:function(t){var e,i=ie.propHooks[this.prop];return this.options.duration?this.pos=e=x.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):ie.propHooks._default.set(this),this}},ie.prototype.init.prototype=ie.prototype,ie.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=x.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){x.fx.step[t.prop]?x.fx.step[t.prop](t):1!==t.elem.nodeType||!x.cssHooks[t.prop]&&null==t.elem.style[Kt(t.prop)]?t.elem[t.prop]=t.now:x.style(t.elem,t.prop,t.now+t.unit)}}},ie.propHooks.scrollTop=ie.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},x.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},x.fx=ie.prototype.init,x.fx.step={};var ne,oe,se=/^(?:toggle|show|hide)$/,ae=/queueHooks$/;function le(){oe&&(!1===f.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(le):t.setTimeout(le,x.fx.interval),x.fx.tick())}function re(){return t.setTimeout((function(){ne=void 0})),ne=Date.now()}function ce(t,e){var i,n=0,o={height:t};for(e=e?1:0;n<4;n+=2-e)o["margin"+(i=it[n])]=o["padding"+i]=t;return e&&(o.opacity=o.width=t),o}function de(t,e,i){for(var n,o=(he.tweeners[e]||[]).concat(he.tweeners["*"]),s=0,a=o.length;s<a;s++)if(n=o[s].call(i,e,t))return n}function he(t,e,i){var n,o,s=0,a=he.prefilters.length,l=x.Deferred().always((function(){delete r.elem})),r=function(){if(o)return!1;for(var e=ne||re(),i=Math.max(0,c.startTime+c.duration-e),n=1-(i/c.duration||0),s=0,a=c.tweens.length;s<a;s++)c.tweens[s].run(n);return l.notifyWith(t,[c,n,i]),n<1&&a?i:(a||l.notifyWith(t,[c,1,0]),l.resolveWith(t,[c]),!1)},c=l.promise({elem:t,props:x.extend({},e),opts:x.extend(!0,{specialEasing:{},easing:x.easing._default},i),originalProperties:e,originalOptions:i,startTime:ne||re(),duration:i.duration,tweens:[],createTween:function(e,i){var n=x.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(n),n},stop:function(e){var i=0,n=e?c.tweens.length:0;if(o)return this;for(o=!0;i<n;i++)c.tweens[i].run(1);return e?(l.notifyWith(t,[c,1,0]),l.resolveWith(t,[c,e])):l.rejectWith(t,[c,e]),this}}),d=c.props;for(!function(t,e){var i,n,o,s,a;for(i in t)if(o=e[n=j(i)],s=t[i],Array.isArray(s)&&(o=s[1],s=t[i]=s[0]),i!==n&&(t[n]=s,delete t[i]),(a=x.cssHooks[n])&&"expand"in a)for(i in s=a.expand(s),delete t[n],s)i in t||(t[i]=s[i],e[i]=o);else e[n]=o}(d,c.opts.specialEasing);s<a;s++)if(n=he.prefilters[s].call(c,t,d,c.opts))return u(n.stop)&&(x._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return x.map(d,de,c),u(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),x.fx.timer(x.extend(r,{elem:t,anim:c,queue:c.opts.queue})),c}x.Animation=x.extend(he,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return lt(i.elem,t,et.exec(e),i),i}]},tweener:function(t,e){u(t)?(e=t,t=["*"]):t=t.match(M);for(var i,n=0,o=t.length;n<o;n++)i=t[n],he.tweeners[i]=he.tweeners[i]||[],he.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var n,o,s,a,l,r,c,d,h="width"in e||"height"in e,p=this,m={},u=t.style,g=t.nodeType&&at(t),f=Y.get(t,"fxshow");for(n in i.queue||(null==(a=x._queueHooks(t,"fx")).unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,p.always((function(){p.always((function(){a.unqueued--,x.queue(t,"fx").length||a.empty.fire()}))}))),e)if(o=e[n],se.test(o)){if(delete e[n],s=s||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!f||void 0===f[n])continue;g=!0}m[n]=f&&f[n]||x.style(t,n)}if((r=!x.isEmptyObject(e))||!x.isEmptyObject(m))for(n in h&&1===t.nodeType&&(i.overflow=[u.overflow,u.overflowX,u.overflowY],null==(c=f&&f.display)&&(c=Y.get(t,"display")),"none"===(d=x.css(t,"display"))&&(c?d=c:(dt([t],!0),c=t.style.display||c,d=x.css(t,"display"),dt([t]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===x.css(t,"float")&&(r||(p.done((function(){u.display=c})),null==c&&(d=u.display,c="none"===d?"":d)),u.display="inline-block")),i.overflow&&(u.overflow="hidden",p.always((function(){u.overflow=i.overflow[0],u.overflowX=i.overflow[1],u.overflowY=i.overflow[2]}))),r=!1,m)r||(f?"hidden"in f&&(g=f.hidden):f=Y.access(t,"fxshow",{display:c}),s&&(f.hidden=!g),g&&dt([t],!0),p.done((function(){for(n in g||dt([t]),Y.remove(t,"fxshow"),m)x.style(t,n,m[n])}))),r=de(g?f[n]:0,n,p),n in f||(f[n]=r.start,g&&(r.end=r.start,r.start=0))}],prefilter:function(t,e){e?he.prefilters.unshift(t):he.prefilters.push(t)}}),x.speed=function(t,e,i){var n=t&&"object"==typeof t?x.extend({},t):{complete:i||!i&&e||u(t)&&t,duration:t,easing:i&&e||e&&!u(e)&&e};return x.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in x.fx.speeds?n.duration=x.fx.speeds[n.duration]:n.duration=x.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){u(n.old)&&n.old.call(this),n.queue&&x.dequeue(this,n.queue)},n},x.fn.extend({fadeTo:function(t,e,i,n){return this.filter(at).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var o=x.isEmptyObject(t),s=x.speed(e,i,n),a=function(){var e=he(this,x.extend({},t),s);(o||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,o||!1===s.queue?this.each(a):this.queue(s.queue,a)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,o=null!=t&&t+"queueHooks",s=x.timers,a=Y.get(this);if(o)a[o]&&a[o].stop&&n(a[o]);else for(o in a)a[o]&&a[o].stop&&ae.test(o)&&n(a[o]);for(o=s.length;o--;)s[o].elem!==this||null!=t&&s[o].queue!==t||(s[o].anim.stop(i),e=!1,s.splice(o,1));!e&&i||x.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=Y.get(this),n=i[t+"queue"],o=i[t+"queueHooks"],s=x.timers,a=n?n.length:0;for(i.finish=!0,x.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<a;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish}))}}),x.each(["toggle","show","hide"],(function(t,e){var i=x.fn[e];x.fn[e]=function(t,n,o){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(ce(e,!0),t,n,o)}})),x.each({slideDown:ce("show"),slideUp:ce("hide"),slideToggle:ce("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){x.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}})),x.timers=[],x.fx.tick=function(){var t,e=0,i=x.timers;for(ne=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||x.fx.stop(),ne=void 0},x.fx.timer=function(t){x.timers.push(t),x.fx.start()},x.fx.interval=13,x.fx.start=function(){oe||(oe=!0,le())},x.fx.stop=function(){oe=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fn.delay=function(e,i){return e=x.fx&&x.fx.speeds[e]||e,i=i||"fx",this.queue(i,(function(i,n){var o=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(o)}}))},function(){var t=f.createElement("input"),e=f.createElement("select").appendChild(f.createElement("option"));t.type="checkbox",m.checkOn=""!==t.value,m.optSelected=e.selected,(t=f.createElement("input")).value="t",t.type="radio",m.radioValue="t"===t.value}();var pe,me=x.expr.attrHandle;x.fn.extend({attr:function(t,e){return $(this,x.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){x.removeAttr(this,t)}))}}),x.extend({attr:function(t,e,i){var n,o,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?x.prop(t,e,i):(1===s&&x.isXMLDoc(t)||(o=x.attrHooks[e.toLowerCase()]||(x.expr.match.bool.test(e)?pe:void 0)),void 0!==i?null===i?void x.removeAttr(t,e):o&&"set"in o&&void 0!==(n=o.set(t,i,e))?n:(t.setAttribute(e,i+""),i):o&&"get"in o&&null!==(n=o.get(t,e))?n:null==(n=x.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!m.radioValue&&"radio"===e&&T(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,o=e&&e.match(M);if(o&&1===t.nodeType)for(;i=o[n++];)t.removeAttribute(i)}}),pe={set:function(t,e,i){return!1===e?x.removeAttr(t,i):t.setAttribute(i,i),i}},x.each(x.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=me[e]||x.find.attr;me[e]=function(t,e,n){var o,s,a=e.toLowerCase();return n||(s=me[a],me[a]=o,o=null!=i(t,e,n)?a:null,me[a]=s),o}}));var ue=/^(?:input|select|textarea|button)$/i,ge=/^(?:a|area)$/i;function fe(t){return(t.match(M)||[]).join(" ")}function be(t){return t.getAttribute&&t.getAttribute("class")||""}function Ce(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(M)||[]}x.fn.extend({prop:function(t,e){return $(this,x.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[x.propFix[t]||t]}))}}),x.extend({prop:function(t,e,i){var n,o,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&x.isXMLDoc(t)||(e=x.propFix[e]||e,o=x.propHooks[e]),void 0!==i?o&&"set"in o&&void 0!==(n=o.set(t,i,e))?n:t[e]=i:o&&"get"in o&&null!==(n=o.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=x.find.attr(t,"tabindex");return e?parseInt(e,10):ue.test(t.nodeName)||ge.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(x.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){x.propFix[this.toLowerCase()]=this})),x.fn.extend({addClass:function(t){var e,i,n,o,s,a,l,r=0;if(u(t))return this.each((function(e){x(this).addClass(t.call(this,e,be(this)))}));if((e=Ce(t)).length)for(;i=this[r++];)if(o=be(i),n=1===i.nodeType&&" "+fe(o)+" "){for(a=0;s=e[a++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");o!==(l=fe(n))&&i.setAttribute("class",l)}return this},removeClass:function(t){var e,i,n,o,s,a,l,r=0;if(u(t))return this.each((function(e){x(this).removeClass(t.call(this,e,be(this)))}));if(!arguments.length)return this.attr("class","");if((e=Ce(t)).length)for(;i=this[r++];)if(o=be(i),n=1===i.nodeType&&" "+fe(o)+" "){for(a=0;s=e[a++];)for(;n.indexOf(" "+s+" ")>-1;)n=n.replace(" "+s+" "," ");o!==(l=fe(n))&&i.setAttribute("class",l)}return this},toggleClass:function(t,e){var i=typeof t,n="string"===i||Array.isArray(t);return"boolean"==typeof e&&n?e?this.addClass(t):this.removeClass(t):u(t)?this.each((function(i){x(this).toggleClass(t.call(this,i,be(this),e),e)})):this.each((function(){var e,o,s,a;if(n)for(o=0,s=x(this),a=Ce(t);e=a[o++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||((e=be(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":Y.get(this,"__className__")||""))}))},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+fe(be(i))+" ").indexOf(e)>-1)return!0;return!1}});var ve=/\r/g;x.fn.extend({val:function(t){var e,i,n,o=this[0];return arguments.length?(n=u(t),this.each((function(i){var o;1===this.nodeType&&(null==(o=n?t.call(this,i,x(this).val()):t)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=x.map(o,(function(t){return null==t?"":t+""}))),(e=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))}))):o?(e=x.valHooks[o.type]||x.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(o,"value"))?i:"string"==typeof(i=o.value)?i.replace(ve,""):null==i?"":i:void 0}}),x.extend({valHooks:{option:{get:function(t){var e=x.find.attr(t,"value");return null!=e?e:fe(x.text(t))}},select:{get:function(t){var e,i,n,o=t.options,s=t.selectedIndex,a="select-one"===t.type,l=a?null:[],r=a?s+1:o.length;for(n=s<0?r:a?s:0;n<r;n++)if(((i=o[n]).selected||n===s)&&!i.disabled&&(!i.parentNode.disabled||!T(i.parentNode,"optgroup"))){if(e=x(i).val(),a)return e;l.push(e)}return l},set:function(t,e){for(var i,n,o=t.options,s=x.makeArray(e),a=o.length;a--;)((n=o[a]).selected=x.inArray(x.valHooks.option.get(n),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),x.each(["radio","checkbox"],(function(){x.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=x.inArray(x(t).val(),e)>-1}},m.checkOn||(x.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),m.focusin="onfocusin"in t;var _e=/^(?:focusinfocus|focusoutblur)$/,xe=function(t){t.stopPropagation()};x.extend(x.event,{trigger:function(e,i,n,o){var s,a,l,r,c,h,p,m,b=[n||f],C=d.call(e,"type")?e.type:e,v=d.call(e,"namespace")?e.namespace.split("."):[];if(a=m=l=n=n||f,3!==n.nodeType&&8!==n.nodeType&&!_e.test(C+x.event.triggered)&&(C.indexOf(".")>-1&&(v=C.split("."),C=v.shift(),v.sort()),c=C.indexOf(":")<0&&"on"+C,(e=e[x.expando]?e:new x.Event(C,"object"==typeof e&&e)).isTrigger=o?2:3,e.namespace=v.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:x.makeArray(i,[e]),p=x.event.special[C]||{},o||!p.trigger||!1!==p.trigger.apply(n,i))){if(!o&&!p.noBubble&&!g(n)){for(r=p.delegateType||C,_e.test(r+C)||(a=a.parentNode);a;a=a.parentNode)b.push(a),l=a;l===(n.ownerDocument||f)&&b.push(l.defaultView||l.parentWindow||t)}for(s=0;(a=b[s++])&&!e.isPropagationStopped();)m=a,e.type=s>1?r:p.bindType||C,(h=(Y.get(a,"events")||Object.create(null))[e.type]&&Y.get(a,"handle"))&&h.apply(a,i),(h=c&&a[c])&&h.apply&&q(a)&&(e.result=h.apply(a,i),!1===e.result&&e.preventDefault());return e.type=C,o||e.isDefaultPrevented()||p._default&&!1!==p._default.apply(b.pop(),i)||!q(n)||c&&u(n[C])&&!g(n)&&((l=n[c])&&(n[c]=null),x.event.triggered=C,e.isPropagationStopped()&&m.addEventListener(C,xe),n[C](),e.isPropagationStopped()&&m.removeEventListener(C,xe),x.event.triggered=void 0,l&&(n[c]=l)),e.result}},simulate:function(t,e,i){var n=x.extend(new x.Event,i,{type:t,isSimulated:!0});x.event.trigger(n,null,e)}}),x.fn.extend({trigger:function(t,e){return this.each((function(){x.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return x.event.trigger(t,e,i,!0)}}),m.focusin||x.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=function(t){x.event.simulate(e,t.target,x.event.fix(t))};x.event.special[e]={setup:function(){var n=this.ownerDocument||this.document||this,o=Y.access(n,e);o||n.addEventListener(t,i,!0),Y.access(n,e,(o||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,o=Y.access(n,e)-1;o?Y.access(n,e,o):(n.removeEventListener(t,i,!0),Y.remove(n,e))}}}));var ye=t.location,we={guid:Date.now()},Se=/\?/;x.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+e),i};var Ae=/\[\]$/,ke=/\r?\n/g,Te=/^(?:submit|button|image|reset|file)$/i,Ie=/^(?:input|select|textarea|keygen)/i;function Ee(t,e,i,n){var o;if(Array.isArray(e))x.each(e,(function(e,o){i||Ae.test(t)?n(t,o):Ee(t+"["+("object"==typeof o&&null!=o?e:"")+"]",o,i,n)}));else if(i||"object"!==v(e))n(t,e);else for(o in e)Ee(t+"["+o+"]",e[o],i,n)}x.param=function(t,e){var i,n=[],o=function(t,e){var i=u(e)?e():e;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!x.isPlainObject(t))x.each(t,(function(){o(this.name,this.value)}));else for(i in t)Ee(i,t[i],e,o);return n.join("&")},x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=x.prop(this,"elements");return t?x.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!x(this).is(":disabled")&&Ie.test(this.nodeName)&&!Te.test(t)&&(this.checked||!mt.test(t))})).map((function(t,e){var i=x(this).val();return null==i?null:Array.isArray(i)?x.map(i,(function(t){return{name:e.name,value:t.replace(ke,"\r\n")}})):{name:e.name,value:i.replace(ke,"\r\n")}})).get()}});var De=/%20/g,Pe=/#.*$/,Fe=/([?&])_=[^&]*/,Re=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ve=/^(?:GET|HEAD)$/,Me=/^\/\//,Ue={},Le={},Be="*/".concat("*"),Oe=f.createElement("a");function Ne(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,o=0,s=e.toLowerCase().match(M)||[];if(u(i))for(;n=s[o++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function He(t,e,i,n){var o={},s=t===Le;function a(l){var r;return o[l]=!0,x.each(t[l]||[],(function(t,l){var c=l(e,i,n);return"string"!=typeof c||s||o[c]?s?!(r=c):void 0:(e.dataTypes.unshift(c),a(c),!1)})),r}return a(e.dataTypes[0])||!o["*"]&&a("*")}function $e(t,e){var i,n,o=x.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((o[i]?t:n||(n={}))[i]=e[i]);return n&&x.extend(!0,t,n),t}Oe.href=ye.href,x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ye.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ye.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Be,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?$e($e(t,x.ajaxSettings),e):$e(x.ajaxSettings,t)},ajaxPrefilter:Ne(Ue),ajaxTransport:Ne(Le),ajax:function(e,i){"object"==typeof e&&(i=e,e=void 0),i=i||{};var n,o,s,a,l,r,c,d,h,p,m=x.ajaxSetup({},i),u=m.context||m,g=m.context&&(u.nodeType||u.jquery)?x(u):x.event,b=x.Deferred(),C=x.Callbacks("once memory"),v=m.statusCode||{},_={},y={},w="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(c){if(!a)for(a={};e=Re.exec(s);)a[e[1].toLowerCase()+" "]=(a[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=a[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?s:null},setRequestHeader:function(t,e){return null==c&&(t=y[t.toLowerCase()]=y[t.toLowerCase()]||t,_[t]=e),this},overrideMimeType:function(t){return null==c&&(m.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)S.always(t[S.status]);else for(e in t)v[e]=[v[e],t[e]];return this},abort:function(t){var e=t||w;return n&&n.abort(e),A(0,e),this}};if(b.promise(S),m.url=((e||m.url||ye.href)+"").replace(Me,ye.protocol+"//"),m.type=i.method||i.type||m.method||m.type,m.dataTypes=(m.dataType||"*").toLowerCase().match(M)||[""],null==m.crossDomain){r=f.createElement("a");try{r.href=m.url,r.href=r.href,m.crossDomain=Oe.protocol+"//"+Oe.host!=r.protocol+"//"+r.host}catch(t){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=x.param(m.data,m.traditional)),He(Ue,m,i,S),c)return S;for(h in(d=x.event&&m.global)&&0==x.active++&&x.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Ve.test(m.type),o=m.url.replace(Pe,""),m.hasContent?m.data&&m.processData&&0===(m.contentType||"").indexOf("application/x-www-form-urlencoded")&&(m.data=m.data.replace(De,"+")):(p=m.url.slice(o.length),m.data&&(m.processData||"string"==typeof m.data)&&(o+=(Se.test(o)?"&":"?")+m.data,delete m.data),!1===m.cache&&(o=o.replace(Fe,"$1"),p=(Se.test(o)?"&":"?")+"_="+we.guid+++p),m.url=o+p),m.ifModified&&(x.lastModified[o]&&S.setRequestHeader("If-Modified-Since",x.lastModified[o]),x.etag[o]&&S.setRequestHeader("If-None-Match",x.etag[o])),(m.data&&m.hasContent&&!1!==m.contentType||i.contentType)&&S.setRequestHeader("Content-Type",m.contentType),S.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Be+"; q=0.01":""):m.accepts["*"]),m.headers)S.setRequestHeader(h,m.headers[h]);if(m.beforeSend&&(!1===m.beforeSend.call(u,S,m)||c))return S.abort();if(w="abort",C.add(m.complete),S.done(m.success),S.fail(m.error),n=He(Le,m,i,S)){if(S.readyState=1,d&&g.trigger("ajaxSend",[S,m]),c)return S;m.async&&m.timeout>0&&(l=t.setTimeout((function(){S.abort("timeout")}),m.timeout));try{c=!1,n.send(_,A)}catch(t){if(c)throw t;A(-1,t)}}else A(-1,"No Transport");function A(e,i,a,r){var h,p,f,_,y,w=i;c||(c=!0,l&&t.clearTimeout(l),n=void 0,s=r||"",S.readyState=e>0?4:0,h=e>=200&&e<300||304===e,a&&(_=function(t,e,i){for(var n,o,s,a,l=t.contents,r=t.dataTypes;"*"===r[0];)r.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(o in l)if(l[o]&&l[o].test(n)){r.unshift(o);break}if(r[0]in i)s=r[0];else{for(o in i){if(!r[0]||t.converters[o+" "+r[0]]){s=o;break}a||(a=o)}s=s||a}if(s)return s!==r[0]&&r.unshift(s),i[s]}(m,S,a)),!h&&x.inArray("script",m.dataTypes)>-1&&(m.converters["text script"]=function(){}),_=function(t,e,i,n){var o,s,a,l,r,c={},d=t.dataTypes.slice();if(d[1])for(a in t.converters)c[a.toLowerCase()]=t.converters[a];for(s=d.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!r&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),r=s,s=d.shift())if("*"===s)s=r;else if("*"!==r&&r!==s){if(!(a=c[r+" "+s]||c["* "+s]))for(o in c)if((l=o.split(" "))[1]===s&&(a=c[r+" "+l[0]]||c["* "+l[0]])){!0===a?a=c[o]:!0!==c[o]&&(s=l[0],d.unshift(l[1]));break}if(!0!==a)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+r+" to "+s}}}return{state:"success",data:e}}(m,_,S,h),h?(m.ifModified&&((y=S.getResponseHeader("Last-Modified"))&&(x.lastModified[o]=y),(y=S.getResponseHeader("etag"))&&(x.etag[o]=y)),204===e||"HEAD"===m.type?w="nocontent":304===e?w="notmodified":(w=_.state,p=_.data,h=!(f=_.error))):(f=w,!e&&w||(w="error",e<0&&(e=0))),S.status=e,S.statusText=(i||w)+"",h?b.resolveWith(u,[p,w,S]):b.rejectWith(u,[S,w,f]),S.statusCode(v),v=void 0,d&&g.trigger(h?"ajaxSuccess":"ajaxError",[S,m,h?p:f]),C.fireWith(u,[S,w]),d&&(g.trigger("ajaxComplete",[S,m]),--x.active||x.event.trigger("ajaxStop")))}return S},getJSON:function(t,e,i){return x.get(t,e,i,"json")},getScript:function(t,e){return x.get(t,void 0,e,"script")}}),x.each(["get","post"],(function(t,e){x[e]=function(t,i,n,o){return u(i)&&(o=o||n,n=i,i=void 0),x.ajax(x.extend({url:t,type:e,dataType:o,data:i,success:n},x.isPlainObject(t)&&t))}})),x.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),x._evalUrl=function(t,e,i){return x.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){x.globalEval(t,e,i)}})},x.fn.extend({wrapAll:function(t){var e;return this[0]&&(u(t)&&(t=t.call(this[0])),e=x(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return u(t)?this.each((function(e){x(this).wrapInner(t.call(this,e))})):this.each((function(){var e=x(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=u(t);return this.each((function(i){x(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){x(this).replaceWith(this.childNodes)})),this}}),x.expr.pseudos.hidden=function(t){return!x.expr.pseudos.visible(t)},x.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},x.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Ge={0:200,1223:204},ze=x.ajaxSettings.xhr();m.cors=!!ze&&"withCredentials"in ze,m.ajax=ze=!!ze,x.ajaxTransport((function(e){var i,n;if(m.cors||ze&&!e.crossDomain)return{send:function(o,s){var a,l=e.xhr();if(l.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)l[a]=e.xhrFields[a];for(a in e.mimeType&&l.overrideMimeType&&l.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)l.setRequestHeader(a,o[a]);i=function(t){return function(){i&&(i=n=l.onload=l.onerror=l.onabort=l.ontimeout=l.onreadystatechange=null,"abort"===t?l.abort():"error"===t?"number"!=typeof l.status?s(0,"error"):s(l.status,l.statusText):s(Ge[l.status]||l.status,l.statusText,"text"!==(l.responseType||"text")||"string"!=typeof l.responseText?{binary:l.response}:{text:l.responseText},l.getAllResponseHeaders()))}},l.onload=i(),n=l.onerror=l.ontimeout=i("error"),void 0!==l.onabort?l.onabort=n:l.onreadystatechange=function(){4===l.readyState&&t.setTimeout((function(){i&&n()}))},i=i("abort");try{l.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}})),x.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return x.globalEval(t),t}}}),x.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),x.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(n,o){e=x("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&o("error"===t.type?404:200,t.type)}),f.head.appendChild(e[0])},abort:function(){i&&i()}}}));var We,je=[],qe=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=je.pop()||x.expando+"_"+we.guid++;return this[t]=!0,t}}),x.ajaxPrefilter("json jsonp",(function(e,i,n){var o,s,a,l=!1!==e.jsonp&&(qe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qe.test(e.data)&&"data");if(l||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=u(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,l?e[l]=e[l].replace(qe,"$1"+o):!1!==e.jsonp&&(e.url+=(Se.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return a||x.error(o+" was not called"),a[0]},e.dataTypes[0]="json",s=t[o],t[o]=function(){a=arguments},n.always((function(){void 0===s?x(t).removeProp(o):t[o]=s,e[o]&&(e.jsonpCallback=i.jsonpCallback,je.push(o)),a&&u(s)&&s(a[0]),a=s=void 0})),"script"})),m.createHTMLDocument=((We=f.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===We.childNodes.length),x.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(m.createHTMLDocument?((n=(e=f.implementation.createHTMLDocument("")).createElement("base")).href=f.location.href,e.head.appendChild(n)):e=f),s=!i&&[],(o=I.exec(t))?[e.createElement(o[1])]:(o=_t([t],e,s),s&&s.length&&x(s).remove(),x.merge([],o.childNodes)));var n,o,s},x.fn.load=function(t,e,i){var n,o,s,a=this,l=t.indexOf(" ");return l>-1&&(n=fe(t.slice(l)),t=t.slice(0,l)),u(e)?(i=e,e=void 0):e&&"object"==typeof e&&(o="POST"),a.length>0&&x.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done((function(t){s=arguments,a.html(n?x("<div>").append(x.parseHTML(t)).find(n):t)})).always(i&&function(t,e){a.each((function(){i.apply(this,s||[t.responseText,e,t])}))}),this},x.expr.pseudos.animated=function(t){return x.grep(x.timers,(function(e){return t===e.elem})).length},x.offset={setOffset:function(t,e,i){var n,o,s,a,l,r,c=x.css(t,"position"),d=x(t),h={};"static"===c&&(t.style.position="relative"),l=d.offset(),s=x.css(t,"top"),r=x.css(t,"left"),("absolute"===c||"fixed"===c)&&(s+r).indexOf("auto")>-1?(a=(n=d.position()).top,o=n.left):(a=parseFloat(s)||0,o=parseFloat(r)||0),u(e)&&(e=e.call(t,i,x.extend({},l))),null!=e.top&&(h.top=e.top-l.top+a),null!=e.left&&(h.left=e.left-l.left+o),"using"in e?e.using.call(t,h):("number"==typeof h.top&&(h.top+="px"),"number"==typeof h.left&&(h.left+="px"),d.css(h))}},x.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){x.offset.setOffset(this,t,e)}));var e,i,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,n=this[0],o={top:0,left:0};if("fixed"===x.css(n,"position"))e=n.getBoundingClientRect();else{for(e=this.offset(),i=n.ownerDocument,t=n.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===x.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&((o=x(t).offset()).top+=x.css(t,"borderTopWidth",!0),o.left+=x.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-x.css(n,"marginTop",!0),left:e.left-o.left-x.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===x.css(t,"position");)t=t.offsetParent;return t||nt}))}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;x.fn[t]=function(n){return $(this,(function(t,n,o){var s;if(g(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===o)return s?s[e]:t[n];s?s.scrollTo(i?s.pageXOffset:o,i?o:s.pageYOffset):t[n]=o}),t,n,arguments.length)}})),x.each(["top","left"],(function(t,e){x.cssHooks[e]=zt(m.pixelPosition,(function(t,i){if(i)return i=Gt(t,e),Ot.test(i)?x(t).position()[e]+"px":i}))})),x.each({Height:"height",Width:"width"},(function(t,e){x.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,n){x.fn[n]=function(o,s){var a=arguments.length&&(i||"boolean"!=typeof o),l=i||(!0===o||!0===s?"margin":"border");return $(this,(function(e,i,o){var s;return g(e)?0===n.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===o?x.css(e,i,l):x.style(e,i,o,l)}),e,a?o:void 0,a)}}))})),x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){x.fn[e]=function(t){return this.on(e,t)}})),x.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),x.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){x.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var Ke=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;x.proxy=function(t,e){var i,n,s;if("string"==typeof e&&(i=t[e],e=t,t=i),u(t))return n=o.call(arguments,2),s=function(){return t.apply(e||this,n.concat(o.call(arguments)))},s.guid=t.guid=t.guid||x.guid++,s},x.holdReady=function(t){t?x.readyWait++:x.ready(!0)},x.isArray=Array.isArray,x.parseJSON=JSON.parse,x.nodeName=T,x.isFunction=u,x.isWindow=g,x.camelCase=j,x.type=v,x.now=Date.now,x.isNumeric=function(t){var e=x.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},x.trim=function(t){return null==t?"":(t+"").replace(Ke,"")},"function"==typeof define&&define.amd&&define("jquery",[],(function(){return x}));var Ye=t.jQuery,Xe=t.$;return x.noConflict=function(e){return t.$===x&&(t.$=Xe),e&&t.jQuery===x&&(t.jQuery=Ye),x},void 0===e&&(t.jQuery=t.$=x),x})),function(){var t,e=this,i=e.Backbone,n=[],o=n.slice;(t="undefined"!=typeof exports?exports:e.Backbone={}).VERSION="1.1.0";var s=e._;s||"undefined"==typeof require||(s=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(t,e,i){return r(this,"on",t,[e,i])&&e?(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:i,ctx:i||this}),this):this},once:function(t,e,i){if(!r(this,"once",t,[e,i])||!e)return this;var n=this,o=s.once((function(){n.off(t,o),e.apply(this,arguments)}));return o._callback=e,this.on(t,o,i)},off:function(t,e,i){var n,o,a,l,c,d,h,p;if(!this._events||!r(this,"off",t,[e,i]))return this;if(!t&&!e&&!i)return this._events={},this;for(c=0,d=(l=t?[t]:s.keys(this._events)).length;c<d;c++)if(t=l[c],a=this._events[t]){if(this._events[t]=n=[],e||i)for(h=0,p=a.length;h<p;h++)o=a[h],(e&&e!==o.callback&&e!==o.callback._callback||i&&i!==o.context)&&n.push(o);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=o.call(arguments,1);if(!r(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&c(i,e),n&&c(n,arguments),this},stopListening:function(t,e,i){var n=this._listeningTo;if(!n)return this;var o=!e&&!i;for(var a in i||"object"!=typeof e||(i=this),t&&((n={})[t._listenId]=t),n)(t=n[a]).off(e,i,this),(o||s.isEmpty(t._events))&&delete this._listeningTo[a];return this}},l=/\s+/,r=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var o in i)t[e].apply(t,[o,i[o]].concat(n));return!1}if(l.test(i)){for(var s=i.split(l),a=0,r=s.length;a<r;a++)t[e].apply(t,[s[a]].concat(n));return!1}return!0},c=function(t,e){var i,n=-1,o=t.length,s=e[0],a=e[1],l=e[2];switch(e.length){case 0:for(;++n<o;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<o;)(i=t[n]).callback.call(i.ctx,s,a);return;case 3:for(;++n<o;)(i=t[n]).callback.call(i.ctx,s,a,l);return;default:for(;++n<o;)(i=t[n]).callback.apply(i.ctx,e)}};s.each({listenTo:"on",listenToOnce:"once"},(function(t,e){a[e]=function(e,i,n){return(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=s.uniqueId("l"))]=e,n||"object"!=typeof i||(n=this),e[t](i,n,this),this}})),a.bind=a.on,a.unbind=a.off,s.extend(t,a);var d=t.Model=function(t,e){var i=t||{};e||(e={}),this.cid=s.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{}),i=s.defaults({},i,s.result(this,"defaults")),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};s.extend(d.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return s.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return s.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,o,a,l,r,c,d,h;if(null==t)return this;if("object"==typeof t?(o=t,i=e):(o={})[t]=e,i||(i={}),!this._validate(o,i))return!1;for(n in a=i.unset,r=i.silent,l=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=s.clone(this.attributes),this.changed={}),h=this.attributes,d=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o)e=o[n],s.isEqual(h[n],e)||l.push(n),s.isEqual(d[n],e)?delete this.changed[n]:this.changed[n]=e,a?delete h[n]:h[n]=e;if(!r){l.length&&(this._pending=!0);for(var p=0,m=l.length;p<m;p++)this.trigger("change:"+l[p],this,h[l[p]],i)}if(c)return this;if(!r)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,s.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,s.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!s.isEmpty(this.changed):s.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&s.clone(this.changed);var e,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var o in t)s.isEqual(n[o],e=t[o])||((i||(i={}))[o]=e);return i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?s.clone(t):{}).parse&&(t.parse=!0);var e=this,i=t.success;return t.success=function(n){if(!e.set(e.parse(n,t),t))return!1;i&&i(e,n,t),e.trigger("sync",e,n,t)},P(this,t),this.sync("read",this,t)},save:function(t,e,i){var n,o,a,l=this.attributes;if(null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e,i=s.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=s.extend({},l,n)),void 0===i.parse&&(i.parse=!0);var r=this,c=i.success;return i.success=function(t){r.attributes=l;var e=r.parse(t,i);if(i.wait&&(e=s.extend(n||{},e)),s.isObject(e)&&!r.set(e,i))return!1;c&&c(r,t,i),r.trigger("sync",r,t,i)},P(this,i),"patch"===(o=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=n),a=this.sync(o,this,i),n&&i.wait&&(this.attributes=l),a},destroy:function(t){t=t?s.clone(t):{};var e=this,i=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(o){(t.wait||e.isNew())&&n(),i&&i(e,o,t),e.isNew()||e.trigger("sync",e,o,t)},this.isNew())return t.success(),!1;P(this,t);var o=this.sync("delete",this,t);return t.wait||n(),o},url:function(){var t=s.result(this,"urlRoot")||s.result(this.collection,"url")||D();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},s.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=s.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,s.extend(e,{validationError:i})),!1)}});s.each(["keys","values","pairs","invert","pick","omit"],(function(t){d.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.attributes),s[t].apply(s,e)}}));var h=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,s.extend({silent:!0},e))},p={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};s.extend(h.prototype,a,{model:d,initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,s.extend({merge:!1},e,m))},remove:function(t,e){var i,n,o,a,l=!s.isArray(t);for(e||(e={}),i=0,n=(t=l?[t]:s.clone(t)).length;i<n;i++)(a=t[i]=this.get(t[i]))&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,e.silent||(e.index=o,a.trigger("remove",a,this,e)),this._removeReference(a));return l?t[0]:t},set:function(t,e){(e=s.defaults({},e,p)).parse&&(t=this.parse(t,e));var i,n,o,a,l,r,c,h=!s.isArray(t);t=h?t?[t]:[]:s.clone(t);var m=e.at,u=this.model,g=this.comparator&&null==m&&!1!==e.sort,f=s.isString(this.comparator)?this.comparator:null,b=[],C=[],v={},_=e.add,x=e.merge,y=e.remove,w=!(g||!_||!y)&&[];for(i=0,n=t.length;i<n;i++){if(o=(l=t[i])instanceof d?a=l:l[u.prototype.idAttribute],r=this.get(o))y&&(v[r.cid]=!0),x&&(l=l===a?a.attributes:l,e.parse&&(l=r.parse(l,e)),r.set(l,e),g&&!c&&r.hasChanged(f)&&(c=!0)),t[i]=r;else if(_){if(!(a=t[i]=this._prepareModel(l,e)))continue;b.push(a),a.on("all",this._onModelEvent,this),this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a)}w&&w.push(r||a)}if(y){for(i=0,n=this.length;i<n;++i)v[(a=this.models[i]).cid]||C.push(a);C.length&&this.remove(C,e)}if(b.length||w&&w.length)if(g&&(c=!0),this.length+=b.length,null!=m)for(i=0,n=b.length;i<n;i++)this.models.splice(m+i,0,b[i]);else{w&&(this.models.length=0);var S=w||b;for(i=0,n=S.length;i<n;i++)this.models.push(S[i])}if(c&&this.sort({silent:!0}),!e.silent){for(i=0,n=b.length;i<n;i++)(a=b[i]).trigger("add",a,this,e);(c||w&&w.length)&&this.trigger("sort",this,e)}return h?t[0]:t},reset:function(t,e){e||(e={});for(var i=0,n=this.models.length;i<n;i++)this._removeReference(this.models[i]);return e.previousModels=this.models,this._reset(),t=this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,s.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,s.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,e){return s.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"]((function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0}))},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return s.invoke(this.models,"get",t)},fetch:function(t){void 0===(t=t?s.clone(t):{}).parse&&(t.parse=!0);var e=t.success,i=this;return t.success=function(n){var o=t.reset?"reset":"set";i[o](n,t),e&&e(i,n,t),i.trigger("sync",i,n,t)},P(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?s.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var i=this,n=e.success;return e.success=function(t,e,o){o.wait&&i.add(t,o),n&&n(t,e,o)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof d)return t.collection||(t.collection=this),t;(e=e?s.clone(e):{}).collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});s.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"],(function(t){h.prototype[t]=function(){var e=o.call(arguments);return e.unshift(this.models),s[t].apply(s,e)}}));s.each(["groupBy","countBy","sortBy"],(function(t){h.prototype[t]=function(e,i){var n=s.isFunction(e)?e:function(t){return t.get(e)};return s[t](this.models,n,i)}}));var u=t.View=function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,f)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},g=/^(\S+)\s*(.*)$/,f=["model","collection","el","id","attributes","className","tagName","events"];s.extend(u.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=s.result(this,"events")))return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(s.isFunction(i)||(i=this[t[e]]),i){var n=e.match(g),o=n[1],a=n[2];i=s.bind(i,this),o+=".delegateEvents"+this.cid,""===a?this.$el.on(o,i):this.$el.on(o,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var e=s.extend({},s.result(this,"attributes"));this.id&&(e.id=s.result(this,"id")),this.className&&(e.class=s.result(this,"className"));var i=t.$("<"+s.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,n){var o=C[e];s.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:o,dataType:"json"};if(n.url||(a.url=s.result(i,"url")||D()),null!=n.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),n.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){a.type="POST",n.emulateJSON&&(a.data._method=o);var l=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",o),l)return l.apply(this,arguments)}}"GET"===a.type||n.emulateJSON||(a.processData=!1),"PATCH"===a.type&&b&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var r=n.xhr=t.ajax(s.extend(a,n));return i.trigger("request",i,r,n),r};var b=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),C={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var v=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},_=/\((.*?)\)/g,x=/(\(\?)?:\w+/g,y=/\*\w+/g,w=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(v.prototype,a,{initialize:function(){},route:function(e,i,n){s.isRegExp(e)||(e=this._routeToRegExp(e)),s.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var o=this;return t.history.route(e,(function(s){var a=o._extractParameters(e,s);n&&n.apply(o,a),o.trigger.apply(o,["route:"+i].concat(a)),o.trigger("route",i,a),t.history.trigger("route",o,i,a)})),this},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var t,e=s.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(w,"\\$&").replace(_,"(?:$1)?").replace(x,(function(t,e){return e?t:"([^/]+)"})).replace(y,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return s.map(i,(function(t){return t?decodeURIComponent(t):null}))}});var S=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,k=/^\/+|\/+$/g,T=/msie [\w.]+/,I=/\/$/,E=/[?#].*$/;S.started=!1,s.extend(S.prototype,a,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(I,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(A,"")},start:function(e){if(S.started)throw new Error("Backbone.history has already been started");S.started=!0,this.options=s.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),n=document.documentMode,o=T.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(k,"/"),o&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var a=this.location,l=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!l)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&l&&a.hash&&(this.fragment=this.getHash().replace(A,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),S.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),s.any(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!S.started)return!1;e&&!0!==e||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(E,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),t.history=new S;d.extend=h.extend=v.extend=u.extend=S.extend=function(t,e){var i,n=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},s.extend(i,n,e);var o=function(){this.constructor=i};return o.prototype=n.prototype,i.prototype=new o,t&&s.extend(i.prototype,t),i.__super__=n.prototype,i};var D=function(){throw new Error('A "url" property or function must be specified')},P=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}}}.call(this),define("backbone",["underscore","jquery"],function(t){return function(){return t.Backbone}}(this)),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");if(function(t){"use strict";var e=jQuery.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(t){"use strict";t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one("bsTransitionEnd",(function(){i=!0}));return setTimeout((function(){i||t(n).trigger(t.support.transition.end)}),e),this},t((function(){t.support.transition=function(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})}))}(jQuery),function(t){"use strict";var e='[data-dismiss="alert"]',i=function(i){t(i).on("click",e,this.close)};i.VERSION="3.4.1",i.TRANSITION_DURATION=150,i.prototype.close=function(e){var n=t(this),o=n.attr("data-target");o||(o=(o=n.attr("href"))&&o.replace(/.*(?=#[^\s]*$)/,"")),o="#"===o?[]:o;var s=t(document).find(o);function a(){s.detach().trigger("closed.bs.alert").remove()}e&&e.preventDefault(),s.length||(s=n.closest(".alert")),s.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(s.removeClass("in"),t.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",a).emulateTransitionEnd(i.TRANSITION_DURATION):a())};var n=t.fn.alert;t.fn.alert=function(e){return this.each((function(){var n=t(this),o=n.data("bs.alert");o||n.data("bs.alert",o=new i(this)),"string"==typeof e&&o[e].call(n)}))},t.fn.alert.Constructor=i,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",e,i.prototype.close)}(jQuery),function(t){"use strict";var e=function(i,n){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,n),this.isLoading=!1};function i(i){return this.each((function(){var n=t(this),o=n.data("bs.button"),s="object"==typeof i&&i;o||n.data("bs.button",o=new e(this,s)),"toggle"==i?o.toggle():i&&o.setState(i)}))}e.VERSION="3.4.1",e.DEFAULTS={loadingText:"loading..."},e.prototype.setState=function(e){var i="disabled",n=this.$element,o=n.is("input")?"val":"html",s=n.data();e+="Text",null==s.resetText&&n.data("resetText",n[o]()),setTimeout(t.proxy((function(){n[o](null==s[e]?this.options[e]:s[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i).prop(i,!0)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i).prop(i,!1))}),this),0)},e.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=i,t.fn.button.Constructor=e,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',(function(e){var n=t(e.target).closest(".btn");i.call(n,"toggle"),t(e.target).is('input[type="radio"], input[type="checkbox"]')||(e.preventDefault(),n.is("input,button")?n.trigger("focus"):n.find("input:visible,button:visible").first().trigger("focus"))})).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',(function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))}))}(jQuery),function(t){"use strict";var e=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};function i(i){return this.each((function(){var n=t(this),o=n.data("bs.carousel"),s=t.extend({},e.DEFAULTS,n.data(),"object"==typeof i&&i),a="string"==typeof i?i:s.slide;o||n.data("bs.carousel",o=new e(this,s)),"number"==typeof i?o.to(i):a?o[a]():s.interval&&o.pause().cycle()}))}e.VERSION="3.4.1",e.TRANSITION_DURATION=600,e.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},e.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},e.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},e.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},e.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e);if(("prev"==t&&0===i||"next"==t&&i==this.$items.length-1)&&!this.options.wrap)return e;var n=(i+("prev"==t?-1:1))%this.$items.length;return this.$items.eq(n)},e.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",(function(){e.to(t)})):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},e.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},e.prototype.next=function(){if(!this.sliding)return this.slide("next")},e.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},e.prototype.slide=function(i,n){var o=this.$element.find(".item.active"),s=n||this.getItemForDirection(i,o),a=this.interval,l="next"==i?"left":"right",r=this;if(s.hasClass("active"))return this.sliding=!1;var c=s[0],d=t.Event("slide.bs.carousel",{relatedTarget:c,direction:l});if(this.$element.trigger(d),!d.isDefaultPrevented()){if(this.sliding=!0,a&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var h=t(this.$indicators.children()[this.getItemIndex(s)]);h&&h.addClass("active")}var p=t.Event("slid.bs.carousel",{relatedTarget:c,direction:l});return t.support.transition&&this.$element.hasClass("slide")?(s.addClass(i),"object"==typeof s&&s.length&&s[0].offsetWidth,o.addClass(l),s.addClass(l),o.one("bsTransitionEnd",(function(){s.removeClass([i,l].join(" ")).addClass("active"),o.removeClass(["active",l].join(" ")),r.sliding=!1,setTimeout((function(){r.$element.trigger(p)}),0)})).emulateTransitionEnd(e.TRANSITION_DURATION)):(o.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(p)),a&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=i,t.fn.carousel.Constructor=e,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var o=function(e){var n=t(this),o=n.attr("href");o&&(o=o.replace(/.*(?=#[^\s]+$)/,""));var s=n.attr("data-target")||o,a=t(document).find(s);if(a.hasClass("carousel")){var l=t.extend({},a.data(),n.data()),r=n.attr("data-slide-to");r&&(l.interval=!1),i.call(a,l),r&&a.data("bs.carousel").to(r),e.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",o).on("click.bs.carousel.data-api","[data-slide-to]",o),t(window).on("load",(function(){t('[data-ride="carousel"]').each((function(){var e=t(this);i.call(e,e.data())}))}))}(jQuery),function(t){"use strict";var e=function(i,n){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,n),this.$trigger=t('[data-toggle="collapse"][href="#'+i.id+'"],[data-toggle="collapse"][data-target="#'+i.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};function i(e){var i,n=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(document).find(n)}function n(i){return this.each((function(){var n=t(this),o=n.data("bs.collapse"),s=t.extend({},e.DEFAULTS,n.data(),"object"==typeof i&&i);!o&&s.toggle&&/show|hide/.test(i)&&(s.toggle=!1),o||n.data("bs.collapse",o=new e(this,s)),"string"==typeof i&&o[i]()}))}e.VERSION="3.4.1",e.TRANSITION_DURATION=350,e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var i,o=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(o&&o.length&&(i=o.data("bs.collapse"))&&i.transitioning)){var s=t.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){o&&o.length&&(n.call(o,"hide"),i||o.data("bs.collapse",null));var a=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[a](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var l=function(){this.$element.removeClass("collapsing").addClass("collapse in")[a](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return l.call(this);var r=t.camelCase(["scroll",a].join("-"));this.$element.one("bsTransitionEnd",t.proxy(l,this)).emulateTransitionEnd(e.TRANSITION_DURATION)[a](this.$element[0][r])}}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var i=t.Event("hide.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var o=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!t.support.transition)return o.call(this);this.$element[n](0).one("bsTransitionEnd",t.proxy(o,this)).emulateTransitionEnd(e.TRANSITION_DURATION)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},e.prototype.getParent=function(){return t(document).find(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy((function(e,n){var o=t(n);this.addAriaAndCollapsedClass(i(o),o)}),this)).end()},e.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var o=t.fn.collapse;t.fn.collapse=n,t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=o,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',(function(e){var o=t(this);o.attr("data-target")||e.preventDefault();var s=i(o),a=s.data("bs.collapse")?"toggle":o.data();n.call(s,a)}))}(jQuery),function(t){"use strict";var e='[data-toggle="dropdown"]',i=function(e){t(e).on("click.bs.dropdown",this.toggle)};function n(e){var i=e.attr("data-target");i||(i=(i=e.attr("href"))&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n="#"!==i?t(document).find(i):null;return n&&n.length?n:e.parent()}function o(i){i&&3===i.which||(t(".dropdown-backdrop").remove(),t(e).each((function(){var e=t(this),o=n(e),s={relatedTarget:this};o.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(o[0],i.target)||(o.trigger(i=t.Event("hide.bs.dropdown",s)),i.isDefaultPrevented()||(e.attr("aria-expanded","false"),o.removeClass("open").trigger(t.Event("hidden.bs.dropdown",s)))))})))}i.VERSION="3.4.1",i.prototype.toggle=function(e){var i=t(this);if(!i.is(".disabled, :disabled")){var s=n(i),a=s.hasClass("open");if(o(),!a){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",o);var l={relatedTarget:this};if(s.trigger(e=t.Event("show.bs.dropdown",l)),e.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger(t.Event("shown.bs.dropdown",l))}return!1}},i.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var o=t(this);if(i.preventDefault(),i.stopPropagation(),!o.is(".disabled, :disabled")){var s=n(o),a=s.hasClass("open");if(!a&&27!=i.which||a&&27==i.which)return 27==i.which&&s.find(e).trigger("focus"),o.trigger("click");var l=s.find(".dropdown-menu li:not(.disabled):visible a");if(l.length){var r=l.index(i.target);38==i.which&&r>0&&r--,40==i.which&&r<l.length-1&&r++,~r||(r=0),l.eq(r).trigger("focus")}}}};var s=t.fn.dropdown;t.fn.dropdown=function(e){return this.each((function(){var n=t(this),o=n.data("bs.dropdown");o||n.data("bs.dropdown",o=new i(this)),"string"==typeof e&&o[e].call(n)}))},t.fn.dropdown.Constructor=i,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=s,this},t(document).on("click.bs.dropdown.data-api",o).on("click.bs.dropdown.data-api",".dropdown form",(function(t){t.stopPropagation()})).on("click.bs.dropdown.data-api",e,i.prototype.toggle).on("keydown.bs.dropdown.data-api",e,i.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",i.prototype.keydown)}(jQuery),function(t){"use strict";var e=function(e,i){this.options=i,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.fixedContent=".navbar-fixed-top, .navbar-fixed-bottom",this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy((function(){this.$element.trigger("loaded.bs.modal")}),this))};function i(i,n){return this.each((function(){var o=t(this),s=o.data("bs.modal"),a=t.extend({},e.DEFAULTS,o.data(),"object"==typeof i&&i);s||o.data("bs.modal",s=new e(this,a)),"string"==typeof i?s[i](n):a.show&&s.show(n)}))}e.VERSION="3.4.1",e.TRANSITION_DURATION=300,e.BACKDROP_TRANSITION_DURATION=150,e.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},e.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},e.prototype.show=function(i){var n=this,o=t.Event("show.bs.modal",{relatedTarget:i});this.$element.trigger(o),this.isShown||o.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",(function(){n.$element.one("mouseup.dismiss.bs.modal",(function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)}))})),this.backdrop((function(){var o=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),o&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var s=t.Event("shown.bs.modal",{relatedTarget:i});o?n.$dialog.one("bsTransitionEnd",(function(){n.$element.trigger("focus").trigger(s)})).emulateTransitionEnd(e.TRANSITION_DURATION):n.$element.trigger("focus").trigger(s)})))},e.prototype.hide=function(i){i&&i.preventDefault(),i=t.Event("hide.bs.modal"),this.$element.trigger(i),this.isShown&&!i.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(e.TRANSITION_DURATION):this.hideModal())},e.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy((function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")}),this))},e.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy((function(t){27==t.which&&this.hide()}),this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},e.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},e.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop((function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")}))},e.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},e.prototype.backdrop=function(i){var n=this,o=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=t.support.transition&&o;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+o).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy((function(t){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())}),this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!i)return;s?this.$backdrop.one("bsTransitionEnd",i).emulateTransitionEnd(e.BACKDROP_TRANSITION_DURATION):i()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var a=function(){n.removeBackdrop(),i&&i()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",a).emulateTransitionEnd(e.BACKDROP_TRANSITION_DURATION):a()}else i&&i()},e.prototype.handleUpdate=function(){this.adjustDialog()},e.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},e.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},e.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},e.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";var i=this.scrollbarWidth;this.bodyIsOverflowing&&(this.$body.css("padding-right",e+i),t(this.fixedContent).each((function(e,n){var o=n.style.paddingRight,s=t(n).css("padding-right");t(n).data("padding-right",o).css("padding-right",parseFloat(s)+i+"px")})))},e.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad),t(this.fixedContent).each((function(e,i){var n=t(i).data("padding-right");t(i).removeData("padding-right"),i.style.paddingRight=n||""}))},e.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=i,t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',(function(e){var n=t(this),o=n.attr("href"),s=n.attr("data-target")||o&&o.replace(/.*(?=#[^\s]+$)/,""),a=t(document).find(s),l=a.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(o)&&o},a.data(),n.data());n.is("a")&&e.preventDefault(),a.one("show.bs.modal",(function(t){t.isDefaultPrevented()||a.one("hidden.bs.modal",(function(){n.is(":visible")&&n.trigger("focus")}))})),i.call(a,l,this)}))}(jQuery),function(t){"use strict";var e=["sanitize","whiteList","sanitizeFn"],i=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],n={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},o=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,s=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function a(e,n){var a=e.nodeName.toLowerCase();if(-1!==t.inArray(a,n))return-1===t.inArray(a,i)||Boolean(e.nodeValue.match(o)||e.nodeValue.match(s));for(var l=t(n).filter((function(t,e){return e instanceof RegExp})),r=0,c=l.length;r<c;r++)if(a.match(l[r]))return!0;return!1}function l(e,i,n){if(0===e.length)return e;if(n&&"function"==typeof n)return n(e);if(!document.implementation||!document.implementation.createHTMLDocument)return e;var o=document.implementation.createHTMLDocument("sanitization");o.body.innerHTML=e;for(var s=t.map(i,(function(t,e){return e})),l=t(o.body).find("*"),r=0,c=l.length;r<c;r++){var d=l[r],h=d.nodeName.toLowerCase();if(-1!==t.inArray(h,s))for(var p=t.map(d.attributes,(function(t){return t})),m=[].concat(i["*"]||[],i[h]||[]),u=0,g=p.length;u<g;u++)a(p[u],m)||d.removeAttribute(p[u].nodeName);else d.parentNode.removeChild(d)}return o.body.innerHTML}var r=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};r.VERSION="3.4.1",r.TRANSITION_DURATION=150,r.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:n},r.prototype.init=function(e,i,n){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(document).find(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var o=this.options.trigger.split(" "),s=o.length;s--;){var a=o[s];if("click"==a)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=a){var l="hover"==a?"mouseenter":"focusin",r="hover"==a?"mouseleave":"focusout";this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},r.prototype.getDefaults=function(){return r.DEFAULTS},r.prototype.getOptions=function(i){var n=this.$element.data();for(var o in n)n.hasOwnProperty(o)&&-1!==t.inArray(o,e)&&delete n[o];return(i=t.extend({},this.getDefaults(),n,i)).delay&&"number"==typeof i.delay&&(i.delay={show:i.delay,hide:i.delay}),i.sanitize&&(i.template=l(i.template,i.whiteList,i.sanitizeFn)),i},r.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,(function(t,n){i[t]!=n&&(e[t]=n)})),e},r.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState)i.hoverState="in";else{if(clearTimeout(i.timeout),i.hoverState="in",!i.options.delay||!i.options.delay.show)return i.show();i.timeout=setTimeout((function(){"in"==i.hoverState&&i.show()}),i.options.delay.show)}},r.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},r.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue()){if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout((function(){"out"==i.hoverState&&i.hide()}),i.options.delay.hide)}},r.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var i=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!i)return;var n=this,o=this.tip(),s=this.getUID(this.type);this.setContent(),o.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,c=l.test(a);c&&(a=a.replace(l,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(t(document).find(this.options.container)):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var d=this.getPosition(),h=o[0].offsetWidth,p=o[0].offsetHeight;if(c){var m=a,u=this.getPosition(this.$viewport);a="bottom"==a&&d.bottom+p>u.bottom?"top":"top"==a&&d.top-p<u.top?"bottom":"right"==a&&d.right+h>u.width?"left":"left"==a&&d.left-h<u.left?"right":a,o.removeClass(m).addClass(a)}var g=this.getCalculatedOffset(a,d,h,p);this.applyPlacement(g,a);var f=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",f).emulateTransitionEnd(r.TRANSITION_DURATION):f()}},r.prototype.applyPlacement=function(e,i){var n=this.tip(),o=n[0].offsetWidth,s=n[0].offsetHeight,a=parseInt(n.css("margin-top"),10),l=parseInt(n.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(l)&&(l=0),e.top+=a,e.left+=l,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var r=n[0].offsetWidth,c=n[0].offsetHeight;"top"==i&&c!=s&&(e.top=e.top+s-c);var d=this.getViewportAdjustedDelta(i,e,r,c);d.left?e.left+=d.left:e.top+=d.top;var h=/top|bottom/.test(i),p=h?2*d.left-o+r:2*d.top-s+c,m=h?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(p,n[0][m],h)},r.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},r.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();this.options.html?(this.options.sanitize&&(e=l(e,this.options.whiteList,this.options.sanitizeFn)),t.find(".tooltip-inner").html(e)):t.find(".tooltip-inner").text(e),t.removeClass("fade in top bottom left right")},r.prototype.hide=function(e){var i=this,n=t(this.$tip),o=t.Event("hide.bs."+this.type);function s(){"in"!=i.hoverState&&n.detach(),i.$element&&i.$element.removeAttr("aria-describedby").trigger("hidden.bs."+i.type),e&&e()}if(this.$element.trigger(o),!o.isDefaultPrevented())return n.removeClass("in"),t.support.transition&&n.hasClass("fade")?n.one("bsTransitionEnd",s).emulateTransitionEnd(r.TRANSITION_DURATION):s(),this.hoverState=null,this},r.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},r.prototype.hasContent=function(){return this.getTitle()},r.prototype.getPosition=function(e){var i=(e=e||this.$element)[0],n="BODY"==i.tagName,o=i.getBoundingClientRect();null==o.width&&(o=t.extend({},o,{width:o.right-o.left,height:o.bottom-o.top}));var s=window.SVGElement&&i instanceof window.SVGElement,a=n?{top:0,left:0}:s?null:e.offset(),l={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},r=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},o,l,r,a)},r.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},r.prototype.getViewportAdjustedDelta=function(t,e,i,n){var o={top:0,left:0};if(!this.$viewport)return o;var s=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(t)){var l=e.top-s-a.scroll,r=e.top+s-a.scroll+n;l<a.top?o.top=a.top-l:r>a.top+a.height&&(o.top=a.top+a.height-r)}else{var c=e.left-s,d=e.left+s+i;c<a.left?o.left=a.left-c:d>a.right&&(o.left=a.left+a.width-d)}return o},r.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},r.prototype.getUID=function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},r.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},r.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},r.prototype.enable=function(){this.enabled=!0},r.prototype.disable=function(){this.enabled=!1},r.prototype.toggleEnabled=function(){this.enabled=!this.enabled},r.prototype.toggle=function(e){var i=this;e&&((i=t(e.currentTarget).data("bs."+this.type))||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},r.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide((function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null}))},r.prototype.sanitizeHtml=function(t){return l(t,this.options.whiteList,this.options.sanitizeFn)};var c=t.fn.tooltip;t.fn.tooltip=function(e){return this.each((function(){var i=t(this),n=i.data("bs.tooltip"),o="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||i.data("bs.tooltip",n=new r(this,o)),"string"==typeof e&&n[e]())}))},t.fn.tooltip.Constructor=r,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=c,this}}(jQuery),function(t){"use strict";var e=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");e.VERSION="3.4.1",e.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),(e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype)).constructor=e,e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();if(this.options.html){var n=typeof i;this.options.sanitize&&(e=this.sanitizeHtml(e),"string"===n&&(i=this.sanitizeHtml(i))),t.find(".popover-title").html(e),t.find(".popover-content").children().detach().end()["string"===n?"html":"append"](i)}else t.find(".popover-title").text(e),t.find(".popover-content").children().detach().end().text(i);t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},e.prototype.hasContent=function(){return this.getTitle()||this.getContent()},e.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var i=t.fn.popover;t.fn.popover=function(i){return this.each((function(){var n=t(this),o=n.data("bs.popover"),s="object"==typeof i&&i;!o&&/destroy|hide/.test(i)||(o||n.data("bs.popover",o=new e(this,s)),"string"==typeof i&&o[i]())}))},t.fn.popover.Constructor=e,t.fn.popover.noConflict=function(){return t.fn.popover=i,this}}(jQuery),function(t){"use strict";function e(i,n){this.$body=t(document.body),this.$scrollElement=t(i).is(document.body)?t(window):t(i),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function i(i){return this.each((function(){var n=t(this),o=n.data("bs.scrollspy"),s="object"==typeof i&&i;o||n.data("bs.scrollspy",o=new e(this,s)),"string"==typeof i&&o[i]()}))}e.VERSION="3.4.1",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,i="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(i="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map((function(){var e=t(this),o=e.data("target")||e.attr("href"),s=/^#./.test(o)&&t(o);return s&&s.length&&s.is(":visible")&&[[s[i]().top+n,o]]||null})).sort((function(t,e){return t[0]-e[0]})).each((function(){e.offsets.push(this[0]),e.targets.push(this[1])}))},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),o=this.offsets,s=this.targets,a=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),e>=n)return a!=(t=s[s.length-1])&&this.activate(t);if(a&&e<o[0])return this.activeTarget=null,this.clear();for(t=o.length;t--;)a!=s[t]&&e>=o[t]&&(void 0===o[t+1]||e<o[t+1])&&this.activate(s[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=i,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",(function(){t('[data-spy="scroll"]').each((function(){var e=t(this);i.call(e,e.data())}))}))}(jQuery),function(t){"use strict";var e=function(e){this.element=t(e)};function i(i){return this.each((function(){var n=t(this),o=n.data("bs.tab");o||n.data("bs.tab",o=new e(this)),"string"==typeof i&&o[i]()}))}e.VERSION="3.4.1",e.TRANSITION_DURATION=150,e.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=(n=e.attr("href"))&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var o=i.find(".active:last a"),s=t.Event("hide.bs.tab",{relatedTarget:e[0]}),a=t.Event("show.bs.tab",{relatedTarget:o[0]});if(o.trigger(s),e.trigger(a),!a.isDefaultPrevented()&&!s.isDefaultPrevented()){var l=t(document).find(n);this.activate(e.closest("li"),i),this.activate(l,l.parent(),(function(){o.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:o[0]})}))}}},e.prototype.activate=function(i,n,o){var s=n.find("> .active"),a=o&&t.support.transition&&(s.length&&s.hasClass("fade")||!!n.find("> .fade").length);function l(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),i.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),a?(i[0].offsetWidth,i.addClass("in")):i.removeClass("fade"),i.parent(".dropdown-menu").length&&i.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),o&&o()}s.length&&a?s.one("bsTransitionEnd",l).emulateTransitionEnd(e.TRANSITION_DURATION):l(),s.removeClass("in")};var n=t.fn.tab;t.fn.tab=i,t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var o=function(e){e.preventDefault(),i.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',o).on("click.bs.tab.data-api",'[data-toggle="pill"]',o)}(jQuery),function(t){"use strict";var e=function(i,n){this.options=t.extend({},e.DEFAULTS,n);var o=this.options.target===e.DEFAULTS.target?t(this.options.target):t(document).find(this.options.target);this.$target=o.on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(i),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};function i(i){return this.each((function(){var n=t(this),o=n.data("bs.affix"),s="object"==typeof i&&i;o||n.data("bs.affix",o=new e(this,s)),"string"==typeof i&&o[i]()}))}e.VERSION="3.4.1",e.RESET="affix affix-top affix-bottom",e.DEFAULTS={offset:0,target:window},e.prototype.getState=function(t,e,i,n){var o=this.$target.scrollTop(),s=this.$element.offset(),a=this.$target.height();if(null!=i&&"top"==this.affixed)return o<i&&"top";if("bottom"==this.affixed)return null!=i?!(o+this.unpin<=s.top)&&"bottom":!(o+a<=t-n)&&"bottom";var l=null==this.affixed,r=l?o:s.top;return null!=i&&o<=i?"top":null!=n&&r+(l?a:e)>=t-n&&"bottom"},e.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(e.RESET).addClass("affix");var t=this.$target.scrollTop(),i=this.$element.offset();return this.pinnedOffset=i.top-t},e.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},e.prototype.checkPosition=function(){if(this.$element.is(":visible")){var i=this.$element.height(),n=this.options.offset,o=n.top,s=n.bottom,a=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(s=o=n),"function"==typeof o&&(o=n.top(this.$element)),"function"==typeof s&&(s=n.bottom(this.$element));var l=this.getState(a,i,o,s);if(this.affixed!=l){null!=this.unpin&&this.$element.css("top","");var r="affix"+(l?"-"+l:""),c=t.Event(r+".bs.affix");if(this.$element.trigger(c),c.isDefaultPrevented())return;this.affixed=l,this.unpin="bottom"==l?this.getPinnedOffset():null,this.$element.removeClass(e.RESET).addClass(r).trigger(r.replace("affix","affixed")+".bs.affix")}"bottom"==l&&this.$element.offset({top:a-i-s})}};var n=t.fn.affix;t.fn.affix=i,t.fn.affix.Constructor=e,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",(function(){t('[data-spy="affix"]').each((function(){var e=t(this),n=e.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),i.call(e,n)}))}))}(jQuery),define("bootstrap",["jquery"],(function(){})),void 0===Common)var Common={};if(define("notification",["backbone"],(function(t){"use strict";var e=function(){};if(_.extend(e.prototype,t.Events),void 0!==Common.NotificationCenter)throw"Native Common.NotificationCenter instance already defined.";e.extend=t.Model.extend,Common.NotificationCenter=new e})),function(){var t=function(t,e){for(var i=t.split("."),n=e||window,o=0,s=i.length;o<s;o++)n=n[i[o]]||{};return n},e=function(t){_.extend(this,t||{}),this.eventbus=new n({application:this}),this.createApplicationNamespace(),this.initialize.apply(this,arguments),!1!==this.autoCreate&&$($.proxy(this.onReady,this))};if(_.extend(e.prototype,{nameSpace:"Application",models:{},collections:{},controllers:{},allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views"},createApplicationNamespace:function(){var t=window;this.nameSpace&&void 0===t[this.nameSpace]&&(t[this.nameSpace]={}),t[this.nameSpace]=this,_.each(this.allocationMap,(function(t,e){this[t]=this[t]||{}}),this)},initialize:function(){},onReady:function(){this.start()},start:function(){this.initializeControllers(this.controllers||{}),this.launchControllers(),this.launch.call(this)},getClasseRefs:function(e,i){var n={},o=this[this.allocationMap[e]];return _.each(i,(function(e){n[e]=t(e,e.indexOf(".")>-1?window:o)}),this),n},initializeControllers:function(e){this.controllers={},_.each(e,(function(e){var i=e.indexOf(".")>-1?window:this[this.allocationMap.controller],n=t(e,i),o=(e.split(".").pop(),new n({id:e,application:this}));o.views=this.getClasseRefs("view",o.views||[]),_.extend(this.models,this.getClasseRefs("model",o.models||[])),_.extend(this.collections,this.getClasseRefs("collection",o.collections||{})),this.buildCollections(),this.controllers[e]=o}),this)},launchControllers:function(){_.each(this.controllers,(function(t,e){t.onLaunch(this)}),this)},launch:function(){},addListeners:function(t,e){this.eventbus.addListeners(t,e)},getController:function(t){return this.controllers[t]},getModel:function(t){this._modelsCache=this._modelsCache||{};var e=this._modelsCache[t],i=this.getModelConstructor(t);return!e&&i&&(e=this.createModel(t),this._modelsCache[t]=e),e||null},getModelConstructor:function(t){return this.models[t]},createModel:function(t,e){var i=this.getModelConstructor(t),n=null;return i&&(n=new i(_.extend(e||{}))),n},getCollection:function(t){this._collectionsCache=this._collectionsCache||{};var e=this._collectionsCache[t],i=this.getCollectionConstructor(t);return!e&&i&&(e=this.createCollection(t),this._collectionsCache[t]=e),e||null},getCollectionConstructor:function(t){return this.collections[t]},createCollection:function(t){var e=this.getCollectionConstructor(t),i=null;return e&&(i=new e),i},buildCollections:function(){_.each(this.collections,(function(t,e){this.getCollection(e)}),this)}}),void 0!==Backbone.Application)throw"Native Backbone.Application instance already defined.";Backbone.Application=e,Backbone.Application.extend=Backbone.Model.extend;var i=function(t){_.extend(this,t||{}),this.initialize.apply(this,arguments)};if(_.extend(i.prototype,{name:null,views:{},models:{},collections:{},initialize:function(t){},addListeners:function(t){this.getApplication().addListeners(t,this)},onLaunch:function(t){},getApplication:function(){return this.application},getView:function(t){return this._viewsCache[t]},getViewConstructor:function(t){return this.views[t]},createView:function(t,e){var i=this.getViewConstructor(t),n=_.extend(e||{},{alias:t});return this._viewsCache=this._viewsCache||{},this._viewsCache[t]=new i(n),this._viewsCache[t].options=_.extend({},n),this._viewsCache[t]},getModel:function(t){return this.application.getModel(t)},getModelConstructor:function(t){return this.application.getModelConstructor(t)},createModel:function(t,e){return this.application.createModel(t)},getCollection:function(t){return this.application.getCollection(t)},getCollectionConstructor:function(t){return this.application.getCollectionConstructor(t)},createCollection:function(t){return this.application.createCollection(t)},fireEvent:function(t,e,i){this.application.eventbus.fireEvent(t,e,i)},bindViewEvents:function(t,e){for(var i in this.unbindViewEvents(t),e=_.isFunction(e)?e.call(this):e){var n=e[i];_.isFunction(n)||(n=this[e[i]]);var o=i.match(/^(\S+)\s*(.*)$/),s=o[1],a=o[2];n=_.bind(n,this),s+=".bindViewEvents"+t.cid,t.$el.on(s,a,n)}return this},unbindViewEvents:function(t){return t.$el.off(".bindViewEvents"+t.cid),this}}),void 0!==Backbone.Controller)throw"Native Backbone.Controller instance already defined.";Backbone.Controller=i,Backbone.Controller.extend=Backbone.Model.extend;var n=function(t){var e=this;_.extend(this,t||{}),_.extend(Backbone.View.prototype,{alias:null,hidden:!1,getAlias:function(){return this.options.alias},fireEvent:function(t,i){this.trigger.apply(this,arguments),e.fireEvent(this.getAlias(),t,i)},hide:function(){this.$el.hide(),this.hidden=!0},show:function(){this.$el.show(),this.hidden=!1}})};if(_.extend(n.prototype,{pool:{},addListeners:function(t,e){this.pool[e.id]=this.pool[e.id]||{};var i=this.pool[e.id];_.isArray(t)?_.each(t,(function(t){this.addListeners(t,e)}),this):_.isObject(t)&&_.each(t,(function(t,e){_.each(t,(function(t,n){i[e]=i[e]||{},i[e][n]=i[e][n]||[],i[e][n].push(t)}),this)}),this)},fireEvent:function(t,e,i){var n=this.getApplication();_.each(this.pool,(function(o,s){var a=o[t];if(a){var l=a[e],r=n.getController(s);_.each(l,(function(t){t.apply(r,i)}))}}),this)},getApplication:function(){return this.application}}),void 0!==Backbone.EventBus)throw"Native Backbone.Application instance already defined.";Backbone.EventBus=n}(),define("core",["backbone","notification"],(function(){})),void 0===window.Common&&(window.Common={}),Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var t;return{initialize:function(e,i){if(void 0===e)throw"Analytics: invalid id.";if(void 0===i||"[object String]"!==Object.prototype.toString.apply(i))throw"Analytics: invalid category type.";t=i,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+e+'"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);})();<\/script>')},trackEvent:function(e,i,n){if(void 0!==e&&"[object String]"!==Object.prototype.toString.apply(e))throw"Analytics: invalid action type.";if(void 0!==i&&"[object String]"!==Object.prototype.toString.apply(i))throw"Analytics: invalid label type.";if(void 0!==n&&("[object Number]"!==Object.prototype.toString.apply(n)||!isFinite(n)))throw"Analytics: invalid value type.";if("undefined"!=typeof _gaq){if("undefined"===t)throw"Analytics is not initialized.";_gaq.push(["_trackEvent",t,e,i,n])}}}},define("analytics",["jquery"],(function(){})),void 0===window.Common&&(window.Common={}),Common.Gateway=new function(){var t=this,e=$(t),i={init:function(t){e.trigger("init",t)},openDocument:function(t){e.trigger("opendocument",t)},showMessage:function(t){e.trigger("showmessage",t)},applyEditRights:function(t){e.trigger("applyeditrights",t)},processSaveResult:function(t){e.trigger("processsaveresult",t)},processRightsChange:function(t){e.trigger("processrightschange",t)},refreshHistory:function(t){e.trigger("refreshhistory",t)},setHistoryData:function(t){e.trigger("sethistorydata",t)},setEmailAddresses:function(t){e.trigger("setemailaddresses",t)},setActionLink:function(t){e.trigger("setactionlink",t.url)},processMailMerge:function(t){e.trigger("processmailmerge",t)},downloadAs:function(t){e.trigger("downloadas",t)},processMouse:function(t){e.trigger("processmouse",t)},internalCommand:function(t){e.trigger("internalcommand",t)},resetFocus:function(t){e.trigger("resetfocus",t)},setUsers:function(t){e.trigger("setusers",t)},showSharingSettings:function(t){e.trigger("showsharingsettings",t)},setSharingSettings:function(t){e.trigger("setsharingsettings",t)},insertImage:function(t){e.trigger("insertimage",t)},setMailMergeRecipients:function(t){e.trigger("setmailmergerecipients",t)},setRevisedFile:function(t){e.trigger("setrevisedfile",t)},setFavorite:function(t){e.trigger("setfavorite",t)},requestClose:function(t){e.trigger("requestclose",t)},blurFocus:function(t){e.trigger("blurfocus",t)},grabFocus:function(t){e.trigger("grabfocus",t)}},n=function(t){window.parent&&window.JSON&&(t.frameEditorId=window.frameEditorId,window.parent.postMessage(window.JSON.stringify(t),"*"))},o=function(t){!function(t){if(t.origin===window.parentOrigin||t.origin===window.location.origin||"null"===t.origin&&("file://"===window.parentOrigin||"file://"===window.location.origin)){var e=t.data;if("[object String]"===Object.prototype.toString.apply(e)&&window.JSON){var n,o;try{n=window.JSON.parse(e)}catch(t){n=""}n&&(o=i[n.command])&&o.call(this,n.data)}}}(t)};return window.attachEvent?window.attachEvent("onmessage",o):window.addEventListener("message",o,!1),{appReady:function(){n({event:"onAppReady"})},requestEditRights:function(){n({event:"onRequestEditRights"})},requestHistory:function(){n({event:"onRequestHistory"})},requestHistoryData:function(t){n({event:"onRequestHistoryData",data:t})},requestRestore:function(t,e,i){n({event:"onRequestRestore",data:{version:t,url:e,fileType:i}})},requestEmailAddresses:function(){n({event:"onRequestEmailAddresses"})},requestStartMailMerge:function(){n({event:"onRequestStartMailMerge"})},requestHistoryClose:function(t){n({event:"onRequestHistoryClose"})},reportError:function(t,e){n({event:"onError",data:{errorCode:t,errorDescription:e}})},reportWarning:function(t,e){n({event:"onWarning",data:{warningCode:t,warningDescription:e}})},sendInfo:function(t){n({event:"onInfo",data:t})},setDocumentModified:function(t){n({event:"onDocumentStateChange",data:t})},internalMessage:function(t,e){n({event:"onInternalMessage",data:{type:t,data:e}})},updateVersion:function(){n({event:"onOutdatedVersion"})},downloadAs:function(t,e){n({event:"onDownloadAs",data:{url:t,fileType:e}})},requestSaveAs:function(t,e,i){n({event:"onRequestSaveAs",data:{url:t,title:e,fileType:i}})},collaborativeChanges:function(){n({event:"onCollaborativeChanges"})},requestRename:function(t){n({event:"onRequestRename",data:t})},metaChange:function(t){n({event:"onMetaChange",data:t})},documentReady:function(){n({event:"onDocumentReady"})},requestClose:function(){n({event:"onRequestClose"})},requestMakeActionLink:function(t){n({event:"onMakeActionLink",data:t})},requestUsers:function(){n({event:"onRequestUsers"})},requestSendNotify:function(t){n({event:"onRequestSendNotify",data:t})},requestInsertImage:function(t){n({event:"onRequestInsertImage",data:{c:t}})},requestMailMergeRecipients:function(){n({event:"onRequestMailMergeRecipients"})},requestCompareFile:function(){n({event:"onRequestCompareFile"})},requestSharingSettings:function(){n({event:"onRequestSharingSettings"})},requestCreateNew:function(){n({event:"onRequestCreateNew"})},pluginsReady:function(){n({event:"onPluginsReady"})},on:function(i,n){e.on(i,(function(e,i){n.call(t,i)}))}}},define("gateway",["jquery"],(function(){})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("../vendor/es6-promise/es6-promise.auto.min",e):t.ES6Promise=e()}(this,(function(){"use strict";function t(t){return"function"==typeof t}function e(){var t=setTimeout;return function(){return t(i,1)}}function i(){for(var t=0;t<b;t+=2){(0,k[t])(k[t+1]),k[t]=void 0,k[t+1]=void 0}b=0}function n(t,e){var i=this,n=new this.constructor(s);void 0===n[I]&&u(n);var o=i._state;if(o){var a=arguments[o-1];_((function(){return m(o,n,a,i._result)}))}else h(i,n,t,e);return n}function o(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(s);return l(e,t),e}function s(){}function a(e,i,s){i.constructor===e.constructor&&s===n&&i.constructor.resolve===o?function(t,e){e._state===D?c(t,e._result):e._state===P?d(t,e._result):h(e,void 0,(function(e){return l(t,e)}),(function(e){return d(t,e)}))}(e,i):void 0===s?c(e,i):t(s)?function(t,e,i){_((function(t){var n=!1,o=function(t,e,i,n){try{t.call(e,i,n)}catch(t){return t}}(i,e,(function(i){n||(n=!0,e!==i?l(t,i):c(t,i))}),(function(e){n||(n=!0,d(t,e))}),t._label);!n&&o&&(n=!0,d(t,o))}),t)}(e,i,s):c(e,i)}function l(t,e){if(t===e)d(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var i=void 0;try{i=e.then}catch(e){return void d(t,e)}a(t,e,i)}else c(t,e)}function r(t){t._onerror&&t._onerror(t._result),p(t)}function c(t,e){t._state===E&&(t._result=e,t._state=D,0!==t._subscribers.length&&_(p,t))}function d(t,e){t._state===E&&(t._state=P,t._result=e,_(r,t))}function h(t,e,i,n){var o=t._subscribers,s=o.length;t._onerror=null,o[s]=e,o[s+D]=i,o[s+P]=n,0===s&&t._state&&_(p,t)}function p(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,o=void 0,s=t._result,a=0;a<e.length;a+=3)n=e[a],o=e[a+i],n?m(i,n,o,s):o(s);t._subscribers.length=0}}function m(e,i,n,o){var s=t(n),a=void 0,r=void 0,h=!0;if(s){try{a=n(o)}catch(t){h=!1,r=t}if(i===a)return void d(i,new TypeError("A promises callback cannot return that same promise."))}else a=o;i._state!==E||(s&&h?l(i,a):!1===h?d(i,r):e===D?c(i,a):e===P&&d(i,a))}function u(t){t[I]=F++,t._state=void 0,t._result=void 0,t._subscribers=[]}var g;g=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var f=g,b=0,C=void 0,v=void 0,_=function(t,e){k[b]=t,k[b+1]=e,2===(b+=2)&&(v?v(i):T())},x="undefined"!=typeof window?window:void 0,y=x||{},w=y.MutationObserver||y.WebKitMutationObserver,S="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),A="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,k=new Array(1e3),T=void 0;T=S?function(){return process.nextTick(i)}:w?function(){var t=0,e=new w(i),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():A?function(){var t=new MessageChannel;return t.port1.onmessage=i,function(){return t.port2.postMessage(0)}}():void 0===x&&"function"==typeof require?function(){try{var t=Function("return this")().require("vertx");return void 0!==(C=t.runOnLoop||t.runOnContext)?function(){C(i)}:e()}catch(t){return e()}}():e();var I=Math.random().toString(36).substring(2),E=void 0,D=1,P=2,F=0,R=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[I]||u(this.promise),f(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?c(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&c(this.promise,this._result))):d(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===E&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,l=i.resolve;if(l===o){var r=void 0,c=void 0,h=!1;try{r=t.then}catch(t){h=!0,c=t}if(r===n&&t._state!==E)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(i===V){var p=new i(s);h?d(p,c):a(p,t,r),this._willSettleAt(p,e)}else this._willSettleAt(new i((function(e){return e(t)})),e)}else this._willSettleAt(l(t),e)},t.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===E&&(this._remaining--,t===P?d(n,i):this._result[e]=i),0===this._remaining&&c(n,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;h(t,void 0,(function(t){return i._settledAt(D,e,t)}),(function(t){return i._settledAt(P,e,t)}))},t}(),V=function(){function e(t){this[I]=F++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){l(t,e)}),(function(e){d(t,e)}))}catch(e){d(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this,n=i.constructor;return t(e)?i.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):i.then(e,e)},e}();return V.prototype.then=n,V.all=function(t){return new R(this,t).promise},V.race=function(t){var e=this;return new e(f(t)?function(i,n){for(var o=t.length,s=0;s<o;s++)e.resolve(t[s]).then(i,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},V.resolve=o,V.reject=function(t){var e=new this(s);return d(e,t),e},V._setScheduler=function(t){v=t},V._setAsap=function(t){_=t},V._asap=_,V.polyfill=function(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=V},V.Promise=V,V.polyfill(),V})),void 0===Common)var Common={};if(Common.Locale=new function(){"use strict";var l10n=null,loadcallback,apply=!1,defLang="en",currentLang=defLang,_4letterLangs=["pt-pt","zh-tw"],_applyLocalization=function(t){try{if(t&&(loadcallback=t),l10n){for(var e in l10n){var i=e.split(".");if(i&&i.length>2){for(var n=window,o=0;o<i.length-1;++o)void 0===n[i[o]]&&(n[i[o]]=new Object),n=n[i[o]];n&&(n[i[i.length-1]]=l10n[e])}}loadcallback&&loadcallback()}else apply=!0}catch(t){}},_get=function(prop,scope){var res="";return l10n&&scope&&scope.name&&(res=l10n[scope.name+"."+prop],!res&&scope.default&&(res=scope.default)),res||(scope?eval(scope.name).prototype[prop]:"")},_getCurrentLanguage=function(){return currentLang},_getDefaultLanguage=function(){return defLang},_getLoadedLanguage=function(){return loadedLang},_getUrlParameterByName=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},_requireLang=function(t){"string"!=typeof t&&(t=null);var e=t||_getUrlParameterByName("lang")||defLang,i=_4letterLangs.indexOf(e.replace("_","-").toLowerCase());e=i<0?e.split(/[\-_]/)[0]:_4letterLangs[i],currentLang=e,fetch("locale/"+e+".json").then((function(t){if(!t.ok){if(i>=0)throw new Error("4letters error");if(currentLang=defLang,e!=defLang)return fetch("locale/"+defLang+".json");throw new Error("server error")}return t.json()})).then((function(t){if(t.json){if(!t.ok)throw new Error("server error");return t.json()}throw l10n=t,new Error("loaded")})).then((function(t){l10n=t||{},apply&&_applyLocalization()})).catch((function(t){return/4letters/.test(t)?setTimeout((function(){_requireLang(e.split(/[\-_]/)[0])}),0):!/loaded/.test(t)&&currentLang!=defLang&&defLang&&defLang.length<3?setTimeout((function(){_requireLang(defLang)}),0):(l10n=l10n||{},apply&&_applyLocalization(),void("loaded"==t.message||(currentLang=null,console.log("fetch error: "+t))))}))};if(window.fetch)_requireLang();else{var polyfills=["../vendor/fetch/fetch.umd"];window.Promise?require(polyfills,_requireLang):require(["../vendor/es6-promise/es6-promise.auto.min"],(function(){require(polyfills,_requireLang)}))}return{apply:_applyLocalization,get:_get,getCurrentLanguage:_getCurrentLanguage,getDefaultLanguage:_getDefaultLanguage}},define("locale",(function(){})),define("common/main/lib/util/LocalStorage",["gateway"],(function(){Common.localStorage=new function(){var t,e,i={};Common.Gateway.on("internalcommand",(function(t){"localstorage"==t.type&&(i=t.keys)}));var n=function(t,e,n){if(s)try{localStorage.setItem(t,e)}catch(t){}else i[t]=e},o=function(t){return s?localStorage.getItem(t):void 0===i[t]?null:i[t]};try{var s=!!window.localStorage}catch(t){s=!1}return{getId:function(){return t},setId:function(e){t=e},getItem:o,getBool:function(t,e){var i=o(t);return e=e||!1,null!==i?0!=parseInt(i):e},setBool:function(t,e,i){n(t,e?1:0)},setItem:n,removeItem:function(t){s?localStorage.removeItem(t):delete i[t]},setKeysFilter:function(t){e=t},getKeysFilter:function(){return e},itemExists:function(t){return null!==o(t)},sync:function(){},save:function(){}}}})),define("common/main/lib/controller/Themes",["core"],(function(){"use strict";!Common.UI&&(Common.UI={}),Common.UI.Themes=new function(t){!t&&(t={});const e="dark",i="system";var n={"theme-system":{text:t.txtThemeSystem||"Same as system",type:i,source:"static"},"theme-light":{text:t.txtThemeLight||"Light",type:"light",source:"static"},"theme-classic-light":{text:t.txtThemeClassicLight||"Classic Light",type:"light",source:"static"},"theme-dark":{text:t.txtThemeDark||"Dark",type:"dark",source:"static"},"theme-contrast-dark":{text:t.txtThemeContrastDark||"Dark Contrast",type:"dark",source:"static"}};window.currentLoaderTheme&&(n[currentLoaderTheme.id]||(n[currentLoaderTheme.id]=currentLoaderTheme),window.currentLoaderTheme=void 0);var o="theme-classic-light",s="theme-dark",a=["toolbar-header-document","toolbar-header-spreadsheet","toolbar-header-presentation","text-toolbar-header-on-background-document","text-toolbar-header-on-background-spreadsheet","text-toolbar-header-on-background-presentation","background-normal","background-toolbar","background-toolbar-additional","background-primary-dialog-button","background-tab-underline","background-notification-popover","background-notification-badge","background-scrim","background-loader","background-accent-button","background-contrast-popover","shadow-contrast-popover","highlight-button-hover","highlight-button-pressed","highlight-button-pressed-hover","highlight-primary-dialog-button-hover","highlight-header-button-hover","highlight-header-button-pressed","highlight-toolbar-tab-underline","highlight-text-select","highlight-accent-button-hover","highlight-accent-button-pressed","border-toolbar","border-divider","border-regular-control","border-toolbar-button-hover","border-preview-hover","border-preview-select","border-control-focus","border-color-shading","border-error","border-contrast-popover","text-normal","text-normal-pressed","text-secondary","text-tertiary","text-link","text-link-hover","text-link-active","text-link-visited","text-inverse","text-toolbar-header","text-contrast-background","text-alt-key-hint","icon-normal","icon-normal-pressed","icon-inverse","icon-toolbar-header","icon-notification-badge","icon-contrast-popover","icon-success","canvas-background","canvas-content-background","canvas-page-border","canvas-ruler-background","canvas-ruler-border","canvas-ruler-margins-background","canvas-ruler-mark","canvas-ruler-handle-border","canvas-ruler-handle-border-disabled","canvas-high-contrast","canvas-high-contrast-disabled","canvas-cell-border","canvas-cell-title-border","canvas-cell-title-border-hover","canvas-cell-title-border-selected","canvas-cell-title-hover","canvas-cell-title-selected","canvas-dark-cell-title","canvas-dark-cell-title-hover","canvas-dark-cell-title-selected","canvas-dark-cell-title-border","canvas-dark-cell-title-border-hover","canvas-dark-cell-title-border-selected","canvas-dark-content-background","canvas-dark-page-border","canvas-scroll-thumb","canvas-scroll-thumb-hover","canvas-scroll-thumb-pressed","canvas-scroll-thumb-border","canvas-scroll-thumb-border-hover","canvas-scroll-thumb-border-pressed","canvas-scroll-arrow","canvas-scroll-arrow-hover","canvas-scroll-arrow-pressed","canvas-scroll-thumb-target","canvas-scroll-thumb-target-hover","canvas-scroll-thumb-target-pressed"],l=function(t){var e={};if(!Common.Utils.isIE10&&!Common.Utils.isIE11){var i=getComputedStyle(document.body);t.forEach((function(t,n){e[t]=i.getPropertyValue("--"+t).trim()}))}return e},r=function(t,e){if(e&&t){var i=[":root .",t,"{"];for(var n in e)i.push("--",n,":",e[n],";");return i.push("}"),i.join("")}},c=function(t){if(t){var e=document.createElement("style");e.type="text/css",e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)}},d=function(t){Common.Utils.loadConfig(t,(function(t){"error"!=t?function(t){var e,i=Common.Locale.getCurrentLanguage();t.themes&&t.themes instanceof Array?t.themes.forEach((function(t){t.id?(e=t.l10n&&t.l10n[i]?t.l10n[i]:t.name,n[t.id]={text:e,type:t.type},c(r(t.id,t.colors))):"string"==typeof t&&d(t)})):t.id&&(e=t.l10n&&t.l10n[i]?t.l10n[i]:t.name,n[t.id]={text:e,type:t.type},c(r(t.id,t.colors))),Common.NotificationCenter.trigger("uitheme:countchanged")}(t):console.warn("failed to load/parse themes.json")}))},h=function(t){Common.Controllers.Desktop.isActive()&&Common.Controllers.Desktop.isOffline()||d("../../../../themes.json")},p=function(t){return"string"==typeof t&&t.startsWith("{")&&t.endsWith("}")&&(t=JSON.parse(t)),t&&"object"==typeof t?t.id:t},m=function(t){this.api.asc_setContentDarkMode&&this.isDarkTheme()&&this.api.asc_setContentDarkMode(this.isContentThemeDark())};const u=function(t){return n[t].type==i},g=function(){const t=(window.matchMedia("(prefers-color-scheme: dark)").matches?e:"light")==e?s:o;return{id:t,info:n[t]}},f=function(t){Common.localStorage.getBool("ui-theme-use-system",!1)&&this.setTheme("theme-system")};return{init:function(t){var e=this;Common.Gateway.on("opendocument",m.bind(this)),$(window).on("storage",(function(t){"ui-theme"==t.key||"ui-theme-id"==t.key?t.originalEvent.newValue&&(Common.localStorage.getBool("ui-theme-use-system",!1)?e.setTheme("theme-system"):e.setTheme(t.originalEvent.newValue,!0)):"content-theme"==t.key&&(e.setContentTheme(t.originalEvent.newValue,!0),console.log("changed content",t.originalEvent.newValue))})),this.api=t;var i=p(Common.localStorage.getItem("ui-theme"));i||Common.Utils.isIE10||Common.Utils.isIE11||document.body.classList.forEach((function(t,e,o){if(!i&&t.startsWith("theme-")&&!t.startsWith("theme-type-")&&n[t]){var s={id:i=t,type:n[i].type};Common.localStorage.setItem("ui-theme",JSON.stringify(s))}})),n[i]||(i=o),$("body").hasClass(i)||$("body").addClass(i),document.body.className.match(/theme-type-/)||document.body.classList.add("theme-type-"+n[i].type);var s=l(a);s.type=n[i].type,s.name=i,t.asc_setSkin(s),Common.Utils.isIE10||Common.Utils.isIE11||window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",f.bind(this)),Common.NotificationCenter.on("document:ready",h.bind(this))},available:function(){return!Common.Utils.isIE&&!this.locked},setAvailable:function(t){this.locked=!t},map:function(){return n},get:function(t){return n[t]},currentThemeId:function(){if(Common.localStorage.getBool("ui-theme-use-system",!1))return"theme-system";var t=Common.localStorage.getItem("ui-theme")||Common.localStorage.getItem("ui-theme-id"),e=p(t);return n[e]?e:o},defaultThemeId:function(t){return"dark"==t?s:o},defaultTheme:function(t){return n[this.defaultThemeId(t)]},isDarkTheme:function(t){return!t&&(t=this.currentThemeId()),(u(t)?g().info.type:n[t].type)==e},isContentThemeDark:function(){return"dark"==Common.localStorage.getItem("content-theme")},setContentTheme:function(t,e){var i="dark"==t;i&&!this.isDarkTheme()||(i!=this.isContentThemeDark()||e)&&(this.api.asc_setContentDarkMode&&this.api.asc_setContentDarkMode(i),Common.localStorage.getItem("content-theme")!=t&&Common.localStorage.setItem("content-theme",t),Common.NotificationCenter.trigger("contenttheme:dark",i))},toggleContentTheme:function(){var t=this.isContentThemeDark();t?Common.localStorage.setItem("content-theme","light"):Common.localStorage.setItem("content-theme","dark"),this.api.asc_setContentDarkMode&&this.api.asc_setContentDarkMode(!t),Common.NotificationCenter.trigger("contenttheme:dark",!t)},setTheme:function(t){if(t){var e=p(t),i=arguments[1];if(!i&&u(this.currentThemeId())&&g().id==e)return Common.localStorage.setBool("ui-theme-use-system",!1),Common.localStorage.setItem("ui-theme-id",""),Common.localStorage.setItem("ui-theme-id",e),void Common.NotificationCenter.trigger("uitheme:changed",e);if(u(e)){if(g().id==this.currentThemeId())return Common.localStorage.setBool("ui-theme-use-system",!0),Common.localStorage.setItem("ui-theme-id",""),Common.localStorage.setItem("ui-theme-id",e),void Common.NotificationCenter.trigger("uitheme:changed",e);Common.localStorage.setBool("ui-theme-use-system",!0),e=g().id}else Common.localStorage.setBool("ui-theme-use-system",!1);if((this.currentThemeId()!=e||i)&&n[e]){if(document.body.className=document.body.className.replace(/theme-[\w-]+\s?/gi,"").trim(),document.body.classList.add(e,"theme-type-"+n[e].type),this.api)this.api.asc_setContentDarkMode&&("light"==n[e].type?this.api.asc_setContentDarkMode(!1):(this.api.asc_setContentDarkMode(this.isContentThemeDark()),Common.NotificationCenter.trigger("contenttheme:dark",this.isContentThemeDark()))),(t=l(a)).type=n[e].type,t.name=e,this.api.asc_setSkin(t);if(!Common.Utils.isIE10&&!Common.Utils.isIE11){var o={id:e,type:t.type,text:n[e].text};"static"!=n[e].source&&(o.colors=t),i||Common.localStorage.setItem("ui-theme",JSON.stringify(o))}i||Common.localStorage.setItem("ui-theme-id",e),Common.NotificationCenter.trigger("uitheme:changed",e)}}},toggleTheme:function(){this.setTheme(this.isDarkTheme()?o:s)}}}(Common.UI.Themes)})),define("common/main/lib/controller/Desktop",["core"],(function(){"use strict";var t={version:"7.2.1.34",eventloading:!0,titlebuttons:!0,uithemes:!0},e=window.desktop||window.AscDesktopEditor;e&&e.execCommand("webapps:features",JSON.stringify(t));Common.Controllers.Desktop=new function(){var i,n,o={version:"7.2.1.34"},s=window.DE||window.PE||window.SSE,a={"btn-save":"save","btn-save-coauth":"coauth","btn-synch":"synch"};if(e){if(e.features=e.features||{},n=window.RendererProcessVariable,window.on_native_message=function(t,n){if(/^style:change/.test(t)){if("toolbar"==(l=JSON.parse(n)).element)"off"==l.action&&"native-color"==l.style&&$(".toolbar").removeClass("editor-native-color");else if("body"==l.element&&"merge"==l.action){var a=document.createElement("style");a.innerHTML=l.style,document.body.appendChild(a)}}else if(/window:features/.test(t)){var l=JSON.parse(n);_.isNumber(l.skiptoparea)?($(".asc-window.modal").length&&$(".asc-window.modal").position().top<l.skiptoparea&&$(".asc-window.modal").css("top",l.skiptoparea),Common.Utils.InternalSettings.set("window-inactive-area-top",l.skiptoparea)):l.lockthemes,void 0!==l.singlewindow&&($("#box-document-title .hedset")[l.singlewindow?"hide":"show"](),e.features.singlewindow=l.singlewindow)}else if(/editor:config/.test(t)){if("request"==n)if(i){var r={user:o.user,title:{buttons:[]}};if(s.getController("Viewport").getView("Common.Views.Header"))for(var d in i)r.title.buttons.push(c(d,i[d]));e.execCommand("editor:config",JSON.stringify(r))}else o.callback_editorconfig||(o.callback_editorconfig=function(){setTimeout((function(){window.on_native_message(t,n)}),0)})}else if(/button:click/.test(t)){(l=JSON.parse(n)).action&&i[l.action]&&i[l.action].btn.click()}else if(/theme:changed/.test(t))Common.UI.Themes.setTheme(n);else if(/element:show/.test(t)){var h=/title:(?:(true|show)|(false|hide))/.exec(n);h&&(h[1]?$("#app-title").show():h[2]&&$("#app-title").hide())}else/althints:show/.test(t)&&/false|hide/.test(n)&&Common.NotificationCenter.trigger("hints:clear")},window.on_native_message("editor:config","request"),window.native_message_cmd)for(var l in window.native_message_cmd)window.on_native_message(l,window.native_message_cmd[l]);e.execCommand("webapps:features",JSON.stringify(t));var r=document.createElement("style");r.appendChild(document.createTextNode(".modals-mask{opacity:0 !important;}")),document.getElementsByTagName("head")[0].appendChild(r)}var c=function(t,e){return{action:t,icon:e.icon||void 0,hint:e.btn.options.hint,disabled:e.btn.isDisabled()}},d=function(t,i,n){var o={};o[t]=n,e.execCommand("title:button",JSON.stringify({disabled:o}))},h=function(t,i){e.execCommand("title:button",JSON.stringify({"icon:changed":{save:a[i.next]}}))},p=function(t){if("open"==t)e.execCommand("title:button",JSON.stringify({disabled:{all:!0}}));else{var n={};for(var o in i)n[o]=i[o].btn.isDisabled();e.execCommand("title:button",JSON.stringify({disabled:n}))}},m=function(t,n){let o={visible:t&&!(n>0)};i&&(o.hints={},i.print&&(o.hints.print=i.print.btn.btnEl.attr("data-hint-title")),i.undo&&(o.hints.undo=i.undo.btn.btnEl.attr("data-hint-title")),i.redo&&(o.hints.redo=i.redo.btn.btnEl.attr("data-hint-title")),i.save&&(o.hints.save=i.save.btn.btnEl.attr("data-hint-title"))),e.execCommand("althints:show",JSON.stringify(o))},u=function(t){Common.UI.HintManager.isHintVisible()&&(e.execCommand("althints:keydown",JSON.stringify({code:t.keyCode})),console.log("hint keydown",t.keyCode))};return{init:function(l){if(_.extend(o,l),o.isDesktopApp){let l=n&&"winxp"===n.os;Common.UI.Themes.setAvailable(!l),Common.NotificationCenter.on("app:ready",(function(t){_.extend(o,t),e&&e.execCommand("doc:onready",""),$(".toolbar").addClass("editor-native-color")})),Common.NotificationCenter.on("document:ready",(function(){if(o.isEdit){var t=s.getController("Main");t.api.asc_isReadOnly&&t.api.asc_isReadOnly()&&t.warningDocumentIsLocked()}})),Common.NotificationCenter.on("app:face",(function(n){if(t.viewmode=!n.isEdit,t.crypted=n.isCrypted,e.execCommand("webapps:features",JSON.stringify(t)),i={},n.isEdit){var l=s.getController("Viewport").getView("Common.Views.Header");if(l.btnSave){i.save={btn:l.btnSave};var r=/\s?([^\s]+)$/.exec(i.save.btn.$icon.attr("class"));r&&r.length&&(i.save.icon=a[r])}for(var c in l.btnPrint&&(i.print={btn:l.btnPrint}),l.btnUndo&&(i.undo={btn:l.btnUndo}),l.btnRedo&&(i.redo={btn:l.btnRedo}),i)i[c].btn.options.signals=["disabled"],i[c].btn.on("disabled",d.bind(this,c));i.save&&(i.save.btn.options.signals.push("icon:changed"),i.save.btn.on("icon:changed",h.bind(this)))}o.callback_editorconfig&&(o.callback_editorconfig(),delete o.callback_editorconfig),void 0!==e.features.singlewindow&&$("#box-document-title .hedset")[e.features.singlewindow?"hide":"show"]()})),Common.NotificationCenter.on({"modal:show":p.bind(this,"open"),"modal:close":p.bind(this,"close"),"uitheme:changed":function(t){if(Common.localStorage.getBool("ui-theme-use-system",!1))e.execCommand("uitheme:changed",JSON.stringify({name:"theme-system"}));else{var i=Common.UI.Themes.get(t);i&&e.execCommand("uitheme:changed",JSON.stringify({name:t,type:i.type}))}},"hints:show":m.bind(this)}),s.addListeners({FileMenu:{"item:click":function(t,i,n){"file:exit"==i?(e.execCommand("editor:event",JSON.stringify({action:"file:close"})),t.hide()):"file:open"==i&&(e.execCommand("editor:event",JSON.stringify({action:"file:open"})),t.hide())}}},{id:"desktop"}),$(document).on("keydown",u.bind(this))}},process:function(t){if(o.isDesktopApp&&e){if("goback"==t)return e.execCommand("go:folder",o.isOffline?"offline":o.customization.goback.url),!0;if("preloader:hide"==t)return e.execCommand("editor:onready",""),!0;if("create:new"==t&&"desktop://create.new"==o.createUrl)return e.execCommand("create:new",window.SSE?"cell":window.PE?"slide":"word"),!0}return!1},requestClose:function(){o.isDesktopApp&&e&&e.execCommand("editor:event",JSON.stringify({action:"file:close",url:o.customization.goback.url}))},isActive:function(){return!!e},isOffline:function(){return s.getController("Main").appOptions.isOffline},isFeatureAvailable:function(t){return!!e&&!!e[t]},call:function(t){if(e[t]){let i=[].slice.call(arguments,1);return e[t].apply(this,i)}},helpUrl:function(){if(n&&n.helpUrl){var t=window.SSE?"spreadsheeteditor":window.PE?"presentationeditor":"documenteditor";return n.helpUrl+"/"+t+"/main/resources/help"}}}}})),define("text",["module"],(function(t){"use strict";var e,i,n,o,s,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,r=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,p=c&&(location.port||void 0),m={},u=t.config&&t.config()||{};return e={version:"2.0.10",strip:function(t){if(t){var e=(t=t.replace(l,"")).match(r);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=a[e];try{t=new ActiveXObject(i)}catch(t){}if(t){a=[i];break}}return t},parseName:function(t){var e,i,n,o=!1,s=t.indexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");return-1!==s&&(!a||s>1)?(e=t.substring(0,s),i=t.substring(s+1,t.length)):e=t,-1!==(s=(n=i||e).indexOf("!"))&&(o="strip"===n.substring(s+1),n=n.substring(0,s),i?i=n:e=n),{moduleName:e,ext:i,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,o){var s,a,l,r=e.xdRegExp.exec(t);return!r||(s=r[2],l=(a=(a=r[3]).split(":"))[1],a=a[0],!(s&&s!==i||a&&a.toLowerCase()!==n.toLowerCase()||(l||a)&&l!==o))},finishLoad:function(t,i,n,o){n=i?e.strip(n):n,u.isBuild&&(m[t]=n),o(n)},load:function(t,i,n,o){if(!o.isBuild||o.inlineText){u.isBuild=o.isBuild;var s=e.parseName(t),a=s.moduleName+(s.ext?"."+s.ext:""),l=i.toUrl(a),r=u.useXhr||e.useXhr;0!==l.indexOf("empty:")?!c||r(l,d,h,p)?e.get(l,(function(i){e.finishLoad(t,s.strip,i,n)}),(function(t){n.error&&n.error(t)})):i([a],(function(t){e.finishLoad(s.moduleName+"."+s.ext,s.strip,t,n)})):n()}else n()},write:function(t,i,n,o){if(m.hasOwnProperty(i)){var s=e.jsEscape(m[i]);n.asModule(t+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(t,i,n,o,s){var a=e.parseName(i),l=a.ext?"."+a.ext:"",r=a.moduleName+l,c=n.toUrl(a.moduleName+l)+".js";e.load(r,n,(function(i){var n=function(t){return o(c,t)};n.asModule=function(t,e){return o.asModule(t,c,e)},e.write(t,r,n,s)}),s)}},"node"===u.env||!u.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),e.get=function(t,e,n){try{var o=i.readFileSync(t,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),e(o)}catch(t){n(t)}}):"xhr"===u.env||!u.env&&e.createXhr()?e.get=function(t,i,n,o){var s,a=e.createXhr();if(a.open("GET",t,!0),o)for(s in o)o.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),o[s]);u.onXhr&&u.onXhr(a,t),a.onreadystatechange=function(e){var o,s;4===a.readyState&&((o=a.status)>399&&o<600?((s=new Error(t+" HTTP status: "+o)).xhr=a,n(s)):i(a.responseText),u.onXhrComplete&&u.onXhrComplete(a,t))},a.send(null)}:"rhino"===u.env||!u.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,n,o=new java.io.File(t),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),"utf-8")),l="";try{for(i=new java.lang.StringBuffer,(n=a.readLine())&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);l=String(i.toString())}finally{a.close()}e(l)}:("xpconnect"===u.env||!u.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in n,e.get=function(t,e){var i,a,l,r={};s&&(t=t.replace(/\//g,"\\")),l=new FileUtils.File(t);try{(i=n["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream)).init(l,1,0,!1),(a=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream)).init(i,"utf-8",i.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(i.available(),r),a.close(),i.close(),e(r.value)}catch(t){throw new Error((l&&l.path||"")+": "+t)}}),e})),define("text!common/main/lib/template/Header.template",[],(function(){return'<div id="header-container">\n    <div id="header-logo"></div>\n    <div id="header-caption"><div><%= headerCaption %></div></div>\n    <div id="header-documentcaption"><div><%= documentCaption %></div></div>\n    <div id="header-back" style="display: <%= canBack ? \'table-cell\' : \'none\' %>;"><div><%= textBack %></div></div>\n</div>'})),void 0===Common)var Common={};if(define("common/main/lib/component/BaseView",["backbone"],(function(t){"use strict";Common.UI=_.extend(Common.UI||{},{Keys:{BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,HOME:36,END:35,SPACE:32,PAGEUP:33,PAGEDOWN:34,INSERT:45,EQUALITY_FF:61,NUM_PLUS:107,NUM_MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MINUS_FF:173,EQUALITY:187,MINUS:189},BaseView:t.View.extend({isSuspendEvents:!1,initialize:function(t){this.options=this.options?_({}).extend(this.options,t):t},setVisible:function(t){return this[t?"show":"hide"]()},isVisible:function(){return $(this.el).is(":visible")},suspendEvents:function(){this.isSuspendEvents=!0},resumeEvents:function(){this.isSuspendEvents=!1}}),getId:function(t){return _.uniqueId(t||"asc-gen")}})})),void 0===Common)var Common={};if(define("common/main/lib/component/CheckBox",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.CheckBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,indeterminate:!1,checked:!1,value:"unchecked",template:e.template('<label class="checkbox-indeterminate"><input id="<%= id %>" type="checkbox" class="checkbox__native"><label for="<%= id %>" class="checkbox__shape" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>"></label><span></span></label>'),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.options.el&&this.render()},render:function(t){var e=this;if(!e.rendered){var i=this.template({id:Common.UI.getId("chb-"),dataHint:e.options.dataHint,dataHintDirection:e.options.dataHintDirection,dataHintOffset:e.options.dataHintOffset});t?(this.setElement(t,!1),t.html(i)):e.$el.html(i),this.$chk=e.$el.find("input[type=checkbox]"),this.$label=e.$el.find("label.checkbox-indeterminate"),this.$span=e.$label.find("span"),this.$chk.on("click",this.onItemCheck.bind(this)),this.$label.on("keydown",this.onKeyDown.bind(this)),this.rendered=!0}return this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.value&&this.setValue(this.options.value,!0),this.setCaption(this.options.labelText),this},setDisabled:function(t){this.rendered&&((t=!0===t)!==this.disabled&&(this.$label.toggleClass("disabled",t),t?this.$chk.attr({disabled:t}):this.$chk.removeAttr("disabled"),void 0!==this.tabindex&&(t&&(this.tabindex=this.$label.attr("tabindex")),this.$label.attr("tabindex",t?"-1":this.tabindex))),this.disabled=t)},isDisabled:function(){return this.disabled},onItemCheck:function(t){this.disabled||(this.indeterminate?(this.indeterminate=!1,this.setValue(!1)):this.setValue(!this.checked))},setRawValue:function(t){this.checked=!0===t||"true"===t||"1"===t||1===t||"checked"===t,this.indeterminate="indeterminate"===t,this.value=this.indeterminate?"indeterminate":this.checked?"checked":"unchecked",this.$chk.prop({indeterminate:this.indeterminate,checked:this.checked})},setValue:function(t,e){this.rendered?t!=this.value&&(this.lastValue=this.value,this.setRawValue(t),!0!==e&&this.trigger("change",this,this.value,this.lastValue)):this.options.value=t},getValue:function(){return this.value},isChecked:function(){return this.checked},setCaption:function(t){this.$span.text(t),this.$span.css("visibility",t?"visible":"hidden")},onKeyDown:function(t){t.isDefaultPrevented()||t.keyCode===Common.UI.Keys.SPACE&&this.onItemCheck(t)},focus:function(){this.$label&&this.$label.focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this.$label.attr("tabindex",this.tabindex))}})})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.FocusManager=new function(){var t=[],e=0,i=function(t){var e=[];return t.forEach||(t=[t]),t.forEach((function(t){if(t){var i={};t.cmp&&"string"==typeof t.selector?i=t:(i.cmp=t,t instanceof Common.UI.ListView?i.selector=".listview":t instanceof Common.UI.CheckBox?i.selector=".checkbox-indeterminate":t instanceof Common.UI.RadioBox?i.selector=".radiobox":t instanceof Common.UI.TreeView?i.selector=".treeview":t instanceof Common.UI.Button?i.selector="button":i.selector=".form-control"),i.el=(i.cmp.$el||$(i.cmp.el||i.cmp)).find(i.selector).addBack().filter(i.selector),i.el&&i.el.attr&&(i.cmp.setTabIndex?i.cmp.setTabIndex(1):i.el.attr("tabindex",1..toString())),e.push(i)}})),e},n=function(t){if(t&&!t.traps&&t.fields&&!(t.fields.length<1)){var e=$('<span aria-hidden="true" tabindex="1"></span>');e.on("focus",(function(){if(!t.hidden)for(var e=t.fields,i=e.length-1;i>=0;i--){var n=e[i];if((n.cmp.isVisible?n.cmp.isVisible():n.cmp.is(":visible"))&&(!n.cmp.isDisabled||!n.cmp.isDisabled())){var o=n.selector?(n.cmp.$el||$(n.cmp.el||n.cmp)).find(n.selector).addBack().filter(n.selector):n.el;o&&setTimeout((function(){o.focus()}),10);break}}})),t.parent.$window.prepend(e);var i=$('<span aria-hidden="true" tabindex="2"></span>');i.on("focus",(function(){if(!t.hidden)for(var e=t.fields,i=0;i<e.length;i++){var n=e[i];if((n.cmp.isVisible?n.cmp.isVisible():n.cmp.is(":visible"))&&(!n.cmp.isDisabled||!n.cmp.isDisabled())){var o=n.selector?(n.cmp.$el||$(n.cmp.el||n.cmp)).find(n.selector).addBack().filter(n.selector):n.el;o&&setTimeout((function(){o.focus()}),10);break}}})),t.parent.$window.append(i),t.traps=[e,i]}},o=function(i){var n=i?1:-1;for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];s&&s.index<e-1&&s.traps&&s.traps[1].attr("tabindex",(parseInt(s.traps[1].attr("tabindex"))+n).toString())}};return{init:function(){Common.NotificationCenter.on({"modal:show":function(i){i&&i.cid&&(t[i.cid]?t[i.cid].hidden=!1:(t[i.cid]={parent:i,hidden:!1,index:e++},o(!0)))},"window:show":function(e){e&&e.cid&&t[e.cid]&&!t[e.cid].fields&&(t[e.cid].fields=i(e.getFocusedComponents()),n(t[e.cid]));var o=e?e.getDefaultFocusableComponent():null;o&&setTimeout((function(){o.focus()}),100)},"modal:close":function(i,n){i&&i.cid&&t[i.cid]&&(o(!1),delete t[i.cid],e--)},"modal:hide":function(e,i){e&&e.cid&&t[e.cid]&&(t[e.cid].hidden=!0)}})},add:function(o,s){o&&o.cid&&(t[o.cid]?t[o.cid].fields=(t[o.cid].fields||[]).concat(i(s)):t[o.cid]={parent:o,fields:i(s),hidden:!1,index:e++},n(t[o.cid]))}}},define("common/main/lib/controller/FocusManager",(function(){})),void 0===Common)var Common={};if(define("common/main/lib/component/Window",["common/main/lib/component/BaseView","common/main/lib/component/CheckBox","common/main/lib/controller/FocusManager"],(function(){"use strict";Common.UI.Window=Common.UI.BaseView.extend(_.extend(function(){var t={closable:!0,header:!0,modal:!0,width:"auto",height:"auto",title:"Title",alias:"Window",cls:"",toolclose:"close",help:!1,maxwidth:void 0,maxheight:void 0,minwidth:0,minheight:0,enableKeyEvents:!0};function e(){var t=$(".modals-mask");return 0==t.length&&(t=$("<div class='modals-mask'>").appendTo(document.body).hide()).attr("counter",0),t}function i(t){if(!this.isLocked()&&this.isVisible()&&this.initConfig.enableKeyEvents&&!1!==this.pauseKeyEvents)switch(t.keyCode){case Common.UI.Keys.ESC:if($(".asc-loadmask").length<1)return t.preventDefault(),t.stopPropagation(),!1!==this.initConfig.closable&&(this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):"hide"==this.initConfig.toolclose?this.hide():this.close()),!1;break;case Common.UI.Keys.RETURN:if(this.$window.find(".btn.primary").length&&$(".asc-loadmask").length<1&&!1===(this.initConfig.onprimary||this.onPrimary).call(this))return t.preventDefault(),!1}}function n(){if(null==window.innerHeight)var t=document.documentElement.offsetWidth,e=document.documentElement.offsetHeight;else t=Common.Utils.innerWidth(),e=Common.Utils.innerHeight();return{width:t,height:e-=Common.Utils.InternalSettings.get("window-inactive-area-top"),top:Common.Utils.InternalSettings.get("window-inactive-area-top")}}function o(){if("auto"==this.initConfig.height){var t=Math.ceil(parseFloat(this.$window.find("> .body").css("height")));this.initConfig.header&&(t+=parseInt(this.$window.find("> .header").css("height"))),this.$window.height(t)}}function s(){var t=n(),e=t.width,i=t.height;if("auto"==this.initConfig.height){var o=parseInt(this.$window.find(".body").css("height"));this.initConfig.header&&(o+=parseInt(this.$window.find(".header").css("height")))}else(o=this.initConfig.height)>i&&(o=i);var s="auto"==this.initConfig.width?parseInt(this.$window.find(".body").css("width")):this.initConfig.width,a=t.top+Math.floor((parseInt(i)-parseInt(o))/2),l=Math.floor((parseInt(e)-parseInt(s))/2);this.$window.css("left",l),this.$window.css("top",a)}function a(){var t=n(),e=t.width,i=t.height;this.getLeft()+this.getWidth()>e&&this.$window.css("left",e-this.getWidth()),this.getTop()<t.top?this.$window.css("top",t.top):this.getTop()+this.getHeight()>i&&(i-this.getHeight()<0?this.$window.css("top",t.top):this.$window.css("top",t.top+i-this.getHeight()))}function l(t){return{"-webkit-transition":"0.3s opacity","-moz-transition":"0.3s opacity","-ms-transition":"0.3s opacity","-o-transition":"0.3s opacity",opacity:t}}function r(t){if(!$(t.target).hasClass("close")&&!$(t.target).hasClass("help")){Common.UI.Menu.Manager.hideAll();var e=t instanceof jQuery.Event?Common.Utils.zoom():1;this.dragging.enabled=!0,this.dragging.initx=t.pageX*e-this.getLeft(),this.dragging.inity=t.pageY*e-this.getTop();var i=n(),o=i.width,s=i.height;this.dragging.maxx=o-this.getWidth(),this.dragging.maxy=s-this.getHeight(),this.dragging.maxy<0&&(this.dragging.maxy=0),this.dragging.maxy+=i.top,$(document).on("mousemove",this.binding.drag),$(document).on("mouseup",this.binding.dragStop),this.fireEvent("drag",[this,"start"])}}function c(){$(document).off("mousemove",this.binding.drag),$(document).off("mouseup",this.binding.dragStop),this.dragging.enabled=!1,this.fireEvent("drag",[this,"end"])}function d(t){if(this.dragging.enabled){var e=t instanceof jQuery.Event?Common.Utils.zoom():1,i=t.pageX*e-this.dragging.initx,n=t.pageY*e-this.dragging.inity,o=Common.Utils.InternalSettings.get("window-inactive-area-top");i<0?i=0:i>this.dragging.maxx&&(i=this.dragging.maxx),n<o?n=o:n>this.dragging.maxy&&(n=this.dragging.maxy),this.$window.css({left:i,top:n})}}function h(t){"mouseup"==t.type&&this.dragging.enabled&&c.call(this)}function p(t){Common.UI.Menu.Manager.hideAll();var e=$(t.target),i=this.getLeft(),o=this.getTop();this.resizing.enabled=!0,this.resizing.initpage_x=t.pageX*Common.Utils.zoom(),this.resizing.initpage_y=t.pageY*Common.Utils.zoom(),this.resizing.initx=this.resizing.initpage_x-i,this.resizing.inity=this.resizing.initpage_y-o,this.resizing.initw=this.getWidth(),this.resizing.inith=this.getHeight(),this.resizing.type=[e.hasClass("left")?-1:e.hasClass("right")?1:0,e.hasClass("top")?-1:e.hasClass("bottom")?1:0];var s=n(),a=s.width,l=s.height,r=this.initConfig.maxwidth?this.initConfig.maxwidth:a,c=this.initConfig.maxheight?this.initConfig.maxheight:l;this.resizing.minw=this.initConfig.minwidth,this.resizing.maxw=this.resizing.type[0]>0?Math.min(a-i,r):Math.min(i+this.resizing.initw,r),this.resizing.minh=this.initConfig.minheight,this.resizing.maxh=this.resizing.type[1]>0?Math.min(l-o,c):Math.min(o+this.resizing.inith,c),$(document.body).css("cursor",e.css("cursor")),this.$window.find(".resize-border").addClass("resizing"),this.$window.find(".header").addClass("resizing"),$(document).on("mousemove",this.binding.resize),$(document).on("mouseup",this.binding.resizeStop),this.fireEvent("resize",[this,"start"])}function m(t){if(this.resizing.enabled){var e=!1,i=t instanceof jQuery.Event?Common.Utils.zoom():1,n=t.pageX*i,o=t.pageY*i;if(this.resizing.type[0]){var s=this.resizing.initw+(n-this.resizing.initpage_x)*this.resizing.type[0];s>this.resizing.maxw?(n-=(s-this.resizing.maxw)*this.resizing.type[0],s=this.resizing.maxw):s<this.resizing.minw&&(n-=(s-this.resizing.minw)*this.resizing.type[0],s=this.resizing.minw),this.resizing.type[0]<0&&this.$window.css({left:n-this.resizing.initx}),this.setWidth(s),e=!0}if(this.resizing.type[1]){var a=this.resizing.inith+(o-this.resizing.initpage_y)*this.resizing.type[1];a>this.resizing.maxh?(o-=(a-this.resizing.maxh)*this.resizing.type[1],a=this.resizing.maxh):a<this.resizing.minh&&(o-=(a-this.resizing.minh)*this.resizing.type[1],a=this.resizing.minh),this.resizing.type[1]<0&&this.$window.css({top:o-this.resizing.inity}),this.setHeight(a),e=!0}e&&this.fireEvent("resizing")}}function u(){$(document).off("mousemove",this.binding.resize),$(document).off("mouseup",this.binding.resizeStop),$(document.body).css("cursor","auto"),this.$window.find(".resize-border").removeClass("resizing"),this.$window.find(".header").removeClass("resizing"),this.resizing.enabled=!1,this.fireEvent("resize",[this,"end"])}return Common.UI.alert=function(t){this.Window.prototype;t.buttons||(t.buttons=["ok"]),t.dontshow=t.dontshow||!1,t.width||(t.width="auto");_.extend(t,{cls:"alert",onprimary:function(t){return n({currentTarget:e.getChild(".footer .dlg-btn")[0]}),!1},tpl:_.template('<div class="info-box"><% if (typeof iconCls !== "undefined") { %><div class="icon <%= iconCls %>"></div><% } %><div class="text" <% if (typeof iconCls == "undefined") { %> style="padding-left:10px;" <% } %>><span><%= msg %></span><% if (dontshow) { %><div class="dont-show-checkbox"></div><% } %></div></div><% if (dontshow) { %><div class="separator horizontal" style="width: 100%;"></div><% } %>')(t)});var e=new Common.UI.Window(t),i=null;function n(n){t.callback&&t.callback.call(e,n.currentTarget.attributes.result.value,!!i&&"checked"==i.getValue()),e.close(!0)}return e.on({"render:after":function(o){var s=o.getChild(".footer");t.dontshow&&s.addClass("dontshow"),s.find(".dlg-btn").on("click",n),i=new Common.UI.CheckBox({el:e.$window.find(".dont-show-checkbox"),labelText:t.textDontShow||e.textDontShow}),function(e){var i=e.getChild(".info-box"),n=e.getChild(".info-box .text > span"),o=e.getChild(".footer"),s=e.getChild(".header"),a=e.getChild(".body"),l=e.getChild(".icon"),r=l.length>0?l.height():0,c=e.getChild(".info-box .dont-show-checkbox");if(t.dontshow||a.css("padding-bottom","10px"),t.maxwidth&&"auto"==t.width&&n.position().left+n.width()+parseInt(i.css("padding-right"))>t.maxwidth&&(t.width=t.maxwidth),"auto"==t.width){i.height(Math.max(n.height(),r)+(c.length>0?c.height()+parseInt(c.css("margin-top")):0)),a.height(parseInt(i.css("height"))+parseInt(o.css("height")));var d=c.find("span");e.setSize(Math.max(n.width(),d.length>0?d.position().left+d.width():0)+n.position().left+parseInt(i.css("padding-right")),parseInt(a.css("height"))+parseInt(s.css("height")))}else n.css("white-space","normal"),e.setWidth(t.width),i.height(Math.max(n.height(),r)+(c.length>0?c.height()+parseInt(c.css("margin-top")):0)),a.height(parseInt(i.css("height"))+parseInt(o.css("height"))),e.setHeight(parseInt(a.css("height"))+parseInt(s.css("height")));n.height()<r-10&&n.css({"vertical-align":"baseline","line-height":r+"px"})}(o)},show:function(t){t.getChild(".footer .dlg-btn").focus()},close:function(){t.callback&&t.callback.call(e,"close")}}),e.show(),e},Common.UI.error=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textError),Common.UI.alert(_.extend(t,{iconCls:"error"}))},Common.UI.confirm=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textConfirmation),Common.UI.alert(_.extend(t,{iconCls:"confirm"}))},Common.UI.info=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textInformation),Common.UI.alert(_.extend(t,{iconCls:"info"}))},Common.UI.warning=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textWarning),Common.UI.alert(_.extend(t,{iconCls:"warn"}))},{$window:void 0,$lastmodal:void 0,dragging:{enabled:!1},resizing:{enabled:!1},initialize:function(e){this.initConfig={},this.binding={};var i={ok:this.okButtonText,cancel:this.cancelButtonText,yes:this.yesButtonText,no:this.noButtonText,close:this.closeButtonText};if(e.buttons&&_.isArray(e.buttons)){null==e.primary&&(e.primary="ok");var n={};_.each(e.buttons,(function(t){"object"==typeof t?void 0!==t.value&&(n[t.value]={text:t.caption,cls:"custom"+(t.primary||e.primary==t.value?" primary":"")}):(n[t]={text:"custom"==t?e.customButtonText:i[t],cls:e.primary==t||_.indexOf(e.primary,t)>-1?"primary":""},"custom"==t&&(n[t].cls+=" custom"))})),e.buttons=n,e.footerCls=e.footerCls||"center"}_.extend(this.initConfig,t,e||{}),!this.initConfig.id&&(this.initConfig.id="window-"+this.cid),!this.initConfig.tpl&&(this.initConfig.tpl=""),Common.UI.BaseView.prototype.initialize.call(this,this.initConfig)},render:function(){var t=this.initConfig.renderTo||document.body;if($(t).append(_.template('<div class="asc-window<%= modal?" modal":"" %><%= cls?" "+cls:"" %>" id="<%= id %>" style="width:<%= width %>px;"><% if (header==true) { %><div class="header"><div class="tools"><% if (closable!==false) %><div class="tool close"></div><% %><% if (help===true) %><div class="tool help">?</div><% %></div><div class="title"><%= title %></div> </div><% } %><div class="body"><%= tpl %><% if (typeof (buttons) !== "undefined" && _.size(buttons) > 0) { %><div class="footer"><% for(var bt in buttons) { %><button class="btn normal dlg-btn <%= buttons[bt].cls %>" result="<%= bt %>"><%= buttons[bt].text %></button><% } %></div><% } %></div></div>')(this.initConfig)),this.$window=$("#"+this.initConfig.id),Common.Locale.getCurrentLanguage()&&"en"!==Common.Locale.getCurrentLanguage()&&this.$window.attr("applang",Common.Locale.getCurrentLanguage()),this.binding.keydown=_.bind(i,this),this.initConfig.header){this.binding.drag=_.bind(d,this),this.binding.dragStop=_.bind(c,this),this.binding.dragStart=_.bind(r,this);this.$window.find(".header").on("mousedown",this.binding.dragStart),this.$window.find(".tool.close").on("click",_.bind((function(){this.$window.find(".tool.close").hasClass("disabled")||(this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):"hide"==this.initConfig.toolclose?this.hide():this.close())}),this)),this.$window.find(".tool.help").on("click",_.bind((function(){this.$window.find(".tool.help").hasClass("disabled")||this.fireEvent("help",this)}),this)),this.initConfig.modal||Common.Gateway.on("processmouse",_.bind(h,this))}else this.$window.find(".body").css({top:0,"border-radius":"5px"});"auto"!==this.initConfig.height&&this.$window.css("height",this.initConfig.height),this.initConfig.resizable&&this.setResizable(this.initConfig.resizable);var e=this;return this.binding.winclose=function(t){e.$window&&e.isVisible()&&e.$window==t.$window&&e.close()},Common.NotificationCenter.on("window:close",this.binding.winclose),this.initConfig.footerCls&&this.$window.find(".footer").addClass(this.initConfig.footerCls),this.menuAddAlign=function(t,i,n){var o=this;e.$window.hasClass("notransform")?(t.css({left:i,top:n}),o.options.additionalAlign=null):(e.$window.addClass("notransform"),t.addClass("hidden"),setTimeout((function(){t.removeClass("hidden"),t.css({left:i,top:n}),o.options.additionalAlign=null}),300))},this.fireEvent("render:after",this),this},show:function(t,i){if(this.initConfig.modal){var n=e();if(!1===this.options.animate||this.options.animate&&!1===this.options.animate.mask)n.attr("counter",parseInt(n.attr("counter"))+1),n.show();else{var r=$(":root").css("--modal-window-mask-opacity");n.css("opacity",0),n.attr("counter",parseInt(n.attr("counter"))+1),n.show(),setTimeout((function(){n.css(l(r))}),1)}Common.NotificationCenter.trigger("modal:show",this),this.$lastmodal=$(".asc-window.modal:not(.dethrone):visible").first().addClass("dethrone")}this.$window?this.$window.is(":visible")||(this.$window.css({opacity:0}),a.call(this),this.$window.show()):(this.render(),o.call(this),_.isNumber(t)&&_.isNumber(i)?(this.$window.css("left",Math.floor(t)),this.$window.css("top",Math.floor(i))):s.call(this)),$(document).on("keydown."+this.cid,this.binding.keydown);var c=this;setTimeout((function(){c.fireEvent("animate:before",c)}),10),!1!==this.options.animate?(this.$window.css({"-webkit-transform":"scale(0.8)","-moz-transform":"scale(0.8)","-ms-transform":"scale(0.8)","-o-transform":"scale(0.8)",opacity:0}),setTimeout((function(){c.$window.css({"-webkit-transition":"0.2s opacity, 0.2s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":"0.2s opacity, 0.2s -moz-transform","-moz-transform":"scale(1)","-ms-transition":"0.2s opacity, 0.2s -ms-transform","-ms-transform":"scale(1)","-o-transition":"0.2s opacity, 0.2s -o-transform","-o-transform":"scale(1)",opacity:"1"}),setTimeout((function(){c.fireEvent("animate:after",c)}),210)}),1),setTimeout((function(){c.$window.addClass("notransform"),c.fireEvent("show",c)}),this.initConfig.modal?1e3:350)):(this.$window.css({opacity:1}),this.$window.addClass("notransform"),this.fireEvent("show",this),setTimeout((function(){c.fireEvent("animate:after",c)}),10)),Common.NotificationCenter.trigger("window:show",this)},close:function(t){if($(document).off("keydown."+this.cid),this.initConfig.header&&this.$window.find(".header").off("mousedown",this.binding.dragStart),Common.NotificationCenter.off({"window:close":this.binding.winclose}),this.initConfig.modal){var i=e(),n=!0;if(i.attr("counter",parseInt(i.attr("counter"))-1),this.$lastmodal.length>0&&(this.$lastmodal.removeClass("dethrone"),n=!(this.$lastmodal.hasClass("modal")&&this.$lastmodal.is(":visible"))),n)if(!1!==this.options.animate){var o=$(":root").css("--modal-window-mask-opacity");i.css(l(0)),setTimeout((function(){parseInt(i.attr("counter"))<1&&(i.css("opacity",o),i.hide(),i.attr("counter",0))}),300)}else parseInt(i.attr("counter"))<1&&(i.hide(),i.attr("counter",0));Common.NotificationCenter.trigger("modal:close",this,n&&parseInt(i.attr("counter"))<1)}this.$window.remove(),!0!==t&&this.fireEvent("close",this)},hide:function(){if($(document).off("keydown."+this.cid),this.$window){if(this.initConfig.modal){var t=e(),i=!0;if(t.attr("counter",parseInt(t.attr("counter"))-1),this.$lastmodal.length>0&&(this.$lastmodal.removeClass("dethrone"),i=!(this.$lastmodal.hasClass("modal")&&this.$lastmodal.is(":visible"))),i)if(!1!==this.options.animate){var n=$(":root").css("--modal-window-mask-opacity");t.css(l(0)),setTimeout((function(){parseInt(t.attr("counter"))<1&&(t.css("opacity",n),t.hide(),t.attr("counter",0))}),300)}else parseInt(t.attr("counter"))<1&&(t.hide(),t.attr("counter",0));Common.NotificationCenter.trigger("modal:hide",this,i&&parseInt(t.attr("counter"))<1)}this.$window.hide(),this.$window.removeClass("notransform"),this.fireEvent("hide",this)}},isLocked:function(){return this.$window.hasClass("dethrone")||!this.initConfig.modal&&this.$window.parent().find(".asc-window.modal:visible").length},getChild:function(t){return t?this.$window.find(t):this.$window},setWidth:function(t){if(t>=0){var e=parseInt(this.$window.css("min-width"));t<e&&(t=e),t-=parseInt(this.$window.css("border-left-width"))+parseInt(this.$window.css("border-right-width")),this.$window.width(t)}},getWidth:function(){return parseInt(this.$window.css("width"))},setHeight:function(t){if(t>=0){var e=parseInt(this.$window.css("min-height"));t<e&&(t=e),t-=parseInt(this.$window.css("border-bottom-width"))+parseInt(this.$window.css("border-top-width")),this.$window.height(t),this.initConfig.header&&(t-=parseInt(this.$window.find("> .header").css("height"))),this.$window.find("> .body").css("height",t)}},getHeight:function(){return parseInt(this.$window.css("height"))},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},getSize:function(){return[this.getWidth(),this.getHeight()]},setTitle:function(t){this.$window.find("> .header > .title").text(t)},getTitle:function(){return this.$window.find("> .header > .title").text()},getLeft:function(){return parseInt(this.$window.css("left"))},getTop:function(){return parseInt(this.$window.css("top"))},isVisible:function(){return this.$window&&this.$window.is(":visible")},setResizable:function(t,e,i){if(t!==this.resizable){if(t){var n='<div class="resize-border left" style="top:'+(this.initConfig.header?"33":"5")+'px; bottom: 5px; height: auto; border-right-style: solid; cursor: w-resize;"></div><div class="resize-border left bottom" style="border-bottom-left-radius: 5px; cursor: sw-resize;"></div><div class="resize-border bottom" style="left: 4px; right: 4px; width: auto; z-index: 2; border-top-style: solid; cursor: s-resize;"></div><div class="resize-border right bottom" style="border-bottom-right-radius: 5px; cursor: se-resize;"></div><div class="resize-border right" style="top:'+(this.initConfig.header?"33":"5")+'px; bottom: 5px; height: auto; border-left-style: solid; cursor: e-resize;"></div><div class="resize-border left top" style="border-top-left-radius: 5px; cursor: nw-resize;"></div><div class="resize-border top" style="left: 4px; right: 4px; width: auto; z-index: 2; border-bottom-style:'+(this.initConfig.header?"none":"solid")+'; cursor: n-resize;"></div><div class="resize-border right top" style="border-top-right-radius: 5px; cursor: ne-resize;"></div>';this.initConfig.header&&(n+='<div class="resize-border left" style="top: 5px; height: 28px; cursor: w-resize;"></div><div class="resize-border right" style="top: 5px; height: 28px; cursor: e-resize;"></div>'),this.$window.append(_.template(n)),this.binding.resize=_.bind(m,this),this.binding.resizeStop=_.bind(u,this),this.binding.resizeStart=_.bind(p,this),e&&e.length>1&&(this.initConfig.minwidth=e[0]),e&&e.length>1&&(this.initConfig.minheight=e[1]),i&&i.length>1&&(this.initConfig.maxwidth=i[0]),i&&i.length>1&&(this.initConfig.maxheight=i[1]),this.$window.find(".resize-border").on("mousedown",this.binding.resizeStart)}else this.$window.find(".resize-border").remove();this.resizable=t}else t&&(e&&e.length>1&&(this.initConfig.minwidth=e[0]),e&&e.length>1&&(this.initConfig.minheight=e[1]),i&&i.length>1&&(this.initConfig.maxwidth=i[0]),i&&i.length>1&&(this.initConfig.maxheight=i[1]))},suspendKeyEvents:function(){this.pauseKeyEvents=!1},resumeKeyEvents:function(){this.initConfig.enableKeyEvents&&(this.pauseKeyEvents=!0)},onPrimary:function(){},getFocusedComponents:function(){return[]},getDefaultFocusableComponent:function(){},cancelButtonText:"Cancel",okButtonText:"OK",yesButtonText:"Yes",noButtonText:"No",closeButtonText:"Close",textWarning:"Warning",textError:"Error",textConfirmation:"Confirmation",textInformation:"Information",textDontShow:"Don't show this message again"}}(),Common.UI.Window||{}))})),define("common/main/lib/view/RenameDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.RenameDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",filename:"",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+this.textName+"</label>","</div>",'<div id="id-dlg-newname" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputName=new Common.UI.InputField({el:$("#id-dlg-newname"),style:"width: 100%;",validateOnBlur:!1,maxLength:t.options.maxLength,validation:function(e){return!/[\t*\+:\"<>?|\\\\/]/gim.test(e)||t.txtInvalidName+'*+:"<>?|/'}});var e=this.getChild();e.find(".btn").on("click",_.bind(this.onBtnClick,this)),t.inputNameEl=e.find("input")},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this,e=t.options.filename.lastIndexOf(".");e>0&&(t.options.filename=t.options.filename.substring(0,e)),_.delay((function(){t.inputName.setValue(t.options.filename),t.inputNameEl.focus().select()}),100)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputName.checkValidate())return void this.inputNameEl.focus();this.options.handler.call(this,t,this.inputName.getValue())}this.close()},textName:"File name",txtInvalidName:"The file name cannot contain any of the following characters: "},Common.Views.RenameDialog||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Header",["backbone","text!common/main/lib/template/Header.template","core","common/main/lib/view/RenameDialog"],(function(t,e){"use strict";Common.Views.Header=t.View.extend(_.extend(function(){var t,i,n,o,s,a,l,r=!1,c=_.template("<ul><% for (originalId in users) { %><%= usertpl({user: users[originalId][0], fnEncode: fnEncode, len: users[originalId].length}) %><% } %></ul>");function d(t,e){var a=t.getVisibleEditingCount();n&&(a>1&&i&&(i.isEdit||i.isRestrictedEdit)?(n.html(c({users:t.chain().filter((function(t){return t.get("online")&&!t.get("view")&&!t.get("hidden")})).groupBy((function(t){return t.get("idOriginal")})).value(),usertpl:_.template('<li id="<%= user.get("iid") %>" class="<% if (!user.get("online")) { %> offline <% } if (user.get("view")) {%> viewmode <% } %>"><div class="user-name"><div class="color" style="background-color: <%= user.get("color") %>;"></div><label><%= fnEncode(user.get("username")) %></label><% if (len>1) { %><label style="margin-left:3px;">(<%=len%>)</label><% } %></div></li>'),fnEncode:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))}})),n.scroller=new Common.UI.Scroller({el:n.find("ul"),useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0}),n.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})):n.empty()),function(t,e){if(!s)return;t>1&&i&&(i.isEdit||i.isRestrictedEdit)?(o.show(),s.find(".caption").html(e)):o.hide();u(i)}(a,t.getVisibleEditingOriginalCount())}function h(t){d(t.collection)}function p(){r=!0,this.btnShare&&this.btnShare.setVisible(!1),u(i)}function m(t){var e=s.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}function u(t){if(l&&t){var e=l.parent();if(t.isEdit){if(!t.customization||!t.customization.compactHeader){o=e.position().left,s=e.next().outerWidth();var i=l.outerWidth(),n=l[0].style.width;(n=n?parseFloat(n):i)-i>.1?(e.css("padding-left",o<s?Math.max(2,e.outerWidth()-2-n):2),e.css("padding-right",o<s?2:Math.max(2,e.outerWidth()-2-n))):(e.css("padding-left",o<s?Math.max(2,Math.min(s-o+2,e.outerWidth()-2-n)):2),e.css("padding-right",o<s?2:Math.max(2,Math.min(o-s+2,e.outerWidth()-2-n))))}}else{var o=e.position().left,s=e.next().outerWidth();e.css("padding-left",o<s?Math.max(2,s-o):2),e.css("padding-right",o<s?2:Math.max(2,o-s))}if((!t.customization||!t.customization.toolbarHideFileName)&&(!t.isEdit||t.customization&&t.customization.compactHeader)){var a=parseFloat(e.css("padding-left")||0)+parseFloat(e.css("padding-right")||0)+parseInt(l.css("min-width")||50);t.isCrypted&&(a+=20),e.css("flex-basis",Math.ceil(a)+"px"),e.closest(".extra.right").css("flex-basis",Math.ceil(a)+e.next().outerWidth()+"px"),Common.NotificationCenter.trigger("tab:resize")}}}function g(){!i||!i.isEdit||i.customization&&i.customization.compactHeader||u(i)}function f(t){l&&(t.isCrypted&&(l.before('<div class="inner-box-icon crypted hidden"><svg class="icon"><use xlink:href="#svg-icon-crypted"></use></svg></div>'),this.imgCrypted=l.parent().find(".crypted"),this._showImgCrypted=!0),u(t))}function b(e){i=e;var a=this;if(a.btnGoBack.on("click",(function(t){Common.NotificationCenter.trigger("goback")})),a.btnFavorite.on("click",(function(t){Common.NotificationCenter.trigger("markfavorite",!a.options.favorite)})),a.btnShare&&(a.btnShare.on("click",(function(t){Common.NotificationCenter.trigger("collaboration:sharing")})),a.btnShare.updateHint(a.tipAccessRights),a.btnShare.setVisible(!r&&i&&(i.sharingSettingsUrl&&i.sharingSettingsUrl.length||i.canRequestSharingSettings)),u(i)),a.logo&&a.logo.children(0).on("click",(function(t){var e=a.branding&&a.branding.logo&&void 0!==a.branding.logo.url?a.branding.logo.url:"https://www.onlyoffice.com";if(e){var i=window.open(e);i&&i.focus()}})),o){d(t),o.on("shown.bs.dropdown",(function(){n.scroller&&n.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})})),o.find(".cousers-menu").on("click",(function(t){return!1}));var l=t.getVisibleEditingCount();s.tooltip({title:a.tipUsers,placement:"bottom",html:!0}),s.on("click",m.bind(a)),o[l>1&&i&&(i.isEdit||i.isRestrictedEdit)?"show":"hide"](),u(i)}i.user.guest&&i.canRenameAnonymous&&a.btnUserName&&a.btnUserName.on("click",(function(t){Common.NotificationCenter.trigger("user:rename")})),a.btnPrint&&(a.btnPrint.updateHint(a.tipPrint+Common.Utils.String.platformKey("Ctrl+P")),a.btnPrint.on("click",(function(t){a.fireEvent("print",a)}))),a.btnSave&&(a.btnSave.updateHint(a.tipSave+Common.Utils.String.platformKey("Ctrl+S")),a.btnSave.on("click",(function(t){a.fireEvent("save",a)}))),a.btnUndo&&(a.btnUndo.updateHint(a.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")),a.btnUndo.on("click",(function(t){a.fireEvent("undo",a)}))),a.btnRedo&&(a.btnRedo.updateHint(a.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")),a.btnRedo.on("click",(function(t){a.fireEvent("redo",a)}))),e.isEdit||(a.btnDownload&&(a.btnDownload.updateHint(a.tipDownload),a.btnDownload.on("click",(function(t){a.fireEvent("downloadas",["original"])}))),a.btnEdit&&(a.btnEdit.updateHint(a.tipGoEdit),a.btnEdit.on("click",(function(t){a.fireEvent("go:editor",a)})))),a.btnSearch&&a.btnSearch.updateHint(a.tipSearch+Common.Utils.String.platformKey("Ctrl+F")),!i.isEdit||i.customization&&i.customization.compactHeader||Common.NotificationCenter.on("window:resize",g)}function C(t){var e=this;if(e.imgCrypted&&e.imgCrypted.toggleClass("hidden",!0),e.isSaveDocName=!1,!e.withoutExt){var i=e.cutDocName(l.val());e.withoutExt=!0,_.delay((function(){e.setDocTitle(i),l.select()}),100)}}function v(t){var e=this,i=l.val();t.keyCode==Common.UI.Keys.RETURN?(i=i.trim(),_.isEmpty(i)||e.cutDocName(e.documentCaption)===i?Common.NotificationCenter.trigger("edit:complete",e):(e.isSaveDocName=!0,/[\t*\+:\"<>?|\\\\/]/gim.test(i)?_.defer((function(){Common.UI.error({msg:(new Common.Views.RenameDialog).txtInvalidName+'*+:"<>?|/',callback:function(){_.delay((function(){l.focus(),e.isSaveDocName=!0}),50)}})})):e.withoutExt&&(i=e.cutDocName(i),e.options.wopi?e.api.asc_wopi_renameFile(i):Common.Gateway.requestRename(i),i+=e.fileExtention,e.withoutExt=!1,e.setDocTitle(i),Common.NotificationCenter.trigger("edit:complete",e)))):t.keyCode==Common.UI.Keys.ESC?Common.NotificationCenter.trigger("edit:complete",this):_.delay((function(){e.setDocTitle()}),10)}return{options:{branding:{},documentCaption:"",canBack:!1},el:"#header",template:_.template(e),events:{},initialize:function(e){var n=this;this.options=this.options?_.extend(this.options,e):e,this.documentCaption=this.options.documentCaption,this.branding=this.options.customization,this.isModified=!1,n.btnGoBack=new Common.UI.Button({id:"btn-goback",cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-goback",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),(t=this.options.storeUsers).bind({add:h,change:h,reset:d}),n.btnSearch=new Common.UI.Button({cls:"btn-header no-caret",iconCls:"toolbar__icon icon--inverse btn-menu-search",enableToggle:!0,dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),n.btnFavorite=new Common.UI.Button({id:"btn-favorite",cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-favorite",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),Common.NotificationCenter.on({"app:ready":function(t){Common.Utils.asyncCall(b,n,t)},"app:face":function(t){Common.Utils.asyncCall(f,n,t)},"tab:visible":function(){Common.Utils.asyncCall(u,n,i)},"collaboration:sharingdeny":function(t){Common.Utils.asyncCall(p,n,t)}}),Common.NotificationCenter.on("uitheme:changed",this.changeLogo.bind(this))},render:function(t,e){return $(t).html(this.getPanel(e)),this},getPanel:function(t,e){var i=this;function c(t,i,n,o,s,a){return new Common.UI.Button({cls:"btn-header",iconCls:t,disabled:!0===n,dataHint:"0",dataHintDirection:o||(e.isDesktopApp?"right":"left"),dataHintOffset:s||(e.isDesktopApp?"10, -18":"10, 10"),dataHintTitle:a}).render(i)}if(!("left"!=t||e&&e.isDesktopApp)){if(h=$('<section class="logo"><div id="header-logo"><i></i></div></section>'),this.logo=h.find("#header-logo"),this.branding&&this.branding.logo&&(this.branding.logo.image||this.branding.logo.imageDark)&&this.logo){var d=Common.UI.Themes.isDarkTheme()?this.branding.logo.imageDark||this.branding.logo.image:this.branding.logo.image||this.branding.logo.imageDark;this.logo.html('<img src="'+d+'" style="max-width:100px; max-height:20px; margin: 0;"/>'),this.logo.css({"background-image":"none",width:"auto"}),(this.branding.logo.url||void 0===this.branding.logo.url)&&this.logo.addClass("link")}return h}if("right"==t){var h=$(_.template('<section><section id="box-doc-name"><input id="rib-doc-name" autofill="off" autocomplete="off"/></input></section><section style="display: inherit;"><div class="hedset"><div class="btn-slot" id="slot-hbtn-edit"></div><div class="btn-slot" id="slot-hbtn-print"></div><div class="btn-slot" id="slot-hbtn-download"></div></div><div class="hedset" data-layout-name="header-users"><section id="tlb-box-users" class="box-cousers dropdown"><div class="btn-users dropdown-toggle" data-toggle="dropdown" data-hint="0" data-hint-direction="bottom" data-hint-offset="big"><div class="inner-box-icon"><svg class=""><use xlink:href="#svg-icon-users"></use></svg></div><label class="caption"></label></div><div class="cousers-menu dropdown-menu"><label id="tlb-users-menu-descr"><%= tipUsers %></label><div class="cousers-list"></div></div></section></div><div class="hedset"><div class="btn-slot" id="slot-btn-share"></div></div><div class="hedset"><div class="btn-slot" id="slot-btn-mode"></div><div class="btn-slot" id="slot-btn-back"></div><div class="btn-slot" id="slot-btn-favorite"></div><div class="btn-slot" id="slot-btn-search"></div></div><div class="hedset"><button type="button" class="btn btn-header slot-btn-user-name hidden"><div class="color-user-name"></div></button><div class="btn-current-user hidden"><div class="color-user-name"></div></div></div></section></section>')({tipUsers:this.labelCoUsersDescr,textShare:this.textShare}));return l?h.find("#rib-doc-name").hide():(l=h.find("#rib-doc-name"),i.documentCaption&&setTimeout((function(){i.setDocTitle(i.documentCaption)}),50)),this.setCanRename(!!this.options.canRename),!0===this.options.canBack?i.btnGoBack.render(h.find("#slot-btn-back")):h.find("#slot-btn-back").hide(),void 0!==this.options.favorite&&null!==this.options.favorite?(i.btnFavorite.render(h.find("#slot-btn-favorite")),i.btnFavorite.changeIcon(i.options.favorite?{next:"btn-in-favorite"}:{curr:"btn-in-favorite"}),i.btnFavorite.updateHint(i.options.favorite?i.textRemoveFavorite:i.textAddFavorite)):h.find("#slot-btn-favorite").hide(),e.isEdit||(!e.canDownload&&!e.canDownloadOrigin||e.isOffline||(this.btnDownload=c("toolbar__icon icon--inverse btn-download",h.findById("#slot-hbtn-download"),void 0,"bottom","big")),e.canPrint&&(this.btnPrint=c("toolbar__icon icon--inverse btn-print",h.findById("#slot-hbtn-print"),void 0,"bottom","big","P")),e.canEdit&&e.canRequestEditRights&&(this.btnEdit=c("toolbar__icon icon--inverse btn-edit",h.findById("#slot-hbtn-edit"),void 0,"bottom","big"))),i.btnSearch.render(h.find("#slot-btn-search")),(!e.isEdit||e.customization&&e.customization.compactHeader)&&(e.user.guest&&e.canRenameAnonymous?(i.btnUserName=new Common.UI.Button({el:h.findById(".slot-btn-user-name"),cls:"btn-header",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big",visible:!0}),i.btnUserName.cmpEl.removeClass("hidden")):(i.elUserName=h.find(".btn-current-user"),i.elUserName.removeClass("hidden")),a=h.find(".color-user-name"),i.setUserName(i.options.userName)),!r&&e&&(e.sharingSettingsUrl&&e.sharingSettingsUrl.length||e.canRequestSharingSettings)?(i.btnShare=new Common.UI.Button({cls:"btn-header btn-header-share",iconCls:"toolbar__icon icon--inverse btn-users-share",caption:i.textShare,dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),i.btnShare.render(h.find("#slot-btn-share"))):h.find("#slot-btn-share").hide(),n=h.find(".cousers-list"),o=h.find(".box-cousers"),s=o.find("> .btn-users"),o.hide(),h}if("title"==t){h=$(_.template('<section id="box-document-title"><div class="extra"></div><div class="hedset"><div class="btn-slot" id="slot-btn-dt-save" data-layout-name="header-save"></div><div class="btn-slot" id="slot-btn-dt-print"></div><div class="btn-slot" id="slot-btn-dt-undo"></div><div class="btn-slot" id="slot-btn-dt-redo"></div></div><div class="lr-separator" id="id-box-doc-name"><input id="title-doc-name" autofill="off" autocomplete="off"/></input></div><div class="hedset"><button type="button" class="btn btn-header slot-btn-user-name hidden"><div class="color-user-name"></div></button><div class="btn-current-user hidden"><div class="color-user-name"></div></div></div></section>')());return l&&l.hide().off(),l=h.find("#title-doc-name"),setTimeout((function(){i.setDocTitle(i.documentCaption)}),50),i.options.wopi&&l.attr("maxlength",i.options.wopi.FileNameMaxLength),e.user.guest&&e.canRenameAnonymous?(i.btnUserName=new Common.UI.Button({el:h.findById(".slot-btn-user-name"),cls:"btn-header",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big",visible:!0}),i.btnUserName.cmpEl.removeClass("hidden")):(i.elUserName=h.find(".btn-current-user"),i.elUserName.removeClass("hidden")),a=h.find(".color-user-name"),i.setUserName(i.options.userName),e.canPrint&&e.isEdit&&(i.btnPrint=c("toolbar__icon icon--inverse btn-print",h.findById("#slot-btn-dt-print"),!0,void 0,void 0,"P")),i.btnSave=c("toolbar__icon icon--inverse btn-save",h.findById("#slot-btn-dt-save"),!0,void 0,void 0,"S"),i.btnUndo=c("toolbar__icon icon--inverse btn-undo",h.findById("#slot-btn-dt-undo"),!0,void 0,void 0,"Z"),i.btnRedo=c("toolbar__icon icon--inverse btn-redo",h.findById("#slot-btn-dt-redo"),!0,void 0,void 0,"Y"),h}},setVisible:function(t){},setBranding:function(t){var e;if(this.branding=t,t&&t.logo&&(t.logo.image||t.logo.imageDark)){var i=Common.UI.Themes.isDarkTheme()?t.logo.imageDark||t.logo.image:t.logo.image||t.logo.imageDark;(e=$("#header-logo"))&&(e.html('<img src="'+i+'" style="max-width:100px; max-height:20px; margin: 0;"/>'),e.css({"background-image":"none",width:"auto"}),(t.logo.url||void 0===t.logo.url)&&e.addClass("link"))}},changeLogo:function(){var t=this.branding;if(t&&t.logo&&t.logo.image&&t.logo.imageDark&&t.logo.image!==t.logo.imageDark){var e=Common.UI.Themes.isDarkTheme()?t.logo.imageDark||t.logo.image:t.logo.image||t.logo.imageDark;$("#header-logo img").attr("src",e)}},setDocumentCaption:function(t){!t&&(t=""),this.documentCaption=t;var e=this.documentCaption.lastIndexOf(".");return e>0&&(this.fileExtention=this.documentCaption.substring(e)),this.isModified&&(t+="*"),l&&this.setDocTitle(t),t},getDocumentCaption:function(){return this.documentCaption},setDocumentChanged:function(t){this.isModified=t;var e=this.documentCaption;t&&(e+="*"),this.setDocTitle(e)},setCanBack:function(t,e){return this.options.canBack=t,this.btnGoBack[t?"show":"hide"](),t&&this.btnGoBack.updateHint(e&&"string"==typeof e?e:this.textBack),u(i),this},getCanBack:function(){return this.options.canBack},setFavorite:function(t){return this.options.favorite=t,this.btnFavorite[null!=t?"show":"hide"](),this.btnFavorite.changeIcon(t?{next:"btn-in-favorite"}:{curr:"btn-in-favorite"}),this.btnFavorite.updateHint(t?this.textRemoveFavorite:this.textAddFavorite),u(i),this},getFavorite:function(){return this.options.favorite},setCanRename:function(t){var e=this;if(e.options.canRename=t,l){var i=l;if(t)i.removeAttr("disabled").tooltip({title:e.txtRename,placement:"cursor"}),i.on({keydown:v.bind(this),focus:C.bind(this),blur:function(t){e.imgCrypted&&e.imgCrypted.toggleClass("hidden",!1),Common.Utils.isGecko&&(i[0].selectionStart=i[0].selectionEnd=0),e.isSaveDocName||(e.withoutExt=!1,e.setDocTitle(e.documentCaption))},paste:function(t){setTimeout((function(){var t=e.cutDocName(l.val());e.setDocTitle(t)}))}});else{i.off(),i.attr("disabled",!0);var n=i.data("bs.tooltip");n&&(n.options.title="",n.setContent())}i.attr("data-can-copy",t)}},cutDocName:function(t){if(t.length<=this.fileExtention.length)return t;var e=t.length-this.fileExtention.length;return t.substring(e)==this.fileExtention?t.substring(0,e):t},setDocTitle:function(t){var e=this.getTextWidth(t||l.val());e>=0&&l.width(e),t&&e>=0&&l.val(t),this._showImgCrypted&&e>=0&&(this.imgCrypted.toggleClass("hidden",!1),this._showImgCrypted=!1),e>=0&&g()},getTextWidth:function(t){if(!this._testCanvas){var e=(l.css("font-size")+" "+l.css("font-family")).trim();if(e){var i=document.createElement("canvas");this._testCanvas=i.getContext("2d"),this._testCanvas.font=e}}return this._testCanvas?this._testCanvas.measureText(t).width:-1},setUserName:function(t){return this.options.userName=t,this.btnUserName?this.btnUserName.updateHint(t):this.elUserName&&this.elUserName.tooltip({title:Common.Utils.String.htmlEncode(t),placement:"cursor",html:!0}),a&&a.text(this.getInitials(t)),this},getButton:function(t){return"save"==t?this.btnSave:"users"==t?o:"share"==t?this.btnShare:void 0},lockHeaderBtns:function(t,e){var i=this;if("users"==t)e?s.addClass("disabled").attr("disabled","disabled"):s.removeClass("disabled").removeAttr("disabled"),i.btnShare&&i.btnShare.setDisabled(e);else if("rename-user"==t)i.btnUserName&&i.btnUserName.setDisabled(e);else{var n=function(t){t&&(e?(t.keepState={disabled:t.isDisabled()},t.setDisabled(!0)):(t.setDisabled(t.keepState&&t.keepState.disabled||e),delete t.keepState))};switch(t){case"undo":n(i.btnUndo);break;case"redo":n(i.btnRedo)}}},getInitials:function(t){for(var e=t.split(" "),i=e[0].substring(0,1).toUpperCase(),n=e.length-1;n>0;n--)if("("!==e[n][0]&&")"!==e[n][0]){i+=e[n].substring(0,1).toUpperCase();break}return i},textBack:"Go to Documents",txtRename:"Rename",txtAccessRights:"Change access rights",tipAccessRights:"Manage document access rights",labelCoUsersDescr:"Document is currently being edited by several users.",tipViewUsers:"View users and manage document access rights",tipUsers:"View users",tipDownload:"Download file",tipPrint:"Print file",tipGoEdit:"Edit current file",tipSave:"Save",tipUndo:"Undo",tipRedo:"Redo",textCompactView:"Hide Toolbar",textHideStatusBar:"Combine sheet and status bars",textHideLines:"Hide Rulers",textZoom:"Zoom",textAdvSettings:"Advanced Settings",tipViewSettings:"View Settings",textRemoveFavorite:"Remove from Favorites",textAddFavorite:"Mark as favorite",textHideNotes:"Hide Notes",tipSearch:"Search",textShare:"Share"}}(),Common.Views.Header||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ToggleManager",["common/main/lib/component/BaseView"],(function(){"use strict";var t={};function e(e,i){var n,o,s;if(i)for(o=0,s=(n=t[e.toggleGroup]).length;o<s;o++)n[o]!==e&&(n[o].isActive?n[o].isActive()&&n[o].toggle(!1):n[o].toggle(!1))}Common.UI.ToggleManager={register:function(i){if(i.toggleGroup){var n=t[i.toggleGroup];n||(n=t[i.toggleGroup]=[]),n.push(i),i.on("toggle",e)}},unregister:function(i){if(i.toggleGroup){var n=t[i.toggleGroup];n&&(_.without(n,i),i.off("toggle",e))}},getToggled:function(e){var i,n=t[e],o=0;if(n)for(i=n.length;o<i;o++)if(!0===n[o].pressed||!0===n[o].checked)return n[o];return null}}})),void 0===Common)var Common={};if(define("common/main/lib/component/Button",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],(function(){"use strict";window.createButtonSet=function(){function t(t){}t.prototype=new Array,t.prototype.constructor=t;var e=!1;t.prototype.add=function(t){t.setDisabled(e),this.push(t)},t.prototype.setDisabled=function(t){e=t,this.forEach((function(e){e.setDisabled(t)}))},t.prototype.toggle=function(t,e){this.forEach((function(i){i.toggle(t,e)}))},t.prototype.pressed=function(){return this.some((function(t){return t.pressed}))},t.prototype.contains=function(t){return this.some((function(e){return e.id==t}))},t.prototype.concat=function(){var t=Array.prototype.slice.call(arguments),e=Array.prototype.slice.call(this);return t.forEach((function(t){t instanceof Array?Array.prototype.push.apply(e,t):t&&e.push(t)})),e};var i=Object.create(t.prototype);for(var n in arguments)i.add(arguments[n]);return i};var t=function(t){var e=document.createElement("span");e.style.fontSize="11px",e.style.fontFamily='Arial, Helvetica, "Helvetica Neue", sans-serif',e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.innerHTML=t,document.body.appendChild(e);var i=e.offsetWidth;return document.body.removeChild(e),i},e=function(e,i){for(var n=e.length-1,o=e;t(o)>i;)o=e.slice(0,n).trim()+"...",n--;return o};Common.UI.Button=Common.UI.BaseView.extend({options:{id:null,hint:!1,enableToggle:!1,allowDepress:!0,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1,visible:!0,dataHint:"",dataHintDirection:"",dataHintOffset:"0, 0"},template:_.template(["<% var applyicon = function() { %>","<% if (iconImg) { print('<img src=\"' + iconImg + '\">'); } else { %>",'<% if (iconCls != "") {  if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); }} %>',"<% } %>","<% if ( !menu ) { %>",'<button type="button" class="btn <%= cls %>" id="<%= id %>" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>',"<% applyicon() %>",'<span class="caption"><%= caption %></span>',"</button>","<% } else if (split == false) {%>",'<div class="btn-group" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>',"<% applyicon() %>",'<span class="caption"><%= caption %></span>','<span class="inner-box-caret"><i class="caret"></i></span>',"</button>","</div>","<% } else { %>",'<div class="btn-group split" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn <%= cls %>">',"<% applyicon() %>",'<span class="caption"><%= caption %></span>',"</button>",'<button type="button" class="btn <%= cls %> dropdown-toggle" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>','<i class="caret"></i>','<span class="sr-only"></span>',"</button>","</div>","<% } %>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.id=e.options.id||Common.UI.getId(),e.hint=e.options.hint,e.enableToggle=e.options.enableToggle,e.allowDepress=e.options.allowDepress,e.cls=e.options.cls,e.iconCls=e.options.iconCls,e.menu=e.options.menu,e.split=e.options.split,e.toggleGroup=e.options.toggleGroup,e.disabled=e.options.disabled,e.visible=e.options.visible,e.pressed=e.options.pressed,e.caption=e.options.caption,e.template=e.options.template||e.template,e.style=e.options.style,e.rendered=!1,e.options.el?e.render():e.options.parentEl&&e.render(e.options.parentEl)},getCaptionWithBreaks:function(i){var n=i.split(" "),o=null,s=81;n.length>1?(s=this.menu||!0===this.split?s-10:s,n.length<3?(n[1]=e(n[1],s),o=n[0]+"<br>"+n[1]):t(n[0]+" "+n[1])<s?(n[2]=e(n[2],s),o=n[0]+" "+n[1]+"<br>"+n[2]):t(n[1]+" "+n[2])<s?(n[2]=e(n[2],s),o=n[0]+"<br>"+n[1]+" "+n[2]):(n[1]=e(n[1]+" "+n[2],s),o=n[0]+"<br>"+n[1])):(o=t(i)<s?i:e(i,s),(this.menu||!0===this.split)&&(o+="<br>"));return o},render:function(t){var e=this;if(e.trigger("render:before",e),e.cmpEl=e.$el||$(e.el),t&&(e.setElement(t,!1),!e.rendered)){if(/icon-top/.test(e.cls)&&e.caption&&/huge/.test(e.cls)){!0===e.split?(e.cls&&(e.cls=e.cls.replace(/\s?(?:x-huge|icon-top)/g,"")),this.template=_.template('<div class="btn-group x-huge split icon-top" id="<%= id %>" style="<%= style %>"><button type="button" class="btn <%= cls %> inner-box-icon"><span class="btn-fixflex-hcenter"><% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %></span></button><button type="button" class="btn <%= cls %> inner-box-caption dropdown-toggle" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>><span class="btn-fixflex-vcenter"><span class="caption"><%= caption %><i class="caret"></i></span><i class="caret compact-caret"></i></span></button></div>')):e.menu?this.template=_.template('<div class="btn-group icon-top" id="<%= id %>" style="<%= style %>"><button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>><div class="inner-box-icon"><% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %></div><div class="inner-box-caption"><span class="caption"><%= caption %><i class="caret"></i></span><i class="caret compact-caret"></i></div></button></div>'):this.template=_.template('<button type="button" class="btn <%= cls %>" id="<%= id %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>> <div class="inner-box-icon"><% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use><use class="zoom-grit" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'-150"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %></div><div class="inner-box-caption"><span class="caption"><%= caption %></span></div></button>');var i=this.getCaptionWithBreaks(this.caption);i&&(e.caption=i)}e.cmpEl=$(this.template({id:e.id,cls:e.cls,iconCls:e.iconCls,iconImg:e.options.iconImg,menu:e.menu,split:e.split,disabled:e.disabled,pressed:e.pressed,caption:e.caption,style:e.style,dataHint:e.options.dataHint,dataHintDirection:e.options.dataHintDirection,dataHintOffset:e.options.dataHintOffset,dataHintTitle:e.options.dataHintTitle})),e.menu&&_.isObject(e.menu)&&_.isFunction(e.menu.render)&&e.menu.render(e.cmpEl),t.html(e.cmpEl),e.$icon=e.$el.find(".icon")}if(!e.rendered){var n=e.cmpEl,o=n.hasClass("btn-group"),s=n.hasClass("split");if(e.options.hint){var a=e.cmpEl.closest(".asc-window");if("object"==typeof e.options.hint&&e.options.hint.length>1&&$("button",n).length>0){var l=$("button",n);e.btnEl=$(l[0]),e.btnMenuEl=$(l[1])}else e.btnEl=e.cmpEl,e.btnEl.attr("data-toggle","tooltip");if(e.btnEl.tooltip({title:"string"==typeof e.options.hint?e.options.hint:e.options.hint[0],placement:e.options.hintAnchor||"cursor"}),e.btnMenuEl&&e.btnMenuEl.tooltip({title:e.options.hint[1],placement:e.options.hintAnchor||"cursor"}),a.length>0){e.btnEl.data("bs.tooltip").tip().css("z-index",parseInt(a.css("z-index"))+10),e.btnMenuEl&&e.btnMenuEl.data("bs.tooltip").tip().css("z-index",parseInt(a.css("z-index"))+10);var r=function(t){if(a[0]===t.$window[0]){var i=e.btnEl.data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide()),Common.NotificationCenter.off({"modal:close":r})}};Common.NotificationCenter.on({"modal:close":r})}}_.isString(e.toggleGroup)&&(e.enableToggle=!0);var c,d=function(t){if(!e.disabled&&1==t.which){if(e.doToggle(),e.options.hint){var i=e.btnEl.data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}e.trigger("click",e,t)}},h=function(t,i,o){if(!t){var a=!1;$("button",n).each((function(t,e){if($(e).is(":hover"))return a=!0,!1})),a||(n.removeClass("over"),$("button",n).removeClass("over"))}if("button"==i){if(!t&&e.enableToggle&&e.allowDepress&&e.pressed)return;if(t&&!s&&e.enableToggle&&e.allowDepress&&!e.pressed)return void o.preventDefault();$("button:first",n).toggleClass("active",t)}else $("[data-toggle^=dropdown]",n).toggleClass("active",t);n.toggleClass("active",t)},p=function(t){h(!1,c,t),$(document).off("mouseup",p)};o?(s&&($("[data-toggle^=dropdown]",n).on("mousedown",_.bind((function(t){if(!e.disabled&&1==t.which&&s){if(e.options.hint){var i=(e.btnMenuEl?e.btnMenuEl:e.btnEl).data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}var o=n.hasClass("open");h(!o,"arrow",t)}}),this)),$("button",n).on("mousedown",_.bind((function(t){c=t.currentTarget.className.match(/dropdown/)?"arrow":"button",h(!0,c,t),$(document).on("mouseup",p)}),this)),e.options.width>0&&$("button:first",n).css("width",e.options.width-$("[data-toggle^=dropdown]",n).outerWidth())),n.on("hide.bs.dropdown",_.bind(h,e,!1,"arrow")),n.on("show.bs.dropdown",_.bind(h,e,!0,"arrow")),n.on("hidden.bs.dropdown",_.bind((function(t,i){e.cmpEl.find(".dropdown-toggle").blur(),e.cmpEl.hasClass("active")!==e.pressed&&e.cmpEl.trigger("button.internal.active",[e.pressed])}),e)),$("button:first",n).on("click",d)):n.on("click",d),n.on("button.internal.active",_.bind((function(t,e){s?h(e,"button",t):(n.toggleClass("active",e),$("button",n).toggleClass("active",e))}),e)),n.on("mouseover",(function(t){e.disabled||(e.cmpEl.addClass("over"),e.trigger("mouseover",e,t))})),n.on("mouseout",(function(t){e.cmpEl.removeClass("over"),e.disabled||e.trigger("mouseout",e,t)})),Common.UI.ToggleManager.register(e)}return e.rendered=!0,e.pressed&&e.toggle(e.pressed,!0),e.disabled&&e.setDisabled(!(e.disabled=!1)),e.visible||e.setVisible(e.visible),e.trigger("render:after",e),this},doToggle:function(){var t=this;!t.enableToggle||!1===t.allowDepress&&t.pressed||t.toggle()},toggle:function(t,e){var i=void 0===t?!this.pressed:!!t;this.pressed=i,this.cmpEl&&this.cmpEl.trigger("button.internal.active",[i]),e||this.trigger("toggle",this,i)},click:function(t){this.disabled||(this.doToggle(),this.trigger("click",this,t))},isActive:function(){return this.enableToggle?this.pressed:this.cmpEl.hasClass("active")},setDisabled:function(t){if(this.rendered&&this.disabled!=t){var e=this.cmpEl,i=e.hasClass("btn-group"),n=this;if((t=!0===t)!==e.hasClass("disabled")){var o=function(e){e.toggleClass("disabled",t),n.options.allowMouseEventsOnDisabled||(t?e.attr({disabled:t}):e.removeAttr("disabled"))};o(e),i&&o(e.children("button"))}if((t||!Common.Utils.isGecko)&&this.options.hint){var s=this.btnEl.data("bs.tooltip");s&&(t&&s.hide(),!Common.Utils.isGecko&&(s.enabled=!t)),this.btnMenuEl&&(s=this.btnMenuEl.data("bs.tooltip"))&&(t&&s.hide(),!Common.Utils.isGecko&&(s.enabled=!t))}if(t&&this.menu&&_.isObject(this.menu)&&this.menu.rendered&&this.menu.isVisible()&&setTimeout((function(){n.menu.hide()}),1),n.options.signals)n.options.signals.indexOf("disabled")<0||n.trigger("disabled",n,t)}this.disabled=t},isDisabled:function(){return this.disabled},setIconCls:function(t){var e=$(this.el).find(".icon"),i=this.iconCls;if(this.iconCls=t,/svgicon/.test(this.iconCls)){var n=/svgicon\s(\S+)/.exec(this.iconCls);e.find("use.zoom-int").attr("xlink:href",n&&n.length>1?"#"+n[1]:""),e.find("use.zoom-grit").attr("xlink:href",n&&n.length>1?"#"+n[1]+"-150":"")}else e.removeClass(i),e.addClass(t||"")},changeIcon:function(t){var e=this;t&&(t.curr||t.next)&&e.$icon&&(t.curr&&e.$icon.removeClass(t.curr),t.next&&!e.$icon.hasClass(t.next)&&e.$icon.addClass(t.next),e.options.signals&&(e.options.signals.indexOf("icon:changed")<0||e.trigger("icon:changed",e,t)))},hasIcon:function(t){return this.$icon.hasClass(t)},setVisible:function(t){this.cmpEl&&this.cmpEl.toggleClass("hidden",!t),this.visible=t},isVisible:function(){return this.cmpEl?this.cmpEl.is(":visible"):$(this.el).is(":visible")},updateHint:function(t){if(this.options.hint=t,this.rendered){var e=this.cmpEl,i=e.closest(".asc-window");if(!this.btnEl)if("object"==typeof this.options.hint&&this.options.hint.length>1&&$("button",e).length>0){var n=$("button",e);this.btnEl=$(n[0]),this.btnMenuEl=$(n[1])}else this.btnEl=e,this.btnEl.attr("data-toggle","tooltip");if(this.btnEl.data("bs.tooltip")&&this.btnEl.removeData("bs.tooltip"),this.btnMenuEl&&this.btnMenuEl.data("bs.tooltip")&&this.btnMenuEl.removeData("bs.tooltip"),this.btnEl.tooltip({title:"string"==typeof t?t:t[0],placement:this.options.hintAnchor||"cursor"}),this.btnMenuEl&&this.btnMenuEl.tooltip({title:t[1],placement:this.options.hintAnchor||"cursor"}),i.length>0&&(this.btnEl.data("bs.tooltip").tip().css("z-index",parseInt(i.css("z-index"))+10),this.btnMenuEl&&this.btnMenuEl.data("bs.tooltip").tip().css("z-index",parseInt(i.css("z-index"))+10)),this.disabled||!Common.Utils.isGecko){var o=this.btnEl.data("bs.tooltip");o&&(this.disabled&&o.hide(),!Common.Utils.isGecko&&(o.enabled=!this.disabled)),this.btnMenuEl&&(o=this.btnMenuEl.data("bs.tooltip"))&&(this.disabled&&o.hide(),!Common.Utils.isGecko&&(o.enabled=!this.disabled))}}},setCaption:function(t){if(this.caption!=t){if(/icon-top/.test(this.cls)&&this.caption&&/huge/.test(this.cls)){var e=this.getCaptionWithBreaks(t);this.caption=e||t}else this.caption=t;if(this.rendered){var i=this.cmpEl.find(".caption");i.length>0?i.html(this.caption):this.cmpEl.find("button:first").addBack().filter("button").html(this.caption)}}},setMenu:function(t){t&&_.isObject(t)&&_.isFunction(t.render)&&(this.menu=t,this.rendered&&this.menu.render(this.cmpEl))}})})),define("common/main/lib/view/SearchBar",["common/main/lib/component/Window","common/main/lib/component/Button"],(function(){"use strict";Common.UI.SearchBar=Common.UI.Window.extend(_.extend({options:{modal:!1,width:328,height:54,header:!1,cls:"search-bar",alias:"SearchBar",showOpenPanel:!0,toolclose:"hide"},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<input type="text" id="search-bar-text" class="input-field form-control" maxlength="255" placeholder="'+this.textFind+'" autocomplete="off">','<div class="tools">','<div id="search-bar-back"></div>','<div id="search-bar-next"></div>',this.options.showOpenPanel?'<div id="search-bar-open-panel"></div>':"",'<div id="search-bar-close"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.iconType=this.options.iconType,Common.UI.Window.prototype.initialize.call(this,this.options),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this)),$(window).on("resize",_.bind(this.onLayoutChanged,this))},render:function(){return Common.UI.Window.prototype.render.call(this),this.inputSearch=this.$window.find("#search-bar-text"),this.inputSearch.on("input",_.bind((function(){this.disableNavButtons(),this.fireEvent("search:input",[this.inputSearch.val()])}),this)).on("keydown",_.bind((function(t){this.fireEvent("search:keydown",[this.inputSearch.val(),t])}),this)),this.btnBack=new Common.UI.Button({parentEl:$("#search-bar-back"),cls:"btn-toolbar",iconCls:"svg"===this.iconType?"svg-icon search-arrow-up":"toolbar__icon btn-arrow-up",hint:this.tipPreviousResult}),this.btnBack.on("click",_.bind(this.onBtnNextClick,this,"back")),this.btnNext=new Common.UI.Button({parentEl:$("#search-bar-next"),cls:"btn-toolbar",iconCls:"svg"===this.iconType?"svg-icon search-arrow-down":"toolbar__icon btn-arrow-down",hint:this.tipNextResult}),this.btnNext.on("click",_.bind(this.onBtnNextClick,this,"next")),this.options.showOpenPanel&&(this.btnOpenPanel=new Common.UI.Button({parentEl:$("#search-bar-open-panel"),cls:"btn-toolbar",iconCls:"toolbar__icon more-vertical",hint:this.tipOpenAdvancedSettings}),this.btnOpenPanel.on("click",_.bind(this.onOpenPanel,this))),this.btnClose=new Common.UI.Button({parentEl:$("#search-bar-close"),cls:"btn-toolbar",iconCls:"svg"===this.iconType?"svg-icon search-close":"toolbar__icon btn-close",hint:this.tipCloseSearch}),this.btnClose.on("click",_.bind((function(){this.hide()}),this)),this.on("animate:before",_.bind(this.focus,this)),Common.NotificationCenter.on("search:updateresults",_.bind(this.disableNavButtons,this)),this},show:function(t){var e=($("#app-title").length>0?$("#app-title").height():0)+$("#toolbar").height()+2,i=Common.Utils.innerWidth()-($("#right-menu").is(":visible")?$("#right-menu").width():0)-this.options.width-32;Common.UI.Window.prototype.show.call(this,i,e),this.disableNavButtons(),t?(this.inputSearch.val(t),this.fireEvent("search:input",[t])):(this.inputSearch.val(""),window.SSE&&this.fireEvent("search:input",["",!0])),this.focus()},focus:function(){var t=this;setTimeout((function(){t.inputSearch.focus(),t.inputSearch.select()}),10)},setText:function(t){this.inputSearch.val(t),this.fireEvent("search:input",[t])},getSettings:function(){return{}},onLayoutChanged:function(){var t=$("#app-title").height()+$("#toolbar").height()+2,e=Common.Utils.innerWidth()-($("#right-menu").is(":visible")?$("#right-menu").width():0)-this.options.width-32;this.$window.css({left:e,top:t})},onBtnNextClick:function(t){this.fireEvent("search:"+t,[this.inputSearch.val(),!1])},onOpenPanel:function(){this.hide(),this.fireEvent("search:show",[!0,this.inputSearch.val()])},disableNavButtons:function(t,e){var i=""===this.inputSearch.val()&&!window.SSE||!e;this.btnBack.setDisabled(i),this.btnNext.setDisabled(i)},textFind:"Find",tipPreviousResult:"Previous result",tipNextResult:"Next result",tipOpenAdvancedSettings:"Open advanced settings",tipCloseSearch:"Close search"},Common.UI.SearchBar||{}))})),define("text!spreadsheeteditor/main/app/template/Viewport.template",[],(function(){return'<div class="layout-region">\n    <div id="viewport-vbox-layout" class="layout-ct vbox">\n        <section class="layout-ct">\n            <div id="file-menu-panel" class="toolbar-fullview-panel hint-section" style="display:none;"></div>\n        </section>\n        <section id="app-title" class="layout-item"></section>\n        <div id="toolbar" class="layout-item hint-section" data-layout-name="toolbar"></div>\n        <div class="layout-item">\n            <div id="viewport-hbox-layout" class="layout-ct hbox">\n                <div id="left-menu" class="layout-item hint-section" data-layout-name="leftMenu" style="width: 40px;"></div>\n                <div id="about-menu-panel" class="left-menu-full-ct" style="display:none;"></div>\n                <div class="layout-item">\n                    <div class="layout-ct vbox">\n                        <div id="cell-editing-box" class="layout-item" style="height:18px;"></div>\n                        <div id="editor_sdk" class="layout-item" style="min-height: 100px;"></div>\n                    </div>\n                </div>\n                <div id="right-menu" class="layout-item hint-section" data-layout-name="rightMenu"></div>\n                <div id="left-panel-history" class="layout-item hint-section"></div>\n            </div>\n        </div>\n        <div id="statusbar" class="layout-item" data-layout-name="statusBar"></div>\n    </div>\n</div>\n'})),void 0===Common)var Common={};function _extend_object(t,e){return"undefined"!=typeof _?_.extend({},t,e):Object?Object.assign({},t,e):e}define("common/main/lib/component/Layout",["backbone"],(function(){"use strict";var t=function(t){this.box=null,this.panels=[],this.splitters=[],_.extend(this,t||{})},e=function(){return{width:null,height:null,resize:!1,stretch:!1,rely:!1}};_.extend(t.prototype,Backbone.Events,{initialize:function(t){this.$parent=this.box.parent(),this.resize={eventMove:_.bind(this.resizeMove,this),eventStop:_.bind(this.resizeStop,this)};this.freeze=t.freeze,this.changeLayout(t.items)},doLayout:function(){},changeLayout:function(t){var i,n,o=!1;this.splitters&&this.splitters.forEach((function(t){t.resizer&&t.resizer.el.remove()}),this),this.splitters=[],this.panels=[],t.forEach((function(t){t.el instanceof HTMLElement&&(t.el=$(t.el)),(i=_.extend(new e,t)).stretch&&(o=!0,i.rely=!1,i.resize=!1),this.panels.push(i),i.resize&&(n={isresizer:!0,minpos:i.resize.min||0,maxpos:i.resize.max||0,fmin:i.resize.fmin,fmax:i.resize.fmax,behaviour:i.behaviour,index:this.splitters.length,offset:i.resize.offset||0,multiply:i.resize.multiply},o?(i.resize.el=n.el=i.el.before('<div class="layout-resizer before"></div>').prev(),this.panels.splice(this.panels.length-1,0,n)):(i.resize.el=n.el=i.el.after('<div class="layout-resizer after"></div>').next(),this.panels.push(n)),this.splitters.push({resizer:n}),i.resize.hidden&&n.el.hide(),Common.Gateway.on("processmouse",this.resize.eventStop))}),this),this.freezePanels(this.freeze)},getElementHeight:function(t){return parseInt(t.css("height"))},getElementWidth:function(t){return parseInt(t.css("width"))},getItem:function(t){for(var e in this.panels){var i=this.panels[e];if(i.alias==t)return i}},onSelectStart:function(t){return t.preventDefault&&t.preventDefault(),!1},addHandler:function(t,e,i){t.addEventListener?t.addEventListener(e,i):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeHandler:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null},clearSelection:function(){if(window.getSelection){var t=window.getSelection();t.empty?t.empty():t.removeAllRanges&&t.removeAllRanges()}else document.selection&&document.selection.empty()},resizeStart:function(t){if(!this.freeze){this.clearSelection(),this.addHandler(window.document,"selectstart",this.onSelectStart),$(document).on({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop}),Common.NotificationCenter.on({"frame:mousemove":this.resize.eventMove,"frame:mouseup":this.resize.eventStop});var e=t.data.panel;this.resize.type=t.data.type,this.resize.$el=e.el,this.resize.min=e.minpos,this.resize.fmin=e.fmin,this.resize.fmax=e.fmax,this.resize.behaviour=e.behaviour,this.resize.multiply=e.multiply,this.resize.$el.addClass("move"),"vertical"==t.data.type?(this.resize.height=parseInt(this.resize.$el.css("height")),this.resize.max=(e.maxpos>0?e.maxpos:this.resize.$el.parent().height()+e.maxpos)-this.resize.height,this.resize.inity=t.pageY*Common.Utils.zoom()-parseInt(t.currentTarget.style.top)):"horizontal"==t.data.type&&(this.resize.width=parseInt(this.resize.$el.css("width")),this.resize.max=(e.maxpos>0?e.maxpos:this.resize.$el.parent().width()+e.maxpos)-this.resize.width,this.resize.initx=t.pageX*Common.Utils.zoom()-parseInt(t.currentTarget.style.left)),this.resize.multiply&&this.resize.multiply.koeff&&(this.resize.max=Math.floor(this.resize.max/this.resize.multiply.koeff)*this.resize.multiply.koeff+(this.resize.multiply.offset||0)),Common.NotificationCenter.trigger("layout:resizestart")}},resizeMove:function(t){var e=t instanceof jQuery.Event?Common.Utils.zoom():1;if("vertical"==this.resize.type)var i="top",n=t.pageY*e-this.resize.inity;else"horizontal"==this.resize.type&&(i="left",n=t.pageX*e-this.resize.initx);if(this.resize.multiply&&this.resize.multiply.koeff){var o=this.resize.multiply.koeff,s=n/o,a=Math.floor(s)*o+(this.resize.multiply.offset||0),l=Math.ceil(s)*o+(this.resize.multiply.offset||0);n=n>a+o/2?l:a}this.resize.fmin&&this.resize.fmax?n<this.resize.fmin()||n>this.resize.fmax()||(this.resize.$el[0].style[i]=n+"px"):n<this.resize.min||n>this.resize.max||(this.resize.$el[0].style[i]=n+"px")},resizeStop:function(t){if(this.removeHandler(window.document,"selectstart",this.onSelectStart),$(document).off({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop}),Common.NotificationCenter.off({"frame:mousemove":this.resize.eventMove,"frame:mouseup":this.resize.eventStop}),this.resize.$el){var e=t instanceof jQuery.Event?Common.Utils.zoom():1;if(t instanceof jQuery.Event||void 0!==t.pageY&&void 0!==t.pageX||(t.pageY=t.y,t.pageX=t.x),"vertical"==this.resize.type)var i="height",n=t.pageY*e-this.resize.inity;else"horizontal"==this.resize.type&&(i="width",n=t.pageX*e-this.resize.initx);if(this.resize.multiply&&this.resize.multiply.koeff){var o=this.resize.multiply.koeff,s=n/o,a=Math.floor(s)*o+(this.resize.multiply.offset||0),l=Math.ceil(s)*o+(this.resize.multiply.offset||0);n=n>a+o/2?l:a}this.resize.fmin&&this.resize.fmax?(n<this.resize.fmin()&&(n=this.resize.fmin()),n>this.resize.fmax()&&(n=this.resize.fmax())):(n<this.resize.min&&(n=this.resize.min),n>this.resize.max&&(n=this.resize.max));var r=null,c=null,d=0;this.resize.$el.hasClass("after")?(r=this.resize.$el.prev(),c=this.resize.$el.next(),d=parseInt(r.css(i))):(r=this.resize.$el.next(),c=this.resize.$el.next(),d=parseInt(r.css(i)),n=r.parent()[i]()-(n+this.resize[i])),"vertical"==this.resize.type&&(n-=r.position().top),"horizontal"==this.resize.type&&(n-=r.position().left),r.css(i,n+"px"),this.resize.behaviour&&c.css(i,parseInt(c.css(i))-(n-d)),this.resize.$el.removeClass("move"),delete this.resize.$el,this.resize.value!=n&&(this.doLayout(),this.trigger("layout:resizedrag",this)),Common.NotificationCenter.trigger("layout:resizestop")}},freezePanels:function(t){this.panels.forEach((function(e){!e.stretch&&e.resize&&$(e.resize.el).css("cursor",t?"default":"")})),this.freeze=t},setResizeValue:function(t,e){if(t>=this.splitters.length)return this.doLayout(),!1;var i=null,n=null,o=0,s=this.splitters[t].resizer,a="height";return e<s.fmin()&&(e=s.fmin()),e>s.fmax()&&(e=s.fmax()),s.el.hasClass("after")?(i=s.el.prev(),n=s.el.next(),o=parseInt(i.css(a))):(e=(i=s.el.next()).parent()[a]()-(e+s[a]),n=s.el.next(),o=parseInt(i.css(a))),e-=i.position().top,i.css(a,e+"px"),s.behaviour&&n.css(a,parseInt(n.css(a))-(e-o)),s.value!=e&&this.doLayout(),Math.abs(o-e)>.99}}),!Common.UI&&(Common.UI={}),Common.UI.VBoxLayout=function(e){t.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.VBoxLayout.prototype=_.extend(new t,{initialize:function(e){t.prototype.initialize.call(this,e)},doLayout:function(){var t,e,i=0;this.panels.forEach((function(n){n.stretch?t=n:((e=n.el.is(":visible"))&&(i+=!0!==n.rely?n.height:this.getElementHeight(n.el)),n.resize&&!1!==n.resize.autohide&&n.resize.el&&(e?(n.resize.el.show(),t&&(i+=n.resize.height)):(n.resize.el.hide(),t&&(i-=n.resize.height))))}),this),t&&(t.height=this.$parent.height()-i),i=0,this.panels.forEach((function(t){t.el.is(":visible")&&(e={top:i},!0!==t.rely&&(e.height=t.height),t.el.css(e),i+=e.height||this.getElementHeight(t.el))}),this)},changeLayout:function(e){t.prototype.changeLayout.call(this,e),this.panels.forEach((function(t){!t.stretch&&!t.height&&(t.height=this.getElementHeight(t.el)),t.isresizer&&t.el.on("mousedown",{type:"vertical",panel:t},_.bind(this.resizeStart,this))}),this),this.doLayout.call(this)}}),Common.UI.HBoxLayout=function(e){t.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.HBoxLayout.prototype=_.extend(new t,{initialize:function(e){t.prototype.initialize.call(this,e)},doLayout:function(t){var e,i,n=0;this.panels.forEach((function(t){t.stretch?e=t:((i=t.el.is(":visible"))&&(t.isresizer?n+=t.offset:n+=!0!==t.rely?t.width:this.getElementWidth(t.el)),t.resize&&!1!==t.resize.autohide&&t.resize.el&&(i?(t.resize.el.show(),e&&(n-=t.resize.width)):(t.resize.el.hide(),e&&(n-=t.resize.width))))}),this),e&&(e.width=this.$parent.width()-n),n=0,this.panels.forEach((function(t){t.el.is(":visible")&&(i={left:n-(t.isresizer?t.width:0)},!0!==t.rely&&(i.width=t.width),t.el.css(i),t.isresizer?n+=t.offset:n+=this.getElementWidth(t.el))}),this)},changeLayout:function(e){t.prototype.changeLayout.call(this,e),this.panels.forEach((function(t){!t.stretch&&!t.width&&(t.width=this.getElementWidth(t.el)),t.isresizer&&t.el.on("mousedown",{type:"horizontal",panel:t},_.bind(this.resizeStart,this))}),this),this.doLayout.call(this)}}),Common.UI.VBoxLayout.prototype.constructor=Common.UI.VBoxLayout,Common.UI.HBoxLayout.prototype.constructor=Common.UI.HBoxLayout})),define("spreadsheeteditor/main/app/view/Viewport",["text!spreadsheeteditor/main/app/template/Viewport.template","jquery","underscore","backbone","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t,e,i,n){"use strict";SSE.Views.Viewport=n.View.extend({el:"#viewport",template:i.template(t),events:{},initialize:function(){},render:function(){var t=e(this.el);t.html(this.template({})),Common.Utils.isSafari?(e("body").addClass("safari"),e("body").mousewheel((function(t){t.preventDefault(),t.stopPropagation()}))):Common.Utils.isChrome&&e("body").addClass("chrome");var i=e("#viewport-vbox-layout",t),n=i.find(" > .layout-item");return this.vlayout=new Common.UI.VBoxLayout({box:i,items:[{el:i.find("> .layout-item#app-title").hide(),alias:"title",height:Common.Utils.InternalSettings.get("document-title-height")},{el:n[1],alias:"toolbar",height:Common.localStorage.getBool("sse-compact-toolbar")?Common.Utils.InternalSettings.get("toolbar-height-compact"):Common.Utils.InternalSettings.get("toolbar-height-normal")},{el:n[2],stretch:!0},{el:n[3],alias:"statusbar",height:Common.localStorage.getBool("sse-compact-statusbar",!0)?25:50}]}),n=(i=e("#viewport-hbox-layout",t)).find(" > .layout-item"),this.hlayout=new Common.UI.HBoxLayout({box:i,items:[{el:n[0],rely:!0,resize:{hidden:!0,autohide:!1,min:300,max:600,offset:4}},{el:n[3],rely:!0,resize:{hidden:!0,autohide:!1,min:300,max:600}},{el:n[1],stretch:!0},{el:e(n[2]).hide(),rely:!0}]}),n=(i=i.find(".layout-ct.vbox")).find(" > .layout-item"),this.celayout=new Common.UI.VBoxLayout({box:i,items:[{el:n[0],rely:!0,resize:{min:19,max:-100,multiply:{koeff:18,offset:2}}},{el:n[1],stretch:!0}]}),this},applyEditorMode:function(){var t=SSE.getController("RightMenu").getView("RightMenu");this._rightMenu=t.render(this.mode)},setMode:function(t,e){t.isDisconnected?(i.isUndefined(this.mode)&&(this.mode={}),this.mode.canCoAuthoring=!1):(this.mode=t,this.vlayout&&t.isDesktopApp&&!t.isEdit&&this.vlayout.items[1].el.css("display","block"))}})})),define("spreadsheeteditor/main/app/controller/Viewport",["core","common/main/lib/view/Header","common/main/lib/view/SearchBar","spreadsheeteditor/main/app/view/Viewport"],(function(t){"use strict";SSE.Controllers.Viewport=Backbone.Controller.extend(_.assign({models:[],collections:[],views:["Viewport","Common.Views.Header"],initialize:function(){var t=this;this.addListeners({FileMenu:{"menu:hide":t.onFileMenu.bind(t,"hide"),"menu:show":t.onFileMenu.bind(t,"show")},Statusbar:{"view:compact":function(e,i){t.viewport.vlayout.getItem("statusbar").height=i?25:50}},Toolbar:{"render:before":function(e){var i=SSE.getController("Main").appOptions;i.isEditDiagram||i.isEditMailMerge||i.isEditOle||e.setExtra("right",t.header.getPanel("right",i)),(!i.isEdit||i.customization&&i.customization.compactHeader)&&e.setExtra("left",t.header.getPanel("left",i)),!t.appConfig||!t.appConfig.isEdit||i.customization&&i.customization.compactHeader||!e.btnCollabChanges||(e.btnCollabChanges=t.header.btnSave)},"view:compact":function(e,i){t.viewport.vlayout.getItem("toolbar").height=i?Common.Utils.InternalSettings.get("toolbar-height-compact"):Common.Utils.InternalSettings.get("toolbar-height-normal")},"undo:disabled":function(e){t.header.btnUndo&&(t.header.btnUndo.keepState?t.header.btnUndo.keepState.disabled=e:t.header.btnUndo.setDisabled(e))},"redo:disabled":function(e){t.header.btnRedo&&(t.header.btnRedo.keepState?t.header.btnRedo.keepState.disabled=e:t.header.btnRedo.setDisabled(e))},"print:disabled":function(e){t.header.btnPrint&&t.header.btnPrint.setDisabled(e)},"save:disabled":function(e){t.header.btnSave&&t.header.btnSave.setDisabled(e)}}}),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",this.onApiCoAuthoringDisconnect.bind(this)),Common.NotificationCenter.on("api:disconnect",this.onApiCoAuthoringDisconnect.bind(this))},getApi:function(){return this.api},onAppShowed:function(t){var e=this;e.appConfig=t;var i=Common.Utils.InternalSettings,n=$(".toolbar-fullview-panel");if(n.css("top",Common.UI.LayoutManager.isElementVisible("toolbar")?i.get("toolbar-height-tabs"):0),e.viewport.$el.attr("applang",e.appConfig.lang.split(/[\-_]/)[0]),!t.isEdit||!Common.localStorage.itemExists("sse-compact-toolbar")&&t.customization&&t.customization.compactToolbar?e.viewport.vlayout.getItem("toolbar").height=i.get("toolbar-height-compact"):(t.isEditDiagram||t.isEditMailMerge||t.isEditOle)&&(e.viewport.vlayout.getItem("toolbar").height=41),t.isEdit&&!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle&&(!t.customization||!t.customization.compactHeader)){var o=e.viewport.vlayout.getItem("title").el;o.html(e.header.getPanel("title",t)).show(),o.find(".extra").html(e.header.getPanel("left",t));var s=e.viewport.vlayout.getItem("toolbar");s.el.addClass("top-title"),s.height-=i.get("toolbar-height-tabs")-i.get("toolbar-height-tabs-top-title");var a=i.get("toolbar-height-tabs-top-title");i.set("toolbar-height-tabs",a),i.set("toolbar-height-compact",a),i.set("toolbar-height-normal",a+i.get("toolbar-height-controls")),n.css("top",(Common.UI.LayoutManager.isElementVisible("toolbar")?a:0)+i.get("document-title-height"))}t.customization&&(t.customization.toolbarNoTabs&&e.viewport.vlayout.getItem("toolbar").el.addClass("style-off-tabs"),t.customization.toolbarHideFileName&&e.viewport.vlayout.getItem("toolbar").el.addClass("style-skip-docname")),e.header.btnSearch.on("toggle",e.onSearchToggle.bind(this))},onAppReady:function(t){},onLaunch:function(){this.viewport=this.createView("Viewport").render(),this.getApplication().getController("CellEditor").createView("CellEditor",{el:"#cell-editing-box"}).render(),this.api=new Asc.spreadsheet_api({"id-view":"editor_sdk","id-input":"ce-cell-content",translate:this.getApplication().getController("Main").translationTable}),this.header=this.createView("Common.Views.Header",{headerCaption:"Spreadsheet Editor",storeUsers:SSE.getCollection("Common.Collections.Users")}),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this)),$(window).on("resize",_.bind(this.onWindowResize,this)),this.viewport.celayout.on("layout:resizedrag",(function(){this.viewport.fireEvent("layout:resizedrag",[this,"cell:edit"]),this.api.asc_Resize()}),this);var t=$("#left-menu"),e=$("#left-panel-history");this.viewport.hlayout.on("layout:resizedrag",(function(){this.api.asc_Resize(),Common.localStorage.setItem("sse-mainmenu-width",e.is(":visible")?e.width()+SCALE_MIN:t.width())}),this),this.boxSdk=$("#editor_sdk"),this.boxFormula=$("#cell-editing-box"),this.boxSdk.css("border-left","none"),this.boxFormula.css("border-left","none"),Common.NotificationCenter.on("search:show",_.bind(this.onSearchShow,this))},onLayoutChanged:function(t){switch(t){default:this.viewport.vlayout.doLayout(),this.viewport.celayout.doLayout();case"rightmenu":this.viewport.hlayout.doLayout();break;case"history":(e=this.viewport.hlayout.items[1]).resize.el&&(this.boxSdk.css("border-left",""),e.resize.el.show()),this.viewport.hlayout.doLayout();break;case"leftmenu":var e;(e=this.viewport.hlayout.items[0]).resize.el&&(e.el.width()>40?(this.boxSdk.css("border-left",""),this.boxFormula.css("border-left",""),e.resize.el.show()):(e.resize.el.hide(),this.boxSdk.css("border-left","none"),this.boxFormula.css("border-left","none"))),this.viewport.hlayout.doLayout();break;case"header":case"toolbar":case"status":this.viewport.vlayout.doLayout(),this.viewport.celayout.doLayout();break;case"celleditor":arguments[1]&&this.boxSdk.css("border-top","hidden"==arguments[1]?"none":""),this.viewport.celayout.doLayout()}this.api.asc_Resize()},onWindowResize:function(t){this.onLayoutChanged("window"),Common.NotificationCenter.trigger("window:resize")},onFileMenu:function(t){var e=this,i="show"==t;e.header.lockHeaderBtns("undo",i),e.header.lockHeaderBtns("redo",i),e.header.lockHeaderBtns("users",i)},onApiCoAuthoringDisconnect:function(t){this.header&&(this.header.btnDownload&&!t&&this.header.btnDownload.hide(),this.header.btnPrint&&!t&&this.header.btnPrint.hide(),this.header.btnEdit&&this.header.btnEdit.hide())},SetDisabled:function(t){},onSearchShow:function(){this.header.btnSearch&&this.header.btnSearch.toggle(!0)},onSearchToggle:function(){var t=this.getApplication().getController("LeftMenu");if(t.isSearchPanelVisible())return this.header.btnSearch.toggle(!1,!0),void t.getView("LeftMenu").panelSearch.focus();if(!this.searchBar){var e=t&&t.leftMenu&&t.leftMenu.isVisible();this.searchBar=new Common.UI.SearchBar(e?{}:{showOpenPanel:!1,width:303}),this.searchBar.on("hide",_.bind((function(){this.header.btnSearch.toggle(!1,!0)}),this))}if(this.header.btnSearch.pressed){var i=this.api.asc_GetSelectedText();this.searchBar.show(i&&i.trim()||this.getApplication().getController("Search").getSearchText())}else this.searchBar.hide()},isSearchBarVisible:function(){return this.searchBar&&this.searchBar.isVisible()},textHideFBar:"Hide Formula Bar",textHideHeadings:"Hide Headings",textHideGridlines:"Hide Gridlines",textFreezePanes:"Freeze Panes",textFreezePanesShadow:"Show Freezed Panes Shadow"},SSE.Controllers.Viewport))})),void 0===window.Common&&(window.Common={}),void 0===Common.Utils&&(Common.Utils={});var utils=new function(){var t=navigator.userAgent.toLowerCase(),e=function(e){return e.test(t)},i="CSS1Compat"==document.compatMode,n=function(e,i){var n;return e&&(n=i.exec(t))?parseFloat(n[1]):0},o=document.documentMode,s=(e(/edge/),e(/opera/)),a=s&&e(/version\/10\.5/),l=!s&&(e(/msie/)||e(/trident/)||e(/edge/)),r=l&&(e(/msie 7/)&&8!=o&&9!=o&&10!=o||7==o),c=l&&(e(/msie 8/)&&7!=o&&9!=o&&10!=o||8==o),d=l&&(e(/msie 9/)&&7!=o&&8!=o&&10!=o||9==o),h=l&&(e(/msie 10/)&&7!=o&&8!=o&&9!=o||10==o),p=l&&(e(/trident\/7\.0/)&&7!=o&&8!=o&&9!=o&&10!=o||11==o),m=l&&e(/msie 6/),u=!l&&e(/\bchrome\b/),g=!l&&e(/webkit/),f=!l&&!u&&e(/safari/),b=f&&e(/applewebkit\/4/),C=f&&e(/version\/3/),v=f&&e(/version\/4/),_=f&&e(/version\/5\.0/),x=f&&e(/version\/5/),y=!g&&!l&&e(/gecko/),w=y&&e(/rv:1\.9/),S=y&&e(/rv:2\.0/),A=y&&e(/rv:5\./),k=y&&e(/rv:10\./),T=w&&e(/rv:1\.9\.0/),I=w&&e(/rv:1\.9\.1/),E=w&&e(/rv:1\.9\.2/),D=e(/windows|win32/),P=e(/macintosh|mac os x/),F=e(/linux/),R=n(!0,/\bchrome\/(\d+\.\d+)/),V=n(!0,/\bfirefox\/(\d+\.\d+)/),M=n(l,/msie (\d+\.\d+)/),U=n(s,/version\/(\d+\.\d+)/),L=n(f,/version\/(\d+\.\d+)/),B=n(g,/webkit\/(\d+\.\d+)/),O=/^https/i.test(window.location.protocol),N=(/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera),this),H=function(){var t={};if(window.AscCommon&&window.AscCommon.checkDeviceScale)t=window.AscCommon.checkDeviceScale(),AscCommon.correctApplicationScale(t);else{window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.25) and (-webkit-max-device-pixel-ratio: 1.49), screen and (min-resolution: 1.25dppx) and (max-resolution: 1.49dppx)").matches||window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5) and (-webkit-max-device-pixel-ratio: 1.74), screen and (min-resolution: 1.5dppx) and (max-resolution: 1.74dppx)").matches?t.devicePixelRatio=1.5:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.75) and (-webkit-max-device-pixel-ratio: 1.99), screen and (min-resolution: 1.75dppx) and (max-resolution: 1.99dppx)").matches?t.devicePixelRatio=1.75:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 2), screen and (min-resolution: 2dppx), screen and (min-resolution: 192dpi)").matches?t.devicePixelRatio=2:t.devicePixelRatio=1}var e=$(document.body),i=document.body.className,n=i.replace(/pixel-ratio__[\w-]+/gi,"").trim();t.devicePixelRatio<1.25?/pixel-ratio__/.test(i)&&(document.body.className=n):t.devicePixelRatio<1.5?/pixel-ratio__1_25/.test(i)||(document.body.className=n+" pixel-ratio__1_25"):t.devicePixelRatio<1.75?/pixel-ratio__1_5/.test(i)||(document.body.className=n+" pixel-ratio__1_5"):!(t.devicePixelRatio<1.75)&&t.devicePixelRatio<2?/pixel-ratio__1_75/.test(i)||(document.body.className=n+" pixel-ratio__1_75"):(e.addClass("pixel-ratio__2"),/pixel-ratio__2/.test(i)||(document.body.className=n+" pixel-ratio__2")),N.zoom=t.correct?t.zoom:1,N.innerWidth=window.innerWidth*N.zoom,N.innerHeight=window.innerHeight*N.zoom,N.applicationPixelRatio=t.applicationPixelRatio||t.devicePixelRatio};return checkSizeIE=function(){N.innerWidth=window.innerWidth,N.innerHeight=window.innerHeight},N.zoom=1,N.applicationPixelRatio=1,N.innerWidth=window.innerWidth,N.innerHeight=window.innerHeight,l?($(document.body).addClass("ie"),$(window).on("resize",checkSizeIE)):(H(),$(window).on("resize",H)),{checkSize:H,userAgent:t,isStrict:i,isIEQuirks:l&&!i&&(m||r||c||d),isOpera:s,isOpera10_5:a,isWebKit:g,isChrome:u,isSafari:f,isSafari3:C,isSafari4:v,isSafari5:x,isSafari5_0:_,isSafari2:b,isIE:l,isIE6:m,isIE7:r,isIE7m:m||r,isIE7p:l&&!m,isIE8:c,isIE8m:m||r||c,isIE8p:l&&!(m||r),isIE9:d,isIE9m:m||r||c||d,isIE9p:l&&!(m||r||c),isIE10:h,isIE10m:m||r||c||d||h,isIE10p:l&&!(m||r||c||d),isIE11:p,isIE11m:m||r||c||d||h||p,isIE11p:l&&!(m||r||c||d||h),isGecko:y,isGecko3:w,isGecko4:S,isGecko5:A,isGecko10:k,isFF3_0:T,isFF3_5:I,isFF3_6:E,isFF4:4<=V&&V<5,isFF5:5<=V&&V<6,isFF10:10<=V&&V<11,isLinux:F,isWindows:D,isMac:P,chromeVersion:R,firefoxVersion:V,ieVersion:M,operaVersion:U,safariVersion:L,webKitVersion:B,isSecure:O,emailRe:/^(mailto:)?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-яё0-9\._%+-=\? :&]*)/i,ipRe:/^(((https?)|(ftps?)):\/\/)?([\-\wа-яё]*:?[\-\wа-яё]*@)?(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/+@&#;:`~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?/i,hostnameRe:/^(((https?)|(ftps?)):\/\/)?([\-\wа-яё]*:?[\-\wа-яё]*@)?(([\-\wа-яё]+\.)+[\wа-яё\-]{2,}(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`'~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?)/i,localRe:/^(((https?)|(ftps?)):\/\/)([\-\wа-яё]*:?[\-\wа-яё]*@)?(([\-\wа-яё]+)(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`'~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?)/i,emailStrongRe:/(mailto:)?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-яё0-9\._%+-=\?:&]*)/gi,emailAddStrongRe:/(mailto:|\s[@]|\s[+])?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-яё0-9\._%\+-=\?:&]*)/gi,ipStrongRe:/(((https?)|(ftps?)):\/\/([\-\wа-яё]*:?[\-\wа-яё]*@)?)(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?/gi,hostnameStrongRe:/((((https?)|(ftps?)):\/\/([\-\wа-яё]*:?[\-\wа-яё]*@)?)|(([\-\wа-яё]*:?[\-\wа-яё]*@)?www\.))((([\-\wа-яё]+\.)+[\wа-яё\-]{2,}|([\-\wа-яё]+))(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?)/gi,documentSettingsType:{Paragraph:0,Table:1,Header:2,TextArt:3,Shape:4,Image:5,Slide:6,Chart:7,MailMerge:8,Signature:9,Pivot:10,Cell:11,Slicer:12,Form:13},importTextType:{DRM:0,CSV:1,TXT:2,Paste:3,Columns:4,Data:5},zoom:function(){return N.zoom},applicationPixelRatio:function(){return N.applicationPixelRatio},topOffset:0,innerWidth:function(){return N.innerWidth},innerHeight:function(){return N.innerHeight},croppedGeometry:function(){return{left:0,top:Common.Utils.InternalSettings.get("window-inactive-area-top"),width:N.innerWidth,height:N.innerHeight-Common.Utils.InternalSettings.get("window-inactive-area-top")}}}};Common.Utils=_extend_object(Common.Utils,utils),Common.Utils.ThemeColor=new function(){return{ThemeValues:[6,15,7,16,0,1,2,3,4,5],setColors:function(t,e){var i,n,o;if(e&&e.length>0){var s=[];for(i=0;i<e.length;i++)o=this.getHexColor(e[i].get_r(),e[i].get_g(),e[i].get_b()),s.push(o);this.standartcolors=s}var a=[];for(i=0;i<6;i++)for(n=0;n<10;n++){var l=i+6*n;o={color:this.getHexColor(t[l].get_r(),t[l].get_g(),t[l].get_b()),effectId:l,effectValue:this.ThemeValues[n]},a.push(o)}this.effectcolors=a},getEffectColors:function(){return this.effectcolors},getStandartColors:function(){return this.standartcolors},getHexColor:function(t,e,i){return t=t.toString(16),e=e.toString(16),i=i.toString(16),1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==i.length&&(i="0"+i),t+e+i},getRgbColor:function(t){var e="object"==typeof t?t.color:t;3==(e=e.replace(/#/,"")).length&&(e=e.replace(/(.)/g,"$1$1")),e=parseInt(e,16);var i=new Asc.asc_CColor;return i.put_type("object"==typeof t&&void 0!==t.effectId?Asc.c_oAscColor.COLOR_TYPE_SCHEME:Asc.c_oAscColor.COLOR_TYPE_SRGB),i.put_r(e>>16),i.put_g((65280&e)>>8),i.put_b(255&e),i.put_a(255),void 0!==t.effectId&&i.put_value(t.effectId),i},colorValue2EffectId:function(t){if("object"==typeof t&&t&&void 0!==t.effectValue&&this.effectcolors)for(var e=0;e<this.effectcolors.length;e++)if(this.effectcolors[e].effectValue===t.effectValue&&t.color.toUpperCase()===this.effectcolors[e].color.toUpperCase()){t.effectId=this.effectcolors[e].effectId;break}return t}}};var metrics=new function(){var t=this;return t.c_MetricUnits={cm:0,pt:1,inch:2},t.currentMetric=t.c_MetricUnits.pt,t.metricName=["Cm","Pt","Inch"],t.defaultMetric=t.c_MetricUnits.cm,{c_MetricUnits:t.c_MetricUnits,txtCm:"cm",txtPt:"pt",txtInch:'"',setCurrentMetric:function(e){t.currentMetric=e},getCurrentMetric:function(){return t.currentMetric},getCurrentMetricName:function(){return this["txt"+t.metricName[t.currentMetric]]},getMetricName:function(e){return this["txt"+t.metricName[void 0!==e?e:0]]},setDefaultMetric:function(e){t.defaultMetric=e},getDefaultMetric:function(){return t.defaultMetric},fnRecalcToMM:function(e){if(null!=e)switch(t.currentMetric){case t.c_MetricUnits.cm:return 10*e;case t.c_MetricUnits.pt:return 25.4*e/72;case t.c_MetricUnits.inch:return 25.4*e}return e},fnRecalcFromMM:function(e){switch(t.currentMetric){case t.c_MetricUnits.cm:return parseFloat((e/10).toFixed(4));case t.c_MetricUnits.pt:return parseFloat((72*e/25.4).toFixed(3));case t.c_MetricUnits.inch:return parseFloat((e/25.4).toFixed(3))}return e}}};Common.Utils.Metric=_extend_object(metrics,Common.Utils.Metric),Common.Utils.RGBColor=function(t){var e,i,n;"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase();for(var o=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^hsb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(t){var e={},i=Math.round(t[1]),n=Math.round(255*t[2]/100),o=Math.round(255*t[3]/100);if(0==n)e.r=e.g=e.b=o;else{var s=o,a=(255-n)*o/255,l=i%60*(s-a)/60;360==i&&(i=0),i<60?(e.r=s,e.b=a,e.g=a+l):i<120?(e.g=s,e.b=a,e.r=s-l):i<180?(e.g=s,e.r=a,e.b=a+l):i<240?(e.b=s,e.r=a,e.g=s-l):i<300?(e.b=s,e.g=a,e.r=a+l):i<360?(e.r=s,e.g=a,e.b=s-l):(e.r=0,e.g=0,e.b=0)}return[Math.round(e.r),Math.round(e.g),Math.round(e.b)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],s=0;s<o.length;s++){var a=o[s].re,l=o[s].process,r=a.exec(t);if(r){var c=l(r);e=c[0],i=c[1],n=c[2]}}e=e<0||isNaN(e)?0:e>255?255:e,i=i<0||isNaN(i)?0:i>255?255:i,n=n<0||isNaN(n)?0:n>255?255:n;return{r:e,g:i,b:n,isEqual:function(t){return e==t.r&&i==t.g&&n==t.b},toRGB:function(){return"rgb("+e+", "+i+", "+n+")"},toRGBA:function(t){return void 0===t&&(t=1),"rgba("+e+", "+i+", "+n+", "+t+")"},toHex:function(){var t=e.toString(16),o=i.toString(16),s=n.toString(16);return 1==t.length&&(t="0"+t),1==o.length&&(o="0"+o),1==s.length&&(s="0"+s),"#"+t+o+s},toHSB:function(){var t={h:0,s:0,b:0},o=Math.min(e,i,n),s=Math.max(e,i,n),a=s-o;return t.b=s,t.s=0!=s?255*a/s:0,0!=t.s?t.h=e==s?0+(i-n)/a:i==s?2+(n-e)/a:4+(e-i)/a:t.h=0,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.h=parseInt(t.h),t.s=parseInt(t.s),t.b=parseInt(t.b),t}}};var utilsString=new function(){return{textCtrl:"Ctrl",textShift:"Shift",textAlt:"Alt",format:function(t){var e=_.toArray(arguments).slice(1);return e.length&&"object"==typeof e[0]&&(e=e[0]),t.replace(/\{(\d+)\}/g,(function(t,i){return e[i]}))},htmlEncode:function(t){return"undefined"!=typeof _?_.escape(t):t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},htmlDecode:function(t){return _.unescape(t)},ellipsis:function(t,e,i){if(t&&t.length>e){if(i){var n=t.substr(0,e-2),o=Math.max(n.lastIndexOf(" "),n.lastIndexOf("."),n.lastIndexOf("!"),n.lastIndexOf("?"));if(-1!==o&&o>=e-15)return n.substr(0,o)+"..."}return t.substr(0,e-3)+"..."}return t},platformKey:function(t,e,i){return _.isEmpty(e)&&(e=" ({0})"),Common.Utils.isMac?(_.isFunction(i)&&(t=i.call(this,t)),Common.Utils.String.format(e,t.replace(/\+(?=\S)/g,"").replace(/Ctrl|ctrl/g,"⌘").replace(/Alt|alt/g,"⌥").replace(/Shift|shift/g,"⇧"))):Common.Utils.String.format(e,t.replace(/Ctrl|ctrl/g,this.textCtrl).replace(/Alt|alt/g,this.textAlt).replace(/Shift|shift/g,this.textShift))},parseFloat:function(t){return"string"==typeof t&&(t=t.replace(",",".")),parseFloat(t)},encodeSurrogateChar:function(t){if(t<65536)return String.fromCharCode(t);var e=55296|(t-=65536)>>10,i=56320|1023&t;return String.fromCharCode(e)+String.fromCharCode(i)},fixedDigits:function(t,e,i){void 0===i&&(i="0");for(var n="",o=t.toString(),s=o.length;s<e;s++)n+=i;return n+o}}};if(Common.Utils.String=_extend_object(utilsString,Common.Utils.String),Common.Utils.isBrowserSupported=function(){return!(0!=Common.Utils.ieVersion&&Common.Utils.ieVersion<10||0!=Common.Utils.safariVersion&&Common.Utils.safariVersion<5||0!=Common.Utils.firefoxVersion&&Common.Utils.firefoxVersion<4||0!=Common.Utils.chromeVersion&&Common.Utils.chromeVersion<7||0!=Common.Utils.operaVersion&&Common.Utils.operaVersion<10.5)},Common.Utils.showBrowserRestriction=function(){if(!(document.getElementsByClassName&&document.getElementsByClassName("app-error-panel").length>0)){var t=window.DE?"Document":window.SSE?"Spreadsheet":window.PE?"Presentation":"that",e=document.createElement("div");e.innerHTML='<div class="app-error-panel"><div class="message-block"><div class="message-inner"><div class="title">Your browser is not supported.</div><div class="text">Sorry, '+t+' Editor is currently only supported in the latest versions of the Chrome, Firefox, Safari or Internet Explorer web browsers.</div></div></div><div class="message-auxiliary"></div></div>',document.body.appendChild(e),$("#loading-mask").hide().remove(),$("#viewport").hide().remove()}},Common.Utils.applyCustomization=function(t,e){for(var i in t){var n;if(e[i]&&(n=$(e[i])).length){var o=t[i];!1===o||!1===o.visible?n.hide():(o.text&&n.text(o.text),!1===o.visible&&n.hide())}}},Common.Utils.applyCustomizationPlugins=function(plugins){if(plugins&&!(plugins.length<1)){var _createXMLHTTPObject=function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t},_getPluginCode=function(url){if(!url)return"";try{var xhrObj=_createXMLHTTPObject();xhrObj&&url&&(xhrObj.open("GET",url,!1),xhrObj.send(""),200==xhrObj.status&&eval(xhrObj.responseText))}catch(t){}return null};plugins.forEach((function(t){t&&_getPluginCode(t)}))}},Common.Utils.fillUserInfo=function(t,e,i,n){var o=t||{};return o.anonymous=!o.id,!o.id&&(o.id=n),o.fullname=o.name?o.name:i,o.group&&(o.fullname=o.group.toString()+AscCommon.UserInfoParser.getSeparator()+o.fullname),o.guest=!o.name,o},Common.Utils.createXhr=function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t},Common.Utils.getConfigJson=function(t){if(t)try{var e=Common.Utils.createXhr();if(e)return e.open("GET",t,!1),e.send(""),JSON.parse(e.responseText)}catch(t){}return null},Common.Utils.loadConfig=function(t,e){fetch(t,{method:"get",headers:{Accept:"application/json"}}).then((function(t){return t.ok?t.json():"error"})).then((function(t){e(t)})).catch((function(t){e("error")}))},Common.Utils.asyncCall=function(t,e,i){new Promise((function(t,e){t()})).then((function(){t.call(e,i)}))},String.prototype.strongMatch=function(t){if(t&&t instanceof RegExp){var e=this.toString().match(t);return!!(e&&e.length>0&&e[0].length==this.length)}return!1},Common.Utils.InternalSettings=new function(){var t={};return{get:function(e){return t[e]},set:function(e,i){t[e]=i}}},Common.Utils.lockControls=function(t,e,i,n){!i&&(i={});var o=i.array||n;function s(t,i){if(t&&t.options&&_.contains(t.options.lock,i)){var n=t.keepState.indexOf(i);e?n<0&&t.keepState.push(i):n<0||t.keepState.splice(n,1)}}i.merge&&(o=_.union(n,o)),_.each(o,(function(e){e&&_.isFunction(e.setDisabled)&&(!e.keepState&&(e.keepState=[]),i.clear&&i.clear.length>0&&e.keepState.length>0&&(e.keepState=_.difference(e.keepState,i.clear)),_.isArray(t)?_.each(t,(function(t){s(e,t)})):s(e,t),e.keepState.length>0?!e.isDisabled()&&e.setDisabled(!0):e.isDisabled()&&e.setDisabled(!1))}))},Common.Utils.injectButtons=function(t,e,i,n,o,s,a,l,r,c,d,h){var p=createButtonSet();return p.setDisabled(!0),e=e||"id-toolbar-"+i,t.each((function(m,u){var g="btn-toolbar";/x-huge/.test(u.className)&&(g+=" x-huge icon-top");var f=new Common.UI.Button({parentEl:t.eq(m),id:e+m,cls:g,iconCls:i,caption:n,split:s||!1,menu:a||!1,enableToggle:l||!1,lock:o,disabled:!0,dataHint:r,dataHintDirection:c,dataHintOffset:d,dataHintTitle:h});p.add(f)})),p},Common.Utils.injectComponent=function(t,e){e&&t.length&&(e.rendered?t.append(e.$el):e.render(t))},Common.Utils.warningDocumentIsLocked=function(t){t.disablefunc&&t.disablefunc(!0);var e=window.DE||window.PE||window.SSE;Common.UI.warning({msg:Common.Locale.get("warnFileLocked",{name:"Common.Translation",default:"You can't edit this file. Document is in use by another application."}),buttons:[{value:"view",caption:Common.Locale.get("warnFileLockedBtnView",{name:"Common.Translation",default:"Open for viewing"})},{value:"edit",caption:Common.Locale.get("warnFileLockedBtnEdit",{name:"Common.Translation",default:"Create a copy"})}],primary:"view",callback:function(i){"edit"==i&&(t.disablefunc&&t.disablefunc(!1),e.getController("Main").api.asc_setIsReadOnly(!1))}})},jQuery.fn.extend({elementById:function(t,e){var i=document.getElementById(t.substring(1));if(!i)if((e=e||this)&&e.length>0)e.each((function(e,n){if(n.querySelectorAll)if(0==(i=n.querySelectorAll(t)).length){if("#"+n.id==t)return i=n,!1}else if(i.length)return i=i[0],!1}));else if(e&&e.querySelectorAll&&(i=e.querySelectorAll(t))&&i.length)return i[0];return i},findById:function(t,e){var i=$.fn.elementById.apply(this,arguments);return i?$(i):$()}}),Common.Utils.InternalSettings.set("toolbar-height-tabs",32),Common.Utils.InternalSettings.set("toolbar-height-tabs-top-title",28),Common.Utils.InternalSettings.set("toolbar-height-controls",67),Common.Utils.InternalSettings.set("document-title-height",28),Common.Utils.InternalSettings.set("window-inactive-area-top",0),Common.Utils.InternalSettings.set("toolbar-height-compact",Common.Utils.InternalSettings.get("toolbar-height-tabs")),Common.Utils.InternalSettings.set("toolbar-height-normal",Common.Utils.InternalSettings.get("toolbar-height-tabs")+Common.Utils.InternalSettings.get("toolbar-height-controls")),Common.Utils.ModalWindow=new function(){var t=0;return{show:function(){t++},close:function(){t--},isVisible:function(){return t>0}}},Common.Utils.UserInfoParser=new function(){var t=!1,e=String.fromCharCode(160);return{setParser:function(e){t=!!e},getSeparator:function(){return e},getParsedName:function(i){return t&&i?i.substring(i.indexOf(e)+1):i},getParsedGroups:function(i){if(t&&i){for(var n=i.indexOf(e),o=n>-1?i.substring(0,n).split(","):[],s=0;s<o.length;s++)o[s]=o[s].trim();return o}}}},Common.Utils.getKeyByValue=function(t,e){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e)return i},define("common/main/lib/util/utils",(function(){})),function(t){var e,i,n,o={},s={16:!1,18:!1,17:!1,91:!1},a="all",l={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},r={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220,"ff-":173,"ff=":61},c=function(t){return r[t]||t.toUpperCase().charCodeAt(0)},d=[];for(e=1;e<20;e++)r["f"+e]=111+e;function h(t,e){for(var i=t.length;i--;)if(t[i]===e)return i;return-1}function p(t,e){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var m={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function u(t){for(e in s)s[e]=t[m[e]]}function g(t,e,i){var n,s;n=b(t),void 0===i&&(i=e,e="all");for(var a=0;a<n.length;a++)s=[],(t=n[a].split("+")).length>1&&(s=C(t),t=[t[t.length-1]]),t=t[0],(t=c(t))in o||(o[t]=[]),o[t].push({shortcut:n[a],scope:e,method:i,key:n[a],mods:s})}for(e in l)g[e]=!1;function f(){return a||"all"}function b(t){var e;return""==(e=(t=t.replace(/\s/g,"")).split(","))[e.length-1]&&(e[e.length-2]+=","),e}function C(t){for(var e=t.slice(0,t.length-1),i=0;i<e.length;i++)e[i]=l[e[i]];return e}function v(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,(function(){i(window.event)}))}v(document,"keydown",(function(t){!function(t){var e,a,r,c,p,m;if(e=t.keyCode,Common.UI.HintManager&&Common.UI.HintManager.isHintVisible())if(112===e)Common.UI.HintManager.clearHints();else if(27!==e)return;if(-1==h(d,e)&&d.push(e),93!=e&&224!=e||(e=91),e in s)for(r in s[e]=!0,l)l[r]==e&&(g[r]=!0);else if(u(t),g.filter.call(this,t)&&e in o)for(m=f(),c=0;c<o[e].length;c++)if((a=o[e][c]).scope==m||"all"==a.scope){for(r in p=a.mods.length>0,s)(!s[r]&&h(a.mods,+r)>-1||s[r]&&-1==h(a.mods,+r))&&(p=!1);if((0==a.mods.length&&!s[16]&&!s[18]&&!s[17]&&!s[91]||p)&&(!0===i||a.locked||!1===a.method(t,a))){if(!0===i&&n||a.locked&&a.propagate)continue;t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)}}}(t)})),v(document,"keyup",(function(t){var e,i=t.keyCode,n=h(d,i);if(n>=0&&d.splice(n,1),93!=i&&224!=i||(i=91),i in s)for(e in s[i]=!1,l)l[e]==i&&(g[e]=!1)})),v(window,"focus",(function(){for(e in s)s[e]=!1;for(e in l)g[e]=!1}));var _=t.key;function x(t,e,i,n){for(var s,a,l,r=[],d=b(t),h=d.length;h--;)if((s=d[h].split("+")).length>1&&(r=C(s)),s.length>0&&(t=s[s.length-1]),t=c(t),void 0===e&&(e=f()),o[t])for(a in o[t])(l=o[t][a]).scope===e&&p(l.mods,r)&&(o[t][a][i]=n)}t.key=g,t.key.setScope=function(t){a=t||"all"},t.key.getScope=f,t.key.deleteScope=function(t){var e,i,n;for(e in o)for(i=o[e],n=0;n<i.length;)i[n].scope===t?i.splice(n,1):n++},t.key.filter=function(t){var e=(t.target||t.srcElement).tagName;return!("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)},t.key.isPressed=function(t){return"string"==typeof t&&(t=c(t)),-1!=h(d,t)},t.key.getPressedKeyCodes=function(){return d.slice(0)},t.key.noConflict=function(){var e=t.key;return t.key=_,e},t.key.unbind=function(t,e){var i,n,s,a,l,r=[];for(i=b(t),a=0;a<i.length;a++){if((n=i[a].split("+")).length>1&&(r=C(n)),n.length>0&&(t=n[n.length-1]),t=c(t),void 0===e&&(e=f()),!o[t])return;for(s in o[t])(l=o[t][s]).scope===e&&p(l.mods,r)&&(o[t][s]={})}},t.key.suspend=function(t,e,o){t?(x(t,e,"locked",!0),o&&x(t,e,"propagate",!0)):(i=!0,o&&(n=!0))},t.key.resume=function(t,e){t?(x(t,e,"locked",!1),x(t,e,"propagate",!1)):i=n=!1},"undefined"!=typeof module&&(module.exports=key)}(this),define("keymaster",(function(){})),void 0===Common)var Common={};if(Common.util=Common.util||{},define("common/main/lib/util/Shortcuts",["backbone","keymaster"],(function(t){"use strict";var e=function(t){return this.cid=_.uniqueId("shortcuts"),this.initialize.apply(this,arguments),this};_.extend(e.prototype,t.Events,{initialize:function(){window.key.filter=function(t){return!0},Common.NotificationCenter.on({"modal:show":function(t){window.key.suspend()},"modal:close":function(t,e){e&&window.key.resume()},"modal:hide":function(t,e){e&&window.key.resume()}})},delegateShortcuts:function(t){if(t&&t.shortcuts){var e,i,n,o,s,a;this.removeShortcuts(t);var l=[];for(s in t.shortcuts){if(e=t.shortcuts[s],_.isFunction(e))n=e;else if(!(n=t[e]))throw new Error("Method "+e+" does not exist");a=(i=s.match(/^(\S+)\s*(.*)$/))[1],o=i[2].length?i[2]:"all",n=_.bind(n,this),l.push(window.key(a,o,n))}}},removeShortcuts:function(t){if(t&&t.shortcuts){var e,i,n,o;for(n in t.shortcuts)o=(e=n.match(/^(\S+)\s*(.*)$/))[1],i=e[2].length?e[2]:"all",window.key.unbind(o,i)}},suspendEvents:function(t,e,i){window.key.suspend(t,e,i)},resumeEvents:function(t,e){window.key.resume(t,e)}}),e.extend=t.View.extend,Common.util.Shortcuts=new e})),void 0===Common)var Common={};if(define("common/main/lib/view/CopyWarningDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.CopyWarningDialog=Common.UI.Window.extend(_.extend({options:{width:500,height:325,cls:"modal-dlg copy-warning",buttons:["ok"]},initialize:function(t){_.extend(this.options,{title:this.textTitle,buttons:["ok"]},t||{}),this.template=['<div class="box">','<p class="message">'+this.textMsg+"</p>",'<div class="hotkeys">',"<div>",'<p class="hotkey">'+Common.Utils.String.platformKey("Ctrl+C","{0}")+"</p>",'<p class="message">'+this.textToCopy+"</p>","</div>","<div>",'<p class="hotkey">'+Common.Utils.String.platformKey("Ctrl+X","{0}")+"</p>",'<p class="message">'+this.textToCut+"</p>","</div>","<div>",'<p class="hotkey">'+Common.Utils.String.platformKey("Ctrl+V","{0}")+"</p>",'<p class="message">'+this.textToPaste+"</p>","</div>","</div>",'<div id="copy-warning-checkbox" style="margin-top: 20px; text-align: left;"></div>',"</div>",'<div class="separator horizontal"></div>'].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.chDontShow=new Common.UI.CheckBox({el:$("#copy-warning-checkbox"),labelText:this.textDontShow}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.autoSize()},autoSize:function(){var t=this.getChild(".box"),e=this.getChild(".footer"),i=this.getChild(".header"),n=this.getChild(".body");n.height(parseInt(t.height())+parseInt(e.css("height"))),this.setHeight(parseInt(n.css("height"))+parseInt(i.css("height")))},onBtnClick:function(t){this.options.handler&&this.options.handler.call(this,"checked"==this.chDontShow.getValue()),this.close()},onKeyPress:function(t){t.keyCode==Common.UI.Keys.RETURN&&(this.options.handler&&this.options.handler.call(this,"checked"==this.chDontShow.getValue()),this.close())},getSettings:function(){return"checked"==this.chDontShow.getValue()},textTitle:"Copy, Cut and Paste Actions",textMsg:"Copy, cut and paste actions using the editor toolbar buttons and context menu actions will be performed within this editor tab only.<br><br>To copy or paste to or from applications outside the editor tab use the following keyboard combinations:",textToCopy:"for Copy",textToPaste:"for Paste",textToCut:"for Cut",textDontShow:"Don't show this message again"},Common.Views.CopyWarningDialog||{}))})),define("common/main/lib/view/OpenDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.OpenDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e,i,n=this,o={};if(t.preview)e=414,i=t.type==Common.Utils.importTextType.Data?385:277;else switch(e=t.type!==Common.Utils.importTextType.DRM?340:t.warning?420:280,t.type){case Common.Utils.importTextType.CSV:case Common.Utils.importTextType.Paste:case Common.Utils.importTextType.Columns:i=190;break;case Common.Utils.importTextType.Data:i=245;break;default:i=t.warning?187:147}_.extend(o,{closable:!1,preview:t.preview,warning:t.warning,codepages:t.codepages,warningMsg:t.warningMsg,width:e,height:i,header:!0,cls:"open-dlg",contentTemplate:"",toolcallback:_.bind(n.onToolClose,n),closeFile:!1},t),this.txtOpenFile=t.txtOpenFile||this.txtOpenFile,this.template=t.template||['<div class="box" style="height:'+(o.height-85)+'px;">','<div class="content-panel" >',"<% if (type == Common.Utils.importTextType.DRM) { %>","<% if (warning) { %>","<div>",'<div class="icon warn"></div>','<div style="padding-left: 50px;"><div style="font-size: 12px;">'+("string"==typeof o.warningMsg?o.warningMsg:n.txtProtected)+"</div>",'<label class="header" style="margin-top: 15px;">'+n.txtPassword+"</label>",'<div id="id-password-txt" style="width: 290px;"></div></div>',"</div>","<% } else { %>","<div>",'<label class="">'+n.txtOpenFile+"</label>",'<div id="id-password-txt"></div>',"</div>","<% } %>","<% } else { %>","<% if (codepages && codepages.length>0) { %>",'<div style="<% if (!!preview && (type == Common.Utils.importTextType.CSV || type == Common.Utils.importTextType.Paste || type == Common.Utils.importTextType.Columns)) { %>width: 230px;margin-right: 10px;display: inline-block;<% } else { %>width: 100%;<% } %>margin-bottom:15px;">','<label class="header">'+n.txtEncoding+"</label>","<div>",'<div id="id-codepages-combo" class="input-group-nr" style="width: 100%; display: inline-block; vertical-align: middle;"></div>',"</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.CSV) { %>",'<div style="display: inline-block; margin-bottom:15px;">','<label class="header">'+n.txtDelimiter+"</label>","<div>",'<div id="id-delimiters-combo" class="input-group-nr" style="max-width: 100px;display: inline-block; vertical-align: middle;"></div>','<div id="id-delimiter-other" class="input-row" style="display: inline-block; vertical-align: middle;margin-left: 10px;"></div>',"</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.Paste || type == Common.Utils.importTextType.Columns || type == Common.Utils.importTextType.Data) { %>",'<div style="display: inline-block; margin-bottom:15px;width: 100%;">','<label class="header">'+n.txtDelimiter+"</label>","<div>",'<div id="id-delimiters-combo" class="input-group-nr" style="max-width: 100px;display: inline-block; vertical-align: middle;"></div>','<div id="id-delimiter-other" class="input-row" style="display: inline-block; vertical-align: middle;margin-left: 10px;"></div>','<button type="button" class="btn auto btn-text-default" id="id-delimiters-advanced" style="min-width:100px; display: inline-block;float:right;">'+n.txtAdvanced+"</button>","</div>","</div>","<% } %>","<% if (!!preview) { %>",'<div style="">','<label class="header">'+n.txtPreview+"</label>",'<div style="position: relative;">','<div style="width: 100%;">','<div id="id-preview">',"<div>",'<div style="position: absolute; top: 0;"><div id="id-preview-data"></div></div>',"</div>","</div>","</div>","</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.Data) { %>",'<label class="header" style="margin-top:15px;">'+n.txtDestData+"</label>",'<div id="id-open-data-range" class="input-row" style="width: 100%;"></div>',"<% } %>","<% } %>","</div>","</div>",'<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok">'+n.okButtonText+"</button>","<% if (closeFile) { %>",'<button class="btn normal dlg-btn custom" result="cancel" style="margin-left:10px;">'+n.closeButtonText+"</button>","<% } %>","<% if (closable) { %>",'<button class="btn normal dlg-btn custom" result="cancel" style="margin-left:10px;">'+n.cancelButtonText+"</button>","<% } %>","</div>"].join(""),this.handler=o.handler,this.type=o.type,this.preview=o.preview,this.previewData=o.previewData,this.warning=o.warning||!1,this.closable=o.closable,this.codepages=o.codepages,this.settings=o.settings,this.api=o.api,this.validatePwd=o.validatePwd||!1,o.tpl=_.template(this.template)(o),this._previewTdWidth=[],this._previewTdMaxLength=0,Common.UI.Window.prototype.initialize.call(this,o)},render:function(){if(Common.UI.Window.prototype.render.call(this),this.$window){var t=this;this.closable||this.$window.find(".tool").hide(),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.previewPanel=this.$window.find("#id-preview-data"),this.previewParent=this.previewPanel.parent(),this.previewScrolled=this.$window.find("#id-preview"),this.previewInner=this.previewScrolled.find("div:first-child"),this.type==Common.Utils.importTextType.DRM?this.inputPwd=new Common.UI.InputFieldBtnPassword({el:$("#id-password-txt"),type:"password",showCls:("svg"===this.options.iconType?"svg-icon":"toolbar__icon")+" btn-sheet-view",hideCls:("svg"===this.options.iconType?"svg-icon":"toolbar__icon")+" hide-password",validateOnBlur:!1,showPwdOnClick:!0,validation:function(e){return t.txtIncorrectPwd}}):(this.initCodePages(),this.preview&&(this.previewData?this.previewCallback(this.previewData):this.updatePreview())),this.type==Common.Utils.importTextType.Data&&(this.txtDestRange=new Common.UI.InputFieldBtn({el:$("#id-open-data-range"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0,validateOnBlur:!1}),this.txtDestRange.on("button:click",_.bind(this.onSelectData,this)),this.dataDestValid=this.api.asc_getActiveRangeStr(Asc.referenceType.A,!0),this.txtDestRange.setValue(this.dataDestValid)),this.onPrimary=function(){return t._handleInput("ok"),!1}}},getFocusedComponents:function(){var t=[];return this.inputPwd&&t.push(this.inputPwd),this.cmbEncoding&&t.push(this.cmbEncoding),this.cmbDelimiter&&t.push(this.cmbDelimiter),this.inputDelimiter&&t.push(this.inputDelimiter),this.btnAdvanced&&t.push(this.btnAdvanced),this.txtDestRange&&t.push(this.txtDestRange),t},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;if(this.type==Common.Utils.importTextType.DRM)setTimeout((function(){t.inputPwd.focus(),t.validatePwd&&t.inputPwd.checkValidate()}),500);else{var e=t.txtDestRange?t.txtDestRange:t.cmbEncoding?t.cmbEncoding:t.cmbDelimiter;e&&setTimeout((function(){e.focus()}),500)}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onToolClose:function(){this._handleInput("cancel")},_handleInput:function(t){if(this.handler)if(this.type==Common.Utils.importTextType.DRM)this.handler.call(this,t,{drmOptions:new Asc.asc_CDRMAdvancedOptions(this.inputPwd.getValue())});else{if(this.type==Common.Utils.importTextType.Data&&"ok"==t&&!this.isRangeValid())return;var e=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0,i=this.cmbDelimiter?this.cmbDelimiter.getValue():null,n=-1==i?this.inputDelimiter.getValue():null;-1==i&&(i=null),this.closable||this.type!=Common.Utils.importTextType.TXT||Common.localStorage.setItem("de-settings-open-encoding",e);var o=this.separatorOptions?this.separatorOptions.decimal:void 0,s=this.separatorOptions?this.separatorOptions.thousands:void 0,a=this.separatorOptions?this.separatorOptions.qualifier:'"',l=new Asc.asc_CTextOptions(e,i,n);o&&l.asc_setNumberDecimalSeparator(o),s&&l.asc_setNumberGroupSeparator(s),a&&l.asc_setTextQualifier(a),this.handler.call(this,t,{textOptions:l,range:this.txtDestRange?this.txtDestRange.getValue():"",data:this.data})}this.close()},initCodePages:function(){var t,e,i,n,o=[],s=[],a=0;if(this.codepages){for(o=[],t=0;t<this.codepages.length;++t)i=this.codepages[t],(e=[])[0]=i.asc_getCodePage(),e[1]=i.asc_getCodePageName(),e[2]=i.asc_getLcid(),o.push(e);a=50}if(n=o.length){for(t=0;t<n;++t)s.push({value:o[t][0],displayValue:Common.Utils.String.htmlEncode(o[t][1]),lcid:o[t][2]||""});var l=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="display: inline-block;"><%= item.displayValue %></div>','<label style="text-align: right;width:'+a+'px;"><%= item.lcid %></label>',"</a></li>","<% }); %>"].join(""));this.cmbEncoding=new Common.UI.ComboBox({el:$("#id-codepages-combo",this.$window),style:"width: 100%;",menuStyle:"min-width: 100%; max-height: 200px;",cls:"input-group-nr",menuCls:"scrollable-menu",data:s,editable:!1,disabled:!0,search:!0,itemsTemplate:l,takeFocusOnClose:!0}),this.cmbEncoding.setDisabled(!1);var r=this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():o[0][0];if(!this.closable&&this.type==Common.Utils.importTextType.TXT){var c=Common.localStorage.getItem("de-settings-open-encoding");c&&(r=parseInt(c))}this.cmbEncoding.setValue(r),this.preview&&this.cmbEncoding.on("selected",_.bind(this.onCmbEncodingSelect,this));var d=this.cmbEncoding.cmpEl.find("ul"),h=d.find("li:nth(0) a"),p=d.width()-parseInt(h.css("padding-left"))-parseInt(h.css("padding-right"))-50;d.find("li div").width(p)}this.type!=Common.Utils.importTextType.CSV&&this.type!=Common.Utils.importTextType.Paste&&this.type!=Common.Utils.importTextType.Columns&&this.type!=Common.Utils.importTextType.Data||(this.cmbDelimiter=new Common.UI.ComboBox({el:$("#id-delimiters-combo",this.$window),style:"width: 100px;",menuStyle:"min-width: 100px;",cls:"input-group-nr",data:[{value:4,displayValue:this.txtComma},{value:2,displayValue:this.txtSemicolon},{value:3,displayValue:this.txtColon},{value:1,displayValue:this.txtTab},{value:5,displayValue:this.txtSpace},{value:-1,displayValue:this.txtOther}],editable:!1,takeFocusOnClose:!0}),this.cmbDelimiter.setValue(this.settings&&this.settings.asc_getDelimiter()?this.settings.asc_getDelimiter():4),this.cmbDelimiter.on("selected",_.bind(this.onCmbDelimiterSelect,this)),this.inputDelimiter=new Common.UI.InputField({el:$("#id-delimiter-other"),style:"width: 30px;",maxLength:1,validateOnChange:!0,validateOnBlur:!1,value:this.settings&&this.settings.asc_getDelimiterChar()?this.settings.asc_getDelimiterChar():""}),this.inputDelimiter.setVisible(!1),this.preview&&this.inputDelimiter.on("changing",_.bind(this.updatePreview,this)),this.type!=Common.Utils.importTextType.Paste&&this.type!=Common.Utils.importTextType.Columns&&this.type!=Common.Utils.importTextType.Data||(this.btnAdvanced=new Common.UI.Button({el:$("#id-delimiters-advanced")}),this.btnAdvanced.on("click",_.bind(this.onAdvancedClick,this))))},updatePreview:function(){this._previewTdWidth=[],this._previewTdMaxLength=0;var t=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0,e=this.cmbDelimiter?this.cmbDelimiter.getValue():null,i=-1==e?this.inputDelimiter.getValue():null;-1==e&&(e=null);var n=new Asc.asc_CTextOptions(t,e,i);switch(this.separatorOptions&&(n.asc_setNumberDecimalSeparator(this.separatorOptions.decimal),n.asc_setNumberGroupSeparator(this.separatorOptions.thousands),n.asc_setTextQualifier(this.separatorOptions.qualifier)),this.type){case Common.Utils.importTextType.CSV:case Common.Utils.importTextType.TXT:case Common.Utils.importTextType.Data:this.api.asc_decodeBuffer(this.preview,n,_.bind(this.previewCallback,this));break;case Common.Utils.importTextType.Paste:case Common.Utils.importTextType.Columns:this.api.asc_TextImport(n,_.bind(this.previewCallback,this),this.type==Common.Utils.importTextType.Paste)}},previewCallback:function(t){t&&t.length&&(this.data=t,this.previewInner.height(17*t.length),this.scrollerY||(this.scrollerY=new Common.UI.Scroller({el:this.previewScrolled,minScrollbarLength:20,alwaysVisibleY:!0,alwaysVisibleX:!0,onChange:_.bind((function(){if(this.scrollerY){var t=this.scrollerY.getScrollTop(),e=Math.floor(t/17+.5),i=e+Math.min(6,this.data.length);i>this.data.length&&(i=this.data.length,t=17*(e=this.data.length-6)),this.previewParent.height(108),this.previewParent.css({top:t}),this.previewDataBlock(this.data.slice(e,i))}}),this)})),this.scrollerY.update(),this.scrollerY.scrollTop(0))},previewDataBlock:function(t){if(_.isUndefined(this.scrollerX)||(this.scrollerX.destroy(),delete this.scrollerX),this.type==Common.Utils.importTextType.CSV||this.type==Common.Utils.importTextType.Paste||this.type==Common.Utils.importTextType.Columns||this.type==Common.Utils.importTextType.Data){for(var e=0,i=0;i<t.length;i++){(o=t[i]||"").length>e&&(e=o.length)}this._previewTdMaxLength=Math.max(this._previewTdMaxLength,e);var n="<table>";for(i=0;i<t.length;i++){var o=t[i]||"";n+='<tr style="vertical-align: top;">';for(var s=0;s<o.length;s++){var a="";0==i&&this._previewTdWidth[s]&&(a='style="min-width:'+this._previewTdWidth[s]+'px;"'),n+="<td "+a+">"+Common.Utils.String.htmlEncode(o[s])+"</td>"}for(s=o.length;s<this._previewTdMaxLength;s++){a="";0==i&&this._previewTdWidth[s]&&(a='style="min-width:'+this._previewTdWidth[s]+'px;"'),n+="<td "+a+"></td>"}n+="</tr>"}n+="</table>"}else{for(n="<table>",i=0;i<t.length;i++){o=t[i]||"";n+='<tr style="vertical-align: top;"><td>'+Common.Utils.String.htmlEncode(o)+"</td></tr>"}n+="</table>"}if(this.previewPanel.html(n),t.length>0){var l=this;0===this._previewTdWidth.length&&this.previewScrolled.scrollLeft(0),this.previewPanel.find("tr:first td").each((function(t,e){l._previewTdWidth[t]=Math.max(Math.max(Math.ceil($(e).outerWidth()),30),l._previewTdWidth[t]||0)}))}this.scrollerX=new Common.UI.Scroller({el:this.previewPanel,suppressScrollY:!0,alwaysVisibleX:!0,minScrollbarLength:20})},onCmbDelimiterSelect:function(t,e){this.inputDelimiter.setVisible(-1==e.value);var i=this;-1==e.value&&setTimeout((function(){i.inputDelimiter.focus()}),10),this.preview&&this.updatePreview()},onCmbEncodingSelect:function(t,e){this.updatePreview()},onAdvancedClick:function(){if(SSE){var t=this,e=this.separatorOptions?this.separatorOptions.decimal:this.api.asc_getDecimalSeparator(),i=this.separatorOptions?this.separatorOptions.thousands:this.api.asc_getGroupSeparator(),n=this.separatorOptions?this.separatorOptions.qualifier:(this.settings||new Asc.asc_CTextOptions).asc_getTextQualifier();new SSE.Views.AdvancedSeparatorDialog({props:{decimal:e,thousands:i,qualifier:n},handler:function(n,o){"ok"==n&&(t.separatorOptions={decimal:o.decimal.length>0?o.decimal:e,thousands:o.thousands.length>0?o.thousands:i,qualifier:o.qualifier},t.preview&&t.updatePreview())}}).show()}},onSelectData:function(t){var e=this,i=e.txtDestRange;if(e.api){var n=new SSE.Views.CellRangeDialog({handler:function(t,n){if("ok"==n){var o=t.getSettings();e.dataDestValid=o,i.setValue(o),i.checkValidate()}}}).on("close",(function(){e.show(),_.delay((function(){i.focus()}),1)})),o=e.$window.offset();e.hide(),n.show(o.left+160,o.top+125),n.setSettings({api:e.api,range:_.isEmpty(i.getValue())||1!=i.checkValidate()?e.dataDestValid:i.getValue(),type:Asc.c_oAscSelectionDialogType.Chart})}},isRangeValid:function(){var t=!0,e="";return _.isEmpty(this.txtDestRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,this.txtDestRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),t||(this.txtDestRange.showError([e]),this.txtDestRange.focus(),t)},txtDelimiter:"Delimiter",txtEncoding:"Encoding ",txtSpace:"Space",txtTab:"Tab",txtTitle:"Choose %1 options",txtPassword:"Password",txtTitleProtected:"Protected File",txtOther:"Other",txtIncorrectPwd:"Password is incorrect.",closeButtonText:"Close File",txtPreview:"Preview",txtComma:"Comma",txtColon:"Colon",txtSemicolon:"Semicolon",txtProtected:"Once you enter the password and open the file, the current password to the file will be reset.",txtAdvanced:"Advanced",txtOpenFile:"Enter a password to open the file",textSelectData:"Select data",txtDestData:"Choose where to put the data",txtEmpty:"This field is required",textInvalidRange:"Invalid cells range"},Common.Views.OpenDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/MetricSpinner",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.MetricSpinner=Common.UI.BaseView.extend({options:{minValue:0,maxValue:100,step:1,defaultUnit:"px",allowAuto:!1,autoText:"Auto",hold:!0,speed:"medium",width:90,allowDecimal:!0,dataHint:"",dataHintDirection:"",dataHintOffset:""},disabled:!1,value:"0 px",rendered:!1,template:'<input type="text" class="form-control" spellcheck="false" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>"><div class="spinner-buttons"><button type="button" class="spinner-up"><i class="arrow"></i></button><button type="button" class="spinner-down"><i class="arrow"></i></button></div>',initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);i.addClass("spinner"),i.on("mousedown",".spinner-up",_.bind(this.onMouseDown,this,!0)),i.on("mousedown",".spinner-down",_.bind(this.onMouseDown,this,!1)),i.on("mouseup",".spinner-up",_.bind(this.onMouseUp,this,!0)),i.on("mouseup",".spinner-down",_.bind(this.onMouseUp,this,!1)),i.on("mouseover",".spinner-up, .spinner-down",_.bind(this.onMouseOver,this)),i.on("mouseout",".spinner-up, .spinner-down",_.bind(this.onMouseOut,this)),i.on("keydown",".form-control",_.bind(this.onKeyDown,this)),i.on("keyup",".form-control",_.bind(this.onKeyUp,this)),i.on("blur",".form-control",_.bind(this.onBlur,this)),i.on("input",".form-control",_.bind(this.onInput,this)),this.options.allowDecimal||i.on("keypress",".form-control",_.bind(this.onKeyPress,this)),i.on("focus","input.form-control",(function(t){setTimeout((function(){e.$input&&(e.$input[0].selectionStart=0,e.$input[0].selectionEnd=e.$input.val().length)}),1)})),Common.Utils.isGecko&&i.on("blur","input.form-control",(function(){setTimeout((function(){e.$input&&(e.$input[0].selectionStart=e.$input[0].selectionEnd=0)}),1)})),this.switches={count:1,enabled:!0,fromKeyDown:!1},"medium"===this.options.speed?this.switches.speed=300:"fast"===this.options.speed?this.switches.speed=100:this.switches.speed=500,this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.value&&(this.value=this.options.value),this.setRawValue(this.value),this.options.width&&i.width(this.options.width),void 0===this.options.defaultValue&&(this.options.defaultValue=this.options.minValue),this.oldValue=this.options.minValue,this.lastValue=null},render:function(){var t=this.$el||$(this.el),e=_.template(this.template);return t.html($(e({dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset}))),this.$input=t.find(".form-control"),this.rendered=!0,null!=this.options.tabindex&&this.$input.attr("tabindex",this.options.tabindex),this},setDisabled:function(t){t=!!t;var e=this.$el||$(this.el);t!==this.disabled&&(e.find("button").toggleClass("disabled",t),e.toggleClass("disabled",t),t?this.$input.attr({disabled:t}):this.$input.removeAttr("disabled")),this.disabled=t},isDisabled:function(){return this.disabled},setDefaultUnit:function(t){if(this.options.defaultUnit!=t){var e=this.options.defaultUnit;this.options.defaultUnit=t,this.setMinValue(this._recalcUnits(this.options.minValue,e)),this.setMaxValue(this._recalcUnits(this.options.maxValue,e)),this.setValue(this._recalcUnits(this.getNumberValue(),e),!0)}},setMinValue:function(t){this.options.minValue=t},setMaxValue:function(t){this.options.maxValue=t},setStep:function(t){this.options.step=t},getMinValue:function(){return this.options.minValue},getMaxValue:function(){return this.options.maxValue},getNumberValue:function(){return this.checkAutoText(this.value)?-1:parseFloat(this.value)},getUnitValue:function(){return this.options.defaultUnit},getValue:function(){return this.value},setRawValue:function(t){this.$input&&this.$input.val(t)},getRawValue:function(){return this.$input.val()},setValue:function(t,e){var i=!1;if(this._fromKeyDown=!1,this.lastValue=this.value,void 0===t||""===t)this.value="";else if(this.options.allowAuto&&(Math.abs(Common.Utils.String.parseFloat(t)+1)<1e-4||this.checkAutoText(t)))this.value=this.options.autoText;else{var n=this._add(Common.Utils.String.parseFloat(t),0,this.options.allowDecimal?3:0);(void 0===t||isNaN(n))&&(n=this.oldValue,i=!0);var o=this.options.defaultUnit;if(void 0!==t.match){var s=t.match(/(px|em|%|en|ex|pt|"|cm|mm|pc|s|ms|см|мм|пт|сек|мс)$/i);null!==s&&"undefined"!==s[0]&&(o=s[0].toLowerCase())}this.options.defaultUnit===o||i||(n=this._recalcUnits(n,o)),n>this.options.maxValue&&(n=this.options.maxValue,i=!0),n<this.options.minValue&&(n=this.options.minValue,i=!0),this.value=(n+" "+this.options.defaultUnit).trim(),this.oldValue=n}!0!==e&&this.lastValue!==this.value&&this.trigger("change",this,this.value,this.lastValue),!0!==e&&i&&this.trigger("inputerror",this,this.value),this.rendered?this.setRawValue(this.value):this.options.value=this.value},setMask:function(t){this.options.maskExp=t},onMouseDown:function(t,e){this.disabled||(e&&$(e.currentTarget).addClass("active"),this.options.hold&&(this.switches.fromKeyDown=!1,this._startSpin(t,e)))},onMouseUp:function(t,e){this.disabled||($(e.currentTarget).removeClass("active"),this.options.hold?this._stopSpin():this._step(t))},onMouseOver:function(t){this.disabled||$(t.currentTarget).addClass("over")},onMouseOut:function(t){this.disabled||($(t.currentTarget).removeClass("active over"),this.options.hold&&this._stopSpin())},onKeyDown:function(t){if(!this.disabled){if(!this.options.hold||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN)if(t.keyCode==Common.UI.Keys.RETURN)if(this.options.defaultUnit&&this.options.defaultUnit.length){var e=this.getRawValue();if(this.value!=e)return this.onEnterValue(),this.trigger("inputleave",this),this.value==e}else this.onEnterValue();else this._fromKeyDown=!0;else t.preventDefault(),t.stopPropagation(),void 0===this.switches.timeout&&(this.switches.fromKeyDown=!0,this._startSpin(t.keyCode==Common.UI.Keys.UP,t));t.keyCode==Common.UI.Keys.ESC&&this.setRawValue(this.value),t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.ESC||this.trigger("inputleave",this)}},onKeyUp:function(t){this.disabled||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN||(t.stopPropagation(),t.preventDefault(),this.options.hold?this._stopSpin():this._step(t.keyCode==Common.UI.Keys.UP))},onKeyPress:function(t){if(!this.disabled){var e=String.fromCharCode(t.charCode);"."==e||","==e?(t.preventDefault(),t.stopPropagation()):!this.options.maskExp||this.options.maskExp.test(e)||t.ctrlKey||t.keyCode===Common.UI.Keys.RETURN||(t.preventDefault(),t.stopPropagation())}},onInput:function(t,e){this.disabled||t.isDefaultPrevented()||this.trigger("changing",this,$(t.target).val(),t)},onEnterValue:function(){if(this.$input){var t=this.getRawValue();this.setValue(""===t?this.value:t),this.trigger("entervalue",this)}},onBlur:function(t){if(this.$input){var e=this.getRawValue();this.setValue(""===e?this.value:e),this.options.hold&&this.switches.fromKeyDown&&this._stopSpin()}},_startSpin:function(t,e){if(!this.disabled){var i=this.switches.count;1===i?(this._step(t,!0),i=1):i=i<3?1.5:i<8?2.5:6,this.switches.timeout=setTimeout($.proxy((function(){this._step(t,!0),this._startSpin(t)}),this),this.switches.speed/i),this.switches.count++}},_stopSpin:function(t){void 0!==this.switches.timeout&&(clearTimeout(this.switches.timeout),this.switches.timeout=void 0,this.switches.count=1,this.trigger("change",this,this.value,this.lastValue))},_increase:function(t){var e=this;if(!e.readOnly){var i=e.options.step;e._fromKeyDown?(i=this.getRawValue(),i=_.isEmpty(i)?e.oldValue:Common.Utils.String.parseFloat(i)):""!==e.getValue()?(i=e.checkAutoText(e.getValue())?e.options.defaultValue-e.options.step:Common.Utils.String.parseFloat(e.getValue()),isNaN(i)&&(i=this.oldValue)):i=e.options.defaultValue-e.options.step,e.setValue((this._add(i,e.options.step,e.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),t)}},_decrease:function(t){var e=this;if(!e.readOnly){var i=e.options.step;if(e._fromKeyDown)i=this.getRawValue(),i=_.isEmpty(i)?e.oldValue:Common.Utils.String.parseFloat(i);else if(""!==e.getValue()){if(i=e.checkAutoText(e.getValue())?e.options.minValue:Common.Utils.String.parseFloat(e.getValue()),isNaN(i)&&(i=this.oldValue),e.options.allowAuto&&this._add(i,-e.options.step,e.options.allowDecimal?3:0)<e.options.minValue)return void e.setValue(e.options.autoText,!0)}else i=e.options.defaultValue;e.setValue((this._add(i,-e.options.step,e.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),t)}},_step:function(t,e){t?this._increase(e):this._decrease(e),this.options.hold&&this.switches.fromKeyDown&&this.$input&&this.$input.select()},_add:function(t,e,i){var n=Math.pow(10,i||this.options.allowDecimal?2:0);return(Math.round(t*n)+Math.round(e*n))/n},_recalcUnits:function(t,e){if(e.match(/(s|ms|сек|мс)$/i)&&this.options.defaultUnit.match(/(s|ms|сек|мс)$/i)){var i=t;return"ms"!=e&&"мс"!=e||(i=parseFloat((i/1e3).toFixed(6))),"ms"!=this.options.defaultUnit&&"мс"!=this.options.defaultUnit||(i=parseFloat((1e3*i).toFixed(6))),i}if(null===e.match(/(pt|"|cm|mm|pc|см|мм|пт)$/i)||null===this.options.defaultUnit.match(/(pt|"|cm|mm|pc|см|мм|пт)$/i))return t;i=t;return"cm"==e||"см"==e?i*=10:"pt"==e||"пт"==e?i=25.4*i/72:'"'==e?i*=25.4:"pc"==e&&(i=25.4*i/6),"cm"==this.options.defaultUnit||"см"==this.options.defaultUnit?i=parseFloat((i/10).toFixed(6)):"pt"==this.options.defaultUnit||"пт"==this.options.defaultUnit?i=parseFloat((72*i/25.4).toFixed(3)):'"'==this.options.defaultUnit?i=parseFloat((i/25.4).toFixed(3)):"pc"==this.options.defaultUnit&&(i=parseFloat((6*i/25.4).toFixed(6))),i},focus:function(){this.$input&&this.$input.focus()},setDefaultValue:function(t){this.options.defaultValue=t},checkAutoText:function(t){if(this.options.allowAuto&&"string"==typeof t){var e=t.toLowerCase();return e==this.options.autoText.toLowerCase()||"auto"==e}return!1}}),Common.UI.CustomSpinner=Common.UI.MetricSpinner.extend(_.extend({initialize:function(t){this.options.toCustomFormat=t.toCustomFormat?t.toCustomFormat:function(t){return t},this.options.fromCustomFormat=t.fromCustomFormat?t.fromCustomFormat:function(t){return t},Common.UI.MetricSpinner.prototype.initialize.call(this,t)},setRawValue:function(t){this.$input&&this.$input.val(this.options.toCustomFormat(t))},getRawValue:function(){return this.options.fromCustomFormat(this.$input.val())}},Common.UI.CustomSpinner||{}))})),define("text!common/main/lib/template/ExtendedColorDialog.template",[],(function(){return'<div class="color-box">\r\n    <div id="id-hsb-colorpicker" style="vertical-align:top;">\r\n    </div>\r\n    <div class="color-info" style="">\r\n        <div style="margin-left:15px;">\r\n            <label class="color-label"><%= txtNew %></label>\r\n            <div id="field-new-color" class="color-cnt top"></div>\r\n            <div id="field-start-color" class="color-cnt bottom"></div>\r\n            <label class="color-label"><%= txtCurrent %></label>\r\n        </div>\r\n        <div style="padding:13px 0 2px 0;">\r\n            <label class="input-label">R:</label>\r\n            <div id="extended-spin-r" class="color-spin"></div>\r\n        </div>\r\n        <div style="padding:2px 0;">\r\n            <label class="input-label">G:</label>\r\n            <div id="extended-spin-g" class="color-spin"></div>\r\n        </div>\r\n        <div style="padding:2px 0;">\r\n            <label class="input-label">B:</label>\r\n            <div id="extended-spin-b" class="color-spin"></div>\r\n        </div>\r\n        <div style="padding:11px 0 0 0;">\r\n            <label class="input-label" style="width:12px;">#:</label>\r\n            <input id="extended-text-color" type="text" role="textbox" style="width:62px; height: 22px;">\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="footer center">\r\n    <button class="btn normal dlg-btn primary" result="1"><%= txtAdd %></button>\r\n    <button class="btn normal dlg-btn" result="0"><%= txtCancel %></button>\r\n</div>\r\n'})),void 0===Common)var Common={};if(define("common/main/lib/component/HSBColorPicker",["common/main/lib/component/BaseView","common/main/lib/util/utils"],(function(){"use strict";Common.UI.HSBColorPicker=Common.UI.BaseView.extend({template:_.template('<div class="hsb-colorpicker"><% if (this.showCurrentColor) { %><div class="top-panel"><span class="color-value"><span class="transparent-color img-colorpicker"></span></span><div class="color-text"></div></div><% } %><div><div class="cnt-hb img-colorpicker"><div class="cnt-hb-arrow"></div></div><% if (this.changeSaturation) { %><div class="cnt-root"><div class="cnt-sat img-colorpicker"><div class="cnt-sat-arrow img-colorpicker"></div></div></div><% } %></div><% if (this.allowEmptyColor) { %><div class="empty-color"><%= this.textNoColor %></div><% } %></div>'),color:"#ff0000",options:{allowEmptyColor:!1,changeSaturation:!0,showCurrentColor:!0},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e,i,n,o,s,a,l,r,c=this,d=(c.$el||$(this.el),0),h=100,p=100;c.allowEmptyColor=c.options.allowEmptyColor,c.changeSaturation=c.options.changeSaturation,c.showCurrentColor=c.options.showCurrentColor;var m=function(t,e){var i=new Common.Utils.RGBColor("hsb("+t.h+","+t.s+","+t.b+")").toHex();c.color=e?"transparent":i,u(),c.trigger("changecolor",c,c.color)},u=function(){s.length>0&&a.length>0&&("transparent"==c.color?a.show():(s.css("background-color",c.color),a.hide())),n.length>0&&n.css("background-color",new Common.Utils.RGBColor("hsb("+d+", 100, 100)").toHex()),l.length>0&&(l[0].innerHTML="transparent"==c.color?c.textNoColor:c.color.toUpperCase()),e.length>0&&i.length>0&&(e.css({left:h+"%",top:100-p+"%","background-color":c.color}),i.css("top",parseInt(100*d/360)+"%"))},g=function(t,i,o){if(e.length>0&&n.length>0){var s=[Math.max(0,Math.min(100,parseInt((t.pageX*Common.Utils.zoom()-n.offset().left)/n.width()*100))),Math.max(0,Math.min(100,parseInt((t.pageY*Common.Utils.zoom()-n.offset().top)/n.height()*100)))];e.css("left",s[0]+"%"),e.css("top",s[1]+"%"),m({h:d,s:h=s[0],b:p=100-s[1]})}},f=function(t,e,n){if(i&&o){var s=Math.max(0,Math.min(100,parseInt((t.pageY*Common.Utils.zoom()-o.offset().top)/o.height()*100)));i.css("top",s+"%"),d=parseInt(360*s/100),m({h:d,s:h,b:p})}},b=function(t,e,i){$(document).on("mouseup",C),$(document).on("mousemove",g)},C=function(t,e,i){$(document).off("mouseup",C),$(document).off("mousemove",g),g(t)},v=function(t,e,i){$(document).on("mouseup",_),$(document).on("mousemove",f),f(t)},_=function(t,e,i){$(document).off("mouseup",_),$(document).off("mousemove",f)},x=function(t){var e=new Common.util.RGBColor(c.color).toHSB();m(e,!0)};c.setColor=function(t){var e;c.color!=t&&(e="transparent"==t?{h:0,s:100,b:100}:new Common.Utils.RGBColor(t).toHSB(),d=e.h,h=e.s,p=e.b,d==h&&d==p&&0==d&&(h=100),c.color=t,u())},c.getColor=function(){return c.color},c.on("render:after",(function(t){var m,g=$(c.el);g&&(e=g.find(".cnt-hb-arrow"),i=g.find(".cnt-sat-arrow"),n=g.find(".cnt-hb"),o=g.find(".cnt-sat"),s=g.find(".color-value"),l=g.find(".color-text"),r=g.find(".empty-color"),s.length>0&&(a=s.find(".transparent-color")),n.length>0&&(n.off("mousedown"),n.on("mousedown",b)),o.length>0&&(o.off("mousedown"),o.on("mousedown",v)),r.length>0&&(r.off("click"),r.on("click",x)),m="transparent"==c.color?{h:0,s:100,b:100}:new Common.Utils.RGBColor(c.color).toHSB(),d=m.h,h=m.s,p=m.b,d==h&&d==p&&0==d&&(h=100),u())})),c.render()},render:function(){return(this.$el||$(this.el)).html(this.template()),this.trigger("render:after",this),this},textNoColor:"No Color"})})),void 0===Common)var Common={};if(define("common/main/lib/component/MaskedField",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.MaskedField=Common.UI.BaseView.extend({options:{maskExp:"",maxLength:999},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);i.addClass("masked-field user-select"),i.attr("maxlength",e.options.maxLength),i.on("keypress",(function(t){var n=String.fromCharCode(t.which);e.options.maskExp.test(n)||t.ctrlKey||(t.keyCode==Common.UI.Keys.RETURN&&e.trigger("changed",e,i.val()),t.preventDefault(),t.stopPropagation())})),i.on("input",(function(t){e.trigger("change",e,i.val())})),i.on("blur",(function(t){e.trigger("changed",e,i.val())}))},render:function(){return this},setValue:function(t){this.options.maskExp.test(t)&&t.length<=this.options.maxLength&&this.$el.val(t)},getValue:function(){this.$el.val()}})})),void 0===Common)var Common={};if(define("common/main/lib/view/ExtendedColorDialog",["text!common/main/lib/template/ExtendedColorDialog.template","common/main/lib/component/HSBColorPicker","common/main/lib/component/MetricSpinner","common/main/lib/component/MaskedField","common/main/lib/component/Window"],(function(t){"use strict";Common.UI.ExtendedColorDialog=Common.UI.Window.extend(_.extend({tpl:_.template(t),options:{},rendered:!1,initialize:function(t){Common.UI.Window.prototype.initialize.call(this,{cls:"extended-color-dlg",tpl:this.tpl({txtNew:this.textNew,txtCurrent:this.textCurrent,txtAdd:this.addButtonText,txtCancel:this.cancelButtonText}),header:!1,width:340,height:272}),this.hexRe=/\s*#?([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)\s*/},render:function(){var t=this;return Common.UI.Window.prototype.render.call(this),this.colorsPicker=new Common.UI.HSBColorPicker({el:$("#id-hsb-colorpicker"),showCurrentColor:!1}),this.colorsPicker.on("changecolor",_.bind(this.onChangeColor,this)),this.colorNew=$("#field-new-color"),this.colorSaved=$("#field-start-color"),this.spinR=new Common.UI.MetricSpinner({el:$("#extended-spin-r"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.spinG=new Common.UI.MetricSpinner({el:$("#extended-spin-g"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.spinB=new Common.UI.MetricSpinner({el:$("#extended-spin-b"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.textColor=new Common.UI.MaskedField({el:$("#extended-text-color"),width:55,maskExp:/[a-fA-F0-9]/,maxLength:6}),this.spinR.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,1)),this.spinG.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,2)),this.spinB.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,3)),this.textColor.on("change",_.bind(this.onChangeMaskedField,this)),this.textColor.on("changed",_.bind(this.onChangedMaskedField,this)),this.textColor.$el.on("focus",(function(){setTimeout((function(){t.textColor.$el&&t.textColor.$el.select()}),1)})),this.spinR.$el.find("input").attr("maxlength",3),this.spinG.$el.find("input").attr("maxlength",3),this.spinB.$el.find("input").attr("maxlength",3),this.on("close",(function(){t.trigger("onmodalresult",0)})),$(this)[0].getChild(".footer .dlg-btn").on("click",(function(e){t.trigger("onmodalresult",parseInt(e.currentTarget.attributes.result.value)),t.close(!0)})),this.rendered=!0,void 0!==this.color&&this.setColor(this.color),this},getFocusedComponents:function(){return[this.spinR,this.spinG,this.spinB,{cmp:this.textColor,selector:"input"}]},getDefaultFocusableComponent:function(){return this.getChild("#extended-text-color")},onChangeColor:function(t,e){this.colorNew.css({"background-color":e}),this.stopevents=!0;var i=e.match(this.hexRe);this.spinR.setValue(parseInt(i[1],16)),this.spinG.setValue(parseInt(i[2],16)),this.spinB.setValue(parseInt(i[3],16)),this.textColor.setValue((i[1]+i[2]+i[3]).toUpperCase()),this.stopevents=!1},showColor:function(t,e){if(!this.stopevents){var i=this.spinR.getNumberValue(),n=null==i||i<0?0:i>255?255:i;e&&this.spinR.setValue(n,!0),n=n.toString(16);var o=null==(i=this.spinG.getNumberValue())||i<0?0:i>255?255:i;e&&this.spinG.setValue(o,!0),o=o.toString(16);var s=null==(i=this.spinB.getNumberValue())||i<0?0:i>255?255:i;e&&this.spinB.setValue(s,!0),s=s.toString(16);var a=(1==n.length?"0"+n:n)+(1==o.length?"0"+o:o)+(1==s.length?"0"+s:s);this.colorsPicker.setColor("#"+a),"hex"!=t&&this.textColor.setValue(a.toUpperCase()),this.colorNew.css("background-color","#"+a)}},onChangingRGB:function(t,e,i,n){if(!this.stopevents){var o,s,a,l;switch(i=_.isEmpty(i)||isNaN(parseInt(i))?parseInt(e.getValue()):parseInt(i),t){case 1:o=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16),s=(null==(l=this.spinG.getNumberValue())||l<0?0:l>255?255:l).toString(16),a=(null==(l=this.spinB.getNumberValue())||l<0?0:l>255?255:l).toString(16);break;case 2:o=(null==(l=this.spinR.getNumberValue())||l<0?0:l>255?255:l).toString(16),s=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16),a=(null==(l=this.spinB.getNumberValue())||l<0?0:l>255?255:l).toString(16);break;case 3:o=(null==(l=this.spinR.getNumberValue())||l<0?0:l>255?255:l).toString(16),s=(null==(l=this.spinG.getNumberValue())||l<0?0:l>255?255:l).toString(16),a=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16)}var r=(1==o.length?"0"+o:o)+(1==s.length?"0"+s:s)+(1==a.length?"0"+a:a);this.colorsPicker.setColor("#"+r),this.textColor.setValue(r.toUpperCase()),this.colorNew.css("background-color","#"+r)}},onChangeMaskedField:function(t,e){var i=(e="000000"+(e=/^[a-fA-F0-9]{0,6}$/.test(e)?e:"000000")).match(/([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/i);this.stopevents=!0,this.spinR.setValue(parseInt(i[1],16)),this.spinG.setValue(parseInt(i[2],16)),this.spinB.setValue(parseInt(i[3],16)),this.stopevents=!1,this.rendered&&this.showColor("hex")},onChangedMaskedField:function(t,e){/^[a-fA-F0-9]{0,6}$/.test(e)&&!_.isEmpty(e)||t.setValue("000000"),this.rendered&&this.showColor("",!0)},getColor:function(){var t=/#?([a-fA-F0-9]{6})/.exec(this.colorsPicker.getColor());return t?t[1]:null},setColor:function(t){var e=this;if(!0===this.rendered){var i=/#?([a-fA-F0-9]{6})/.test(t)?t:"ff0000";e.colorsPicker.setColor("#"+i),"transparent"==t?e.colorSaved.addClass("color-transparent"):(e.colorSaved.removeClass("color-transparent"),e.colorSaved.css("background-color","#"+t)),e.colorNew.css("background-color","#"+i),e.stopevents=!0;var n=e.hexRe.exec(i);e.spinR.setValue(parseInt(n[1],16)),e.spinG.setValue(parseInt(n[2],16)),e.spinB.setValue(parseInt(n[3],16)),e.textColor.setValue((n[1]+n[2]+n[3]).toUpperCase()),e.stopevents=!1}else this.color=t},onPrimary:function(){return this.trigger("onmodalresult",1),this.close(!0),!1},addButtonText:"Add",textNew:"New",textCurrent:"Current",textRGBErr:"The entered value is incorrect.<br>Please enter a numeric value between 0 and 255.",textHexErr:"The entered value is incorrect.<br>Please enter a value between 000000 and FFFFFF."},Common.UI.ExtendedColorDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ThemeColorPalette",["common/main/lib/component/BaseView","common/main/lib/view/ExtendedColorDialog"],(function(){"use strict";Common.UI.ThemeColorPalette=Common.UI.BaseView.extend(_.extend({options:{dynamiccolors:10,standardcolors:10,themecolors:10,columns:10,effects:5,hideEmptyColors:!0,allowReselect:!0,transparent:!1,value:"000000",enableKeyEvents:!0,keyMoveDirection:"both"},template:_.template('<div style="padding: 4px 0 0 12px;"><% var me = this; var idx = 0; %><% $(colors).each(function(num, item) { %><% if (me.isBlankSeparator(item)) { %> <div class="palette-color-spacer" style="width:100%;height:8px;float:left;"></div><% } else if (me.isSeparator(item)) { %> </div><div class="divider" style="width:100%;float:left;"></div><div style="padding: 12px;"><% } else if (me.isColor(item)) { %> <a class="palette-color color-<%=item%>" style="background:#<%=item%>" idx="<%=idx++%>"><em><span style="background:#<%=item%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isTransparent(item)) { %><a class="color-<%=item%>" idx="<%=idx++%>"><em><span unselectable="on">&#160;</span></em></a><% } else if (me.isEffect(item)) { %><% if (idx>0 && me.columns>0 && idx%me.columns===0) { %> <div style="width:100%;height:0;float:left;"></div><% } %><a effectid="<%=item.effectId%>" effectvalue="<%=item.effectValue%>" class="palette-color-effect color-<%=item.color%>" style="background:#<%=item.color%>" idx="<%=idx++%>"><em><span style="background:#<%=item.color%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isCaption(item)) { %><div class="palette-color-caption" style="width:100%;float:left;font-size: 11px;"><%=item%></div><% } %><% }); %></div><% if (me.options.dynamiccolors!==undefined) { %><div class="palette-color-dynamiccolors" style="padding: 4px 0 0 12px"><div class="palette-color-spacer" style="width:100%;height:8px;float:left;"></div><div class="palette-color-caption" style="width:100%;float:left;font-size: 11px;"><%=me.textRecentColors%></div><% for (var i=0; i<me.options.dynamiccolors; i++) { %><a class="color-dynamic-<%=i%> dynamic-empty-color <%= me.emptyColorsClass %>" color="" idx="<%=idx++%>"><em><span unselectable="on">&#160;</span></em></a><% } %><% } %></div>'),colorRe:/(?:^|\s)color-(.{6})(?:\s|$)/,selectedCls:"selected",initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);this.colors=e.options.colors||this.generateColorData(e.options.themecolors,e.options.effects,e.options.standardcolors,e.options.transparent),this.columns=e.options.columns||0,this.enableKeyEvents=e.options.enableKeyEvents,this.tabindex=e.options.tabindex||0,this.outerMenu=e.options.outerMenu,this.lastSelectedIdx=-1,this.emptyColorsClass=e.options.hideEmptyColors?"hidden":"",e.colorItems=[],"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],i.addClass("theme-colorpalette"),this.render(),this.options.updateColorsArr&&this.updateColors(this.options.updateColorsArr[0],this.options.updateColorsArr[1]),this.options.value&&this.select(this.options.value,!0),this.options.outerMenu&&this.options.outerMenu.focusOnShow&&this.options.outerMenu.menu&&(i.addClass("focused"),this.options.outerMenu.menu.on("show:after",(function(t){_.delay((function(){e.showLastSelected(),e.focus()}),10)}))),this.updateCustomColors(),i.closest(".btn-group").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),i.closest(".dropdown-submenu").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),i.on("click",_.bind(this.handleClick,this))},render:function(){this.$el.html(this.template({colors:this.colors}));var t=this;return this.moveKeys&&this.$el.find("a").each((function(e,i){t.colorItems.push({el:i,index:e})})),this.attachKeyEvents(),this},isBlankSeparator:function(t){return"string"==typeof t&&"-"==t},isSeparator:function(t){return"string"==typeof t&&"--"==t},isColor:function(t){return"string"==typeof t&&/[0-9A-F]{6}/.test(t)},isTransparent:function(t){return"string"==typeof t&&"transparent"==t},isCaption:function(t){return"string"==typeof t&&"-"!=t&&"--"!=t&&!/[0-9A-F]{6}|transparent/.test(t)},isEffect:function(t){return"object"==typeof t&&void 0!==t.effectId},getColor:function(){return this.value},updateCustomColors:function(){var t=this.$el||$(this.el);if(t){var e=this.lastSelectedIdx>=0?$(this.colorItems[this.lastSelectedIdx].el):t.find("a."+this.selectedCls),i=e.length>0&&/color-dynamic/.test(e[0].className)?e.attr("color"):void 0;i&&(i=i.toUpperCase(),e.removeClass(this.selectedCls),this.lastSelectedIdx=-1);var n,o=Common.localStorage.getItem("asc."+Common.localStorage.getId()+".colors.custom"),s=-1,a=(o=o?o.split(","):[]).length<this.options.dynamiccolors?o.length:this.options.dynamiccolors;for(this.options.hideEmptyColors&&this._layoutParams&&t.find(".dynamic-empty-color").length!==this.options.dynamiccolors-a&&(this._layoutParams=void 0);++s<a;)(n=t.find(".color-dynamic-"+s)).removeClass("dynamic-empty-color").removeClass(this.emptyColorsClass).attr("color",o[s]),n.find("span").css({"background-color":"#"+o[s]}),o[s]==i&&(n.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(n.attr("idx")),i=void 0);for(;s<this.options.dynamiccolors;)(n=t.find(".color-dynamic-"+s)).removeAttr("color"),n.addClass("dynamic-empty-color").addClass(this.emptyColorsClass),n.find("span").css({"background-color":"transparent"}),s++;t.find(".palette-color-dynamiccolors").toggleClass(this.emptyColorsClass,0===a)}},handleClick:function(t){var e,i=this,n=$(t.target).closest("a");if(0==n.length)return!1;if(n.hasClass("color-transparent"))i.clearSelection(!0),n.addClass(i.selectedCls),t.suppressEvent||(i.lastSelectedIdx=parseInt(n.attr("idx")),i.value="transparent",i.trigger("select",i,"transparent"));else if(n[0].className.search("color-dynamic")<0)if((!/^[a-fA-F0-9]{6}$/.test(i.value)||_.indexOf(i.colors,i.value)<0)&&(i.value=!1),i.clearSelection(!0),n.addClass(i.selectedCls),e=n[0].className.match(i.colorRe)[1],n.hasClass("palette-color-effect")){var o=parseInt(n.attr("effectid"));e&&!t.suppressEvent&&(i.value=e.toUpperCase(),i.trigger("select",i,{color:e,effectId:o}),i.lastSelectedIdx=parseInt(n.attr("idx")))}else/#?[a-fA-F0-9]{6}/.test(e)&&(e=/#?([a-fA-F0-9]{6})/.exec(e)[1].toUpperCase())&&!t.suppressEvent&&(i.value=e,i.trigger("select",i,e),i.lastSelectedIdx=parseInt(n.attr("idx")));else/dynamic-empty-color/.test(n[0].className)?t.suppressEvent?(i.clearSelection(!0),n.addClass(i.selectedCls)):setTimeout((function(){i.addNewColor()}),10):(i.clearSelection(!0),n.addClass(i.selectedCls),t.suppressEvent||(i.lastSelectedIdx=parseInt(n.attr("idx")),e=n.attr("color"),i.trigger("select",i,e),i.value=e.toUpperCase()))},setCustomColor:function(t){var e=this.$el||$(this.el);if(t=/#?([a-fA-F0-9]{6})/.exec(t)){this.saveCustomColor(t[1]),this.clearSelection(!0);var i=e.find(".dynamic-empty-color");0==i.length?(this.updateCustomColors(),i=e.find(".color-dynamic-"+(this.options.dynamiccolors-1))):this.options.hideEmptyColors&&this._layoutParams&&(this._layoutParams=void 0),i.first().removeClass("dynamic-empty-color").removeClass(this.emptyColorsClass).addClass(this.selectedCls).attr("color",t[1]),i.first().find("span").css({"background-color":"#"+t[1]}),e.find(".palette-color-dynamiccolors").removeClass(this.emptyColorsClass),this.select(t[1],!0)}},saveCustomColor:function(t){var e="asc."+Common.localStorage.getId()+".colors.custom",i=Common.localStorage.getItem(e);(i=i?i.split(","):[]).push(t)>this.options.dynamiccolors&&i.shift(),Common.localStorage.setItem(e,i.join().toUpperCase())},addNewColor:function(t){var e=this,i=new Common.UI.ExtendedColorDialog({});i.on("onmodalresult",(function(t){e._isdlgopen=!1,1==t&&(e.setCustomColor(i.getColor()),e.fireEvent("select",e,i.getColor()))})),e._isdlgopen=!0,i.setColor(void 0!==e.value&&!1!==e.value?e.value:void 0!==t?t:"000000"),i.show()},isDialogOpen:function(){return 1==this._isdlgopen},select:function(t,e){var i,n=this.$el||$(this.el);if(this.clearSelection(),"object"==typeof t)void 0!==t.effectId?(i=n.find('a[effectid="'+t.effectId+'"]').first()).length>0?(i.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(i.attr("idx")),this.value=i[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1:void 0!==t.effectValue&&((i=n.find('a[effectvalue="'+t.effectValue+'"].color-'+t.color.toUpperCase()).first()).length>0?(i.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(i.attr("idx")),this.value=i[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1);else if(/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),this.value=t),/^[a-fA-F0-9]{6}|transparent$/.test(t)&&_.indexOf(this.colors,t)>=0){if(_.indexOf(this.colors,this.value)<0&&(this.value=!1),t!=this.value||this.options.allowReselect){var o="transparent"==t?n.find("a.color-transparent").addClass(this.selectedCls):n.find("a.palette-color.color-"+t).first().addClass(this.selectedCls);this.value=t,this.lastSelectedIdx=parseInt(o.attr("idx")),!0!==e&&this.fireEvent("select",this,t)}}else 0==(o=n.find("#"+t).first()).length&&(o=n.find('a[color="'+t+'"]').first()),o.length>0&&(o.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(o.attr("idx")),this.value=t.toUpperCase())},selectByRGB:function(t,e){var i=this.$el||$(this.el);this.clearSelection(!0);var n="object"==typeof t?t.color:t;if(/#?[a-fA-F0-9]{6}/.test(n)&&(n=/#?([a-fA-F0-9]{6})/.exec(n)[1].toUpperCase()),/^[a-fA-F0-9]{6}|transparent$/.test(n)&&(n!=this.value||this.options.allowReselect)){var o="transparent"==n?i.find("a.color-transparent"):i.find("a.color-"+n).first();0==o.length&&(o=i.find("#"+n).first()),0==o.length&&(o=i.find('a[color="'+n+'"]').first()),o.length>0&&(o.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(o.attr("idx")),this.value=n),!0!==e&&this.fireEvent("select",this,n)}},updateColors:function(t,e,i){if(void 0!==t&&void 0!==e){var n,o=this,s=o.$el||$(this.el);void 0===o.aColorElements&&(o.aColorElements=s.find("a.palette-color")),void 0===o.aEffectElements&&(o.aEffectElements=s.find("a.palette-color-effect"));for(var a=0,l=0,r=0;r<o.colors.length;r++)if("string"==typeof o.colors[r]&&/[0-9A-F]{6}/.test(o.colors[r])){if(a>=e.length)continue;(n=$(o.aColorElements[a])).removeClass("color-"+o.colors[r]),o.colors[r]=e[a].toUpperCase(),n.addClass("color-"+o.colors[r]),n.css({background:"#"+o.colors[r]}),n.find("span").first().css({background:"#"+o.colors[r]}),a++}else if("object"==typeof o.colors[r]&&void 0!==o.colors[r].effectId){if(l>=t.length)continue;n=$(o.aEffectElements[l]),t[l].color=t[l].color.toUpperCase(),o.colors[r].color!==t[l].color&&(n.removeClass("color-"+o.colors[r].color),n.addClass("color-"+t[l].color),n.css({background:"#"+t[l].color}),n.find("span").first().css({background:"#"+t[l].color})),o.colors[r].effectId!==t[l].effectId&&n.attr("effectid",""+t[l].effectId),o.colors[r].effectValue!==t[l].effectValue&&n.attr("effectvalue",""+t[l].effectValue),o.colors[r]=t[l],l++}if(i)this.select(i,!0);else{var c=s.find("a."+this.selectedCls);c.length&&c.hasClass("palette-color-effect")&&(this.value=c[0].className.match(this.colorRe)[1].toUpperCase())}this.options.updateColorsArr=void 0}},clearSelection:function(t){this.$el.find("a."+this.selectedCls).removeClass(this.selectedCls),t||(this.value=void 0,this.lastSelectedIdx=-1)},showLastSelected:function(){this.selectByIndex(this.lastSelectedIdx,!0)},getSelectedColor:function(){var t=(this.$el||$(this.el)).find("a."+this.selectedCls).attr("idx");return void 0!==t?this.colorItems[parseInt(t)]:null},selectByIndex:function(t,e){this.clearSelection(!0),t>=0&&t<this.colorItems.length&&this.handleClick({target:this.colorItems[t].el,suppressEvent:e})},generateColorData:function(t,e,i,n){var o=[],s=t>0&&e>0?t*e:0;if(t>0){o=[this.textThemeColors];for(var a=0;a<t;a++)o.push({color:"FFFFFF",effectId:1});e>0&&o.push("-");for(a=0;a<s;a++)o.push({color:"FFFFFF",effectId:1});i&&o.push("-")}if(i){o.push(this.textStandartColors),n&&(o.push("transparent"),i--);for(a=0;a<i;a++)o.push("FFFFFF")}return o},onKeyDown:function(t,e){if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedColor();if(e.keyCode==Common.UI.Keys.RETURN)i&&this.selectByIndex(i.index),this.outerMenu&&this.outerMenu.menu&&this.outerMenu.menu.hide();else{var n=i?i.index:-1;if(n<0)n=0;else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var o=this.colorItems[n].topIdx,s=this.colorItems[n].leftIdx;if(n=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===n;)--s<0&&(s=this._layoutParams.columns-1),n=this._layoutParams.itemsIndexes[o][s];else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===n;)++s>this._layoutParams.columns-1&&(s=0),n=this._layoutParams.itemsIndexes[o][s];else if(e.keyCode==Common.UI.Keys.UP)if(0==o&&this.outerMenu&&this.outerMenu.menu)this.clearSelection(!0),this.outerMenu.menu.focusOuter(e,this.outerMenu.index);else for(;void 0===n;)--o<0&&(o=this._layoutParams.rows-1),n=this._layoutParams.itemsIndexes[o][s];else if(o==this._layoutParams.rows-1&&this.outerMenu&&this.outerMenu.menu)this.clearSelection(!0),this.outerMenu.menu.focusOuter(e,this.outerMenu.index);else for(;void 0===n;)++o>this._layoutParams.rows-1&&(o=0),n=this._layoutParams.itemsIndexes[o][s]}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.colorItems.length-1,n+1);void 0!==n&&n>=0&&(this._fromKeyDown=!0,this.selectByIndex(n,!0),this._fromKeyDown=!1)}}},fillIndexesArray:function(){if(!(this.colorItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=$(this.colorItems[0].el),e=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),i=this.$el.offset().left,n=t.offset().top,o=-1,s=0,a=0,l=0;l<this.colorItems.length;l++){var r=$(this.colorItems[l].el).offset().top-n;a=Math.floor(($(this.colorItems[l].el).offset().left-i)/e),r>o&&(o=r,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=l,this.colorItems[l].topIdx=s,this.colorItems[l].leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},attachKeyEvents:function(){if(this.enableKeyEvents){var t=this.$el||$(this.el);t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on("keydown",_.bind(this.onKeyDown,this))}},focus:function(t){var e=this.$el||$(this.el);e&&e.focus(),"string"==typeof t?"first"==t?this.selectByIndex(0,!0):"last"==t&&(void 0===this._layoutParams&&this.fillIndexesArray(),this.selectByIndex(this._layoutParams.itemsIndexes[this._layoutParams.rows-1][0],!0)):void 0!==t&&this.selectByIndex(t,!0)},focusInner:function(t){this.focus(t.keyCode==Common.UI.Keys.DOWN?"first":"last")},textThemeColors:"Theme Colors",textStandartColors:"Standard Colors",textRecentColors:"Recent Colors"},Common.UI.ThemeColorPalette||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ColorButton",["common/main/lib/component/Button","common/main/lib/component/ThemeColorPalette"],(function(){"use strict";Common.UI.ButtonColored=Common.UI.Button.extend(_.extend({render:function(t){Common.UI.Button.prototype.render.call(this,t),$("button:first-child",this.cmpEl).append($('<div class="btn-color-value-line"></div>')),this.colorEl=this.cmpEl.find(".btn-color-value-line"),this.options.auto&&(this.autocolor="object"==typeof this.options.auto&&this.options.auto.color||"000000"),void 0!==this.options.color&&this.setColor(this.options.color)},getPicker:function(t,e){if(!this.colorPicker){var i={el:this.cmpEl.find("#"+this.menu.id+"-color-menu"),value:t,colors:e};void 0!==this.options.transparent&&(i.transparent=this.options.transparent),void 0!==this.options.hideEmptyColors&&(i.hideEmptyColors=this.options.hideEmptyColors),this.colorPicker=new Common.UI.ThemeColorPalette(i),this.colorPicker.on("select",_.bind(this.onColorSelect,this)),this.cmpEl.find("#"+this.menu.id+"-color-new").on("click",_.bind(this.addNewColor,this)),this.options.auto&&(this.cmpEl.find("#"+this.menu.id+"-color-auto").on("click",_.bind(this.onAutoColorSelect,this)),this.colorAuto=this.cmpEl.find("#"+this.menu.id+"-color-auto > a"),"auto"==t&&this.setAutoColor(!0)),this.initInnerMenu()}return this.colorPicker},setPicker:function(t){this.colorPicker=t},getMenu:function(t){if("object"!=typeof this.menu){var e=(t=t||this.options).paletteHeight?t.paletteHeight+"px":"auto",i=Common.UI.getId(),n=[];t.auto&&(this.autocolor="object"==typeof t.auto&&t.auto.color||"000000",n.push({id:i+"-color-auto",caption:"object"==typeof t.auto&&t.auto.caption||this.textAutoColor,template:_.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto" style="background-image: none; width: 12px; height: 12px; margin: 1px 7px 0 1px; background-color: #'+this.autocolor+';"></span><%= caption %></a>')}),n.push({caption:"--"}));var o=new Common.UI.Menu({id:i,cls:"shifted-left",additionalAlign:t.additionalAlign,items:(t.additionalItems?t.additionalItems:[]).concat(n).concat([{template:_.template('<div id="'+i+'-color-menu" style="width: 164px; height:'+e+'; display: inline-block;"></div>')},{caption:"--"},{id:i+"-color-new",template:_.template('<a tabindex="-1" type="menuitem" style="">'+this.textNewColor+"</a>")}])});this.initInnerMenu();var s=this;return o.on("keydown:before",_.bind(this.onBeforeKeyDown,this)),o.on("show:after",(function(e){s.colorPicker&&_.delay((function(){s.colorPicker.showLastSelected(),!t.additionalItems&&!t.auto&&s.colorPicker.focus()}),10)})).on("hide:after",(function(){s.options.takeFocusOnClose&&setTimeout((function(){s.focus()}),1)})),o}return this.menu},initInnerMenu:function(){if(this.colorPicker&&"object"==typeof this.menu){var t=(this.options.additionalItems||[]).length+(this.options.auto?2:0);this.colorPicker.outerMenu={menu:this.menu,index:t},this.menu.setInnerMenu([{menu:this.colorPicker,index:t}])}},setMenu:function(t){t=t||this.getMenu(),Common.UI.Button.prototype.setMenu.call(this,t),this.getPicker(this.options.color,this.options.colors)},onColorSelect:function(t,e){this.setColor(e),this.setAutoColor(!1),this.trigger("color:select",this,e)},setColor:function(t){"auto"==t&&this.options.auto&&(t=this.autocolor),this.color=t,this.colorEl&&(this.colorEl.css({"background-color":"transparent"==t?t:"object"==typeof t?"#"+t.color:"#"+t}),this.colorEl.toggleClass("bordered","transparent"==t))},setAutoColor:function(t){this.colorAuto&&(t&&!this.colorAuto.hasClass("selected")?this.colorAuto.addClass("selected"):!t&&this.colorAuto.hasClass("selected")&&this.colorAuto.removeClass("selected"))},isAutoColor:function(){return this.colorAuto&&this.colorAuto.hasClass("selected")},onAutoColorSelect:function(){this.setColor("auto"),this.setAutoColor(!0),this.colorPicker&&this.colorPicker.clearSelection(),this.trigger("auto:select",this,this.autocolor)},addNewColor:function(){this.colorPicker&&this.colorPicker.addNewColor("object"==typeof this.color?this.color.color:this.color)},onBeforeKeyDown:function(t,e){if((e.keyCode==Common.UI.Keys.DOWN||e.keyCode==Common.UI.Keys.SPACE)&&!this.isMenuOpen())return $("button",this.cmpEl).click(),!1},isMenuOpen:function(){return this.cmpEl.hasClass("open")},textNewColor:"Add New Custom Color",textAutoColor:"Automatic"},Common.UI.ButtonColored||{})),Common.UI.ColorButton=Common.UI.ButtonColored.extend(_.extend({options:{id:null,hint:!1,enableToggle:!1,allowDepress:!1,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1,visible:!0},template:_.template(['<div class="btn-group" id="<%= id %>">','<button type="button" class="btn btn-color dropdown-toggle <%= cls %>" data-toggle="dropdown" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">',"<span>&nbsp;</span>",'<span class="inner-box-caret">','<i class="caret"></i>',"</span>","</button>","</div>"].join("")),initialize:function(t){if(!t.menu&&!1!==t.menu){var e=this;t.menu=e.getMenu(t),e.on("render:after",(function(i){e.getPicker(t.color,t.colors)}))}Common.UI.Button.prototype.initialize.call(this,t)},render:function(t){Common.UI.Button.prototype.render.call(this,t),this.options.auto&&(this.autocolor="object"==typeof this.options.auto&&this.options.auto.color||"000000"),void 0!==this.options.color&&this.setColor(this.options.color)},setColor:function(t){"auto"==t&&this.options.auto&&(t=this.autocolor);var e=$(this.cmpEl).find("button span:nth-child(1)");this.color=t,e.toggleClass("color-transparent","transparent"==t),e.css({"background-color":"transparent"==t?t:"object"==typeof t?"#"+t.color:"#"+t})},focus:function(){$("button",this.cmpEl).focus()}},Common.UI.ColorButton||{}))})),function(t,e){var i=1057,n=1124,o=1,s=2,a=3,l=4,r=5,c=6,d=7,h=8,p=9,m=10,u=11,g=12,f=13,b=14,C=15,v=16,_=17,x=18,y=19,w=20,S=21,A=22,k=23,T=24,I=25,E=26,D=27,P=28,F=29,R=30,V=31,M=32,U=33,L=34,B=35,O=36,N=37,H=38,$=39,G=40,z=41,W=42,j=43,q=44,K=45,Y=46,X=47,J=48,Z=49,Q=50,tt=51,et=52,it=53,nt=54,ot=55,st=56,at=57,lt=58,rt=59,ct=60,dt=61,ht=62,pt=63,mt=64,ut=65,gt=66,ft=67,bt=68,Ct=69,vt=70,_t=71,xt=72,yt=73,wt=74,St=75,At=76,kt=77,Tt=78,It=79,Et=80,Dt=81,Pt=82,Ft=83,Rt=84,Vt=85,Mt=86,Ut=87,Lt=88,Bt=89,Ot=90,Nt=91,Ht=92,$t=93,Gt=94,zt=95,Wt=96,jt=97,qt=98,Kt=99,Yt=100,Xt=101,Jt=102,Zt=103,Qt=104,te=105,ee=106,ie=107,ne=108,oe=109,se=110,ae=111,le=112,re=113,ce=114,de=115,he=116,pe=117,me=118,ue=119,ge=120,fe=121,be=122,Ce=123,ve=124,_e=125,xe=126,ye=127,we=128,Se=129,Ae=130,ke=131,Te=132,Ie=133,Ee=134,De=135,Pe=136,Fe=137,Re=138,Ve=139,Me=140,Ue=141,Le=142,Be=143,Oe=144,Ne=145,He=146,$e=147,Ge=148,ze=149,We=150,je=151,qe=152,Ke=153,Ye=154,Xe=155,Je=156,Ze=157,Qe=158,ti=159,ei=160,ii=161,ni=162,oi=163,si=164,ai=165,li=166,ri=167,ci=168,di=169,hi=170,pi=171,mi=172,ui=173,gi=174,fi=175,bi=176,Ci=177,vi=178,_i=179,xi=180,yi=181,wi=182,Si=183,Ai=184,ki=185,Ti=186,Ii=187,Ei=188,Di=189,Pi=190,Fi=191,Ri=192,Vi=193,Mi=194,Ui=195,Li=196,Bi=197,Oi=198,Ni=199,Hi=200,$i=201,Gi=202,zi=203,Wi=204,ji=205,qi=206,Ki=207,Yi=208,Xi=209,Ji=210,Zi=211,Qi=212,tn=213,en=214,nn=215,on=216,sn=217,an=218,ln=219,rn=220,cn=221,dn=222,hn=223,pn=224,mn=225,un=226,gn=227,fn=228,bn=229,Cn=230,vn=231,_n=232,xn=233,yn=234,wn=235,Sn=236,An=237,kn=238,Tn=239,In=240,En=241,Dn=242,Pn=243,Fn=244,Rn=245,Vn=246,Mn=247,Un=248,Ln=249,Bn=250,On=251,Nn=252,Hn=253,$n=254,Gn=255,zn=256,Wn=257,jn=258,qn=259,Kn=260,Yn=261,Xn=262,Jn=263,Zn=264,Qn=265,to=266,eo=267,io=268,no=269,oo=270,so=271,ao=272,lo=273,ro=0,co=1,ho=2,po=3,mo=4,uo=5,go=6,fo=7,bo=8,Co=16,vo=17,_o=18,xo=19,yo=20,wo=30,So=19,Ao=21,ko=29,To={Basic_Latin:0,Latin_1_Supplement:1,Latin_Extended_A:2,Latin_Extended_B:3,IPA_Extensions:4,Spacing_Modifier_Letters:5,Combining_Diacritical_Marks:6,Greek_and_Coptic:7,Coptic:8,Cyrillic:9,Armenian:10,Hebrew:11,Vai:12,Arabic:13,NKo:14,Devanagari:15,Bengali:16,Gurmukhi:17,Gujarati:18,Oriya:19,Tamil:20,Telugu:21,Kannada:22,Malayalam:23,Thai:24,Lao:25,Georgian:26,Balinese:27,Hangul_Jamo:28,Latin_Extended_Additional:29,Greek_Extended:30,General_Punctuation:31},Io={Superscripts_And_Subscripts:0,Currency_Symbols:1,Combining_Diacritical_Marks_For_Symbols:2,Letterlike_Symbols:3,Number_Forms:4,Arrows:5,Mathematical_Operators:6,Miscellaneous_Technical:7,Control_Pictures:8,Optical_Character_Recognition:9,Enclosed_Alphanumerics:10,Box_Drawing:11,Block_Elements:12,Geometric_Shapes:13,Miscellaneous_Symbols:14,Dingbats:15,CJK_Symbols_And_Punctuation:16,Hiragana:17,Katakana:18,Bopomofo:19,Hangul_Compatibility_Jamo:20,Phags_pa:21,Enclosed_CJK_Letters_And_Months:22,CJK_Compatibility:23,Hangul_Syllables:24,Non_Plane:25,Phoenician:26,CJK_Unified_Ideographs:27,Private_Use_Area_plane_0:28,CJK_Strokes:29,Alphabetic_Presentation_Forms:30,Arabic_Presentation_Forms_A:31},Eo={Combining_Half_Marks:0,Vertical_Forms:1,Small_Form_Variants:2,Arabic_Presentation_Forms_B:3,Halfwidth_And_Fullwidth_Forms:4,Specials:5,Tibetan:6,Syriac:7,Thaana:8,Sinhala:9,Myanmar:10,Ethiopic:11,Cherokee:12,Unified_Canadian_Aboriginal_Syllabics:13,Ogham:14,Runic:15,Khmer:16,Mongolian:17,Braille_Patterns:18,Yi_Syllables:19,Tagalog:20,Old_Italic:21,Gothic:22,Deseret:23,Byzantine_Musical_Symbols:24,Mathematical_Alphanumeric_Symbols:25,Private_Use_plane_15:26,Variation_Selectors:27,Tags:28,Limbu:29,Tai_Le:30,New_Tai_Lue:31},Do=1,Po=2,Fo=3,Ro=4,Vo=5,Mo=6,Uo=7,Lo=8,Bo=9,Oo=10,No=11,Ho=12,$o=14,Go=16,zo=17,Wo=18,jo=19,qo=20,Ko=21,Yo=22,Xo=23,Jo=24,Zo=25,Qo=26;function ts(t,e,i,n,o){this.Start=t,this.End=e,this.Name=i,this.Lid=n,this.Param=o}var es=[new ts(32,126,o,1033,[1<<To.Basic_Latin,0,0,0,1<<ro,0]),new ts(160,255,s,0,[1<<To.Basic_Latin|1<<To.Latin_1_Supplement,0,0,0,1<<ro,0]),new ts(256,383,a,0,[1<<To.Basic_Latin|1<<To.Latin_Extended_A,0,0,0,1<<ro|1<<co|1<<mo|1<<fo,0]),new ts(384,591,l,0,[1<<To.Basic_Latin|1<<To.Latin_Extended_B,0,0,0,1<<ro|1<<co|1<<mo|1<<fo,0]),new ts(592,687,r,0,[1<<To.IPA_Extensions,0,0,0,0,0]),new ts(688,767,c,0,[1<<To.Spacing_Modifier_Letters,0,0,0,0,0]),new ts(768,879,d,0,[1<<To.Combining_Diacritical_Marks,0,0,0,0,0]),new ts(880,1023,h,1032,[1<<To.Greek_and_Coptic,0,0,0,1<<po,0]),new ts(1024,1279,p,1049,[1<<To.Cyrillic,0,0,0,1<<ho,0]),new ts(1280,1327,m,0,[1<<To.Cyrillic,0,0,0,1<<ho,0]),new ts(1328,1423,u,1067,[1<<To.Armenian,0,0,0,0,0]),new ts(1424,1535,g,1037,[1<<To.Hebrew,0,0,0,1<<uo,1<<Ao]),new ts(1536,1791,f,1,[1<<To.Arabic,0,0,0,1<<go,1<<So|1<<ko]),new ts(1792,1871,b,1114,[1<<To.Arabic,0,0,0,1<<go,1<<So|1<<ko]),new ts(1872,1919,C,1,[1<<To.Arabic,0,0,0,1<<go,1<<So|1<<ko]),new ts(1920,1983,v,1125,[1<<To.Arabic,0,0,0,1<<go,1<<So|1<<ko]),new ts(1984,2047,_,0,[1<<To.NKo,0,0,0,0,0]),new ts(2048,2111,x,0,[1<<To.Hebrew,0,0,0,1<<uo,0]),new ts(2112,2143,y,0,[1<<To.Arabic,0,0,0,1<<go,1<<So|1<<ko]),new ts(2208,2303,w,1,[1<<To.Arabic,0,0,0,1<<go,1<<So|1<<ko]),new ts(2304,2431,S,1081,[1<<To.Devanagari,0,0,0,0,0]),new ts(2432,2559,A,1093,[1<<To.Bengali,0,0,0,0,0]),new ts(2560,2687,k,1094,[1<<To.Gurmukhi,0,0,0,0,0]),new ts(2688,2815,T,1095,[1<<To.Gujarati,0,0,0,0,0]),new ts(2816,2943,I,1096,[1<<To.Oriya,0,0,0,0,0]),new ts(2944,3071,E,1097,[1<<To.Tamil,0,0,0,0,0]),new ts(3072,3199,D,1098,[1<<To.Telugu,0,0,0,0,0]),new ts(3200,3327,P,1099,[1<<To.Kannada,0,0,0,0,0]),new ts(3328,3455,F,1100,[1<<To.Malayalam,0,0,0,0,0]),new ts(3456,3583,R,1115,[0,0,1<<Eo.Sinhala,0,0,0]),new ts(3584,3711,V,1054,[1<<To.Thai,0,0,0,1<<Co,0]),new ts(3712,3839,M,1108,[1<<To.Lao,0,0,0,0,0]),new ts(3840,4095,U,2129,[0,0,1<<Eo.Tibetan,0,0,0]),new ts(4096,4255,L,1109,[0,0,1<<Eo.Myanmar,0,0,0]),new ts(4256,4351,B,1079,[1<<To.Georgian,0,0,0,0,0]),new ts(4352,4607,O,1042,[1<<To.Hangul_Jamo,0,0,0,1<<xo,0]),new ts(4608,4991,N,1138,[0,0,1<<Eo.Ethiopic,0,0,0]),new ts(4992,5023,H,0,[0,0,1<<Eo.Ethiopic,0,0,0]),new ts(5024,5119,$,1116,[0,0,1<<Eo.Cherokee,0,0,0]),new ts(5120,5759,G,1117,[0,0,1<<Eo.Unified_Canadian_Aboriginal_Syllabics,0,0,0]),new ts(5760,5791,z,0,[0,0,1<<Eo.Ogham,0,0,0]),new ts(5792,5887,W,0,[0,0,1<<Eo.Runic,0,0,0]),new ts(5888,5919,j,n,[0,0,1<<Eo.Tagalog,0,0,0]),new ts(5920,5951,q,n,[0,0,1<<Eo.Tagalog,0,0,0]),new ts(5952,5983,K,n,[0,0,1<<Eo.Tagalog,0,0,0]),new ts(5984,6015,Y,n,[0,0,1<<Eo.Tagalog,0,0,0]),new ts(6016,6143,X,1107,[0,0,1<<Eo.Khmer,0,0,0]),new ts(6144,6319,J,1104,[0,0,1<<Eo.Mongolian,0,0,0]),new ts(6320,6399,Z,1117,[0,0,1<<Eo.Unified_Canadian_Aboriginal_Syllabics,0,0,0]),new ts(6400,6479,Q,0,[0,0,1<<Eo.Limbu,0,0,0]),new ts(6480,6527,tt,0,[0,0,1<<Eo.Tai_Le,0,0,0]),new ts(6528,6623,et,0,[0,0,1<<Eo.New_Tai_Lue,0,0,0]),new ts(6624,6655,it,1107,[0,0,1<<Eo.Khmer,0,0,0]),new ts(6656,6687,nt,0,[0,0,1<<Eo.Buginese,0,0,0]),new ts(6688,6831,ot,1054,[0,0,1<<Eo.Tai_Le,0,0,0]),new ts(6832,6911,st,0,[1<<To.Combining_Diacritical_Marks,0,0,0,0,0]),new ts(6912,7039,at,i,[1<<To.Balinese,0,0,0,0,0]),new ts(7040,7103,lt,i,[0,0,0,1<<Go,0,0]),new ts(7104,7167,rt,i,[]),new ts(7168,7247,ct,0,[0,0,0,1<<zo,0,0]),new ts(7248,7295,dt,0,[0,0,0,1<<Wo,0,0]),new ts(7296,7311,ht,0,[1<<To.Cyrillic,0,0,0,0,0]),new ts(7360,7375,pt,0,[0,0,0,1<<Go,0,0]),new ts(7376,7423,mt,0,[]),new ts(7424,7551,ut,0,[1<<To.IPA_Extensions,0,0,0,0,0]),new ts(7552,7615,gt,0,[1<<To.IPA_Extensions,0,0,0,0,0]),new ts(7616,7679,ft,0,[1<<To.Combining_Diacritical_Marks,0,0,0,0,0]),new ts(7680,7935,bt,0,[1<<To.Latin_Extended_Additional,0,0,0,1<<bo,0]),new ts(7936,8191,Ct,0,[1<<To.Greek_Extended,0,0,0,0,0]),new ts(8192,8303,vt,0,[1<<To.Punctuation,0,0,0,0,0]),new ts(8304,8351,_t,0,[0,1<<Io.Superscripts_And_Subscripts,0,0,0,0]),new ts(8352,8399,xt,0,[0,1<<Io.Currency_Symbols,0,0,0,0]),new ts(8400,8447,yt,0,[0,1<<Io.Combining_Diacritical_Marks_For_Symbols,0,0,0,0]),new ts(8448,8527,wt,0,[0,1<<Io.Letterlike_Symbols,0,0,0,0]),new ts(8528,8591,St,0,[0,1<<Io.Number_Forms,0,0,0,0]),new ts(8592,8703,At,0,[0,1<<Io.Arrows,0,0,0,0]),new ts(8704,8959,kt,0,[0,1<<Io.Mathematical_Operators,0,0,0,0]),new ts(8960,9215,Tt,0,[0,1<<Io.Miscellaneous_Technical,0,0,0,0]),new ts(9216,9279,It,0,[0,1<<Io.Control_Pictures,0,0,0,0]),new ts(9280,9311,Et,0,[0,1<<Io.Optical_Character_Recognition,0,0,0,0]),new ts(9312,9471,Dt,0,[0,1<<Io.Enclosed_Alphanumerics,0,0,0,0]),new ts(9472,9599,Pt,0,[0,1<<Io.Box_Drawing,0,0,0,0]),new ts(9600,9631,Ft,0,[0,1<<Io.Block_Elements,0,0,0,0]),new ts(9632,9727,Rt,0,[0,1<<Io.Geometric_Shapes,0,0,0,0]),new ts(9728,9983,Vt,0,[0,1<<Io.Miscellaneous_Symbols,0,0,0,0]),new ts(9984,10175,Mt,0,[0,1<<Io.Dingbats,0,0,0,0]),new ts(10176,10223,Ut,0,[0,1<<Io.Mathematical_Operators,0,0,0,0]),new ts(10224,10239,Lt,0,[0,1<<Io.Arrows,0,0,0,0]),new ts(10240,10495,Bt,0,[0,0,1<<Eo.Braille_Patterns,0,0,0]),new ts(10496,10623,Ot,0,[0,1<<Io.Arrows,0,0,0,0]),new ts(10624,10751,Nt,0,[0,1<<Io.Mathematical_Operators,0,0,0,0]),new ts(10752,11007,Ht,0,[0,1<<Io.Mathematical_Operators,0,0,0,0]),new ts(11008,11263,$t,0,[0,1<<Io.Arrows,0,0,0,0]),new ts(11264,11359,Gt,0,[0,0,0,1<<Io.Glagolitic,0,0]),new ts(11360,11391,zt,0,[1<<To.Latin_Extended_Additional,0,0,0,0,0]),new ts(11392,11519,Wt,0,[1<<To.Coptic,0,0,0,0,0]),new ts(11520,11567,jt,0,[1<<To.Georgian,0,0,0,0,0]),new ts(11568,11647,qt,0,[0,0,0,1<<Po,0,0]),new ts(11648,11743,Kt,0,[0,0,1<<Eo.Ethiopic,0,0,0]),new ts(11744,11775,Yt,0,[1<<To.Cyrillic,0,0,0,1<<ho,0]),new ts(11776,11903,Xt,0,[1<<To.General_Punctuation,0,0,0,0,0]),new ts(11904,12031,Jt,0,[0,1<<Io.CJK_Unified_Ideographs,0,0,0,0]),new ts(12032,12255,Zt,0,[0,1<<Io.CJK_Unified_Ideographs,0,0,0,0]),new ts(12272,12287,Qt,0,[0,1<<Io.CJK_Unified_Ideographs,0,0,0,0]),new ts(12288,12351,te,0,[0,1<<Io.CJK_Symbols_And_Punctuation,0,0,1<<vo|1<<wo,0]),new ts(12352,12447,ee,1041,[0,1<<Io.Hiragana,0,0,0,0]),new ts(12448,12543,ie,1041,[0,1<<Io.Katakana,0,0,0,0]),new ts(12544,12591,ne,0,[0,1<<Io.Bopomofo,0,0,0,0]),new ts(12592,12687,oe,0,[0,1<<Io.Hangul_Compatibility_Jamo,0,0,1<<xo,0]),new ts(12688,12703,se,2052,[0,1<<Io.CJK_Unified_Ideographs,0,0,0,0]),new ts(12704,12735,ae,0,[0,1<<Io.Bopomofo,0,0,0,0]),new ts(12736,12783,le,0,[0,1<<Io.CJK_Strokes,0,0,0,0]),new ts(12784,12799,re,0,[0,1<<Io.Katakana,0,0,0,0]),new ts(12800,13055,ce,0,[0,1<<Io.Enclosed_CJK_Letters_And_Months,0,0,0,0]),new ts(13056,13311,de,0,[0,1<<Io.CJK_Compatibility,0,0,0,0]),new ts(13312,19903,he,0,[0,1<<Io.CJK_Unified_Ideographs,0,0,1<<_o|1<<yo,0]),new ts(19904,19967,pe,0,[0,0,0,1<<Fo,1<<_o|1<<yo,0]),new ts(19968,40959,me,0,[0,1<<Io.CJK_Unified_Ideographs,0,0,1<<_o|1<<yo|1<<vo|1<<wo,0]),new ts(40960,42127,ue,0,[0,0,1<<Eo.Yi_Syllables,0,0,0]),new ts(42128,42191,ge,0,[0,0,1<<Eo.Yi_Radicals,0,0,0]),new ts(42192,42239,fe,0,[]),new ts(42240,42559,be,0,[1<<To.Vai,0,0,0,0,0]),new ts(42560,42655,Ce,0,[1<<To.Cyrillic,0,0,0,1<<ho,0]),new ts(42656,42751,ve,0,[]),new ts(42752,42783,_e,0,[1<<To.Spacing_Modifier_Letters,0,0,0,0,0]),new ts(42784,43007,xe,0,[1<<To.Latin_Extended_Additional,0,0,0,0,0]),new ts(43008,43055,ye,0,[0,0,0,1<<Ro,0,0]),new ts(43056,43071,we,0,[]),new ts(43072,43135,Se,0,[0,1<<Io.Phags_pa,0,0,0,0]),new ts(43136,43231,Ae,0,[0,0,0,1<<jo,0,0]),new ts(43232,43263,ke,0,[1<<To.Devanagari,0,0,0,0,0]),new ts(43264,43311,Te,0,[0,0,0,1<<qo,0,0]),new ts(43312,43359,Ie,0,[0,0,0,1<<Ko,0,0]),new ts(43360,43391,Ee,0,[1<<To.Hangul_Jamo,0,0,0,0,0]),new ts(43392,43487,De,i,[]),new ts(43488,43519,Pe,0,[0,0,1<<Eo.Myanmar,0,0,0]),new ts(43520,43615,Fe,0,[0,0,0,1<<Yo,0,0]),new ts(43616,43647,Re,0,[0,0,1<<Eo.Myanmar,0,0,0]),new ts(43648,43743,Ve,0,[]),new ts(43744,43775,Me,0,[]),new ts(43776,43823,Ue,0,[]),new ts(43824,43887,Le,0,[1<<To.Latin_Extended_Additional,0,0,0,0,0]),new ts(43888,43967,Be,0,[]),new ts(43968,44031,Oe,0,[]),new ts(44032,55215,Ne,0,[0,1<<Io.Hangul_Syllables,0,0,1<<xo,0]),new ts(55216,55295,He,0,[1<<To.Hangul_Jamo,0,0,0,0,0]),new ts(55296,56191,$e,0,[]),new ts(56192,56319,Ge,0,[]),new ts(56320,57343,ze,0,[]),new ts(57344,63743,We,0,[0,1<<Io.Private_Use_Area_plane_0,0,0,0,0]),new ts(63744,64255,je,0,[0,1<<Io.CJK_Compatibility_Ideographs,0,0,1<<_o|1<<yo,0]),new ts(64256,64335,qe,0,[0,1<<Io.Alphabetic_Presentation_Forms,0,0,0,0]),new ts(64336,65023,Ke,0,[0,1<<Io.Arabic_Presentation_Forms_A,0,0,1<<go,1<<So|1<<ko]),new ts(65024,65039,Ye,0,[0,0,1<<Eo.Variation_Selectors,0,0,0]),new ts(65040,65055,Xe,0,[0,0,1<<Eo.Vertical_Forms,0,0,0]),new ts(65056,65071,Je,0,[0,0,1<<Eo.Combining_Half_Marks,0,0,0]),new ts(65072,65103,Ze,0,[0,0,1<<Eo.Vertical_Forms,0,0,0]),new ts(65104,65135,Qe,0,[0,0,1<<Eo.Small_Form_Variants,0,0,0]),new ts(65136,65279,ti,0,[0,0,1<<Eo.Arabic_Presentation_Forms_B,0,1<<go,1<<So|1<<ko]),new ts(65280,65519,ei,0,[0,0,1<<Eo.Halfwidth_And_Fullwidth_Forms,0,1<<xo|1<<_o|1<<yo|1<<vo|1<<wo,0]),new ts(65520,65535,ii,0,[0,0,1<<Eo.Specials,0,0,0]),new ts(65536,65663,ni,0,[0,0,0,1<<Vo,0,0]),new ts(65664,65791,oi,0,[0,0,0,1<<Vo,0,0]),new ts(65792,65855,si,0,[0,0,0,1<<Vo,0,0]),new ts(65856,65935,ai,0,[0,0,0,1<<Mo,0,0]),new ts(65936,65999,li,0,[0,0,0,1<<Xo,0,0]),new ts(66e3,66047,ri,0,[0,0,0,1<<Jo,0,0]),new ts(66176,66207,ci,0,[0,0,0,1<<Zo,0,0]),new ts(66208,66271,di,0,[0,0,0,1<<Zo,0,0]),new ts(66272,66303,hi,0,[1<<To.Coptic,0,0,0,0,0]),new ts(66304,66351,pi,0,[0,0,1<<Eo.Old_Italic,0,0,0]),new ts(66352,66383,mi,0,[0,0,1<<Eo.Gothic,0,0,0]),new ts(66384,66431,ui,0,[]),new ts(66432,66463,gi,0,[0,0,0,1<<Uo,0,0]),new ts(66464,66527,fi,0,[0,0,0,1<<Lo,0,0]),new ts(66560,66639,bi,0,[0,0,1<<Eo.Deseret,0,0,0]),new ts(66640,66687,Ci,0,[0,0,0,1<<Bo,0,0]),new ts(66688,66735,vi,0,[0,0,0,1<<Oo,0,0]),new ts(66736,66815,_i,0,[]),new ts(66816,66863,xi,0,[]),new ts(66864,66927,yi,0,[]),new ts(67072,67455,wi,0,[]),new ts(67584,67647,Si,0,[0,0,0,1<<No,0,0]),new ts(67648,67679,Ai,0,[]),new ts(67680,67711,ki,0,[]),new ts(67712,67759,Ti,0,[]),new ts(67808,67839,Ii,0,[]),new ts(67840,67871,Ei,0,[0,1<<Io.Phoenician,0,0,0,0]),new ts(67872,67903,Di,0,[0,0,0,1<<Zo,0,0]),new ts(67968,67999,Pi,0,[]),new ts(68e3,68095,Fi,0,[]),new ts(68096,68191,Ri,0,[0,0,0,1<<Ho,0,0]),new ts(68192,68223,Vi,0,[]),new ts(68224,68255,Mi,0,[]),new ts(68288,68351,Ui,0,[]),new ts(68352,68415,Li,0,[]),new ts(68416,68447,Bi,0,[]),new ts(68448,68479,Oi,0,[]),new ts(68480,68527,Ni,0,[]),new ts(68608,68687,Hi,0,[]),new ts(68736,68863,$i,0,[]),new ts(69216,69247,Gi,0,[]),new ts(69632,69759,zi,0,[]),new ts(69760,69839,Wi,0,[]),new ts(69840,69887,ji,0,[]),new ts(69888,69967,qi,0,[]),new ts(69968,70015,Ki,0,[]),new ts(70016,70111,Yi,0,[]),new ts(70112,70143,Xi,0,[0,0,1<<Eo.Sinhala,0,0,0]),new ts(70144,70223,Ji,0,[]),new ts(70272,70319,Zi,0,[]),new ts(70320,70399,Qi,0,[]),new ts(70400,70527,tn,0,[]),new ts(70656,70783,en,0,[]),new ts(70784,70879,nn,0,[]),new ts(71040,71167,on,0,[]),new ts(71168,71263,sn,0,[]),new ts(71264,71295,an,0,[0,0,1<<Eo.Mongolian,0,0,0]),new ts(71296,71375,ln,0,[]),new ts(71424,71487,rn,0,[]),new ts(71840,71935,cn,0,[]),new ts(72384,72447,dn,0,[]),new ts(72704,72815,hn,0,[]),new ts(72816,72895,pn,0,[]),new ts(73728,74751,mn,0,[0,0,0,1<<$o,0,0]),new ts(74752,74879,un,0,[0,0,0,1<<$o,0,0]),new ts(74880,75087,gn,0,[]),new ts(77824,78895,fn,0,[]),new ts(82944,83583,bn,0,[]),new ts(92160,92735,Cn,0,[]),new ts(92736,92783,vn,0,[]),new ts(92880,92927,_n,0,[]),new ts(92928,93071,xn,0,[]),new ts(93952,94111,yn,2052,[]),new ts(94176,94207,wn,0,[]),new ts(94208,100351,Sn,0,[]),new ts(100352,101119,An,0,[]),new ts(110592,110847,kn,0,[]),new ts(113664,113823,Tn,0,[]),new ts(113824,113839,In,0,[]),new ts(118784,119039,En,0,[0,0,1<<Eo.Byzantine_Musical_Symbols,0,0,0]),new ts(119040,119295,Dn,0,[0,0,1<<Eo.Byzantine_Musical_Symbols,0,0,0]),new ts(119296,119375,Pn,0,[0,0,1<<Eo.Byzantine_Musical_Symbols,0,0,0]),new ts(119552,119647,Fn,0,[]),new ts(119648,119679,Rn,0,[]),new ts(119808,120831,Vn,0,[0,0,1<<Eo.Mathematical_Alphanumeric_Symbols,0,0,0]),new ts(120832,121519,Mn,0,[]),new ts(122880,122927,Un,0,[0,0,0,1<<Do,0,0]),new ts(124928,125151,Ln,0,[]),new ts(125184,125279,Bn,0,[]),new ts(126464,126719,On,0,[]),new ts(126976,127023,Nn,0,[0,0,0,1<<Qo,0,0]),new ts(127024,127135,Hn,0,[0,0,0,1<<Qo,0,0]),new ts(127136,127231,$n,0,[]),new ts(127232,127487,Gn,0,[]),new ts(127488,127743,zn,0,[]),new ts(127744,128511,Wn,0,[]),new ts(128512,128591,jn,0,[]),new ts(128592,128639,qn,0,[]),new ts(128640,128767,Kn,0,[]),new ts(128768,128895,Yn,0,[]),new ts(128896,129023,Xn,0,[0,1<<Io.Geometric_Shapes,0,0,0,0]),new ts(129024,129279,Jn,0,[0,1<<Io.Arrows,0,0,0,0]),new ts(129280,129535,Zn,0,[]),new ts(131072,173791,Qn,0,[0,0,1<<Eo.CJK_Unified_Ideographs,0,1<<_o|1<<yo,0]),new ts(173824,177983,to,0,[0,0,1<<Eo.CJK_Unified_Ideographs,0,1<<_o|1<<yo,0]),new ts(177984,178207,eo,0,[0,0,1<<Eo.CJK_Unified_Ideographs,0,1<<_o|1<<yo,0]),new ts(178208,183983,io,0,[0,0,1<<Eo.CJK_Unified_Ideographs,0,1<<_o|1<<yo,0]),new ts(194560,195103,no,0,[0,0,1<<Eo.CJK_Strokes,0,1<<_o|1<<yo,0]),new ts(917504,917631,oo,0,[0,0,1<<Eo.Tags,0,0,0]),new ts(917760,917999,so,0,[0,0,1<<Eo.Variation_Selectors,0,0,0]),new ts(983040,1048575,ao,0,[0,0,1<<Eo.Private_Use_plane_15,0,0,0]),new ts(1048576,1114111,lo,0,[0,0,1<<Eo.Private_Use_plane_15,0,0,0])];t.getSupportedFonts=function(e){var i=function(t,e){var i=0,n=e.length-1,o=0,s=null;if(i>=n)return null;for(;i<n;)if((s=e[o=i+n>>1]).Start>t)n=o-1;else{if(!(s.End<t))return e[o];i=o+1}return i>n||(s=e[i]).Start>t||s.End<t?null:e[i]}(e,es);return t.getSupportedFontsByRange(i)},t.getSupportedFontsByRange=function(t){if(null==t)return[];for(var e=AscFonts.g_fontApplication.g_fontSelections.List,i=e.length,n=[],o=0;o<i;o++){var s=e[o],a=t.Param;if(a[0]==(s.m_ulUnicodeRange1&a[0])&&(a[1]==(s.m_ulUnicodeRange2&a[1])&&a[2]==(s.m_ulUnicodeRange3&a[2])&&a[3]==(s.m_ulUnicodeRange4&a[3]))){if(t.Name==me){if(0==(s.m_ulCodePageRange1&a[4]))continue}else if(a[4]!=(s.m_ulCodePageRange1&a[4]))continue;a[5]==(s.m_ulCodePageRange2&a[5])&&n.push(s.m_wsFontName)}}return n},t.getSupportedRangesByFont=function(t){for(var e=[],i=0;i<es.length;++i){var n=es[i],a=n.Param;a[0]==(t.m_ulUnicodeRange1&a[0])&&(a[1]==(t.m_ulUnicodeRange2&a[1])&&a[2]==(t.m_ulUnicodeRange3&a[2])&&a[3]==(t.m_ulUnicodeRange4&a[3])&&a[4]==(t.m_ulCodePageRange1&a[4])&&a[5]==(t.m_ulCodePageRange2&a[5])&&e.push(n))}return 0===e.length&&(e.push(new ts(32,126,o,1033,[1<<To.Basic_Latin,0,0,0,1<<ro,0])),e.push(new ts(160,255,s,0,[1<<To.Basic_Latin|1<<To.Latin_1_Supplement,0,0,0,1<<ro,0]))),e}}(window),define("common/main/lib/util/character",(function(){})),function(t){var e=t.fn.tooltip;e.prototype=t.fn.tooltip.Constructor.prototype,t.extend(t.fn.tooltip.Constructor.DEFAULTS,{container:"body",delay:{show:500},arrow:!1});var i=function(t,e){this.init("tooltip",t,e)};i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype,{constructor:i,init:function(){e.prototype.init.apply(this,arguments),"cursor"==this.options.placement&&/hover/.exec(this.options.trigger)&&this.$element.on("mousemove.tooltip",this.options.selector,t.proxy(this.mousemove,this)),this.options.zIndex&&this.tip().css("z-index",this.options.zIndex);var i=this;Common.NotificationCenter.on({"layout:changed":function(t){i.options.keepvisible||i.options.hideonclick||!i.tip().is(":visible")||i.hide()}}),this.isDesktopApp=Common.Controllers.Desktop.isActive()},mousemove:function(t){var e=t.clientX*Common.Utils.zoom(),i=t.clientY*Common.Utils.zoom();this.targetXY=[e,this.isDesktopApp?Math.max(i,14):i]},leave:function(t){e.prototype.leave.apply(this,arguments),this.dontShow=void 0},show:function(i){if(this.hasContent()&&this.enabled&&!this.dontShow){if(!this.$element.is(":visible")&&this.$element.closest("[role=menu]").length>0)return;var n=this.tip();!1===this.options.arrow&&n.addClass("arrow-free"),this.options.cls&&n.addClass(this.options.cls);var o="function"!=typeof this.options.placement?/^([a-zA-Z]+)-?([a-zA-Z]*)$/.exec(this.options.placement):null;if(i||!o||o[2].length){var s=t.Event("show.bs.tooltip");if(this.$element.trigger(s),s.isDefaultPrevented())return;if(this.setContent(),this.options.animation&&n.addClass("fade"),n.detach().css({top:0,left:0,display:"block"}),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element),"function"==typeof this.options.placement)this.options.placement.call(this,n[0],this.$element[0]);else if("object"==typeof i){var a={top:i[1]+15,left:i[0]+18},l=Common.Utils.innerWidth(),r=Common.Utils.innerHeight();a.left+n.width()>l&&(a.left=l-n.width()-30),a.top+n.height()>r&&(a.top=r-n.height()-30),n.offset(a).addClass("in")}else{var c=this.getPosition(),d=n[0].offsetWidth,h=n[0].offsetHeight;switch(o[1]){case"bottom":a={top:c.top+c.height+10};break;case"top":a={top:c.top-h-10}}switch(o[2]){case"left":a.left=c.left,this.$element.outerWidth()<=18&&(a.left-=4);break;case"right":a.left=c.left+c.width-d,this.$element.outerWidth()<=18&&(a.left+=4)}this.applyPlacement(a,o[1]),this.moveArrow(),n.addClass(o[1]).addClass(o[0])}this.$element.trigger("shown.bs.tooltip")}else e.prototype.show.apply(this,arguments);var p=this;clearTimeout(p.timeout),p.timeout=setTimeout((function(){"in"==p.hoverState&&p.hide(),p.dontShow=!1}),5e3)}},moveArrow:function(){var t=this.tip().find(".tooltip-arrow, .arrow");switch(this.options.placement){case"top-left":case"bottom-left":t.css("left",10);break;case"top-right":case"bottom-right":t.css("right",10)}},enter:function(e){if("mouseenter"===e.type){var i=t(e.target);if(!(i.is("[role=menu]")||i.parentsUntil(e.currentTarget,"[role=menu]").length&&e.target!==e.currentTarget||this.tip().is(":visible"))){var n=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs.tooltip");clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?n.timeout=setTimeout((function(){"in"==n.hoverState&&n.show("cursor"==n.options.placement?n.targetXY:void 0)}),n.options.delay.show):n.show()}}},replaceArrow:function(t,i,n){!1===this.options.arrow?this.arrow().hide():e.prototype.replaceArrow.apply(this,arguments)},getCalculatedOffset:function(t,i,n,o){var s=e.prototype.getCalculatedOffset.apply(this,arguments);if(this.options.offset>0||this.options.offset<0)switch(/(bottom|top)/.exec(t)[1]){case"bottom":s.top+=this.options.offset;break;case"top":s.top-=this.options.offset}return s}});var n=t.fn.tooltip;t.fn.tooltip=function(e){return this.each((function(){var n=t(this),o=n.data("bs.tooltip"),s="object"==typeof e&&e;o||n.data("bs.tooltip",o=new i(this,s)),"string"==typeof e&&o[e]()}))},t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(window.jQuery),define("tip",(function(){})),define("common/main/lib/component/Tooltip",["tip","backbone"],(function(){"use strict";var t=function(t){this.$element=this.placement=void 0,this.init.call(this,t)};_.extend(t.prototype,Backbone.Events,{init:function(t){if(this.$element=t.owner instanceof Backbone.View?t.owner.$el:$(t.owner),this.placement=t.placement,this.$element.data("bs.tooltip")&&this.$element.removeData("bs.tooltip"),this.$element.tooltip({title:t.title,trigger:"manual",placement:t.placement,offset:t.offset,cls:t.cls,html:t.html,hideonclick:t.hideonclick,keepvisible:t.keepvisible}),t.hideonclick){var e=this,i=this.$element.data("bs.tooltip");i&&i.tip().on("click",(function(){i.hide(),e.trigger("tooltip:hideonclick",this)}))}this.$element.on("shown.bs.tooltip",_.bind(this.onTipShown,this)),this.$element.on("hidden.bs.tooltip",_.bind(this.onTipHidden,this))},show:function(t){this.getBSTip().show(t)},hide:function(t){this.getBSTip().hide(t)},setTitle:function(t){var e=this.getBSTip();e&&(e.options.title=t)},updateTitle:function(){var t=this.getBSTip();t.$tip.find(".tooltip-inner")[t.options.html?"html":"text"](t.options.title)},getBSTip:function(){return this.$element.data("bs.tooltip")},onTipShown:function(){this.trigger("tooltip:show",this)},onTipHidden:function(){this.trigger("tooltip:hide",this)},isVisible:function(){return this.getBSTip().tip().is(":visible")}}),Common.UI=Common.UI||{},Common.UI.Tooltip=t})),void 0===Common)var Common={};if(define("common/main/lib/component/InputField",["common/main/lib/component/BaseView","common/main/lib/component/Tooltip","common/main/lib/component/Button"],(function(){"use strict";Common.UI.InputField=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0},template:_.template(['<div class="input-field" style="<%= style %>">',"<input ",'type="<%= type %>" ','name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','data-hint="<%= dataHint %>"','data-hint-direction="<%= dataHintDirection %>"','data-hint-offset="<%= dataHintOffset %>"',">",'<span class="input-error"></span>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.value=e.options.value,this.type=e.options.type,this.name=e.options.name,this.validation=e.options.validation,this.allowBlank=e.options.allowBlank,this.placeHolder=e.options.placeHolder,this.template=e.options.template||e.template,this.editable=e.options.editable,this.disabled=e.options.disabled,this.spellcheck=e.options.spellcheck,this.blankError=e.options.blankError||"This field is required",this.validateOnChange=e.options.validateOnChange,this.validateOnBlur=e.options.validateOnBlur,this.maxLength=e.options.maxLength,e.rendered=e.options.rendered||!1,e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){var i=this.cmpEl;if(this._input=this.cmpEl.find("input").addBack().filter("input"),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength)),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled),this._input.closest(".asc-window").length>0)var n=function(){var t=i.find(".input-error").data("bs.tooltip");t&&t.tip().remove(),Common.NotificationCenter.off({"modal:close":n})};Common.NotificationCenter.on({"modal:close":n})}return e.rendered=!0,e.value&&e.setValue(e.value),this},_doChange:function(t,e){if(!e||!e.synthetic){var i=$(t.target).val(),n=this.value;this.trigger("changed:before",this,i,n,t),t.isDefaultPrevented()||(this.value=i,this.validateOnBlur&&this.checkValidate(),this.trigger("changed:after",this,i,n,t))}},onInputChanged:function(t,e){this._doChange(t,e)},onInputChanging:function(t,e){var i=$(t.target).val(),n=this.value;t.isDefaultPrevented()||(this.value=i,this.validateOnBlur&&this.checkValidate(),this.trigger("changing",this,i,n,t))},onKeyPress:function(t){if(this.trigger("keypress:before",this,t),!t.isDefaultPrevented()){if(this.options.maskExp&&!_.isEmpty(this.options.maskExp.source)){var e=String.fromCharCode(t.which);this.options.maskExp.test(e)||t.ctrlKey||t.keyCode===Common.UI.Keys.RETURN||(t.preventDefault(),t.stopPropagation())}this.trigger("keypress:after",this,t)}},onKeyDown:function(t){this.trigger("keydown:before",this,t),t.isDefaultPrevented()||(t.keyCode===Common.UI.Keys.RETURN&&this._doChange(t),t.keyCode==Common.UI.Keys.ESC&&this.setValue(this.value),t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.ESC||this.trigger("inputleave",this))},onKeyUp:function(t){this.trigger("keyup:before",this,t),t.isDefaultPrevented()||this.trigger("keyup:after",this,t)},setEditable:function(t){var e=this._input;this.editable=t,t&&e?(e.removeAttr("readonly"),e.removeAttr("data-can-copy")):(e.attr("readonly","readonly"),e.attr("data-can-copy",!1))},isEditable:function(){return this.editable},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled")},isDisabled:function(){return this.disabled},setValue:function(t){this.value=t,this.rendered&&this._input.val(t)},getValue:function(){return this.value},focus:function(){this._input&&this._input.focus()},checkValidate:function(){var t=this,e=[];if(!t.allowBlank&&_.isEmpty(t.value)&&e.push(t.blankError),_.isFunction(t.validation)){var i=t.validation.call(t,t.value);!0!==i&&(e=_.flatten(e.concat(i)))}if(!_.isEmpty(e)){if(t.cmpEl.hasClass("error"))return(n=t.cmpEl.find(".input-error").data("bs.tooltip"))&&(n.options.title=e.join("\n"),n.setContent()),e;t.cmpEl.addClass("error");var n,o=t.cmpEl.find(".input-error"),s=o.closest(".asc-window");return(n=o.data("bs.tooltip"))&&n.tip().remove(),o.attr("data-toggle","tooltip"),o.removeData("bs.tooltip"),o.tooltip({title:e.join("\n"),placement:"cursor"}),s.length>0&&o.data("bs.tooltip").tip().css("z-index",parseInt(s.css("z-index"))+10),e}return t.cmpEl.removeClass("error"),!0},showError:function(t,e){var i=this;if(_.isEmpty(t))i.cmpEl.removeClass("error"),i.cmpEl.removeClass("warning");else{i.cmpEl.addClass(e?"warning":"error");var n=i.cmpEl.find(".input-error"),o=n.closest(".asc-window"),s=n.data("bs.tooltip");s&&s.tip().remove(),n.attr("data-toggle","tooltip"),n.removeData("bs.tooltip"),n.tooltip({title:t.join("\n"),placement:"cursor"}),o.length>0&&n.data("bs.tooltip").tip().css("z-index",parseInt(o.css("z-index"))+10)}},showWarning:function(t){this.showError(t,!0)}}),Common.UI.InputFieldBtn=Common.UI.InputField.extend({options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,iconCls:"toolbar__icon btn-select-range",btnHint:""},template:_.template(['<div class="input-field input-field-btn" style="<%= style %>">',"<input ","type=<%= type %> ",'name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','value="<%= value %>"','data-hint="<%= dataHint %>"','data-hint-offset="<%= dataHintOffset %>"','data-hint-direction="<%= dataHintDirection %>"',">",'<span class="input-error"></span>','<div class="select-button"></div>',"</div>"].join("")),render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,scope:e,dataHint:this.options.dataHint,dataHintOffset:this.options.dataHintOffset,dataHintDirection:this.options.dataHintDirection})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){var i=this.cmpEl;if(this._button=new Common.UI.Button({cls:"btn-toolbar",iconCls:this.options.iconCls,hint:this.options.btnHint||"",menu:this.options.menu}),this._button.render(this.cmpEl.find(".select-button")),this._button.on("click",_.bind(this.onButtonClick,this)),this._input=this.cmpEl.find("input").addBack().filter("input"),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength)),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled),this._input.closest(".asc-window").length>0)var n=function(){var t=i.find(".input-error").data("bs.tooltip");t&&t.tip().remove(),Common.NotificationCenter.off({"modal:close":n})};Common.NotificationCenter.on({"modal:close":n})}return e.rendered=!0,e.value&&e.setValue(e.value),this},onButtonClick:function(t,e){this.trigger("button:click",this,e)},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this._button.setDisabled(t)},setBtnDisabled:function(t){this._button.setDisabled(t)},updateBtnHint:function(t){this.options.hint=t,this.rendered&&this._button.updateHint(this.options.hint)}}),Common.UI.InputFieldBtnPassword=Common.UI.InputFieldBtn.extend(_.extend({options:{id:null,cls:"",style:"",value:"",name:"",type:"password",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,showCls:"toolbar__icon btn-sheet-view",hideCls:"toolbar__icon hide-password",btnHint:"",repeatInput:null,showPwdOnClick:!0},initialize:function(t){(t=t||{}).btnHint=t.btnHint||this.textHintShowPwd,t.iconCls=t.showCls||this.options.showCls,Common.UI.InputFieldBtn.prototype.initialize.call(this,t),this.hidePwd=!0,this.repeatInput=this.options.repeatInput},render:function(t){return Common.UI.InputFieldBtn.prototype.render.call(this,t),this._btnElm=this._button.$el,this.options.showPwdOnClick?this._button.on("click",_.bind(this.passwordClick,this)):this._btnElm.on("mousedown",_.bind(this.passwordShow,this)),this},passwordClick:function(t){this.hidePwd?(this.passwordShow(t),this.hidePwd=!1):(this.passwordHide(t),this.hidePwd=!0);var e=this,i=e._input[0].selectionStart,n=e._input[0].selectionEnd;setTimeout((function(){e.focus(),e._input[0].selectionStart=i,e._input[0].selectionEnd=n}),1)},passwordShow:function(t){this.disabled||(this._button.setIconCls(this.options.hideCls),this.type="text",this._input.attr("type",this.type),this.repeatInput&&(this.repeatInput.type=this.type,this.repeatInput._input.attr("type",this.type)),this.options.showPwdOnClick?this._button.updateHint(this.textHintHidePwd):(this._btnElm.on("mouseup",_.bind(this.passwordHide,this)),this._btnElm.on("mouseout",_.bind(this.passwordHide,this))))},passwordHide:function(t){if(this._button.setIconCls(this.options.showCls),this.type="password",this._input.attr("type",this.type),this.repeatInput&&(this.repeatInput.type=this.type,this.repeatInput._input.attr("type",this.type)),this.options.showPwdOnClick)this._button.updateHint(this.textHintShowPwd);else{this._btnElm.off("mouseup",this.passwordHide),this._btnElm.off("mouseout",this.passwordHide);var e=this,i=e._input[0].selectionStart,n=e._input[0].selectionEnd;setTimeout((function(){e.focus(),e._input[0].selectionStart=i,e._input[0].selectionEnd=n}),1)}},textHintShowPwd:"Show password",textHintHidePwd:"Hide password"},Common.UI.InputFieldBtnPassword||{})),Common.UI.InputFieldBtnCalendar=Common.UI.InputFieldBtn.extend({options:{id:null,cls:"",style:"",value:"",type:"date",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,iconCls:"toolbar__icon btn-datetime",btnHint:"",menu:!0},render:function(t){var e=this;Common.UI.InputFieldBtn.prototype.render.call(this,t);var i="id-"+Common.UI.getId()+"input-field-datetime",n=new Common.UI.Menu({menuAlign:"tr-br",style:"border: none; padding: 0;",items:[{template:_.template('<div id="'+i+'" style=""></div>'),stopPropagation:!0}]});$("button",this._button.cmpEl).addClass("no-caret"),this._button.setMenu(n),this._button.menu.on("show:after",(function(t){e.cmpCalendar||(e.cmpCalendar=new Common.UI.Calendar({el:e.cmpEl.find("#"+i),enableKeyEvents:!0,firstday:1}),e.cmpCalendar.on("date:click",(function(i,n){e.trigger("date:click",e,n),t.hide()})),t.alignPosition()),e.cmpCalendar.focus()}))},setDate:function(t){this.cmpCalendar&&t&&t instanceof Date&&!isNaN(t)&&this.cmpCalendar&&this.cmpCalendar.setDate(t)}})})),void 0===Common)var Common={};if(define("common/main/lib/view/SymbolTableDialog",["common/main/lib/util/utils","common/main/lib/util/character","common/main/lib/component/InputField","common/main/lib/component/Window"],(function(){"use strict";var t={1:"Basic Latin",2:"Latin 1 Supplement",3:"Latin Extended A",4:"Latin Extended B",5:"IPA Extensions",6:"Spacing Modifier Letters",7:"Combining Diacritical Marks",8:"Greek and Coptic",9:"Cyrillic",10:"Cyrillic Supplement",11:"Armenian",12:"Hebrew",13:"Arabic",14:"Syriac",15:"Arabic Supplement",16:"Thaana",17:"NKo",18:"Samaritan",19:"Mandaic",20:"Arabic Extended A",21:"Devanagari",22:"Bengali",23:"Gurmukhi",24:"Gujarati",25:"Oriya",26:"Tamil",27:"Telugu",28:"Kannada",29:"Malayalam",30:"Sinhala",31:"Thai",32:"Lao",33:"Tibetan",34:"Myanmar",35:"Georgian",36:"Hangul Jamo",37:"Ethiopic",38:"Ethiopic Supplement",39:"Cherokee",40:"Unified Canadian Aboriginal Syllabics",41:"Ogham",42:"Runic",43:"Tagalog",44:"Hanunoo",45:"Buhid",46:"Tagbanwa",47:"Khmer",48:"Mongolian",49:"Unified Canadian Aboriginal Syllabics Extended",50:"Limbu",51:"Tai Le",52:"New Tai Lue",53:"Khmer Symbols",54:"Buginese",55:"Tai Tham",56:"Combining Diacritical Marks Extended",57:"Balinese",58:"Sundanese",59:"Batak",60:"Lepcha",61:"Ol Chiki",62:"Cyrillic Extended C",63:"Sundanese Supplement",64:"Vedic Extensions",65:"Phonetic Extensions",66:"Phonetic Extensions Supplement",67:"Combining Diacritical Marks Supplement",68:"Latin Extended Additional",69:"Greek Extended",70:"General Punctuation",71:"Superscripts and Subscripts",72:"Currency Symbols",73:"Combining Diacritical Marks for Symbols",74:"Letterlike Symbols",75:"Number Forms",76:"Arrows",77:"Mathematical Operators",78:"Miscellaneous Technical",79:"Control Pictures",80:"Optical Character Recognition",81:"Enclosed Alphanumerics",82:"Box Drawing",83:"Block Elements",84:"Geometric Shapes",85:"Miscellaneous Symbols",86:"Dingbats",87:"Miscellaneous Mathematical Symbols A",88:"Supplemental Arrows A",89:"Braille Patterns",90:"Supplemental Arrows B",91:"Miscellaneous Mathematical Symbols B",92:"Supplemental Mathematical Operators",93:"Miscellaneous Symbols and Arrows",94:"Glagolitic",95:"Latin Extended C",96:"Coptic",97:"Georgian Supplement",98:"Tifinagh",99:"Ethiopic Extended",100:"Cyrillic Extended A",101:"Supplemental Punctuation",102:"CJK Radicals Supplement",103:"Kangxi Radicals",104:"Ideographic Description Characters",105:"CJK Symbols and Punctuation",106:"Hiragana",107:"Katakana",108:"Bopomofo",109:"Hangul Compatibility Jamo",110:"Kanbun",111:"Bopomofo Extended",112:"CJK Strokes",113:"Katakana Phonetic Extensions",114:"Enclosed CJK Letters and Months",115:"CJK Compatibility",116:"CJK Unified Ideographs Extension",117:"Yijing Hexagram Symbols",118:"CJK Unified Ideographs",119:"Yi Syllables",120:"Yi Radicals",121:"Lisu",122:"Vai",123:"Cyrillic Extended B",124:"Bamum",125:"Modifier Tone Letters",126:"Latin Extended D",127:"Syloti Nagri",128:"Common Indic Number Forms",129:"Phags pa",130:"Saurashtra",131:"Devanagari Extended",132:"Kayah Li",133:"Rejang",134:"Hangul Jamo Extended A",135:"Javanese",136:"Myanmar Extended B",137:"Cham",138:"Myanmar Extended A",139:"Tai Viet",140:"Meetei Mayek Extensions",141:"Ethiopic Extended A",142:"Latin Extended E",143:"Cherokee Supplement",144:"Meetei Mayek",145:"Hangul Syllables",146:"Hangul Jamo Extended B",147:"High Surrogates",148:"High Private Use Surrogates",149:"Low Surrogates",150:"Private Use Area",151:"CJK Compatibility Ideographs",152:"Alphabetic Presentation Forms",153:"Arabic Presentation Forms A",154:"Variation Selectors",155:"Vertical Forms",156:"Combining Half Marks",157:"CJK Compatibility Forms",158:"Small Form Variants",159:"Arabic Presentation Forms B",160:"Halfwidth and Fullwidth Forms",161:"Specials",162:"Linear B Syllabary",163:"Linear B Ideograms",164:"Aegean Numbers",165:"Ancient Greek Numbers",166:"Ancient Symbols",167:"Phaistos Disc",168:"Lycian",169:"Carian",170:"Coptic Epact Numbers",171:"Old Italic",172:"Gothic",173:"Old Permic",174:"Ugaritic",175:"Old Persian",176:"Deseret",177:"Shavian",178:"Osmanya",179:"Osage",180:"Elbasan",181:"Caucasian Albanian",182:"Linear A",183:"Cypriot Syllabary",184:"Imperial Aramaic",185:"Palmyrene",186:"Nabataean",187:"Hatran",188:"Phoenician",189:"Lydian",190:"Meroitic Hieroglyphs",191:"Meroitic Cursive",192:"Kharoshthi",193:"Old South Arabian",194:"Old North Arabian",195:"Manichaean",196:"Avestan",197:"Inscriptional Parthian",198:"Inscriptional Pahlavi",199:"Psalter Pahlavi",200:"Old Turkic",201:"Old Hungarian",202:"Rumi Numeral Symbols",203:"Brahmi",204:"Kaithi",205:"Sora Sompeng",206:"Chakma",207:"Mahajani",208:"Sharada",209:"Sinhala Archaic Numbers",210:"Khojki",211:"Multani",212:"Khudawadi",213:"Grantha",214:"Newa",215:"Tirhuta",216:"Siddham",217:"Modi",218:"Mongolian Supplement",219:"Takri",220:"Ahom",221:"Warang Citi",222:"Pau Cin Hau",223:"Bhaiksuki",224:"Marchen",225:"Cuneiform",226:"Cuneiform Numbers and Punctuation",227:"Early Dynastic Cuneiform",228:"Egyptian Hieroglyphs",229:"Anatolian Hieroglyphs",230:"Bamum Supplement",231:"Mro",232:"Bassa Vah",233:"Pahawh Hmong",234:"Miao",235:"Ideographic Symbols and Punctuation",236:"Tangut",237:"Tangut Components",238:"Kana Supplement",239:"Duployan",240:"Shorthand Format Controls",241:"Byzantine Musical Symbols",242:"Musical Symbols",243:"Ancient Greek Musical Notation",244:"Tai Xuan Jing Symbols",245:"Counting Rod Numerals",246:"Mathematical Alphanumeric Symbols",247:"Sutton SignWriting",248:"Glagolitic Supplement",249:"Mende Kikakui",250:"Adlam",251:"Arabic Mathematical Alphabetic Symbols",252:"Mahjong Tiles",253:"Domino Tiles",254:"Playing Cards",255:"Enclosed Alphanumeric Supplement",256:"Enclosed Ideographic Supplement",257:"Miscellaneous Symbols and Pictographs",258:"Emoticons",259:"Ornamental Dingbats",260:"Transport and Map Symbols",261:"Alchemical Symbols",262:"Geometric Shapes Extended",263:"Supplemental Arrows C",264:"Supplemental Symbols and Pictographs",265:"CJK Unified Ideographs Extension B",266:"CJK Unified Ideographs Extension C",267:"CJK Unified Ideographs Extension D",268:"CJK Unified Ideographs Extension E",269:"CJK Compatibility Ideographs Supplement",270:"Tags",271:"Variation Selectors Supplement",272:"Supplementary Private Use Area A",273:"Supplementary Private Use Area B"},e=33,i=[],n=[],o=[],s=-1,a=-1,l=!0,r=-1,c="",d=-1e3,h="",p=-1e3,m=-1,u=-1,g=20,f=20;Common.Views.SymbolTableDialog=Common.UI.Window.extend(_.extend({options:{resizable:!0,minwidth:448,minheight:434,width:448,height:434,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(e){var r=Common.localStorage.getKeysFilter();this.appPrefix=r&&r.length?r.split(",")[0]:"";var c=this.appPrefix+"settings-size-symbol-table",d=Common.Utils.InternalSettings.get(c);null!=d&&null!=d||(d=Common.localStorage.getItem(c)||"",Common.Utils.InternalSettings.set(c,d)),d=d?JSON.parse(d):[],this.options=_.extend({resizable:!0,minwidth:448,minheight:434,width:448,height:434,cls:"modal-dlg",buttons:["ok","cancel"]},{title:this.textTitle,width:d[0]||448,height:d[1]||434},e||{}),this.api=this.options.api,this.type=this.options.type||0,this.special=this.options.special||!1,this.showShortcutKey=this.options.showShortcutKey||!1,!this.special&&(this.options.height-=38),!this.special&&(this.options.minheight-=38),this.template=['<div class="box">','<div style="margin-bottom: 16px;" class="'+(this.special?"":"hidden")+'">','<button type="button" class="btn btn-text-default auto" id="symbol-table-symbols" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">',this.textSymbols,"</button>",'<button type="button" class="btn btn-text-default auto" id="symbol-table-special" style="border-top-left-radius: 0;border-bottom-left-radius: 0;border-left-width: 0;margin-left: -1px;">',this.textSpecial,"</button>","</div>",'<div id="symbol-table-pnl-symbols">','<table cols="2" style="width: 100%;max-width: 497px;">',"<tr>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 50%;">','<label class="input-label">'+this.textFont+"</label>",'<div id="symbol-table-cmb-fonts"></div>',"</td>",'<td style="padding-left: 5px;padding-bottom: 8px;">','<label class="input-label">'+this.textRange+"</label>",'<div id="symbol-table-cmb-range"></div>',"</td>","</tr>","</table>",'<table cols="1" style="width: 100%;">',"<tr>",'<td style="padding-bottom: 16px;">','<div id="symbol-table-scrollable-div" style="position: relative;height:'+(this.options.height-304+38*(this.special?0:1))+'px;">','<div style="width: 100%;">','<div id="id-preview">',"<div>",'<div style="position: absolute; top: 0;"><div id="id-preview-data" tabindex="0" oo_editor_input="true"></div></div>',"</div>","</div>","</div>","</div>","</td>","</tr>","<tr>",'<td style="padding-bottom: 16px;">','<label class="input-label">'+this.textRecent+"</label>",'<div id="symbol-table-recent" tabindex="0" oo_editor_input="true" style="width: 100%;"></div>',"</td>","</tr>","</table>",'<table cols="2" style="width: 100%;max-width: 497px;">',"<tr>",'<td style="padding-right: 5px; width: 50%;">','<label class="input-label">'+this.textCode+"</label>","</td>",'<td style="padding-left: 5px;">',"</td>","</tr>","<tr>",'<td style="padding-right: 5px;">','<div id="symbol-table-text-code" oo_editor_input="true"></div>',"</td>",'<td style="padding-left: 5px;">','<div id="symbol-table-label-font" style="overflow: hidden; text-overflow: ellipsis;white-space: nowrap;max-width: 160px;"></div>',"</td>","</tr>","</table>","</div>",'<div id="symbol-table-pnl-special">','<table cols="1" style="width: 100%;">',"<tr>","<td>","<label>"+this.textCharacter+"</label>",'<label id="symbol-table-lbl-shortcut" style="float: right; width: 107px;">'+this.textShortcut+"</label>","</td>","</tr>","<tr>","<td>",'<div id="symbol-table-special-list" class="no-borders" style="width:100%; height: '+(this.options.height-157+38*(this.special?0:1))+'px;"></div>',"</td>","</tr>","</table>","</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options);var h,p,m,u=i.length<1;if(u&&this.initFonts(),this.fillRecentSymbols(),e.font?h=e.font:o.length>0&&(h=o[0].font),h)for(var g=0;g<i.length;++g)if(i[g].displayValue===h){s=g;break}if(s<0&&(s=0),n=this.getArrRangesByFont(s),-1===a&&(a=n[0].Start),e.code?a=e.code:e.symbol?a=this.fixedCharCodeAt(e.symbol,0):o.length>0&&(a=o[0].symbol),u&&this.options.lang&&"en"!=this.options.lang){var f=this;p=this.options.lang,m=function(){f.updateRangeSelector()},p=p.split(/[\-_]/)[0].toLocaleLowerCase(),Common.Utils.loadConfig("resources/symboltable/"+p+".json",(function(e){for(var i=1;i<274;i++){var n=t[i];t[i]=e[n]||n}m&&m()}))}Common.UI.Window.prototype.initialize.call(this,this.options),this.on("resizing",_.bind(this.onWindowResizing,this)),this.on("resize",_.bind(this.onWindowResize,this)),l=!0},initFonts:function(){var t,e,n=this.api.pluginMethod_GetFontList();n.sort((function(t,e){return t.m_wsFontName<e.m_wsFontName?-1:t.m_wsFontName>e.m_wsFontName?1:0}));for(var o,a=[],l={},r=0;r<n.length;++r)(e=l[o=(t=n[r]).m_wsFontName])?e.m_bBold&&e.m_bItalic||e.m_bBold&&!t.m_bBold?l[o]=t:!e.m_bItalic||t.m_bBold||t.m_bItalic||(l[o]=t):l[o]=t;delete l.ASCW3;r=0;for(var d in l)l.hasOwnProperty(d)&&(a.push(l[d]),a[a.length-1].displayValue=l[d].m_wsFontName);for((i=a).sort((function(t,e){return t.displayValue.toLowerCase()>e.displayValue.toLowerCase()?1:-1})),r=0;r<i.length;++r)i[r].value=r;if(l[c]||(l["Cambria Math"]?c="Cambria Math":l["Asana-Math"]&&(c="Asana-Math")),l[c])for(r=0;r<i.length;++r)if(i[r].displayValue===c){s=r;break}},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();e.find(".resize-border").css({background:"none",border:"none"}),this.btnSymbols=new Common.UI.Button({el:e.find("#symbol-table-symbols"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1,pressed:!0}),this.btnSymbols.on("click",_.bind(this.onModeClick,this,!1)),this.btnSpecial=new Common.UI.Button({el:e.find("#symbol-table-special"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1}),this.btnSpecial.on("click",_.bind(this.onModeClick,this,!0)),this.cmbFonts=new Common.UI.ComboBox({el:e.find("#symbol-table-cmb-fonts"),cls:"input-group-nr",data:i,editable:!1,search:!0,menuStyle:"min-width: 100%; max-height: 209px;"}).on("selected",(function(e,i){var o=t.getRangeBySymbol(n,a);if(s=i.value,n=t.getArrRangesByFont(s),o){for(var r=0;r<n.length&&o.Name!==n[r].Name;++r);r===n.length&&(a=n[0].Start)}else a=n[0].Start;l=!0,t.updateView(),setTimeout((function(){t.previewPanel.focus()}),1)})),this.cmbFonts.setValue(s),this.cmbRange=new Common.UI.ComboBox({el:e.find("#symbol-table-cmb-range"),cls:"input-group-nr",editable:!1,search:!0,menuStyle:"min-width: 100%; max-height: 209px;"}).on("selected",(function(e,i){var o=t.getRangeByName(n,parseInt(i.value));a=o.Start,l=!0,t.updateView(void 0,void 0,void 0,void 0,!1),setTimeout((function(){t.previewPanel.focus()}),1)})),this.updateRangeSelector(),t.inputCode=new Common.UI.InputField({el:e.find("#symbol-table-text-code"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validateOnChange:!0}).on("changing",(function(i,o,s){var r=parseInt(o,16);if(!isNaN(r)&&r>31&&t.getRangeBySymbol(n,r)){var c=0===e.find("#c"+r).length;a=r,l=!0,t.updateView(c,void 0,!1)}})).on("change:after",(function(e,i,n){t.updateInput()})),this.symbolTablePanel=e.find("#symbol-table-scrollable-div"),this.previewPanel=e.find("#id-preview-data"),this.previewParent=this.previewPanel.parent(),this.previewScrolled=e.find("#id-preview"),this.previewInner=this.previewScrolled.find("div:first-child"),this.recentPanel=e.find("#symbol-table-recent"),this.fontLabel=e.find("#symbol-table-label-font"),this.boxPanel=e.find(".box"),this.updateView(void 0,void 0,void 0,!0);var o=[{symbol:"—",description:this.textEmDash,shortcutKey:"Alt+Ctrl+Num -",code:"2014"},{symbol:"–",description:this.textEnDash,shortcutKey:"",code:"2013"},{symbol:"‑",description:this.textNBHyphen,shortcutKey:"Ctrl+Shift+_",code:"002D",special:{NonBreakingHyphen:!0}},{symbol:"",description:this.textEmSpace,shortcutKey:"",code:"2003"},{symbol:"",description:this.textEnSpace,shortcutKey:"",code:"2002"},{symbol:"",description:this.textQEmSpace,shortcutKey:"",code:"2005"},{symbol:"°",description:this.textNBSpace,shortcutKey:"Ctrl+Shift+Space",code:"00A0"},{symbol:"©",description:this.textCopyright,shortcutKey:"",code:"00A9"},{symbol:"®",description:this.textRegistered,shortcutKey:"",code:"00AE"},{symbol:"™",description:this.textTradeMark,shortcutKey:"",code:"2122"},{symbol:"§",description:this.textSection,shortcutKey:"",code:"00A7"},{symbol:"¶",description:this.textPilcrow,shortcutKey:"",code:"00B6"},{symbol:"…",description:this.textEllipsis,shortcutKey:"",code:"2026"},{symbol:"‛",description:this.textSOQuote,shortcutKey:"",code:"2018"},{symbol:"’",description:this.textSCQuote,shortcutKey:"",code:"2019"},{symbol:"‟",description:this.textDOQuote,shortcutKey:"",code:"201C"},{symbol:"”",description:this.textDCQuote,shortcutKey:"",code:"201D"}];this.specialList=new Common.UI.ListView({el:e.find("#symbol-table-special-list"),store:new Common.UI.DataViewStore(o),simpleAddMode:!0,cls:"dbl-clickable",itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:flex;">','<div style="width:70px;text-align: center; padding-right: 5px;"><%= symbol %></div>','<div style="flex-grow:1;padding-right: 5px;"><%= description %></div>',"<% if ("+this.showShortcutKey+") { %>",'<div style="width:100px;"><%= shortcutKey %></div>',"<% } %>","</div>"].join(""))}),this.specialList.on("item:dblclick",_.bind(this.onDblClickSpecialItem,this)).on("entervalue",_.bind(this.onDblClickSpecialItem,this)),this.specialList.selectByIndex(0),this.lblShortCut=e.find("#symbol-table-lbl-shortcut"),this.lblShortCut.toggleClass("hidden",!this.showShortcutKey),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.symbolsPanel=e.find("#symbol-table-pnl-symbols"),this.specialPanel=e.find("#symbol-table-pnl-special")},show:function(){Common.UI.Window.prototype.show.apply(this,arguments),this.binding||(this.binding={}),this.binding.keydownSymbols=_.bind(this.onKeyDown,this),this.binding.keypressSymbols=_.bind(this.onKeyPress,this),$(document).on("keydown."+this.cid,"#symbol-table-scrollable-div #id-preview-data, #symbol-table-recent",this.binding.keydownSymbols),$(document).on("keypress."+this.cid,"#symbol-table-scrollable-div #id-preview-data, #symbol-table-recent",this.binding.keypressSymbols);var t=this.special&&!!Common.Utils.InternalSettings.get(this.appPrefix+"symbol-table-special");t?this.btnSpecial.toggle(!0):this.btnSymbols.toggle(!0),this.ShowHideElem(t)},close:function(t){$(document).off("keydown."+this.cid,this.binding.keydownSymbols),$(document).off("keypress."+this.cid,this.binding.keypressSymbols),this.special&&Common.Utils.InternalSettings.set(this.appPrefix+"symbol-table-special",this.btnSpecial.isActive()),Common.UI.Window.prototype.close.apply(this,arguments)},getPasteSymbol:function(t){var e,n=!1;if(t&&t.length>0)if(n="c"===t[0])e=i[s].displayValue;else{var o=parseInt(t.split("_")[2]);e=i[o].displayValue}return{font:e,symbol:this.encodeSurrogateChar(a),code:a,updateRecents:n}},getSpecialSymbol:function(){var t=this.specialList.getSelectedRec();return{font:void 0,symbol:this.encodeSurrogateChar(t.get("code")),code:parseInt(t.get("code"),16),special:t.get("special")}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value,!0)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t,e){if(e||!document.activeElement||"textarea"!=document.activeElement.localName||!/area_id/.test(document.activeElement.id)){var i=this.btnSpecial.isActive(),n="ok"==t?i?this.getSpecialSymbol():this.getPasteSymbol(this.$window.find(".cell-selected").attr("id")):{};this.options.handler&&this.options.handler.call(this,this,t,n),"ok"==t&&(!i&&this.checkRecent(a,n.font),!i&&n.updateRecents&&this.updateRecents(),this.type)||this.close()}},encodeSurrogateChar:function(t){if(t<65536)return String.fromCharCode(t);var e=55296|(t-=65536)>>10,i=56320|1023&t;return String.fromCharCode(e)+String.fromCharCode(i)},fixedCharCodeAt:function(t,e){e=e||0;var i,n,o=t.charCodeAt(e);if(55296<=o&&o<=56319){if(i=o,n=t.charCodeAt(e+1),isNaN(n))throw"Старшая часть суррогатной пары без следующей младшей в fixedCharCodeAt()";return 1024*(i-55296)+(n-56320)+65536}return!(56320<=o&&o<=57343)&&o},getArrRangesByFont:function(t){var e=getSupportedRangesByFont(i[t]);return 0===e.length&&e.push({Start:32,End:255}),e[0].Start<32&&(e[0].Start=32),e},getRangeBySymbol:function(t,e){for(var i=0;i<t.length;++i)if(t[i].Start<=e&&t[i].End>=e)return t[i];return null},getRangeByName:function(t,e){for(var i=0;i<t.length;++i)if(t[i].Name===e)return t[i];return null},getLinearIndexByCode:function(t,e){for(var i,n=0,o=0;o<t.length;++o){if((i=t[o]).Start>e)return-1;if(i.Start<=e&&i.End>=e)return n+(e-i.Start);n+=i.End-i.Start+1}return-1},getCodeByLinearIndex:function(t,e){if(e<0)return-1;for(var i,n=0,o=t[0],s=0;s<t.length;++s){if(n+(i=(o=t[s]).End-o.Start+1)>e)return o.Start+e-n;n+=i}return-1},createTable:function(t,e,i){for(var n,o=e*i,s=0,a="",l=0;l<o;++l)n=l/i>>0==e-1?"style='border-bottom: none'":"",l<t.length?a+='<div class="cell" '+n+' id="'+("c"+t[l])+'">&#'+t[l].toString(10)+"</div>":a+='<div class="cell"'+n+"></div>",++s>=i&&(a+='<br class="noselect">',s=0);this.previewPanel.html(a)},fillRecentSymbols:function(){var t,e=Common.localStorage.getItem(this.appPrefix+"recentSymbols");""!=e&&(t=JSON.parse(e)),_.isArray(t)&&(o=t)},saveRecent:function(){var t=JSON.stringify(o);Common.localStorage.setItem(this.appPrefix+"recentSymbols",t)},checkRecent:function(t,e){if(0!==o.length){for(var i=0;i<o.length;++i)if(o[i].symbol===t&&o[i].font===e){o.splice(i,1);break}o.splice(0,0,{symbol:t,font:e}),o.length>36&&o.splice(36,o.length-36),this.saveRecent()}else o.push({symbol:t,font:e})},createCell:function(t,e){var n="",o="";if(e){for(var s=0,a=0;a<i.length;++a)if(i[a].displayValue===e){s=a;break}n="r_"+t+"_"+s,o="&#"+t.toString()}else void 0!==t&&(n="r"+t,o="&#"+t.toString());var l=$('<div id="'+n+'">'+o+"</div>");return l.addClass("cell"),l.addClass("noselect"),l.mousedown(_.bind(this.cellClickHandler,this)),e&&l.css("font-family","'"+e+"'"),l},cellClickHandler:function(t){var e=$(t.target).attr("id");if(e){var i=(new Date).getTime();if(e===h&&i-p<300)this.cellDblClickHandler(t);else{if("c"===e[0])a=parseInt(e.slice(1,e.length)),l=!0;else{var n=e.split("_");a=parseInt(n[1]),r=parseInt(n[2]),l=!1}this.updateView(!1)}h=t.target.id,p=i}},cellDblClickHandler:function(t){if(this.type){var e=this.getPasteSymbol($(t.target).attr("id"));this.checkRecent(a,e.font),e.updateRecents&&this.updateView(!1,void 0,void 0,!0),this.fireEvent("symbol:dblclick",this,"ok",e)}else this._handleInput("ok")},onDblClickSpecialItem:function(t){if(this.type){var e=this.getSpecialSymbol();this.fireEvent("symbol:dblclick",this,"ok",e)}else this._handleInput("ok")},updateRecents:function(){var t=this.recentPanel;t.empty();var e=this.getColsCount(),i=o.length;t.width(31*e);for(var n=0;n<e;++n){var s=n<i?this.createCell(o[n].symbol,o[n].font):this.createCell();s.css("border-bottom","none"),t.append(s),n===e-1&&s.css("border-right","none")}},getColsCount:function(){return(this.boxPanel.innerWidth()-13)/31>>0},getMaxHeight:function(){return this.symbolTablePanel.innerHeight()-2},getRowsCount:function(){return Math.max(1,this.getMaxHeight()/e>>0)},getAllSymbolsCount:function(t){for(var e,i=0,n=0;n<t.length;++n)i+=(e=t[n]).End-e.Start+1;return i},setTable:function(t){for(var e,o=this.getColsCount(),a=this.getRowsCount(),l=this.getLinearIndexByCode(n,t),r=this.getAllSymbolsCount(n),c=Math.ceil(r/o),d=Math.max(0,Math.min(c-a,l/o>>0)),h=d*o,p=a*o,m=[],u=0;u<p&&-1!==(e=this.getCodeByLinearIndex(n,h+u));++u)m.push(e);return this.previewPanel.css("font-family","'"+i[s].displayValue+"'"),this.createTable(m,a,o),d},updateView:function(t,o,c,d,h){l&&!1!==h&&this.updateRangeSelector(),l?this.fontLabel.text(i[s]?i[s].displayValue:""):this.fontLabel.text(i[r]?i[r].displayValue:""),!1!==t&&this.cmbFonts.setValue(s);var p=this.getRowsCount()*e;if(!1,!1!==t){var m=null!=o?o:a,u=this.setTable(m),b=this.getAllSymbolsCount(n),C=Math.ceil(b/this.getColsCount())*e;this.previewInner.height(C),this.previewPanel.height(p),this.previewScrolled.height(p),this.scrollerY||(g=Math.max(22,p/8+.5>>0),f=Math.min(Math.floor(this.previewPanel.height()/e)*e/10,20),this.scrollerY=new Common.UI.Scroller({el:this.previewScrolled,minScrollbarLength:g,alwaysVisibleY:!0,wheelSpeed:f,useKeyboard:!1,onChange:_.bind((function(){this.scrollerY&&(this._preventUpdateScroll=!0,this.onScrollEnd(),this._preventUpdateScroll=!1,this.previewParent.height(p),this.previewParent.css({top:this.scrollerY.getScrollTop()}))}),this)})),this._preventUpdateScroll||(this.scrollerY.update({minScrollbarLength:g,wheelSpeed:f}),this.scrollerY.scrollTop(u*e));var v=this.previewPanel.find(".cell");v.off("mousedown"),v.mousedown(_.bind(this.cellClickHandler,this))}d&&this.updateRecents(),this.$window.find(".cell").removeClass("cell-selected"),l?this.$window.find("#c"+a).addClass("cell-selected"):this.$window.find("#r_"+a+"_"+r).addClass("cell-selected"),!1!==c&&this.updateInput()},onScrollEnd:function(){if(this.scrollerY.getScrollTop()!==d){var t=this.getAllSymbolsCount(n),i=this.getColsCount(),o=this.getRowsCount(),s=Math.ceil(t/i),r=s*e,c=Math.max(0,Math.min(s-o,s*this.scrollerY.getScrollTop()/r+.5>>0));if(d=this.scrollerY.getScrollTop(),l){var h=this.previewPanel.children()[0];if(h){var p=h.id;if(p){var m=parseInt(p.slice(1,p.length)),u=this.getLinearIndexByCode(n,m),g=c*i+(this.getLinearIndexByCode(n,a)-u);a=this.getCodeByLinearIndex(n,g);var f=c*i;for(g-=i;-1===a&&g>=f;)a=this.getCodeByLinearIndex(n,g),g-=i;-1===a&&(a=this.getCodeByLinearIndex(n,f))}else a=this.getCodeByLinearIndex(n,c*i)}}else a=this.getCodeByLinearIndex(n,c*i),l=!0;this.updateView(!0,this.getCodeByLinearIndex(n,c*i))}},updateInput:function(){for(var t=a.toString(16).toUpperCase(),e=t.length;e<5;++e)t="0"+t;this.inputCode.setValue(t)},updateRangeSelector:function(){var e=this.getRangeBySymbol(n,a);if(e&&e.Name){this.cmbRange.setDisabled(!1);var i,o=[];for(i=0;i<n.length;++i)o.push({value:n[i].Name,displayValue:t[n[i].Name]});this.cmbRange.setData(o),this.cmbRange.setValue(e.Name)}else this.cmbRange.setDisabled(!0),this.cmbRange.setValue("")},onKeyDown:function(t){if(!document.activeElement||!document.activeElement.nodeName||"span"!==document.activeElement.nodeName.toLowerCase()){var e=t.which||t.charCode||t.keyCode||0,i=!0;if(l){var o=-1;if(e===Common.UI.Keys.LEFT?o=this.getCodeByLinearIndex(n,this.getLinearIndexByCode(n,a)-1):e===Common.UI.Keys.UP?o=this.getCodeByLinearIndex(n,this.getLinearIndexByCode(n,a)-this.getColsCount()):e===Common.UI.Keys.RIGHT?o=this.getCodeByLinearIndex(n,this.getLinearIndexByCode(n,a)+1):e===Common.UI.Keys.DOWN?o=this.getCodeByLinearIndex(n,this.getLinearIndexByCode(n,a)+this.getColsCount()):e===Common.UI.Keys.HOME?n.length>0&&(o=n[0].Start):e===Common.UI.Keys.END?n.length>0&&(o=n[n.length-1].End):i=!1,o>-1){a=o;var s=0===this.$window.find("#c"+a).length;this.updateView(s)}}else{var c,d;if(e===Common.UI.Keys.LEFT){if((c=this.$window.find(".cell-selected")[0])&&"r"===c.id[0]){var h=this.$window.find(c).prev();h.length>0&&(d=this.$window.find(h).attr("id").split("_"),a=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}}else if(e===Common.UI.Keys.RIGHT){if((c=this.$window.find(".cell-selected")[0])&&"r"===c.id[0]){var p=this.$window.find(c).next();p.length>0&&(d=this.$window.find(p).attr("id").split("_"),a=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}}else if(e===Common.UI.Keys.HOME){var g=this.$window.find("#recent-table").children()[0];g&&(d=g.id.split("_"),a=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}else if(e===Common.UI.Keys.END){var f=this.recentPanel.children(),b=f[f.length-1];b&&(d=b.id.split("_"),a=parseInt(d[1]),r=parseInt(d[2]),this.updateView(!1))}else i=!1}i&&(u=e,m=(new Date).getTime())}},onKeyPress:function(t){if(!document.activeElement||!document.activeElement.nodeName||"span"!==document.activeElement.nodeName.toLowerCase()){var e=t.which||t.charCode||t.keyCode||0;if(!(u===e&&Math.abs(m-(new Date).getTime())<1e3)){if(!isNaN(e)&&e>31)if(this.getRangeBySymbol(n,e)){var i=0===this.$window.find("#c"+e).length;a=e,l=!0,this.updateView(i,void 0,!0)}t.preventDefault&&t.preventDefault()}}},onWindowResize:function(t){var i=this.getSize();if(t&&"start"==t[1])this._preventUpdateScroll=!0,this.curSize={resize:!1,width:i[0],height:i[1]};else if(this.curSize.resize){this._preventUpdateScroll=!1,this.curSize.height=i[1]-304+38*(this.special?0:1);var n=Math.max(1,(this.curSize.height-2)/e>>0)*e;this.symbolTablePanel.css({height:this.curSize.height+"px"}),this.previewPanel.css({height:n+"px"}),this.previewScrolled.css({height:n+"px"}),this.scrollerY=null,this.updateView(void 0,void 0,void 0,!0),this.specialList.cmpEl.height(i[1]-157+38*(this.special?0:1)),!this.special&&(i[1]+=38);var o=JSON.stringify(i);Common.localStorage.setItem(this.appPrefix+"settings-size-symbol-table",o),Common.Utils.InternalSettings.set(this.appPrefix+"settings-size-symbol-table",o)}},onWindowResizing:function(){if(this.curSize){var t=this.getSize();if(t[0]!==this.curSize.width||t[1]!==this.curSize.height){this.curSize.resize||(this.curSize.resize=!0),this.curSize.width=t[0],this.curSize.height=t[1]-304+38*(this.special?0:1);var i=Math.max(1,(this.curSize.height-2)/e>>0)*e;this.symbolTablePanel.css({height:this.curSize.height+"px"}),this.previewPanel.css({height:i+"px"}),this.previewScrolled.css({height:i+"px"}),this.specialList.cmpEl.height(t[1]-157+38*(this.special?0:1)),this.updateView(void 0,void 0,void 0,!0)}}},onModeClick:function(t,e,i){this.ShowHideElem(t)},ShowHideElem:function(t){this.symbolsPanel.toggleClass("hidden",t),this.specialPanel.toggleClass("hidden",!t);var e=this;_.delay((function(){t?e.specialList.focus():e.previewPanel.focus()}),50)},textTitle:"Symbol",textFont:"Font",textRange:"Range",textRecent:"Recently used symbols",textCode:"Unicode HEX value",textSymbols:"Symbols",textSpecial:"Special characters",textCharacter:"Character",textShortcut:"Shortcut key",textEmDash:"Em Dash",textEnDash:"En Dash",textNBHyphen:"Non-breaking Hyphen",textSHyphen:"Soft Hyphen",textEmSpace:"Em Space",textEnSpace:"En Space",textQEmSpace:"1/4 Em Space",textNBSpace:"No-break Space",textCopyright:"Copyright Sign",textRegistered:"Registered Sign",textTradeMark:"Trade Mark Sign",textSection:"Section Sign",textPilcrow:"Pilcrow Sign",textEllipsis:"Horizontal Ellipsis",textSOQuote:"Single Opening Quote",textSCQuote:"Single Closing Quote",textDOQuote:"Double Opening Quote",textDCQuote:"Double Closing Quote"},Common.Views.SymbolTableDialog||{}))})),void 0===Common)var Common={};function onDropDownKeyDown(t){var e=$(this),i=e.parent(),n=jQuery.Event("keydown.before.bs.dropdown",{keyCode:t.keyCode}),o=jQuery.Event("keydown.after.bs.dropdown",{keyCode:t.keyCode});i.trigger(n),i.hasClass("no-stop-propagate")?(arguments.length>1&&arguments[1]instanceof KeyboardEvent&&(t=arguments[1]),!/^(38|40|27|13|9|37|39)$/.test(t.keyCode)||t.ctrlKey||t.altKey||(patchDropDownKeyDownAdditional.call(this,t),/(37|39)/.test(t.keyCode)||(t.preventDefault(),t.stopPropagation()))):e.hasClass("move-focus")?(!/^(13|9|32)/.test(t.keyCode)&&(27!==t.keyCode||i.hasClass("open"))||t.ctrlKey||t.altKey)&&(patchDropDownKeyDown.call(this,t),t.preventDefault(),t.stopPropagation()):(patchDropDownKeyDown.call(this,t),t.preventDefault(),t.stopPropagation()),i.trigger(o)}function checkFocusedItem(t,e){var i=t.innerHeight(),n=(i-t.height())/2,o=e.position().top,s=e.outerHeight();o<0?t.scrollTop(t.scrollTop()+o-n):o+s>i&&t.scrollTop(t.scrollTop()+o+s-i+n)}function patchDropDownKeyDown(t){if(/(38|40|27|37|39)/.test(t.keyCode)){var e=$(this);if(t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled")){var i=getParent(e),n=i.hasClass("open")||i.hasClass("over");if(!n||n&&27==t.keyCode){if(27==t.which){if((o=$("[role=menu] li.dropdown-submenu.over:visible",i)).length)return o.eq(o.length-1).removeClass("over"),!1;i.hasClass("dropdown-submenu")&&i.hasClass("over")?(i.removeClass("over"),i.find("> a").focus()):i.find("[data-toggle=dropdown]").focus()}return n?e.click():void 0}var o=$("> [role=menu] > li:not(.divider):not(.disabled):visible",i).find("> a");if(o.length){var s=o.index(o.filter(":focus"));if(39==t.keyCode){if(s<0)return;var a=o.eq(s).parent();a.hasClass("dropdown-submenu")&&!a.hasClass("over")&&(a.mouseenter(),a.addClass("focused-submenu"),_.delay((function(){var t=$("> [role=menu]",a),e=t.find("> li:not(.divider):not(.disabled):visible > a"),i=t.find("> li:not(.divider):not(.disabled):visible .dataview"),n=t.find("> li:not(.divider):not(.disabled):visible .theme-colorpalette.focused"),o=t.find("> li:not(.divider):not(.disabled):visible ul.internal-menu");e.length>0&&i.length<1&&o.length<1&&n.length<1&&e.index(e.filter(":focus"))<0&&e.eq(0).focus()}),250))}else 37==t.keyCode?i.hasClass("dropdown-submenu")&&i.hasClass("over")&&(i.removeClass("over"),i.find("> a").focus()):(38==t.keyCode?s>0?s--:s=e.hasClass("no-cyclic")?0:o.length-1:40==t.keyCode&&(s<o.length-1?s++:s=e.hasClass("no-cyclic")?o.length-1:0),~s||(s=0),i.hasClass("dropdown-submenu")&&i.hasClass("over")&&i.addClass("focused-submenu"),checkFocusedItem(e,o.eq(s)),o.eq(s).focus())}}}}function patchDropDownKeyDownAdditional(t){if(/(38|40|27|37|39)/.test(t.keyCode)){var e=$(this);if(/(37|39)/.test(t.keyCode)||(t.preventDefault(),t.stopPropagation()),!e.is(".disabled, :disabled")){var i=getParent(e),n=i.hasClass("open")||i.hasClass("over");if(!n||n&&(27==t.keyCode||37==t.keyCode||39==t.keyCode))return n?e.click():void 0;var o=$("> [role=menu] > li:not(.divider):not(.disabled):visible",i).find("> a");if(o.length){var s=o.index(o.filter(".focus")),a=s;if(38==t.keyCode?s>0?s--:s=e.hasClass("no-cyclic")?0:o.length-1:40==t.keyCode&&(s<o.length-1?s++:s=e.hasClass("no-cyclic")?o.length-1:0),~s||(s=0),o.removeClass("focus"),o.eq(s).addClass("focus"),a!==s){var l=o.eq(a).parent().data("bs.tooltip");l&&l.hide(),(l=o.eq(s).parent().data("bs.tooltip"))&&l.show()}}}}}function getParent(t){var e=t.attr("data-target");e||(e=(e=t.attr("href"))&&/#/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""));var i=e&&$(e);return i&&i.length?i:t.parent()}function clearMenus(t){$(".dropdown-toggle").each((function(e){var i=$(this).parent();i.hasClass("open")&&("prevent-canvas-click"!=i.attr("data-value")?(i.trigger(e=$.Event("hide.bs.dropdown")),e.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",t)):i.attr("data-value",""))}))}function toggle(){$(".dropdown-backdrop").remove()}if(define("common/main/lib/view/ListSettingsDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/view/SymbolTableDialog"],(function(){"use strict";var t={none:-1,symbol:0,image:2,newSymbol:1,newImage:-2};Common.Views.ListSettingsDialog=Common.UI.Window.extend(_.extend({options:{type:0,width:285,height:261,style:"min-width: 240px;",cls:"modal-dlg",split:!1,buttons:["ok","cancel"]},initialize:function(t){this.type=t.type||0,_.extend(this.options,{title:this.txtTitle},t||{}),this.template=['<div class="box">','<div style="margin-bottom: 16px;">','<button type="button" class="btn btn-text-default auto" id="id-dlg-list-bullet" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">',this.textBulleted,"</button>",'<button type="button" class="btn btn-text-default auto" id="id-dlg-list-numbering" style="border-top-left-radius: 0;border-bottom-left-radius: 0;border-left-width: 0;margin-left: -1px;">',this.textNumbering,"</button>","</div>",'<div style="height:120px;">','<table cols="3">',"<tr>",'<td style="padding-right: 5px;padding-bottom: 8px;min-width: 50px;">','<label class="text">'+this.txtType+"</label>","</td>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 105px;">','<div id="id-dlg-list-numbering-format" class="input-group-nr" style="width: 105px;"></div>','<div id="id-dlg-list-bullet-format" class="input-group-nr" style="width: 105px;"></div>',"</td>",'<td style="padding-bottom: 8px;"></td>',"</tr>",'<tr class="image">','<td style="padding-right: 5px;padding-bottom: 8px;min-width: 50px;">','<label class="text">'+this.txtImport+"</label>","</td>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 105px;">','<div id="id-dlg-list-image" style="width: 105px;"></div>',"</td>",'<td style="padding-bottom: 8px;"></td>',"</tr>","<tr>",'<td style="padding-right: 5px;padding-bottom: 8px;min-width: 50px;">','<label class="text">'+this.txtSize+"</label>","</td>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 105px;">','<div id="id-dlg-list-size"></div>',"</td>",'<td style="padding-bottom: 8px;">','<label class="text" style="white-space: nowrap;">'+this.txtOfText+"</label>","</td>","</tr>",'<tr class="numbering">','<td style="padding-right: 5px;padding-bottom: 8px;min-width: 50px;">','<label class="text" style="white-space: nowrap;">'+this.txtStart+"</label>","</td>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 105px;">','<div id="id-dlg-list-start"></div>',"</td>",'<td style="padding-bottom: 8px;"></td>',"</tr>",'<tr class="color">','<td style="padding-right: 5px;padding-bottom: 8px;min-width: 50px;">','<label class="text">'+this.txtColor+"</label>","</td>",'<td style="padding-right: 5px;padding-bottom: 8px;width: 105px;">','<div id="id-dlg-list-color"></div>',"</td>",'<td style="padding-bottom: 8px;"></td>',"</tr>","</table>","</div>","</div>"].join(""),this.props=t.props,this.options.tpl=_.template(this.template)(this.options),this.color="000000",this.storage=!!t.storage,this.api=t.api,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this,i=this.getChild();i.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),e.btnBullet=new Common.UI.Button({el:$("#id-dlg-list-bullet"),enableToggle:!0,toggleGroup:"list-type",allowDepress:!1,pressed:!0}),e.btnBullet.on("click",_.bind(e.onListTypeClick,e,0)),e.btnNumbering=new Common.UI.Button({el:$("#id-dlg-list-numbering"),enableToggle:!0,toggleGroup:"list-type",allowDepress:!1}),e.btnNumbering.on("click",_.bind(e.onListTypeClick,e,1)),this.cmbNumFormat=new Common.UI.ComboBox({el:$("#id-dlg-list-numbering-format"),menuStyle:"min-width: 100%;max-height: 183px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{displayValue:this.txtNone,value:-1},{displayValue:"A, B, C,...",value:4},{displayValue:"a), b), c),...",value:5},{displayValue:"a, b, c,...",value:6},{displayValue:"1, 2, 3,...",value:1},{displayValue:"1), 2), 3),...",value:2},{displayValue:"I, II, III,...",value:3},{displayValue:"i, ii, iii,...",value:7}]}),this.cmbNumFormat.on("selected",_.bind((function(t,e){this._changedProps&&this._changedProps.asc_putListType(1,e.value)}),this)),this.cmbNumFormat.setValue(1);var n=["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">',"<%= item.displayValue %>",'<% if (item.value === 0) { %><span style="font-family:<%=item.font%>;"><%=item.symbol%></span>','<% } else if (item.value === 2) { %><span id="id-dlg-list-bullet-image-preview" style="width:12px; height: 12px; margin-left: 4px; margin-bottom: 1px;display: inline-block; vertical-align: middle;"></span><% } %>',"</a></li>","<% }); %>"],o=['<div class="input-group combobox input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="padding-top:3px; line-height: 14px; cursor: pointer; <%= style %>"></div>','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>','<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">'].concat(n).concat(["</ul>","</div>"]);this.cmbBulletFormat=new Common.UI.ComboBoxCustom({el:$("#id-dlg-list-bullet-format"),menuStyle:"min-width: 100%;max-height: 183px;",style:"width: 105px;",editable:!1,takeFocusOnClose:!0,template:_.template(o.join("")),itemsTemplate:_.template(n.join("")),data:[{displayValue:this.txtNone,value:t.none},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"•",font:"Arial"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"o",font:"Courier New"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"§",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"v",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"Ø",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"ü",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"w",font:"Wingdings"},{displayValue:this.txtSymbol+": ",value:t.symbol,symbol:"–",font:"Arial"},{displayValue:this.txtNewBullet,value:t.newSymbol},{displayValue:this.txtNewImage,value:t.newImage}],updateFormControl:function(i){var n=$(this.el).find(".form-control");if(i)if(i.get("value")===t.symbol)n[0].innerHTML=i.get("displayValue")+'<span style="font-family:'+(i.get("font")||"Arial")+'">'+i.get("symbol")+"</span>";else if(i.get("value")===t.image){n[0].innerHTML=i.get("displayValue")+'<span id="id-dlg-list-bullet-combo-preview" style="width:12px; height: 12px; margin-left: 2px; margin-bottom: 1px;display: inline-block; vertical-align: middle;"></span>';var o=new Asc.asc_CBullet;o.asc_fillBulletImage(e.imageProps.id),o.drawSquareImage("id-dlg-list-bullet-combo-preview")}else i.get("value")===t.newImage?n[0].innerHTML=e.txtImage:n[0].innerHTML=i.get("displayValue");else n[0].innerHTML=""}});var s=this.cmbBulletFormat.store.at(1);this.cmbBulletFormat.selectRecord(s),this.bulletProps={symbol:s.get("symbol"),font:s.get("font")},this.cmbBulletFormat.on("selected",_.bind((function(e,i){if(this.imageControls.toggleClass("hidden",!(i.value===t.image||i.value===t.newImage)),this.colorControls.toggleClass("hidden",i.value===t.image||i.value===t.newImage),i.value===t.newSymbol){var n=this,o=n.bulletProps,s=function(i,s,a){"ok"==s&&(o.changed=!0,o.code=a.code,o.font=a.font,o.symbol=a.symbol,n._changedProps&&(n._changedProps.asc_putFont(o.font),n._changedProps.asc_putSymbol(o.symbol)));var l=e.store;if(!l.findWhere({value:t.symbol,symbol:o.symbol,font:o.font})){var r=l.indexOf(l.findWhere({value:t.image}));r<0&&(r=l.indexOf(l.findWhere({value:t.newSymbol}))),l.add({displayValue:n.txtSymbol+": ",value:t.symbol,symbol:o.symbol,font:o.font},{at:r})}n.imageProps&&(n.imageProps.redraw=!0),e.setData(l.models),e.selectRecord(e.store.findWhere({value:t.symbol,symbol:o.symbol,font:o.font}))},a=new Common.Views.SymbolTableDialog({api:n.options.api,lang:n.options.interfaceLang,modal:!0,type:0,font:o.font,symbol:o.symbol,handler:s});a.show(),a.on("symbol:dblclick",s)}else i.value==t.newImage||(i.value==t.image?this._changedProps&&this._changedProps.asc_fillBulletImage(this.imageProps.id):i.value==t.none?this._changedProps&&this._changedProps.asc_putListType(0,i.value):(this.bulletProps.changed=!0,this.bulletProps.code=i.code,this.bulletProps.font=i.font,this.bulletProps.symbol=i.symbol,this._changedProps&&(this._changedProps.asc_putFont(this.bulletProps.font),this._changedProps.asc_putSymbol(this.bulletProps.symbol))));this.btnOk.setDisabled(i.value===t.newImage)}),this)),this.cmbBulletFormat.on("show:after",_.bind(this.onBulletFormatOpen,this)),this.spnSize=new Common.UI.MetricSpinner({el:i.find("#id-dlg-list-size"),step:1,width:105,value:100,defaultUnit:"",maxValue:400,minValue:25,allowDecimal:!1}).on("change",(function(t,i,n,o){e._changedProps&&e._changedProps.asc_putSize(t.getNumberValue())})),this.btnColor=new Common.UI.ColorButton({parentEl:i.find("#id-dlg-list-color"),style:"width:45px;",additionalAlign:this.menuAddAlign,color:this.color,cls:"move-focus",takeFocusOnClose:!0}),this.btnColor.on("color:select",_.bind(this.onColorsSelect,this)),this.colors=this.btnColor.getPicker(),this.spnStart=new Common.UI.MetricSpinner({el:i.find("#id-dlg-list-start"),step:1,width:105,value:1,defaultUnit:"",maxValue:32767,minValue:1,allowDecimal:!1}).on("change",(function(t,i,n,o){e._changedProps&&e._changedProps.asc_putNumStartAt(t.getNumberValue())})),this.btnSelectImage=new Common.UI.Button({parentEl:$("#id-dlg-list-image"),cls:"btn-text-menu-default",caption:this.textSelect,style:"width: 100%;",menu:new Common.UI.Menu({style:"min-width: 105px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:[{caption:this.textFromFile,value:0},{caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]})}),this.btnSelectImage.menu.on("item:click",_.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.storage),this.btnOk=new Common.UI.Button({el:i.find(".primary")}),e.numberingControls=i.find("tr.numbering"),e.imageControls=i.find("tr.image"),e.colorControls=i.find("tr.color");var a=i.find("table tr:first() td:first()");a.width(Math.max(i.find(".numbering .text").width(),a.width())),this.afterRender()},getFocusedComponents:function(){return[this.cmbNumFormat,this.cmbBulletFormat,this.btnSelectImage,this.spnSize,this.spnStart,this.btnColor]},afterRender:function(){this.updateThemeColors(),this._setDefaults(this.props);var e=this,i=function(i){e.imageProps={id:i.asc_getImageId(),redraw:!0},e._changedProps&&e._changedProps.asc_fillBulletImage(e.imageProps.id);var n=e.cmbBulletFormat.store;if(!n.findWhere({value:t.image})){var o=n.indexOf(n.findWhere({value:t.newSymbol}));n.add({displayValue:e.txtImage+":",value:t.image},{at:o})}e.cmbBulletFormat.setData(n.models),e.cmbBulletFormat.selectRecord(e.cmbBulletFormat.store.findWhere({value:t.image})),e.btnOk.setDisabled(!1)};this.api.asc_registerCallback("asc_onBulletImageLoaded",i);var n=function(t){t&&t._urls&&"bullet"==t.c&&(new Asc.asc_CBullet).asc_putImageUrl(t._urls[0],t.token)};Common.NotificationCenter.on("storage:image-insert",n),this.on("close",(function(t){e.api.asc_unregisterCallback("asc_onBulletImageLoaded",i),Common.NotificationCenter.off("storage:image-insert",n)}))},onBulletFormatOpen:function(e){if(e.store.findWhere({value:t.image})&&this.imageProps.redraw){var i=new Asc.asc_CBullet;i.asc_fillBulletImage(this.imageProps.id),i.drawSquareImage("id-dlg-list-bullet-image-preview"),this.imageProps.redraw=!1}},updateThemeColors:function(){this.colors.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},onColorsSelect:function(t,e){this.color=e,this._changedProps&&this._changedProps.asc_putColor(Common.Utils.ThemeColor.getRgbColor(e))},onListTypeClick:function(t,e,i){this.ShowHideElem(t)},ShowHideElem:function(e){var i=0==e&&(this.cmbBulletFormat.getValue()===t.image||this.cmbBulletFormat.getValue()===t.newImage||(void 0===this.cmbBulletFormat.getValue()||""===this.cmbBulletFormat.getValue())&&this.originalType===AscFormat.BULLET_TYPE_BULLET_BLIP);this.numberingControls.toggleClass("hidden",0==e),this.imageControls.toggleClass("hidden",!i),this.colorControls.toggleClass("hidden",i),this.cmbNumFormat.setVisible(1==e),this.cmbBulletFormat.setVisible(0==e),this.btnOk.setDisabled(i&&this.cmbBulletFormat.getValue()===t.newImage);var n=this;_.delay((function(){e?n.cmbNumFormat.focus():n.cmbBulletFormat.focus()}),50)},_handleInput:function(e){if(this.options.handler){if("ok"==e&&this.btnOk.isDisabled())return;var i=this.btnBullet.pressed?0:1;this.originalType==AscFormat.BULLET_TYPE_BULLET_NONE&&(this._changedProps=new Asc.asc_CBullet,this._changedProps.asc_putSize(this.spnSize.getNumberValue()),0==i&&this.cmbBulletFormat.getValue()===t.image&&this.imageProps?this._changedProps.asc_fillBulletImage(this.imageProps.id):this._changedProps.asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.color))),(this.originalType==AscFormat.BULLET_TYPE_BULLET_NONE||(this.originalType==AscFormat.BULLET_TYPE_BULLET_CHAR||this.originalType==AscFormat.BULLET_TYPE_BULLET_BLIP)&&1==i||this.originalType==AscFormat.BULLET_TYPE_BULLET_AUTONUM&&0==i)&&(0==i?this.cmbBulletFormat.getValue()==t.none?this._changedProps.asc_putListType(0,-1):this.cmbBulletFormat.getValue()==t.image||(this._changedProps.asc_putFont(this.bulletProps.font),this._changedProps.asc_putSymbol(this.bulletProps.symbol)):(this._changedProps.asc_putListType(1,this.cmbNumFormat.getValue()),this._changedProps.asc_putNumStartAt(this.spnStart.getNumberValue()))),this.options.handler.call(this,e,this._changedProps)}this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_setDefaults:function(e){if(e){var i=0,n=e.asc_getBullet();if(n){this.originalType=n.asc_getType(),this.spnSize.setValue(n.asc_getSize()||"",!0);var o=n.asc_getColor();if(o=o?o.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b()),effectValue:o.get_value()}:Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b()):"transparent",this.color=Common.Utils.ThemeColor.colorValue2EffectId(o),this.btnColor.setColor(o),"object"==typeof o){for(var s=!1,a=0;a<10;a++)if(Common.Utils.ThemeColor.ThemeValues[a]==o.effectValue){this.colors.select(o,!0),s=!0;break}s||this.colors.clearSelection()}else this.colors.select(o,!0);if(this.originalType==AscFormat.BULLET_TYPE_BULLET_NONE)this.cmbNumFormat.setValue(-1),this.cmbBulletFormat.setValue(t.none),i=this.type;else if(this.originalType==AscFormat.BULLET_TYPE_BULLET_CHAR){var l=n.asc_getSymbol();l?(this.bulletProps={symbol:l,font:n.asc_getFont()},this.cmbBulletFormat.store.findWhere({value:t.symbol,symbol:this.bulletProps.symbol,font:this.bulletProps.font})||this.cmbBulletFormat.store.add({displayValue:this.txtSymbol+": ",value:t.symbol,symbol:this.bulletProps.symbol,font:this.bulletProps.font},{at:this.cmbBulletFormat.store.length-2}),this.cmbBulletFormat.setData(this.cmbBulletFormat.store.models),this.cmbBulletFormat.selectRecord(this.cmbBulletFormat.store.findWhere({value:t.symbol,symbol:this.bulletProps.symbol,font:this.bulletProps.font}))):this.cmbBulletFormat.setValue(""),this._changedProps=n,i=0}else if(this.originalType==AscFormat.BULLET_TYPE_BULLET_BLIP){var r=n.asc_getImageId();r?(this.imageProps={id:r,redraw:!0},this.cmbBulletFormat.store.findWhere({value:t.image})||this.cmbBulletFormat.store.add({displayValue:this.txtImage+":",value:t.image},{at:this.cmbBulletFormat.store.length-2}),this.cmbBulletFormat.setData(this.cmbBulletFormat.store.models),this.cmbBulletFormat.selectRecord(this.cmbBulletFormat.store.findWhere({value:t.image}))):this.cmbBulletFormat.setValue(""),this._changedProps=n,i=0}else if(this.originalType==AscFormat.BULLET_TYPE_BULLET_AUTONUM){var c=n.asc_getAutoNumType();this.cmbNumFormat.setValue(c,"");var d=n.asc_getNumStartAt();this.spnStart.setValue(d||"",!0),this.spnStart.setDisabled(null===d),this._changedProps=n,i=1}}else this.cmbNumFormat.setValue(-1),this.cmbBulletFormat.setValue(t.none),this._changedProps=new Asc.asc_CBullet,i=this.type}1==i?this.btnNumbering.toggle(!0):this.btnBullet.toggle(!0),this.ShowHideElem(i)},onImageSelect:function(t,e){if(1==e.value){new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t){var i=e.replace(/ /g,"");_.isEmpty(i)||(new Asc.asc_CBullet).asc_putImageUrl(i)}}}).show()}else 2==e.value?Common.NotificationCenter.trigger("storage:image-load","bullet"):(new Asc.asc_CBullet).asc_showFileDialog()},txtTitle:"List Settings",txtSize:"Size",txtColor:"Color",txtOfText:"% of text",txtStart:"Start at",textBulleted:"Bulleted",textNumbering:"Numbered",txtType:"Type",txtNone:"None",txtNewBullet:"New bullet",txtSymbol:"Symbol",txtNewImage:"New image",txtImage:"Image",txtImport:"Import",textSelect:"Select From",textFromUrl:"From URL",textFromFile:"From File",textFromStorage:"From Storage"},Common.Views.ListSettingsDialog||{}))})),$(document).off("keydown.bs.dropdown.data-api").on("keydown.bs.dropdown.data-api","[data-toggle=dropdown], [role=menu]",onDropDownKeyDown),"ontouchstart"in document.documentElement&&$(document).on("click.bs.dropdown.data-api","[data-toggle=dropdown]",toggle),function(){var t,e=$._data($(document).get(0),"events");e&&e.click&&e.click.every((function(e,i,n){return/click/.test(e.type)&&!e.selector&&/bs\..+\.dropdown/.test(e.namespace)&&(t=e.handler),!t})),t&&$(document).off("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",(function(t){1!=t.which&&null!=t.which||clearMenus(/form-control/.test(t.target.className))}))}(),define("common/main/lib/extend/Bootstrap",(function(){})),void 0===Common)var Common={};if(define("common/main/lib/component/MenuItem",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],(function(){"use strict";Common.UI.MenuItem=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,checkable:!1,checked:!1,allowDepress:!1,disabled:!1,visible:!0,value:null,toggleGroup:null,iconCls:"",menu:null,canFocused:!0,dataHint:"",dataHintDirection:"",dataHintOffset:"",dataHintTitle:""},tagName:"li",template:_.template(['<a id="<%= id %>" style="<%= style %>" <% if(options.canFocused) { %> tabindex="-1" type="menuitem" <% }; if(!_.isUndefined(options.stopPropagation)) { %> data-stopPropagation="true" <% }; if(!_.isUndefined(options.dataHint)) { %> data-hint="<%= options.dataHint %>" <% }; if(!_.isUndefined(options.dataHintDirection)) { %> data-hint-direction="<%= options.dataHintDirection %>" <% }; if(!_.isUndefined(options.dataHintOffset)) { %> data-hint-offset="<%= options.dataHintOffset %>" <% }; if(options.dataHintTitle) { %> data-hint-title="<%= options.dataHintTitle %>" <% }; %> >',"<% if (!_.isEmpty(iconCls)) { %>",'<span class="menu-item-icon <%= iconCls %>"></span>',"<% } %>","<%= caption %>","</a>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.caption=e.options.caption,this.menu=e.options.menu||null,this.checkable=e.options.checkable,this.checked=e.options.checked,e.allowDepress=e.options.allowDepress,this.disabled=e.options.disabled,this.visible=e.options.visible,this.value=e.options.value,this.toggleGroup=e.options.toggleGroup,this.template=e.options.template||this.template,this.iconCls=e.options.iconCls,this.hint=e.options.hint,this.rendered=!1,null===this.menu||this.menu instanceof Common.UI.Menu||this.menu instanceof Common.UI.MenuSimple||(this.menu=new Common.UI.Menu(_.extend({},e.options.menu))),e.options.el&&this.render()},render:function(){var t=this,e=t.$el||$(this.el);if(t.trigger("render:before",t),"--"===t.caption)e.addClass("divider");else if(!this.rendered){e.off("click"),Common.UI.ToggleManager.unregister(t),e.html(this.template({id:t.id,caption:t.caption,iconCls:t.iconCls,style:t.style,options:t.options})),t.menu&&(e.addClass("dropdown-submenu"),t.menu.render(e),e.mouseenter(_.bind(t.menu.alignPosition,t.menu)),e.focusout(_.bind(t.onBlurItem,t)),e.hover(_.bind(t.onHoverItem,t),_.bind(t.onUnHoverItem,t)));var i=e.children(":first");this.checkable&&i&&(i.toggleClass("checkable",this.checkable),i.toggleClass("no-checkmark",!1===this.options.checkmark),i.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||i.css("background-image","none")),t.options.hint&&(e.attr("data-toggle","tooltip"),e.tooltip({title:t.options.hint,placement:t.options.hintAnchor||function(t,e){var i=this.getPosition(),n=t.offsetWidth,o=t.offsetHeight,s=Common.Utils.innerWidth(),a=Common.Utils.innerHeight(),l=i.top,r=i.left+i.width+2;l+o>a&&(l=a-o-2),r+n>s&&(r=i.left-n-2),$(t).offset({top:l,left:r}).addClass("in")}})),this.cls&&e.addClass(this.cls),this.disabled&&e.toggleClass("disabled",this.disabled),e.on("click",_.bind(this.onItemClick,this)),e.on("mousedown",_.bind(this.onItemMouseDown,this)),Common.UI.ToggleManager.register(t)}return this.visible||this.setVisible(this.visible),t.cmpEl=e,t.rendered=!0,t.trigger("render:after",t),this},setCaption:function(t,e){this.caption=t,this.rendered&&(this.cmpEl.find("a").contents().last()[0].textContent=e?t:Common.Utils.String.htmlEncode(t))},setIconCls:function(t){if(this.rendered&&!_.isEmpty(this.iconCls)){var e=this.cmpEl.children(":first");e&&e.find(".menu-item-icon").removeClass(this.iconCls).addClass(t)}this.iconCls=t},setChecked:function(t,e){this.toggle(t,e)},isChecked:function(){return this.checked},setDisabled:function(t){this.disabled=!!t,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},toggle:function(t,e){var i=void 0===t?!this.checked:!!t;if(this.checkable){if(this.checked=i,this.rendered){var n=this.cmpEl.children(":first");n&&(n.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||n.css("background-image","none"))}e||this.trigger("toggle",this,i)}},onItemMouseDown:function(t){if(Common.UI.HintManager&&Common.UI.HintManager.clearHints(),1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation()},onItemClick:function(t){return(1==t.which||void 0===t.which&&!this.menu)&&(this.disabled||!this.allowDepress&&this.checked&&this.toggleGroup||this.menu||this.setChecked(!this.checked),this.menu?t.target.id!=this.id&&void(this.menu.isOver||this.cmpEl.removeClass("over")):!this.disabled&&void this.trigger("click",this,t))},onHoverItem:function(t){this._doHover(t)},onUnHoverItem:function(t){this._doUnHover(t)},onBlurItem:function(t){this._doUnHover(t)},_doHover:function(t){var e=this;e.menu&&!e.disabled&&(clearTimeout(e.hideMenuTimer),e.cmpEl.trigger("show.bs.dropdown"),e.expandMenuTimer=_.delay((function(){e.cmpEl.addClass("over"),e.cmpEl.trigger("shown.bs.dropdown")}),200))},_doUnHover:function(t){var e=this;if(e.cmpEl.hasClass("dropdown-submenu")&&e.cmpEl.hasClass("over")&&(t&&t.relatedTarget&&e.cmpEl.find(t.relatedTarget).length>0||e.cmpEl.hasClass("focused-submenu")))e.cmpEl.removeClass("focused-submenu");else if(e.menu&&!e.disabled&&(clearTimeout(e.expandMenuTimer),e.hideMenuTimer=_.delay((function(){e.menu.isOver||e.cmpEl.removeClass("over")}),200),t&&"focusout"!==t.type)){var i=e.cmpEl.children(":focus");i.length>0&&(i.blur(),e.cmpEl.closest("ul").focus())}}}),Common.UI.MenuItemSeparator=function(t){return(t=t||{}).caption="--",new Common.UI.MenuItem(t)}})),function(t){"function"==typeof define&&define.amd?define("jmousewheel",["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}((function(t){var e,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(t.event.fixHooks)for(var a=n.length;a;)t.event.fixHooks[n[--a]]=t.event.mouseHooks;var l=t.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var e=o.length;e;)this.addEventListener(o[--e],r,!1);else this.onmousewheel=r;t.data(this,"mousewheel-line-height",l.getLineHeight(this)),t.data(this,"mousewheel-page-height",l.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=o.length;t;)this.removeEventListener(o[--t],r,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(t(e)["offsetParent"in t.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0}};function r(n){var o=n||window.event,a=s.call(arguments,1),l=0,r=0,h=0,p=0;if((n=t.event.fix(o)).type="mousewheel","detail"in o&&(h=-1*o.detail),"wheelDelta"in o&&(h=o.wheelDelta),"wheelDeltaY"in o&&(h=o.wheelDeltaY),"wheelDeltaX"in o&&(r=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(r=-1*h,h=0),l=0===h?r:h,"deltaY"in o&&(l=h=-1*o.deltaY),"deltaX"in o&&(r=o.deltaX,0===h&&(l=-1*r)),0!==h||0!==r){if(1===o.deltaMode){var m=t.data(this,"mousewheel-line-height");l*=m,h*=m,r*=m}else if(2===o.deltaMode){var u=t.data(this,"mousewheel-page-height");l*=u,h*=u,r*=u}return p=Math.max(Math.abs(h),Math.abs(r)),(!i||p<i)&&(i=p,d(o,p)&&(i/=40)),d(o,p)&&(l/=40,r/=40,h/=40),l=Math[l>=1?"floor":"ceil"](l/i),r=Math[r>=1?"floor":"ceil"](r/i),h=Math[h>=1?"floor":"ceil"](h/i),n.deltaX=r,n.deltaY=h,n.deltaFactor=i,n.deltaMode=0,a.unshift(n,l,r,h),e&&clearTimeout(e),e=setTimeout(c,200),(t.event.dispatch||t.event.handle).apply(this,a)}}function c(){i=null}function d(t,e){return l.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})})),function(t){"use strict";"function"==typeof define&&define.amd?define("perfectscrollbar",["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}((function(t){"use strict";var e,i={wheelSpeed:10,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1,includeMargin:!0},n=(e=0,function(){var t=e;return e+=1,".perfect-scrollbar-"+t});t.fn.perfectScrollbar=function(e,o){return this.each((function(){var s=t.extend(!0,{},i),a=t(this);if("object"==typeof e?t.extend(!0,s,e):o=e,"update"===o)return a.data("perfect-scrollbar-update")&&a.data("perfect-scrollbar-update")(),a;if("destroy"===o)return a.data("perfect-scrollbar-destroy")&&a.data("perfect-scrollbar-destroy")(),a;if(a.data("perfect-scrollbar"))return a.data("perfect-scrollbar");a.addClass("ps-container oo");var l,r,c,d,h,p,m,u,g,f,b,C,v,_,x,y,w,S,A,k,T,I,E,D,P=t("<div class='ps-scrollbar-x-rail'></div>").appendTo(a),F=t("<div class='ps-scrollbar-y-rail'></div>").appendTo(a),R=t("<div class='ps-scrollbar-x'></div>").appendTo(P),V=t("<div class='ps-scrollbar-y'></div>").appendTo(F),M=parseInt(P.css("bottom"),10),U=parseInt(F.css("right"),10),L=n(),B=function(t){return s.minScrollbarLength&&(t=Math.max(t,s.minScrollbarLength)),t},O=function(){P.css({left:a.scrollLeft(),bottom:M-a.scrollTop(),width:g,display:l?"inherit":"none"}),F.hasClass("in-scrolling")?F.css({right:U-a.scrollLeft(),height:C,display:r?"inherit":"none"}):F.css({top:a.scrollTop(),right:U-a.scrollLeft(),height:C,display:r?"inherit":"none"}),R&&R.css({left:u,width:m}),V&&V.css({top:b,height:f})},N=function(){c=s.includePadding?a.innerWidth():a.width(),d=s.includePadding?a.innerHeight():a.height(),C=d-(s.includeMargin?parseInt(F.css("margin-top"))+parseInt(F.css("margin-bottom")):0),g=c-(s.includeMargin?parseInt(P.css("margin-left"))+parseInt(P.css("margin-right")):0),h=a.prop("scrollWidth"),p=a.prop("scrollHeight"),!s.suppressScrollX&&c+s.scrollXMarginOffset<h?(l=!0,m=B(parseInt(g*c/h,10)),u=parseInt(a.scrollLeft()*(g-m)/(h-c),10)):(l=!1,m=0,u=0,a.scrollLeft(0)),!s.suppressScrollY&&d+s.scrollYMarginOffset<p?(r=!0,f=B(parseInt(C*d/p,10)),b=parseInt(a.scrollTop()*(C-f)/(p-d),10)):(r=!1,f=0,b=0,a.scrollTop(0)),b>=C-f&&(b=C-f),u>=g-m&&(u=g-m),O(),s.onChange&&s.onChange(this)},H=function(){var e,i;R.bind("mousedown"+L,(function(t){Common.NotificationCenter.trigger("hints:clear"),i=t.pageX,e=R.position().left,P.addClass("in-scrolling"),t.stopPropagation(),t.preventDefault()})),t(document).bind("mousemove"+L,(function(t){P.hasClass("in-scrolling")&&(!function(t,e){var i=t+e,n=g-m;u=i<0?0:i>n?n:i;var o=parseInt(u*(h-c)/(g-m),10);a.scrollLeft(o),F.css({right:U-o})}(e,t.pageX-i),t.stopPropagation(),t.preventDefault())})),t(document).bind("mouseup"+L,(function(t){P.hasClass("in-scrolling")&&P.removeClass("in-scrolling")})),e=i=null},$=function(){var e,i;V.bind("mousedown"+L,(function(t){Common.NotificationCenter.trigger("hints:clear"),i=t.pageY,e=V.position().top,F.addClass("in-scrolling");var n=parseInt(F.css("margin-top")),o=F[0].getBoundingClientRect();F.css({position:"fixed",left:o.left,top:o.top-n}),t.stopPropagation(),t.preventDefault()})),t(document).bind("mousemove"+L,(function(t){F.hasClass("in-scrolling")&&(!function(t,e){var i=t+e,n=C-f;b=i<0?0:i>n?n:i;var o=parseInt(b*(p-d)/(C-f),10);a.scrollTop(o),P.css({bottom:M-o})}(e,t.pageY-i),t.stopPropagation(),t.preventDefault())})),t(document).bind("mouseup"+L,(function(t){F.hasClass("in-scrolling")&&(F.removeClass("in-scrolling"),F.css({position:"",left:"",top:""}),O())})),e=i=null},G=function(t,e){var i=a.scrollTop();if(0===t){if(!r)return!1;if(0===i&&e>0||i>=p-d&&e<0)return!s.wheelPropagation}var n=a.scrollLeft();if(0===e){if(!l)return!1;if(0===n&&t<0||n>=h-c&&t>0)return!s.wheelPropagation}return!0},z=function(){a.unbind(L),t(window).unbind(L),t(document).unbind(L),a.data("perfect-scrollbar",null),a.data("perfect-scrollbar-update",null),a.data("perfect-scrollbar-destroy",null),R.remove(),V.remove(),P.remove(),F.remove(),R=V=c=d=h=p=m=u=M=f=b=U=null},W="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;return(D=navigator.userAgent.toLowerCase().match(/(msie) ([\w.]+)/))&&"msie"===D[1]&&(v=parseInt(D[2],10),a.addClass("ie").addClass("ie"+v),6===v&&(_=function(){t(this).addClass("hover")},x=function(){t(this).removeClass("hover")},a.bind("mouseenter"+L,_).bind("mouseleave"+L,x),P.bind("mouseenter"+L,_).bind("mouseleave"+L,x),F.bind("mouseenter"+L,_).bind("mouseleave"+L,x),R.bind("mouseenter"+L,_).bind("mouseleave"+L,x),V.bind("mouseenter"+L,_).bind("mouseleave"+L,x),O=function(){R.css({left:u+a.scrollLeft(),bottom:M,width:m}),V.css({top:b+a.scrollTop(),right:U,height:f}),R.hide().show(),V.hide().show()})),N(),a.bind("scroll"+L,(function(t){N()})),H(),$(),y=function(t){t.stopPropagation()},V.bind("click"+L,y),F.bind("click"+L,(function(t){var e=parseInt(f/2,10),i=(t.pageY-F.offset().top-e)/(C-f);i<0?i=0:i>1&&(i=1),a.scrollTop((p-d)*i)})),R.bind("click"+L,y),P.bind("click"+L,(function(t){var e=parseInt(m/2,10),i=(t.pageX-P.offset().left-e)/(g-m);i<0?i=0:i>1&&(i=1),a.scrollLeft((h-c)*i)})),W&&(w=function(t,e){a.scrollTop(a.scrollTop()-e),a.scrollLeft(a.scrollLeft()-t),N()},S={},A=0,k={},T=null,I=!1,t(window).bind("touchstart"+L,(function(t){I=!0})),t(window).bind("touchend"+L,(function(t){I=!1})),a.bind("touchstart"+L,(function(t){var e=t.originalEvent.targetTouches[0];S.pageX=e.pageX,S.pageY=e.pageY,A=(new Date).getTime(),null!==T&&clearInterval(T),t.stopPropagation()})),a.bind("touchmove"+L,(function(t){if(!I&&1===t.originalEvent.targetTouches.length){var e=t.originalEvent.targetTouches[0],i={};i.pageX=e.pageX,i.pageY=e.pageY;var n=i.pageX-S.pageX,o=i.pageY-S.pageY;w(n,o),S=i;var s=(new Date).getTime(),a=s-A;a>0&&(k.x=n/a,k.y=o/a,A=s),t.preventDefault()}})),a.bind("touchend"+L,(function(t){clearInterval(T),T=setInterval((function(){Math.abs(k.x)<.01&&Math.abs(k.y)<.01?clearInterval(T):(w(30*k.x,30*k.y),k.x*=.8,k.y*=.8)}),10)}))),a.mousewheel&&function(){s.wheelSpeed/=10;var e=!1;a.bind("mousewheel"+L,(function(i,n,o,c){Common.NotificationCenter.trigger("hints:clear");var d=i.deltaX*i.deltaFactor||o,h=i.deltaY*i.deltaFactor||c;if(i&&i.target&&("textarea"===i.target.type||"input"===i.target.type)){i.stopImmediatePropagation(),i.preventDefault();var p=t(i.target).scrollTop(),m=0;return i.originalEvent?i.originalEvent.wheelDelta?m=i.originalEvent.wheelDelta:i.originalEvent.deltaY?m=40*-i.originalEvent.deltaY:i.originalEvent.detail&&(m=i.originalEvent.detail):m=void 0!==i.wheelDelta?i.wheelDelta:i.deltaY,void t(i.target).scrollTop(p-m)}e=!1,s.useBothWheelAxes?r&&!l?(h?a.scrollTop(a.scrollTop()-h*s.wheelSpeed):a.scrollTop(a.scrollTop()+d*s.wheelSpeed),e=!0):l&&!r&&(d?a.scrollLeft(a.scrollLeft()+d*s.wheelSpeed):a.scrollLeft(a.scrollLeft()-h*s.wheelSpeed),e=!0):(a.scrollTop(a.scrollTop()-h*s.wheelSpeed),a.scrollLeft(a.scrollLeft()+d*s.wheelSpeed)),N(),(e=e||G(d,h))&&(i.stopPropagation(),i.preventDefault())})),a.bind("MozMousePixelScroll"+L,(function(t){e&&t.preventDefault()}))}(),s.useKeyboard&&(E=!1,a.bind("mouseenter"+L,(function(t){E=!0})),a.bind("mouseleave"+L,(function(t){E=!1})),t(document).bind("keydown"+L,(function(e){if(E&&!t(document.activeElement).is(":input,[contenteditable]")){var i=0,n=0;switch(e.which){case 37:i=-30;break;case 38:n=30;break;case 39:i=30;break;case 40:n=-30;break;case 33:n=90;break;case 32:case 34:n=-90;break;case 35:n=-d;break;case 36:n=d;break;default:return}a.scrollTop(a.scrollTop()-n),a.scrollLeft(a.scrollLeft()+i),G(i,n)&&e.preventDefault()}}))),a.data("perfect-scrollbar",a),a.data("perfect-scrollbar-update",N),a.data("perfect-scrollbar-destroy",z),a}))}})),void 0===Common)var Common={};if(define("common/main/lib/component/Scroller",["jmousewheel","perfectscrollbar","common/main/lib/component/BaseView"],(function(){"use strict";var t;Common.UI.Scroller=_.extend(Common.UI.BaseView.extend({options:{wheelSpeed:20,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:5,scrollYMarginOffset:5,includePadding:!0,includeMargin:!0,alwaysVisibleX:!1,alwaysVisibleY:!1},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.options.el&&this.render()},render:function(){var t=this;return t.cmpEl=t.$el||$(this.el),t.rendered||(t.cmpEl.perfectScrollbar(_.extend({},t.options)),t.rendered=!0,this.setAlwaysVisibleX(t.options.alwaysVisibleX),this.setAlwaysVisibleY(t.options.alwaysVisibleY)),this},remove:function(){this.destroy(),Backbone.View.prototype.remove.call(this)},update:function(e){var i=this.options;e?(this.destroy(),i=_.extend(this.options,e),this.cmpEl.perfectScrollbar(i)):this.cmpEl.perfectScrollbar("update"),this.setAlwaysVisibleX(i.alwaysVisibleX),this.setAlwaysVisibleY(i.alwaysVisibleY);var n=function(e){t=!0;var i=function(e){$(document).unbind("mouseup",i),_.delay((function(){t=!1}),10)};$(document).mouseup(i)};$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail, .ps-scrollbar-x, .ps-scrollbar-y",this.cmpEl).off("mousedown",n).on("mousedown",n)},destroy:function(){this.cmpEl.perfectScrollbar("destroy")},scrollLeft:function(t){this.cmpEl.scrollLeft(t),this.update()},scrollTop:function(t){this.cmpEl.scrollTop(t),this.update()},getScrollTop:function(){return this.cmpEl.scrollTop()},getScrollLeft:function(){return this.cmpEl.scrollLeft()},setAlwaysVisibleX:function(t){t?($(this.el).find(".ps-scrollbar-x-rail").addClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x")):($(this.el).find(".ps-scrollbar-x-rail").removeClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x"))},setAlwaysVisibleY:function(t){t?($(this.el).find(".ps-scrollbar-y-rail").addClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y")):($(this.el).find(".ps-scrollbar-y-rail").removeClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y"))},isVisible:function(){return $(this.el).find(".ps-scrollbar-y-rail").is(":visible")}}),{isMouseCapture:function(){return t}})})),void 0===Common)var Common={};if(define("common/main/lib/component/Menu",["common/main/lib/extend/Bootstrap","common/main/lib/component/BaseView","common/main/lib/component/MenuItem","common/main/lib/component/Scroller"],(function(){"use strict";var t,e,i;Common.UI.Menu=(t=[],e={},i={register:function(i){e[i.id]=i,i.on("show:after",(function(e){t.push(e)})).on("hide:after",(function(e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}))},unregister:function(i){var n=t.indexOf(i);delete e[i.id],n>-1&&t.splice(n,1),i.off("show:after").off("hide:after")},hideAll:function(){return Common.NotificationCenter.trigger("menumanager:hideall"),!!(t&&t.length>0)&&(_.each(t,(function(t){t&&t.hide()})),!0)}},_.extend(Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0],cyclic:!0,search:!1,scrollAlwaysVisible:!0},template:_.template(['<ul class="dropdown-menu <%= options.cls %>" oo_editor_input="true" style="<%= options.style %>" role="menu"></ul>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||Common.UI.MenuItem.prototype.template,this.rendered=!1,this.items=[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,this.scrollAlwaysVisible=this.options.scrollAlwaysVisible,this.search=this.options.search,this.outerMenu=this.options.outerMenu,this.options.restoreHeight&&(this.options.restoreHeight="number"==typeof this.options.restoreHeight?this.options.restoreHeight:this.options.maxHeight?this.options.maxHeight:1e5,!this.options.maxHeight&&(this.options.maxHeight=this.options.restoreHeight)),this.options.cyclic||(this.options.cls+=" no-cyclic"),_.each(this.options.items,(function(t){t instanceof Common.UI.MenuItem?e.items.push(t):e.items.push(new Common.UI.MenuItem(_.extend({tagName:"li",template:e.itemTemplate},t)))})),this.options.el&&this.render(),i.register(this)},remove:function(){i.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(t){var e=this;this.trigger("render:before",this),this.cmpEl=e.$el||$(this.el),t?(this.setElement(t,!1),e.rendered||(this.cmpEl=$(this.template({options:e.options})),t.append(this.cmpEl))):e.rendered||(this.cmpEl=this.template({options:e.options}),this.$el.append(this.cmpEl));var i=this.cmpEl.parent(),n="menu"===i.attr("role")?i:i.find("[role=menu]");return this.menuRoot=n,n&&(e.rendered||_.each(e.items||[],(function(t){n.append(t.render().el),t.on("click",_.bind(e.onItemClick,e)),t.on("toggle",_.bind(e.onItemToggle,e))})),this.options.maxHeight&&(n.css({"max-height":e.options.maxHeight}),this.scroller=new Common.UI.Scroller({el:e.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),n.css({position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=n.parent(),this.parentEl.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),this.parentEl.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),this.parentEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),this.parentEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),this.parentEl.on("keydown.before.bs.dropdown",_.bind(e.onBeforeKeydownMenu,e)),this.options.innerMenus&&this.on("keydown:before",_.bind(e.onBeforeKeyDown,e)),n.hover((function(t){e.isOver=!0}),(function(t){e.isOver=!1}))),this.rendered=!0,this.trigger("render:after",this),this},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&(this.parentEl.hasClass("open")?this.cmpEl.dropdown("toggle"):this.parentEl.hasClass("over")&&this.parentEl.removeClass("over"))},insertItem:function(t,e){var i=this;if(this.cmpEl,e instanceof Common.UI.MenuItem||(e=new Common.UI.MenuItem(_.extend({tagName:"li",template:i.itemTemplate},e))),t<0||t>=i.items.length?i.items.push(e):i.items.splice(t,0,e),this.rendered){var n=this.menuRoot;n&&(t<0?n.append(e.render().el):0===t?n.prepend(e.render().el):n.children("li:nth-child("+(t+1)+")").before(e.render().el),e.on("click",_.bind(i.onItemClick,i)),e.on("toggle",_.bind(i.onItemToggle,i)))}},addItem:function(t){this.insertItem(-1,t)},removeItem:function(t){var e=this.items.indexOf(t);e>-1&&(this.items.splice(e,1),t.off("click").off("toggle"),t.remove())},removeItems:function(t,e){if(!(t>this.items.length-1)){t+e>this.items.length&&(e=this.items.length-t);for(var i=t;i<t+e;i++)this.items[i].off("click").off("toggle"),this.items[i].remove();this.items.splice(t,e)}},removeAll:function(){_.each(this.items,(function(t){t.off("click").off("toggle"),t.remove()})),this.items=[]},onBeforeShowMenu:function(t){Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),t&&t.target===t.currentTarget&&this.alignPosition()},onAfterShowMenu:function(t){if(this.trigger("show:after",this,t),this.scroller&&t&&t.target===t.currentTarget){var e=this.menuRoot;if(void 0===this.wheelSpeed){var i=e.find("> li:first"),n=i.length?i.outerHeight():1;this.wheelSpeed=Math.min(Math.floor(e.height()/n)*n/10,20)}this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible,wheelSpeed:this.wheelSpeed});var o=e.find("> li .checked");if(o.length){var s=o.position().top,a=(n=o.outerHeight(),e.outerHeight());if(s<0||s+n>a){var l=e.scrollTop()+s+(n-a)/2;l=Math.floor(l/n)*n,e.scrollTop(l)}setTimeout((function(){o.focus()}),1)}}this._search={}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e)},onAfterKeydownMenu:function(t){if(this.trigger("keydown:before",this,t),!t.isDefaultPrevented())if(t.keyCode==Common.UI.Keys.RETURN){var e=$(t.target).closest("li");if(e.length<=0&&(e=$(t.target).parent().find("li .dataview")),e.length>0&&e.click(),e.hasClass("dropdown-submenu")||Common.UI.Menu.Manager.hideAll(),$(t.currentTarget).closest("li").hasClass("dropdown-submenu"))return t.stopPropagation(),!1}else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0;else if(t.keyCode==Common.UI.Keys.ESC);else if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){var i=this;if(clearTimeout(this._search.timer),this._search.timer=setTimeout((function(){i._search={}}),1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index){var n=this.menuRoot.find("> li").find("> a");this._search.index=n.index(n.filter(":focus"))}this.selectCandidate()}},onBeforeKeydownMenu:function(t){if(!t.isDefaultPrevented()&&this.outerMenu&&this.outerMenu.menu&&(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)){var e=this.menuRoot.find("> li").find("> a"),i=e.index(e.filter(":focus"));(t.keyCode==Common.UI.Keys.UP&&0==i||t.keyCode==Common.UI.Keys.DOWN&&i==e.length-1)&&(this.outerMenu.menu.focusOuter(t,this.outerMenu.index),t.preventDefault(),t.stopPropagation())}},selectCandidate:function(){for(var t,e,i=this._search.index||0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),o=0;o<this.items.length;o++){var s=this.items[o];if(n.test(s.caption)&&(t||(t=s,e=o),this._search.full&&o==i||o>i)){t=s,e=o;break}}if(t){if(this._search.index=e,s=t.cmpEl.find("a"),this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible,wheelSpeed:this.wheelSpeed});var a=s.position().top,l=s.outerHeight(),r=this.menuRoot.outerHeight();if(a<0||a+l>r){var c=this.menuRoot.scrollTop()+a;c=Math.floor(c/l)*l,this.menuRoot.scrollTop(c)}}s.focus()}},onBeforeKeyDown:function(t,e){if(e.keyCode==Common.UI.Keys.RETURN){var i=$(e.target).closest("li");i.length>0&&(e.preventDefault(),e.stopPropagation(),i.click()),Common.UI.Menu.Manager.hideAll()}else if("after.bs.dropdown"!==e.namespace&&(e.keyCode==Common.UI.Keys.DOWN||e.keyCode==Common.UI.Keys.UP)){if(this.menuRoot.length<1||$(e.target).closest("ul[role=menu]").get(0)!==this.menuRoot.get(0))return;var n=this.findInnerMenu(e.keyCode);n&&n.focusInner&&(e.preventDefault(),e.stopPropagation(),_.delay((function(){n.focusInner(e)}),10))}},setInnerMenu:function(t){!this.options.innerMenus&&t&&(this.options.innerMenus=t,this.rendered&&this.on("keydown:before",_.bind(this.onBeforeKeyDown,this)))},findInnerMenu:function(t,e,i){if(this.options.innerMenus){var n=$("> li",this.menuRoot),o=$("> li:not(.divider):not(.disabled):visible",this.menuRoot),s=o.length;if(s)for(var a=0;a<s;){var l=void 0!==e?o.index(n.eq(e)):o.index(o.find("> a").filter(":focus").parent()),r=t==Common.UI.Keys.DOWN?l<s-1?l+1:0:l>0?l-1:s-1,c=o.eq(r);e=n.index(c);for(var d=0;d<this.options.innerMenus.length;d++){var h=this.options.innerMenus[d];if(h&&h.menu&&h.index==e)return h.menu}if(c.find("> a").length>0)return i?c:void 0;a++}}},focusInner:function(t){t.keyCode==Common.UI.Keys.UP?this.items[this.items.length-1].cmpEl.find("> a").focus():this.items[0].cmpEl.find("> a").focus()},focusOuter:function(t,e){var i=this.findInnerMenu(t.keyCode,e,!0);if(i&&i.focusInner)_.delay((function(){i.focusInner(t)}),10);else if(i)i.find("> a").focus();else{var n=$("> li:not(.divider):not(.disabled):visible",this.menuRoot).find("> a"),o=n.length;o&&n.eq(t.keyCode==Common.UI.Keys.UP?e<0?o-1:e:e>=o-1?0:e+1).focus()}},onItemClick:function(t,e){if(t.menu||(this.isOver=!1),t.options.stopPropagation){e.stopPropagation();var i=this;_.delay((function(){i.$el.parent().parent().find("[data-toggle=dropdown]").focus()}),10)}else this.trigger("item:click",this,t,e)},onItemToggle:function(t,e,i){this.trigger("item:toggle",this,t,e,i)},setOffset:function(t,e){this.offset[0]=_.isUndefined(t)?this.offset[0]:t,this.offset[1]=_.isUndefined(e)?this.offset[1]:e,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(t,e){var i=this.menuRoot,n=this.menuAlignEl||i.parent(),o=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),s=n.offset(),a=Common.Utils.innerWidth()-10,l=Common.Utils.innerHeight()-10,r=i.outerWidth(),c=i.outerHeight(),d=n.outerWidth(),h=n.outerHeight(),p={tl:[0,0],bl:[0,c],tr:[r,0],br:[r,c]},m={tl:[0,0],tr:[d,0],bl:[0,h],br:[d,h]},u=s.left-p[o[1]][0]+m[o[2]][0]+this.offset[0],g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1];if(u+r>a&&(u=n.is("li.dropdown-submenu")?s.left-r+2:a-r),u<0&&(u=0),this.options.restoreHeightAndTop)l=(f=Common.Utils.croppedGeometry()).height-10,i.css("max-height","none"),g+(c=i.outerHeight())>l+f.top&&(g=l-c),g<f.top&&(g=f.top),g+c>l+f.top&&(i.css("max-height",l-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find("> .dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),this.wheelSpeed=void 0),this.scroller&&this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});else if(this.options.restoreHeight)"number"==typeof this.options.restoreHeight&&(g+c>l?(i.css("max-height",l-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),this.wheelSpeed=void 0):g+c<l&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(l-g,this.options.restoreHeight)+"px"),this.wheelSpeed=void 0));else{var f;g+c>(l=(f=Common.Utils.croppedGeometry()).height-10)+f.top&&(t&&"string"==typeof t?(o=t.match(/^([a-z]+)-([a-z]+)/),g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1]+(e||0)):g=l-c),g<f.top&&(g=f.top)}if(this.options.additionalAlign)this.options.additionalAlign.call(this,i,u,g);else{var b={left:u,top:g};c<l||(b["margin-top"]=0),i.css(b)}},clearAll:function(){_.each(this.items,(function(t){t.setChecked&&t.setChecked(!1,!0)}))}}),{Manager:i})),Common.UI.MenuSimple=Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0],cyclic:!0,search:!1,scrollAlwaysVisible:!0},template:_.template(['<ul class="dropdown-menu <%= options.cls %>" oo_editor_input="true" style="<%= options.style %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>","<% item.checked = item.checked || false;  %>","<li><%= itemTemplate(item) %></li>","<% }) %>","</ul>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||_.template(['<a id="<%= id %>" <% if(typeof style !== "undefined") { %> style="<%= style %>" <% } %>','<% if(typeof canFocused !== "undefined") { %> tabindex="-1" type="menuitem" <% } %>','<% if(typeof stopPropagation !== "undefined") { %> data-stopPropagation="true" <% } %>','class="<% if (checked) { %> checked <% } %>" >','<% if (typeof iconCls !== "undefined") { %>','<span class="menu-item-icon <%= iconCls %>"></span>',"<% } %>","<%= caption %>","</a>"].join("")),this.rendered=!1,this.items=this.options.items||[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,this.scrollAlwaysVisible=this.options.scrollAlwaysVisible,this.search=this.options.search,this.options.restoreHeight&&(this.options.restoreHeight="number"==typeof this.options.restoreHeight?this.options.restoreHeight:this.options.maxHeight?this.options.maxHeight:1e5,!this.options.maxHeight&&(this.options.maxHeight=this.options.restoreHeight)),this.options.cyclic||(this.options.cls+=" no-cyclic"),this.options.el&&this.render(),Common.UI.Menu.Manager.register(this)},remove:function(){Common.UI.Menu.Manager.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(t){var e=this;this.trigger("render:before",this),this.cmpEl=e.$el||$(this.el),t&&this.setElement(t,!1),e.rendered||(this.cmpEl=$(this.template({items:e.items,itemTemplate:e.itemTemplate,options:e.options})),t?t.append(this.cmpEl):this.$el.append(this.cmpEl));var i=this.cmpEl.parent(),n="menu"===i.attr("role")?i:i.find("[role=menu]");return this.menuRoot=n,n&&(e.rendered||(n.on("click","li",_.bind(e.onItemClick,e)),n.on("mousedown","li",_.bind(e.onItemMouseDown,e))),this.options.maxHeight&&(n.css({"max-height":e.options.maxHeight}),this.scroller=new Common.UI.Scroller({el:e.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),n.css({position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=n.parent(),this.parentEl.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),this.parentEl.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),this.parentEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),this.parentEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),n.hover((function(t){e.isOver=!0}),(function(t){e.isOver=!1}))),this.rendered=!0,this.trigger("render:after",this),this},resetItems:function(t){this.items=t||[],this.$items=null;var e=_.template(["<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>","<% item.checked = item.checked || false;  %>","<li><%= itemTemplate(item) %></li>","<% }) %>"].join(""));this.cmpEl&&this.cmpEl.html(e({items:this.items,itemTemplate:this.itemTemplate,options:this.options}))},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&(this.parentEl.hasClass("open")?this.cmpEl.dropdown("toggle"):this.parentEl.hasClass("over")&&this.parentEl.removeClass("over"))},onItemClick:function(t){if(1!=t.which&&void 0!==t.which)return!1;var e=$(t.currentTarget).closest("li").index(),i=e>=0?this.items[e]:null;if(i){if(i.disabled)return!1;if(i.checkable&&!i.checked&&this.setChecked(e,!i.checked),this.isOver=!1,i.stopPropagation){t.stopPropagation();var n=this;_.delay((function(){n.$el.parent().parent().find("[data-toggle=dropdown]").focus()}),10)}else this.trigger("item:click",this,i,t)}},onItemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation()},setChecked:function(t,e,i){this.toggle(t,e,i)},toggle:function(t,e,i){var n=!!e,o=this.items[t];if(this.clearAll(),o&&o.checkable){if(o.checked=n,this.rendered){var s=o.el||this.cmpEl.find("#"+o.id);s&&(s.toggleClass("checked",o.checked),_.isEmpty(o.iconCls)||s.css("background-image","none"))}i||this.trigger("item:toggle",this,o,n)}},setDisabled:function(t){this.disabled=!!t,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},onBeforeShowMenu:function(t){Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),t&&t.target===t.currentTarget&&this.alignPosition()},onAfterShowMenu:function(t){if(this.trigger("show:after",this,t),this.scroller&&t&&t.target===t.currentTarget){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var e=this.menuRoot,i=e.find("> li .checked");if(i.length){var n=i.position().top,o=i.outerHeight(),s=e.outerHeight();if(n<0||n+o>s){var a=e.scrollTop()+n+(o-s)/2;a=Math.floor(a/o)*o,e.scrollTop(a)}setTimeout((function(){i.focus()}),1)}}if(this._search={},this.search&&!this.$items){var l=this;this.$items=this.menuRoot.find("> li").find("> a"),_.each(this.$items,(function(t,e){l.items[e].el=$(t)}))}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e)},onAfterKeydownMenu:function(t){if(t.keyCode==Common.UI.Keys.RETURN){var e=$(t.target).closest("li");if(e.length<=0&&(e=$(t.target).parent().find("li .dataview")),e.length>0&&e.click(),e.hasClass("dropdown-submenu")||Common.UI.Menu.Manager.hideAll(),$(t.currentTarget).closest("li").hasClass("dropdown-submenu"))return t.stopPropagation(),!1}else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0;else if(t.keyCode==Common.UI.Keys.ESC);else if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){var i=this;clearTimeout(this._search.timer),this._search.timer=setTimeout((function(){i._search={}}),1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index&&(this._search.index=this.$items.index(this.$items.filter(":focus"))),this.selectCandidate()}},selectCandidate:function(){for(var t,e,i=this._search.index||0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),o=0;o<this.items.length;o++){var s=this.items[o];if(n.test(s.caption)&&(t||(t=s,e=o),this._search.full&&o==i||o>i)){t=s,e=o;break}}if(t){this._search.index=e;s=t.el;if(this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var a=s.position().top,l=s.outerHeight(),r=this.menuRoot.outerHeight();if(a<0||a+l>r){var c=this.menuRoot.scrollTop()+a;c=Math.floor(c/l)*l,this.menuRoot.scrollTop(c)}}s.focus()}},setOffset:function(t,e){this.offset[0]=_.isUndefined(t)?this.offset[0]:t,this.offset[1]=_.isUndefined(e)?this.offset[1]:e,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(t,e){var i=this.menuRoot,n=this.menuAlignEl||i.parent(),o=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),s=n.offset(),a=Common.Utils.innerWidth(),l=Common.Utils.innerHeight()-10,r=i.outerWidth(),c=i.outerHeight(),d=n.outerWidth(),h=n.outerHeight(),p={tl:[0,0],bl:[0,c],tr:[r,0],br:[r,c]},m={tl:[0,0],tr:[d,0],bl:[0,h],br:[d,h]},u=s.left-p[o[1]][0]+m[o[2]][0]+this.offset[0],g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1];u+r>a&&(u=n.is("li.dropdown-submenu")?s.left-r+2:a-r),this.options.restoreHeight?"number"==typeof this.options.restoreHeight&&(g+c>l?(i.css("max-height",l-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible}))):g+c<l&&i.height()<this.options.restoreHeight&&i.css("max-height",Math.min(l-g,this.options.restoreHeight)+"px")):(g+c>l&&(t&&"string"==typeof t?(o=t.match(/^([a-z]+)-([a-z]+)/),g=s.top-p[o[1]][1]+m[o[2]][1]+this.offset[1]+(e||0)):g=l-c),g<0&&(g=0)),this.options.additionalAlign?this.options.additionalAlign.call(this,i,u,g):i.css({left:Math.ceil(u),top:Math.ceil(g)})},clearAll:function(){this.cmpEl&&this.cmpEl.find("li > a.checked").removeClass("checked"),_.each(this.items,(function(t){t.checked=!1}))}})})),define("spreadsheeteditor/main/app/view/DocumentHolder",["jquery","underscore","backbone","gateway","common/main/lib/component/Menu"],(function(t,e,i,n){"use strict";SSE.Views.DocumentHolder=i.View.extend(e.extend({el:"#editor_sdk",template:null,events:{},initialize:function(){var t=this;this.setApi=function(e){return t.api=e,t}},render:function(){return this.fireEvent("render:before",this),this.cmpEl=t(this.el),this.fireEvent("render:after",this),this},focus:function(){var t=this;e.defer((function(){t.cmpEl&&t.cmpEl.focus()}),50)},createDelayedElementsViewer:function(){var t=this;t.menuViewCopy=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:t.txtCopy,value:"copy"}),t.menuViewUndo=new Common.UI.MenuItem({iconCls:"menu__icon btn-undo",caption:t.textUndo}),t.menuViewCopySeparator=new Common.UI.MenuItem({caption:"--"}),t.menuViewAddComment=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-comments",id:"id-context-menu-item-view-add-comment",caption:t.txtAddComment}),t.menuSignatureViewSign=new Common.UI.MenuItem({caption:this.strSign,value:0}),t.menuSignatureDetails=new Common.UI.MenuItem({caption:this.strDetails,value:1}),t.menuSignatureViewSetup=new Common.UI.MenuItem({caption:this.strSetup,value:2}),t.menuSignatureRemove=new Common.UI.MenuItem({caption:this.strDelete,value:3}),t.menuViewSignSeparator=new Common.UI.MenuItem({caption:"--"}),this.viewModeMenu=new Common.UI.Menu({cls:"shifted-right",items:[t.menuViewCopy,t.menuViewUndo,t.menuViewCopySeparator,t.menuSignatureViewSign,t.menuSignatureDetails,t.menuSignatureViewSetup,t.menuSignatureRemove,t.menuViewSignSeparator,t.menuViewAddComment]}),t.fireEvent("createdelayedelements",[t])},createDelayedElements:function(){var i=this;i.pmiCut=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.txtCut,value:"cut"}),i.pmiCopy=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.txtCopy,value:"copy"}),i.pmiPaste=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.txtPaste,value:"paste"}),i.pmiSelectTable=new Common.UI.MenuItem({caption:i.txtSelect,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:this.selectRowText,value:Asc.c_oAscChangeSelectionFormatTable.row},{caption:this.selectColumnText,value:Asc.c_oAscChangeSelectionFormatTable.column},{caption:this.selectDataText,value:Asc.c_oAscChangeSelectionFormatTable.data},{caption:this.selectTableText,value:Asc.c_oAscChangeSelectionFormatTable.all}]})}),i.pmiInsertEntire=new Common.UI.MenuItem({caption:i.txtInsert}),i.pmiInsertCells=new Common.UI.MenuItem({iconCls:"menu__icon btn-addcell",caption:i.txtInsert,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtShiftRight,value:Asc.c_oAscInsertOptions.InsertCellsAndShiftRight},{caption:i.txtShiftDown,value:Asc.c_oAscInsertOptions.InsertCellsAndShiftDown},{caption:i.txtRow,value:Asc.c_oAscInsertOptions.InsertRows},{caption:i.txtColumn,value:Asc.c_oAscInsertOptions.InsertColumns}]})}),i.pmiInsertTable=new Common.UI.MenuItem({iconCls:"menu__icon btn-addcell",caption:i.txtInsert,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.insertRowAboveText,value:Asc.c_oAscInsertOptions.InsertTableRowAbove},{caption:i.insertRowBelowText,value:Asc.c_oAscInsertOptions.InsertTableRowBelow},{caption:i.insertColumnLeftText,value:Asc.c_oAscInsertOptions.InsertTableColLeft},{caption:i.insertColumnRightText,value:Asc.c_oAscInsertOptions.InsertTableColRight}]})}),i.pmiDeleteEntire=new Common.UI.MenuItem({caption:i.txtDelete}),i.pmiDeleteCells=new Common.UI.MenuItem({iconCls:"menu__icon btn-delcell",caption:i.txtDelete,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtShiftLeft,value:Asc.c_oAscDeleteOptions.DeleteCellsAndShiftLeft},{caption:i.txtShiftUp,value:Asc.c_oAscDeleteOptions.DeleteCellsAndShiftTop},{caption:i.txtRow,value:Asc.c_oAscDeleteOptions.DeleteRows},{caption:i.txtColumn,value:Asc.c_oAscDeleteOptions.DeleteColumns}]})}),i.pmiDeleteTable=new Common.UI.MenuItem({iconCls:"menu__icon btn-delcell",caption:i.txtDelete,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:this.deleteRowText,value:Asc.c_oAscDeleteOptions.DeleteRows},{caption:this.deleteColumnText,value:Asc.c_oAscDeleteOptions.DeleteColumns},{caption:this.deleteTableText,value:Asc.c_oAscDeleteOptions.DeleteTable}]})}),i.pmiClear=new Common.UI.MenuItem({iconCls:"menu__icon btn-clearstyle",caption:i.txtClear,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtClearAll,value:Asc.c_oAscCleanOptions.All},{caption:i.txtClearText,value:Asc.c_oAscCleanOptions.Text},{caption:i.txtClearFormat,value:Asc.c_oAscCleanOptions.Format},{caption:i.txtClearComments,value:Asc.c_oAscCleanOptions.Comments},{caption:i.txtClearHyper,value:Asc.c_oAscCleanOptions.Hyperlinks}]})}),i.pmiSortCells=new Common.UI.MenuItem({caption:i.txtSort,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{iconCls:"menu__icon btn-sort-down",caption:i.txtAscending,value:Asc.c_oAscSortOptions.Ascending},{iconCls:"menu__icon btn-sort-up",caption:i.txtDescending,value:Asc.c_oAscSortOptions.Descending},{caption:i.txtSortCellColor,value:Asc.c_oAscSortOptions.ByColorFill},{caption:i.txtSortFontColor,value:Asc.c_oAscSortOptions.ByColorFont},{caption:i.txtCustomSort,value:"advanced"}]})}),i.pmiFilterCells=new Common.UI.MenuItem({iconCls:"menu__icon btn-autofilter",caption:i.txtFilter,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtFilterValue,value:0},{caption:i.txtFilterCellColor,value:1},{caption:i.txtFilterFontColor,value:2}]})}),i.pmiReapply=new Common.UI.MenuItem({caption:i.txtReapply}),i.mnuGroupPivot=new Common.UI.MenuItem({caption:this.txtGroup,value:"grouping"}),i.mnuUnGroupPivot=new Common.UI.MenuItem({caption:this.txtUngroup,value:"ungrouping"}),i.pmiInsFunction=new Common.UI.MenuItem({iconCls:"menu__icon btn-function",caption:i.txtFormula}),i.menuAddHyperlink=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.txtInsHyperlink,inCell:!0}),i.menuEditHyperlink=new Common.UI.MenuItem({caption:i.editHyperlinkText,inCell:!0}),i.menuRemoveHyperlink=new Common.UI.MenuItem({caption:i.removeHyperlinkText}),i.menuHyperlink=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.txtInsHyperlink,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuEditHyperlink,i.menuRemoveHyperlink]})}),i.pmiRowHeight=new Common.UI.MenuItem({caption:i.txtRowHeight,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtAutoRowHeight,value:"auto-row-height"},{caption:i.txtCustomRowHeight,value:"row-height"}]})}),i.pmiColumnWidth=new Common.UI.MenuItem({caption:i.txtColumnWidth,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtAutoColumnWidth,value:"auto-column-width"},{caption:i.txtCustomColumnWidth,value:"column-width"}]})}),i.pmiEntireHide=new Common.UI.MenuItem({caption:i.txtHide}),i.pmiEntireShow=new Common.UI.MenuItem({caption:i.txtShow}),i.pmiAddComment=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-comments",id:"id-context-menu-item-add-comment",caption:i.txtAddComment}),i.pmiCellMenuSeparator=new Common.UI.MenuItem({caption:"--"}),i.pmiFunctionSeparator=new Common.UI.MenuItem({caption:"--"}),i.pmiFreezeSeparator=new Common.UI.MenuItem({caption:"--"}),i.pmiAddNamedRange=new Common.UI.MenuItem({id:"id-context-menu-item-add-named-range",caption:i.txtAddNamedRange}),i.pmiFreezePanes=new Common.UI.MenuItem({caption:i.textFreezePanes}),i.pmiEntriesList=new Common.UI.MenuItem({caption:i.textEntriesList}),i.pmiSparklines=new Common.UI.MenuItem({caption:i.txtSparklines,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.txtClearSparklines,value:Asc.c_oAscCleanOptions.Sparklines},{caption:i.txtClearSparklineGroups,value:Asc.c_oAscCleanOptions.SparklineGroups}]})});var n=e.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div style="position: relative;"><div style="position: absolute; left: 0; width: 100px;"><%= caption %></div><label style="width: 100%; max-width: 300px; overflow: hidden; text-overflow: ellipsis; text-align: right; vertical-align: bottom; padding-left: 100px; color: silver;cursor: pointer;"><%= options.exampleval ? options.exampleval : "" %></label></div></a>');i.pmiNumFormat=new Common.UI.MenuItem({caption:i.txtNumFormat,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:this.txtGeneral,template:n,checkable:!0,format:"General",exampleval:"100",value:Asc.c_oAscNumFormatType.General},{caption:this.txtNumber,template:n,checkable:!0,format:"0.00",exampleval:"100,00",value:Asc.c_oAscNumFormatType.Number},{caption:this.txtScientific,template:n,checkable:!0,format:"0.00E+00",exampleval:"1,00E+02",value:Asc.c_oAscNumFormatType.Scientific},{caption:this.txtAccounting,template:n,checkable:!0,format:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',exampleval:"100,00 $",value:Asc.c_oAscNumFormatType.Accounting},{caption:this.txtCurrency,template:n,checkable:!0,format:"$#,##0.00",exampleval:"100,00 $",value:Asc.c_oAscNumFormatType.Currency},{caption:this.txtDate,template:n,checkable:!0,format:"MM-dd-yyyy",exampleval:"04-09-1900",value:Asc.c_oAscNumFormatType.Date},{caption:this.txtTime,template:n,checkable:!0,format:"HH:MM:ss",exampleval:"00:00:00",value:Asc.c_oAscNumFormatType.Time},{caption:this.txtPercentage,template:n,checkable:!0,format:"0.00%",exampleval:"100,00%",value:Asc.c_oAscNumFormatType.Percent},{caption:this.txtFraction,template:n,checkable:!0,format:"# ?/?",exampleval:"100",value:Asc.c_oAscNumFormatType.Fraction},{caption:this.txtText,template:n,checkable:!0,format:"@",exampleval:"100",value:Asc.c_oAscNumFormatType.Text},{caption:"--"},i.pmiAdvancedNumFormat=new Common.UI.MenuItem({caption:i.textMoreFormats,value:"advanced"})]})}),i.pmiCondFormat=new Common.UI.MenuItem({caption:i.txtCondFormat}),i.pmiGetRangeList=new Common.UI.MenuItem({caption:i.txtGetLink}),i.ssMenu=new Common.UI.Menu({cls:"shifted-right",restoreHeightAndTop:!0,id:"id-context-menu-cell",items:[i.pmiCut,i.pmiCopy,i.pmiPaste,{caption:"--"},i.pmiSelectTable,i.pmiInsertEntire,i.pmiInsertCells,i.pmiInsertTable,i.pmiDeleteEntire,i.pmiDeleteCells,i.pmiDeleteTable,i.pmiClear,{caption:"--"},i.pmiSparklines,i.pmiSortCells,i.pmiFilterCells,i.pmiReapply,i.mnuGroupPivot,i.mnuUnGroupPivot,{caption:"--"},i.pmiAddComment,i.pmiCellMenuSeparator,i.pmiNumFormat,i.pmiCondFormat,i.pmiEntriesList,i.pmiGetRangeList,i.pmiAddNamedRange,i.pmiFunctionSeparator,i.pmiInsFunction,i.menuAddHyperlink,i.menuHyperlink,i.pmiRowHeight,i.pmiColumnWidth,i.pmiEntireHide,i.pmiEntireShow,i.pmiFreezeSeparator,i.pmiFreezePanes]}),i.mnuGroupImg=new Common.UI.MenuItem({caption:this.txtGroup,iconCls:"menu__icon shape-group",type:"group",value:"grouping"}),i.mnuUnGroupImg=new Common.UI.MenuItem({caption:this.txtUngroup,iconCls:"menu__icon shape-ungroup",type:"group",value:"ungrouping"}),i.mnuShapeSeparator=new Common.UI.MenuItem({caption:"--"}),i.mnuShapeAdvanced=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-shape",caption:i.advancedShapeText}),i.mnuImgAdvanced=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-image",caption:i.advancedImgText}),i.mnuSlicerSeparator=new Common.UI.MenuItem({caption:"--"}),i.mnuSlicerAdvanced=new Common.UI.MenuItem({iconCls:"menu__icon btn-slicer",caption:i.advancedSlicerText}),i.mnuChartEdit=new Common.UI.MenuItem({iconCls:"menu__icon btn-menu-chart",caption:i.chartText}),i.mnuChartData=new Common.UI.MenuItem({iconCls:"menu__icon btn-select-range",caption:i.chartDataText}),i.mnuChartType=new Common.UI.MenuItem({caption:i.chartTypeText}),i.pmiImgCut=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.txtCut,value:"cut"}),i.pmiImgCopy=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.txtCopy,value:"copy"}),i.pmiImgPaste=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.txtPaste,value:"paste"}),i.menuSignatureEditSign=new Common.UI.MenuItem({caption:this.strSign,value:0}),i.menuSignatureEditSetup=new Common.UI.MenuItem({caption:this.strSetup,value:2}),i.menuEditSignSeparator=new Common.UI.MenuItem({caption:"--"}),i.menuImgOriginalSize=new Common.UI.MenuItem({caption:i.originalSizeText}),i.menuImgReplace=new Common.UI.MenuItem({caption:i.textReplace,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:this.textFromFile,value:"file"}),new Common.UI.MenuItem({caption:this.textFromUrl,value:"url"}),new Common.UI.MenuItem({caption:this.textFromStorage,value:"storage"})]})}),i.menuImgCrop=new Common.UI.MenuItem({caption:i.textCrop,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({caption:i.textCrop,checkable:!0,allowDepress:!0,value:0}),new Common.UI.MenuItem({caption:i.textCropFill,value:1}),new Common.UI.MenuItem({caption:i.textCropFit,value:2})]})}),i.mnuBringToFront=new Common.UI.MenuItem({caption:this.textArrangeFront,iconCls:"menu__icon arrange-front",type:"arrange",value:Asc.c_oAscDrawingLayerType.BringToFront}),i.mnuSendToBack=new Common.UI.MenuItem({caption:this.textArrangeBack,iconCls:"menu__icon arrange-back",type:"arrange",value:Asc.c_oAscDrawingLayerType.SendToBack}),i.mnuBringForward=new Common.UI.MenuItem({caption:this.textArrangeForward,iconCls:"menu__icon arrange-forward",type:"arrange",value:Asc.c_oAscDrawingLayerType.BringForward}),i.mnuSendBackward=new Common.UI.MenuItem({caption:this.textArrangeBackward,iconCls:"menu__icon arrange-backward",type:"arrange",value:Asc.c_oAscDrawingLayerType.SendBackward}),i.menuImageArrange=new Common.UI.MenuItem({caption:i.textArrange,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.mnuBringToFront,i.mnuSendToBack,i.mnuBringForward,i.mnuSendBackward,{caption:"--"},i.mnuGroupImg,i.mnuUnGroupImg]})}),i.menuImageAlign=new Common.UI.MenuItem({caption:i.textAlign,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:i.textShapeAlignLeft,iconCls:"menu__icon shape-align-left",value:0},{caption:i.textShapeAlignCenter,iconCls:"menu__icon shape-align-center",value:4},{caption:i.textShapeAlignRight,iconCls:"menu__icon shape-align-right",value:1},{caption:i.textShapeAlignTop,iconCls:"menu__icon shape-align-top",value:3},{caption:i.textShapeAlignMiddle,iconCls:"menu__icon shape-align-middle",value:5},{caption:i.textShapeAlignBottom,iconCls:"menu__icon shape-align-bottom",value:2},{caption:"--"},{caption:i.txtDistribHor,iconCls:"menu__icon shape-distribute-hor",value:6},{caption:i.txtDistribVert,iconCls:"menu__icon shape-distribute-vert",value:7}]})}),i.menuImgRotate=new Common.UI.MenuItem({caption:i.textRotate,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[new Common.UI.MenuItem({iconCls:"menu__icon btn-rotate-90",caption:i.textRotate90,type:"rotate",value:1}),new Common.UI.MenuItem({iconCls:"menu__icon btn-rotate-270",caption:i.textRotate270,type:"rotate",value:0}),{caption:"--"},new Common.UI.MenuItem({iconCls:"menu__icon btn-flip-hor",caption:i.textFlipH,type:"flip",value:1}),new Common.UI.MenuItem({iconCls:"menu__icon btn-flip-vert",caption:i.textFlipV,type:"flip",value:0})]})}),i.menuImgMacro=new Common.UI.MenuItem({caption:i.textMacro}),i.menuImgEditPoints=new Common.UI.MenuItem({caption:i.textEditPoints}),i.menuImgEditPointsSeparator=new Common.UI.MenuItem({caption:"--"}),this.imgMenu=new Common.UI.Menu({cls:"shifted-right",restoreHeightAndTop:!0,items:[i.pmiImgCut,i.pmiImgCopy,i.pmiImgPaste,{caption:"--"},i.menuSignatureEditSign,i.menuSignatureEditSetup,i.menuEditSignSeparator,i.menuImgEditPoints,i.menuImgEditPointsSeparator,i.menuImageArrange,i.menuImageAlign,i.menuImgRotate,i.menuImgMacro,i.mnuShapeSeparator,i.menuImgCrop,i.mnuChartData,i.mnuChartType,i.mnuChartEdit,i.mnuShapeAdvanced,i.menuImgOriginalSize,i.menuImgReplace,i.mnuImgAdvanced,i.mnuSlicerSeparator,i.mnuSlicerAdvanced]}),this.menuParagraphVAlign=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-top",caption:this.vertAlignText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuParagraphTop=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-top",caption:i.topCellText,checkable:!0,checkmark:!1,toggleGroup:"popupparagraphvalign",value:Asc.c_oAscVAlign.Top}),i.menuParagraphCenter=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-middle",caption:i.centerCellText,checkable:!0,checkmark:!1,toggleGroup:"popupparagraphvalign",value:Asc.c_oAscVAlign.Center}),this.menuParagraphBottom=new Common.UI.MenuItem({iconCls:"menu__icon btn-align-bottom",caption:i.bottomCellText,checkable:!0,checkmark:!1,toggleGroup:"popupparagraphvalign",value:Asc.c_oAscVAlign.Bottom})]})}),i.menuParagraphDirection=new Common.UI.MenuItem({iconCls:"menu__icon text-orient-hor",caption:i.directionText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuParagraphDirectH=new Common.UI.MenuItem({caption:i.directHText,iconCls:"menu__icon text-orient-hor",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popupparagraphdirect",direction:Asc.c_oAscVertDrawingText.normal}),i.menuParagraphDirect90=new Common.UI.MenuItem({caption:i.direct90Text,iconCls:"menu__icon text-orient-rdown",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popupparagraphdirect",direction:Asc.c_oAscVertDrawingText.vert}),i.menuParagraphDirect270=new Common.UI.MenuItem({caption:i.direct270Text,iconCls:"menu__icon text-orient-rup",checkable:!0,checkmark:!1,checked:!1,toggleGroup:"popupparagraphdirect",direction:Asc.c_oAscVertDrawingText.vert270})]})}),i.menuParagraphBullets=new Common.UI.MenuItem({iconCls:"menu__icon btn-setmarkers",caption:i.bulletsText,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{template:e.template('<div id="id-docholder-menu-bullets" class="menu-layouts" style="width: 376px; margin: 4px 2px 4px 6px;"></div>')},{caption:"--"},i.menuParagraphBulletNone=new Common.UI.MenuItem({caption:i.textNone,checkable:!0,checked:!1,value:-1}),i.mnuListSettings=new Common.UI.MenuItem({caption:i.textListSettings,value:"settings"})]})}),i._markersArr=[{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(183),specialFont:"Symbol"},{type:Asc.asc_PreviewBulletType.char,char:"o",specialFont:"Courier New"},{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(167),specialFont:"Wingdings"},{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(118),specialFont:"Wingdings"},{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(216),specialFont:"Wingdings"},{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(252),specialFont:"Wingdings"},{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(168),specialFont:"Symbol"},{type:Asc.asc_PreviewBulletType.char,char:String.fromCharCode(8211),specialFont:"Arial"}],i.paraBulletsPicker={conf:{rec:null},delayRenderTips:!0,store:new Common.UI.DataViewStore([{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:1,drawdata:i._markersArr[0],skipRenderOnChange:!0,tip:this.tipMarkersFRound},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:2,drawdata:i._markersArr[1],skipRenderOnChange:!0,tip:this.tipMarkersHRound},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:3,drawdata:i._markersArr[2],skipRenderOnChange:!0,tip:this.tipMarkersFSquare},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:4,drawdata:i._markersArr[3],skipRenderOnChange:!0,tip:this.tipMarkersStar},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:5,drawdata:i._markersArr[4],skipRenderOnChange:!0,tip:this.tipMarkersArrow},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:6,drawdata:i._markersArr[5],skipRenderOnChange:!0,tip:this.tipMarkersCheckmark},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:7,drawdata:i._markersArr[6],skipRenderOnChange:!0,tip:this.tipMarkersFRhombus},{group:"menu-list-bullet-group",id:"id-markers-"+Common.UI.getId(),type:0,subtype:8,drawdata:i._markersArr[7],skipRenderOnChange:!0,tip:this.tipMarkersDash},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:4,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.UpperLetterDot_Left},skipRenderOnChange:!0,tip:this.tipNumCapitalLetters},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:5,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.LowerLetterBracket_Left},skipRenderOnChange:!0,tip:this.tipNumLettersParentheses},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:6,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.LowerLetterDot_Left},skipRenderOnChange:!0,tip:this.tipNumLettersPoints},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:1,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.DecimalDot_Right},skipRenderOnChange:!0,tip:this.tipNumNumbersPoint},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:2,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.DecimalBracket_Right},skipRenderOnChange:!0,tip:this.tipNumNumbersParentheses},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:3,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.UpperRomanDot_Right},skipRenderOnChange:!0,tip:this.tipNumRoman},{group:"menu-list-number-group",id:"id-numbers-"+Common.UI.getId(),type:1,subtype:7,drawdata:{type:Asc.asc_PreviewBulletType.number,numberingType:Asc.asc_oAscNumberingLevel.LowerRomanDot_Right},skipRenderOnChange:!0,tip:this.tipNumRomanSmall}]),groups:new Common.UI.DataViewGroupStore([{id:"menu-list-bullet-group",caption:this.textBullets},{id:"menu-list-number-group",caption:this.textNumbering}]),selectRecord:function(t){this.conf.rec=t}},i.menuAddHyperlinkShape=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.txtInsHyperlink}),i.menuEditHyperlinkShape=new Common.UI.MenuItem({caption:i.editHyperlinkText}),i.menuRemoveHyperlinkShape=new Common.UI.MenuItem({caption:i.removeHyperlinkText}),i.menuHyperlinkShape=new Common.UI.MenuItem({iconCls:"menu__icon btn-inserthyperlink",caption:i.txtInsHyperlink,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[i.menuEditHyperlinkShape,i.menuRemoveHyperlinkShape]})}),this.pmiTextAdvanced=new Common.UI.MenuItem({iconCls:"menu__icon btn-paragraph",caption:i.txtTextAdvanced}),i.pmiTextCut=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.txtCut,value:"cut"}),i.pmiTextCopy=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.txtCopy,value:"copy"}),i.pmiTextPaste=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.txtPaste,value:"paste"}),this.textInShapeMenu=new Common.UI.Menu({cls:"shifted-right",items:[i.pmiTextCut,i.pmiTextCopy,i.pmiTextPaste,{caption:"--"},i.menuParagraphVAlign,i.menuParagraphDirection,i.menuParagraphBullets,i.menuAddHyperlinkShape,i.menuHyperlinkShape,{caption:"--"},i.pmiTextAdvanced]}),i.pmiCommonCut=new Common.UI.MenuItem({iconCls:"menu__icon btn-cut",caption:i.txtCut,value:"cut"}),i.pmiCommonCopy=new Common.UI.MenuItem({iconCls:"menu__icon btn-copy",caption:i.txtCopy,value:"copy"}),i.pmiCommonPaste=new Common.UI.MenuItem({iconCls:"menu__icon btn-paste",caption:i.txtPaste,value:"paste"}),this.copyPasteMenu=new Common.UI.Menu({cls:"shifted-right",items:[i.pmiCommonCut,i.pmiCommonCopy,i.pmiCommonPaste]}),this.entriesMenu=new Common.UI.Menu({maxHeight:200,cyclic:!1,items:[]}).on("show:after",(function(){this.scroller.update({alwaysVisibleY:!0})})).on("keydown:before",(function(e,i){if(i.altKey&&i.keyCode==Common.UI.Keys.DOWN){var n=t(i.target).closest("li");n.length>0?n.click():e.hide()}})),this.funcMenu=new Common.UI.Menu({maxHeight:200,cyclic:!1,items:[]}).on("render:after",(function(t){t.cmpEl.removeAttr("oo_editor_input").attr("oo_editor_keyboard",!0)})),this.tableTotalMenu=new Common.UI.Menu({maxHeight:160,menuAlign:"tr-br",cyclic:!1,cls:"lang-menu",items:[{caption:this.textNone,value:Asc.ETotalsRowFunction.totalrowfunctionNone,checkable:!0},{caption:this.textAverage,value:Asc.ETotalsRowFunction.totalrowfunctionAverage,checkable:!0},{caption:this.textCount,value:Asc.ETotalsRowFunction.totalrowfunctionCount,checkable:!0},{caption:this.textMax,value:Asc.ETotalsRowFunction.totalrowfunctionMax,checkable:!0},{caption:this.textMin,value:Asc.ETotalsRowFunction.totalrowfunctionMin,checkable:!0},{caption:this.textSum,value:Asc.ETotalsRowFunction.totalrowfunctionSum,checkable:!0},{caption:this.textStdDev,value:Asc.ETotalsRowFunction.totalrowfunctionStdDev,checkable:!0},{caption:this.textVar,value:Asc.ETotalsRowFunction.totalrowfunctionVar,checkable:!0},{caption:this.textMore,value:Asc.ETotalsRowFunction.totalrowfunctionCustom,checkable:!0}]}),i.fireEvent("createdelayedelements",[i])},setMenuItemCommentCaptionMode:function(t,e,i){t.setCaption(e?this.txtAddComment:i?this.txtEditComment:this.txtShowComment,!0)},txtSort:"Sort",txtAscending:"Ascending",txtDescending:"Descending",txtFormula:"Insert Function",txtInsHyperlink:"Hyperlink",txtCut:"Cut",txtCopy:"Copy",txtPaste:"Paste",txtInsert:"Insert",txtDelete:"Delete",txtClear:"Clear",txtClearAll:"All",txtClearText:"Text",txtClearFormat:"Format",txtClearHyper:"Hyperlink",txtClearComments:"Comments",txtShiftRight:"Shift cells right",txtShiftLeft:"Shift cells left",txtShiftUp:"Shift cells up",txtShiftDown:"Shift cells down",txtRow:"Entire Row",txtColumn:"Entire Column",txtColumnWidth:"Set Column Width",txtRowHeight:"Set Row Height",txtWidth:"Width",txtHide:"Hide",txtShow:"Show",textArrangeFront:"Bring To Front",textArrangeBack:"Send To Back",textArrangeForward:"Bring Forward",textArrangeBackward:"Send Backward",txtArrange:"Arrange",txtAddComment:"Add Comment",txtEditComment:"Edit Comment",txtUngroup:"Ungroup",txtGroup:"Group",topCellText:"Align Top",centerCellText:"Align Middle",bottomCellText:"Align Bottom",vertAlignText:"Vertical Alignment",txtTextAdvanced:"Text Advanced Settings",editHyperlinkText:"Edit Hyperlink",removeHyperlinkText:"Remove Hyperlink",editChartText:"Edit Data",advancedShapeText:"Shape Advanced Settings",chartText:"Chart Advanced Settings",directionText:"Text Direction",directHText:"Horizontal",direct90Text:"Rotate Text Down",direct270Text:"Rotate Text Up",txtAddNamedRange:"Define Name",textFreezePanes:"Freeze Panes",textUnFreezePanes:"Unfreeze Panes",txtSelect:"Select",selectRowText:"Row",selectColumnText:"Entire Column",selectDataText:"Column Data",selectTableText:"Table",insertRowAboveText:"Row Above",insertRowBelowText:"Row Below",insertColumnLeftText:"Column Left",insertColumnRightText:"Column Right",deleteRowText:"Row",deleteColumnText:"Column",deleteTableText:"Table",txtFilter:"Filter",txtFilterValue:"Filter by Selected cell's value",txtFilterCellColor:"Filter by cell's color",txtFilterFontColor:"Filter by font color",txtReapply:"Reapply",txtSortCellColor:"Selected Cell Color on top",txtSortFontColor:"Selected Font Color on top",txtAutoColumnWidth:"Auto Fit Column Width",txtAutoRowHeight:"Auto Fit Row Height",txtCustomColumnWidth:"Custom Column Width",txtCustomRowHeight:"Custom Row Height",textEntriesList:"Select from drop-down list",txtSparklines:"Sparklines",txtClearSparklines:"Clear Selected Sparklines",txtClearSparklineGroups:"Clear Selected Sparkline Groups",txtShowComment:"Show Comment",advancedImgText:"Image Advanced Settings",textNone:"None",bulletsText:"Bullets and Numbering",textUndo:"Undo",strSign:"Sign",strDetails:"Signature Details",strSetup:"Signature Setup",strDelete:"Remove Signature",originalSizeText:"Actual Size",textReplace:"Replace image",textFromUrl:"From URL",textFromFile:"From File",txtNumFormat:"Number Format",txtGeneral:"General",txtNumber:"Number",txtScientific:"Scientific",txtAccounting:"Accounting",txtCurrency:"Currency",txtDate:"Date",txtTime:"Time",txtPercentage:"Percentage",txtFraction:"Fraction",txtText:"Text",textMoreFormats:"More formats",textShapeAlignLeft:"Align Left",textShapeAlignRight:"Align Right",textShapeAlignCenter:"Align Center",textShapeAlignTop:"Align Top",textShapeAlignBottom:"Align Bottom",textShapeAlignMiddle:"Align Middle",txtDistribHor:"Distribute Horizontally",txtDistribVert:"Distribute Vertically",textRotate270:"Rotate 90° Counterclockwise",textRotate90:"Rotate 90° Clockwise",textFlipV:"Flip Vertically",textFlipH:"Flip Horizontally",textRotate:"Rotate",textArrange:"Arrange",textAlign:"Align",textCrop:"Crop",textCropFill:"Fill",textCropFit:"Fit",textListSettings:"List Settings",textFromStorage:"From Storage",advancedSlicerText:"Slicer Advanced Settings",textAverage:"Average",textMax:"Max",textMin:"Min",textCount:"Count",textSum:"Sum",textStdDev:"StdDev",textVar:"Var",textMore:"More functions",txtCustomSort:"Custom sort",txtCondFormat:"Conditional Formatting",textBullets:"Bullets",textNumbering:"Numbering",textMacro:"Assign Macro",textEditPoints:"Edit Points",tipNumCapitalLetters:"A. B. C.",tipNumLettersParentheses:"a) b) c)",tipNumLettersPoints:"a. b. c.",tipNumNumbersPoint:"1. 2. 3.",tipNumNumbersParentheses:"1) 2) 3)",tipNumRoman:"I. II. III.",tipNumRomanSmall:"i. ii. iii.",tipMarkersFRound:"Filled round bullets",tipMarkersHRound:"Hollow round bullets",tipMarkersFSquare:"Filled square bullets",tipMarkersStar:"Star bullets",tipMarkersArrow:"Arrow bullets",tipMarkersCheckmark:"Checkmark bullets",tipMarkersFRhombus:"Filled rhombus bullets",tipMarkersDash:"Dash bullets",chartDataText:"Select Chart Data",chartTypeText:"Change Chart Type",txtGetLink:"Get link to this range"},SSE.Views.DocumentHolder||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ComboBox",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],(function(){"use strict";Common.UI.ComboBoxModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),value:null,displayValue:null}}}),Common.UI.ComboBoxStore=Backbone.Collection.extend({model:Common.UI.ComboBoxModel}),Common.UI.ComboBox=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,editable:!0,disabled:!1,menuCls:"",menuStyle:"",displayField:"displayValue",valueField:"value",search:!1,scrollAlwaysVisible:!1,takeFocusOnClose:!1,dataHint:"",dataHintDirection:"",dataHintOffset:""},template:_.template(['<span class="input-group combobox <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control" spellcheck="false"  data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>","</ul>","</span>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.menuCls=e.options.menuCls,this.menuStyle=e.options.menuStyle,this.template=e.options.template||e.template,this.itemsTemplate=e.options.itemsTemplate,this.hint=e.options.hint,this.editable=e.options.editable,this.disabled=e.options.disabled,this.store=e.options.store||new Common.UI.ComboBoxStore,this.displayField=e.options.displayField,this.valueField=e.options.valueField,this.search=e.options.search,this.scrollAlwaysVisible=e.options.scrollAlwaysVisible,e.rendered=e.options.rendered||!1,this.lastValue=null,e.store.add(e.options.data),e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered)this.cmpEl=e.$el||$(this.el);else{var i=this.store.toJSON();this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,menuCls:this.menuCls,menuStyle:this.menuStyle,items:i,scope:e,dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset})),this.itemsTemplate&&this.cmpEl.find("ul").html($(this.itemsTemplate({items:i,scope:e}))),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)}if(!e.rendered){var n=this.cmpEl;if(this._input=n.find("input"),this._button=n.find(".btn"),n.on("click","a",_.bind(this.itemClicked,this)),n.on("mousedown","a",_.bind(this.itemMouseDown,this)),this.editable?(n.on("change","input",_.bind(this.onInputChanged,this)),n.on("keydown","input",_.bind(this.onInputKeyDown,this)),n.on("focusin","input",_.bind(this.onInputFocusIn,this)),n.on("click",".form-control",_.bind(this.onEditableInputClick,this))):(n.on("click",".form-control",_.bind(this.onInputClick,this)),this._input.attr("readonly","readonly"),this._input.attr("data-can-copy",!1),this._input.on("mousedown",(function(t){t.preventDefault()}))),e.options.hint){n.attr("data-toggle","tooltip"),n.tooltip({title:e.options.hint,placement:e.options.hintAnchor||"cursor"});var o=n.closest(".asc-window");if(o.length>0){n.data("bs.tooltip").tip().css("z-index",parseInt(o.css("z-index"))+10);var s=function(t){if(o[0]===t.$window[0]){var e=n.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide()),Common.NotificationCenter.off({"modal:close":s})}};Common.NotificationCenter.on({"modal:close":s})}n.find(".dropdown-menu").on("mouseenter",(function(){var t=n.data("bs.tooltip");t&&(void 0===t.dontShow&&(t.dontShow=!0),t.hide())}))}var a=n.find(".dropdown-menu");a.hasClass("menu-absolute")&&a.css("min-width",n.outerWidth()),n.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),n.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),n.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),n.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),n.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),Common.NotificationCenter.on("menumanager:hideall",_.bind(e.closeMenu,e)),this.setDefaultSelection(),this.listenTo(this.store,"reset",this.onResetItems)}return e.rendered=!0,e.disabled&&e.setDisabled(e.disabled),this},setData:function(t){this.store.reset([]),this.store.add(t),this.setRawValue(""),this.onResetItems()},openMenu:function(t){var e=this;this.scroller||(this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))),_.delay((function(){e.cmpEl.addClass("open")}),t||0)},closeMenu:function(){this.cmpEl.removeClass("open")},isMenuOpen:function(){return this.cmpEl.hasClass("open")},onBeforeShowMenu:function(t){if(this.scroller||(this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))),Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}var i=this.cmpEl.find("ul");if(i.hasClass("menu-absolute")){var n=this.cmpEl.offset();i.css({left:n.left,top:n.top+this.cmpEl.outerHeight()+2})}else i.hasClass("menu-aligned")&&(n=this.cmpEl.offset(),i.toggleClass("show-top",n.top+this.cmpEl.outerHeight()+i.outerHeight()>Common.Utils.innerHeight()))},onAfterShowMenu:function(t){var e=$(this.el).find("ul"),i=e.find("> li.selected");if(i.length){var n=i.position().top,o=i.outerHeight(),s=e.outerHeight();if(n<0||n+o>s){var a=e.scrollTop()+n+(o-s)/2;a=Math.floor(a/o)*o,e.scrollTop(a)}setTimeout((function(){i.find("a").focus()}),1)}else{var l=this;setTimeout((function(){l.cmpEl.find("ul li:first a").focus()}),1)}this.scroller&&this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible}),this.trigger("show:after",this,t),this._search={}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){if(this.cmpEl.find(".dropdown-toggle").blur(),this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e),this.options.takeFocusOnClose){var i=this;i._input&&i._input.length>0&&!i.editable&&i._input[0].selectionStart===i._input[0].selectionEnd&&setTimeout((function(){i._input[0].selectionStart=i._input[0].selectionEnd=0}),1),setTimeout((function(){i.focus()}),1)}},onAfterKeydownMenu:function(t){if(t.keyCode==Common.UI.Keys.DOWN&&!this.editable&&!this.isMenuOpen())return this.openMenu(),this.onAfterShowMenu(),!1;if(t.keyCode==Common.UI.Keys.RETURN&&(this.editable||this.isMenuOpen())){var e=this.isMenuOpen();return $(t.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur()),!e}if(t.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),this.closeMenu(),this.onAfterHideMenu(t),!1;if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){if("object"!=typeof this._search)return;var i=this;if(clearTimeout(this._search.timer),this._search.timer=setTimeout((function(){i._search={}}),1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index){var n=this.cmpEl.find("ul > li").find("> a");this._search.index=n.index(n.filter(":focus"))}this.selectCandidate()}},selectCandidate:function(){for(var t,e,i=this._search.index||0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),o=0;o<this.store.length;o++){var s=this.store.at(o);if(n.test(s.get(this.displayField))&&(t||(t=s,e=o),this._search.full&&o==i||o>i)){t=s,e=o;break}}if(t){if(this._search.index=e,s=$("#"+t.get("id")+" a",$(this.el)),this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var a=$(this.el).find("ul"),l=s.position().top,r=s.outerHeight(),c=a.outerHeight();if(l<0||l+r>c){var d=a.scrollTop()+l;d=Math.floor(d/r)*r,a.scrollTop(d)}}s.focus()}},onInputKeyDown:function(t){var e=this;t.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),this.closeMenu(),this.onAfterHideMenu(t)):t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN?(this.isMenuOpen()||this.openMenu(),_.delay((function(){e._skipInputChange=!0,e.cmpEl.find("ul li:first a").focus()}),10)):t.keyCode==Common.UI.Keys.RETURN&&$(t.target).val()===e.lastValue?this._input.trigger("change",{reapply:!0}):e._skipInputChange=!1},onInputFocusIn:function(t){this.trigger("combo:focusin",this,t)},onInputChanged:function(t,e){if(!e||!e.synthetic)if(this._skipInputChange)this._skipInputChange=!1;else{var i,n=$(t.target).val(),o={};this.lastValue!==n||e&&e.reapply?(o[this.valueField]=n,this.trigger("changed:before",this,o,t),t.isDefaultPrevented()||(this._selectedItem=this.store.findWhere(((i={})[this.displayField]=n,i)),this._selectedItem&&(o=this._selectedItem.toJSON(),$(".selected",$(this.el)).removeClass("selected"),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")),this.trigger("changed:after",this,o,t))):e&&e.onkeydown&&this.trigger("combo:blur",this,t)}},onInputClick:function(t){this._button&&this._button.dropdown("toggle"),t.preventDefault(),t.stopPropagation()},onEditableInputClick:function(t){if(this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}this.isMenuOpen()&&1==t.which&&t.stopPropagation()},setDefaultSelection:function(){if(this.rendered){var t,e=this._input.val();e&&(this._selectedItem=this.store.findWhere(((t={})[this.displayField]=e,t)),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")))}},setDisabled:function(t){t=!!t,this.disabled=t,this.rendered&&(t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this.cmpEl.toggleClass("disabled",t),this._button.toggleClass("disabled",t))},isDisabled:function(){return this.disabled},setRawValue:function(t){this.rendered&&(this._input.val(t).trigger("change",{synthetic:!0}),this.lastValue=null!=t?t.toString():t)},getRawValue:function(){return this.rendered?this._input.val():null},setValue:function(t,e){var i;this.rendered&&(this._selectedItem=this.store.findWhere(((i={})[this.valueField]=t,i)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem?(this.setRawValue(this._selectedItem.get(this.displayField)),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")):this.setRawValue(void 0!==e?e:t))},getValue:function(){return this.rendered?this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?this._selectedItem.get(this.valueField):this._input.val():null},getDisplayValue:function(t){return Common.Utils.String.htmlEncode(t[this.displayField])},getSelectedRecord:function(){return this.rendered&&this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?_.extend({},this._selectedItem.toJSON()):null},selectRecord:function(t){this.rendered&&t&&(this._selectedItem=t,$(".selected",$(this.el)).removeClass("selected"),this.setRawValue(this._selectedItem.get(this.displayField)),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected"))},itemClicked:function(t){var e=$(t.target).closest("li");this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&(this.lastValue=this._selectedItem.get(this.displayField),this._input.val(this.lastValue).trigger("change",{synthetic:!0}),$(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault()),this._isMouseDownMenu=!1},itemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;this._isMouseDownMenu=!0},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%- item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))},focus:function(){this._input&&this._input.focus()}}),Common.UI.ComboBoxCustom=Common.UI.ComboBox.extend(_.extend({itemClicked:function(t){Common.UI.ComboBox.prototype.itemClicked.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},setValue:function(t){Common.UI.ComboBox.prototype.setValue.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},selectRecord:function(t){Common.UI.ComboBox.prototype.selectRecord.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},focus:function(){this.cmpEl&&this.cmpEl.find(".form-control").focus()}},Common.UI.ComboBoxCustom||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/DataView",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],(function(){"use strict";Common.UI.DataViewGroupModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),caption:"",inline:!1,headername:void 0}}}),Common.UI.DataViewGroupStore=Backbone.Collection.extend({model:Common.UI.DataViewGroupModel}),Common.UI.DataViewModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),selected:!1,allowSelected:!0,value:null,disabled:!1}}}),Common.UI.DataViewStore=Backbone.Collection.extend({model:Common.UI.DataViewModel}),Common.UI.DataViewItem=Common.UI.BaseView.extend({options:{},template:_.template(['<div id="<%= id %>"><%= value %></div>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.dataHint=e.options.dataHint||"",e.dataHintDirection=e.options.dataHintDirection||"",e.dataHintOffset=e.options.dataHintOffset||"",e.listenTo(e.model,"change",this.model.get("skipRenderOnChange")?e.onChange:e.render),e.listenTo(e.model,"change:selected",e.onSelectChange),e.listenTo(e.model,"remove",e.remove)},render:function(){if(_.isUndefined(this.model.id))return this;var t=this.$el||$(this.el);t.html(this.template(this.model.toJSON())),t.addClass("item"),t.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),""!==this.dataHint&&(t.attr("data-hint",this.dataHint),t.attr("data-hint-direction",this.dataHintDirection),t.attr("data-hint-offset",this.dataHintOffset)),_.isUndefined(this.model.get("contentTarget"))||t.attr("content-target",this.model.get("contentTarget")),t.off("click dblclick contextmenu"),t.on({click:_.bind(this.onClick,this),dblclick:_.bind(this.onDblClick,this),contextmenu:_.bind(this.onContextMenu,this)}),t.toggleClass("disabled",!!this.model.get("disabled")),_.isUndefined(this.model.get("cls"))||t.addClass(this.model.get("cls"));var e=t.data("bs.tooltip");return e&&void 0===e.dontShow&&t.is(":hover")&&(e.dontShow=!0),this.trigger("change",this,this.model),this},remove:function(){this.stopListening(this.model),this.trigger("remove",this,this.model),Common.UI.BaseView.prototype.remove.call(this)},onClick:function(t){if(this.model.get("disabled"))return!1;this.trigger("click",this,this.model,t)},onDblClick:function(t){if(this.model.get("disabled"))return!1;this.trigger("dblclick",this,this.model,t)},onContextMenu:function(t){this.trigger("contextmenu",this,this.model,t)},onSelectChange:function(t,e){this.trigger("select",this,t,e)},onChange:function(){if(_.isUndefined(this.model.id))return this;var t=this.$el||$(this.el);return t.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),t.toggleClass("disabled",!!this.model.get("disabled")),this.trigger("change",this,this.model),this}}),Common.UI.DataView=Common.UI.BaseView.extend({options:{multiSelect:!1,handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,emptyText:"",listenStoreEvents:!0,allowScrollbar:!0,scrollAlwaysVisible:!1,minScrollbarLength:40,showLast:!0,useBSKeydown:!1,cls:""},template:_.template(['<div class="dataview inner <%= cls %>" style="<%= style %>">',"<% _.each(groups, function(group) { %>","<% if (group.headername !== undefined) { %>",'<div class="header-name"><%= group.headername %></div>',"<% } %>",'<div class="grouped-data <% if (group.inline) { %> inline <% } %> <% if (!_.isEmpty(group.caption)) { %> margin <% } %>" id="<%= group.id %>">',"<% if (!_.isEmpty(group.caption)) { %>",'<div class="group-description">',"<span><%= group.caption %></span>","</div>","<% } %>",'<div class="group-items-container">',"</div>","</div>","<% }); %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.store=e.options.store||new Common.UI.DataViewStore,e.groups=e.options.groups||null,e.itemTemplate=e.options.itemTemplate||null,e.itemDataHint=e.options.itemDataHint||"",e.itemDataHintDirection=e.options.itemDataHintDirection||"",e.itemDataHintOffset=e.options.itemDataHintOffset||"",e.multiSelect=e.options.multiSelect,e.handleSelect=e.options.handleSelect,e.parentMenu=e.options.parentMenu,e.outerMenu=e.options.outerMenu,e.enableKeyEvents=e.options.enableKeyEvents,e.useBSKeydown=e.options.useBSKeydown,e.showLast=e.options.showLast,e.style=e.options.style||"",e.cls=e.options.cls||"",e.emptyText=e.options.emptyText||"",e.listenStoreEvents=void 0===e.options.listenStoreEvents||e.options.listenStoreEvents,e.allowScrollbar=void 0===e.options.allowScrollbar||e.options.allowScrollbar,e.scrollAlwaysVisible=e.options.scrollAlwaysVisible||!1,e.minScrollbarLength=e.options.minScrollbarLength||40,e.tabindex=e.options.tabindex||0,e.delayRenderTips=e.options.delayRenderTips||!1,e.parentMenu&&(e.parentMenu.options.restoreHeight=e.options.restoreHeight>0),e.delaySelect=e.options.delaySelect||!1,e.rendered=!1,e.dataViewItems=[],"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],e.options.el&&e.render()},render:function(t){var e=this;this.trigger("render:before",this),t?(this.setElement(t,!1),this.cmpEl=$(this.template({groups:e.groups?e.groups.toJSON():null,style:e.style,cls:e.cls,options:e.options})),t.html(this.cmpEl)):(this.cmpEl=e.$el||$(this.el),this.cmpEl.html(this.template({groups:e.groups?e.groups.toJSON():null,style:e.style,cls:e.cls,options:e.options})));var i=this.cmpEl.closest(".asc-window");return i.length<1&&(i=this.cmpEl.closest('[id^="menu-container-"]')),i.length>0&&(this.tipZIndex=parseInt(i.css("z-index"))+10),this.rendered||(this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)),this.onResetItems(),this.parentMenu&&(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this))),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(e.showLast||this.parentMenu.on("show:before",(function(t){e.deselectAll()})),this.parentMenu.on("show:after",(function(t,i){i&&t.el!==i.target||(e.showLast&&e.showLastSelected(),Common.NotificationCenter.trigger("dataview:focus"),_.delay((function(){t.cmpEl.find(".dataview").focus()}),10))})).on("hide:after",(function(){Common.NotificationCenter.trigger("dataview:blur")})))),_.isUndefined(this.scroller)&&this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.rendered=!0,this.cmpEl.on("click",(function(t){if(/dataview/.test(t.target.className))return!1})),this.trigger("render:after",this),this},setStore:function(t){t&&(this.stopListening(this.store),this.store=t,this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)))},selectRecord:function(t,e){if(this.handleSelect)return e&&this.suspendEvents(),this.multiSelect?t&&t.set({selected:!t.get("selected")}):(_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),t&&t.set({selected:!0})),e&&this.resumeEvents(),t},selectByIndex:function(t,e){if(this.store.length>0&&t>-1&&t<this.store.length)return this.selectRecord(this.store.at(t),e)},deselectAll:function(t){t&&this.suspendEvents(),_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),t&&this.resumeEvents()},getSelectedRec:function(){return this.multiSelect?this.store.where({selected:!0}):this.store.findWhere({selected:!0})},onAddItem:function(t,e,i){var n=new Common.UI.DataViewItem({template:this.itemTemplate,model:t,dataHint:this.itemDataHint,dataHintDirection:this.itemDataHintDirection,dataHintOffset:this.itemDataHintOffset});if(n){var o=$(this.el).find(".inner").addBack().filter(".inner");if(this.groups&&this.groups.length>0){var s=this.groups.findWhere({id:t.get("group")});s&&(o=o.find("#"+s.id+" .group-items-container"))}var a=_.indexOf(this.store.models,t);if(o){if(i&&"number"==typeof i.at&&i.at>=0)if(0==i.at)o.prepend(n.render().el);else if(this.groups&&this.groups.length>0)o.append(n.render().el);else{var l=o.find("> div");a>0?$(l.get(a-1)).after(n.render().el):l.length>0?$(l[a]).before(n.render().el):o.append(n.render().el)}else o.append(n.render().el);this.dataViewItems.length<1&&o.find(".empty-text").remove(),this.dataViewItems=this.dataViewItems.slice(0,a).concat(n).concat(this.dataViewItems.slice(a));var r=this,c=$(n.el),d=t.get("tip");null!=d&&(this.delayRenderTips?c.one("mouseenter",(function(){c.attr("data-toggle","tooltip"),c.tooltip({title:t.get("tip"),placement:"cursor",zIndex:r.tipZIndex}),c.mouseenter()})):(c.attr("data-toggle","tooltip"),c.tooltip({title:t.get("tip"),placement:"cursor",zIndex:r.tipZIndex}))),this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),this.listenTo(n,"contextmenu",this.onContextMenuItem),this.isSuspendEvents||this.trigger("item:add",this,n,t)}}},onResetItems:function(){_.each(this.dataViewItems,(function(t){var e=t.$el.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.tip().remove())}),this),$(this.el).html(this.template({groups:this.groups?this.groups.toJSON():null,style:this.style,cls:this.cls,options:this.options})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.store.length<1&&this.emptyText.length>0&&$(this.el).find(".inner").addBack().filter(".inner").append('<table cellpadding="10" class="empty-text"><tr><td>'+this.emptyText+"</td></tr></table>"),_.each(this.dataViewItems,(function(t){this.stopListening(t),t.stopListening(t.model)}),this),this.dataViewItems=[];var t=this;this.store.each((function(e){t.onAddItem(e,t.store)}),this),this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.disabled&&this.setDisabled(this.disabled),this.attachKeyEvents(),this.lastSelectedRec=null,this._layoutParams=void 0},onChangeItem:function(t,e){this.isSuspendEvents||this.trigger("item:change",this,t,e)},onRemoveItem:function(t,e){var i=t.$el.data("bs.tooltip");if(i&&(void 0===i.dontShow&&(i.dontShow=!0),i.tip().remove()),this.stopListening(t),t.stopListening(),this.store.length<1&&this.emptyText.length>0){var n=$(this.el).find(".inner").addBack().filter(".inner");n.find(".empty-text").length<=0&&n.append('<table cellpadding="10" class="empty-text"><tr><td>'+this.emptyText+"</td></tr></table>")}for(var o=0;o<this.dataViewItems.length;o++)if(_.isEqual(t,this.dataViewItems[o])){this.dataViewItems.splice(o,1);break}this.isSuspendEvents||this.trigger("item:remove",this,t,e)},onClickItem:function(t,e,i){if(!this.disabled){window._event=i,this.showLast&&(this.delaySelect?(_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),e&&setTimeout(_.bind((function(){e.set({selected:!0}),this.trigger("item:click",this,t,e,i)}),this),300)):this.selectRecord(e)),this.lastSelectedRec=null;var n=t.$el.data("bs.tooltip");n&&n.tip().remove(),this.isSuspendEvents||this.delaySelect||this.trigger("item:click",this,t,e,i)}},onDblClickItem:function(t,e,i){this.disabled||(window._event=i,this.showLast&&this.selectRecord(e),this.lastSelectedRec=null,this.isSuspendEvents||this.trigger("item:dblclick",this,t,e,i))},onSelectItem:function(t,e,i){this.isSuspendEvents||this.trigger(i?"item:select":"item:deselect",this,t,e,this._fromKeyDown)},onContextMenuItem:function(t,e,i){this.isSuspendEvents||this.trigger("item:contextmenu",this,t,e,i)},scrollToRecord:function(t,e){if(t){var i=$(this.el).find(".inner"),n=i.offset().top,o=_.indexOf(this.store.models,t),s=o>=0&&this.dataViewItems.length>o?$(this.dataViewItems[o].el):i.find("#"+t.get("id"));if(!(s.length<=0)){var a=s.offset().top,l=$(this.dataViewItems[0].el),r=l.length>0?l[0].clientTop:0;(e||a<n+r||a+.9*s.outerHeight()>n+r+i.height())&&(this.scroller&&this.allowScrollbar?this.scroller.scrollTop(i.scrollTop()+a-n-r,0):i.scrollTop(i.scrollTop()+a-n-r))}}},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(null===this.lastSelectedRec&&(this.lastSelectedRec=i),e.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=null,this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.trigger("item:select",this,this,i,t),this.trigger("entervalue",this,i,t),this.parentMenu&&this.parentMenu.hide();else{var n=_.indexOf(this.store.models,i);if(n<0)if(e.keyCode==Common.UI.Keys.LEFT)(a=$(t.target).closest(".dropdown-submenu.over")).length>0?(a.removeClass("over"),a.find("> a").focus()):n=0;else n=0;else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var o=this.dataViewItems[n].topIdx,s=this.dataViewItems[n].leftIdx;if(n=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===n;){if(--s<0){var a;if((a=$(t.target).closest(".dropdown-submenu.over")).length>0){a.removeClass("over"),a.find("> a").focus();break}s=this._layoutParams.columns-1}n=this._layoutParams.itemsIndexes[o][s]}else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===n;)++s>this._layoutParams.columns-1&&(s=0),n=this._layoutParams.itemsIndexes[o][s];else if(e.keyCode==Common.UI.Keys.UP){if(0==o&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===n;)--o<0&&(o=this._layoutParams.rows-1),n=this._layoutParams.itemsIndexes[o][s]}else{if(o==this._layoutParams.rows-1&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===n;)++o>this._layoutParams.rows-1&&(o=0),n=this._layoutParams.itemsIndexes[o][s]}}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.store.length-1,n+1);void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this.scrollToRecord(i),this._fromKeyDown=!1)}}else this.trigger("item:keydown",this,i,t)},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var t=$(this.el).find(".inner").addBack().filter(".inner");t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this))}},showLastSelected:function(){this.lastSelectedRec?(this.selectRecord(this.lastSelectedRec,!0),this.scrollToRecord(this.lastSelectedRec),this.lastSelectedRec=null):this.scrollToRecord(this.getSelectedRec())},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).find(".inner").addBack().filter(".inner").toggleClass("disabled",t)},isDisabled:function(){return this.disabled},setEmptyText:function(t){if(this.emptyText=t,this.store.length<1){var e=$(this.el).find(".inner").addBack().filter(".inner").find(".empty-text td");e.length>0&&e.text(this.emptyText)}},alignPosition:function(){var t="menu"===this.parentMenu.cmpEl.attr("role")?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),e=Common.Utils.innerHeight()-10,i=$(this.el).find(".inner").addBack().filter(".inner"),n=i.parent(),o=parseInt(n.css("margin-top"))+parseInt(n.css("margin-bottom"))+parseInt(t.css("margin-top")),s=parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom")),a=t.outerHeight(),l=parseInt(t.css("top")),r={minScrollbarLength:this.minScrollbarLength};this.scrollAlwaysVisible&&(r.alwaysVisibleY=this.scrollAlwaysVisible),l+a>e?(i.css("max-height",e-l-s-o+"px"),this.allowScrollbar&&this.scroller.update(r)):l+a<e&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(e-l-s-o,this.options.restoreHeight)+"px"),this.allowScrollbar&&this.scroller.update(r))},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=$(this.dataViewItems[0].el),e=t.outerWidth()+parseFloat(t.css("margin-left"))+parseFloat(t.css("margin-right")),i=this.$el.offset().left,n=t.offset().top,o=-1,s=0,a=0,l=0;l<this.dataViewItems.length;l++){var r=$(this.dataViewItems[l].el).offset().top-n;a=Math.floor(($(this.dataViewItems[l].el).offset().left-i)/e+.01),r>o&&(o=r,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=l,this.dataViewItems[l].topIdx=s,this.dataViewItems[l].leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},onResize:function(){this._layoutParams=void 0},focus:function(t){var e;$(this.el).find(".inner").addBack().filter(".inner").focus(),"string"==typeof t?"first"==t?e=this.selectByIndex(0,!0):"last"==t&&(void 0===this._layoutParams&&this.fillIndexesArray(),e=this.selectByIndex(this._layoutParams.itemsIndexes[this._layoutParams.rows-1][0],!0)):void 0!==t&&(e=this.selectByIndex(t,!0)),this.scrollToRecord(e)},focusInner:function(t){this.focus(t.keyCode==Common.UI.Keys.DOWN?"first":"last")}}),Common.UI.DataViewSimple=Common.UI.BaseView.extend({options:{handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,scrollAlwaysVisible:!1,useBSKeydown:!1},template:_.template(['<div class="dataview inner" style="<%= style %>">',"<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" <% if(!!item.tip) { %> data-toggle="tooltip" <% } %> data-hint="<%= item.dataHint %>" data-hint-direction="<%= item.dataHintDirection %>" data-hint-offset="<%= item.dataHintOffset %>"><%= itemTemplate(item) %></div>',"<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.store=e.options.store||new Common.UI.DataViewStore,e.itemTemplate=e.options.itemTemplate||null,e.handleSelect=e.options.handleSelect,e.parentMenu=e.options.parentMenu,e.enableKeyEvents=e.options.enableKeyEvents,e.useBSKeydown=e.options.useBSKeydown,e.style=e.options.style||"",e.scrollAlwaysVisible=e.options.scrollAlwaysVisible||!1,e.tabindex=e.options.tabindex||0,e.parentMenu&&(e.parentMenu.options.restoreHeight=e.options.restoreHeight>0),e.rendered=!1,"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],e.options.el&&e.render()},render:function(t){var e=this;this.trigger("render:before",this),t?(this.setElement(t,!1),this.cmpEl=$(this.template({items:e.store.toJSON(),itemTemplate:e.itemTemplate,style:e.style})),t.html(this.cmpEl)):(this.cmpEl=e.$el||$(this.el),this.cmpEl.html(this.template({items:e.store.toJSON(),itemTemplate:e.itemTemplate,style:e.style,options:e.options})));var i=this.cmpEl.closest(".asc-window");return i.length<1&&(i=this.cmpEl.closest('[id^="menu-container-"]')),i.length>0&&(this.tipZIndex=parseInt(i.css("z-index"))+10),this.rendered||(this.parentMenu?(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this)),this.parentMenu.on("show:after",_.bind(this.onAfterShowMenu,this))):this.store.length>0&&this.onAfterShowMenu(),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(this.parentMenu.on("show:before",(function(t){e.deselectAll()})),this.parentMenu.on("show:after",(function(t){Common.NotificationCenter.trigger("dataview:focus"),_.delay((function(){t.cmpEl.find(".dataview").focus()}),10)})).on("hide:after",(function(){Common.NotificationCenter.trigger("dataview:blur")}))),this.attachKeyEvents(),this.cmpEl.on("click","div.item",_.bind(e.onClickItem,e))),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.rendered=!0,this.cmpEl.on("click",(function(t){if(/dataview/.test(t.target.className))return!1})),this.trigger("render:after",this),this},selectRecord:function(t,e){if(this.handleSelect){if(e&&this.suspendEvents(),this.deselectAll(e),t){t.set({selected:!0});var i=_.indexOf(this.store.models,t);i>=0&&this.dataViewItems&&this.dataViewItems.length>i&&this.dataViewItems[i].el.addClass("selected")}return e&&this.resumeEvents(),t}},selectByIndex:function(t,e){if(this.store.length>0&&t>-1&&t<this.store.length)return this.selectRecord(this.store.at(t),e)},deselectAll:function(t){t&&this.suspendEvents(),_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),this.cmpEl.find(".item.selected").removeClass("selected"),t&&this.resumeEvents()},getSelectedRec:function(){return this.store.findWhere({selected:!0})},onResetItems:function(){this.dataViewItems&&_.each(this.dataViewItems,(function(t){var e=t.el.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.tip().remove())}),this),this.dataViewItems=null;var t=_.template(["<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" <% if(!!item.tip) { %> data-toggle="tooltip" <% } %> data-hint="<%= item.dataHint %>" data-hint-direction="<%= item.dataHintDirection %>" data-hint-offset="<%= item.dataHintOffset %>"><%= itemTemplate(item) %></div>',"<% }) %>"].join(""));this.cmpEl&&this.cmpEl.find(".inner").html(t({items:this.store.toJSON(),itemTemplate:this.itemTemplate,style:this.style})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible}),!this.parentMenu&&this.store.length>0&&this.onAfterShowMenu(),this._layoutParams=void 0},setStore:function(t){t&&(this.store=t,this.onResetItems())},onClickItem:function(t){if(!this.disabled){window._event=t;var e=$(t.currentTarget).closest("div.item").index(),i=e>=0?this.store.at(e):null,n=e>=0?this.dataViewItems[e]:null;if(i&&n){i.set({selected:!0});var o=n.el.data("bs.tooltip");o&&o.tip().remove(),this.isSuspendEvents||this.trigger("item:click",this,n.el,i,t)}}},onAfterShowMenu:function(t){if(!this.dataViewItems){var e=this;this.dataViewItems=[],_.each(this.cmpEl.find("div.item"),(function(t,i){var n=$(t),o=e.store.at(i);e.dataViewItems.push({el:n}),o.get("tip")&&n.tooltip({title:o.get("tip"),placement:"cursor",zIndex:e.tipZIndex})}))}},scrollToRecord:function(t){if(t){var e=$(this.el).find(".inner"),i=e.offset().top,n=_.indexOf(this.store.models,t),o=n>=0&&this.dataViewItems.length>n?this.dataViewItems[n].el:e.find("#"+t.get("id"));if(!(o.length<=0)){var s=o.offset().top,a=this.dataViewItems[0].el,l=a.length>0?a[0].offsetTop:0;(s<i+l||s+o.outerHeight()>i+e.height())&&(this.scroller?this.scroller.scrollTop(e.scrollTop()+s-i-l,0):e.scrollTop(e.scrollTop()+s-i-l))}}},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(e.keyCode==Common.UI.Keys.RETURN)this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.canAddRecents&&this.addRecentItem(i),this.trigger("item:click",this,this,i,t),this.parentMenu&&this.parentMenu.hide();else{var n=_.indexOf(this.store.models,i);if(n<0){function l(){for(var t=0;!this.dataViewItems[t].el.is(":visible");)t++;return t}if(e.keyCode==Common.UI.Keys.LEFT)(a=$(t.target).closest(".dropdown-submenu.over")).length>0?(a.removeClass("over"),a.find("> a").focus()):n=l.call(this);else n=l.call(this)}else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var o=this.dataViewItems[n].topIdx,s=this.dataViewItems[n].leftIdx;if(n=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===n;){if(--s<0){var a;if((a=$(t.target).closest(".dropdown-submenu.over")).length>0){a.removeClass("over"),a.find("> a").focus();break}s=this._layoutParams.columns-1}n=this._layoutParams.itemsIndexes[o][s]}else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===n;)++s>this._layoutParams.columns-1&&(s=0),n=this._layoutParams.itemsIndexes[o][s];else if(e.keyCode==Common.UI.Keys.UP){if(0==o&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===n;)--o<0&&(o=this._layoutParams.rows-1),n=this._layoutParams.itemsIndexes[o][s]}else{if(o==this._layoutParams.rows-1&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===n;)++o>this._layoutParams.rows-1&&(o=0),n=this._layoutParams.itemsIndexes[o][s]}}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.store.length-1,n+1);void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this.scrollToRecord(i),this._fromKeyDown=!1)}}else this.trigger("item:keydown",this,i,t)},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var t=$(this.el).find(".inner").addBack().filter(".inner");t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this))}},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).find(".inner").addBack().filter(".inner").toggleClass("disabled",t)},isDisabled:function(){return this.disabled},alignPosition:function(){var t="menu"===this.parentMenu.cmpEl.attr("role")?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),e=Common.Utils.innerHeight()-10,i=$(this.el).find(".inner").addBack().filter(".inner"),n=i.parent(),o=parseInt(n.css("margin-top"))+parseInt(n.css("margin-bottom"))+parseInt(t.css("margin-top")),s=parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom")),a=t.outerHeight(),l=parseInt(t.css("top")),r={minScrollbarLength:this.minScrollbarLength};this.scrollAlwaysVisible&&(r.alwaysVisibleY=this.scrollAlwaysVisible),l+a>e?(i.css("max-height",e-l-s-o+"px"),this.scroller.update(r)):l+a<e&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(e-l-s-o,this.options.restoreHeight)+"px"),this.scroller.update(r))},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=this.dataViewItems[0].el,e=t.outerWidth()+parseFloat(t.css("margin-left"))+parseFloat(t.css("margin-right")),i=this.$el.offset().left,n=t.offset().top,o=-1,s=0,a=0,l=0;l<this.dataViewItems.length;l++){var r=this.dataViewItems[l],c=r.el.offset().top-n;a=Math.floor((r.el.offset().left-i)/e),c>o&&(o=c,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=l,r.topIdx=s,r.leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},onResize:function(){this._layoutParams=void 0},focus:function(){this.cmpEl&&this.cmpEl.find(".dataview").focus()}}),$(document).on("keydown.dataview","[data-toggle=dropdown], [role=menu]",(function(t){t.keyCode!==Common.UI.Keys.UP&&t.keyCode!==Common.UI.Keys.DOWN&&t.keyCode!==Common.UI.Keys.LEFT&&t.keyCode!==Common.UI.Keys.RIGHT&&t.keyCode!==Common.UI.Keys.RETURN||_.defer((function(){var e=$(t.target).closest(".dropdown-toggle");e.length?e.parent().find(".inner.canfocused").trigger("dataview:keydown",t):$(t.target).closest(".dropdown-submenu").find(".inner.canfocused").trigger("dataview:keydown",t)}),100)})),Common.UI.DataViewShape=Common.UI.DataViewSimple.extend(_.extend({template:_.template(['<div class="dataview inner" style="<%= style %>">',"<% _.each(options.groupsWithRecent, function(group, index) { %>",'<div class="grouped-data <% if (index === 0) { %> recent-group <% } %> " id="<%= group.id %>" >',"<% if (!_.isEmpty(group.groupName)) { %>",'<div class="group-description">',"<span><%= group.groupName %></span>","</div>","<% } %>",'<div class="group-items-container <% if (index === 0) { %> recent-items <% } %>">',"<% _.each(group.groupStore.toJSON(), function(item, index) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" data-index="<%= index %>"<% if(!!item.tip) { %> data-toggle="tooltip" <% } %> ><%= itemTemplate(item) %></div>',"<% }); %>","</div>","</div>","<% }); %>","</div>"].join("")),initialize:function(t){var e=this;this.canAddRecents=!0,this._state={hideTextRect:t.hideTextRect,hideLines:t.hideLines};var i=Common.localStorage.getKeysFilter();this.appPrefix=i&&i.length?i.split(",")[0]:"",e.groups=t.groups.toJSON();var n=new Common.UI.DataViewGroupStore,o=t.recentShapes||[],s=o.length>18?7:6,a=35*Math.ceil(o.length/s)+3,l=30*s;if((e.recentShapes=o,e.recentShapes.length>0)&&!_.findWhere(e.groups,{groupName:e.recentShapes[0].groupName})){for(var r=0;r<e.recentShapes.length;r++)for(var c,d=e.recentShapes[r].data.shapeType,h=0;h<e.groups.length;h++){for(var p=e.groups[h].groupStore,m=e.groups[h].groupName,u=0;u<p.length;u++)if(p.at(u).get("data").shapeType===d){c=p.at(u).toJSON(),e.recentShapes[r]={data:c.data,tip:c.tip,allowSelected:c.allowSelected,selected:!1,groupName:m};break}if(c){c=void 0;break}}Common.localStorage.setItem(this.appPrefix+"recent-shapes",JSON.stringify(e.recentShapes))}if(e.recentShapes.length<12){var g=12-e.recentShapes.length,f=[],b=function(t,e){var i=t.toJSON(),n={data:i.data,tip:i.tip,allowSelected:i.allowSelected,selected:!1,groupName:e};f.push(n)};for(u=0;u<e.groups.length&&g>0;u++){var C=e.groups[u].groupStore;m=e.groups[u].groupName;0===u?(b(C.at(1),m),--g>0&&(b(C.at(2),m),g--)):3!==u&&6!==u&&7!==u&&(b(C.at(0),m),--g>0&&(b(C.at(1),m),g--))}e.recentShapes=e.recentShapes.concat(f)}n.add(e.recentShapes),e.groups.unshift({groupName:t.textRecentlyUsed,groupStore:n,groupWidth:l,groupHeight:a}),e.options.groupsWithRecent=e.groups;p=new Common.UI.DataViewStore;_.each(e.groups,(function(t,e){var i=t.groupStore.models;if(e>0)for(var n=0;n<i.length;n++)i[n].set({groupName:t.groupName});p.add(i)})),t.store=p,Common.UI.DataViewSimple.prototype.initialize.call(this,t),e.parentMenu.on("show:before",(function(){e.updateRecents()})),e._state.hideLines&&e.hideLinesGroup()},onAfterShowMenu:function(t){var e=this,i=!1;if(e.dataViewItems||(e.dataViewItems=[],_.each(e.cmpEl.find("div.grouped-data"),(function(t,i){_.each($(t).find("div.item"),(function(t,n){var o=$(t),s=e.groups[i].groupStore.at(n);e.dataViewItems.push({el:o,groupIndex:i,index:n});var a=s.get("tip");a&&o.one("mouseenter",(function(){o.attr("data-toggle","tooltip"),o.tooltip({title:a,placement:"cursor",zIndex:e.tipZIndex}),o.mouseenter()}))}))})),i=!0),e.updateDataViewItems&&e.cmpEl.is(":visible")){for(var n=_.where(e.dataViewItems,{groupIndex:0}),o=n?n.length:0,s=0;s<o;s++){var a=e.dataViewItems[s].el.data("bs.tooltip");a&&(void 0===a.dontShow&&(a.dontShow=!0),a.tip().remove())}e.dataViewItems=e.dataViewItems.slice(o);var l=[];_.each(e.cmpEl.find(".recent-group div.item"),(function(t,i){var n=$(t),o=e.recentShapes[i];l.push({el:n,groupIndex:0,index:i});var s=o.tip;s&&n.one("mouseenter",(function(){n.attr("data-toggle","tooltip"),n.tooltip({title:s,placement:"cursor",zIndex:e.tipZIndex}),n.mouseenter()}))})),e.dataViewItems=l.concat(e.dataViewItems),1===e.recentShapes.length&&$(".recent-group").show(),e.updateDataViewItems=!1,i=!0}this._state.hideLines&&e.hideLines(),i&&e.hideTextRect(e._state.hideTextRect),e.fillIndexesArray()},onClickItem:function(t){if(!this.disabled){window._event=t;var e=$(t.currentTarget).closest("div.grouped-data").index(),i=$(t.currentTarget).closest("div.item").data("index"),n=_.findIndex(this.dataViewItems,(function(t){return t.groupIndex===e&&t.index===i})),o=n>=0?this.store.at(n):null,s=n>=0?this.dataViewItems[n]:null;if(o&&s){o.set({selected:!0});var a=s.el.data("bs.tooltip");a&&a.tip().remove(),this.isSuspendEvents||this.trigger("item:click",this,s.el,o,t),this.addRecentItem(o)}}},addRecentItem:function(t){for(var e=this,i=!1,n=t.get("data").shapeType,o=t.get("groupName"),s=0;s<e.recentShapes.length;s++)if(e.recentShapes[s].data.shapeType===n){i=!0;break}if(!i){var a=t.toJSON(),l=[{data:a.data,tip:a.tip,allowSelected:a.allowSelected,selected:!1,groupName:o}].concat(e.recentShapes.slice(0,11));Common.localStorage.setItem(this.appPrefix+"recent-shapes",JSON.stringify(l)),e.recentShapes=void 0}},updateRecents:function(){var t=this,e=Common.localStorage.getItem(this.appPrefix+"recent-shapes");e=e?JSON.parse(e):[];var i=!1;if(t.recentShapes)for(var n=0;n<e.length;n++)(!t.recentShapes[n]||t.recentShapes[n]&&e[n].tip!==t.recentShapes[n].tip)&&(i=!0);else i=!0;if(e.length>0&&i){t.recentShapes=e;var o=new Common.UI.DataViewStore;_.each(t.recentShapes,(function(t){var e={data:{shapeType:t.data.shapeType},tip:t.tip,allowSelected:t.allowSelected,selected:t.selected,groupName:t.groupName};o.push(e)})),t.groups[0].groupStore=o;var s=new Common.UI.DataViewStore;_.each(t.groups,(function(t){s.add(t.groupStore.models)})),t.store=s;var a=_.template(["<% _.each(items, function(item, index) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" data-index="<%= index %>"<% if(!!item.tip) { %> data-toggle="tooltip" <% } %> ><%= itemTemplate(item) %></div>',"<% }) %>"].join(""));t.cmpEl&&t.cmpEl.find(".recent-items").html(a({items:t.recentShapes,itemTemplate:this.itemTemplate,style:this.style})),t.updateDataViewItems=!0}},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=this.dataViewItems[0].el,e=0;!this.dataViewItems[e].el.is(":visible");)e++,t=this.dataViewItems[e].el;for(var i=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),n=this.$el.offset().left,o=t.offset().top,s=-1,a=0,l=e,r=0;r<this.dataViewItems.length;r++){var c=this.dataViewItems[r];if(c.el.is(":visible")){var d=c.el.offset().top-o;l=Math.floor((c.el.offset().left-n)/i),d>s&&(s=d,this._layoutParams.itemsIndexes.push([]),a=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[a][l]=r,c.topIdx=a,c.leftIdx=l,this._layoutParams.columns<l&&(this._layoutParams.columns=l)}else c.topIdx=-1,c.leftIdx=-1}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},hideTextRect:function(t){var e=this;this.store.each((function(i,n){"textRect"===i.get("data").shapeType&&e.dataViewItems[n].el[t?"addClass":"removeClass"]("hidden")}),this),this._state.hideTextRect=t},hideLinesGroup:function(){$(this.cmpEl.find("div.grouped-data")[9]).hide()},hideLines:function(){var t=this;this.store.each((function(e,i){if("Lines"===e.get("groupName")){var n=t.dataViewItems[i].el;n.is(":visible")&&n.addClass("hidden")}}),this)}}))})),void 0===Common)var Common={};if(define("common/main/lib/component/TreeView",["common/main/lib/component/DataView"],(function(){"use strict";Common.UI.TreeViewModel=Common.UI.DataViewModel.extend({defaults:function(){return{id:Common.UI.getId(),name:"",isNotHeader:!1,hasSubItems:!1,hasParent:!1,isEmptyItem:!1,isExpanded:!0,isVisible:!0,selected:!1,allowSelected:!0,disabled:!1,level:0,index:0}}}),Common.UI.TreeViewStore=Backbone.Collection.extend({model:Common.UI.TreeViewModel,expandSubItems:function(t){var e=this,i=function(t,n,o){for(var s=t+1;s<e.length;s++){var a=e.at(s),l=a.get("level");if(!(l>o))return s-1;n&&a.set("isVisible",!0),a.get("hasSubItems")&&(s=i(s,a.get("isExpanded"),l))}};t.set("isExpanded",!0),i(t.get("index"),!0,t.get("level"))},collapseSubItems:function(t){for(var e=t.get("level"),i=t.get("index")+1;i<this.length;i++){var n=this.at(i);if(!(n.get("level")>e))break;n.set("isVisible",!1)}return i-1},expandAll:function(){this.each((function(t){t.set("isExpanded",!0),t.set("isVisible",!0)}))},collapseAll:function(){for(var t=0;t<this.length;t++){var e=this.at(t);e.get("isNotHeader")||(e.set("isExpanded",!1),t=this.collapseSubItems(e))}},expandToLevel:function(t){for(var e=this,i=function(n,o){var s=e.at(n);s.set("isExpanded",!1);for(var a=n+1;a<e.length;a++){var l=e.at(a),r=l.get("level");if(!(r>o))return a-1;r<=t&&s.set("isExpanded",!0),l.set("isVisible",r<=t),l.get("hasSubItems")&&(a=i(a,r))}},n=0;n<this.length;n++){var o=this.at(n);(o.get("level")<=t||!o.get("hasParent"))&&(o.set("isVisible",!0),o.get("isNotHeader")||(n=i(n,o.get("level"))))}}}),Common.UI.TreeView=Common.UI.DataView.extend({options:{handleSelect:!0,showLast:!0,allowScrollbar:!0,scrollAlwaysVisible:!0,emptyItemText:"",keyMoveDirection:"both"},template:_.template(['<div class="treeview inner" style="<%= style %>"></div>'].join("")),initialize:function(t){t.store=t.store||new Common.UI.TreeViewStore,t.emptyItemText=t.emptyItemText||"",t.itemTemplate=t.itemTemplate||_.template(['<div id="<%= id %>" class="tree-item <% if (!isVisible) { %>hidden<% } %>" style="display: block;padding-left: <%= level*16 + 24 %>px;">',"<% if (hasSubItems) { %>",'<div class="tree-caret img-commonctrl <% if (!isExpanded) { %>up<% } %>" style="margin-left: <%= level*16 %>px;"></div>',"<% } %>","<% if (isNotHeader) { %>",'<div class="name not-header"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } else if (isEmptyItem) { %>",'<div class="name empty">'+t.emptyItemText+"</div>","<% } else { %>",'<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } %>","</div>"].join("")),Common.UI.DataView.prototype.initialize.call(this,t)},onAddItem:function(t,e,i){var n=new Common.UI.DataViewItem({template:this.itemTemplate,model:t});if(n){var o=(this.$el||$(this.el)).find(".inner").addBack().filter(".inner");if(o){if(this.dataViewItems.length<1&&o.find(".empty-text").remove(),i&&"number"==typeof i.at){var s=i.at,a=o.find("> div");s>0?$(a.get(s-1)).after(n.render().el):a.length>0?$(a[s]).before(n.render().el):o.append(n.render().el),this.dataViewItems=this.dataViewItems.slice(0,s).concat(n).concat(this.dataViewItems.slice(s))}else o.append(n.render().el),this.dataViewItems.push(n);this.updateTip(n),this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),this.listenTo(n,"contextmenu",this.onContextMenuItem),this.isSuspendEvents||this.trigger("item:add",this,n,t)}}},onClickItem:function(t,e,i){var n=$(i.target);if(n&&n.hasClass("tree-caret")){var o=t.$el.data("bs.tooltip");o&&o.tip().remove();var s=!e.get("isExpanded");e.set("isExpanded",s),this.store[s?"expandSubItems":"collapseSubItems"](e),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})}else Common.UI.DataView.prototype.onClickItem.call(this,t,e,i)},expandAll:function(){this.store.expandAll(),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})},collapseAll:function(){this.store.collapseAll(),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})},expandToLevel:function(t){this.store.expandToLevel(t),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})},expandRecord:function(t){t&&(t.set("isExpanded",!0),this.store.expandSubItems(t),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible}))},collapseRecord:function(t){t&&(t.set("isExpanded",!1),this.store.collapseSubItems(t),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible}))},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(null===this.lastSelectedRec&&(this.lastSelectedRec=i),e.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=null,this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.trigger("item:select",this,this,i,t),this.trigger("entervalue",this,i,t),this.parentMenu&&this.parentMenu.hide();else{var n=_.indexOf(this.store.models,i);if(n<0)if(e.keyCode==Common.UI.Keys.LEFT){var o=$(t.target).closest(".dropdown-submenu.over");o.length>0?(o.removeClass("over"),o.find("> a").focus()):n=0}else n=0;else if("both"==this.options.keyMoveDirection){var s=i.get("hasSubItems"),a=(i.get("hasParent"),i.get("isExpanded"));if(e.keyCode==Common.UI.Keys.LEFT)s&&a&&this.collapseRecord(i);else if(e.keyCode==Common.UI.Keys.RIGHT)s&&!a&&this.expandRecord(i);else if(e.keyCode==Common.UI.Keys.DOWN){for(var l=n+1;l<this.store.length;l++)if(this.store.at(l).get("isVisible")){n=l;break}}else if(e.keyCode==Common.UI.Keys.UP)for(l=n-1;l>=0;l--)if(this.store.at(l).get("isVisible")){n=l;break}}else n=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,n-1):Math.min(this.store.length-1,n+1);void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this._fromKeyDown=!1,this.scrollToRecord(i))}}else this.trigger("item:keydown",this,i,t)},focus:function(){this.cmpEl&&this.cmpEl.find(".treeview").focus()},updateTip:function(t){var e=t.model,i=e.get("name"),n=this;i.length>37-2*e.get("level")?e.set("tip",i):e.set("tip","");var o=t.$el||$(t.el),s=o.data("bs.tooltip");s&&(void 0===s.dontShow&&(s.dontShow=!0),o.removeData("bs.tooltip")),e.get("tip")&&(o.attr("data-toggle","tooltip"),o.tooltip({title:e.get("tip"),placement:"cursor",zIndex:this.tipZIndex}),this.delayRenderTips?o.one("mouseenter",(function(){o.attr("data-toggle","tooltip"),o.tooltip({title:e.get("tip"),placement:"cursor",zIndex:n.tipZIndex}),o.mouseenter()})):(o.attr("data-toggle","tooltip"),o.tooltip({title:e.get("tip"),placement:"cursor",zIndex:n.tipZIndex})))}})})),void 0===Common)var Common={};if(define("spreadsheeteditor/main/app/view/HyperlinkSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/ComboBox","common/main/lib/component/InputField","common/main/lib/component/Window","common/main/lib/component/TreeView"],(function(){"use strict";SSE.Views.HyperlinkSettingsDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 313px;">','<div class="input-row" style="margin-bottom: 10px;">','<button type="button" class="btn btn-text-default auto" id="id-dlg-hyperlink-external" style="border-top-right-radius: 0;border-bottom-right-radius: 0;">',this.textExternalLink,"</button>",'<button type="button" class="btn btn-text-default auto" id="id-dlg-hyperlink-internal" style="border-top-left-radius: 0;border-bottom-left-radius: 0;border-left-width: 0;margin-left: -1px;">',this.textInternalLink,"</button>","</div>",'<div id="id-external-link">','<div class="input-row">',"<label>"+this.strLinkTo+"</label>","</div>",'<div id="id-dlg-hyperlink-url" class="input-row" style="margin-bottom: 5px;"></div>',"</div>",'<div id="id-internal-link" class="hidden">','<div class="input-row">',"<label>"+this.strLinkTo+"</label>",'<div style="display: inline-block; position: relative;min-width: 150px;float: right;">','<label class="link dropdown-toggle" data-toggle="dropdown" id="id-dlg-hyperlink-get-link" style="line-height: 14px; margin-top: 3px;float: right;">'+this.textGetLink+"</label>",'<div id="id-clip-copy-box" class="dropdown-menu" style="width: 291px; left: -139px; padding: 10px;">','<div id="id-dlg-clip-copy"></div>','<button id="id-dlg-copy-btn" class="btn btn-text-default" style="margin-left: 5px; width: 86px;">'+this.textCopy+"</button>","</div>","</div>","</div>",'<div id="id-dlg-hyperlink-list" style="width:100%; height: 115px;"></div>','<div class="input-row">',"<label>"+this.strRange+"</label>","</div>",'<div id="id-dlg-hyperlink-range" class="input-row" style="margin-bottom: 5px;"></div>',"</div>",'<div class="input-row">',"<label>"+this.strDisplay+"</label>","</div>",'<div id="id-dlg-hyperlink-display" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textTipText+"</label>","</div>",'<div id="id-dlg-hyperlink-tip" class="input-row" style="margin-bottom: 5px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.api=this.options.api,this.appOptions=t.appOptions,this.dataRangeValid="",this.urlType=AscCommon.c_oAscUrlType.Invalid,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild(),e=this;if(e.btnExternal=new Common.UI.Button({el:$("#id-dlg-hyperlink-external"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1,pressed:!0}),e.btnExternal.on("click",_.bind(e.onLinkTypeClick,e,Asc.c_oAscHyperlinkType.WebLink)),e.btnInternal=new Common.UI.Button({el:$("#id-dlg-hyperlink-internal"),enableToggle:!0,toggleGroup:"hyperlink-type",allowDepress:!1}),e.btnInternal.on("click",_.bind(e.onLinkTypeClick,e,Asc.c_oAscHyperlinkType.RangeLink)),e.inputUrl=new Common.UI.InputField({el:$("#id-dlg-hyperlink-url"),allowBlank:!1,blankError:e.txtEmpty,validateOnBlur:!1,style:"width: 100%;",validation:function(t){var i=$.trim(t);return e.api.asc_getFullHyperlinkLength(i)>2083?e.txtSizeLimit:(e.urlType=e.api.asc_getUrlType(i),e.urlType!==AscCommon.c_oAscUrlType.Invalid||e.txtNotUrl)}}),e.inputUrl._input.on("input",(function(t){e.isInputFirstChange_url&&e.inputUrl.showError(),e.isInputFirstChange_url=!1;var i=$(t.target).val();e.isAutoUpdate&&e.inputDisplay.setValue(i),e.btnOk.setDisabled(""==$.trim(i))})),e.inputRange=new Common.UI.InputFieldBtn({el:$("#id-dlg-hyperlink-range"),allowBlank:!1,blankError:e.txtEmpty,style:"width: 100%;",btnHint:e.textSelectData,validateOnChange:!0,validateOnBlur:!1,value:Common.Utils.InternalSettings.get("sse-settings-r1c1")?"R1C1":"A1",validation:function(t){return!!e.inputRange.isDisabled()||(e.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.FormatTable,t,!1)==Asc.c_oAscError.ID.No||e.textInvalidRange)}}),e.inputRange._input.on("input",(function(t){e.isInputFirstChange_range&&e.inputRange.showError(),e.isInputFirstChange_range=!1;var i=$(t.target).val();e.isAutoUpdate&&e.inputDisplay.setValue(e.internalList.getSelectedRec().get("name")+(""!==i?"!"+i:"")),e.btnOk.setDisabled(""==$.trim(i))})),e.inputRange.on("button:click",_.bind(e.onSelectData,e)),e.inputDisplay=new Common.UI.InputField({el:$("#id-dlg-hyperlink-display"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}),e.inputDisplay._input.on("input",(function(t){e.isAutoUpdate=""==$(t.target).val()})),e.inputTip=new Common.UI.InputField({el:$("#id-dlg-hyperlink-tip"),style:"width: 100%;",maxLength:Asc.c_oAscMaxTooltipLength}),e.internalList=new Common.UI.TreeView({el:$("#id-dlg-hyperlink-list"),store:new Common.UI.TreeViewStore,tabindex:1,enableKeyEvents:!0}),e.internalList.on("item:select",_.bind(this.onSelectItem,this)),e.appOptions&&e.appOptions.canMakeActionLink){var i=new Common.UI.InputField({el:$("#id-dlg-clip-copy"),editable:!1,style:"width: 176px;"}),n=t.find("#id-clip-copy-box");n.on("click",_.bind((function(){return!1}),this)),n.parent().on({"shown.bs.dropdown":function(){_.delay((function(){i._input.select().focus()}),100)}}),n.find("button").on("click",(function(){i._input.select(),document.execCommand("copy")})),Common.Gateway.on("setactionlink",(function(t){i.setValue(t)}))}e.linkGetLink=$("#id-dlg-hyperlink-get-link"),e.linkGetLink.toggleClass("hidden",!(e.appOptions&&e.appOptions.canMakeActionLink)),e.btnOk=new Common.UI.Button({el:t.find(".primary"),disabled:!0}),t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),e.internalList.on("entervalue",_.bind(e.onPrimary,e)),t.on("click","#id-dlg-hyperlink-get-link",_.bind(e.getLink,e)),e.externalPanel=t.find("#id-external-link"),e.internalPanel=t.find("#id-internal-link")},getFocusedComponents:function(){return[this.inputUrl,this.internalList,this.inputRange,this.inputDisplay,this.inputTip]},show:function(){Common.UI.Window.prototype.show.apply(this,arguments),Common.Utils.InternalSettings.set("sse-dialog-link-visible",!0)},close:function(){Common.Utils.InternalSettings.set("sse-dialog-link-visible",!1),Common.UI.Window.prototype.close.apply(this,arguments)},setSettings:function(t){if(t){var e=this;e.settings=t;var i=t.props?t.props.asc_getType():Common.Utils.InternalSettings.get("sse-settings-link-type")&&t.allowInternal?Asc.c_oAscHyperlinkType.RangeLink:Asc.c_oAscHyperlinkType.WebLink;i==Asc.c_oAscHyperlinkType.WebLink?e.btnExternal.toggle(!0):e.btnInternal.toggle(!0),e.ShowHideElem(i,t.props),e.btnInternal.setDisabled(!t.allowInternal&&i==Asc.c_oAscHyperlinkType.WebLink),e.btnExternal.setDisabled(!t.allowInternal&&i==Asc.c_oAscHyperlinkType.RangeLink);var n="";t.props?(i==Asc.c_oAscHyperlinkType.RangeLink?t.props.asc_getSheet()?(this.inputRange.setValue(t.props.asc_getRange()),this.dataRangeValid=this.inputRange.getValue(),n=t.props.asc_getSheet()+"!"+t.props.asc_getRange()):(this.inputRange.setDisabled(!0),n=t.props.asc_getLocation()):(this.inputUrl.setValue(t.props.asc_getHyperlinkUrl().replace(new RegExp(" ","g"),"%20")),this.btnOk.setDisabled(""==$.trim(this.inputUrl.getValue()))),this.inputDisplay.setValue(t.isLock?this.textDefault:t.props.asc_getText()),this.inputTip.setValue(t.props.asc_getTooltip())):this.inputDisplay.setValue(t.isLock?this.textDefault:t.text),this.inputDisplay.setDisabled(t.isLock),!t.isLock&&(this.isAutoUpdate=""==this.inputDisplay.getValue()||i==Asc.c_oAscHyperlinkType.WebLink&&e.inputUrl.getValue()==e.inputDisplay.getValue()||i==Asc.c_oAscHyperlinkType.RangeLink&&n==e.inputDisplay.getValue())}},getSettings:function(){var t=new Asc.asc_CHyperlink,e="",i=this.btnInternal.isActive()?Asc.c_oAscHyperlinkType.RangeLink:Asc.c_oAscHyperlinkType.WebLink;if(t.asc_setType(i),i==Asc.c_oAscHyperlinkType.RangeLink){var n=this.internalList.getSelectedRec();n&&n.get("level")>0&&(n.get("type")?(t.asc_setSheet(null),t.asc_setLocation(n.get("name")),e=n.get("name")):(t.asc_setSheet(n.get("name")),t.asc_setRange(this.inputRange.getValue()),e=n.get("name")+"!"+this.inputRange.getValue()))}else{var o=this.inputUrl.getValue().replace(/^\s+|\s+$/g,"");this.urlType===AscCommon.c_oAscUrlType.Unsafe||/(((^https?)|(^ftp)):\/\/)|(^mailto:)/i.test(o)||(o=(this.urlType==AscCommon.c_oAscUrlType.Email?"mailto:":"http://")+o),o=o.replace(new RegExp("%20","g")," "),t.asc_setHyperlinkUrl(o),e=o}return this.inputDisplay.isDisabled()?t.asc_setText(null):((_.isEmpty(this.inputDisplay.getValue())||i==Asc.c_oAscHyperlinkType.WebLink&&this.isAutoUpdate)&&this.inputDisplay.setValue(e),t.asc_setText(this.inputDisplay.getValue())),t.asc_setTooltip(this.inputTip.getValue()),t},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.options.handler){if("ok"==t){var e=!this.btnExternal.isActive()||this.inputUrl.checkValidate(),i=!this.btnInternal.isActive()||this.inputRange.checkValidate(),n=this.inputDisplay.checkValidate();if(!0!==e)return this.inputUrl.focus(),void(this.isInputFirstChange_url=!0);if(!0!==i)return this.inputRange.focus(),void(this.isInputFirstChange_range=!0);if(!0!==n)return void this.inputDisplay.focus();!this.settings.props&&Common.Utils.InternalSettings.set("sse-settings-link-type",this.btnInternal.isActive())}this.options.handler.call(this,this,t)}this.close()},ShowHideElem:function(t,e){this.externalPanel.toggleClass("hidden",t!==Asc.c_oAscHyperlinkType.WebLink),this.internalPanel.toggleClass("hidden",t!==Asc.c_oAscHyperlinkType.RangeLink);var i=this.internalList.store;if(t==Asc.c_oAscHyperlinkType.RangeLink){if(i.length<1&&this.settings){var n=this.settings.sheets,o=n.length,s=[];s.push(new Common.UI.TreeViewModel({name:this.textSheets,level:0,index:0,hasParent:!1,isEmptyItem:!1,isNotHeader:!0,isExpanded:!1,hasSubItems:!0}));for(var a=0;a<o;a++)!n[a].hidden&&s.push(new Common.UI.TreeViewModel({name:n[a].name,level:1,index:a+1,type:0,isVisible:!1,hasParent:!0}));s.push(new Common.UI.TreeViewModel({name:this.textNames,level:0,index:s.length,hasParent:!1,isEmptyItem:!1,isNotHeader:!1,isExpanded:!1,hasSubItems:!1}));var l=s[s.length-1],r=this.settings.ranges,c=0;o=r.length;for(a=0;a<o;a++){var d=r[a],h=d.asc_getScope();d.asc_getIsHidden()||(c<1&&s[s.length-1].set("hasSubItems",!0),s.push(new Common.UI.TreeViewModel({name:(d.asc_getIsXlnm()&&n[h]?n[h].name+"!":"")+d.asc_getName(),level:1,index:s.length,type:1,isVisible:!1,hasParent:!0})),c=1)}i.reset(s);var p=e?e.asc_getSheet()||e.asc_getLocation():this.settings.currentSheet;(m=i.findWhere({name:p}))&&(this.internalList.expandRecord(m.get("type")?l:i.at(0)),this.internalList.scrollToRecord(this.internalList.selectRecord(m)))}var m=this.internalList.getSelectedRec();this.btnOk.setDisabled(!m||0==m.get("level")||0==m.get("type")&&""==$.trim(this.inputRange.getValue()));var u=this;_.delay((function(){u.inputRange.isDisabled()?u.internalList.focus():u.inputRange.focus()}),50)}else{this.btnOk.setDisabled(""==$.trim(this.inputUrl.getValue()));u=this;_.delay((function(){u.inputUrl.focus()}),50)}},onLinkTypeClick:function(t,e,i){if(this.ShowHideElem(t),this.isAutoUpdate)if(t==Asc.c_oAscHyperlinkType.RangeLink){var n=this.internalList.getSelectedRec(),o=n&&n.get("level")?n.get("name"):"";if(n&&1==n.get("type"))this.inputDisplay.setValue(o);else{var s=this.inputRange.getValue();this.inputDisplay.setValue(o+(""!==o&&""!==s?"!":"")+s)}}else this.inputDisplay.setValue(this.inputUrl.getValue())},onSelectItem:function(t,e,i,n){if(this.btnOk.setDisabled(0==i.get("level")||0==i.get("type")&&""==$.trim(this.inputRange.getValue())),this.inputRange.setDisabled(1==i.get("type")||0==i.get("level")),this.isAutoUpdate){var o=i.get("level")?i.get("name"):"";if(1==i.get("type"))this.inputDisplay.setValue(o);else{var s=this.inputRange.getValue();this.inputDisplay.setValue(o+(""!==o&&""!==s?"!":"")+s)}}this.linkGetLink.toggleClass("disabled",0==i.get("level"))},getLink:function(t){if(!t.cmpEl||!t.cmpEl.parent().hasClass("open")){var e=this.internalList.getSelectedRec();if(e&&e.get("level")){var i=e.get("name");if(1==e.get("type"))this.inputDisplay.setValue(i);else{var n=this.inputRange.getValue();i=(i=this.api.asc_getEscapeSheetName(i))+(""!==i&&""!==n?"!":"")+n}i&&Common.Gateway.requestMakeActionLink({action:{type:"internallink",data:i}})}}},onSelectData:function(){var t=this;if(t.api){var e=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.dataRangeValid=e.getSettings(),t.inputRange.setValue(t.dataRangeValid),t.inputRange.checkValidate())}}).on("close",(function(){t.show(),_.delay((function(){t.inputRange.focus()}),1)})),i=t.$window.offset();t.hide(),e.show(i.left+160,i.top+125),e.setSettings({api:t.api,range:_.isEmpty(t.inputRange.getValue())||1!=t.inputRange.checkValidate()?t.dataRangeValid:t.inputRange.getValue(),type:Asc.c_oAscSelectionDialogType.FormatTable})}},textTitle:"Hyperlink Settings",textInternalLink:"Place in Document",textExternalLink:"Web Link",textEmptyLink:"Enter link here",textEmptyDesc:"Enter caption here",textEmptyTooltip:"Enter tooltip here",strSheet:"Sheet",strRange:"Range",strDisplay:"Display",textTipText:"Screen Tip Text",strLinkTo:"Link To",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",txtNotUrl:'This field should be a URL in the format "http://www.example.com"',textDefault:"Selected range",textSheets:"Sheets",textNames:"Defined names",textGetLink:"Get Link",textCopy:"Copy",textSelectData:"Select data",txtSizeLimit:"This field is limited to 2083 characters"},SSE.Views.HyperlinkSettingsDialog||{}))})),define("text!spreadsheeteditor/main/app/template/ParagraphSettingsAdvanced.template",[],(function(){return'<div id="id-adv-paragraph-indents" class="settings-panel active">\r\n    <div class="inner-content">\r\n        <div>\r\n            <div class="padding-large" style="display: inline-block;">\r\n                <label class="input-label"><%= scope.textAlign %></label>\r\n                <div id="paragraphadv-spin-text-alignment"></div>\r\n            </div>\r\n        </div>\r\n        <div class="padding-very-small"><label class="header"><%= scope.strIndent %></label></div>\r\n        <div>\r\n            <div class="padding-large" style="display: inline-block;margin-right: 3px;">\r\n                <label class="input-label"><%= scope.strIndentsLeftText %></label>\r\n                <div id="paragraphadv-spin-indent-left"></div>\r\n            </div>\x3c!--\r\n         --\x3e<div class="padding-large" style="display: inline-block;margin-right: 3px;">\r\n                <label class="input-label"><%= scope.strIndentsRightText %></label>\r\n                <div id="paragraphadv-spin-indent-right"></div>\r\n            </div>\x3c!--\r\n         --\x3e<div class="padding-large" style="display: inline-block;vertical-align: top">\r\n                <div>\r\n                    <label class="input-label"><%= scope.strIndentsSpecial %></label>\r\n                </div>\r\n                <div>\r\n                    <div id="paragraphadv-spin-special" style="display: inline-block;margin-right: 3px;"></div>\x3c!--\r\n                 --\x3e<div id="paragraphadv-spin-special-by" style="display: inline-block;"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="padding-very-small"><label class="header"><%= scope.strSpacing %></label></div>\r\n        <div>\r\n            <div style="display: inline-block;margin-right: 3px;">\r\n                <label class="input-label"><%= scope.strIndentsSpacingBefore %></label>\r\n                <div id="paragraphadv-spin-spacing-before"></div>\r\n            </div>\x3c!--\r\n         --\x3e<div style="display: inline-block;margin-right: 3px;">\r\n                <label class="input-label"><%= scope.strIndentsSpacingAfter %></label>\r\n                <div id="paragraphadv-spin-spacing-after"></div>\r\n            </div>\x3c!--\r\n         --\x3e<div style="display: inline-block;vertical-align: top">\r\n                <div>\r\n                    <label class="input-label"><%= scope.strIndentsLineSpacing %></label>\r\n                </div>\r\n                <div>\r\n                    <div id="paragraphadv-spin-line-rule" style="display: inline-block;margin-right: 3px;"></div>\x3c!--\r\n                 --\x3e<div id="paragraphadv-spin-line-height" style="display: inline-block;"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="padding-large" style="padding-top: 16px; display: none;">\r\n            <div style="border: 1px solid #cbcbcb; width: 350px;">\r\n                <div id="paragraphadv-indent-preview" style="height: 80px; position: relative;"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-font" class="settings-panel">\r\n    <div class="inner-content" style="width: 100%;">\r\n        <div class="padding-very-small">\r\n            <label class="header"><%= scope.textEffects %></label>\r\n        </div>\r\n        <table cols="2">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-strike"></div>\r\n                </td>\r\n                <td class="padding-small" style="padding-left: 40px;">\r\n                    <div id="paragraphadv-checkbox-subscript"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="paragraphadv-checkbox-double-strike"></div>\r\n                </td>\r\n                <td class="padding-small" style="padding-left: 40px;">\r\n                    <div id="paragraphadv-checkbox-small-caps"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <div id="paragraphadv-checkbox-superscript"></div>\r\n                </td>\r\n                <td class="padding-large" style="padding-left: 40px;">\r\n                    <div id="paragraphadv-checkbox-all-caps"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="padding-very-small">\r\n            <label class="header"><%= scope.textCharacterSpacing %></label>\r\n        </div>\r\n        <div class="padding-large">\r\n            <div style="display: inline-block;">\r\n                <div id="paragraphadv-spin-spacing"></div>\r\n            </div>\r\n        </div>\r\n        <div class="doc-content-color" style="border: 1px solid #cbcbcb;">\r\n            <div id="paragraphadv-font-img" style="width: 300px; height: 80px; position: relative; margin: 0 auto;"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div id="id-adv-paragraph-tabs" class="settings-panel">\r\n    <div class="inner-content">\r\n        <div class="padding-large">\r\n            <label class="input-label"><%= scope.textDefault %></label>\r\n            <div id="paraadv-spin-default-tab"></div>\r\n\r\n        </div>\r\n        <div>\r\n            <div class="padding-large" style="display: inline-block; margin-right: 9px;">\r\n                <label class="input-label"><%= scope.textTabPosition %></label>\r\n                <div id="paraadv-spin-tab"></div>\r\n            </div>\r\n            <div class="padding-large" style=" display: inline-block; margin-right: 9px;">\r\n                <label class="input-label"><%= scope.textAlign %></label>\r\n                <div id="paraadv-cmb-align"></div>\r\n            </div>\r\n        </div>\r\n        <div>\r\n            <div colspan=3 class="padding-large">\r\n                <div id="paraadv-list-tabs" style="width:348px; height: 116px;"></div>\r\n            </div>\r\n        </div>\r\n        <div>\r\n            <button type="button" class="btn btn-text-default" id="paraadv-button-add-tab" style="width:108px;margin-right: 9px; display: inline-block;"><%= scope.textSet %></button>\r\n            <button type="button" class="btn btn-text-default" id="paraadv-button-remove-tab" style="width:108px;margin-right: 9px; display: inline-block;"><%= scope.textRemove %></button>\r\n            <button type="button" class="btn btn-text-default" id="paraadv-button-remove-all" style="width:108px;display: inline-block;"><%= scope.textRemoveAll %></button>\r\n        </div>\r\n    </div>\r\n</div>'})),define("common/main/lib/view/AdvancedSettingsWindow",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.AdvancedSettingsWindow=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{height:200,header:!0,cls:"advanced-settings-dlg",toggleGroup:"advanced-settings-group",contentTemplate:"",items:[],buttons:["ok","cancel"]},t),this.template=t.template||['<div class="box" style="height:'+(e.height-85)+'px;">','<div class="menu-panel">',"<% _.each(items, function(item) { %>",'<button class="btn btn-category" content-target="<%= item.panelId %>"><span class=""><%= item.panelCaption %></span></button>',"<% }); %>","</div>",'<div class="separator"></div>','<div class="content-panel" >'+e.contentTemplate+"</div>","</div>",'<div class="separator horizontal"></div>'].join(""),e.tpl=_.template(this.template)(e),this.handler=e.handler,this.toggleGroup=e.toggleGroup,this.contentWidth=e.contentWidth,this.storageName=e.storageName,Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onDlgBtnClick,this)),this.on("animate:after",_.bind(this.onAnimateAfter,this)),this.btnsCategory=[],_.each(e.find(".btn-category"),(function(e,i){var n=$(e),o=new Common.UI.Button({el:n,enableToggle:!0,toggleGroup:t.toggleGroup,allowDepress:!1,contentTarget:n.attr("content-target")});o.on("click",_.bind(t.onCategoryClick,t,o,i)),t.btnsCategory.push(o)}));var i=e.find(".content-panel"),n=e.find(".menu-panel");i.width(this.contentWidth),e.width((n.length>0?n.width():0)+i.outerWidth()+2),this.content_panels=e.find(".settings-panel"),this.btnsCategory.length>0&&this.btnsCategory[0].toggle(!0,!0)},setHeight:function(t){Common.UI.Window.prototype.setHeight.call(this,t),this.getChild().find(".body > .box").css("height",t-85)},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0)||this.close()},onCategoryClick:function(t,e){this.content_panels.filter(".active").removeClass("active"),$("#"+t.options.contentTarget).addClass("active")},getSettings:function(){},onPrimary:function(){if(!this.handler||!this.handler.call(this,"ok",this.getSettings()))return this.close(),!1},setActiveCategory:function(t){if(!(this.btnsCategory.length<1)){t=t>=0&&t<this.btnsCategory.length?t:0;var e=this.btnsCategory[t];if(!e.isVisible()||e.isDisabled())for(var i=0;i<this.btnsCategory.length;i++){var n=this.btnsCategory[i];if(n.isVisible()&&!n.isDisabled()){e=n,t=i;break}}e.toggle(!0),this.onCategoryClick(e,t)}},getActiveCategory:function(){var t=-1;return this.btnsCategory.forEach((function(e,i){e.pressed&&(t=i)})),t},close:function(t){this.storageName&&Common.localStorage.setItem(this.storageName,this.getActiveCategory()),Common.UI.Window.prototype.close.call(this,t)},onAnimateAfter:function(){}},Common.Views.AdvancedSettingsWindow||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/RadioBox",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.RadioBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,template:e.template('<div class="radiobox" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>"><input type="radio" name="<%= name %>" id="<%= id %>" class="button__radiobox"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><circle class="rb-circle" cx="8" cy="8" r="6.5" /><circle class="rb-check-mark" cx="8" cy="8" r="4" /></svg><span></span></div>'),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.dataHint=t.dataHint,this.dataHintDirection=t.dataHintDirection,this.dataHintOffset=t.dataHintOffset;this.name=this.options.name||Common.UI.getId(),this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.checked&&this.setValue(this.options.checked,!0),this.setCaption(this.options.labelText)},render:function(){var t=this.$el||$(this.el);return t.html(this.template({labelText:this.options.labelText,name:this.name,id:Common.UI.getId("rdb-"),dataHint:this.dataHint,dataHintDirection:this.dataHintDirection,dataHintOffset:this.dataHintOffset})),this.$radio=t.find("input[type=radio]"),this.$label=t.find("div.radiobox"),this.$span=this.$label.find("span"),this.$label.on({keydown:this.onKeyDown.bind(this),click:function(t){this.disabled||this.setValue(!0)}.bind(this)}),this.rendered=!0,this},setDisabled:function(t){this.rendered&&((t=!!t)!==this.disabled&&(this.$label.toggleClass("disabled",t),this.$radio.toggleClass("disabled",t),t?this.$radio.attr({disabled:t}):this.$radio.removeAttr("disabled"),void 0!==this.tabindex&&(t&&(this.tabindex=this.$label.attr("tabindex")),this.$label.attr("tabindex",t?"-1":this.tabindex))),this.disabled=t)},isDisabled:function(){return this.disabled},onItemCheck:function(t){this.disabled||this.setValue(!0)},setRawValue:function(t){(t=!0===t||"true"===t||"1"===t||1===t)&&$("input[type=radio][name="+this.name+"]").removeClass("checked"),this.$radio.toggleClass("checked",t),this.$radio.prop("checked",t)},setValue:function(t,e){if(this.rendered){var i=this.$radio.hasClass("checked");this.setRawValue(t),!0!==e&&i!==t&&this.trigger("change",this,this.$radio.is(":checked"))}else this.options.checked=t},getValue:function(){return this.$radio.is(":checked")},setCaption:function(t){this.$span.text(t),this.$span.css("visibility",t?"visible":"hidden")},onKeyDown:function(t){t.isDefaultPrevented()||t.keyCode===Common.UI.Keys.SPACE&&this.onItemCheck(t)},focus:function(){this.$label&&this.$label.focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this.$label.attr("tabindex",this.tabindex))}})})),void 0===Common)var Common={};if(define("common/main/lib/component/ListView",["common/main/lib/component/DataView"],(function(){"use strict";Common.UI.ListView=Common.UI.DataView.extend({options:{handleSelect:!0,enableKeyEvents:!0,showLast:!0,simpleAddMode:!1,keyMoveDirection:"vertical",itemTemplate:_.template('<div id="<%= id %>" class="list-item" style=""><%= value %></div>'),cls:""},template:_.template(['<div class="listview inner <%= cls %>" <% if (options.dataHint) { %> data-hint="<%= options.dataHint %>" <% } if (options.dataHintDirection) { %> data-hint-direction="<%= options.dataHintDirection %>" <% } if (options.dataHintOffset) { %> data-hint-offset="<%= options.dataHintOffset %>" <% } %>></div>'].join("")),onResetItems:function(){this.innerEl=null,Common.UI.DataView.prototype.onResetItems.call(this),this.trigger("items:reset",this)},createNewItem:function(t){return new Common.UI.DataViewItem({template:this.itemTemplate,model:t})},onAddItem:function(t,e,i){var n=this.createNewItem(t);if(this.innerEl||(this.innerEl=$(this.el).find(".inner")),n&&this.innerEl){if(this.dataViewItems.length<1&&this.innerEl.find(".empty-text").remove(),this.options.simpleAddMode)this.innerEl.append(n.render().el),this.dataViewItems.push(n);else{var o=_.indexOf(this.store.models,t),s=this.innerEl.find("> div");o>0?$(s.get(o-1)).after(n.render().el):s.length>0?$(s[o]).before(n.render().el):this.innerEl.append(n.render().el),this.dataViewItems=this.dataViewItems.slice(0,o).concat(n).concat(this.dataViewItems.slice(o))}if(this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),t.get("tip")){var a=$(n.el);a.attr("data-toggle","tooltip"),a.tooltip({title:t.get("tip"),placement:"cursor",zIndex:this.tipZIndex})}this.isSuspendEvents||this.trigger("item:add",this,n,t)}},focus:function(){this.cmpEl&&this.cmpEl.find(".listview").focus()},scrollToRecord:function(t,e){if(this._fromKeyDown){if(t){var i=$(this.el).find(".inner"),n=i.innerHeight(),o=_.indexOf(this.store.models,t),s=o>=0&&this.dataViewItems.length>o?$(this.dataViewItems[o].el):i.find("#"+t.get("id"));if(!(s.length<=0)){var a,l=s.position().top,r=s.outerHeight();e||l<0?a=i.scrollTop()+l:l+r>n&&(a=i.scrollTop()+l+r-n),void 0!==a&&(this.scroller&&this.allowScrollbar?this.scroller.scrollTop(a,0):i.scrollTop(a))}}}else Common.UI.DataView.prototype.scrollToRecord.call(this,t,e)}})})),define("spreadsheeteditor/main/app/view/ParagraphSettingsAdvanced",["text!spreadsheeteditor/main/app/template/ParagraphSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/component/ListView"],(function(t){"use strict";SSE.Views.ParagraphSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:370,height:394,toggleGroup:"paragraph-adv-settings-group",storageName:"sse-para-settings-adv-category"},initialize:function(e){var i=this;_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-paragraph-indents",panelCaption:this.strParagraphIndents},{panelId:"id-adv-paragraph-font",panelCaption:this.strParagraphFont},{panelId:"id-adv-paragraph-tabs",panelCaption:this.strTabs}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._changedProps=null,this.checkGroup=0,this._noApply=!0,this._tabListChanged=!1,this.spinners=[],this.FirstLine=void 0,this.Spacing=null,this.api=this.options.api,this._originalProps=new Asc.asc_CParagraphProperty(this.options.paragraphProps),this._arrLineRule=[{displayValue:this.textAuto,defaultValue:1,value:c_paragraphLinerule.LINERULE_AUTO,minValue:.5,step:.01,defaultUnit:""},{displayValue:this.textExact,defaultValue:5,value:c_paragraphLinerule.LINERULE_EXACT,minValue:.03,step:.01,defaultUnit:"cm"}];var n=this._originalProps.asc_getSpacing().asc_getLineRule(),o=_.findWhere(this._arrLineRule,{value:n});this.CurLineRuleIdx=this._arrLineRule.indexOf(o),this._arrTextAlignment=[{displayValue:this.textTabLeft,value:c_paragraphTextAlignment.LEFT},{displayValue:this.textTabCenter,value:c_paragraphTextAlignment.CENTERED},{displayValue:this.textTabRight,value:c_paragraphTextAlignment.RIGHT},{displayValue:this.textJustified,value:c_paragraphTextAlignment.JUSTIFIED}],this._arrSpecial=[{displayValue:this.textNoneSpecial,value:c_paragraphSpecial.NONE_SPECIAL,defaultValue:0},{displayValue:this.textFirstLine,value:c_paragraphSpecial.FIRST_LINE,defaultValue:12.7},{displayValue:this.textHanging,value:c_paragraphSpecial.HANGING,defaultValue:12.7}],this._arrTabAlign=[{value:Asc.c_oAscTabType.Left,displayValue:this.textTabLeft},{value:Asc.c_oAscTabType.Center,displayValue:this.textTabCenter},{value:Asc.c_oAscTabType.Right,displayValue:this.textTabRight}],this._arrKeyTabAlign=[],this._arrTabAlign.forEach((function(t){i._arrKeyTabAlign[t.value]=t.displayValue}))},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.cmbTextAlignment=new Common.UI.ComboBox({el:$("#paragraphadv-spin-text-alignment"),cls:"input-group-nr",editable:!1,data:this._arrTextAlignment,style:"width: 173px;",menuStyle:"min-width: 173px;",takeFocusOnClose:!0}),this.cmbTextAlignment.setValue(""),this.numIndentsLeft=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-indent-left"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:0}),this.numIndentsLeft.on("change",_.bind((function(t,e,i,n){var o=t.getNumberValue();this._changedProps&&(null!==this._changedProps.asc_getInd()&&void 0!==this._changedProps.asc_getInd()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd),this._changedProps.asc_getInd().put_Left(Common.Utils.Metric.fnRecalcToMM(o)))}),this)),this.spinners.push(this.numIndentsLeft),this.numIndentsRight=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-indent-right"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:0}),this.numIndentsRight.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getInd()&&void 0!==this._changedProps.asc_getInd()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd),this._changedProps.asc_getInd().put_Right(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.numIndentsRight),this.cmbSpecial=new Common.UI.ComboBox({el:$("#paragraphadv-spin-special"),cls:"input-group-nr",editable:!1,data:this._arrSpecial,style:"width: 85px;",menuStyle:"min-width: 85px;",takeFocusOnClose:!0}),this.cmbSpecial.setValue(""),this.cmbSpecial.on("selected",_.bind(this.onSpecialSelect,this)),this.numSpecialBy=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-special-by"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:0}),this.spinners.push(this.numSpecialBy),this.numSpecialBy.on("change",_.bind(this.onFirstLineChange,this)),this.numSpacingBefore=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing-before"),step:.1,width:85,value:"",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText}),this.numSpacingBefore.on("change",_.bind((function(t,e,i,n){if(null===this.Spacing){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=o.asc_getSpacing()}this.Spacing.put_Before(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))}),this)),this.spinners.push(this.numSpacingBefore),this.numSpacingAfter=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing-after"),step:.1,width:85,value:"",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText}),this.numSpacingAfter.on("change",_.bind((function(t,e,i,n){if(null===this.Spacing){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=o.asc_getSpacing()}this.Spacing.put_After(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))}),this)),this.spinners.push(this.numSpacingAfter),this.cmbLineRule=new Common.UI.ComboBox({el:$("#paragraphadv-spin-line-rule"),cls:"input-group-nr",editable:!1,data:this._arrLineRule,style:"width: 85px;",menuStyle:"min-width: 85px;",takeFocusOnClose:!0}),this.cmbLineRule.setValue(this.CurLineRuleIdx),this.cmbLineRule.on("selected",_.bind(this.onLineRuleSelect,this)),this.numLineHeight=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-line-height"),step:.01,width:85,value:"",defaultUnit:"",maxValue:132,minValue:.5}),this.spinners.push(this.numLineHeight),this.numLineHeight.on("change",_.bind(this.onNumLineHeightChange,this)),this.chStrike=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-strike"),labelText:this.strStrike}),this.chStrike.on("change",_.bind(this.onStrikeChange,this)),this.chDoubleStrike=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-double-strike"),labelText:this.strDoubleStrike}),this.chDoubleStrike.on("change",_.bind(this.onDoubleStrikeChange,this)),this.chSuperscript=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-superscript"),labelText:this.strSuperscript}),this.chSuperscript.on("change",_.bind(this.onSuperscriptChange,this)),this.chSubscript=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-subscript"),labelText:this.strSubscript}),this.chSubscript.on("change",_.bind(this.onSubscriptChange,this)),this.chSmallCaps=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-small-caps"),labelText:this.strSmallCaps}),this.chSmallCaps.on("change",_.bind(this.onSmallCapsChange,this)),this.chAllCaps=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-all-caps"),labelText:this.strAllCaps}),this.chAllCaps.on("change",_.bind(this.onAllCapsChange,this)),this.numSpacing=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing"),step:.01,width:100,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numSpacing.on("change",_.bind((function(t,e,i,n){if(this._changedProps&&this._changedProps.asc_putTextSpacing(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putTextSpacing(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}}),this)),this.spinners.push(this.numSpacing),this.numTab=new Common.UI.MetricSpinner({el:$("#paraadv-spin-tab"),step:.1,width:108,defaultUnit:"cm",value:"1.25 cm",maxValue:55.87,minValue:0}),this.spinners.push(this.numTab),this.numDefaultTab=new Common.UI.MetricSpinner({el:$("#paraadv-spin-default-tab"),step:.1,width:108,defaultUnit:"cm",value:"1.25 cm",maxValue:55.87,minValue:0}),this.numDefaultTab.on("change",_.bind((function(t,e,i,n){this._changedProps&&this._changedProps.asc_putDefaultTab(parseFloat(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()).toFixed(1)))}),this)),this.spinners.push(this.numDefaultTab),this.tabList=new Common.UI.ListView({el:$("#paraadv-list-tabs"),emptyText:this.noTabs,store:new Common.UI.DataViewStore,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;">','<div style="width: 117px;display: inline-block;"><%= value %></div>','<div style="display: inline-block;"><%= displayTabAlign %></div>',"</div>"].join("")),tabindex:1}),this.tabList.store.comparator=function(t){return t.get("tabPos")},this.tabList.on("item:select",_.bind(this.onSelectTab,this));var e=function(){t._noApply||(t._tabListChanged=!0)};this.listenTo(this.tabList.store,"add",e),this.listenTo(this.tabList.store,"remove",e),this.listenTo(this.tabList.store,"reset",e),this.cmbAlign=new Common.UI.ComboBox({el:$("#paraadv-cmb-align"),style:"width: 108px;",menuStyle:"min-width: 108px;",editable:!1,cls:"input-group-nr",data:this._arrTabAlign,takeFocusOnClose:!0}),this.cmbAlign.setValue(Asc.c_oAscTabType.Left),this.btnAddTab=new Common.UI.Button({el:$("#paraadv-button-add-tab")}),this.btnAddTab.on("click",_.bind(this.addTab,this)),this.btnRemoveTab=new Common.UI.Button({el:$("#paraadv-button-remove-tab")}),this.btnRemoveTab.on("click",_.bind(this.removeTab,this)),this.btnRemoveAll=new Common.UI.Button({el:$("#paraadv-button-remove-all")}),this.btnRemoveAll.on("click",_.bind(this.removeAllTabs,this)),this.afterRender()},getFocusedComponents:function(){return[this.cmbTextAlignment,this.numIndentsLeft,this.numIndentsRight,this.cmbSpecial,this.numSpecialBy,this.numSpacingBefore,this.numSpacingAfter,this.cmbLineRule,this.numLineHeight,this.chStrike,this.chSubscript,this.chDoubleStrike,this.chSmallCaps,this.chSuperscript,this.chAllCaps,this.numSpacing,this.numDefaultTab,this.numTab,this.cmbAlign,this.tabList,this.btnAddTab,this.btnRemoveTab,this.btnRemoveAll]},onCategoryClick:function(t,e,i,n){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var o=this;setTimeout((function(){switch(e){case 0:o.cmbTextAlignment.focus();break;case 1:o.chStrike.focus(),n&&n instanceof jQuery.Event&&o.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o._originalProps||new Asc.asc_CParagraphProperty);break;case 2:o.numDefaultTab.focus()}}),10)},onAnimateAfter:function(){1==this.getActiveCategory()&&this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",this._originalProps||new Asc.asc_CParagraphProperty)},getSettings:function(){this._tabListChanged&&(null!==this._changedProps.asc_getTabs()&&void 0!==this._changedProps.asc_getTabs()||this._changedProps.asc_putTabs(new Asc.asc_CParagraphTabs),this.tabList.store.each((function(t,e){var i=new Asc.asc_CParagraphTab(Common.Utils.Metric.fnRecalcToMM(t.get("tabPos")),t.get("tabAlign"));this._changedProps.asc_getTabs().add_Tab(i)}),this));var t=this.cmbTextAlignment.getValue();return this._changedProps.asc_putJc(null!=t?t:c_paragraphTextAlignment.LEFT),null!==this.Spacing&&this._changedProps.asc_putSpacing(this.Spacing),{paragraphProps:this._changedProps}},_setDefaults:function(t){if(t){this._originalProps=new Asc.asc_CParagraphProperty(t),this.FirstLine=null!==t.asc_getInd()?t.asc_getInd().asc_getFirstLine():null,this.numIndentsLeft.setValue(null!==t.asc_getInd()&&null!==t.asc_getInd().asc_getLeft()?Common.Utils.Metric.fnRecalcFromMM(t.asc_getInd().asc_getLeft()):"",!0),this.numIndentsRight.setValue(null!==t.asc_getInd()&&null!==t.asc_getInd().asc_getRight()?Common.Utils.Metric.fnRecalcFromMM(t.asc_getInd().asc_getRight()):"",!0),this.cmbTextAlignment.setValue(void 0!==t.asc_getJc()&&null!==t.asc_getJc()?t.asc_getJc():c_paragraphTextAlignment.CENTERED,!0),void 0===this.CurSpecial&&(this.CurSpecial=0===t.asc_getInd().asc_getFirstLine()?c_paragraphSpecial.NONE_SPECIAL:t.asc_getInd().asc_getFirstLine()>0?c_paragraphSpecial.FIRST_LINE:c_paragraphSpecial.HANGING),this.cmbSpecial.setValue(this.CurSpecial),this.numSpecialBy.setValue(null!==this.FirstLine?Math.abs(Common.Utils.Metric.fnRecalcFromMM(this.FirstLine)):"",!0),this.numSpacingBefore.setValue(null!==t.asc_getSpacing()&&null!==t.asc_getSpacing().asc_getBefore()?Common.Utils.Metric.fnRecalcFromMM(t.asc_getSpacing().asc_getBefore()):"",!0),this.numSpacingAfter.setValue(null!==t.asc_getSpacing()&&null!==t.asc_getSpacing().asc_getAfter()?Common.Utils.Metric.fnRecalcFromMM(t.asc_getSpacing().asc_getAfter()):"",!0);var e=t.asc_getSpacing().asc_getLineRule();this.cmbLineRule.setValue(null!==e?e:"",!0),null!==t.asc_getSpacing()&&null!==t.asc_getSpacing().asc_getLine()?this.numLineHeight.setValue(e==c_paragraphLinerule.LINERULE_AUTO?t.asc_getSpacing().asc_getLine():Common.Utils.Metric.fnRecalcFromMM(t.asc_getSpacing().asc_getLine()),!0):this.numLineHeight.setValue("",!0),this._noApply=!0,this.chStrike.setValue(null!==t.asc_getStrikeout()&&void 0!==t.asc_getStrikeout()?t.asc_getStrikeout():"indeterminate",!0),this.chDoubleStrike.setValue(null!==t.asc_getDStrikeout()&&void 0!==t.asc_getDStrikeout()?t.asc_getDStrikeout():"indeterminate",!0),this.chSubscript.setValue(null!==t.asc_getSubscript()&&void 0!==t.asc_getSubscript()?t.asc_getSubscript():"indeterminate",!0),this.chSuperscript.setValue(null!==t.asc_getSuperscript()&&void 0!==t.asc_getSuperscript()?t.asc_getSuperscript():"indeterminate",!0),this.chSmallCaps.setValue(null!==t.asc_getSmallCaps()&&void 0!==t.asc_getSmallCaps()?t.asc_getSmallCaps():"indeterminate",!0),this.chAllCaps.setValue(null!==t.asc_getAllCaps()&&void 0!==t.asc_getAllCaps()?t.asc_getAllCaps():"indeterminate",!0),this.numSpacing.setValue(null!==t.asc_getTextSpacing()&&void 0!==t.asc_getTextSpacing()?Common.Utils.Metric.fnRecalcFromMM(t.asc_getTextSpacing()):"",!0),this.numDefaultTab.setValue(null!==t.asc_getDefaultTab()&&void 0!==t.asc_getDefaultTab()?Common.Utils.Metric.fnRecalcFromMM(parseFloat(t.asc_getDefaultTab().toFixed(1))):"",!0);var i=this.tabList.store,n=t.asc_getTabs();if(n){for(var o=[],s=n.asc_getCount(),a=0;a<s;a++){var l=n.asc_getTab(a),r=Common.Utils.Metric.fnRecalcFromMM(parseFloat(l.asc_getPos().toFixed(1))),c=new Common.UI.DataViewModel;c.set({tabPos:r,value:parseFloat(r.toFixed(3))+" "+Common.Utils.Metric.getCurrentMetricName(),tabAlign:l.asc_getValue(),displayTabAlign:this._arrKeyTabAlign[l.asc_getValue()]}),o.push(c)}i.reset(o,{silent:!1}),this.tabList.selectByIndex(0)}this._noApply=!1,this._changedProps=new Asc.asc_CParagraphProperty}},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),"paragraphadv-spin-spacing"==e.el.id||"paragraphadv-spin-position"==e.el.id||"paragraphadv-spin-spacing-before"==e.el.id||"paragraphadv-spin-spacing-after"==e.el.id?e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01):e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this._arrLineRule[1].defaultUnit=Common.Utils.Metric.getCurrentMetricName(),this._arrLineRule[1].minValue=parseFloat(Common.Utils.Metric.fnRecalcFromMM(.3).toFixed(2)),this._arrLineRule[1].step=Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01,null!==this.CurLineRuleIdx&&(this.numLineHeight.setDefaultUnit(this._arrLineRule[this.CurLineRuleIdx].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[this.CurLineRuleIdx].step))},afterRender:function(){if(this.updateMetricUnit(),this._setDefaults(this._originalProps),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},onStrikeChange:function(t,e,i,n){if(this._changedProps&&1!=this.checkGroup&&this._changedProps.asc_putStrikeout("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=1,this.chDoubleStrike.setValue(0),this._changedProps&&this._changedProps.asc_putDStrikeout(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putStrikeout("checked"==t.getValue()),o.asc_putDStrikeout("checked"==this.chDoubleStrike.getValue()),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onDoubleStrikeChange:function(t,e,i,n){if(this._changedProps&&1!=this.checkGroup&&this._changedProps.asc_putDStrikeout("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=1,this.chStrike.setValue(0),this._changedProps&&this._changedProps.asc_putStrikeout(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putDStrikeout("checked"==t.getValue()),o.asc_putStrikeout("checked"==this.chStrike.getValue()),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onSuperscriptChange:function(t,e,i,n){if(this._changedProps&&2!=this.checkGroup&&this._changedProps.asc_putSuperscript("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=2,this.chSubscript.setValue(0),this._changedProps&&this._changedProps.asc_putSubscript(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putSuperscript("checked"==t.getValue()),o.asc_putSubscript("checked"==this.chSubscript.getValue()),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onSubscriptChange:function(t,e,i,n){if(this._changedProps&&2!=this.checkGroup&&this._changedProps.asc_putSubscript("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=2,this.chSuperscript.setValue(0),this._changedProps&&this._changedProps.asc_putSuperscript(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putSubscript("checked"==t.getValue()),o.asc_putSuperscript("checked"==this.chSuperscript.getValue()),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onSmallCapsChange:function(t,e,i,n){if(this._changedProps&&3!=this.checkGroup&&this._changedProps.asc_putSmallCaps("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=3,this.chAllCaps.setValue(0),this._changedProps&&this._changedProps.asc_putAllCaps(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putSmallCaps("checked"==t.getValue()),o.asc_putAllCaps("checked"==this.chAllCaps.getValue()),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}},onAllCapsChange:function(t,e,i,n){if(this._changedProps&&3!=this.checkGroup&&this._changedProps.asc_putAllCaps("checked"==t.getValue()),this.checkGroup=0,"checked"==t.getValue()&&(this.checkGroup=3,this.chSmallCaps.setValue(0),this._changedProps&&this._changedProps.asc_putSmallCaps(!1),this.checkGroup=0),this.api&&!this._noApply){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;o.asc_putAllCaps("checked"==t.getValue()),o.asc_putSmallCaps("checked"==this.chSmallCaps.getValue()),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",o)}},addTab:function(t,e){var i=this.numTab.getNumberValue(),n=this.cmbAlign.getValue(),o=this._arrKeyTabAlign[n],s=this.tabList.store,a=s.find((function(t){return Math.abs(t.get("tabPos")-i)<.001}));a?(a.set("tabAlign",n),a.set("displayTabAlign",o),this._tabListChanged=!0):((a=new Common.UI.DataViewModel).set({tabPos:i,value:i+" "+Common.Utils.Metric.getCurrentMetricName(),tabAlign:n,displayTabAlign:o}),s.add(a)),this.tabList.selectRecord(a),this.tabList.scrollToRecord(a)},removeTab:function(t,e){var i=this.tabList.getSelectedRec();if(i){var n=this.tabList.store,o=_.indexOf(n.models,i);n.remove(i),o>n.length-1&&(o=n.length-1),n.length>0&&(this.tabList.selectByIndex(o),this.tabList.scrollToRecord(n.at(o)))}},removeAllTabs:function(t,e){this.tabList.store.reset()},onSelectTab:function(t,e,i){if(i){var n={};if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;n=i.toJSON()}else n=i;this.numTab.setValue(n.tabPos),this.cmbAlign.setValue(n.tabAlign)}},onSpecialSelect:function(t,e){if(this.CurSpecial=e.value,this.CurSpecial===c_paragraphSpecial.NONE_SPECIAL&&this.numSpecialBy.setValue(0,!0),this._changedProps){null!==this._changedProps.asc_getInd()&&void 0!==this._changedProps.asc_getInd()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd);var i=Common.Utils.Metric.fnRecalcToMM(this.numSpecialBy.getNumberValue());0===i&&(this.numSpecialBy.setValue(Common.Utils.Metric.fnRecalcFromMM(this._arrSpecial[e.value].defaultValue),!0),i=this._arrSpecial[e.value].defaultValue),this.CurSpecial===c_paragraphSpecial.HANGING&&(i=-i),this._changedProps.asc_getInd().put_FirstLine(i)}},onFirstLineChange:function(t,e,i,n){if(this._changedProps){null!==this._changedProps.asc_getInd()&&void 0!==this._changedProps.asc_getInd()||this._changedProps.put_Ind(new Asc.asc_CParagraphInd);var o=Common.Utils.Metric.fnRecalcToMM(t.getNumberValue());this.CurSpecial===c_paragraphSpecial.HANGING?o=-o:this.CurSpecial===c_paragraphSpecial.NONE_SPECIAL&&o>0?(this.CurSpecial=c_paragraphSpecial.FIRST_LINE,this.cmbSpecial.setValue(c_paragraphSpecial.FIRST_LINE)):0===o&&(this.CurSpecial=c_paragraphSpecial.NONE_SPECIAL,this.cmbSpecial.setValue(c_paragraphSpecial.NONE_SPECIAL)),this._changedProps.asc_getInd().put_FirstLine(o)}},onLineRuleSelect:function(t,e){if(null===this.Spacing){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=i.asc_getSpacing()}this.Spacing.put_LineRule(e.value);var n=_.findWhere(this._arrLineRule,{value:e.value}),o=this._arrLineRule.indexOf(n);this.CurLineRuleIdx!==o&&(this.numLineHeight.setDefaultUnit(this._arrLineRule[o].defaultUnit),this.numLineHeight.setMinValue(this._arrLineRule[o].minValue),this.numLineHeight.setStep(this._arrLineRule[o].step),this.Spacing.get_LineRule()===c_paragraphLinerule.LINERULE_AUTO?this.numLineHeight.setValue(this._arrLineRule[o].defaultValue):this.numLineHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(this._arrLineRule[o].defaultValue)),this.CurLineRuleIdx=o)},onNumLineHeightChange:function(t,e,i,n){if(""!==this.cmbLineRule.getRawValue()){if(null===this.Spacing){var o=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;this.Spacing=o.asc_getSpacing()}this.Spacing.put_Line(this.cmbLineRule.getValue()==c_paragraphLinerule.LINERULE_AUTO?t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))}},textTitle:"Paragraph - Advanced Settings",strIndentsLeftText:"Left",strIndentsRightText:"Right",strParagraphIndents:"Indents & Spacing",strParagraphFont:"Font",textEffects:"Effects",textCharacterSpacing:"Character Spacing",strDoubleStrike:"Double strikethrough",strStrike:"Strikethrough",strSuperscript:"Superscript",strSubscript:"Subscript",strSmallCaps:"Small caps",strAllCaps:"All caps",strTabs:"Tab",textSet:"Specify",textRemove:"Remove",textRemoveAll:"Remove All",textTabLeft:"Left",textTabRight:"Right",textTabCenter:"Center",textAlign:"Alignment",textTabPosition:"Tab Position",textDefault:"Default Tab",noTabs:"The specified tabs will appear in this field",textJustified:"Justified",strIndentsSpecial:"Special",textNoneSpecial:"(none)",textFirstLine:"First line",textHanging:"Hanging",strIndentsSpacingBefore:"Before",strIndentsSpacingAfter:"After",strIndentsLineSpacing:"Line Spacing",txtAutoText:"Auto",textAuto:"Multiple",textExact:"Exactly",strIndent:"Indents",strSpacing:"Spacing"},SSE.Views.ParagraphSettingsAdvanced||{}))})),define("text!spreadsheeteditor/main/app/template/ImageSettingsAdvanced.template",[],(function(){return'<div id="id-adv-image-rotate" class="settings-panel active">\n    <div class="inner-content  padding-large">\n        <div style="width: 100%;">\n            <label class="input-label"><%= scope.textAngle %></label>\n            <div id="image-advanced-spin-angle" style="display: inline-block; margin-left: 5px;"></div>\n        </div>\n    </div>\n    <div class="separator horizontal padding-large"></div>\n    <div class="inner-content  padding-large">\n        <table cols="2">\n            <tr>\n                <td rowspan="2" class="padding-small" style="vertical-align: top;">\n                    <label class="input-label" style="margin-right: 15px;vertical-align: top;"><%= scope.textFlipped %></label>\n                </td>\n                <td class="padding-small">\n                    <div id="image-advanced-checkbox-hor"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="image-advanced-checkbox-vert"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-image-snap" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1">\n            <tr>\n                <td class="padding-small">\n                    <div id="image-advanced-radio-twocell"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="image-advanced-radio-onecell"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="image-advanced-radio-absolute"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-image-alttext" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" width="100%">\n            <tr>\n                <td class="padding-large">\n                    <label class="header"><%= scope.textAltTitle %></label>\n                    <div id="image-advanced-alt-title"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label class="header"><%= scope.textAltDescription %></label>\n                    <textarea id="image-advanced-alt-description" class="form-control" style="width: 100%; height: 70px;"></textarea>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label><%= scope.textAltTip %></label>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),define("spreadsheeteditor/main/app/view/ImageSettingsAdvanced",["text!spreadsheeteditor/main/app/template/ImageSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/InputField","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox"],(function(t){"use strict";SSE.Views.ImageSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:300,height:342,toggleGroup:"image-adv-settings-group",properties:null,storageName:"sse-image-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-image-rotate",panelCaption:this.textRotation},{panelId:"id-adv-image-snap",panelCaption:this.textSnap},{panelId:"id-adv-image-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._originalProps=this.options.imageProps,this._changedProps=null},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.spnAngle=new Common.UI.MetricSpinner({el:$("#image-advanced-spin-angle"),step:1,width:80,defaultUnit:"°",value:"0 °",maxValue:3600,minValue:-3600}),this.chFlipHor=new Common.UI.CheckBox({el:$("#image-advanced-checkbox-hor"),labelText:this.textHorizontally}),this.chFlipVert=new Common.UI.CheckBox({el:$("#image-advanced-checkbox-vert"),labelText:this.textVertically}),this.radioTwoCell=new Common.UI.RadioBox({el:$("#image-advanced-radio-twocell"),name:"asc-radio-snap",labelText:this.textTwoCell,value:AscCommon.c_oAscCellAnchorType.cellanchorTwoCell}),this.radioTwoCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioOneCell=new Common.UI.RadioBox({el:$("#image-advanced-radio-onecell"),name:"asc-radio-snap",labelText:this.textOneCell,value:AscCommon.c_oAscCellAnchorType.cellanchorOneCell}),this.radioOneCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioAbsolute=new Common.UI.RadioBox({el:$("#image-advanced-radio-absolute"),name:"asc-radio-snap",labelText:this.textAbsolute,value:AscCommon.c_oAscCellAnchorType.cellanchorAbsolute}),this.radioAbsolute.on("change",_.bind(this.onRadioSnapChange,this)),this.inputAltTitle=new Common.UI.InputField({el:$("#image-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",(function(){t.isAltTitleChanged=!0})),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown((function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0})),this.afterRender()},getFocusedComponents:function(){return[this.spnAngle,this.chFlipHor,this.chFlipVert,this.radioTwoCell,this.radioOneCell,this.radioAbsolute,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 0:i.spnAngle.focus();break;case 1:i.radioTwoCell.focus();break;case 2:i.inputAltTitle.focus()}}),10)},onRadioSnapChange:function(t,e,i){e&&this._changedProps&&this._changedProps.asc_putAnchor(t.options.value)},afterRender:function(){if(this._setDefaults(this._originalProps),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},_setDefaults:function(t){if(t){var e=t.asc_getTitle();switch(this.inputAltTitle.setValue(e||""),e=t.asc_getDescription(),this.textareaAltDescription.val(e||""),e=t.asc_getRot(),this.spnAngle.setValue(null==e||null===e?"":Math.floor(180*e/3.14159265358979+.5),!0),this.chFlipHor.setValue(t.asc_getFlipH()),this.chFlipVert.setValue(t.asc_getFlipV()),e=t.asc_getAnchor()){case AscCommon.c_oAscCellAnchorType.cellanchorTwoCell:this.radioTwoCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorOneCell:this.radioOneCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorAbsolute:this.radioAbsolute.setValue(!0,!0)}var i=t.asc_getPluginGuid();this.btnsCategory[0].setVisible(null==i),this._changedProps=new Asc.asc_CImgProperty}},getSettings:function(){return this.isAltTitleChanged&&this._changedProps.asc_putTitle(this.inputAltTitle.getValue()),this.isAltDescChanged&&this._changedProps.asc_putDescription(this.textareaAltDescription.val()),this._changedProps.asc_putRot(3.14159265358979*this.spnAngle.getNumberValue()/180),this._changedProps.asc_putFlipH("checked"==this.chFlipHor.getValue()),this._changedProps.asc_putFlipV("checked"==this.chFlipVert.getValue()),{imageProps:this._changedProps}},textTitle:"Image - Advanced Settings",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table.",textRotation:"Rotation",textAngle:"Angle",textFlipped:"Flipped",textHorizontally:"Horizontally",textVertically:"Vertically",textSnap:"Cell Snapping",textAbsolute:"Don't move or size with cells",textOneCell:"Move but don't size with cells",textTwoCell:"Move and size with cells"},SSE.Views.ImageSettingsAdvanced||{}))})),define("spreadsheeteditor/main/app/view/SetValueDialog",["common/main/lib/component/Window","common/main/lib/component/ComboBox"],(function(){"use strict";SSE.Views.SetValueDialog=Common.UI.Window.extend(_.extend({options:{width:214,header:!0,style:"min-width: 214px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div class="input-row">','<div id="id-spin-set-value"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.startvalue=this.options.startvalue,this.maxvalue=this.options.maxvalue,this.defaultUnit=this.options.defaultUnit,this.step=this.options.step,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){if(Common.UI.Window.prototype.render.call(this),this.spnSize=new Common.UI.MetricSpinner({el:$("#id-spin-set-value"),width:182,step:this.step,defaultUnit:this.defaultUnit,minValue:0,maxValue:this.maxvalue}),this.spnSize.setValue(null!==this.startvalue?this.startvalue+" "+this.defaultUnit:""),null!==this.startvalue){var t=this;setTimeout((function(){var e=t.spnSize.$input[0];document.selection?t.spnSize.$input.select():(e.selectionStart=0,e.selectionEnd=t.startvalue.toString().length)}),10)}this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.spnSize.on("entervalue",_.bind(this.onPrimary,this)),this.options.rounding&&this.spnSize.on("change",_.bind(this.onChange,this)),this.spnSize.$el.find("input").focus()},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onChange:function(){var t=this.spnSize.getNumberValue();t=((t/=this.step)|t)*this.step,this.spnSize.setValue(t,!0)},getSettings:function(){return this.spnSize.getNumberValue()},onPrimary:function(){return this._handleInput("ok"),!1},txtMinText:"The minimum value for this field is {0}",txtMaxText:"The maximum value for this field is {0}"},SSE.Views.SetValueDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ColorPaletteExt",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.ColorPaletteExt=Common.UI.BaseView.extend({options:{dynamiccolors:10,allowReselect:!0,cls:"",style:""},template:_.template(['<div class="palette-color-ext">',"<% var me = this; %>","<% $(colors).each(function(num, item) { %>","<% if (me.isColor(item)) { %>",'<div class="palette-color-item palette-color color-<%=item%>" style="background:#<%=item%>" hidefocus="on">','<em><span style="background:#<%=item%>;" unselectable="on">&#160;</span></em>',"</div>","<% } else if (me.isTransparent(item)) { %>",'<div class="palette-color-item color-<%=item%>" hidefocus="on">','<em><span unselectable="on">&#160;</span></em>',"</div>","<% } else if (me.isEffect(item)) { %>",'<div effectid="<%=item.effectId%>" effectvalue="<%=item.effectValue%>" class="palette-color-item palette-color-effect color-<%=item.color%>" style="background:#<%=item.color%>" hidefocus="on">','<em><span style="background:#<%=item.color%>;" unselectable="on">&#160;</span></em>',"</div>","<% } %>","<% }); %>","</div>"].join("")),colorRe:/(?:^|\s)color-(.{6})(?:\s|$)/,selectedCls:"selected",initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.id=this.options.id,this.cls=this.options.cls,this.style=this.options.style,this.colors=this.options.colors||[],this.value=this.options.value,this.options.el&&this.render(),this.options.value&&this.select(this.options.value,!0)},render:function(t){var e=this;return e.rendered?this.cmpEl=e.$el||$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,colors:this.colors})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl),this.cmpEl.on("click",e.handleClick.bind(e))),e.rendered=!0,this},isColor:function(t){return"string"==typeof t&&/[0-9A-F]{6}/.test(t)},isTransparent:function(t){return"string"==typeof t&&"transparent"==t},isEffect:function(t){return"object"==typeof t&&void 0!==t.effectId},getColor:function(){return this.value},handleClick:function(t){var e,i=this,n=$(t.target).closest("div.palette-color-item");if(0!=n.length)if(n.hasClass("color-transparent"))$(i.el).find("div."+i.selectedCls).removeClass(i.selectedCls),n.addClass(i.selectedCls),i.value="transparent",i.trigger("select",i,"transparent");else if((!/^[a-fA-F0-9]{6}$/.test(i.value)||_.indexOf(i.colors,i.value)<0)&&(i.value=!1),$(i.el).find("div."+i.selectedCls).removeClass(i.selectedCls),n.addClass(i.selectedCls),e=n[0].className.match(i.colorRe)[1],n.hasClass("palette-color-effect")){var o=parseInt(n.attr("effectid"));e&&(i.value=e.toUpperCase(),i.trigger("select",i,{color:e,effectId:o}))}else/#?[a-fA-F0-9]{6}/.test(e)&&(e=/#?([a-fA-F0-9]{6})/.exec(e)[1].toUpperCase(),i.value=e,i.trigger("select",i,e))},select:function(t,e){var i,n=$(this.el);if(n.find("div."+this.selectedCls).removeClass(this.selectedCls),t)if("object"==typeof t)void 0!==t.effectId?(i=n.find('div[effectid="'+t.effectId+'"]').first()).length>0?(i.addClass(this.selectedCls),this.value=i[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1:void 0!==t.effectValue&&((i=n.find('div[effectvalue="'+t.effectValue+'"].color-'+t.color.toUpperCase()).first()).length>0?(i.addClass(this.selectedCls),this.value=i[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1);else if(/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),this.value=t),/^[a-fA-F0-9]{6}|transparent$/.test(t)&&_.indexOf(this.colors,t)>=0)_.indexOf(this.colors,this.value)<0&&(this.value=!1),(t!=this.value||this.options.allowReselect)&&("transparent"==t?n.find("div.color-transparent").addClass(this.selectedCls):n.find("div.palette-color.color-"+t).first().addClass(this.selectedCls),this.value=t,!0!==e&&this.fireEvent("select",this,t));else{var o=n.find("#"+t).first();0==o.length&&(o=n.find('div[color="'+t+'"]').first()),o.length>0&&(o.addClass(this.selectedCls),this.value=t.toUpperCase())}},updateColors:function(t){void 0!==t&&(this.colors=t,this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,colors:this.colors})),$(this.el).html(this.cmpEl),this.cmpEl.on("click",_.bind(this.handleClick,this)))},clearSelection:function(t){$(this.el).find("div."+this.selectedCls).removeClass(this.selectedCls),this.value=void 0}})})),define("spreadsheeteditor/main/app/view/AutoFilterDialog",["common/main/lib/component/Window","common/main/lib/component/ColorPaletteExt"],(function(){"use strict";SSE.Views=SSE.Views||{},SSE.Views.DigitalFilterDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e=this,i={};_.extend(i,{width:501,height:230,contentWidth:180,header:!0,cls:"filter-dlg",contentTemplate:"",title:e.txtTitle,items:[]},t),this.template=t.template||['<div class="box" style="height:'+(i.height-85)+'px;">','<div class="content-panel" >','<label class="header">',e.textShowRows,"</label>",'<div style="margin-top:15px;">','<div id="id-search-begin-digital-combo" class="input-group-nr" style="vertical-align:top;width:225px;display:inline-block;"></div>','<div id="id-sd-cell-search-begin" class="" style="width:225px;display:inline-block;margin-left:18px;"></div>',"</div>","<div>",'<div id="id-and-radio" class="padding-small" style="display: inline-block; margin-top:10px;"></div>','<div id="id-or-radio" class="padding-small" style="display: inline-block; margin-left:25px;"></div>',"</div>",'<div style="margin-top:10px;">','<div id="id-search-end-digital-combo" class="input-group-nr" style="vertical-align:top;width:225px;display:inline-block;"></div>','<div id="id-sd-cell-search-end" class="" style="width:225px;display:inline-block;margin-left:18px;"></div>',"</div>","</div>","</div>",'<div class="separator horizontal" style="width:100%"></div>','<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok">',e.okButtonText,"</button>",'<button class="btn normal dlg-btn" result="cancel">',e.cancelButtonText,"</button>","</div>"].join(""),this.api=t.api,this.handler=t.handler,this.type=t.type||"number",i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){Common.UI.Window.prototype.render.call(this),this.conditions=[{value:Asc.c_oAscCustomAutoFilter.equals,displayValue:this.capCondition1},{value:Asc.c_oAscCustomAutoFilter.doesNotEqual,displayValue:this.capCondition2},{value:Asc.c_oAscCustomAutoFilter.isGreaterThan,displayValue:this.capCondition3},{value:Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo,displayValue:this.capCondition4},{value:Asc.c_oAscCustomAutoFilter.isLessThan,displayValue:this.capCondition5},{value:Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo,displayValue:this.capCondition6}],"text"==this.type&&(this.conditions=this.conditions.concat([{value:Asc.c_oAscCustomAutoFilter.beginsWith,displayValue:this.capCondition7},{value:Asc.c_oAscCustomAutoFilter.doesNotBeginWith,displayValue:this.capCondition8},{value:Asc.c_oAscCustomAutoFilter.endsWith,displayValue:this.capCondition9},{value:Asc.c_oAscCustomAutoFilter.doesNotEndWith,displayValue:this.capCondition10},{value:Asc.c_oAscCustomAutoFilter.contains,displayValue:this.capCondition11},{value:Asc.c_oAscCustomAutoFilter.doesNotContain,displayValue:this.capCondition12}])),this.cmbCondition1=new Common.UI.ComboBox({el:$("#id-search-begin-digital-combo",this.$window),menuStyle:"min-width: 225px;max-height: 135px;",cls:"input-group-nr",data:this.conditions,scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0}),this.cmbCondition1.setValue(Asc.c_oAscCustomAutoFilter.equals),this.conditions.splice(0,0,{value:0,displayValue:this.textNoFilter}),this.cmbCondition2=new Common.UI.ComboBox({el:$("#id-search-end-digital-combo",this.$window),menuStyle:"min-width: 225px;max-height: 135px;",cls:"input-group-nr",data:this.conditions,scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0}),this.cmbCondition2.setValue(0),this.rbAnd=new Common.UI.RadioBox({el:$("#id-and-radio",this.$window),labelText:this.capAnd,name:"asc-radio-filter-tab",checked:!0}),this.rbOr=new Common.UI.RadioBox({el:$("#id-or-radio",this.$window),labelText:this.capOr,name:"asc-radio-filter-tab"}),this.cmbValue1=new Common.UI.ComboBox({el:$("#id-sd-cell-search-begin",this.$window),cls:"input-group-nr",menuStyle:"min-width: 225px;max-height: 135px;",scrollAlwaysVisible:!0,data:[],takeFocusOnClose:!0}),this.cmbValue2=new Common.UI.ComboBox({el:$("#id-sd-cell-search-end",this.$window),cls:"input-group-nr",menuStyle:"min-width: 225px;max-height: 135px;",scrollAlwaysVisible:!0,data:[],takeFocusOnClose:!0});this.cmbValue1.store.comparator=this.cmbValue2.store.comparator=function(t,e){var i=t.get("intval"),n=e.get("intval"),o=void 0!==i;return o!==(void 0!==n)?o?-1:1:(!o&&(i=t.get("value").toLowerCase())&&(n=e.get("value").toLowerCase()),i==n?0:""==n||""!==i&&i<n?-1:1)},this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.loadDefaults()},getFocusedComponents:function(){return[this.cmbCondition1,this.cmbValue1,this.rbAnd,this.rbOr,this.cmbCondition2,this.cmbValue2]},getDefaultFocusableComponent:function(){return this.cmbValue1},close:function(){this.api&&this.api.asc_enableKeyEvents(!0),Common.UI.Window.prototype.close.call(this)},onBtnClick:function(t){t.currentTarget.attributes&&t.currentTarget.attributes.result&&("ok"===t.currentTarget.attributes.result.value&&this.save(),this.close())},setSettings:function(t){this.properties=t},loadDefaults:function(){if(this.properties&&this.rbOr&&this.rbAnd&&this.cmbCondition1&&this.cmbCondition2&&this.cmbValue1&&this.cmbValue2){var t=[];this.properties.asc_getValues().forEach((function(e){var i=e.asc_getText();_.isEmpty(i)||t.push({value:i,displayValue:i,intval:!isNaN(parseFloat(i))&&isFinite(i)?parseFloat(i):void 0})})),this.cmbValue1.setData(t),this.cmbValue2.setData(t);var e=this.properties.asc_getFilterObj();if(e.asc_getType()==Asc.c_oAscAutoFilterTypes.CustomFilters){var i=e.asc_getFilter(),n=i.asc_getCustomFilters();i.asc_getAnd()?this.rbAnd.setValue(!0):this.rbOr.setValue(!0),this.cmbCondition1.setValue(n[0].asc_getOperator()||Asc.c_oAscCustomAutoFilter.equals),this.cmbCondition2.setValue(n.length>1&&n[1].asc_getOperator()||0),this.cmbValue1.setValue(null===n[0].asc_getVal()?"":n[0].asc_getVal()),this.cmbValue2.setValue(n.length>1?null===n[1].asc_getVal()?"":n[1].asc_getVal():"")}}},save:function(){if(this.api&&this.properties&&this.rbOr&&this.rbAnd&&this.cmbCondition1&&this.cmbCondition2&&this.cmbValue1&&this.cmbValue2){var t=this.properties.asc_getFilterObj();t.asc_setFilter(new Asc.CustomFilters),t.asc_setType(Asc.c_oAscAutoFilterTypes.CustomFilters);var e=t.asc_getFilter();e.asc_setCustomFilters(0==this.cmbCondition2.getValue()?[new Asc.CustomFilter]:[new Asc.CustomFilter,new Asc.CustomFilter]);var i=e.asc_getCustomFilters();e.asc_setAnd(this.rbAnd.getValue()),i[0].asc_setOperator(this.cmbCondition1.getValue()),i[0].asc_setVal(this.cmbValue1.getValue()),0!==this.cmbCondition2.getValue()&&(i[1].asc_setOperator(this.cmbCondition2.getValue()||void 0),i[1].asc_setVal(this.cmbValue2.getValue())),this.api.asc_applyAutoFilter(this.properties)}},onPrimary:function(){return this.save(),this.close(),!1},capAnd:"And",capCondition1:"equals",capCondition10:"does not end with",capCondition11:"contains",capCondition12:"does not contain",capCondition2:"does not equal",capCondition3:"is greater than",capCondition4:"is greater than or equal to",capCondition5:"is less than",capCondition6:"is less than or equal to",capCondition7:"begins with",capCondition8:"does not begin with",capCondition9:"ends with",capOr:"Or",textNoFilter:"no filter",textShowRows:"Show rows where",textUse1:"Use ? to present any single character",textUse2:"Use * to present any series of character",txtTitle:"Custom Filter"},SSE.Views.DigitalFilterDialog||{})),SSE.Views.Top10FilterDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e=this,i={};this.type=t.type,_.extend(i,{width:"value"==this.type?450:318,height:160,contentWidth:180,header:!0,cls:"filter-dlg",contentTemplate:"",title:e.txtTitle,items:[],buttons:["ok","cancel"]},t),this.template=t.template||['<div class="box" style="height:'+(i.height-85)+'px;">','<div class="content-panel" >',"<label>",e.textType,"</label>","<div>",'<div id="id-top10-type-combo" style="margin-right:10px; display: inline-block; vertical-align: middle;"></div>','<div id="id-top10-count-spin" class="input-group-nr" style="margin-right:10px; display: inline-block; vertical-align: middle;"></div>','<div id="id-top10-item-combo" class="input-group-nr" style="display: inline-block; vertical-align: middle;"></div>','<label id="id-top10-lblby" class="input-group-nr" style="min-width: 40px; text-align: center; display: inline-block; vertical-align: middle;">'+e.txtBy+"</label>",'<div id="id-top10-fields-combo" class="input-group-nr" style="width:100px;display: inline-block; vertical-align: middle;"></div>',"</div>","</div>","</div>",'<div class="separator horizontal" style="width:100%"></div>'].join(""),this.api=t.api,this.handler=t.handler,i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){Common.UI.Window.prototype.render.call(this),this.cmbType=new Common.UI.ComboBox({el:$("#id-top10-type-combo",this.$window),style:"width: 85px;",menuStyle:"min-width: 85px;",cls:"input-group-nr",data:[{value:!0,displayValue:this.txtTop},{value:!1,displayValue:this.txtBottom}],editable:!1,takeFocusOnClose:!0}),this.cmbType.setValue(!0);var t=[{value:!1,displayValue:this.txtItems},{value:!0,displayValue:this.txtPercent}];"value"==this.type&&t.push({value:0,displayValue:this.txtSum}),this.cmbItem=new Common.UI.ComboBox({el:$("#id-top10-item-combo",this.$window),style:"width: 85px;",menuStyle:"min-width: 85px;",cls:"input-group-nr",data:t,editable:!1,takeFocusOnClose:!0}),this.cmbItem.setValue(!1),this.cmbItem.on("selected",_.bind((function(t,e){this.spnCount.setDefaultUnit(e.value?"%":"")}),this)),this.spnCount=new Common.UI.MetricSpinner({el:$("#id-top10-count-spin"),step:1,width:85,defaultUnit:"",value:"10",maxValue:500,minValue:1}),this.cmbFields=new Common.UI.ComboBox({el:$("#id-top10-fields-combo",this.$window),menuStyle:"min-width: 100%;max-height: 135px;",style:"width:100%;",cls:"input-group-nr",data:[],scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0}),this.cmbFields.setVisible("value"==this.type),"value"!==this.type&&this.$window.find("#id-top10-lblby").addClass("hidden"),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.loadDefaults()},getFocusedComponents:function(){return[this.cmbType,this.spnCount,this.cmbItem,this.cmbFields]},getDefaultFocusableComponent:function(){return this.spnCount},close:function(){this.api&&this.api.asc_enableKeyEvents(!0),Common.UI.Window.prototype.close.call(this)},onBtnClick:function(t){t.currentTarget.attributes&&t.currentTarget.attributes.result&&("ok"===t.currentTarget.attributes.result.value&&this.save(),this.close())},setSettings:function(t){this.properties=t},loadDefaults:function(){if(this.properties){var t=!1;if("value"==this.type){var e=this.properties.asc_getPivotObj(),i=e.asc_getDataFieldIndexFilter(),n=e.asc_getDataFields();t=e.asc_getIsTop10Sum(),this.setTitle(this.txtValueTitle+" ("+n[0]+")"),n.shift();var o=[];n&&n.forEach((function(t,e){t&&o.push({value:e,displayValue:t})})),this.cmbFields.setData(o),this.cmbFields.setValue(0!==i?i-1:0)}var s=this.properties.asc_getFilterObj();if(s.asc_getType()==Asc.c_oAscAutoFilterTypes.Top10){var a=s.asc_getFilter(),l=a.asc_getTop(),r=a.asc_getPercent();this.cmbType.setValue(l||null===l),this.cmbItem.setValue(t?0:r||null===r),this.spnCount.setDefaultUnit(!r&&null!==r||t?"":"%"),this.spnCount.setValue(a.asc_getVal())}}},save:function(){if(this.api&&this.properties){var t=this.properties.asc_getFilterObj();t.asc_setFilter(new Asc.Top10),t.asc_setType(Asc.c_oAscAutoFilterTypes.Top10);var e=t.asc_getFilter();if(e.asc_setTop(this.cmbType.getValue()),e.asc_setPercent(!0===this.cmbItem.getValue()),e.asc_setVal(this.spnCount.getNumberValue()),"value"==this.type){var i=this.properties.asc_getPivotObj();i.asc_setIsTop10Sum(0===this.cmbItem.getValue()),i.asc_setDataFieldIndexFilter("value"==this.type?this.cmbFields.getValue()+1:0)}this.api.asc_applyAutoFilter(this.properties)}},onPrimary:function(){return this.save(),this.close(),!1},txtTitle:"Top 10 AutoFilter",textType:"Show",txtTop:"Top",txtBottom:"Bottom",txtItems:"Item",txtPercent:"Percent",txtValueTitle:"Top 10 Filter",txtSum:"Sum",txtBy:"by"},SSE.Views.Top10FilterDialog||{})),SSE.Views.PivotDigitalFilterDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e=this,i={};_.extend(i,{width:501,height:210,contentWidth:180,header:!0,cls:"filter-dlg",contentTemplate:"",title:"label"==t.type?e.txtTitleLabel:e.txtTitleValue,items:[]},t),this.api=t.api,this.handler=t.handler,this.type=t.type||"value",this.template=t.template||['<div class="box" style="height:'+(i.height-85)+'px;">','<div class="content-panel" >','<label class="header">',"label"==e.type?e.textShowLabel:e.textShowValue,"</label>",'<div style="margin-top:15px;">','<div id="id-field-digital-combo" class="input-group-nr" style="vertical-align:middle;width:110px;display:inline-block;margin-right:10px;"></div>','<div id="id-cond-digital-combo" class="input-group-nr" style="vertical-align:middle;width:'+("label"==e.type?225:110)+'px;display:inline-block;margin-right:10px;"></div>','<div id="id-input-digital-value1" class="" style="vertical-align: middle; width:225px;display:inline-block;"></div>','<label id="id-label-digital-and" style="vertical-align: middle;margin-left: 5px;">'+this.txtAnd+"</label>",'<div id="id-input-digital-value2" class="" style="vertical-align: middle; width:100px;display:inline-block;margin-left: 5px;"></div>',"</div>",'<div style="margin-top:10px;">','<label style="display:block;">'+e.textUse1+"</label>",'<label style="display:block;">'+e.textUse2+"</label>","</div>","</div>","</div>",'<div class="separator horizontal" style="width:100%"></div>','<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok">',e.okButtonText,"</button>",'<button class="btn normal dlg-btn" result="cancel">',e.cancelButtonText,"</button>","</div>"].join(""),i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){Common.UI.Window.prototype.render.call(this),this.conditions=[{value:Asc.c_oAscCustomAutoFilter.equals,displayValue:this.capCondition1},{value:Asc.c_oAscCustomAutoFilter.doesNotEqual,displayValue:this.capCondition2},{value:Asc.c_oAscCustomAutoFilter.isGreaterThan,displayValue:this.capCondition3},{value:Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo,displayValue:this.capCondition4},{value:Asc.c_oAscCustomAutoFilter.isLessThan,displayValue:this.capCondition5},{value:Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo,displayValue:this.capCondition6},{value:-2,displayValue:this.capCondition13},{value:-3,displayValue:this.capCondition14}],"label"==this.type&&(this.conditions=this.conditions.concat([{value:Asc.c_oAscCustomAutoFilter.beginsWith,displayValue:this.capCondition7},{value:Asc.c_oAscCustomAutoFilter.doesNotBeginWith,displayValue:this.capCondition8},{value:Asc.c_oAscCustomAutoFilter.endsWith,displayValue:this.capCondition9},{value:Asc.c_oAscCustomAutoFilter.doesNotEndWith,displayValue:this.capCondition10},{value:Asc.c_oAscCustomAutoFilter.contains,displayValue:this.capCondition11},{value:Asc.c_oAscCustomAutoFilter.doesNotContain,displayValue:this.capCondition12}])),this.cmbCondition1=new Common.UI.ComboBox({el:$("#id-cond-digital-combo",this.$window),menuStyle:"min-width: 100%;max-height: 135px;",style:"width:100%;",cls:"input-group-nr",data:this.conditions,scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0}),this.cmbCondition1.setValue(Asc.c_oAscCustomAutoFilter.equals),this.cmbCondition1.on("selected",_.bind((function(t,e){var i=-2==e.value||-3==e.value;this.inputValue2.setVisible(i),this.lblAnd.toggleClass("hidden",!i),this.inputValue.$el.width(i?100:225);var n=this;_.defer((function(){n.inputValue&&n.inputValue.focus()}),10)}),this)),this.cmbFields=new Common.UI.ComboBox({el:$("#id-field-digital-combo",this.$window),menuStyle:"min-width: 100%;max-height: 135px;",style:"width:100%;",cls:"input-group-nr",data:[],scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0}),this.cmbFields.setVisible("value"==this.type),this.cmbFields.on("selected",_.bind((function(t,e){var i=this;_.defer((function(){i.inputValue&&i.inputValue.focus()}),10)}),this)),this.inputValue=new Common.UI.InputField({el:$("#id-input-digital-value1"),allowBlank:!1,style:"width: 100%;",validateOnBlur:!1}),this.inputValue2=new Common.UI.InputField({el:$("#id-input-digital-value2"),allowBlank:!1,style:"width: 100%;",validateOnBlur:!1}),this.lblAnd=this.$window.find("#id-label-digital-and"),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.loadDefaults()},getFocusedComponents:function(){return[this.cmbFields,this.cmbCondition1,this.inputValue,this.inputValue2]},getDefaultFocusableComponent:function(){return this.inputValue},close:function(){this.api&&this.api.asc_enableKeyEvents(!0),Common.UI.Window.prototype.close.call(this)},onBtnClick:function(t){t.currentTarget.attributes&&t.currentTarget.attributes.result&&("ok"===t.currentTarget.attributes.result.value&&this.save(),this.close())},setSettings:function(t){this.properties=t},loadDefaults:function(){if(this.properties&&this.cmbCondition1&&this.cmbFields&&this.inputValue){var t=this.properties.asc_getPivotObj(),e=t.asc_getDataFieldIndexFilter(),i=t.asc_getDataFields();if(this.setTitle(this.options.title+" ("+i[0]+")"),"value"==this.type){i.shift();var n=[];i&&i.forEach((function(t,e){t&&n.push({value:e,displayValue:t})})),this.cmbFields.setData(n),this.cmbFields.setValue(0!==e?e-1:0)}var o=this.properties.asc_getFilterObj();if(o.asc_getType()==Asc.c_oAscAutoFilterTypes.CustomFilters){var s=o.asc_getFilter(),a=s.asc_getCustomFilters(),l=a[0].asc_getOperator();if(a.length>1){var r=s.asc_getAnd(),c=a[0].asc_getOperator()==Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo&&a[1].asc_getOperator()==Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo,d=a[0].asc_getOperator()==Asc.c_oAscCustomAutoFilter.isLessThan&&a[1].asc_getOperator()==Asc.c_oAscCustomAutoFilter.isGreaterThan;r&&c?l=-2:!r&&d&&(l=-3)}this.cmbCondition1.setValue(l||Asc.c_oAscCustomAutoFilter.equals),this.inputValue.setValue(null===a[0].asc_getVal()?"":a[0].asc_getVal()),this.inputValue.$el.width(-2==l||-3==l?100:225),this.lblAnd.toggleClass("hidden",!(-2==l||-3==l)),this.inputValue2.setVisible(-2==l||-3==l),this.inputValue2.setValue(a.length>1?null===a[1].asc_getVal()?"":a[1].asc_getVal():"")}}},save:function(){if(this.api&&this.properties&&this.cmbCondition1&&this.cmbFields&&this.inputValue){var t=this.properties.asc_getFilterObj();t.asc_setFilter(new Asc.CustomFilters),t.asc_setType(Asc.c_oAscAutoFilterTypes.CustomFilters);var e=t.asc_getFilter(),i=this.cmbCondition1.getValue();if(-2==i)e.asc_setCustomFilters([new Asc.CustomFilter,new Asc.CustomFilter]),e.asc_setAnd(!0),(n=e.asc_getCustomFilters())[0].asc_setOperator(Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo),n[0].asc_setVal(this.inputValue.getValue()),n[1].asc_setOperator(Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo),n[1].asc_setVal(this.inputValue2.getValue());else if(-3==i){e.asc_setCustomFilters([new Asc.CustomFilter,new Asc.CustomFilter]),e.asc_setAnd(!1),(n=e.asc_getCustomFilters())[0].asc_setOperator(Asc.c_oAscCustomAutoFilter.isLessThan),n[0].asc_setVal(this.inputValue.getValue()),n[1].asc_setOperator(Asc.c_oAscCustomAutoFilter.isGreaterThan),n[1].asc_setVal(this.inputValue2.getValue())}else{var n;e.asc_setCustomFilters([new Asc.CustomFilter]),e.asc_setAnd(!0),(n=e.asc_getCustomFilters())[0].asc_setOperator(this.cmbCondition1.getValue()),n[0].asc_setVal(this.inputValue.getValue())}this.properties.asc_getPivotObj().asc_setDataFieldIndexFilter("value"==this.type?this.cmbFields.getValue()+1:0),this.api.asc_applyAutoFilter(this.properties)}},onPrimary:function(){return this.save(),this.close(),!1},capCondition1:"equals",capCondition10:"does not end with",capCondition11:"contains",capCondition12:"does not contain",capCondition2:"does not equal",capCondition3:"is greater than",capCondition4:"is greater than or equal to",capCondition5:"is less than",capCondition6:"is less than or equal to",capCondition7:"begins with",capCondition8:"does not begin with",capCondition9:"ends with",textShowLabel:"Show items for which the label:",textShowValue:"Show items for which:",textUse1:"Use ? to present any single character",textUse2:"Use * to present any series of character",txtTitleValue:"Value Filter",txtTitleLabel:"Label Filter",capCondition13:"between",capCondition14:"not between",txtAnd:"and"},SSE.Views.PivotDigitalFilterDialog||{})),SSE.Views.SortFilterDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};this.type=t.type,_.extend(e,{width:250,height:215,contentWidth:180,header:!0,cls:"filter-dlg",contentTemplate:"",title:this.txtTitle,items:[],buttons:["ok","cancel"]},t),this.template=t.template||['<div class="box" style="height:'+(e.height-85)+'px;">','<div class="content-panel" >','<div id="id-sort-filter-radio-asc" style="margin-bottom: 4px;"></div>','<div id="id-sort-filter-fields-asc" class="input-group-nr" style="margin-bottom: 10px;margin-left: 22px;"></div>','<div id="id-sort-filter-radio-desc" style="margin-bottom: 4px;"></div>','<div id="id-sort-filter-fields-desc" class="input-group-nr" style="margin-left: 22px;"></div>',"</div>","</div>",'<div class="separator horizontal" style="width:100%"></div>'].join(""),this.api=t.api,this.handler=t.handler,e.tpl=_.template(this.template)(e),Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.radioAsc=new Common.UI.RadioBox({el:$("#id-sort-filter-radio-asc"),labelText:this.textAsc,name:"asc-radio-sort",checked:!0}),this.radioAsc.on("change",_.bind((function(t,e){e&&this.cmbFieldsAsc.setDisabled(!1),e&&this.cmbFieldsDesc.setDisabled(!0)}),this)),this.radioDesc=new Common.UI.RadioBox({el:$("#id-sort-filter-radio-desc"),labelText:this.textDesc,name:"asc-radio-sort"}),this.radioDesc.on("change",_.bind((function(t,e){e&&this.cmbFieldsAsc.setDisabled(!0),e&&this.cmbFieldsDesc.setDisabled(!1)}),this)),this.cmbFieldsAsc=new Common.UI.ComboBox({el:$("#id-sort-filter-fields-asc",this.$window),menuStyle:"min-width: 100%;max-height: 135px;",style:"width:100%;",cls:"input-group-nr",data:[],scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0}),this.cmbFieldsDesc=new Common.UI.ComboBox({el:$("#id-sort-filter-fields-desc",this.$window),menuStyle:"min-width: 100%;max-height: 135px;",style:"width:100%;",cls:"input-group-nr",data:[],scrollAlwaysVisible:!0,editable:!1,disabled:!0,takeFocusOnClose:!0}),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.loadDefaults()},getFocusedComponents:function(){return[this.radioAsc,this.cmbFieldsAsc,this.radioDesc,this.cmbFieldsDesc]},getDefaultFocusableComponent:function(){return this.cmbFieldsAsc.isDisabled()?this.cmbFieldsDesc:this.cmbFieldsAsc},show:function(){Common.UI.Window.prototype.show.call(this)},close:function(){this.api&&this.api.asc_enableKeyEvents(!0),Common.UI.Window.prototype.close.call(this)},onBtnClick:function(t){t.currentTarget.attributes&&t.currentTarget.attributes.result&&("ok"===t.currentTarget.attributes.result.value&&this.save(),this.close())},setSettings:function(t){this.properties=t},loadDefaults:function(){if(this.properties){var t=this.properties.asc_getPivotObj(),e=t.asc_getDataFieldIndexSorting(),i=t.asc_getDataFields(),n=this.properties.asc_getSortState();this.setTitle(this.txtTitle+" ("+i[0]+")");var o=[];i&&i.forEach((function(t,e){t&&o.push({value:e,displayValue:t})})),this.cmbFieldsAsc.setData(o),this.cmbFieldsAsc.setValue(e>=0?e:0),this.cmbFieldsDesc.setData(o),this.cmbFieldsDesc.setValue(e>=0?e:0),this.radioDesc.setValue(n==Asc.c_oAscSortOptions.Descending,!0),this.cmbFieldsDesc.setDisabled(n!==Asc.c_oAscSortOptions.Descending)}},save:function(){if(this.api&&this.properties){var t=this.radioAsc.getValue()?this.cmbFieldsAsc:this.cmbFieldsDesc;this.properties.asc_getPivotObj().asc_setDataFieldIndexSorting(t.getValue()),this.properties.asc_setSortState(this.radioAsc.getValue()?Asc.c_oAscSortOptions.Ascending:Asc.c_oAscSortOptions.Descending),this.api.asc_applyAutoFilter(this.properties)}},onPrimary:function(){return this.save(),this.close(),!1},txtTitle:"Sort",textAsc:"Ascenging (A to Z) by",textDesc:"Descending (Z to A) by"},SSE.Views.SortFilterDialog||{})),SSE.Views.AutoFilterDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e={},i=450,n=void 0;Common.Utils.InternalSettings.get("sse-settings-size-filter-window")&&(i=Common.Utils.InternalSettings.get("sse-settings-size-filter-window")[0],n=Common.Utils.InternalSettings.get("sse-settings-size-filter-window")[1]),_.extend(e,{width:i||450,height:n||277,contentWidth:i-50||400,header:!1,cls:"filter-dlg",contentTemplate:"",title:this.txtTitle,modal:!1,animate:!1,items:[],resizable:!0,minwidth:450,minheight:277},t),this.template=t.template||['<div class="box" style="height: 100%; display: flex; justify-content: space-between;">','<div class="content-panel" style="width: 100%; border-right: 1px solid #cbcbcb; display: flex; flex-direction: column; justify-content: space-between;">','<div class="" style="display: flex; flex-direction: column; justify-content: flex-start; height: calc(100% - 37px);">','<div id="id-sd-cell-search" style="height:22px; margin-bottom:10px;"></div>','<div class="border-values" style="overflow: hidden; flex-grow: 1;">','<div id="id-dlg-filter-values" class="combo-values" style=""></div>',"</div>","</div>",'<div class="footer center">','<div id="id-apply-filter" style="display: inline-block;"></div>','<button class="btn normal dlg-btn" result="cancel">',this.cancelButtonText,"</button>","</div>","</div>",'<div class="menu-panel" style="float: right;">','<div id="menu-container-filters" style=""><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',"</div>","</div>"].join(""),this.api=t.api,this.handler=t.handler,this.throughIndexes=[],this.filteredIndexes=[],this.curSize=null,e.tpl=_.template(this.template)(e),Common.UI.Window.prototype.initialize.call(this,e),this.on("resizing",_.bind(this.onWindowResizing,this)),this.on("resize",_.bind(this.onWindowResize,this))},render:function(){var t=this;Common.UI.Window.prototype.render.call(this);var e=this.$window.find(".resize-border");this.$window.find(".resize-border.left, .resize-border.top").css({cursor:"default"}),e.css({background:"none",border:"none"}),e.removeClass("left"),e.removeClass("top"),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.btnOk=new Common.UI.Button({cls:"btn normal dlg-btn primary",caption:this.okButtonText,enableToggle:!1,allowDepress:!1}),this.btnOk&&(this.btnOk.render($("#id-apply-filter",this.$window)),this.btnOk.on("click",_.bind(this.onApplyFilter,this))),this.miSortLow2High=new Common.UI.MenuItem({caption:this.txtSortLow2High,toggleGroup:"menufiltersort",checkable:!0,checked:!1}),this.miSortLow2High.on("click",_.bind(this.onSortType,this,Asc.c_oAscSortOptions.Ascending)),this.miSortHigh2Low=new Common.UI.MenuItem({caption:this.txtSortHigh2Low,toggleGroup:"menufiltersort",checkable:!0,checked:!1}),this.miSortHigh2Low.on("click",_.bind(this.onSortType,this,Asc.c_oAscSortOptions.Descending)),this.miSortOptions=new Common.UI.MenuItem({caption:this.txtSortOption}),this.miSortOptions.on("click",_.bind(this.onSortOptions,this)),this.miSortCellColor=new Common.UI.MenuItem({caption:this.txtSortCellColor,toggleGroup:"menufiltersort",checkable:!0,checked:!1,menu:new Common.UI.Menu({style:"min-width: inherit; padding: 0px;",menuAlign:"tl-tr",items:[{template:_.template('<div id="filter-dlg-sort-cells-color" style="max-width: 147px; max-height: 120px;"></div>')}]})}),this.miSortFontColor=new Common.UI.MenuItem({caption:this.txtSortFontColor,toggleGroup:"menufiltersort",checkable:!0,checked:!1,menu:new Common.UI.Menu({style:"min-width: inherit; padding: 0px;",menuAlign:"tl-tr",items:[{template:_.template('<div id="filter-dlg-sort-font-color" style="max-width: 147px; max-height: 120px;"></div>')}]})}),this.miNumFilter=new Common.UI.MenuItem({caption:this.txtNumFilter,toggleGroup:"menufilterfilter",checkable:!0,checked:!1,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:Asc.c_oAscCustomAutoFilter.equals,caption:this.txtEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.doesNotEqual,caption:this.txtNotEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.isGreaterThan,caption:this.txtGreater,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo,caption:this.txtGreaterEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.isLessThan,caption:this.txtLess,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo,caption:this.txtLessEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:-2,caption:this.txtBetween,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.top10,caption:this.txtTop10,checkable:!0,type:Asc.c_oAscAutoFilterTypes.Top10},{value:Asc.c_oAscDynamicAutoFilter.aboveAverage,caption:this.txtAboveAve,checkable:!0,type:Asc.c_oAscAutoFilterTypes.DynamicFilter},{value:Asc.c_oAscDynamicAutoFilter.belowAverage,caption:this.txtBelowAve,checkable:!0,type:Asc.c_oAscAutoFilterTypes.DynamicFilter},{value:-1,caption:this.btnCustomFilter+"...",checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters}]})});for(var i=this.miNumFilter.menu.items,n=0;n<i.length;n++)i[n].on("click",_.bind(i[n].options.type==Asc.c_oAscAutoFilterTypes.CustomFilters?this.onNumCustomFilterItemClick:i[n].options.type==Asc.c_oAscAutoFilterTypes.DynamicFilter?this.onNumDynamicFilterItemClick:this.onTop10FilterItemClick,this));this.miTextFilter=new Common.UI.MenuItem({caption:this.txtTextFilter,toggleGroup:"menufilterfilter",checkable:!0,checked:!1,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:Asc.c_oAscCustomAutoFilter.equals,caption:this.txtEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.doesNotEqual,caption:this.txtNotEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.beginsWith,caption:this.txtBegins,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.doesNotBeginWith,caption:this.txtNotBegins,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.endsWith,caption:this.txtEnds,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.doesNotEndWith,caption:this.txtNotEnds,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.contains,caption:this.txtContains,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:Asc.c_oAscCustomAutoFilter.doesNotContain,caption:this.txtNotContains,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters},{value:-1,caption:this.btnCustomFilter+"...",checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters}]})}),this.miTextFilter.menu.on("item:click",_.bind(this.onTextFilterMenuClick,this)),this.miFilterCellColor=new Common.UI.MenuItem({caption:this.txtFilterCellColor,toggleGroup:"menufilterfilter",checkable:!0,checked:!1,menu:new Common.UI.Menu({style:"min-width: inherit; padding: 0px;",menuAlign:"tl-tr",items:[{template:_.template('<div id="filter-dlg-filter-cells-color" style="max-width: 147px; max-height: 120px;"></div>')}]})}),this.miFilterFontColor=new Common.UI.MenuItem({caption:this.txtFilterFontColor,toggleGroup:"menufilterfilter",checkable:!0,checked:!1,menu:new Common.UI.Menu({style:"min-width: inherit; padding: 0px;",menuAlign:"tl-tr",items:[{template:_.template('<div id="filter-dlg-filter-font-color" style="max-width: 147px; max-height: 120px;"></div>')}]})}),this.miClear=new Common.UI.MenuItem({caption:this.txtClear,checkable:!1}),this.miClear.on("click",_.bind(this.onClear,this)),this.miReapply=new Common.UI.MenuItem({caption:this.txtReapply,checkable:!1}),this.miReapply.on("click",_.bind(this.onReapply,this)),this.miReapplySeparator=new Common.UI.MenuItem({caption:"--"}),this.miValueFilter=new Common.UI.MenuItem({caption:this.txtValueFilter,toggleGroup:"menufilterfilter",checkable:!0,checked:!1,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:Asc.c_oAscCustomAutoFilter.equals,caption:this.txtEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:Asc.c_oAscCustomAutoFilter.doesNotEqual,caption:this.txtNotEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:Asc.c_oAscCustomAutoFilter.isGreaterThan,caption:this.txtGreater,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo,caption:this.txtGreaterEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:Asc.c_oAscCustomAutoFilter.isLessThan,caption:this.txtLess,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo,caption:this.txtLessEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:-2,caption:this.txtBetween,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:-3,caption:this.txtNotBetween,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"value"},{value:Asc.c_oAscCustomAutoFilter.top10,caption:this.txtTop10,checkable:!0,type:Asc.c_oAscAutoFilterTypes.Top10,pivottype:"value"}]})}),this.miValueFilter.menu.on("item:click",_.bind(this.onValueFilterMenuClick,this)),this.miLabelFilter=new Common.UI.MenuItem({caption:this.txtLabelFilter,toggleGroup:"menufilterfilter",checkable:!0,checked:!1,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:Asc.c_oAscCustomAutoFilter.equals,caption:this.txtEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.doesNotEqual,caption:this.txtNotEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.beginsWith,caption:this.txtBegins,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.doesNotBeginWith,caption:this.txtNotBegins,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.endsWith,caption:this.txtEnds,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.doesNotEndWith,caption:this.txtNotEnds,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.contains,caption:this.txtContains,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.doesNotContain,caption:this.txtNotContains,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{caption:"--"},{value:Asc.c_oAscCustomAutoFilter.isGreaterThan,caption:this.txtGreater,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo,caption:this.txtGreaterEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.isLessThan,caption:this.txtLess,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo,caption:this.txtLessEquals,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:-2,caption:this.txtBetween,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"},{value:-3,caption:this.txtNotBetween,checkable:!0,type:Asc.c_oAscAutoFilterTypes.CustomFilters,pivottype:"label"}]})}),this.miLabelFilter.menu.on("item:click",_.bind(this.onLabelFilterMenuClick,this)),this.filtersMenu=new Common.UI.Menu({items:[this.miSortLow2High,this.miSortHigh2Low,this.miSortOptions,this.miSortCellColor,this.miSortFontColor,{caption:"--"},this.miLabelFilter,this.miValueFilter,this.miNumFilter,this.miTextFilter,this.miFilterCellColor,this.miFilterFontColor,this.miClear,this.miReapplySeparator,this.miReapply]});var o=this.$window.find("#menu-container-filters");this.filtersMenu.render(o),this.filtersMenu.cmpEl.attr({tabindex:"-1"}),this.mnuSortColorCellsPicker=new Common.UI.ColorPaletteExt({el:$("#filter-dlg-sort-cells-color"),colors:[]}),this.mnuSortColorCellsPicker.on("select",_.bind(this.onSortColorSelect,this,Asc.c_oAscSortOptions.ByColorFill)),this.mnuSortColorFontPicker=new Common.UI.ColorPaletteExt({el:$("#filter-dlg-sort-font-color"),colors:[]}),this.mnuSortColorFontPicker.on("select",_.bind(this.onSortColorSelect,this,Asc.c_oAscSortOptions.ByColorFont)),this.mnuFilterColorCellsPicker=new Common.UI.ColorPaletteExt({el:$("#filter-dlg-filter-cells-color"),colors:[]}),this.mnuFilterColorCellsPicker.on("select",_.bind(this.onFilterColorSelect,this,!0)),this.mnuFilterColorFontPicker=new Common.UI.ColorPaletteExt({el:$("#filter-dlg-filter-font-color"),colors:[]}),this.mnuFilterColorFontPicker.on("select",_.bind(this.onFilterColorSelect,this,!1)),this.input=new Common.UI.InputField({el:$("#id-sd-cell-search",this.$window),allowBlank:!0,placeHolder:this.txtEmpty,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(e,i){i.length?(i=i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),t.filter=new RegExp(i,"ig")):t.filter=void 0,t.setupDataCells()})),this.cells=new Common.UI.DataViewStore,this.filterExcludeCells=new Common.UI.DataViewStore,this.cells&&(this.cellsList=new Common.UI.ListView({el:$("#id-dlg-filter-values",this.$window),store:this.cells,simpleAddMode:!0,template:_.template(['<div class="listview inner" style="border:none;"></div>'].join("")),itemTemplate:_.template(["<div>",'<label class="checkbox-indeterminate" style="position:absolute;">','<input id="afcheckbox-<%= id %>" type="checkbox" class="button__checkbox">','<label for="afcheckbox-<%= id %>" class="checkbox__shape"></label>',"</label>",'<div id="<%= id %>" class="list-item" style="pointer-events:none; margin-left: 20px;display: flex;">','<div style="flex-grow: 1;"><%= Common.Utils.String.htmlEncode(value) %></div>','<% if (typeof count !=="undefined" && count) { %>','<div style="word-break: normal; margin-left: 10px; color: #afafaf;"><%= count%></div>',"<% } %>","</div>","</div>"].join(""))}),this.cellsList.store.comparator=function(t,e){if("0"==t.get("groupid"))return-1;if("0"==e.get("groupid"))return 1;if("2"==t.get("groupid"))return-1;if("2"==e.get("groupid"))return 1;var i=t.get("intval"),n=e.get("intval"),o=void 0!==i;return o!==(void 0!==n)?o?-1:1:(!o&&(i=t.get("cellvalue").toLowerCase())&&(n=e.get("cellvalue").toLowerCase()),i==n?0:""==n||""!==i&&i<n?-1:1)},this.cellsList.on({"item:change":this.onItemChanged.bind(this),"item:add":this.onItemChanged.bind(this),"item:select":this.onCellCheck.bind(this)}),this.cellsList.onKeyDown=_.bind(this.onListKeyDown,this)),this.setupDataCells(),this._setDefaults();var s=function(e){t._skipCheckDocumentClick||$(e.target).closest(".filter-dlg").length<=0&&t.close()};this.on("close",(function(){$(document.body).off("mousedown",s)})),_.delay((function(){$(document.body).on("mousedown",s)}),100,this),Common.Utils.InternalSettings.get("sse-settings-size-filter-window")&&this.cellsList.scroller.update({minScrollbarLength:this.cellsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0})},show:function(t,e){Common.UI.Window.prototype.show.call(this,t,e);var i=this;this.input&&_.delay((function(){i.input.focus()}),500,this)},onBtnClick:function(t){t.currentTarget.attributes&&t.currentTarget.attributes.result&&"cancel"===t.currentTarget.attributes.result.value&&this.close()},onApplyFilter:function(){this.testFilter()&&(this.save(),this.close())},onSortType:function(t){this.api&&this.configTo&&this.api.asc_sortColFilter(t,this.configTo.asc_getCellId(),this.configTo.asc_getDisplayName()),this.close()},onSortOptions:function(){var t=this,e=new SSE.Views.SortFilterDialog({api:this.api}).on({close:function(){t.close()}});this.close(),e.setSettings(this.configTo),e.show()},onNumCustomFilterItemClick:function(t){var e=this.configTo.asc_getFilterObj(),i="",n="",o=Asc.c_oAscCustomAutoFilter.equals,s=0,a=!0;if(e.asc_getType()==Asc.c_oAscAutoFilterTypes.CustomFilters){var l=e.asc_getFilter(),r=l.asc_getCustomFilters();a=l.asc_getAnd(),o=r[0].asc_getOperator(),s=r.length>1&&r[1].asc_getOperator()||0,i=null===r[0].asc_getVal()?"":r[0].asc_getVal(),n=r.length>1?null===r[1].asc_getVal()?"":r[1].asc_getVal():""}if(-1!==t.value){var c=new Asc.CustomFilters;c.asc_setCustomFilters(-2==t.value||-3==t.value?[new Asc.CustomFilter,new Asc.CustomFilter]:[new Asc.CustomFilter]);var d=c.asc_getCustomFilters();if(d[0].asc_setOperator(-2==t.value?Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo:-3==t.value?Asc.c_oAscCustomAutoFilter.isLessThan:t.value),-2==t.value){var h=o==Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo&&s==Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo;c.asc_setAnd(!h||a),d[0].asc_setVal(h?i:""),d[1].asc_setOperator(Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo),d[1].asc_setVal(h?n:"")}else if(-3==t.value){var p=o==Asc.c_oAscCustomAutoFilter.isLessThan&&s==Asc.c_oAscCustomAutoFilter.isGreaterThan;c.asc_setAnd(!!p&&a),d[0].asc_setVal(p?i:""),d[1].asc_setOperator(Asc.c_oAscCustomAutoFilter.isGreaterThan),d[1].asc_setVal(p?n:"")}else c.asc_setAnd(!0),d[0].asc_setVal(t.value==o?i:"");e.asc_setFilter(c),e.asc_setType(Asc.c_oAscAutoFilterTypes.CustomFilters)}var m,u=this;m="label"==t.options.pivottype||"value"==t.options.pivottype?new SSE.Views.PivotDigitalFilterDialog({api:this.api,type:t.options.pivottype}).on({close:function(){u.close()}}):new SSE.Views.DigitalFilterDialog({api:this.api,type:"number"}).on({close:function(){u.close()}}),this.close(),m.setSettings(this.configTo),m.show()},onTextFilterMenuClick:function(t,e){var i=this.configTo.asc_getFilterObj(),n="",o=Asc.c_oAscCustomAutoFilter.equals;if(i.asc_getType()==Asc.c_oAscAutoFilterTypes.CustomFilters){var s=i.asc_getFilter(),a=s.asc_getCustomFilters();s.asc_getAnd(),o=a[0].asc_getOperator(),a.length>1&&a[1].asc_getOperator()||0,n=null===a[0].asc_getVal()?"":a[0].asc_getVal(),a.length>1?null===a[1].asc_getVal()?"":a[1].asc_getVal():""}if(-1!==e.value){var l=new Asc.CustomFilters;l.asc_setCustomFilters([new Asc.CustomFilter]);var r=l.asc_getCustomFilters();l.asc_setAnd(!0),r[0].asc_setOperator(e.value),r[0].asc_setVal(e.value==o?n:""),i.asc_setFilter(l),i.asc_setType(Asc.c_oAscAutoFilterTypes.CustomFilters)}var c,d=this;c="label"==e.options.pivottype||"value"==e.options.pivottype?new SSE.Views.PivotDigitalFilterDialog({api:this.api,type:e.options.pivottype}).on({close:function(){d.close()}}):new SSE.Views.DigitalFilterDialog({api:this.api,type:"text"}).on({close:function(){d.close()}}),this.close(),c.setSettings(this.configTo),c.show()},onNumDynamicFilterItemClick:function(t){var e=this.configTo.asc_getFilterObj();e.asc_getType()!==Asc.c_oAscAutoFilterTypes.DynamicFilter&&(e.asc_setFilter(new Asc.DynamicFilter),e.asc_setType(Asc.c_oAscAutoFilterTypes.DynamicFilter)),e.asc_getFilter().asc_setType(t.value),this.api.asc_applyAutoFilter(this.configTo),this.close()},onTop10FilterItemClick:function(t){var e=this,i=new SSE.Views.Top10FilterDialog({api:this.api,type:t.options.pivottype}).on({close:function(){e.close()}});this.close(),i.setSettings(this.configTo),i.show()},onLabelFilterMenuClick:function(t,e){e.value==Asc.c_oAscCustomAutoFilter.isGreaterThan||e.value==Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo||e.value==Asc.c_oAscCustomAutoFilter.isLessThan||e.value==Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo||-2==e.value||-3==e.value?this.onNumCustomFilterItemClick(e):this.onTextFilterMenuClick(t,e)},onValueFilterMenuClick:function(t,e){var i=this;this.configTo.asc_getPivotObj().asc_getDataFields().length<2?Common.UI.warning({title:this.textWarning,msg:this.warnFilterError,callback:function(){_.delay((function(){i.close()}),10)}}):e.options.type==Asc.c_oAscAutoFilterTypes.CustomFilters?this.onNumCustomFilterItemClick(e):this.onTop10FilterItemClick(e)},onFilterColorSelect:function(t,e,i){var n=this.configTo.asc_getFilterObj();n.asc_getType()!==Asc.c_oAscAutoFilterTypes.ColorFilter&&(n.asc_setFilter(new Asc.ColorFilter),n.asc_setType(Asc.c_oAscAutoFilterTypes.ColorFilter));var o=n.asc_getFilter();o.asc_setCellColor(!!t&&null),o.asc_setCColor(t&&"transparent"==i||!t&&"#000000"==i?null:Common.Utils.ThemeColor.getRgbColor(i)),this.api.asc_applyAutoFilter(this.configTo),this.close()},onSortColorSelect:function(t,e,i){if(this.api&&this.configTo){var n=t==Asc.c_oAscSortOptions.ByColorFill;this.api.asc_sortColFilter(t,this.configTo.asc_getCellId(),this.configTo.asc_getDisplayName(),n&&"transparent"==i||!n&&"#000000"==i?null:Common.Utils.ThemeColor.getRgbColor(i))}this.close()},onCellCheck:function(t,e,i){if(!this.checkCellTrigerBlock){var n="",o=!1,s=null,a=window.event?window.event:window._event;if(a){if((n=$(a.currentTarget).find(".list-item")).length){s=n.get(0).getBoundingClientRect();var l=a.clientX*Common.Utils.zoom(),r=a.clientY*Common.Utils.zoom();s.left<l&&l<s.right&&s.top<r&&r<s.bottom&&(o=!0)}(o||a.target.className.match("checkbox")&&"input"!==a.target.localName)&&(this.updateCellCheck(t,i),_.delay((function(){t.focus()}),100,this))}}},onListKeyDown:function(t,e){var i=this.cellsList;i.disabled||(_.isUndefined(void 0)&&(e=t),e.keyCode==Common.UI.Keys.SPACE?(e.preventDefault(),e.stopPropagation(),this.updateCellCheck(i,i.getSelectedRec())):Common.UI.DataView.prototype.onKeyDown.call(this.cellsList,t,e))},updateCellCheck:function(t,e){if(e&&t){var i=!e.get("check"),n=this,o=n.filter?n.filteredIndexes:n.throughIndexes;if("0"==e.get("groupid"))this.cells.each((function(t){"2"!==t.get("groupid")&&(t.set("check",i),t.get("throughIndex")>1&&(o[parseInt(t.get("throughIndex"))]=i))}));else{e.set("check",i),o[parseInt(e.get("throughIndex"))]=i;for(var s=i,a=0;a<this.cells.length;a++){var l=this.cells.at(a);if("1"==l.get("groupid")&&l.get("check")!==i){s="indeterminate";break}}this.checkCellTrigerBlock=!0,this.cells.at(0).set("check",s),this.checkCellTrigerBlock=void 0}this.btnOk.setDisabled(!1),this.configTo.asc_getFilterObj().asc_setType(Asc.c_oAscAutoFilterTypes.Filters),t.scroller.update({minScrollbarLength:t.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0})}},onClear:function(){this.api&&this.configTo&&this.api.asc_clearFilterColumn(this.configTo.asc_getCellId(),this.configTo.asc_getDisplayName()),this.close()},onReapply:function(){this.api&&this.configTo&&this.api.asc_reapplyAutoFilter(this.config.asc_getDisplayName()),this.close()},setSettings:function(t){this.config=t,this.configTo=t},_setDefaults:function(){this.initialFilterType=this.configTo.asc_getFilterObj().asc_getType();var t=this.$window.find(".menu-panel"),e=this.configTo.asc_getPivotObj(),i=!!e,n=!1;this.miValueFilter.setVisible(i),this.miLabelFilter.setVisible(i),this.miSortOptions.setVisible(i),i&&(this.miReapplySeparator.setVisible(!1),this.miReapply.setVisible(!1),n=0!==e.asc_getDataFieldIndexFilter());var o=this.configTo.asc_getFilterObj(),s=this.initialFilterType===Asc.c_oAscAutoFilterTypes.CustomFilters,a=this.initialFilterType===Asc.c_oAscAutoFilterTypes.DynamicFilter,l=this.initialFilterType===Asc.c_oAscAutoFilterTypes.Top10,r=this.configTo.asc_getIsTextFilter(),c=this.configTo.asc_getColorsFill(),d=this.configTo.asc_getColorsFont(),h=this.configTo.asc_getSortState(),p=this.configTo.asc_getSortColor();p&&(p=Common.Utils.ThemeColor.getHexColor(p.get_r(),p.get_g(),p.get_b()).toLocaleUpperCase()),this.miTextFilter.setVisible(!i&&r),this.miNumFilter.setVisible(!i&&!r),this.miTextFilter.setChecked(s&&r,!0),this.miNumFilter.setChecked((s||a||l)&&!r,!0),this.miValueFilter.setChecked(i&&n,!0),this.miLabelFilter.setChecked(i&&!n&&(s||l),!0),this.miSortLow2High.setChecked(h==Asc.c_oAscSortOptions.Ascending,!0),this.miSortHigh2Low.setChecked(h==Asc.c_oAscSortOptions.Descending,!0);var m=d&&d.length>0;if(this.miSortFontColor.setVisible(m),this.miFilterFontColor.setVisible(!i&&m),m){var u=[];d.forEach((function(t,e){t?u.push(Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()).toLocaleUpperCase()):u.push("000000")})),this.mnuSortColorFontPicker.updateColors(u),this.mnuFilterColorFontPicker.updateColors(u),this.miFilterFontColor.setChecked(!1,!0),this.miSortFontColor.setChecked(h==Asc.c_oAscSortOptions.ByColorFont,!0),h==Asc.c_oAscSortOptions.ByColorFont&&this.mnuSortColorFontPicker.select(p||"000000",!0)}if(m=c&&c.length>0,this.miSortCellColor.setVisible(m),this.miFilterCellColor.setVisible(!i&&m),m){u=[];c.forEach((function(t,e){t?u.push(Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()).toLocaleUpperCase()):u.push("transparent")})),this.mnuSortColorCellsPicker.updateColors(u),this.mnuFilterColorCellsPicker.updateColors(u),this.miFilterCellColor.setChecked(!1,!0),this.miSortCellColor.setChecked(h==Asc.c_oAscSortOptions.ByColorFill,!0),h==Asc.c_oAscSortOptions.ByColorFill&&this.mnuSortColorCellsPicker.select(p||"transparent",!0)}if(s){var g=o.asc_getFilter(),f=g.asc_getCustomFilters(),b=(g.asc_getAnd(),f[0].asc_getOperator()),C=f.length>1&&f[1].asc_getOperator()||0,v=i?n?this.miValueFilter.menu.items:this.miLabelFilter.menu.items:r?this.miTextFilter.menu.items:this.miNumFilter.menu.items,_=!0;1==f.length?v.forEach((function(t){var e=t.options.type==Asc.c_oAscAutoFilterTypes.CustomFilters&&t.value==b;t.setChecked(e,!0),e&&(_=!1)})):!i&&r||b!=Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo||C!=Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo?i&&b==Asc.c_oAscCustomAutoFilter.isLessThan&&C==Asc.c_oAscCustomAutoFilter.isGreaterThan&&(v[n?7:14].setChecked(!0,!0),_=!1):(v[i&&!n?13:6].setChecked(!0,!0),_=!1),_&&v[v.length-1].setChecked(!0,!0)}else if(this.initialFilterType===Asc.c_oAscAutoFilterTypes.ColorFilter){var x=o.asc_getFilter(),y=x.asc_getCColor();y&&(y=Common.Utils.ThemeColor.getHexColor(y.get_r(),y.get_g(),y.get_b()).toLocaleUpperCase()),null===x.asc_getCellColor()?(this.miFilterCellColor.setChecked(!0,!0),this.mnuFilterColorCellsPicker.select(y||"transparent",!0)):!1===x.asc_getCellColor()&&(this.miFilterFontColor.setChecked(!0,!0),this.mnuFilterColorFontPicker.select(y||"000000",!0))}else if(a||l){var w=a?o.asc_getFilter().asc_getType():null;(v=i?this.miValueFilter.menu.items:this.miNumFilter.menu.items).forEach((function(t){t.setChecked(a&&t.options.type==Asc.c_oAscAutoFilterTypes.DynamicFilter&&t.value==w||l&&t.options.type==Asc.c_oAscAutoFilterTypes.Top10,!0)}))}this.miClear.setDisabled(this.initialFilterType===Asc.c_oAscAutoFilterTypes.None),this.miReapply.setDisabled(this.initialFilterType===Asc.c_oAscAutoFilterTypes.None),this.btnOk.setDisabled(this.initialFilterType!==Asc.c_oAscAutoFilterTypes.Filters&&this.initialFilterType!==Asc.c_oAscAutoFilterTypes.None),this.menuPanelWidth=t.innerWidth();var S=this.getWidth();S-this.menuPanelWidth<260&&(S=Math.ceil(this.menuPanelWidth+260),this.setResizable(!0,[S,this.initConfig.minheight])),Common.Utils.InternalSettings.get("sse-settings-size-filter-window")&&(S=Common.Utils.InternalSettings.get("sse-settings-size-filter-window")[0]+this.menuPanelWidth),i&&e.asc_getIsPageFilter()&&(this.setResizable(!0,[this.initConfig.minwidth-this.menuPanelWidth,this.initConfig.minheight]),t.addClass("hidden"),S-=this.menuPanelWidth,this.menuPanelWidth=0),this.setSize(S,this.getHeight())},setupDataCells:function(){var t,e,i,n=this,o=0,s=2,a=!0,l=!1,r=0,c=[],d=[],h=n.filter?n.filteredIndexes:n.throughIndexes;this.configTo.asc_getValues().forEach((function(l){e=l.asc_getText(),t=function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(e),a=!0,i=l.asc_getRepeats?l.asc_getRepeats():void 0,n.filter?(null===e.match(n.filter)&&(a=!1),h[s]=a):null==h[s]&&(h[s]=l.asc_getVisible()),a?(c.push(new Common.UI.DataViewModel({id:++o,selected:!1,allowSelected:!0,cellvalue:e,value:t||e.length>0?e:n.textEmptyItem,intval:t?parseFloat(e):void 0,strval:t?"":e,groupid:"1",check:h[s],throughIndex:s,count:i?i.toString():""})),h[s]&&r++):d.push(new Common.UI.DataViewModel({cellvalue:e})),++s})),r==c.length?l=!0:r>0&&(l="indeterminate"),(n.filter||null==h[0])&&(h[0]=!0),(!n.filter||c.length>0)&&c.unshift(new Common.UI.DataViewModel({id:++o,selected:!1,allowSelected:!0,value:n.filter?this.textSelectAllResults:this.textSelectAll,groupid:"0",check:h[0],throughIndex:0})),n.filter&&c.length>1&&(null==h[1]&&(h[1]=!1),c.splice(1,0,new Common.UI.DataViewModel({id:++o,selected:!1,allowSelected:!0,value:this.textAddSelection,groupid:"2",check:h[1],throughIndex:1}))),this.cells.reset(c),this.filterExcludeCells.reset(d),this.cells.length&&(this.checkCellTrigerBlock=!0,this.cells.at(0).set("check",l),this.checkCellTrigerBlock=void 0),this.btnOk.setDisabled(this.cells.length<1),this.cellsList.scroller.update({minScrollbarLength:this.cellsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}),this.cellsList.cmpEl.toggleClass("scroll-padding",this.cellsList.scroller.isVisible())},testFilter:function(){var t=this,e=!1;return this.cells&&(this.filter&&this.filteredIndexes[1]?e=!0:this.cells.forEach((function(t){if("1"==t.get("groupid")&&t.get("check"))return e=!0,!0}))),e||(t._skipCheckDocumentClick=!0,Common.UI.warning({title:this.textWarning,msg:this.warnNoSelected,callback:function(){t._skipCheckDocumentClick=!1,_.delay((function(){t.input.focus()}),100,this)}})),e},save:function(){if(this.api&&this.configTo&&this.cells&&this.filterExcludeCells){var t=this.configTo.asc_getValues(),e=!1;if(this.filter&&this.filteredIndexes[1])this.initialFilterType===Asc.c_oAscAutoFilterTypes.CustomFilters&&t.forEach((function(t,e){t.asc_setVisible(!0)})),this.cells.each((function(e){"1"==e.get("groupid")&&t[parseInt(e.get("throughIndex"))-2].asc_setVisible(e.get("check"))})),t.forEach((function(t,i){if(t.asc_getVisible())return e=!0,!0}));else{var i=this.filter?this.filteredIndexes:this.throughIndexes;t.forEach((function(t,e){t.asc_setVisible(i[e+2])})),e=!0}if(e){var n=this.configTo.asc_getPivotObj();n&&n.asc_getIsPageFilter()&&n.asc_setIsMultipleItemSelectionAllowed(!0),this.configTo.asc_getFilterObj().asc_setType(Asc.c_oAscAutoFilterTypes.Filters),this.api.asc_applyAutoFilter(this.configTo)}}},onPrimary:function(){return this.save(),this.close(),!1},onWindowResize:function(t){if(t&&"start"==t[1])this.curSize={resize:!1,height:this.getSize()[1]};else if(this.curSize.resize){this.getSize();this.cellsList.scroller.update({minScrollbarLength:this.cellsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0})}},onWindowResizing:function(){if(this.curSize){var t=this.getSize();t[1]!==this.curSize.height&&(this.curSize.resize||(this.curSize.resize=!0,this.cellsList.scroller.update({minScrollbarLength:this.cellsList.minScrollbarLength,alwaysVisibleY:!1,suppressScrollX:!0})),this.curSize.height=t[1]),t[0]-=this.menuPanelWidth,Common.Utils.InternalSettings.set("sse-settings-size-filter-window",t)}},onItemChanged:function(t,e){var i=e.model.get("check");"indeterminate"==i?$("input[type=checkbox]",e.$el).prop("indeterminate",!0):$("input[type=checkbox]",e.$el).prop({checked:i,indeterminate:!1})},btnCustomFilter:"Custom Filter",textSelectAll:"Select All",txtTitle:"Filter",warnNoSelected:"You must choose at least one value",textWarning:"Warning",textEmptyItem:"{Blanks}",txtEmpty:"Enter cell's filter",txtSortLow2High:"Sort Lowest to Highest",txtSortHigh2Low:"Sort Highest to Lowest",txtSortCellColor:"Sort by cells color",txtSortFontColor:"Sort by font color",txtNumFilter:"Number filter",txtTextFilter:"Text filter",txtFilterCellColor:"Filter by cells color",txtFilterFontColor:"Filter by font color",txtClear:"Clear",txtReapply:"Reapply",txtEquals:"Equals...",txtNotEquals:"Does not equal...",txtGreater:"Greater than...",txtGreaterEquals:"Greater than or equal to...",txtLess:"Less than...",txtLessEquals:"Less than or equal to...",txtBetween:"Between...",txtTop10:"Top 10",txtAboveAve:"Above average",txtBelowAve:"Below average",txtBegins:"Begins with...",txtNotBegins:"Does not begin with...",txtEnds:"Ends with...",txtNotEnds:"Does not end with...",txtContains:"Contains...",txtNotContains:"Does not contain...",textSelectAllResults:"Select All Search Results",textAddSelection:"Add current selection to filter",txtValueFilter:"Value filter",txtLabelFilter:"Label filter",warnFilterError:"You need at least one field in the Values area in order to apply a value filter.",txtNotBetween:"Not between...",txtSortOption:"More sort options..."},SSE.Views.AutoFilterDialog||{}))})),define("spreadsheeteditor/main/app/view/SpecialPasteDialog",["common/main/lib/util/utils","common/main/lib/component/RadioBox","common/main/lib/component/CheckBox","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.SpecialPasteDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:350,height:385},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 5px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="2" style="width: 100%;">',"<tr>",'<td colspan=2 class="padding-small">','<label class="header">',e.textPaste,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-all"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-without-borders"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-formulas"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-formula-formats"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-values"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-formula-col-width"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-formats"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-formula-num-format"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-comments"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-value-num-format"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<div id="paste-radio-col-width"></div>',"</td>",'<td class="padding-large">','<div id="paste-radio-value-formats"></div>',"</td>","</tr>","<tr>",'<td colspan=2 class="padding-small">','<label class="header">',e.textOperation,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-none"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-mult"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-add"></div>',"</td>",'<td class="padding-small">','<div id="paste-radio-div"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-radio-sub"></div>',"</td>",'<td class="padding-small">',"</td>","</tr>","<tr>",'<td colspan=2 class="padding-small" style="border-top: 1px solid #cbcbcb;">',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="paste-checkbox-transpose"></div>',"</td>",'<td class="padding-small">','<div id="paste-checkbox-blanks"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.handler=t.handler,this.props=t.props,this._changedProps=null,this.isTable=!!t.isTable,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.propControls=[],this.radioAll=new Common.UI.RadioBox({el:$("#paste-radio-all"),name:"asc-radio-paste",labelText:this.textAll,value:Asc.c_oSpecialPasteProps.paste,disabled:!0}),this.radioAll.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.paste]=this.radioAll,this.radioFormulas=new Common.UI.RadioBox({el:$("#paste-radio-formulas"),name:"asc-radio-paste",labelText:this.textFormulas,value:Asc.c_oSpecialPasteProps.pasteOnlyFormula,disabled:!0}),this.radioFormulas.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.pasteOnlyFormula]=this.radioFormulas,this.radioValues=new Common.UI.RadioBox({el:$("#paste-radio-values"),name:"asc-radio-paste",labelText:this.textValues,value:Asc.c_oSpecialPasteProps.pasteOnlyValues,disabled:!0}),this.radioValues.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.pasteOnlyValues]=this.radioValues,this.radioFormats=new Common.UI.RadioBox({el:$("#paste-radio-formats"),name:"asc-radio-paste",labelText:this.textFormats,value:Asc.c_oSpecialPasteProps.pasteOnlyFormating,disabled:!0}),this.radioFormats.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.pasteOnlyFormating]=this.radioFormats,this.radioComments=new Common.UI.RadioBox({el:$("#paste-radio-comments"),name:"asc-radio-paste",labelText:this.textComments,value:Asc.c_oSpecialPasteProps.comments,disabled:!0}),this.radioComments.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.comments]=this.radioComments,this.radioColWidth=new Common.UI.RadioBox({el:$("#paste-radio-col-width"),name:"asc-radio-paste",labelText:this.textColWidth,value:Asc.c_oSpecialPasteProps.columnWidth,disabled:!0}),this.radioColWidth.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.columnWidth]=this.radioColWidth,this.radioWBorders=new Common.UI.RadioBox({el:$("#paste-radio-without-borders"),name:"asc-radio-paste",labelText:this.textWBorders,value:Asc.c_oSpecialPasteProps.formulaWithoutBorders,disabled:!0}),this.radioWBorders.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.formulaWithoutBorders]=this.radioWBorders,this.radioFFormat=new Common.UI.RadioBox({el:$("#paste-radio-formula-formats"),name:"asc-radio-paste",labelText:this.textFFormat,value:Asc.c_oSpecialPasteProps.formulaAllFormatting,disabled:!0}),this.radioFFormat.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.formulaAllFormatting]=this.radioFFormat,this.radioFWidth=new Common.UI.RadioBox({el:$("#paste-radio-formula-col-width"),name:"asc-radio-paste",labelText:this.textFWidth,value:Asc.c_oSpecialPasteProps.formulaColumnWidth,disabled:!0}),this.radioFWidth.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.formulaColumnWidth]=this.radioFWidth,this.radioFNFormat=new Common.UI.RadioBox({el:$("#paste-radio-formula-num-format"),name:"asc-radio-paste",labelText:this.textFNFormat,value:Asc.c_oSpecialPasteProps.formulaNumberFormat,disabled:!0}),this.radioFNFormat.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.formulaNumberFormat]=this.radioFNFormat,this.radioVNFormat=new Common.UI.RadioBox({el:$("#paste-radio-value-num-format"),name:"asc-radio-paste",labelText:this.textVNFormat,value:Asc.c_oSpecialPasteProps.valueNumberFormat,disabled:!0}),this.radioVNFormat.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.valueNumberFormat]=this.radioVNFormat,this.radioVFormat=new Common.UI.RadioBox({el:$("#paste-radio-value-formats"),name:"asc-radio-paste",labelText:this.textVFormat,value:Asc.c_oSpecialPasteProps.valueAllFormating,disabled:!0}),this.radioVFormat.on("change",_.bind(this.onRadioPasteChange,this)),this.propControls[Asc.c_oSpecialPasteProps.valueAllFormating]=this.radioVFormat,this.radioNone=new Common.UI.RadioBox({el:$("#paste-radio-none"),name:"asc-radio-paste-operation",labelText:this.textNone,value:Asc.c_oSpecialPasteOperation.none,checked:!0}),this.radioNone.on("change",_.bind(this.onRadioOperationChange,this)),this.radioAdd=new Common.UI.RadioBox({el:$("#paste-radio-add"),name:"asc-radio-paste-operation",labelText:this.textAdd,value:Asc.c_oSpecialPasteOperation.add}),this.radioAdd.on("change",_.bind(this.onRadioOperationChange,this)),this.radioMult=new Common.UI.RadioBox({el:$("#paste-radio-mult"),name:"asc-radio-paste-operation",labelText:this.textMult,value:Asc.c_oSpecialPasteOperation.multiply}),this.radioMult.on("change",_.bind(this.onRadioOperationChange,this)),this.radioSub=new Common.UI.RadioBox({el:$("#paste-radio-sub"),name:"asc-radio-paste-operation",labelText:this.textSub,value:Asc.c_oSpecialPasteOperation.subtract}),this.radioSub.on("change",_.bind(this.onRadioOperationChange,this)),this.radioDiv=new Common.UI.RadioBox({el:$("#paste-radio-div"),name:"asc-radio-paste-operation",labelText:this.textDiv,value:Asc.c_oSpecialPasteOperation.divide}),this.radioDiv.on("change",_.bind(this.onRadioOperationChange,this)),this.chBlanks=new Common.UI.CheckBox({el:$("#paste-checkbox-blanks"),labelText:this.textBlanks}),this.chTranspose=new Common.UI.CheckBox({el:$("#paste-checkbox-transpose"),labelText:this.textTranspose}),this.afterRender()},getFocusedComponents:function(){return[this.radioAll,this.radioFormulas,this.radioValues,this.radioFormats,this.radioComments,this.radioColWidth,this.radioWBorders,this.radioFFormat,this.radioFWidth,this.radioFNFormat,this.radioVNFormat,this.radioVFormat,this.radioNone,this.radioAdd,this.radioMult,this.radioSub,this.radioDiv,this.chBlanks,this.chTranspose]},getDefaultFocusableComponent:function(){return this.radioAll},afterRender:function(){this._setDefaults(this.props)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){var e=this;t&&_.each(t,(function(t,i){e.propControls[t]&&e.propControls[t].setDisabled(!1)})),this._changedProps=new Asc.SpecialPasteProps,this._changedProps.asc_setProps(Asc.c_oSpecialPasteProps.paste),this._changedProps.asc_setOperation(Asc.c_oSpecialPasteOperation.none),this.radioAll.setValue(!0)},getSettings:function(){return this._changedProps&&(this._changedProps.asc_setTranspose("checked"==this.chTranspose.getValue()),this._changedProps.asc_setSkipBlanks("checked"==this.chBlanks.getValue())),this._changedProps},onDlgBtnClick:function(t){this._handleInput("object"==typeof t?t.currentTarget.attributes.result.value:t)},onPrimary:function(){return this._handleInput("ok"),!1},_handleInput:function(t){this.handler&&this.handler.call(this,t,"ok"==t?this.getSettings():void 0),this.close()},onRadioPasteChange:function(t,e,i){if(e&&this._changedProps){this._changedProps.asc_setProps(t.options.value);var n=t.options.value==Asc.c_oSpecialPasteProps.pasteOnlyFormating||t.options.value==Asc.c_oSpecialPasteProps.comments||t.options.value==Asc.c_oSpecialPasteProps.columnWidth,o=this.isTable&&!!this._changedProps.asc_getTableAllowed();this.radioNone.setDisabled(n||o),this.radioAdd.setDisabled(n||o),this.radioDiv.setDisabled(n||o),this.radioSub.setDisabled(n||o),this.radioMult.setDisabled(n||o),this.chBlanks.setDisabled(o),this.chTranspose.setDisabled(o)}},onRadioOperationChange:function(t,e,i){e&&this._changedProps&&this._changedProps.asc_setOperation(t.options.value)},textTitle:"Paste Special",textAll:"All",textFormulas:"Formulas",textValues:"Values",textFormats:"Formats",textComments:"Comments",textColWidth:"Column widths",textWBorders:"All except borders",textFFormat:"Formulas & formatting",textFWidth:"Formulas & column widths",textFNFormat:"Formulas & number formats",textVNFormat:"Values & number formats",textVFormat:"Values & formatting",textNone:"None",textAdd:"Add",textMult:"Multiply",textDiv:"Divide",textSub:"Subtract",textBlanks:"Skip blanks",textTranspose:"Transpose",textOperation:"Operation",textPaste:"Paste"},SSE.Views.SpecialPasteDialog||{}))})),define("text!spreadsheeteditor/main/app/template/SlicerSettingsAdvanced.template",[],(function(){return'<div id="id-adv-slicer-style" class="settings-panel active">\n    <div class="inner-content">\n        <div>\n            <div class="padding-small" style="display: inline-block;">\n                <label class="input-label"><%= scope.textHeader %></label>\n                <div id="sliceradv-text-header"></div>\n            </div>\n        </div>\n        <div class="padding-large" id="sliceradv-checkbox-header"></div>\n        <div class="padding-very-small"><label class="header"><%= scope.strStyle %></label></div>\n        <div class="padding-large">\n            <div id="sliceradv-btn-style" style="width: 100%;height: 52px;"></div>\n        </div>\n        <div class="padding-very-small"><label class="header"><%= scope.strSize %></label></div>\n        <div>\n            <div class="padding-large" style="display: inline-block; margin-right: 5px;">\n                <label class="input-label"><%= scope.strWidth %></label>\n                <div id="sliceradv-spin-width"></div>\n            </div>\n            <div id="sliceradv-button-ratio" style="display: inline-block; margin-right: 5px;"></div>\n            <div class="padding-large" style="display: inline-block;">\n                <label class="input-label"><%= scope.strHeight %></label>\n                <div id="sliceradv-spin-height"></div>\n            </div>\n        </div>\n        <div class="padding-very-small"><label class="header"><%= scope.strButtons %></label></div>\n        <div>\n            <div style="display: inline-block; margin-right: 5px;">\n                <label class="input-label"><%= scope.strColumns %></label>\n                <div id="sliceradv-spin-columns"></div>\n            </div>\n            <div style="display: inline-block;">\n                <label class="input-label"><%= scope.strHeight %></label>\n                <div id="sliceradv-spin-col-height"></div>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="id-adv-slicer-sorting" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-small">\n            <label class="header"><%= scope.textSort %></label>\n        </div>\n        <div class="padding-large">\n            <div style="display: inline-block;">\n                <div class="padding-small" id="sliceradv-radio-asc"></div>\n                <div class="padding-small" id="sliceradv-radio-desc"></div>\n            </div>\n        </div>\n        <div>\n            <div style="display: inline-block;">\n                <div class="padding-small" id="sliceradv-check-hide-nodata"></div>\n                <div class="padding-small" id="sliceradv-check-indicate-nodata"></div>\n                <div class="padding-small" id="sliceradv-check-show-nodata-last"></div>\n                \x3c!--<div class="padding-small" id="sliceradv-check-show-deleted"></div>--\x3e\n            </div>\n        </div>\n    </div>\n</div>\n<div id="id-adv-slicer-references" class="settings-panel">\n    <div class="inner-content">\n        <div class="padding-large">\n            <label class="header" style="display: block;"><%= scope.textSourceName %></label>\n            <label class="input-label" id="sliceradv-lbl-source"></label>\n        </div>\n        <div class="padding-large">\n            <label class="header" style="display: block;"><%= scope.textFormulaName %></label>\n            <label class="input-label" id="sliceradv-lbl-formula"></label>\n        </div>\n        <div class="padding-large">\n            <label class="header"><%= scope.textName %></label>\n            <div id="sliceradv-text-name"></div>\n        </div>\n    </div>\n</div>\n<div id="id-adv-slicer-snap" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1">\n            <tr>\n                <td class="padding-small">\n                    <div id="slicer-advanced-radio-twocell"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="slicer-advanced-radio-onecell"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="slicer-advanced-radio-absolute"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-slicer-alttext" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" width="100%">\n            <tr>\n                <td class="padding-large">\n                    <label class="header"><%= scope.textAltTitle %></label>\n                    <div id="sliceradv-alt-title"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label class="header"><%= scope.textAltDescription %></label>\n                    <textarea id="sliceradv-alt-description" class="form-control" style="width: 100%; height: 120px;"></textarea>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label><%= scope.textAltTip %></label>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),void 0===Common)var Common={};define("common/main/lib/component/ComboDataView",["common/main/lib/component/BaseView","common/main/lib/component/DataView"],(function(){"use strict";Common.UI.ComboDataView=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,itemWidth:80,itemHeight:40,menuMaxHeight:300,enableKeyEvents:!1,beforeOpenHandler:null,additionalMenuItems:null,showLast:!0,minWidth:-1,dataHint:"",dataHintDirection:"",dataHintOffset:""},template:_.template(['<div id="<%= id %>" class="combo-dataview <%= cls %>" style="<%= style %>">','<div class="view"></div> ','<div class="button"></div> ',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.id=this.options.id||Common.UI.getId(),this.cls=this.options.cls,this.style=this.options.style,this.hint=this.options.hint,this.store=this.options.store||new Common.UI.DataViewStore,this.groups=this.options.groups,this.itemWidth=this.options.itemWidth,this.itemHeight=this.options.itemHeight,this.menuMaxHeight=this.options.menuMaxHeight,this.beforeOpenHandler=this.options.beforeOpenHandler,this.showLast=this.options.showLast,this.rootWidth=0,this.rootHeight=0,this.rendered=!1,this.needFillComboView=!1,this.minWidth=this.options.minWidth,this.delayRenderTips=this.options.delayRenderTips||!1,this.itemTemplate=this.options.itemTemplate||_.template(['<div class="style" id="<%= id %>">','<img src="<%= imageUrl %>" width="'+this.itemWidth+'" height="'+this.itemHeight+'" + <% if(typeof imageUrl === "undefined" || imageUrl===null || imageUrl==="") { %> style="visibility: hidden;" <% } %>/>','<% if (typeof title !== "undefined") {%>','<span class="title"><%= title %></span>',"<% } %>","</div>"].join("")),this.fieldPicker=new Common.UI.DataView({cls:"field-picker",allowScrollbar:!1,itemTemplate:this.itemTemplate,delayRenderTips:this.delayRenderTips}),this.openButton=new Common.UI.Button({cls:"open-menu",menu:new Common.UI.Menu({menuAlign:"tl-tl",offset:[0,3],items:[{template:_.template('<div class="menu-picker-container"></div>')}].concat(null!=this.options.additionalMenuItems?this.options.additionalMenuItems:[])}),dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset}),this.menuPicker=new Common.UI.DataView({cls:"menu-picker",parentMenu:this.openButton.menu,outerMenu:this.options.additionalMenuItems?{menu:this.openButton.menu,index:0}:void 0,restoreHeight:this.menuMaxHeight,style:"max-height: "+this.menuMaxHeight+"px;",enableKeyEvents:this.options.enableKeyEvents,groups:this.groups,store:this.store,itemTemplate:this.itemTemplate,delayRenderTips:this.delayRenderTips}),null!=this.options.additionalMenuItems&&this.openButton.menu.setInnerMenu([{menu:this.menuPicker,index:0}]),setInterval(_.bind(this.checkSize,this),500),this.options.el&&this.render()},render:function(t){if(!this.rendered){var e=this;e.trigger("render:before",e),e.cmpEl=e.$el||$(e.el);var i=e.template({id:e.id,cls:e.cls,style:e.style});t?(e.setElement(t,!1),e.cmpEl=$(i),t.html(e.cmpEl)):e.cmpEl.html(i),e.rootWidth=e.cmpEl.width(),e.rootHeight=e.cmpEl.height(),e.fieldPicker.render($(".view",e.cmpEl)),e.openButton.render($(".button",e.cmpEl)),e.menuPicker.render($(".menu-picker-container",e.cmpEl)),e.openButton.menu.cmpEl&&e.openButton.menu.cmpEl&&(e.openButton.menu.menuAlignEl=e.cmpEl,e.openButton.menu.cmpEl.css("min-width",e.itemWidth),e.openButton.menu.on("show:before",_.bind(e.onBeforeShowMenu,e)),e.openButton.menu.on("show:after",_.bind(e.onAfterShowMenu,e)),e.openButton.cmpEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),e.openButton.cmpEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e))),e.options.hint&&(e.cmpEl.attr("data-toggle","tooltip"),e.cmpEl.tooltip({title:e.options.hint,placement:e.options.hintAnchor||"cursor"})),e.fieldPicker.on("item:select",_.bind(e.onFieldPickerSelect,e)),e.menuPicker.on("item:select",_.bind(e.onMenuPickerSelect,e)),e.fieldPicker.on("item:click",_.bind(e.onFieldPickerClick,e)),e.menuPicker.on("item:click",_.bind(e.onMenuPickerClick,e)),e.fieldPicker.on("item:contextmenu",_.bind(e.onPickerItemContextMenu,e)),e.menuPicker.on("item:contextmenu",_.bind(e.onPickerItemContextMenu,e)),e.fieldPicker.el.addEventListener("contextmenu",_.bind(e.onPickerComboContextMenu,e),!1),e.menuPicker.el.addEventListener("contextmenu",_.bind(e.onPickerComboContextMenu,e),!1),e.onResize(),e.rendered=!0,e.trigger("render:after",e)}return this.disabled&&this.setDisabled(!!this.disabled),this},checkSize:function(){if(this.cmpEl&&this.cmpEl.is(":visible")){var t=this,e=this.cmpEl.width(),i=this.cmpEl.height();if(e<this.minWidth)return;this.rootWidth==e&&this.rootHeight==i||(this.rootWidth=e,this.rootHeight=i,setTimeout((function(){t.openButton.menu.cmpEl.outerWidth(),t.rootWidth=t.cmpEl.width()}),10),this.onResize())}},onResize:function(){if(this.openButton){var t=$("button",this.openButton.cmpEl),e=$(".button",this.cmpEl);t&&e.width()>0&&t.css({width:e.width(),height:e.height()}),this.openButton.menu.hide();var i=this.menuPicker;if(i){var n=i.getSelectedRec();this.itemMarginLeft=void 0,this.fillComboView(n||i.store.at(0),!!n,!0),i.onResize()}}this.isSuspendEvents||this.trigger("resize",this)},onBeforeShowMenu:function(t){var e=this;if(_.isFunction(e.beforeOpenHandler))e.beforeOpenHandler(e,t);else if(e.openButton.menu.cmpEl){var i=0;try{var n=$($(".dropdown-menu .dataview.inner .style",e.cmpEl)[0]);i=n?parseInt(n.css("margin-left"))+parseInt(n.css("margin-right")):0}catch(t){}e.openButton.menu.cmpEl.css({width:Math.round((e.cmpEl.width()+i*e.fieldPicker.store.length)/e.itemWidth-.2)*(e.itemWidth+i),"min-height":this.cmpEl.height()})}if(e.options.hint){var o=e.cmpEl.data("bs.tooltip");o&&(void 0===o.dontShow&&(o.dontShow=!0),o.hide())}this.menuPicker.selectedBeforeHideRec=null},onBeforeHideMenu:function(t){if(this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault(),this.isStylesNotClosable)return!1},onAfterShowMenu:function(t){this.menuPicker.scroller&&this.menuPicker.scroller.update({includePadding:!0,suppressScrollX:!0,alwaysVisibleY:!0})},onAfterHideMenu:function(t,e){this.menuPicker.selectedBeforeHideRec=this.menuPicker.getSelectedRec(),this.showLast?this.menuPicker.showLastSelected():this.menuPicker.deselectAll(),this.trigger("hide:after",this,t,e)},onFieldPickerSelect:function(t,e,i){},onMenuPickerSelect:function(t,e,i,n){this.needFillComboView=this.disabled,this.disabled||!0===n||(this.fillComboView(i,!1),i&&!this.isSuspendEvents&&this.trigger("select",this,i))},onFieldPickerClick:function(t,e,i){if(!this.disabled){if(this.isSuspendEvents||this.trigger("click",this,i),this.options.hint){var n=this.cmpEl.data("bs.tooltip");n&&(void 0===n.dontShow&&(n.dontShow=!0),n.hide())}this.showLast||this.fieldPicker.deselectAll()}},onMenuPickerClick:function(t,e,i){this.disabled||this.isSuspendEvents||this.trigger("click",this,i)},onPickerItemContextMenu:function(t,e,i,n){if(!this.disabled)return this.isSuspendEvents||this.trigger("contextmenu",this,i,n),n.preventDefault(),n.stopPropagation(),!1},onPickerComboContextMenu:function(t){this.disabled||this.isSuspendEvents||this.trigger("contextmenu",this,void 0,t)},setDisabled:function(t){if(t=!!t,this.disabled=t,this.rendered&&(this.cmpEl.toggleClass("disabled",t),$("button",this.openButton.cmpEl).toggleClass("disabled",t),this.fieldPicker.setDisabled(t),this.needFillComboView&&!t)){var e=this.menuPicker;if(e){var i=e.getSelectedRec();this.fillComboView(i||e.store.at(0),!1)}}},isDisabled:function(){return this.disabled},fillComboView:function(t,e,i){if(!_.isUndefined(t)&&t instanceof Backbone.Model){this.needFillComboView=!this.isVisible();var n=this,o=n.menuPicker.store,s=$(n.fieldPicker.el);if(o){if(i||!n.fieldPicker.store.findWhere({id:t.get("id")})){if(void 0===n.itemMarginLeft){var a=$($(this.menuPicker.el).find(".inner > div:not(.grouped-data):not(.ps-scrollbar-x-rail):not(.ps-scrollbar-y-rail)")[0]);(!a||a.length<1)&&(a=$($(this.menuPicker.el).find(".inner .group-items-container > div:not(.grouped-data):not(.ps-scrollbar-x-rail):not(.ps-scrollbar-y-rail)")[0])),a.length>0&&(n.itemMarginLeft=parseInt(a.css("margin-left")),n.itemMarginRight=parseInt(a.css("margin-right")),n.itemPaddingLeft=parseInt(a.css("padding-left")),n.itemPaddingRight=parseInt(a.css("padding-right")),n.itemBorderLeft=parseInt(a.css("border-left-width")),n.itemBorderRight=parseInt(a.css("border-right-width")))}var l=o.indexOf(t);if(l<0)return;var r=o.length,c=Math.floor(Math.max(s.width(),n.minWidth)/(n.itemWidth+(n.itemMarginLeft||0)+(n.itemMarginRight||0)+(n.itemPaddingLeft||0)+(n.itemPaddingRight||0)+(n.itemBorderLeft||0)+(n.itemBorderRight||0))),d=[];s.height()/n.itemHeight>2&&(c*=Math.floor(s.height()/n.itemHeight)),r-(l=Math.floor(l/c)*c)<c&&(l=Math.max(r-c,0));for(var h=l,p=0;h<r&&p<c;h++,p++)d.push(o.at(h));n.fieldPicker.store.reset(d)}if(e){var m=n.fieldPicker.store.findWhere({id:t.get("id")});m&&(n.suspendEvents(),n.fieldPicker.selectRecord(m,!0),n.resumeEvents())}return n.fieldPicker.store.models}}},clearComboView:function(){this.fieldPicker.store.reset([])},selectByIndex:function(t){t<0&&this.fieldPicker.deselectAll(),this.menuPicker.selectByIndex(t)},selectRecord:function(t){t||this.fieldPicker.deselectAll(),this.menuPicker.selectRecord(t)},setItemWidth:function(t){this.itemWidth!=t&&(this.itemWidth=Common.Utils.applicationPixelRatio()>1?t/2:t)},setItemHeight:function(t){this.itemHeight!=t&&(this.itemHeight=Common.Utils.applicationPixelRatio()>1?t/2:t)},removeTips:function(){var t=this.menuPicker;_.each(t.dataViewItems,(function(t){var e=t.$el.data("bs.tooltip");e&&e.tip().remove()}),t)}})})),define("spreadsheeteditor/main/app/view/SlicerSettingsAdvanced",["text!spreadsheeteditor/main/app/template/SlicerSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/component/ComboDataView"],(function(t){"use strict";SSE.Views.SlicerSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:330,height:435,toggleGroup:"slicer-adv-settings-group",storageName:"sse-slicer-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-slicer-style",panelCaption:this.strStyleSize},{panelId:"id-adv-slicer-sorting",panelCaption:this.strSorting},{panelId:"id-adv-slicer-references",panelCaption:this.strReferences},{panelId:"id-adv-slicer-snap",panelCaption:this.textSnap},{panelId:"id-adv-slicer-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),this.options.handler=function(t,i){if("ok"==t&&!this.isNameValid())return!0;e.handler&&e.handler.call(this,t,i)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._changedProps=null,this._noApply=!0,this.spinners=[],this._nRatio=1,this._originalProps=this.options.imageProps},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.inputHeader=new Common.UI.InputField({el:$("#sliceradv-text-header"),allowBlank:!0,style:"width: 178px;"}).on("changed:after",(function(){t.isCaptionChanged=!0})),this.chHeader=new Common.UI.CheckBox({el:$("#sliceradv-checkbox-header"),labelText:this.strShowHeader}),this.chHeader.on("change",_.bind((function(t,e,i,n){this._changedProps&&this._changedProps.asc_setShowCaption("checked"==t.getValue())}),this)),this.btnSlicerStyle=new Common.UI.Button({parentEl:$("#sliceradv-btn-style"),cls:"btn-large-dataview sheet-template-slicer",iconCls:"icon-template-slicer",menu:new Common.UI.Menu({style:"width: 333px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="sliceradv-menu-style" class="menu-slicer-template"  style="margin: 5px 5px 5px 10px;"></div>')}]})}),this.mnuSlicerPicker=new Common.UI.DataView({el:$("#sliceradv-menu-style"),parentMenu:this.btnSlicerStyle.menu,restoreHeight:325,groups:new Common.UI.DataViewGroupStore,store:new Common.UI.DataViewStore,itemTemplate:_.template('<div id="<%= id %>" class="item"><img src="<%= imageUrl %>" height="49" width="36"></div>'),style:"max-height: 325px;"}),this.mnuSlicerPicker.on("item:click",_.bind(this.onSelectSlicerStyle,this,this.btnSlicerStyle)),this.numWidth=new Common.UI.MetricSpinner({el:$("#sliceradv-spin-width"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:5963.9,minValue:0}),this.numWidth.on("change",_.bind((function(t,e,i,n){if(this.btnRatio.pressed){var o=t.getNumberValue(),s=o/this._nRatio;s>this.numHeight.options.maxValue&&(o=(s=this.numHeight.options.maxValue)*this._nRatio,this.numWidth.setValue(o,!0)),this.numHeight.setValue(s,!0)}this._originalProps&&(this._originalProps.put_Width(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._originalProps.put_Height(Common.Utils.Metric.fnRecalcToMM(this.numHeight.getNumberValue())))}),this)),this.spinners.push(this.numWidth),this.numHeight=new Common.UI.MetricSpinner({el:$("#sliceradv-spin-height"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:5963.9,minValue:0}),this.numHeight.on("change",_.bind((function(t,e,i,n){var o=t.getNumberValue(),s=null;this.btnRatio.pressed&&((s=o*this._nRatio)>this.numWidth.options.maxValue&&(o=(s=this.numWidth.options.maxValue)/this._nRatio,this.numHeight.setValue(o,!0)),this.numWidth.setValue(s,!0)),this._originalProps&&(this._originalProps.put_Width(Common.Utils.Metric.fnRecalcToMM(this.numWidth.getNumberValue())),this._originalProps.put_Height(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.numHeight),this.btnRatio=new Common.UI.Button({parentEl:$("#sliceradv-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio}),this.btnRatio.on("click",_.bind((function(t,e){t.pressed&&this.numHeight.getNumberValue()>0&&(this._nRatio=this.numWidth.getNumberValue()/this.numHeight.getNumberValue()),this._originalProps&&this._originalProps.asc_putLockAspect(t.pressed)}),this)),this.numColHeight=new Common.UI.MetricSpinner({el:$("#sliceradv-spin-col-height"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:5963.9,minValue:0}),this.numColHeight.on("change",_.bind((function(t,e,i,n){var o=t.getNumberValue();this._changedProps&&this._changedProps.asc_setRowHeight(36e3*Common.Utils.Metric.fnRecalcToMM(o))}),this)),this.spinners.push(this.numColHeight),this.numCols=new Common.UI.MetricSpinner({el:$("#sliceradv-spin-columns"),step:1,width:85,defaultUnit:"",defaultValue:1,value:"1",allowDecimal:!1,maxValue:2e4,minValue:1}),this.numCols.on("change",_.bind((function(t,e,i,n){var o=t.getNumberValue();this._changedProps&&this._changedProps.asc_setColumnCount(o)}),this)),this.radioAsc=new Common.UI.RadioBox({el:$("#sliceradv-radio-asc"),name:"asc-radio-sliceradv-sort",labelText:this.textAsc,checked:!0}),this.radioAsc.on("change",_.bind((function(t,e,i){e&&this._changedProps&&this._changedProps.asc_setSortOrder(Asc.ST_tabularSlicerCacheSortOrder.Ascending)}),this)),this.radioDesc=new Common.UI.RadioBox({el:$("#sliceradv-radio-desc"),name:"asc-radio-sliceradv-sort",labelText:this.textDesc,checked:!1}),this.radioDesc.on("change",_.bind((function(t,e,i){e&&this._changedProps&&this._changedProps.asc_setSortOrder(Asc.ST_tabularSlicerCacheSortOrder.Descending)}),this)),this.chHideNoData=new Common.UI.CheckBox({el:$("#sliceradv-check-hide-nodata"),labelText:this.strHideNoData}),this.chHideNoData.on("change",_.bind((function(t,e,i,n){var o="checked"==t.getValue();this.chIndNoData.setDisabled(o),this.chShowNoData.setDisabled(o||"checked"!=this.chIndNoData.getValue()),this.chShowDel.setDisabled(o),this._changedProps&&this._changedProps.asc_setHideItemsWithNoData(o)}),this)),this.chIndNoData=new Common.UI.CheckBox({el:$("#sliceradv-check-indicate-nodata"),labelText:this.strIndNoData}),this.chIndNoData.on("change",_.bind((function(t,e,i,n){var o="checked"==t.getValue();this.chShowNoData.setDisabled(!o),this._changedProps&&this._changedProps.asc_setIndicateItemsWithNoData(o)}),this)),this.chShowNoData=new Common.UI.CheckBox({el:$("#sliceradv-check-show-nodata-last"),disabled:!0,labelText:this.strShowNoData}),this.chShowNoData.on("change",_.bind((function(t,e,i,n){this._changedProps&&this._changedProps.asc_setShowItemsWithNoDataLast("checked"==t.getValue())}),this)),this.chShowDel=new Common.UI.CheckBox({el:$("#sliceradv-check-show-deleted"),labelText:this.strShowDel}),this.chShowDel.on("change",_.bind((function(t,e,i,n){this._changedProps}),this)),this.inputName=new Common.UI.InputField({el:$("#sliceradv-text-name"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 178px;"}).on("changed:after",(function(){t.isNameChanged=!0})),this.lblSource=$("#sliceradv-lbl-source"),this.lblFormula=$("#sliceradv-lbl-formula"),this.radioTwoCell=new Common.UI.RadioBox({el:$("#slicer-advanced-radio-twocell"),name:"asc-radio-snap",labelText:this.textTwoCell,value:AscCommon.c_oAscCellAnchorType.cellanchorTwoCell}),this.radioTwoCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioOneCell=new Common.UI.RadioBox({el:$("#slicer-advanced-radio-onecell"),name:"asc-radio-snap",labelText:this.textOneCell,value:AscCommon.c_oAscCellAnchorType.cellanchorOneCell}),this.radioOneCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioAbsolute=new Common.UI.RadioBox({el:$("#slicer-advanced-radio-absolute"),name:"asc-radio-snap",labelText:this.textAbsolute,value:AscCommon.c_oAscCellAnchorType.cellanchorAbsolute}),this.radioAbsolute.on("change",_.bind(this.onRadioSnapChange,this)),this.inputAltTitle=new Common.UI.InputField({el:$("#sliceradv-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",(function(){t.isAltTitleChanged=!0})),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown((function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0})),this.afterRender()},getFocusedComponents:function(){return[this.inputHeader,this.chHeader,this.numWidth,this.numHeight,this.numCols,this.numColHeight,this.radioAsc,this.radioDesc,this.chHideNoData,this.chIndNoData,this.chShowNoData,this.inputName,this.radioTwoCell,this.radioOneCell,this.radioAbsolute,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 0:i.inputHeader.focus();break;case 1:i.chHideNoData.focus();break;case 2:i.inputName.focus();break;case 3:i.radioTwoCell.focus();break;case 4:i.inputAltTitle.focus()}}),10)},getSettings:function(){return this.isCaptionChanged&&this._changedProps.asc_setCaption(this.inputHeader.getValue()),this.isNameChanged&&this._changedProps.asc_setName(this.inputName.getValue()),this.isAltTitleChanged&&this._originalProps.asc_putTitle(this.inputAltTitle.getValue()),this.isAltDescChanged&&this._originalProps.asc_putDescription(this.textareaAltDescription.val()),{imageProps:this._originalProps}},_setDefaults:function(t){if(t){var e=t.asc_getWidth();switch(this.numWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2):"",!0),e=t.asc_getHeight(),this.numHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e).toFixed(2):"",!0),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),e=t.asc_getLockAspect(),this.btnRatio.toggle(e),e=t.asc_getTitle(),this.inputAltTitle.setValue(e||""),e=t.asc_getDescription(),this.textareaAltDescription.val(e||""),e=t.asc_getAnchor()){case AscCommon.c_oAscCellAnchorType.cellanchorTwoCell:this.radioTwoCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorOneCell:this.radioOneCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorAbsolute:this.radioAbsolute.setValue(!0,!0)}var i=t.asc_getSlicerProperties();if(i){this._noApply=!0,this.numCols.setValue(i.asc_getColumnCount(),!0),this.numColHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(i.asc_getRowHeight()/36e3).toFixed(2),!0),this.inputHeader.setValue(i.asc_getCaption(),!0);var n=i.asc_getShowCaption();this.chHeader.setValue(null!=n?n:"indeterminate",!0),this.radioAsc.setCaption(this.textAsc+" ("+this.textAZ+")"),this.radioDesc.setCaption(this.textDesc+" ("+this.textZA+")"),i.asc_getSortOrder()==Asc.ST_tabularSlicerCacheSortOrder.Ascending?this.radioAsc.setValue(!0,!0):this.radioDesc.setValue(!0,!0),n=i.asc_getIndicateItemsWithNoData(),this.chIndNoData.setValue(null!=n?n:"indeterminate",!0),n=i.asc_getShowItemsWithNoDataLast(),this.chShowNoData.setValue(null!=n?n:"indeterminate",!0),n=i.asc_getHideItemsWithNoData(),this.chHideNoData.setValue(null!=n?n:"indeterminate",!0),this.chIndNoData.setDisabled(n),this.chShowNoData.setDisabled(n||"checked"!=this.chIndNoData.getValue()),this.chShowDel.setDisabled(n),e=i.asc_getName(),this.inputName.setValue(null!=e?e:""),this.inputName.setDisabled(null==e),this.lblSource.text(i.asc_getSourceName()),this.lblFormula.text(i.asc_getNameInFormulas()),e=i.asc_getStyle();var o=this.mnuSlicerPicker.store.findWhere({type:e});!o&&this.mnuSlicerPicker.store.length>0&&(o=this.mnuSlicerPicker.store.at(0)),o?(this.btnSlicerStyle.suspendEvents(),this.mnuSlicerPicker.selectRecord(o,!0),this.btnSlicerStyle.resumeEvents(),this.$window.find(".icon-template-slicer").css({"background-image":"url("+o.get("imageUrl")+")",height:"49px",width:"36px","background-position":"center","background-size":"cover"})):this.$window.find(".icon-template-slicer").css({height:"49px",width:"36px","background-position":"center","background-size":"cover"}),this._noApply=!1,this._changedProps=i}}},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){this.spinners[t].setDefaultUnit(Common.Utils.Metric.getCurrentMetricName())}},afterRender:function(){if(this.updateMetricUnit(),this.onInitStyles(this.options.styles),this._setDefaults(this._originalProps),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},onInitStyles:function(t){var e=[];t&&_.each(t,(function(t){e.push({id:Common.UI.getId(),type:t.asc_getName(),imageUrl:t.asc_getImage(),allowSelected:!0,selected:!1})})),this.mnuSlicerPicker.store.reset(e),this.btnSlicerStyle.setDisabled(this.mnuSlicerPicker.store.length<1)},onSelectSlicerStyle:function(t,e,i,n){this._noApply||(this._changedProps&&this._changedProps.asc_setStyle(n.get("type")),this.$window.find(".icon-template-slicer").css({"background-image":"url("+n.get("imageUrl")+")",height:"49px",width:"36px","background-position":"center","background-size":"cover"}))},onRadioSnapChange:function(t,e,i){e&&this._originalProps&&this._originalProps.asc_putAnchor(t.options.value)},isNameValid:function(){return!this.isNameChanged||!_.isEmpty(this.inputName.getValue())||(this.setActiveCategory(2),this.inputName.cmpEl.find("input").focus(),!1)},textTitle:"Slicer - Advanced Settings",textHeader:"Header",strStyle:"Style",strSize:"Size",strWidth:"Width",strHeight:"Height",strButtons:"Buttons",strColumns:"Columns",textSort:"Sort",textSourceName:"Source name",textFormulaName:"Name to use in formulas",textName:"Name",strStyleSize:"Style & Size",strSorting:"Sorting & Filtering",strReferences:"References",txtEmpty:"This field is required",strShowHeader:"Display header",textAsc:"Ascending",textDesc:"Descending",textAZ:"A to Z",textZA:"Z to A",textOldNew:"oldest to newest",textNewOld:"newest to oldest",textSmallLarge:"smallest to largest",textLargeSmall:"largest to smallest",strHideNoData:"Hide items with no data",strIndNoData:"Visually indicate items with no data",strShowNoData:"Show items with no data last",strShowDel:"Show items deleted from the data source",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table.",textSnap:"Cell Snapping",textAbsolute:"Don't move or size with cells",textOneCell:"Move but don't size with cells",textTwoCell:"Move and size with cells",textKeepRatio:"Constant Proportions"},SSE.Views.SlicerSettingsAdvanced||{}))})),define("spreadsheeteditor/main/app/view/PivotGroupDialog",["common/main/lib/component/Window"],(function(){"use strict";SSE.Views.PivotGroupDialog=Common.UI.Window.extend(_.extend({options:{width:250,header:!0,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){var e=t.date?335:195;_.extend(this.options,{title:this.txtTitle},t||{}),this.template=t.template||['<div class="box" style="height:'+(e-85)+'px;">','<table cols="2" style="width: 100%;">',"<tr>",'<td colspan="2" style="padding-bottom: 4px;">','<label style="font-weight: bold;">'+this.textAuto+"</label>","</td>","</tr>","<tr>",'<td style="padding-right: 10px;padding-bottom: 8px;width: 100%;">','<div id="pivot-group-dlg-chk-start" style="margin-top: 2px;"></div>',"</td>",'<td style="padding-bottom: 8px;">','<div id="pivot-group-dlg-txt-start"></div>',"</td>","</tr>","<tr>",'<td style="padding-right: 10px;padding-bottom: 8px;width: 100%;">','<div id="pivot-group-dlg-chk-end" style="margin-top: 2px;"></div>',"</td>",'<td style="padding-bottom: 8px;">','<div id="pivot-group-dlg-txt-end"></div>',"</td>","</tr>",'<tr class="group-number">','<td style="padding-right: 10px;padding-bottom: 8px;width: 100%;">','<label style="margin-left:22px;margin-top:2px;">'+this.textBy+"</label>","</td>",'<td style="padding-bottom: 8px;">','<div id="pivot-group-dlg-txt-by"></div>',"</td>","</tr>",'<tr class="group-date">','<td colspan="2" style="padding-bottom: 4px;">','<label style="font-weight: bold;">'+this.textBy+"</label>","</td>","</tr>",'<tr class="group-date">','<td colspan="2" style="padding-bottom: 8px;">','<div id="pivot-group-dlg-list" style="height:116px;"></div>',"</td>","</tr>",'<tr class="group-date">','<td style="padding-right: 10px;width: 100%;">','<label style="margin-top:2px;">'+this.textNumDays+"</label>","</td>","<td>",'<div id="pivot-group-dlg-spn-days"></div>',"</td>","</tr>","</table>","</div>"].join(""),this.api=t.api,this.handler=t.handler,this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this));var t=this;this.chStart=new Common.UI.CheckBox({el:$("#pivot-group-dlg-chk-start",this.$window),labelText:this.textStart}),this.chStart.on("change",(function(e,i,n,o){"checked"==i&&t.defRangePr&&t.inputStart.setValue(t.defRangePr.start)})),this.chEnd=new Common.UI.CheckBox({el:$("#pivot-group-dlg-chk-end",this.$window),labelText:this.textEnd}),this.chEnd.on("change",(function(e,i,n,o){"checked"==i&&t.defRangePr&&t.inputEnd.setValue(t.defRangePr.end)})),this.inputStart=new Common.UI.InputField({el:$("#pivot-group-dlg-txt-start",this.$window),style:"width: 100px;",allowBlank:!0,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(e,i){t.chStart.setValue(!1,!0)})),this.inputEnd=new Common.UI.InputField({el:$("#pivot-group-dlg-txt-end",this.$window),style:"width: 100px;",allowBlank:!0,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(e,i){t.chEnd.setValue(!1,!0)})),this.inputBy=new Common.UI.InputField({el:$("#pivot-group-dlg-txt-by",this.$window),style:"width: 100px;",allowBlank:!0,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(t,e){e.length})),this.spnDays=new Common.UI.MetricSpinner({el:$("#pivot-group-dlg-spn-days",this.$window),step:1,width:100,defaultUnit:"",value:"1",maxValue:32767,minValue:1}),this.spnDays.on("change",_.bind((function(t,e,i,n){}),this));var e=[{value:this.textSec,type:Asc.c_oAscGroupBy.Seconds},{value:this.textMin,type:Asc.c_oAscGroupBy.Minutes},{value:this.textHour,type:Asc.c_oAscGroupBy.Hours},{value:this.textDays,type:Asc.c_oAscGroupBy.Days},{value:this.textMonth,type:Asc.c_oAscGroupBy.Months},{value:this.textQuart,type:Asc.c_oAscGroupBy.Quarters},{value:this.textYear,type:Asc.c_oAscGroupBy.Years}];this.listDate=new Common.UI.ListView({el:$("#pivot-group-dlg-list",this.$window),store:new Common.UI.DataViewStore(e),multiSelect:!0,tabindex:1,itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="pointer-events:none;"><%= value %></div>')}),this.listDate.on("item:select",_.bind(this.onSelectDate,this)),this.listDate.on("item:deselect",_.bind(this.onSelectDate,this)),this.listDate.on("entervalue",_.bind(this.onPrimary,this)),this.btnOk=new Common.UI.Button({el:$(".dlg-btn.primary",this.$window)})},getFocusedComponents:function(){return[this.chStart,this.inputStart,this.chEnd,this.inputEnd,this.inputBy,this.listDate,this.spnDays]},getDefaultFocusableComponent:function(){return this.inputStart},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onSelectDate:function(t,e,i){if(i&&!(i.length<1)){i.get("type")==Asc.c_oAscGroupBy.Days&&(this.isDays=i.get("selected"));var n=this.listDate.getSelectedRec().length;this.spnDays.setDisabled(!this.isDays||n>1),this.btnOk.setDisabled(n<1)}},setSettings:function(t,e,i){if(this.$window.find(".group-number").toggleClass("hidden",!!e),this.$window.find(".group-date").toggleClass("hidden",!e),t){this.chStart.setValue(t.asc_getAutoStart(),!0),this.chEnd.setValue(t.asc_getAutoEnd(),!0);var n=e?t.asc_getStartDateText():t.asc_getStartNum();this.inputStart.setValue(null!=n?n:""),n=e?t.asc_getEndDateText():t.asc_getEndNum(),this.inputEnd.setValue(null!=n?n:""),!e&&this.inputBy.setValue(t.asc_getGroupInterval()),this.rangePr=t,i&&(this.defRangePr={start:e?i.asc_getStartDateText():i.asc_getStartNum(),end:e?i.asc_getEndDateText():i.asc_getEndNum()})}if(e){var o,s=this;_.each(e,(function(t){var e=s.listDate.store.findWhere({type:t});e&&s.listDate.selectRecord(e),t==Asc.c_oAscGroupBy.Days&&(o=!0)})),this.spnDays.setValue(t.asc_getGroupInterval()),this.spnDays.setDisabled(!o||e.length>1),this.btnOk.setDisabled(e.length<1),this.dateTypes=e,this.isDays=o}},getSettings:function(){return this.rangePr&&(this.rangePr.asc_setAutoStart("checked"==this.chStart.getValue()),this.rangePr.asc_setAutoEnd("checked"==this.chEnd.getValue()),this.dateTypes?(this.dateTypes=this.listDate.getSelectedRec().map((function(t){return t.get("type")})),this.rangePr.asc_setGroupInterval(this.spnDays.getNumberValue()),this.rangePr.asc_setStartDateText(this.inputStart.getValue()),this.rangePr.asc_setEndDateText(this.inputEnd.getValue())):(this.rangePr.asc_setStartNum(parseFloat(this.inputStart.getValue().toString().replace(",","."))),this.rangePr.asc_setEndNum(parseFloat(this.inputEnd.getValue().toString().replace(",","."))),this.rangePr.asc_setGroupInterval(parseFloat(this.inputBy.getValue().toString().replace(",","."))))),[this.rangePr,this.dateTypes]},isRangeValid:function(){if(this.dateTypes){if(this.rangePr){this.rangePr.asc_setStartDateText(this.inputStart.getValue());var t=this.rangePr.asc_getStartDate();if(isNaN(t))return this.inputStart.showError([this.textError]),this.inputStart.focus(),!1;this.rangePr.asc_setEndDateText(this.inputEnd.getValue());var e=this.rangePr.asc_getEndDate();if(isNaN(e))return this.inputEnd.showError([this.textError]),this.inputEnd.focus(),!1;if(e<t)return Common.UI.warning({msg:this.textGreaterError,maxwidth:600}),this.inputEnd.focus(),!1}}else{var i=new RegExp("^s*[-]?[0-9]+[,.]?[0-9]*s*$");t=this.inputStart.getValue().toString();if(!i.test(t))return this.inputStart.showError([this.textError]),this.inputStart.focus(),!1;e=this.inputEnd.getValue().toString();if(!i.test(e))return this.inputEnd.showError([this.textError]),this.inputEnd.focus(),!1;if(parseFloat(e.replace(",","."))<parseFloat(t.replace(",",".")))return Common.UI.warning({msg:this.textGreaterError,maxwidth:600}),this.inputEnd.focus(),!1;if(!i.test(this.inputBy.getValue().toString()))return this.inputBy.showError([this.textError]),this.inputBy.focus(),!1}return!0},onPrimary:function(t,e,i){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.options.handler){if("ok"==t&&(this.btnOk.isDisabled()||!this.isRangeValid()))return;this.options.handler.call(this,this,t)}this.close()},txtTitle:"Grouping",textAuto:"Auto",textBy:"By",textStart:"Starting at",textEnd:"Ending at",textNumDays:"Number of days",textSec:"Seconds",textMin:"Minutes",textHour:"Hours",textDays:"Days",textMonth:"Months",textQuart:"Quarters",textYear:"Years",textError:"This field must be a numeric value",textGreaterError:"The end number must be greater than the start number"},SSE.Views.PivotGroupDialog||{}))})),define("spreadsheeteditor/main/app/view/MacroDialog",["common/main/lib/util/utils","common/main/lib/component/ListView","common/main/lib/component/InputField","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.MacroDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:250,height:312},initialize:function(t){_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 5px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-extra-small">','<label class="input-label">',this.textMacro,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="macro-dlg-txt-name"></div>',"</td>","</tr>","<tr>","<td>",'<div id="macro-dlg-list" style="width:100%; height: 169px;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.handler=t.handler,this.props=t.props,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.txtName=new Common.UI.InputField({el:$("#macro-dlg-txt-name"),allowBlank:!0,validateOnChange:!0,validateOnBlur:!0,style:"width: 100%;",value:"",maxLength:40,validation:function(t){return!0}}).on("changing",(function(e,i){t.findMacro(i)})),this.macroList=new Common.UI.ListView({el:$("#macro-dlg-list",this.$window),store:new Common.UI.DataViewStore,tabindex:1,cls:"dbl-clickable",itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="overflow: hidden; text-overflow: ellipsis;"><%= value %></div>')}),this.macroList.on("item:dblclick",_.bind(this.onDblClickMacro,this)),this.macroList.on("entervalue",_.bind(this.onPrimary,this)),this.macroList.on("item:select",_.bind(this.onSelectMacro,this)),this.afterRender()},getFocusedComponents:function(){return[this.txtName,this.macroList]},getDefaultFocusableComponent:function(){return this.txtName},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){this.props=t,this.refreshList()},getSettings:function(){return this.txtName.getValue()},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onPrimary:function(){return this.handler&&this.handler.call(this,"ok",this.getSettings()),this.close(),!1},refreshList:function(){if(this.props&&this.props.macroList){for(var t=this.props.macroList,e=[],i=0;i<t.length;i++)e.push({value:t[i]});this.macroList.store.reset(e),this.props.current&&(this.txtName.setValue(this.props.current),this.findMacro(this.props.current))}},onSelectMacro:function(t,e,i){i&&this.txtName.setValue(i.get("value"))},onDblClickMacro:function(t,e,i){this.handler&&this.handler.call(this,"ok",this.getSettings()),this.close()},findMacro:function(t){var e=this.macroList.store.findWhere({value:t});e?(this.macroList.selectRecord(e),this.macroList.scrollToRecord(e)):this.macroList.deselectAll()},textTitle:"Assign Macro",textMacro:"Macro name"},SSE.Views.MacroDialog||{}))}));var c_paragraphLinerule={LINERULE_AUTO:1,LINERULE_EXACT:2},c_paragraphTextAlignment={RIGHT:0,LEFT:1,CENTERED:2,JUSTIFIED:3},c_paragraphSpecial={NONE_SPECIAL:0,FIRST_LINE:1,HANGING:2};if(define("spreadsheeteditor/main/app/controller/DocumentHolder",["core","common/main/lib/util/utils","common/main/lib/util/Shortcuts","common/main/lib/view/CopyWarningDialog","common/main/lib/view/OpenDialog","common/main/lib/view/ListSettingsDialog","spreadsheeteditor/main/app/view/DocumentHolder","spreadsheeteditor/main/app/view/HyperlinkSettingsDialog","spreadsheeteditor/main/app/view/ParagraphSettingsAdvanced","spreadsheeteditor/main/app/view/ImageSettingsAdvanced","spreadsheeteditor/main/app/view/SetValueDialog","spreadsheeteditor/main/app/view/AutoFilterDialog","spreadsheeteditor/main/app/view/SpecialPasteDialog","spreadsheeteditor/main/app/view/SlicerSettingsAdvanced","spreadsheeteditor/main/app/view/PivotGroupDialog","spreadsheeteditor/main/app/view/MacroDialog"],(function(){"use strict";SSE.Controllers.DocumentHolder=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["DocumentHolder"],initialize:function(){var t=this;t.tooltips={hyperlink:{},comment:{},coauth:{ttHeight:20},row_column:{ttHeight:20},slicer:{ttHeight:20},filter:{ttHeight:40},func_arg:{},input_msg:{},foreignSelect:{ttHeight:20}},t.mouse={},t.popupmenu=!1,t.rangeSelectionMode=!1,t.namedrange_locked=!1,t._currentMathObj=void 0,t._currentParaObjDisabled=!1,t._isDisabled=!1,t._state={wsLock:!1,wsProps:[]},t.fastcoauthtips=[],t._TtHeight=20,this.wrapEvents={apiHideComment:_.bind(this.onApiHideComment,this),onKeyUp:_.bind(this.onKeyUp,this)},this.addListeners({DocumentHolder:{createdelayedelements:this.onCreateDelayedElements}});var e={};this.hkComments="alt+h",e[this.hkComments]=function(){return t.onAddComment(),!1},Common.util.Shortcuts.delegateShortcuts({shortcuts:e})},onLaunch:function(){var t=this;t.documentHolder=this.createView("DocumentHolder"),t.documentHolder.render(),t.documentHolder.el.tabIndex=-1,$(document).on("mousedown",_.bind(t.onDocumentRightDown,t)),$(document).on("mouseup",_.bind(t.onDocumentRightUp,t)),$(document).on("keydown",_.bind(t.onDocumentKeyDown,t)),$(document).on("mousemove",_.bind(t.onDocumentMouseMove,t)),$(window).on("resize",_.bind(t.onDocumentResize,t)),SSE.getController("Viewport").getView("Viewport").hlayout.on("layout:resizedrag",_.bind(t.onDocumentResize,t)),Common.NotificationCenter.on({"window:show":function(e){t.hideHyperlinkTip(),t.permissions&&t.permissions.isDesktopApp&&t.api&&t.api.asc_onShowPopupWindow()},"modal:show":function(e){t.hideCoAuthTips(),t.hideForeignSelectTips()},"layout:changed":function(e){t.hideHyperlinkTip(),t.hideCoAuthTips(),t.hideForeignSelectTips(),t.onDocumentResize(),t.api&&!t.tooltips.input_msg.isHidden&&t.tooltips.input_msg.text&&t.changeInputMessagePosition(t.tooltips.input_msg)},"cells:range":function(e){t.onCellsRange(e)},"tabs:dragend":_.bind(t.onDragEndMouseUp,t),"protect:wslock":_.bind(t.onChangeProtectSheet,t)}),Common.Gateway.on("processmouse",_.bind(t.onProcessMouse,t)),Common.Gateway.on("setactionlink",_.bind(t.onSetActionLink,t))},onCreateDelayedElements:function(t){var e=this;if(e.permissions.isEdit&&!e._isDisabled){if(t.pmiCut.on("click",_.bind(e.onCopyPaste,e)),t.pmiCopy.on("click",_.bind(e.onCopyPaste,e)),t.pmiPaste.on("click",_.bind(e.onCopyPaste,e)),t.pmiImgCut.on("click",_.bind(e.onCopyPaste,e)),t.pmiImgCopy.on("click",_.bind(e.onCopyPaste,e)),t.pmiImgPaste.on("click",_.bind(e.onCopyPaste,e)),t.pmiTextCut.on("click",_.bind(e.onCopyPaste,e)),t.pmiTextCopy.on("click",_.bind(e.onCopyPaste,e)),t.pmiTextPaste.on("click",_.bind(e.onCopyPaste,e)),t.pmiCommonCut.on("click",_.bind(e.onCopyPaste,e)),t.pmiCommonCopy.on("click",_.bind(e.onCopyPaste,e)),t.pmiCommonPaste.on("click",_.bind(e.onCopyPaste,e)),t.pmiInsertEntire.on("click",_.bind(e.onInsertEntire,e)),t.pmiDeleteEntire.on("click",_.bind(e.onDeleteEntire,e)),t.pmiInsertCells.menu.on("item:click",_.bind(e.onInsertCells,e)),t.pmiDeleteCells.menu.on("item:click",_.bind(e.onDeleteCells,e)),t.pmiSparklines.menu.on("item:click",_.bind(e.onClear,e)),t.pmiSortCells.menu.on("item:click",_.bind(e.onSortCells,e)),t.pmiFilterCells.menu.on("item:click",_.bind(e.onFilterCells,e)),t.pmiReapply.on("click",_.bind(e.onReapply,e)),t.pmiCondFormat.on("click",_.bind(e.onCondFormat,e)),t.mnuGroupPivot.on("click",_.bind(e.onGroupPivot,e)),t.mnuUnGroupPivot.on("click",_.bind(e.onGroupPivot,e)),t.pmiClear.menu.on("item:click",_.bind(e.onClear,e)),t.pmiSelectTable.menu.on("item:click",_.bind(e.onSelectTable,e)),t.pmiInsertTable.menu.on("item:click",_.bind(e.onInsertTable,e)),t.pmiDeleteTable.menu.on("item:click",_.bind(e.onDeleteTable,e)),t.pmiInsFunction.on("click",_.bind(e.onInsFunction,e)),t.menuAddHyperlink.on("click",_.bind(e.onInsHyperlink,e)),t.menuEditHyperlink.on("click",_.bind(e.onInsHyperlink,e)),t.menuRemoveHyperlink.on("click",_.bind(e.onDelHyperlink,e)),t.pmiRowHeight.menu.on("item:click",_.bind(e.onSetSize,e)),t.pmiColumnWidth.menu.on("item:click",_.bind(e.onSetSize,e)),t.pmiEntireHide.on("click",_.bind(e.onEntireHide,e)),t.pmiEntireShow.on("click",_.bind(e.onEntireShow,e)),t.pmiFreezePanes.on("click",_.bind(e.onFreezePanes,e)),t.pmiEntriesList.on("click",_.bind(e.onEntriesList,e)),t.pmiAddComment.on("click",_.bind(e.onAddComment,e)),t.pmiAddNamedRange.on("click",_.bind(e.onAddNamedRange,e)),t.menuImageArrange.menu.on("item:click",_.bind(e.onImgMenu,e)),t.menuImgRotate.menu.on("item:click",_.bind(e.onImgMenu,e)),t.menuImgCrop.menu.on("item:click",_.bind(e.onImgCrop,e)),t.menuImageAlign.menu.on("item:click",_.bind(e.onImgMenuAlign,e)),t.menuParagraphVAlign.menu.on("item:click",_.bind(e.onParagraphVAlign,e)),t.menuParagraphDirection.menu.on("item:click",_.bind(e.onParagraphDirection,e)),t.menuParagraphBullets.menu.on("item:click",_.bind(e.onSelectBulletMenu,e)),t.menuParagraphBullets.menu.on("show:after",_.bind(e.onBulletMenuShowAfter,e)),t.menuAddHyperlinkShape.on("click",_.bind(e.onInsHyperlink,e)),t.menuEditHyperlinkShape.on("click",_.bind(e.onInsHyperlink,e)),t.menuRemoveHyperlinkShape.on("click",_.bind(e.onDelHyperlink,e)),t.pmiTextAdvanced.on("click",_.bind(e.onTextAdvanced,e)),t.mnuShapeAdvanced.on("click",_.bind(e.onShapeAdvanced,e)),t.mnuChartEdit.on("click",_.bind(e.onChartEdit,e)),t.mnuChartData.on("click",_.bind(e.onChartData,e)),t.mnuChartType.on("click",_.bind(e.onChartType,e)),t.mnuImgAdvanced.on("click",_.bind(e.onImgAdvanced,e)),t.mnuSlicerAdvanced.on("click",_.bind(e.onSlicerAdvanced,e)),t.textInShapeMenu.on("render:after",_.bind(e.onTextInShapeAfterRender,e)),t.menuSignatureEditSign.on("click",_.bind(e.onSignatureClick,e)),t.menuSignatureEditSetup.on("click",_.bind(e.onSignatureClick,e)),t.menuImgOriginalSize.on("click",_.bind(e.onOriginalSizeClick,e)),t.menuImgReplace.menu.on("item:click",_.bind(e.onImgReplace,e)),t.pmiNumFormat.menu.on("item:click",_.bind(e.onNumberFormatSelect,e)),t.pmiNumFormat.menu.on("show:after",_.bind(e.onNumberFormatOpenAfter,e)),t.pmiAdvancedNumFormat.on("click",_.bind(e.onCustomNumberFormat,e)),t.tableTotalMenu.on("item:click",_.bind(e.onTotalMenuClick,e)),t.menuImgMacro.on("click",_.bind(e.onImgMacro,e)),t.menuImgEditPoints.on("click",_.bind(e.onImgEditPoints,e)),t.pmiGetRangeList.on("click",_.bind(e.onGetLink,e)),!e.permissions.isEditMailMerge&&!e.permissions.isEditDiagram&&!e.permissions.isEditOle){var i=e.getApplication().getController("Common.Controllers.ExternalOleEditor").getView("Common.Views.ExternalOleEditor");i&&(i.on("internalmessage",_.bind((function(t,n){n.data.command;var o=n.data.data;e.api&&i.isEditMode()&&e.api.asc_editTableOleObject(o)}),e)),i.on("hide",_.bind((function(i,n){e.api&&(e.api.asc_enableKeyEvents(!0),e.api.asc_onCloseChartFrame()),setTimeout((function(){t.fireEvent("editcomplete",t)}),10)}),e)))}}else t.menuViewCopy.on("click",_.bind(e.onCopyPaste,e)),t.menuViewUndo.on("click",_.bind(e.onUndo,e)),t.menuViewAddComment.on("click",_.bind(e.onAddComment,e)),t.menuSignatureViewSign.on("click",_.bind(e.onSignatureClick,e)),t.menuSignatureDetails.on("click",_.bind(e.onSignatureClick,e)),t.menuSignatureViewSetup.on("click",_.bind(e.onSignatureClick,e)),t.menuSignatureRemove.on("click",_.bind(e.onSignatureClick,e));var n=function(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent("on"+e,i)},o=t.cmpEl;if(o){o.on({mousedown:function(t){"canvas"==t.target.localName&&2!=t.button&&Common.UI.Menu.Manager.hideAll()},click:function(t){e.api&&(e.api.isTextAreaBlur=!1,"canvas"!=t.target.localName||e.isEditFormula&&!e.rangeSelectionMode||(e._preventClick?e._preventClick=!1:o.focus()))}});var s=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";n(t.el,s,_.bind(this.onDocumentWheel,this),!1),e.cellEditor=$("#ce-cell-content")}Common.Utils.isChrome?n(document,"mousewheel",_.bind(this.onDocumentWheel,this),{passive:!1}):$(document).on("mousewheel",_.bind(this.onDocumentWheel,this)),this.onChangeProtectSheet()},loadConfig:function(t){this.editorConfig=t.config},setMode:function(t){this.permissions=t,this.permissions.canCoAuthoring&&this.permissions.canComments?Common.util.Shortcuts.resumeEvents(this.hkComments):Common.util.Shortcuts.suspendEvents(this.hkComments)},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onContextMenu",_.bind(this.onApiContextMenu,this)),this.api.asc_registerCallback("asc_onMouseMove",_.bind(this.onApiMouseMove,this)),this.api.asc_registerCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_registerCallback("asc_onHyperlinkClick",_.bind(this.onApiHyperlinkClick,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),!0===this.permissions.isEdit&&(this.api.asc_registerCallback("asc_onSetAFDialog",_.bind(this.onApiAutofilter,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onLockDefNameManager",_.bind(this.onLockDefNameManager,this)),this.api.asc_registerCallback("asc_onEntriesListMenu",_.bind(this.onEntriesListMenu,this,!1)),this.api.asc_registerCallback("asc_onValidationListMenu",_.bind(this.onEntriesListMenu,this,!0)),this.api.asc_registerCallback("asc_onFormulaCompleteMenu",_.bind(this.onFormulaCompleteMenu,this)),this.api.asc_registerCallback("asc_onShowSpecialPasteOptions",_.bind(this.onShowSpecialPasteOptions,this)),this.api.asc_registerCallback("asc_onHideSpecialPasteOptions",_.bind(this.onHideSpecialPasteOptions,this)),this.api.asc_registerCallback("asc_onToggleAutoCorrectOptions",_.bind(this.onToggleAutoCorrectOptions,this)),this.api.asc_registerCallback("asc_onFormulaInfo",_.bind(this.onFormulaInfo,this)),this.api.asc_registerCallback("asc_ChangeCropState",_.bind(this.onChangeCropState,this)),this.api.asc_registerCallback("asc_onInputMessage",_.bind(this.onInputMessage,this)),this.api.asc_registerCallback("asc_onTableTotalMenu",_.bind(this.onTableTotalMenu,this)),this.api.asc_registerCallback("asc_onShowPivotGroupDialog",_.bind(this.onShowPivotGroupDialog,this)),this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle||this.api.asc_registerCallback("asc_doubleClickOnTableOleObject",_.bind(this.onDoubleClickOnTableOleObject,this))),this.api.asc_registerCallback("asc_onShowForeignCursorLabel",_.bind(this.onShowForeignCursorLabel,this)),this.api.asc_registerCallback("asc_onHideForeignCursorLabel",_.bind(this.onHideForeignCursorLabel,this)),this},resetApi:function(t){this.api.asc_unregisterCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_registerCallback("asc_onHideComment",this.wrapEvents.apiHideComment)},onCopyPaste:function(t){var e=this;if(e.api)if("cut"==t.value?e.api.asc_Cut():"copy"==t.value?e.api.asc_Copy():e.api.asc_Paste())Common.component.Analytics.trackEvent("ToolBar","Copy Warning");else{var i=Common.localStorage.getItem("sse-hide-copywarning");i&&1==parseInt(i)||new Common.Views.CopyWarningDialog({handler:function(t){t&&Common.localStorage.setItem("sse-hide-copywarning",1),Common.NotificationCenter.trigger("edit:complete",e.documentHolder)}}).show()}Common.NotificationCenter.trigger("edit:complete",e.documentHolder)},onInsertEntire:function(t){if(this.api){switch(this.api.asc_getCellInfo().asc_getSelectionType()){case Asc.c_oAscSelectionType.RangeRow:this.api.asc_insertCells(Asc.c_oAscInsertOptions.InsertRows);break;case Asc.c_oAscSelectionType.RangeCol:this.api.asc_insertCells(Asc.c_oAscInsertOptions.InsertColumns)}Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Insert Entire")}},onInsertCells:function(t,e){this.api&&(this.api.asc_insertCells(e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Insert Cells"))},onDeleteEntire:function(t){if(this.api){switch(this.api.asc_getCellInfo().asc_getSelectionType()){case Asc.c_oAscSelectionType.RangeRow:this.api.asc_deleteCells(Asc.c_oAscDeleteOptions.DeleteRows);break;case Asc.c_oAscSelectionType.RangeCol:this.api.asc_deleteCells(Asc.c_oAscDeleteOptions.DeleteColumns)}Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Delete Entire")}},onDeleteCells:function(t,e){this.api&&(this.api.asc_deleteCells(e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Delete Cells"))},onSortCells:function(t,e){Common.NotificationCenter.trigger("protect:check",this.onSortCellsCallback,this,[t,e])},onSortCellsCallback:function(t,e){if("advanced"!=e.value){if(this.api){var i=this.api.asc_sortCellsRangeExpand();switch(i){case Asc.c_oAscSelectionSortExpand.showExpandMessage:var n={width:500,title:this.txtSorting,msg:this.txtExpandSort,buttons:[{caption:this.txtExpand,primary:!0,value:"expand"},{caption:this.txtSortSelected,primary:!0,value:"sort"},"cancel"],callback:_.bind((function(t){"expand"!=t&&"sort"!=t||this.api.asc_sortColFilter(e.value,"",void 0,e.value==Asc.c_oAscSortOptions.ByColorFill?this.documentHolder.ssMenu.cellColor:this.documentHolder.ssMenu.fontColor,"expand"==t),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Sort Cells")}),this)};Common.UI.alert(n);break;case Asc.c_oAscSelectionSortExpand.showLockMessage:n={width:500,title:this.txtSorting,msg:this.txtLockSort,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t){"yes"==t&&this.api.asc_sortColFilter(e.value,"",void 0,e.value==Asc.c_oAscSortOptions.ByColorFill?this.documentHolder.ssMenu.cellColor:this.documentHolder.ssMenu.fontColor,!1),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Sort Cells")}),this)};Common.UI.alert(n);break;case Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage:case Asc.c_oAscSelectionSortExpand.notExpandAndNotShowMessage:this.api.asc_sortColFilter(e.value,"",void 0,e.value==Asc.c_oAscSortOptions.ByColorFill?this.documentHolder.ssMenu.cellColor:this.documentHolder.ssMenu.fontColor,i===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Sort Cells")}}}else Common.NotificationCenter.trigger("data:sortcustom",this)},onFilterCells:function(t,e){if(this.api){var i=new Asc.AutoFiltersOptions,n=new Asc.AutoFilterObj;if(e.value>0){n.asc_setFilter(new Asc.ColorFilter),n.asc_setType(Asc.c_oAscAutoFilterTypes.ColorFilter);var o=n.asc_getFilter();o.asc_setCellColor(1==e.value&&null),o.asc_setCColor(1==e.value?this.documentHolder.ssMenu.cellColor:this.documentHolder.ssMenu.fontColor)}else{n.asc_setFilter(new Asc.CustomFilters),n.asc_setType(Asc.c_oAscAutoFilterTypes.CustomFilters);var s=n.asc_getFilter();s.asc_setCustomFilters([new Asc.CustomFilter]),s.asc_setAnd(!0),s.asc_getCustomFilters()[0].asc_setOperator(Asc.c_oAscCustomAutoFilter.equals)}i.asc_setFilterObj(n),this.api.asc_applyAutoFilterByType(i),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Filter Cells")}},onReapply:function(){this.api.asc_reapplyAutoFilter(this.documentHolder.ssMenu.formatTableName)},onCondFormat:function(){var t=this,e=t.api.asc_getLocale();!e&&(e=t.permissions.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(t.permissions.lang)):1033),new SSE.Views.FormatRulesEditDlg({api:t.api,props:null,isEdit:!1,langId:e,handler:function(e,i){"ok"==e&&i&&t.api.asc_setCF([i],[])}}).show()},onGroupPivot:function(t){"grouping"==t.value?this.api.asc_groupPivot():this.api.asc_ungroupPivot()},onShowPivotGroupDialog:function(t,e,i){var n,o,s=this;(n=new SSE.Views.PivotGroupDialog({date:!!e,handler:function(t,e){"ok"==e&&(o=t.getSettings(),s.api.asc_groupPivot(o[0],o[1]),Common.NotificationCenter.trigger("edit:complete",s.documentHolder))}})).show(),n.setSettings(t,e,i)},onClear:function(t,e,i){e.value==Asc.c_oAscCleanOptions.Format&&!this._state.wsProps.FormatCells||e.value==Asc.c_oAscCleanOptions.All&&!this.api.asc_checkLockedCells()?this.onClearCallback(t,e):e.value==Asc.c_oAscCleanOptions.Comments?this._state.wsProps.Objects?Common.NotificationCenter.trigger("showerror",Asc.c_oAscError.ID.ChangeOnProtectedSheet,Asc.c_oAscError.Level.NoCritical):this.onClearCallback(t,e):Common.NotificationCenter.trigger("protect:check",this.onClearCallback,this,[t,e])},onClearCallback:function(t,e){this.api&&(e.value==Asc.c_oAscCleanOptions.Comments?this.api.asc_RemoveAllComments(!this.permissions.canDeleteComments,!0):this.api.asc_emptyCells(e.value,e.value==Asc.c_oAscCleanOptions.All&&!this.permissions.canDeleteComments),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Clear"))},onSelectTable:function(t,e){this.api&&this.documentHolder.ssMenu.formatTableName&&(this.api.asc_changeSelectionFormatTable(this.documentHolder.ssMenu.formatTableName,e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Select Table"))},onInsertTable:function(t,e){this.api&&this.documentHolder.ssMenu.formatTableName&&(this.api.asc_insertCellsInTable(this.documentHolder.ssMenu.formatTableName,e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Insert to Table"))},onDeleteTable:function(t,e){this.api&&this.documentHolder.ssMenu.formatTableName&&(this.api.asc_deleteCellsInTable(this.documentHolder.ssMenu.formatTableName,e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Delete from Table"))},onInsFunction:function(t){var e=this.getApplication().getController("FormulaDialog");e&&this.api&&e.showDialog(void 0,t.value==Asc.ETotalsRowFunction.totalrowfunctionCustom)},onInsHyperlink:function(t){Common.NotificationCenter.trigger("protect:check",this.onInsHyperlinkCallback,this,[t])},onInsHyperlinkCallback:function(t){var e,i,n=this;if(n.api){for(var o=n.api.asc_getWorksheetsCount(),s=-1,a=[];++s<o;)a.push({name:n.api.asc_getWorksheetName(s),hidden:n.api.asc_isWorksheetHidden(s)});var l=n.api.asc_getCellInfo();i=l.asc_getHyperlink(),(e=new SSE.Views.HyperlinkSettingsDialog({api:n.api,appOptions:n.permissions,handler:function(t,e){"ok"==e&&(i=t.getSettings(),n.api.asc_insertHyperlink(i)),Common.NotificationCenter.trigger("edit:complete",n.documentHolder)}})).show(),e.setSettings({sheets:a,ranges:n.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All,!0),currentSheet:n.api.asc_getWorksheetName(n.api.asc_getActiveWorksheetIndex()),props:i,text:l.asc_getText(),isLock:l.asc_getLockText(),allowInternal:t.options.inCell})}Common.component.Analytics.trackEvent("DocumentHolder","Add Hyperlink")},onDelHyperlink:function(t){Common.NotificationCenter.trigger("protect:check",this.onDelHyperlinkCallback,this)},onDelHyperlinkCallback:function(t){this.api&&(this.api.asc_removeHyperlink(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Remove Hyperlink"))},onSetSize:function(t,e){if("row-height"==e.value||"column-width"==e.value){var i=this;new SSE.Views.SetValueDialog({title:e.caption,startvalue:"row-height"==e.value?i.api.asc_getRowHeight():i.api.asc_getColumnWidth(),maxvalue:"row-height"==e.value?Asc.c_oAscMaxRowHeight:Asc.c_oAscMaxColumnWidth,step:"row-height"==e.value?.75:1,rounding:"row-height"==e.value,defaultUnit:"row-height"==e.value?Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt):i.textSym,handler:function(t,n){if("ok"==n){var o=t.getSettings();isNaN(o)||("row-height"==e.value?i.api.asc_setRowHeight(o):i.api.asc_setColumnWidth(o))}Common.NotificationCenter.trigger("edit:complete",i.documentHolder)}}).show()}else"auto-row-height"==e.value?this.api.asc_autoFitRowHeight():this.api.asc_autoFitColumnWidth(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder)},onEntireHide:function(t){this.api&&this.api[t.isrowmenu?"asc_hideRows":"asc_hideColumns"]()},onEntireShow:function(t){this.api&&this.api[t.isrowmenu?"asc_showRows":"asc_showColumns"]()},onFreezePanes:function(t){this.api&&this.api.asc_freezePane()},onEntriesList:function(t){if(this.api){var e=this;setTimeout((function(){e.api.asc_showAutoComplete()}),10)}},onAddComment:function(t){if(!this._state.wsProps.Objects&&this.api&&this.permissions.canCoAuthoring&&this.permissions.canComments){var e=SSE.getController("Common.Controllers.Comments"),i=this.api.asc_getCellInfo();if(e){var n=i.asc_getComments();n&&(n.length?e.onEditComments(n):this.permissions.canCoAuthoring&&e.addDummyComment())}}},onAddNamedRange:function(t){if(this.namedrange_locked)Common.NotificationCenter.trigger("namedrange:locked");else{for(var e=this,i=e.api.asc_getWorksheetsCount(),n=-1,o=[];++n<i;)this.api.asc_isWorksheetHidden(n)||o.push({displayValue:e.api.asc_getWorksheetName(n),value:n});new SSE.Views.NamedRangeEditDlg({api:e.api,handler:function(t,i){"ok"==t&&i&&(e.api.asc_setDefinedNames(i),Common.component.Analytics.trackEvent("DocumentHolder","New Named Range")),Common.NotificationCenter.trigger("edit:complete",e.documentHolder)},sheets:o,currentSheet:e.api.asc_getActiveWorksheetIndex(),props:e.api.asc_getDefaultDefinedName(),isEdit:!1}).show()}},onImgMenu:function(t,e){if(this.api)if("arrange"==e.options.type)this.api.asc_setSelectedDrawingObjectLayer(e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Arrange");else if("group"==e.options.type)this.api["grouping"==e.value?"asc_groupGraphicsObjects":"asc_unGroupGraphicsObjects"](),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","grouping"==e.value?"Grouping":"Ungrouping");else if("rotate"==e.options.type){(i=new Asc.asc_CImgProperty).asc_putRotAdd(3.14159265358979*(1==e.value?90:270)/180),this.api.asc_setGraphicObjectProps(i),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Rotate")}else if("flip"==e.options.type){var i=new Asc.asc_CImgProperty;1==e.value?i.asc_putFlipHInvert(!0):i.asc_putFlipVInvert(!0),this.api.asc_setGraphicObjectProps(i),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Flip")}},onImgCrop:function(t,e){this.api&&(1==e.value?this.api.asc_cropFill():2==e.value?this.api.asc_cropFit():e.checked?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),Common.NotificationCenter.trigger("edit:complete",this.documentHolder)},onImgMenuAlign:function(t,e){this.api&&(e.value>-1&&e.value<6?(this.api.asc_setSelectedDrawingObjectAlign(e.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Objects Align")):6==e.value?(this.api.asc_DistributeSelectedDrawingObjectHor(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Distribute")):7==e.value&&(this.api.asc_DistributeSelectedDrawingObjectVer(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Distribute")))},onParagraphVAlign:function(t,e){if(this.api){var i=new Asc.asc_CImgProperty;i.asc_putVerticalTextAlign(e.value),this.api.asc_setGraphicObjectProps(i),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Paragraph Vertical Align")}},onParagraphDirection:function(t,e){if(this.api){var i=new Asc.asc_CImgProperty;i.asc_putVert(e.options.direction),this.api.asc_setGraphicObjectProps(i),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Text Direction")}},onSelectBulletMenu:function(t,e){if(this.api)if(-1==e.options.value)this.api.asc_setListType(0,e.options.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","List Type");else if("settings"==e.options.value){for(var i,n=this,o=n.api.asc_getGraphicObjectProps(),s=0;s<o.length;s++)if(o[s].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Paragraph){i=o[s].asc_getObjectValue();break}if(i){n.api.asc_getCurrentListType();new Common.Views.ListSettingsDialog({api:n.api,props:i,type:0,storage:n.permissions.canRequestInsertImage||n.permissions.fileChoiceUrl&&n.permissions.fileChoiceUrl.indexOf("{documentType}")>-1,interfaceLang:n.permissions.lang,handler:function(t,e){"ok"==t&&n.api&&(i.asc_putBullet(e),n.api.asc_setGraphicObjectProps(i)),Common.NotificationCenter.trigger("edit:complete",n.documentHolder)}}).show()}}},onSelectBullets:function(t,e,i,n){var o={};if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;o=i.toJSON()}else o=i;if(0===o.type&&4096===o.subtype){var s,a=new Asc.asc_CBullet;o.drawdata.type===Asc.asc_PreviewBulletType.char?(a.asc_putSymbol(o.drawdata.char),a.asc_putFont(o.drawdata.specialFont)):o.drawdata.type===Asc.asc_PreviewBulletType.image&&a.asc_fillBulletImage(o.drawdata.imageId);for(var l=this.api.asc_getGraphicObjectProps(),r=0;r<l.length;r++)if(l[r].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Paragraph){(s=l[r].asc_getObjectValue()).asc_putBullet(a),this.api.asc_setGraphicObjectProps(s);break}}else this.api.asc_setListType(o.type,o.subtype);"click"!==n.type&&this.documentHolder.textInShapeMenu.hide(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","List Type")},onTextAdvanced:function(t){var e=this;new SSE.Views.ParagraphSettingsAdvanced({paragraphProps:t.textInfo,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.api.asc_setGraphicObjectProps(i.paragraphProps),Common.component.Analytics.trackEvent("DocumentHolder","Apply advanced paragraph settings")),Common.NotificationCenter.trigger("edit:complete",e)}}).show()},onShapeAdvanced:function(t){var e=this;new SSE.Views.ShapeSettingsAdvanced({shapeProps:t.shapeInfo,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.api.asc_setGraphicObjectProps(i.shapeProps),Common.component.Analytics.trackEvent("DocumentHolder","Apply advanced shape settings")),Common.NotificationCenter.trigger("edit:complete",e)}}).show()},onImgAdvanced:function(t){var e=this;new SSE.Views.ImageSettingsAdvanced({imageProps:t.imageInfo,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.api.asc_setGraphicObjectProps(i.imageProps),Common.component.Analytics.trackEvent("DocumentHolder","Apply advanced image settings")),Common.NotificationCenter.trigger("edit:complete",e)}}).show()},onSlicerAdvanced:function(t){var e=this;new SSE.Views.SlicerSettingsAdvanced({imageProps:t.imageInfo,api:e.api,styles:t.imageInfo.asc_getSlicerProperties().asc_getStylesPictures(),handler:function(t,i){"ok"==t&&e.api&&(e.api.asc_setGraphicObjectProps(i.imageProps),Common.component.Analytics.trackEvent("DocumentHolder","Apply slicer settings")),Common.NotificationCenter.trigger("edit:complete",e)}}).show()},onChartEdit:function(t){var e,i=this;i.api&&(e=i.api.asc_getChartObject())&&new SSE.Views.ChartSettingsDlg({chartSettings:e,imageSettings:t.chartInfo,isChart:!0,api:i.api,handler:function(t,e){"ok"==t&&i.api&&(i.api.asc_editChartDrawingObject(e.chartSettings),e.imageSettings&&i.api.asc_setGraphicObjectProps(e.imageSettings)),Common.NotificationCenter.trigger("edit:complete",i)}}).show()},onChartData:function(t){var e,i=this;i.api&&((e=i.api.asc_getChartObject())&&(i._isEditRanges=!0,e.startEdit(),new SSE.Views.ChartDataDialog({chartSettings:e,api:i.api,handler:function(t,n){"ok"==t&&(e.endEdit(),i._isEditRanges=!1),Common.NotificationCenter.trigger("edit:complete",i)}}).on("close",(function(){i._isEditRanges&&e.cancelEdit(),i._isEditRanges=!1})).show()))},onChartType:function(t){var e,i=this;i.api&&((e=i.api.asc_getChartObject())&&(i._isEditType=!0,e.startEdit(),new SSE.Views.ChartTypeDialog({chartSettings:e,api:i.api,handler:function(t,n){"ok"==t&&(e.endEdit(),i._isEditType=!1),Common.NotificationCenter.trigger("edit:complete",i)}}).on("close",(function(){i._isEditType&&e.cancelEdit(),i._isEditType=!1})).show()))},onImgMacro:function(t){var e=this;new SSE.Views.MacroDialog({props:{macroList:e.api.asc_getAllMacrosNames(),current:e.api.asc_getCurrentDrawingMacrosName()},handler:function(t,i){"ok"==t&&e.api&&e.api.asc_assignMacrosToCurrentDrawing(i),Common.NotificationCenter.trigger("edit:complete",e)}}).show()},onImgEditPoints:function(t){this.api&&this.api.asc_editPointsGeometry()},onGetLink:function(t){if(this.api){var e=this.api.asc_getActiveRangeStr(Asc.referenceType.A,!1,!0),i=this.api.asc_getEscapeSheetName(this.api.asc_getWorksheetName(this.api.asc_getActiveWorksheetIndex()));(i=i+(""!==i&&""!==e?"!":"")+e)&&Common.Gateway.requestMakeActionLink({action:{type:"internallink",data:i}})}},onSetActionLink:function(t){if(!Common.Utils.InternalSettings.get("sse-dialog-link-visible")){var e=this;navigator.clipboard&&navigator.clipboard.writeText(t).then((function(){Common.NotificationCenter.trigger("showmessage",{msg:e.txtCopySuccess},{timeout:3e3,hideCloseTip:!0})})).catch((function(t){console.log(t)}))}},onApiCoAuthoringDisconnect:function(){this.permissions.isEdit=!1},hideCoAuthTips:function(){this.tooltips.coauth.ref&&($(this.tooltips.coauth.ref).remove(),this.tooltips.coauth.ref=void 0,this.tooltips.coauth.x_point=void 0,this.tooltips.coauth.y_point=void 0)},hideForeignSelectTips:function(){this.tooltips.foreignSelect.ref&&($(this.tooltips.foreignSelect.ref).remove(),this.tooltips.foreignSelect.ref=void 0,this.tooltips.foreignSelect.userId=void 0,this.tooltips.foreignSelect.x_point=void 0,this.tooltips.foreignSelect.y_point=void 0)},hideHyperlinkTip:function(){!this.tooltips.hyperlink.isHidden&&this.tooltips.hyperlink.ref&&(this.tooltips.hyperlink.ref.hide(),this.tooltips.hyperlink.ref=void 0,this.tooltips.hyperlink.text="",this.tooltips.hyperlink.isHidden=!0)},onApiMouseMove:function(t){if(!this._isFullscreenMenu&&t.length){for(var e,i,n,o,s,a,l,r,c=t.length;c>0;c--)switch(t[c-1].asc_getType()){case Asc.c_oAscMouseMoveType.Hyperlink:e=c;break;case Asc.c_oAscMouseMoveType.Comment:i=c;break;case Asc.c_oAscMouseMoveType.LockedObject:n=c;break;case Asc.c_oAscMouseMoveType.ResizeColumn:o=c;break;case Asc.c_oAscMouseMoveType.ResizeRow:s=c;break;case Asc.c_oAscMouseMoveType.Filter:a=c;break;case Asc.c_oAscMouseMoveType.Tooltip:l=c;break;case Asc.c_oAscMouseMoveType.ForeignSelect:r=c}var d=this,h=[0,0],p=d.tooltips.coauth,m=d.tooltips.comment,u=d.tooltips.hyperlink,g=d.tooltips.row_column,f=d.tooltips.filter,b=d.tooltips.slicer,C=d.tooltips.foreignSelect,v=[d.documentHolder.cmpEl.offset().left-$(window).scrollLeft(),d.documentHolder.cmpEl.offset().top-$(window).scrollTop()];if(e||d.hideHyperlinkTip(),void 0===o&&void 0===s&&!g.isHidden&&g.ref&&(g.ref.hide(),g.ref=void 0,g.text="",g.isHidden=!0),r||d.hideForeignSelectTips(),(d.permissions.isEdit||d.permissions.canViewComments)&&(!i||this.popupmenu)&&(m.moveCommentId=void 0,null!=m.viewCommentId)){m={};var _=this.getApplication().getController("Common.Controllers.Comments");_&&(this.permissions.canCoAuthoring&&this.permissions.canViewComments?setTimeout((function(){_.onApiHideComment(!0)}),200):_.onApiHideComment(!0))}if(d.permissions.isEdit&&(n||d.hideCoAuthTips(),void 0===l&&!b.isHidden&&b.ref&&(b.ref.hide(),b.ref=void 0,b.text="",b.isHidden=!0)),(void 0===a||d.dlgFilter&&d.dlgFilter.isVisible()||d.currentMenu&&d.currentMenu.isVisible())&&!f.isHidden&&f.ref&&(f.ref.hide(),f.ref=void 0,f.text="",f.isHidden=!0),e){u.parentEl||(u.parentEl=$('<div id="tip-container-hyperlinktip" style="position: absolute; z-index: 10000;"></div>'),d.documentHolder.cmpEl.append(u.parentEl));var x=(S=t[e-1]).asc_getHyperlink();if(x.asc_getType()==Asc.c_oAscHyperlinkType.WebLink){var y=x.asc_getTooltip();(y=y||x.asc_getHyperlinkUrl()).length>256&&(y=y.substr(0,256)+"..."),y=Common.Utils.String.htmlEncode(y)+"<br><b>"+d.textCtrlClick+"</b>"}else y=Common.Utils.String.htmlEncode(x.asc_getTooltip()||x.asc_getLocation()),y+="<br><b>"+d.textCtrlClick+"</b>";if(u.ref&&u.ref.isVisible()&&u.text!=y&&(u.ref.hide(),u.ref=void 0,u.text="",u.isHidden=!0),!u.ref||!u.ref.isVisible()){u.text=y,u.ref=new Common.UI.Tooltip({owner:u.parentEl,html:!0,title:y}),u.ref.show([-1e4,-1e4]),u.isHidden=!1,(h=[S.asc_getX(),S.asc_getY()])[0]+=v[0]+6,h[1]+=v[1]-20,h[1]-=u.ref.getBSTip().$tip.height();var w=u.ref.getBSTip().$tip.width();h[0]+w>d.tooltips.coauth.bodyWidth&&(h[0]=d.tooltips.coauth.bodyWidth-w),u.ref.getBSTip().$tip.css({top:h[1]+"px",left:h[0]+"px"})}}if(void 0!==o||void 0!==s){g.parentEl||(g.parentEl=$('<div id="tip-container-rowcolumntip" style="position: absolute; z-index: 10000;"></div>'),d.documentHolder.cmpEl.append(g.parentEl));var S=t[void 0!==o?o-1:s-1],A=Common.Utils.String.format(void 0!==o?this.textChangeColumnWidth:this.textChangeRowHeight,S.asc_getSizeCCOrPt().toFixed(2),S.asc_getSizePx().toFixed());if(g.ref&&g.ref.isVisible()&&g.text!=A&&(g.text=A,g.ref.setTitle(A),g.ref.updateTitle()),!g.ref||!g.ref.isVisible()){g.text=A,g.ref=new Common.UI.Tooltip({owner:g.parentEl,html:!0,title:A}),g.ref.show([-1e4,-1e4]),g.isHidden=!1,(h=[S.asc_getX(),S.asc_getY()])[0]+=v[0]+6,h[1]+=v[1]-20-g.ttHeight;w=g.ref.getBSTip().$tip.width();h[0]+w>d.tooltips.coauth.bodyWidth&&(h[0]=d.tooltips.coauth.bodyWidth-w-20),g.ref.getBSTip().$tip.css({top:h[1]+"px",left:h[0]+"px"})}}if((d.permissions.isEdit||d.permissions.canViewComments)&&i&&!this.popupmenu&&(S=t[i-1],!m.editCommentId&&m.moveCommentId!=S.asc_getCommentIndexes()[0])){m.moveCommentId=S.asc_getCommentIndexes()[0],m.moveCommentTimer&&clearTimeout(m.moveCommentTimer);var k=S.asc_getCommentIndexes(),T=S.asc_getX(),I=S.asc_getY(),E=S.asc_getReverseX();m.moveCommentTimer=setTimeout((function(){if(m.moveCommentId&&!m.editCommentId){m.viewCommentId=m.moveCommentId;var t=d.getApplication().getController("Common.Controllers.Comments");t&&(t.isSelectedComment||t.onApiShowComment(k,T,I,E,!1,!0))}}),400)}if(d.permissions.isEdit&&n&&d.isUserVisible(t[n-1].asc_getUserId())&&(S=t[n-1],p.XY||d.onDocumentResize(),p.x_point!=S.asc_getX()||p.y_point!=S.asc_getY())){d.hideCoAuthTips(),p.x_point=S.asc_getX(),p.y_point=S.asc_getY();var D=$(document.createElement("div")),P=S.asc_getLockedObjectType()==Asc.c_oAscMouseMoveLockedObjectType.Sheet||S.asc_getLockedObjectType()==Asc.c_oAscMouseMoveLockedObjectType.TableProperties;p.ref=D,D.addClass("username-tip"),D.css({height:p.ttHeight+"px",position:"absolute",zIndex:"900",visibility:"visible"}),$(document.body).append(D),(h=[P?p.x_point+p.rightMenuWidth:p.bodyWidth-(p.x_point+p.XY[0]),p.y_point+p.XY[1]])[1]>=p.XY[1]&&h[1]+p.ttHeight<p.XY[1]+p.apiHeight&&(D.text(d.getUserName(S.asc_getUserId())),p.bodyWidth-h[0]<p.ref.outerWidth()?D.css({visibility:"visible",left:"0px",top:h[1]-p.ttHeight+"px"}):D.css({visibility:"visible",right:h[0]+"px",top:h[1]+"px"}))}if(r&&d.isUserVisible(t[r-1].asc_getUserId())&&(S=t[r-1],p.XY||d.onDocumentResize(),C.x_point!=S.asc_getX()||C.y_point!=S.asc_getY())){d.hideForeignSelectTips(),C.x_point=S.asc_getX(),C.y_point=S.asc_getY();D=$(document.createElement("div"));var F=S.asc_getColor();C.ref=D,C.userId=S.asc_getUserId(),D.addClass("username-tip"),D.css({height:C.ttHeight+"px",position:"absolute",zIndex:"900",visibility:"visible","background-color":"#"+Common.Utils.ThemeColor.getHexColor(F.get_r(),F.get_g(),F.get_b())}),$(document.body).append(D),h=[C.x_point+p.XY[0],C.y_point+p.XY[1]-C.ttHeight],D.text(d.getUserName(S.asc_getUserId())),D.css({visibility:"visible",left:(h[0]+C.ref.outerWidth()>p.bodyWidth-p.rightMenuWidth?p.bodyWidth-p.rightMenuWidth-C.ref.outerWidth():h[0])+"px",top:h[1]+"px"})}if(!(void 0===a||d.dlgFilter&&d.dlgFilter.isVisible()||d.currentMenu&&d.currentMenu.isVisible()||t[a-1].asc_getFilter().asc_getPivotObj())){f.parentEl||(f.parentEl=$('<div id="tip-container-filtertip" style="position: absolute; z-index: 10000;"></div>'),d.documentHolder.cmpEl.append(f.parentEl));S=t[a-1],A=d.makeFilterTip(S.asc_getFilter());if(f.ref&&f.ref.isVisible()&&f.text!=A&&(f.text=A,f.ref.setTitle(A),f.ref.updateTitle()),!f.ref||!f.ref.isVisible()){f.text=A,f.ref=new Common.UI.Tooltip({owner:f.parentEl,html:!0,title:A,cls:"auto-tooltip"}),f.ref.show([-1e4,-1e4]),f.isHidden=!1,h=[S.asc_getX()+v[0]-10,S.asc_getY()+v[1]+20];f.ref.getBSTip().$tip.width();h[1]+f.ttHeight>d.tooltips.coauth.bodyHeight&&(h[1]=d.tooltips.coauth.bodyHeight-f.ttHeight-5,h[0]+=20);w=f.ref.getBSTip().$tip.width();h[0]+w>d.tooltips.coauth.bodyWidth&&(h[0]=d.tooltips.coauth.bodyWidth-w-20),f.ref.getBSTip().$tip.css({top:h[1]+"px",left:h[0]+"px"})}}if(void 0!==l&&d.permissions.isEdit){b.parentEl||(b.parentEl=$('<div id="tip-container-slicertip" style="position: absolute; z-index: 10000;"></div>'),d.documentHolder.cmpEl.append(b.parentEl));A=(S=t[l-1]).asc_getTooltip();if(b.ref&&b.ref.isVisible()&&b.text!=A&&(b.text=A,b.ref.setTitle(A),b.ref.updateTitle()),!b.ref||!b.ref.isVisible()){b.text=A,b.ref=new Common.UI.Tooltip({owner:b.parentEl,html:!0,title:A}),b.ref.show([-1e4,-1e4]),b.isHidden=!1,(h=[S.asc_getX(),S.asc_getY()])[0]+=v[0]+6,h[1]+=v[1]-20-b.ttHeight;w=b.ref.getBSTip().$tip.width();h[0]+w>d.tooltips.coauth.bodyWidth&&(h[0]=d.tooltips.coauth.bodyWidth-w-20),b.ref.getBSTip().$tip.css({top:h[1]+"px",left:h[0]+"px"})}}}},onApiHideComment:function(){this.tooltips.comment.viewCommentId=this.tooltips.comment.editCommentId=this.tooltips.comment.moveCommentId=void 0},onApiHyperlinkClick:function(t){if(t){var e=this.api.asc_getUrlType(t);e===AscCommon.c_oAscUrlType.Http||e===AscCommon.c_oAscUrlType.Email?window.open(t,"_blank"):Common.UI.warning({msg:this.txtWarnUrl,buttons:["yes","no"],primary:"yes",callback:function(e){"yes"==e&&window.open(t,"_blank")}})}else Common.UI.alert({msg:this.errorInvalidLink,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){Common.NotificationCenter.trigger("edit:complete",this.documentHolder)}),this)})},onApiAutofilter:function(t){var e=this;if(!e.tooltips.filter.isHidden&&e.tooltips.filter.ref&&(e.tooltips.filter.ref.hide(),e.tooltips.filter.ref=void 0,e.tooltips.filter.text="",e.tooltips.filter.isHidden=!0),e.permissions.isEdit)if(e.dlgFilter)e.dlgFilter.close();else{if(e._state.wsProps.PivotTables&&t.asc_getPivotObj()||e._state.wsProps.AutoFilter&&!t.asc_getPivotObj())return;e.dlgFilter=new SSE.Views.AutoFilterDialog({api:this.api}).on({close:function(){e.api&&e.api.asc_enableKeyEvents(!0),e.dlgFilter=void 0}}),e.api&&e.api.asc_enableKeyEvents(!1),Common.UI.Menu.Manager.hideAll(),e.dlgFilter.setSettings(t);var i=e.documentHolder.cmpEl.offset(),n=t.asc_getCellCoord(),o=n.asc_getX()+n.asc_getWidth()+i.left,s=n.asc_getY()+n.asc_getHeight()+i.top,a=Common.Utils.innerWidth(),l=Common.Utils.innerHeight();o+e.dlgFilter.options.width>a&&(o=a-e.dlgFilter.options.width-5),s+e.dlgFilter.options.height>l&&(s=l-e.dlgFilter.options.height-5),e.dlgFilter.show(o,s)}},makeFilterTip:function(t){var e=t.asc_getFilterObj(),i=e.asc_getType(),n=(t.asc_getIsTextFilter(),t.asc_getColorsFill(),t.asc_getColorsFont(),"");if(i===Asc.c_oAscAutoFilterTypes.CustomFilters){var o=e.asc_getFilter(),s=o.asc_getCustomFilters();n=this.getFilterName(Asc.c_oAscAutoFilterTypes.CustomFilters,s[0].asc_getOperator())+' "'+s[0].asc_getVal()+'"',s.length>1&&(n=(n=n+" "+(o.asc_getAnd()?this.txtAnd:this.txtOr))+" "+this.getFilterName(Asc.c_oAscAutoFilterTypes.CustomFilters,s[1].asc_getOperator())+' "'+s[1].asc_getVal()+'"')}else if(i===Asc.c_oAscAutoFilterTypes.ColorFilter){var a=e.asc_getFilter();null===a.asc_getCellColor()?n=this.txtEqualsToCellColor:!1===a.asc_getCellColor()&&(n=this.txtEqualsToFontColor)}else if(i===Asc.c_oAscAutoFilterTypes.DynamicFilter)n=this.getFilterName(Asc.c_oAscAutoFilterTypes.DynamicFilter,e.asc_getFilter().asc_getType());else if(i===Asc.c_oAscAutoFilterTypes.Top10){var l=e.asc_getFilter(),r=l.asc_getPercent();n=this.getFilterName(Asc.c_oAscAutoFilterTypes.Top10,l.asc_getTop()),n+=" "+l.asc_getVal()+" "+(r||null===r?this.txtPercent:this.txtItems)}else if(i===Asc.c_oAscAutoFilterTypes.Filters){var c=0,d=0,h=void 0,p=t.asc_getValues();p.forEach((function(t){t.asc_getVisible()&&(d++,c<100&&t.asc_getText()&&(n+=t.asc_getText()+"; ",c=n.length)),t.asc_getText()||(h=t.asc_getVisible())})),d==p.length?n=this.txtAll:1==d&&h?n=this.txtEquals+' "'+this.txtBlanks+'"':d==p.length-1&&0==h?n=this.txtNotEquals+' "'+this.txtBlanks+'"':(h&&(n+=this.txtBlanks+"; "),n=this.txtEquals+' "'+n.substring(0,n.length-2)+'"')}else i===Asc.c_oAscAutoFilterTypes.None&&(n=this.txtAll);return n.length>100&&(n=n.substring(0,100)+"..."),n="<b>"+(t.asc_getColumnName()||"("+this.txtColumn+" "+t.asc_getSheetColumnName()+")")+":</b><br>"+n},getFilterName:function(t,e){var i="";if(t==Asc.c_oAscAutoFilterTypes.CustomFilters)switch(e){case Asc.c_oAscCustomAutoFilter.equals:i=this.txtEquals;break;case Asc.c_oAscCustomAutoFilter.isGreaterThan:i=this.txtGreater;break;case Asc.c_oAscCustomAutoFilter.isGreaterThanOrEqualTo:i=this.txtGreaterEquals;break;case Asc.c_oAscCustomAutoFilter.isLessThan:i=this.txtLess;break;case Asc.c_oAscCustomAutoFilter.isLessThanOrEqualTo:i=this.txtLessEquals;break;case Asc.c_oAscCustomAutoFilter.doesNotEqual:i=this.txtNotEquals;break;case Asc.c_oAscCustomAutoFilter.beginsWith:i=this.txtBegins;break;case Asc.c_oAscCustomAutoFilter.doesNotBeginWith:i=this.txtNotBegins;break;case Asc.c_oAscCustomAutoFilter.endsWith:i=this.txtEnds;break;case Asc.c_oAscCustomAutoFilter.doesNotEndWith:i=this.txtNotEnds;break;case Asc.c_oAscCustomAutoFilter.contains:i=this.txtContains;break;case Asc.c_oAscCustomAutoFilter.doesNotContain:i=this.txtNotContains}else if(t==Asc.c_oAscAutoFilterTypes.DynamicFilter)switch(e){case Asc.c_oAscDynamicAutoFilter.aboveAverage:i=this.txtAboveAve;break;case Asc.c_oAscDynamicAutoFilter.belowAverage:i=this.txtBelowAve}else t==Asc.c_oAscAutoFilterTypes.Top10&&(i=e||null===e?this.txtFilterTop:this.txtFilterBottom);return i},onUndo:function(){this.api&&(this.api.asc_Undo(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder))},onApiContextMenu:function(t){Common.UI.HintManager.isHintVisible()&&Common.UI.HintManager.clearHints();var e=this;_.delay((function(){e.showObjectMenu.call(e,t)}),10)},onAfterRender:function(t){},onDocumentResize:function(t){var e=this;if(e.documentHolder){e.tooltips.coauth.XY=[e.documentHolder.cmpEl.offset().left-$(window).scrollLeft(),e.documentHolder.cmpEl.offset().top-$(window).scrollTop()],e.tooltips.coauth.apiHeight=e.documentHolder.cmpEl.height();var i=$("#right-menu");e.tooltips.coauth.rightMenuWidth=i.is(":visible")?i.width():0,e.tooltips.coauth.bodyWidth=$(window).width(),e.tooltips.coauth.bodyHeight=$(window).height()}},onDocumentWheel:function(t){if(this.api&&!this.isEditCell){var e=_.isUndefined(t.originalEvent)?t.wheelDelta:t.originalEvent.wheelDelta;if(_.isUndefined(e)&&(e=t.deltaY),t.ctrlKey&&!t.altKey){var i=this.api.asc_getZoom();e<0?(i=Math.ceil(10*i)/10,(i-=.1)<.1||this.api.asc_setZoom(i)):e>0&&(i=Math.floor(10*i)/10,(i+=.1)>0&&!(i>5)&&this.api.asc_setZoom(i)),t.preventDefault(),t.stopPropagation()}}},onDocumentKeyDown:function(t){if(this.api){var e=t.keyCode;if(this.hkSpecPaste&&(this._needShowSpecPasteMenu=!t.shiftKey&&!t.altKey&&t.keyCode==Common.UI.Keys.CTRL),!t.ctrlKey&&!t.metaKey||t.shiftKey||t.altKey){if(e==Common.UI.Keys.F10&&t.shiftKey)return this.showObjectMenu(t),t.preventDefault(),t.stopPropagation(),!1;e==Common.UI.Keys.ESC&&!this.tooltips.input_msg.isHidden&&this.tooltips.input_msg.text&&this.onInputMessage()}else if(e===Common.UI.Keys.NUM_PLUS||e===Common.UI.Keys.EQUALITY||Common.Utils.isGecko&&e===Common.UI.Keys.EQUALITY_FF||Common.Utils.isOpera&&43==e){if(!this.api.isCellEdited){var i=Math.floor(10*this.api.asc_getZoom())/10;return(i+=.1)>0&&!(i>5)&&this.api.asc_setZoom(i),t.preventDefault(),t.stopPropagation(),!1}if(this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle)return t.preventDefault(),t.stopPropagation(),!1}else if(e===Common.UI.Keys.NUM_MINUS||e===Common.UI.Keys.MINUS||Common.Utils.isGecko&&e===Common.UI.Keys.MINUS_FF||Common.Utils.isOpera&&45==e){if(!this.api.isCellEdited)return i=Math.ceil(10*this.api.asc_getZoom())/10,(i-=.1)<.1||this.api.asc_setZoom(i),t.preventDefault(),t.stopPropagation(),!1;if(this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle)return t.preventDefault(),t.stopPropagation(),!1}else if((48===e||96===e)&&!this.api.isCellEdited)return this.api.asc_setZoom(1),t.preventDefault(),t.stopPropagation(),!1}},onDocumentRightDown:function(t){0==t.button&&(this.mouse.isLeftButtonDown=!0)},onDocumentRightUp:function(t){0==t.button&&(this.mouse.isLeftButtonDown=!1)},onProcessMouse:function(t){"mouseup"==t.type&&(this.mouse.isLeftButtonDown=!1)},onDragEndMouseUp:function(){this.mouse.isLeftButtonDown=!1},onDocumentMouseMove:function(t){t&&"canvas"!==t.target.localName&&this.hideHyperlinkTip()},showObjectMenu:function(t){!this.api||this.mouse.isLeftButtonDown||this.rangeSelectionMode||(this.permissions.isEdit&&!this._isDisabled?this.fillMenuProps(this.api.asc_getCellInfo(),!0,t):this.fillViewMenuProps(this.api.asc_getCellInfo(),!0,t))},onSelectionChanged:function(t){!this.mouse.isLeftButtonDown&&!this.rangeSelectionMode&&this.currentMenu&&this.currentMenu.isVisible()&&(this.permissions.isEdit&&!this._isDisabled?this.fillMenuProps(t,!0):this.fillViewMenuProps(t,!0))},fillMenuProps:function(t,e,i){var n,o,s,a,l,r,c,d,h,p,m,u=this.documentHolder,g=t.asc_getSelectionType(),f=t.asc_getLocked(),b=!0===t.asc_getLockedTable(),C=!0===t.asc_getLockedPivotTable(),v=!1,x=this.getApplication().getController("Common.Controllers.Comments"),y=this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle,w=this.permissions.isEditMailMerge||this.permissions.isEditDiagram,S=t.asc_getXfs(),A=!1,k=!1;switch(g){case Asc.c_oAscSelectionType.RangeCells:n=!0;break;case Asc.c_oAscSelectionType.RangeRow:o=!0;break;case Asc.c_oAscSelectionType.RangeCol:s=!0;break;case Asc.c_oAscSelectionType.RangeMax:a=!0;break;case Asc.c_oAscSelectionType.RangeSlicer:case Asc.c_oAscSelectionType.RangeImage:r=!(this.permissions.isEditMailMerge||this.permissions.isEditDiagram);break;case Asc.c_oAscSelectionType.RangeShape:d=!(this.permissions.isEditMailMerge||this.permissions.isEditDiagram);break;case Asc.c_oAscSelectionType.RangeChart:l=!(this.permissions.isEditMailMerge||this.permissions.isEditDiagram);break;case Asc.c_oAscSelectionType.RangeChartText:h=!(this.permissions.isEditMailMerge||this.permissions.isEditDiagram);break;case Asc.c_oAscSelectionType.RangeShapeText:c=!(this.permissions.isEditMailMerge||this.permissions.isEditDiagram)}if(this.api.asc_getHeaderFooterMode()){if(!u.copyPasteMenu||!e&&!u.copyPasteMenu.isVisible())return;e&&this.showPopupMenu(u.copyPasteMenu,{},i)}else if(r||d||l){if(!u.imgMenu||!e&&!u.imgMenu.isVisible())return;r=d=l=m=!1,u.mnuImgAdvanced.imageInfo=void 0;for(var T,I=!1,E=this.api.asc_getGraphicObjectProps(),D=0;D<E.length;D++)if(E[D].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var P=E[D].asc_getObjectValue();if(v=v||P.asc_getLocked(),this._state.wsProps.Objects&&P.asc_getProtectionLocked())return;var F=P.asc_getShapeProperties();F?F.asc_getFromChart()?l=!0:F.asc_getFromImage()?p=!0:(u.mnuShapeAdvanced.shapeInfo=P,d=!0,F.asc_getFromSmartArt()&&(A=!0),F.asc_getFromSmartArtInternal()&&(k=!0)):P.asc_getChartProperties()?(u.mnuChartEdit.chartInfo=P,l=!0,I=!0):P.asc_getSlicerProperties()?(u.mnuSlicerAdvanced.imageInfo=P,m=!0):(u.mnuImgAdvanced.imageInfo=P,r=!0),this.permissions.isSignatureSupport&&(T=P.asc_getSignatureId())}u.mnuBringToFront.setDisabled(k),u.mnuSendToBack.setDisabled(k),u.mnuBringForward.setDisabled(k),u.mnuSendBackward.setDisabled(k);var R=this.api.asc_canGroupGraphicsObjects();u.mnuUnGroupImg.setDisabled(v||!this.api.asc_canUnGroupGraphicsObjects()),u.mnuGroupImg.setDisabled(v||!R),u.menuImageAlign.setDisabled(v||!R);var V=this.api.asc_getSelectedDrawingObjectsCount();u.menuImageAlign.menu.items[7].setDisabled(V<3),u.menuImageAlign.menu.items[8].setDisabled(V<3),u.mnuShapeAdvanced.setVisible(d&&!r&&!l),u.mnuShapeAdvanced.setDisabled(v),u.mnuChartEdit.setVisible(l&&!r&&!d&&I),u.mnuChartEdit.setDisabled(v),u.mnuChartData.setVisible(this.permissions.isEditOle&&l&&!r&&!d&&I),u.mnuChartData.setDisabled(v),u.mnuChartType.setVisible(this.permissions.isEditOle&&l&&!r&&!d&&I),u.mnuChartType.setDisabled(v),u.pmiImgCut.setDisabled(v),u.pmiImgPaste.setDisabled(v),u.mnuImgAdvanced.setVisible(r&&(!d||p)&&!l),u.mnuImgAdvanced.setDisabled(v),u.menuImgOriginalSize.setVisible(r&&(!d||p)&&!l),u.mnuImgAdvanced.imageInfo&&u.menuImgOriginalSize.setDisabled(v||null===u.mnuImgAdvanced.imageInfo.get_ImageUrl()||void 0===u.mnuImgAdvanced.imageInfo.get_ImageUrl()),u.mnuSlicerAdvanced.setVisible(m),u.mnuSlicerAdvanced.setDisabled(v);var M=u.mnuImgAdvanced.imageInfo?u.mnuImgAdvanced.imageInfo.asc_getPluginGuid():null;u.menuImgReplace.setVisible(p&&null==M),u.menuImgReplace.setDisabled(v||null===M),u.menuImgReplace.menu.items[2].setVisible(this.permissions.canRequestInsertImage||this.permissions.fileChoiceUrl&&this.permissions.fileChoiceUrl.indexOf("{documentType}")>-1),u.menuImageArrange.setDisabled(v),u.menuImgRotate.setVisible(!l&&null==M&&!m),u.menuImgRotate.setDisabled(v||A),u.menuImgRotate.menu.items[3].setDisabled(k),u.menuImgRotate.menu.items[4].setDisabled(k),u.menuImgCrop.setVisible(this.api.asc_canEditCrop()),u.menuImgCrop.setDisabled(v);var U=!!T;u.menuSignatureEditSign.setVisible(U),u.menuSignatureEditSetup.setVisible(U),u.menuEditSignSeparator.setVisible(U),u.menuImgMacro.setVisible(!y),u.menuImgMacro.setDisabled(v);var L=this.api&&this.api.asc_canEditGeometry();u.menuImgEditPoints.setVisible(L),u.menuImgEditPointsSeparator.setVisible(L),L&&u.menuImgEditPoints.setDisabled(v),e&&this.showPopupMenu(u.imgMenu,{},i),u.mnuShapeSeparator.setVisible(u.mnuShapeAdvanced.isVisible()||u.mnuChartEdit.isVisible()||u.mnuImgAdvanced.isVisible()),u.mnuSlicerSeparator.setVisible(u.mnuSlicerAdvanced.isVisible()),U&&(u.menuSignatureEditSign.cmpEl.attr("data-value",T),u.menuSignatureEditSetup.cmpEl.attr("data-value",T))}else if(c||h){if(!u.textInShapeMenu||!e&&!u.textInShapeMenu.isVisible())return;u.pmiTextAdvanced.textInfo=void 0;E=this.api.asc_getGraphicObjectProps();var B=!1;for(D=0;D<E.length;D++){var O=E[D].asc_getObjectType();if(O==Asc.c_oAscTypeSelectElement.Image){var N=E[D].asc_getObjectValue(),H=N.asc_getVerticalTextAlign(),$=N.asc_getVert(),G=this.api.asc_getCurrentListType(),z=N?N.asc_getShapeProperties():null;if(this._state.wsProps.Objects&&N.asc_getProtectionLockText())return;v=v||N.asc_getLocked(),A=!!z&&z.asc_getFromSmartArt(),k=!!z&&z.asc_getFromSmartArtInternal();var W="";switch(H){case Asc.c_oAscVAlign.Top:W="menu__icon btn-align-top";break;case Asc.c_oAscVAlign.Center:W="menu__icon btn-align-middle";break;case Asc.c_oAscVAlign.Bottom:W="menu__icon btn-align-bottom"}switch(u.menuParagraphVAlign.setIconCls(W),u.menuParagraphTop.setChecked(H==Asc.c_oAscVAlign.Top),u.menuParagraphCenter.setChecked(H==Asc.c_oAscVAlign.Center),u.menuParagraphBottom.setChecked(H==Asc.c_oAscVAlign.Bottom),W="",$){case Asc.c_oAscVertDrawingText.normal:W="menu__icon text-orient-hor";break;case Asc.c_oAscVertDrawingText.vert:W="menu__icon text-orient-rdown";break;case Asc.c_oAscVertDrawingText.vert270:W="menu__icon text-orient-rup"}u.menuParagraphDirection.setIconCls(W),u.menuParagraphDirectH.setChecked($==Asc.c_oAscVertDrawingText.normal),u.menuParagraphDirect90.setChecked($==Asc.c_oAscVertDrawingText.vert),u.menuParagraphDirect270.setChecked($==Asc.c_oAscVertDrawingText.vert270),u.menuParagraphBulletNone.setChecked(-1==G.get_ListType());var j,q=G.get_ListType(),K=G.get_ListSubType(),Y=u.paraBulletsPicker.store.at(7),X=4096===Y.get("subtype")&&(1===q||4096!==K);if(1===q||4096!==K)j=u.paraBulletsPicker.store.findWhere({type:q,subtype:K});else{var J=G.asc_getListCustom();if(J){var Z=J.asc_getType();if(Z===Asc.asc_PreviewBulletType.char){var Q=J.asc_getChar();Q&&((j=Y).set("subtype",4096),j.set("drawdata",{type:Z,char:Q,specialFont:J.asc_getSpecialFont()}),j.set("tip",""),u.paraBulletsPicker.dataViewItems&&this.updateBulletTip(u.paraBulletsPicker.dataViewItems[7],""),X=!1)}else if(Z===Asc.asc_PreviewBulletType.image){var tt=J.asc_getImageId();tt&&((j=Y).set("subtype",4096),j.set("drawdata",{type:Z,imageId:tt}),j.set("tip",""),u.paraBulletsPicker.dataViewItems&&this.updateBulletTip(u.paraBulletsPicker.dataViewItems[7],""),X=!1)}}}u.paraBulletsPicker.selectRecord(j,!0),X&&(Y.set("subtype",8),Y.set("drawdata",u._markersArr[7]),Y.set("tip",u.tipMarkersDash),u.paraBulletsPicker.dataViewItems&&this.updateBulletTip(u.paraBulletsPicker.dataViewItems[7],u.tipMarkersDash))}else O==Asc.c_oAscTypeSelectElement.Paragraph?(u.pmiTextAdvanced.textInfo=E[D].asc_getObjectValue(),v=v||u.pmiTextAdvanced.textInfo.asc_getLocked()):O==Asc.c_oAscTypeSelectElement.Math&&(this._currentMathObj=E[D].asc_getObjectValue(),B=!0)}var et=t.asc_getHyperlink(),it=this.api.asc_canAddShapeHyperlink();u.menuParagraphBullets.setVisible(!0!==h),u.menuHyperlinkShape.setVisible(c&&!1!==it&&et),u.menuAddHyperlinkShape.setVisible(c&&!1!==it&&!et),u.menuParagraphVAlign.setVisible(!0!==h&&!B),u.menuParagraphDirection.setVisible(!0!==h&&!B),u.textInShapeMenu.items[3].setVisible(!0!==h||c&&!1!==it),u.pmiTextAdvanced.setVisible(void 0!==u.pmiTextAdvanced.textInfo),_.each(u.textInShapeMenu.items,(function(t){t.setDisabled(v)})),u.pmiTextCopy.setDisabled(!1),u.menuHyperlinkShape.setDisabled(v||this._state.wsProps.InsertHyperlinks),u.menuAddHyperlinkShape.setDisabled(v||this._state.wsProps.InsertHyperlinks);this._currentParaObjDisabled=v,B?this.addEquationMenu(4):this.clearEquationMenu(4),e&&this.showPopupMenu(u.textInShapeMenu,{},i),u.menuParagraphBullets.setDisabled(A||k)}else if(!this.permissions.isEditMailMerge&&!this.permissions.isEditDiagram&&!this.permissions.isEditOle||g!==Asc.c_oAscSelectionType.RangeImage&&g!==Asc.c_oAscSelectionType.RangeShape&&g!==Asc.c_oAscSelectionType.RangeChart&&g!==Asc.c_oAscSelectionType.RangeChartText&&g!==Asc.c_oAscSelectionType.RangeShapeText&&g!==Asc.c_oAscSelectionType.RangeSlicer){if(!u.ssMenu||!e&&!u.ssMenu.isVisible())return;var nt=this.api.isCellEdited,ot=t.asc_getFormatTableInfo(),st=null!==t.asc_getSparklineInfo(),at=null!==ot,lt=t.asc_getMultiselect(),rt=!!t.asc_getPivotTableInfo();u.ssMenu.formatTableName=at?ot.asc_getTableName():null,u.ssMenu.cellColor=S.asc_getFillColor(),u.ssMenu.fontColor=S.asc_getFontColor(),u.pmiInsertEntire.setVisible(o||s),u.pmiInsertEntire.setCaption(o?this.textInsertTop:this.textInsertLeft),u.pmiDeleteEntire.setVisible(o||s),u.pmiInsertCells.setVisible(n&&!nt&&!at&&!rt),u.pmiDeleteCells.setVisible(n&&!nt&&!at&&!rt),u.pmiSelectTable.setVisible(n&&!nt&&at),u.pmiInsertTable.setVisible(n&&!nt&&at),u.pmiDeleteTable.setVisible(n&&!nt&&at),u.pmiSparklines.setVisible(st),u.pmiSortCells.setVisible((n||a)&&!nt&&!rt),u.pmiSortCells.menu.items[2].setVisible(!w),u.pmiSortCells.menu.items[3].setVisible(!w),u.pmiSortCells.menu.items[4].setVisible(!y),u.pmiFilterCells.setVisible(n&&!nt&&!w&&!rt),u.pmiReapply.setVisible((n||a)&&!nt&&!w&&!rt),u.pmiCondFormat.setVisible(!nt&&!w),u.mnuGroupPivot.setVisible(n&&!nt&&!w&&rt),u.mnuUnGroupPivot.setVisible(n&&!nt&&!w&&rt),u.ssMenu.items[12].setVisible((n||a||st)&&!nt),u.pmiInsFunction.setVisible(n&&!nt&&!rt),u.pmiAddNamedRange.setVisible(n&&!nt&&!y),at&&(u.pmiInsertTable.menu.items[0].setDisabled(!ot.asc_getIsInsertRowAbove()),u.pmiInsertTable.menu.items[1].setDisabled(!ot.asc_getIsInsertRowBelow()),u.pmiInsertTable.menu.items[2].setDisabled(!ot.asc_getIsInsertColumnLeft()),u.pmiInsertTable.menu.items[3].setDisabled(!ot.asc_getIsInsertColumnRight()),u.pmiDeleteTable.menu.items[0].setDisabled(!ot.asc_getIsDeleteRow()),u.pmiDeleteTable.menu.items[1].setDisabled(!ot.asc_getIsDeleteColumn()),u.pmiDeleteTable.menu.items[2].setDisabled(!ot.asc_getIsDeleteTable()));et=t.asc_getHyperlink();u.menuHyperlink.setVisible(n&&et&&!nt&&!lt&&!w&&!rt),u.menuAddHyperlink.setVisible(n&&!et&&!nt&&!lt&&!w&&!rt),u.pmiRowHeight.setVisible(o||a),u.pmiColumnWidth.setVisible(s||a),u.pmiEntireHide.setVisible(s||o),u.pmiEntireShow.setVisible(s||o),u.pmiFreezePanes.setVisible(!nt),u.pmiFreezePanes.setCaption(this.api.asc_getSheetViewSettings().asc_getIsFreezePane()?u.textUnFreezePanes:u.textFreezePanes);var ct=t.asc_getComments();u.ssMenu.items[19].setVisible(n&&!nt&&this.permissions.canCoAuthoring&&this.permissions.canComments&&ct&&ct.length<1),u.pmiAddComment.setVisible(n&&!nt&&this.permissions.canCoAuthoring&&this.permissions.canComments&&ct&&ct.length<1),u.pmiCellMenuSeparator.setVisible(n&&!nt||o||s||a),u.pmiEntireHide.isrowmenu=o,u.pmiEntireShow.isrowmenu=o,x&&x.blockPopover(!0),u.pmiClear.menu.items[0].setDisabled(!this.permissions.canModifyFilter),u.pmiClear.menu.items[1].setDisabled(nt),u.pmiClear.menu.items[2].setDisabled(nt||!this.permissions.canModifyFilter),u.pmiClear.menu.items[3].setDisabled(nt),u.pmiClear.menu.items[4].setDisabled(nt),u.pmiClear.menu.items[3].setVisible(!this.permissions.isEditDiagram),u.pmiClear.menu.items[4].setVisible(!this.permissions.isEditDiagram);var dt=t.asc_getAutoFilterInfo(),ht=!!dt&&dt.asc_getIsApplyAutoFilter();if(dt=dt?dt.asc_getIsAutoFilter():null,u.pmiInsertCells.menu.items[0].setDisabled(ht),u.pmiDeleteCells.menu.items[0].setDisabled(ht),u.pmiInsertCells.menu.items[1].setDisabled(ht),u.pmiDeleteCells.menu.items[1].setDisabled(ht),u.pmiEntriesList.setVisible(!nt&&!rt),u.pmiNumFormat.setVisible(!nt),u.pmiAdvancedNumFormat.options.numformatinfo=u.pmiNumFormat.menu.options.numformatinfo=S.asc_getNumFormatInfo(),u.pmiAdvancedNumFormat.options.numformat=S.asc_getNumFormat(),u.pmiGetRangeList.setVisible(!Common.Utils.isIE&&n&&!nt&&!lt&&!y&&this.permissions.canMakeActionLink&&!!navigator.clipboard),_.each(u.ssMenu.items,(function(t){t.setDisabled(f)})),u.pmiCopy.setDisabled(!1),u.pmiSelectTable.setDisabled(this._state.wsLock),u.pmiInsertEntire.setDisabled(f||b||o&&this._state.wsProps.InsertRows||s&&this._state.wsProps.InsertColumns),u.pmiInsertCells.setDisabled(f||b||rt||this._state.wsLock),u.pmiInsertTable.setDisabled(f||b||this._state.wsLock),u.pmiDeleteEntire.setDisabled(f||b||o&&this._state.wsProps.DeleteRows||s&&this._state.wsProps.DeleteColumns),u.pmiDeleteCells.setDisabled(f||b||rt||this._state.wsLock),u.pmiDeleteTable.setDisabled(f||b||this._state.wsLock),u.pmiClear.setDisabled(f||rt),u.pmiFilterCells.setDisabled(f||b||null==dt||rt||!dt&&!this.permissions.canModifyFilter||this._state.wsLock),u.pmiSortCells.setDisabled(f||b||null==dt||rt||!this.permissions.canModifyFilter||this._state.wsProps.Sort),u.pmiReapply.setDisabled(f||b||!0!==ht),u.pmiCondFormat.setDisabled(f||b||this._state.wsProps.FormatCells),u.menuHyperlink.setDisabled(f||rt||this._state.wsProps.InsertHyperlinks),u.menuAddHyperlink.setDisabled(f||rt||this._state.wsProps.InsertHyperlinks),u.pmiInsFunction.setDisabled(f||rt),u.pmiFreezePanes.setDisabled(this.api.asc_isWorksheetLockedOrDeleted(this.api.asc_getActiveWorksheetIndex())),u.pmiRowHeight.setDisabled(f||this._state.wsProps.FormatRows),u.pmiColumnWidth.setDisabled(f||this._state.wsProps.FormatColumns),u.pmiEntireHide.setDisabled(f||s&&this._state.wsProps.FormatColumns||o&&this._state.wsProps.FormatRows),u.pmiEntireShow.setDisabled(f||s&&this._state.wsProps.FormatColumns||o&&this._state.wsProps.FormatRows),u.pmiNumFormat.setDisabled(f||this._state.wsProps.FormatCells),u.pmiSparklines.setDisabled(f||this._state.wsLock),u.pmiEntriesList.setDisabled(f||this._state.wsLock),u.pmiAddNamedRange.setDisabled(f||this._state.wsLock),u.pmiAddComment.setDisabled(f||this._state.wsProps.Objects),u.pmiGetRangeList.setDisabled(!1),rt){var pt=this.api.asc_canGroupPivot();u.mnuGroupPivot.setDisabled(C||!pt||this._state.wsLock),u.mnuUnGroupPivot.setDisabled(C||!pt||this._state.wsLock)}e&&this.showPopupMenu(u.ssMenu,{},i),u.pmiFunctionSeparator.setVisible(u.pmiInsFunction.isVisible()||u.menuAddHyperlink.isVisible()||u.menuHyperlink.isVisible()||o||s||a),u.pmiFreezeSeparator.setVisible(u.pmiFreezePanes.isVisible())}else if(this.permissions.isEditDiagram&&g==Asc.c_oAscSelectionType.RangeChartText){if(!e&&!u.textInShapeMenu.isVisible())return;u.pmiTextAdvanced.textInfo=void 0,u.menuHyperlinkShape.setVisible(!1),u.menuAddHyperlinkShape.setVisible(!1),u.menuParagraphVAlign.setVisible(!1),u.menuParagraphDirection.setVisible(!1),u.pmiTextAdvanced.setVisible(!1),u.textInShapeMenu.items[9].setVisible(!1),u.menuParagraphBullets.setVisible(!1),u.textInShapeMenu.items[3].setVisible(!1),u.pmiTextCopy.setDisabled(!1),e&&this.showPopupMenu(u.textInShapeMenu,{},i)}},fillViewMenuProps:function(t,e,i){var n,o=this.documentHolder,s=t.asc_getSelectionType(),a=t.asc_getLocked(),l=!0===t.asc_getLockedTable(),r=this.getApplication().getController("Common.Controllers.Comments"),c=s==Asc.c_oAscSelectionType.RangeCells&&!this.permissions.isEditMailMerge&&!this.permissions.isEditDiagram&&!this.permissions.isEditOle,d=this.api.isCellEdited,h=!(s!=Asc.c_oAscSelectionType.RangeShape&&s!=Asc.c_oAscSelectionType.RangeImage||this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle);if(o.viewModeMenu||o.createDelayedElementsViewer(),e||o.viewModeMenu.isVisible()){if(h&&this.permissions.isSignatureSupport)for(var p=this.api.asc_getGraphicObjectProps(),m=0;m<p.length;m++)p[m].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&(n=p[m].asc_getObjectValue().asc_getSignatureId());var u=n?this.api.asc_getSignatureSetup(n):null,g=!!u&&this._canProtect,f=c&&!d&&this.permissions.canCoAuthoring&&this.permissions.canComments&&!this._isDisabled&&t.asc_getComments()&&t.asc_getComments().length<1;o.menuViewUndo.setVisible(this.permissions.canCoAuthoring&&this.permissions.canComments&&!this._isDisabled),o.menuViewUndo.setDisabled(!this.api.asc_getCanUndo()),o.menuViewCopySeparator.setVisible(g);var b=!!u&&u.asc_getRequested();o.menuSignatureViewSign.setVisible(g&&b),o.menuSignatureDetails.setVisible(g&&!b),o.menuSignatureViewSetup.setVisible(g),o.menuSignatureRemove.setVisible(g&&!b),o.menuViewSignSeparator.setVisible(f),o.menuViewAddComment.setVisible(f),r&&r.blockPopover(!0),o.menuViewAddComment.setDisabled(a||l||this._state.wsProps.Objects),e&&this.showPopupMenu(o.viewModeMenu,{},i),g&&(o.menuSignatureViewSign.cmpEl.attr("data-value",n),o.menuSignatureDetails.cmpEl.attr("data-value",u.asc_getId()),o.menuSignatureViewSetup.cmpEl.attr("data-value",n),o.menuSignatureRemove.cmpEl.attr("data-value",n))}},showPopupMenu:function(t,e,i){if(!_.isUndefined(t)&&null!==t&&i){Common.UI.Menu.Manager.hideAll();var n=this,o=n.documentHolder,s=[i.pageX*Common.Utils.zoom()-o.cmpEl.offset().left,i.pageY*Common.Utils.zoom()-o.cmpEl.offset().top],a=o.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",t.id));if(t.rendered||(a.length<1&&(a=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',t.id)),o.cmpEl.append(a)),t.render(a),t.cmpEl.attr({tabindex:"-1"})),2!==i.button){var l=n.api.asc_getActiveCellCoord(),r={left:0,top:0};s[0]=l.asc_getX()+l.asc_getWidth()+r.left,s[1]=(l.asc_getY()<0?0:l.asc_getY())+l.asc_getHeight()+r.top}a.css({left:s[0],top:s[1]}),_.isFunction(t.options.initMenu)&&(t.options.initMenu(e),t.alignPosition()),_.delay((function(){t.cmpEl.focus()}),10),t.show(),n.currentMenu=t}},onEntriesListMenu:function(t,e,i){if(e&&e.length>0){var n=this,o=n.documentHolder,s=o.entriesMenu,a=o.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",s.id));if(t&&s.isVisible())return void s.hide();for(var l=0;l<s.items.length;l++)s.removeItem(s.items[l]),l--;_.each(e,(function(t,e){var o=new Common.UI.MenuItem({caption:t,value:i?i[e]:t,style:"string"==typeof t&&_.isEmpty(t.trim())?"min-height: 25px;":""}).on("click",(function(t,e){n.api.asc_insertInCell(t.value,Asc.c_oAscPopUpSelectorType.None,!1)}));s.addItem(o)})),Common.UI.Menu.Manager.hideAll(),s.rendered||(a.length<1&&(a=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',s.id)),o.cmpEl.append(a)),s.render(a),s.cmpEl.attr({tabindex:"-1"}));var r=n.api.asc_getActiveCellCoord(t),c={left:0,top:0},d=[r.asc_getX()+c.left+(t?r.asc_getWidth():0),(r.asc_getY()<0?0:r.asc_getY())+r.asc_getHeight()+c.top];a.css({left:d[0],top:d[1]}),s.menuAlign=t?"tr-br":"tl-bl",n._preventClick=t,t&&a.attr("data-value","prevent-canvas-click"),s.show(),s.alignPosition(),_.delay((function(){s.cmpEl.focus()}),10)}else this.documentHolder.entriesMenu.hide(),!t&&Common.UI.warning({title:this.notcriticalErrorTitle,maxwidth:600,msg:this.txtNoChoices,callback:_.bind((function(t){Common.NotificationCenter.trigger("edit:complete",this.documentHolder)}),this)})},onTableTotalMenu:function(t){if(void 0!==t){var e=this,i=e.documentHolder,n=i.tableTotalMenu,o=i.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",n.id));if(n.isVisible())return void n.hide();Common.UI.Menu.Manager.hideAll(),n.rendered||(o.length<1&&(o=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',n.id)),i.cmpEl.append(o)),n.render(o),n.cmpEl.attr({tabindex:"-1"})),n.clearAll();var s=_.find(n.items,(function(e){return e.value==t}));s&&s.setChecked(!0,!0);var a=e.api.asc_getActiveCellCoord(),l={left:0,top:0},r=[a.asc_getX()+l.left+a.asc_getWidth(),(a.asc_getY()<0?0:a.asc_getY())+a.asc_getHeight()+l.top];o.css({left:r[0],top:r[1]}),e._preventClick=!0,o.attr("data-value","prevent-canvas-click"),n.show(),n.alignPosition(),_.delay((function(){n.cmpEl.focus()}),10)}else this.documentHolder.tableTotalMenu.hide()},onTotalMenuClick:function(t,e){e.value==Asc.ETotalsRowFunction.totalrowfunctionCustom?this.onInsFunction(e):this.api.asc_insertInCell(e.value,Asc.c_oAscPopUpSelectorType.TotalRowFunc),Common.NotificationCenter.trigger("edit:complete",this.documentHolder)},onFormulaCompleteMenu:function(t,e){if(this.documentHolder.funcMenu&&!Common.Utils.ModalWindow.isVisible()&&!this.rangeSelectionMode)if(t){for(var i=this,n=i.documentHolder,o=n.funcMenu,s=n.cmpEl.find("#menu-formula-selection"),a=i.getApplication().getController("FormulaDialog").getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")),l=0;l<o.items.length;l++){var r=o.items[l].cmpEl.data("bs.tooltip");r&&r.hide(),o.removeItem(o.items[l]),l--}t.sort((function(t,e){var i=t.asc_getType(),n=e.asc_getType();if(i===n&&i===Asc.c_oAscPopUpSelectorType.TableColumnName)return 0;if(i===Asc.c_oAscPopUpSelectorType.TableThisRow)return-1;if(n===Asc.c_oAscPopUpSelectorType.TableThisRow)return 1;if((i===Asc.c_oAscPopUpSelectorType.TableColumnName||n===Asc.c_oAscPopUpSelectorType.TableColumnName)&&i!==n)return i===Asc.c_oAscPopUpSelectorType.TableColumnName?-1:1;var o=t.asc_getName(!0).toLocaleUpperCase(),s=e.asc_getName(!0).toLocaleUpperCase();return o<s?-1:o>s?1:0})),_.each(t,(function(t,e){var n=t.asc_getType(),s=t.asc_getName(!0),l=i.api.asc_getFormulaNameByLocale(s),r="",c=s,d="";switch(n){case Asc.c_oAscPopUpSelectorType.Func:r="menu__icon btn-function",d=a&&a[l]?a[l].d:"";break;case Asc.c_oAscPopUpSelectorType.Table:r="menu__icon btn-menu-table";break;case Asc.c_oAscPopUpSelectorType.Slicer:r="menu__icon btn-slicer";break;case Asc.c_oAscPopUpSelectorType.Range:r="menu__icon btn-named-range";break;case Asc.c_oAscPopUpSelectorType.TableColumnName:c="(...) "+s;break;case Asc.c_oAscPopUpSelectorType.TableThisRow:d=i.txtThisRowHint;break;case Asc.c_oAscPopUpSelectorType.TableAll:d=i.txtAllTableHint;break;case Asc.c_oAscPopUpSelectorType.TableData:d=i.txtDataTableHint;break;case Asc.c_oAscPopUpSelectorType.TableHeaders:d=i.txtHeadersTableHint;break;case Asc.c_oAscPopUpSelectorType.TableTotals:d=i.txtTotalsTableHint}var h=new Common.UI.MenuItem({iconCls:r,caption:c,name:s,hint:d}).on("click",(function(t,e){setTimeout((function(){i.api.asc_insertInCell(t.options.name,n,!1)}),10)}));o.addItem(h)})),o.rendered||(s.length<1&&(s=$(Common.Utils.String.format('<div id="menu-formula-selection" style="position: absolute; z-index: 10000;" class="no-stop-propagate"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>')),n.cmpEl.append(s)),o.onAfterKeydownMenu=function(t){if(t.keyCode!=Common.UI.Keys.RETURN||!t.ctrlKey&&!t.altKey){var e;if(arguments.length>1&&arguments[1]instanceof KeyboardEvent&&(t=arguments[1]),s.hasClass("open"))if(t.keyCode==Common.UI.Keys.TAB||t.keyCode==Common.UI.Keys.RETURN&&!t.ctrlKey&&!t.altKey)e=s.find("a.focus").closest("li");else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN){var i,n=o.cmpEl,a=s.find("a.focus").closest("li"),l=n.innerHeight(),r=(l-n.height())/2,c=a.position().top,d=a.outerHeight();c<0?i=n.scrollTop()+c-r:c+d>l&&(i=n.scrollTop()+c+d-l+r),void 0!==i&&(o.scroller?o.scroller.scrollTop(i,0):n.scrollTop(i))}e&&(e.length>0&&e.click(),Common.UI.Menu.Manager.hideAll())}},o.on("hide:after",(function(){for(var t=0;t<o.items.length;t++){var e=o.items[t].cmpEl.data("bs.tooltip");e&&e.hide()}})),o.render(s),o.cmpEl.attr({tabindex:"-1"}));var c=i.cellEditor.is(":focus");if(c)o.menuAlignEl=i.cellEditor,i.focusInCellEditor=!0;else{o.menuAlignEl=void 0,i.focusInCellEditor=!1;var d=i.api.asc_getActiveCellCoord(),h=[d.asc_getX()+(e?e[0]:0),(d.asc_getY()<0?0:d.asc_getY())+d.asc_getHeight()+(e?e[1]:0)];s.css({left:h[0],top:h[1]})}o.alignPosition(),o.isVisible()||Common.UI.Menu.Manager.hideAll(),_.delay((function(){o.isVisible()||o.show(),o.scroller&&(o.scroller.update({alwaysVisibleY:!0}),o.scroller.scrollTop(0)),c&&i.cellEditor.focus(),o.cmpEl.toggleClass("from-cell-edit",c),_.delay((function(){var t=o.cmpEl.find("li:first a");t.addClass("focus");var e=t.parent().data("bs.tooltip");e&&e.show()}),10),c||_.delay((function(){o.cmpEl.focus()}),10)}),1)}else this.documentHolder.funcMenu.hide()},onFormulaInfo:function(t){var e=this.tooltips.func_arg;if(t){e.parentEl||(e.parentEl=$('<div id="tip-container-functip" style="position: absolute; z-index: 10000;"></div>'),this.documentHolder.cmpEl.append(e.parentEl));var i,n=this.getApplication().getController("FormulaDialog").getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")),o=(n&&n[t]?this.api.asc_getFormulaLocaleName(t)+n[t].a:"").replace(/[,;]/g,this.api.asc_getFunctionArgumentSeparator());if(e.ref&&e.ref.isVisible()&&e.text!=o&&(e.ref.hide(),e.ref=void 0,e.text="",e.isHidden=!0),!o)return;if(e.ref&&e.ref.isVisible()||(e.text=o,e.ref=new Common.UI.Tooltip({owner:e.parentEl,html:!0,title:o,cls:"auto-tooltip"}),e.ref.show([-1e4,-1e4]),e.isHidden=!1),this.cellEditor.is(":focus")||this.focusInCellEditor){var s=this.cellEditor.offset();i=[s.left,s.top+this.cellEditor.height()+3]}else{var a=[this.documentHolder.cmpEl.offset().left-$(window).scrollLeft(),this.documentHolder.cmpEl.offset().top-$(window).scrollTop()],l=this.api.asc_getActiveCellCoord();i=[l.asc_getX()+a[0]-3,l.asc_getY()+a[1]-e.ref.getBSTip().$tip.height()-5]}var r=e.ref.getBSTip().$tip.width();i[0]+r>this.tooltips.coauth.bodyWidth&&(i[0]=this.tooltips.coauth.bodyWidth-r),e.ref.getBSTip().$tip.css({top:i[1]+"px",left:i[0]+"px"})}else!e.isHidden&&e.ref&&(e.ref.hide(),e.ref=void 0,e.text="",e.isHidden=!0)},changeInputMessagePosition:function(t){var e=[this.documentHolder.cmpEl.offset().left-$(window).scrollLeft(),this.documentHolder.cmpEl.offset().top-$(window).scrollTop()],i=this.api.asc_getActiveCellCoord(),n=[i.asc_getX()+e[0]-3,i.asc_getY()+e[1]-t.ref.getBSTip().$tip.height()-5],o=t.ref.getBSTip().$tip.width();n[0]+o>this.tooltips.coauth.bodyWidth&&(n[0]=this.tooltips.coauth.bodyWidth-o),n[1]<e[1]&&(n[1]=e[1]+i.asc_getY()+i.asc_getHeight()+5),t.ref.getBSTip().$tip.css({top:n[1]+"px",left:n[0]+"px","z-index":900})},onInputMessage:function(t,e){var i=this.tooltips.input_msg;if(e){i.parentEl||(i.parentEl=$('<div id="tip-container-inputtip" style="position: absolute; z-index: 10000;"></div>'),this.documentHolder.cmpEl.append(i.parentEl));var n=t?"<b>"+Common.Utils.String.htmlEncode(t||"")+"</b><br>":"";if(n+=Common.Utils.String.htmlEncode(e||""),i.ref&&i.ref.isVisible()&&i.text!=n&&(i.ref.hide(),i.ref=void 0,i.text="",i.isHidden=!0),!i.ref||!i.ref.isVisible())i.text=n,i.ref=new Common.UI.Tooltip({owner:i.parentEl,html:!0,title:n,keepvisible:!0}),i.ref.show([-1e4,-1e4]),i.ref.getBSTip().$tip.on("click",(function(){i.ref.hide(),i.ref=void 0,i.text="",i.isHidden=!0})),i.isHidden=!1;this.changeInputMessagePosition(i)}else!i.isHidden&&i.ref&&(i.ref.hide(),i.ref=void 0,i.text="",i.isHidden=!0)},onShowSpecialPasteOptions:function(t){var e=this,i=e.documentHolder,n=t.asc_getCellCoord(),o=i.cmpEl.find("#special-paste-container"),s=t.asc_getOptions(),a=!!t.asc_getContainTables();if(s){if(o.length<1&&(e._arrSpecialPaste=[],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.paste]=[e.txtPaste,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.pasteOnlyFormula]=[e.txtPasteFormulas,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.formulaNumberFormat]=[e.txtPasteFormulaNumFormat,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.formulaAllFormatting]=[e.txtPasteKeepSourceFormat,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.formulaWithoutBorders]=[e.txtPasteBorders,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.formulaColumnWidth]=[e.txtPasteColWidths,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.mergeConditionalFormating]=[e.txtPasteMerge,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.transpose]=[e.txtPasteTranspose,0],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.pasteOnlyValues]=[e.txtPasteValues,1],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.valueNumberFormat]=[e.txtPasteValNumFormat,1],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.valueAllFormating]=[e.txtPasteValFormat,1],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.pasteOnlyFormating]=[e.txtPasteFormat,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.link]=[e.txtPasteLink,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.picture]=[e.txtPastePicture,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.linkedPicture]=[e.txtPasteLinkPicture,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.sourceformatting]=[e.txtPasteSourceFormat,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.destinationFormatting]=[e.txtPasteDestFormat,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.keepTextOnly]=[e.txtKeepTextOnly,2],e._arrSpecialPaste[Asc.c_oSpecialPasteProps.useTextImport]=[e.txtUseTextImport,3],o=$('<div id="special-paste-container" style="position: absolute;"><div id="id-document-holder-btn-special-paste"></div></div>'),i.cmpEl.find("#ws-canvas-outer").append(o),e.btnSpecialPaste=new Common.UI.Button({parentEl:$("#id-document-holder-btn-special-paste"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-paste",caption:Common.Utils.String.platformKey("Ctrl","({0})"),menu:new Common.UI.Menu({items:[]})}),e.initSpecialPasteEvents()),s.length>0){for(var l=e.btnSpecialPaste.menu,r=0;r<l.items.length;r++)l.removeItem(l.items[r]),r--;var c,d=[];for(r=0;r<3;r++)d[r]=[];_.each(s,(function(t,i){if(t==Asc.c_oSpecialPasteProps.useTextImport)c=new Common.UI.MenuItem({caption:e._arrSpecialPaste[t][0]+(e.hkSpecPaste[t]?" ("+e.hkSpecPaste[t]+")":""),value:t,checkable:!0,toggleGroup:"specialPasteGroup"}).on("click",_.bind(e.onSpecialPasteItemClick,e)),e._arrSpecialPaste[t][2]=c;else if(e._arrSpecialPaste[t]){var n=new Common.UI.MenuItem({caption:e._arrSpecialPaste[t][0]+(e.hkSpecPaste[t]?" ("+e.hkSpecPaste[t]+")":""),value:t,checkable:!0,toggleGroup:"specialPasteGroup"}).on("click",_.bind(e.onSpecialPasteItemClick,e));d[e._arrSpecialPaste[t][1]].push(n),e._arrSpecialPaste[t][2]=n}}));var h=!1;for(r=0;r<3;r++)h&&d[r].length>0&&(l.addItem(new Common.UI.MenuItem({caption:"--"})),h=!1),_.each(d[r],(function(t,e){l.addItem(t),h=!0}));if(l.items.length>0&&l.items[0].setChecked(!0,!0),e._state.lastSpecPasteChecked=l.items.length>0?l.items[0]:null,c&&(l.addItem(new Common.UI.MenuItem({caption:"--"})),l.addItem(c)),l.items.length>0&&t.asc_getShowPasteSpecial()){l.addItem(new Common.UI.MenuItem({caption:"--"}));var p=new Common.UI.MenuItem({caption:e.textPasteSpecial,value:"special"}).on("click",(function(t,i){new SSE.Views.SpecialPasteDialog({props:s,isTable:a,handler:function(t,i){"ok"==t&&(e._state.lastSpecPasteChecked&&e._state.lastSpecPasteChecked.setChecked(!1,!0),e._state.lastSpecPasteChecked=i&&e._arrSpecialPaste[i.asc_getProps()]?e._arrSpecialPaste[i.asc_getProps()][2]:null,e._state.lastSpecPasteChecked&&e._state.lastSpecPasteChecked.setChecked(!0,!0),e&&e.api&&e.api.asc_SpecialPaste(i))}}).show(),setTimeout((function(){l.hide()}),100)}));l.addItem(p)}}if(n[0].asc_getX()<0||n[0].asc_getY()<0)return o.is(":visible")&&o.hide(),void $(document).off("keyup",this.wrapEvents.onKeyUp);var m=n[0],u=n[1],g=e.tooltips.coauth.bodyWidth-e.tooltips.coauth.XY[0]-e.tooltips.coauth.rightMenuWidth-15,f=e.tooltips.coauth.apiHeight-15,b=[],C=[31,20],v=m.asc_getX()+m.asc_getWidth()+3+C[0],x=m.asc_getY()+m.asc_getHeight()+3+C[1];v>g?(b[0]=void 0!==u?u.asc_getX():g-C[0]-3,x>f&&(b[0]-=C[0]+3),b[0]<0&&(b[0]=g-3-C[0])):b[0]=v-C[0],b[1]=x>f?f-3-C[1]:x-C[1],o.css({left:b[0],top:b[1]}),o.show(),setTimeout((function(){$(document).on("keyup",e.wrapEvents.onKeyUp)}),10)}},onHideSpecialPasteOptions:function(){var t=this.documentHolder.cmpEl.find("#special-paste-container");t.is(":visible")&&(t.hide(),$(document).off("keyup",this.wrapEvents.onKeyUp))},onSpecialPasteItemClick:function(t,e){var i=this,n=this.btnSpecialPaste.menu;if(t.value==Asc.c_oSpecialPasteProps.useTextImport)new Common.Views.OpenDialog({title:i.txtImportWizard,closable:!0,type:Common.Utils.importTextType.Paste,preview:!0,api:i.api,handler:function(e,n){if("ok"==e){if(i&&i.api){var o=new Asc.SpecialPasteProps;o.asc_setProps(Asc.c_oSpecialPasteProps.useTextImport),o.asc_setAdvancedOptions(n.textOptions),i.api.asc_SpecialPaste(o)}i._state.lastSpecPasteChecked=t}else t.cmpEl&&(t.setChecked(!1,!0),i._state.lastSpecPasteChecked&&i._state.lastSpecPasteChecked.setChecked(!0,!0))}}).show(),setTimeout((function(){n.hide()}),100);else{i._state.lastSpecPasteChecked=t;var o=new Asc.SpecialPasteProps;o.asc_setProps(t.value),i.api.asc_SpecialPaste(o),setTimeout((function(){n.hide()}),100)}if(!t.cmpEl&&i._state.lastSpecPasteChecked)for(var s=0;s<n.items.length;s++)n.items[s].setChecked(n.items[s].value===i._state.lastSpecPasteChecked.value,!0),n.items[s].value===i._state.lastSpecPasteChecked.value&&(i._state.lastSpecPasteChecked=n.items[s]);return!1},onKeyUp:function(t){t.keyCode==Common.UI.Keys.CTRL&&this._needShowSpecPasteMenu&&!this.btnSpecialPaste.menu.isVisible()&&/area_id/.test(t.target.id)&&($("button",this.btnSpecialPaste.cmpEl).click(),t.preventDefault()),this._needShowSpecPasteMenu=!1},initSpecialPasteEvents:function(){var t=this;t.hkSpecPaste=[],t.hkSpecPaste[Asc.c_oSpecialPasteProps.paste]="P",t.hkSpecPaste[Asc.c_oSpecialPasteProps.pasteOnlyFormula]="F",t.hkSpecPaste[Asc.c_oSpecialPasteProps.formulaNumberFormat]="O",t.hkSpecPaste[Asc.c_oSpecialPasteProps.formulaAllFormatting]="K",t.hkSpecPaste[Asc.c_oSpecialPasteProps.formulaWithoutBorders]="B",t.hkSpecPaste[Asc.c_oSpecialPasteProps.formulaColumnWidth]="W",t.hkSpecPaste[Asc.c_oSpecialPasteProps.mergeConditionalFormating]="G",t.hkSpecPaste[Asc.c_oSpecialPasteProps.transpose]="T",t.hkSpecPaste[Asc.c_oSpecialPasteProps.pasteOnlyValues]="V",t.hkSpecPaste[Asc.c_oSpecialPasteProps.valueNumberFormat]="A",t.hkSpecPaste[Asc.c_oSpecialPasteProps.valueAllFormating]="E",t.hkSpecPaste[Asc.c_oSpecialPasteProps.pasteOnlyFormating]="R",t.hkSpecPaste[Asc.c_oSpecialPasteProps.link]="N",t.hkSpecPaste[Asc.c_oSpecialPasteProps.picture]="U",t.hkSpecPaste[Asc.c_oSpecialPasteProps.linkedPicture]="I",t.hkSpecPaste[Asc.c_oSpecialPasteProps.sourceformatting]="K",t.hkSpecPaste[Asc.c_oSpecialPasteProps.destinationFormatting]="M",t.hkSpecPaste[Asc.c_oSpecialPasteProps.keepTextOnly]="T";var e="";for(var i in t.hkSpecPaste)t.hkSpecPaste.hasOwnProperty(i)&&e.indexOf(t.hkSpecPaste[i])<0&&(e+=t.hkSpecPaste[i]+",");var n={};n[e=e.substring(0,e.length-1)]=_.bind((function(e){for(var i=this.btnSpecialPaste.menu,n=0;n<i.items.length;n++)if(this.hkSpecPaste[i.items[n].value]===String.fromCharCode(e.keyCode))return t.onSpecialPasteItemClick({value:i.items[n].value})}),t),Common.util.Shortcuts.delegateShortcuts({shortcuts:n}),Common.util.Shortcuts.suspendEvents(e,void 0,!0),t.btnSpecialPaste.menu.on("show:after",(function(t){Common.util.Shortcuts.resumeEvents(e)})).on("hide:after",(function(t){Common.util.Shortcuts.suspendEvents(e,void 0,!0)}))},onToggleAutoCorrectOptions:function(t){if(t){var e=this,i=e.documentHolder,n=t.asc_getCellCoord(),o=(m=i.cmpEl.find("#autocorrect-paste-container"),t.asc_getOptions());if(m.length<1&&(e._arrAutoCorrectPaste=[],e._arrAutoCorrectPaste[Asc.c_oAscAutoCorrectOptions.UndoTableAutoExpansion]={caption:e.txtUndoExpansion,icon:"menu__icon btn-undo"},e._arrAutoCorrectPaste[Asc.c_oAscAutoCorrectOptions.RedoTableAutoExpansion]={caption:e.txtRedoExpansion,icon:"menu__icon btn-redo"},m=$('<div id="autocorrect-paste-container" style="position: absolute;"><div id="id-document-holder-btn-autocorrect-paste"></div></div>'),i.cmpEl.append(m),e.btnAutoCorrectPaste=new Common.UI.Button({parentEl:$("#id-document-holder-btn-autocorrect-paste"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-autocorrect",menu:new Common.UI.Menu({cls:"shifted-right",items:[]})}),e.btnAutoCorrectPaste.menu.on("show:after",_.bind(e.onAutoCorrectOpenAfter,e))),o.length>0){for(var s=e.btnAutoCorrectPaste.menu,a=0;a<s.items.length;a++)s.removeItem(s.items[a]),a--;_.each(o,(function(t,i){var n=new Common.UI.MenuItem({caption:e._arrAutoCorrectPaste[t].caption,value:t,iconCls:e._arrAutoCorrectPaste[t].icon}).on("click",(function(t,i){e.api.asc_applyAutoCorrectOptions(t.value),setTimeout((function(){s.hide()}),100)}));s.addItem(n)})),e.mnuAutoCorrectStop=new Common.UI.MenuItem({caption:e.textStopExpand,checkable:!0,allowDepress:!0,checked:!Common.Utils.InternalSettings.get("sse-settings-autoformat-new-rows")}).on("click",(function(t){Common.localStorage.setBool("sse-settings-autoformat-new-rows",!t.checked),Common.Utils.InternalSettings.set("sse-settings-autoformat-new-rows",!t.checked),e.api.asc_setIncludeNewRowColTable(!t.checked),setTimeout((function(){s.hide()}),100)})),s.addItem(e.mnuAutoCorrectStop),s.addItem({caption:"--"});var l=new Common.UI.MenuItem({caption:e.textAutoCorrectSettings}).on("click",_.bind(e.onAutoCorrectOptions,e));s.addItem(l)}var r=e.tooltips.coauth.bodyWidth-e.tooltips.coauth.XY[0]-e.tooltips.coauth.rightMenuWidth-15,c=e.tooltips.coauth.apiHeight-15,d=[31,20],h=n.asc_getX()+n.asc_getWidth()+2+d[0],p=n.asc_getY()+n.asc_getHeight()+1+d[1];h>r||p>c||n.asc_getX()<0||n.asc_getY()<0?m.is(":visible")&&m.hide():(m.css({left:h-d[0],top:p-d[1]}),m.show())}else{var m;(m=this.documentHolder.cmpEl.find("#autocorrect-paste-container")).is(":visible")&&m.hide()}},onCellsRange:function(t){this.rangeSelectionMode=t!=Asc.c_oAscSelectionDialogType.None},onApiEditCell:function(t){this.isEditFormula=t==Asc.c_oAscCellEditorState.editFormula,this.isEditCell=t!=Asc.c_oAscCellEditorState.editEnd},onLockDefNameManager:function(t){this.namedrange_locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager},onChangeCropState:function(t){this.documentHolder.menuImgCrop.menu.items[0].setChecked(t,!0)},initEquationMenu:function(){if(this._currentMathObj){var t,e=this,i=e._currentMathObj.get_Type(),n=e._currentMathObj,o=[];switch(i){case Asc.c_oAscMathInterfaceType.Accent:t=new Common.UI.MenuItem({caption:e.txtRemoveAccentChar,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"remove_AccentCharacter"}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.BorderBox:t=new Common.UI.MenuItem({caption:e.txtBorderProps,equation:!0,disabled:e._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:n.get_HideTop()?e.txtAddTop:e.txtHideTop,equationProps:{type:i,callback:"put_HideTop",value:!n.get_HideTop()}},{caption:n.get_HideBottom()?e.txtAddBottom:e.txtHideBottom,equationProps:{type:i,callback:"put_HideBottom",value:!n.get_HideBottom()}},{caption:n.get_HideLeft()?e.txtAddLeft:e.txtHideLeft,equationProps:{type:i,callback:"put_HideLeft",value:!n.get_HideLeft()}},{caption:n.get_HideRight()?e.txtAddRight:e.txtHideRight,equationProps:{type:i,callback:"put_HideRight",value:!n.get_HideRight()}},{caption:n.get_HideHor()?e.txtAddHor:e.txtHideHor,equationProps:{type:i,callback:"put_HideHor",value:!n.get_HideHor()}},{caption:n.get_HideVer()?e.txtAddVer:e.txtHideVer,equationProps:{type:i,callback:"put_HideVer",value:!n.get_HideVer()}},{caption:n.get_HideTopLTR()?e.txtAddLT:e.txtHideLT,equationProps:{type:i,callback:"put_HideTopLTR",value:!n.get_HideTopLTR()}},{caption:n.get_HideTopRTL()?e.txtAddLB:e.txtHideLB,equationProps:{type:i,callback:"put_HideTopRTL",value:!n.get_HideTopRTL()}}]})}),o.push(t);break;case Asc.c_oAscMathInterfaceType.Bar:t=new Common.UI.MenuItem({caption:e.txtRemoveBar,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"remove_Bar"}}),o.push(t),t=new Common.UI.MenuItem({caption:n.get_Pos()==Asc.c_oAscMathInterfaceBarPos.Top?e.txtUnderbar:e.txtOverbar,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_Pos",value:n.get_Pos()==Asc.c_oAscMathInterfaceBarPos.Top?Asc.c_oAscMathInterfaceBarPos.Bottom:Asc.c_oAscMathInterfaceBarPos.Top}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.Script:var s=n.get_ScriptType();s==Asc.c_oAscMathInterfaceScript.PreSubSup?(t=new Common.UI.MenuItem({caption:e.txtScriptsAfter,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_ScriptType",value:Asc.c_oAscMathInterfaceScript.SubSup}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtRemScripts,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_ScriptType",value:Asc.c_oAscMathInterfaceScript.None}}),o.push(t)):(s==Asc.c_oAscMathInterfaceScript.SubSup&&(t=new Common.UI.MenuItem({caption:e.txtScriptsBefore,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_ScriptType",value:Asc.c_oAscMathInterfaceScript.PreSubSup}}),o.push(t)),s!=Asc.c_oAscMathInterfaceScript.SubSup&&s!=Asc.c_oAscMathInterfaceScript.Sub||(t=new Common.UI.MenuItem({caption:e.txtRemSubscript,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_ScriptType",value:s==Asc.c_oAscMathInterfaceScript.SubSup?Asc.c_oAscMathInterfaceScript.Sup:Asc.c_oAscMathInterfaceScript.None}}),o.push(t)),s!=Asc.c_oAscMathInterfaceScript.SubSup&&s!=Asc.c_oAscMathInterfaceScript.Sup||(t=new Common.UI.MenuItem({caption:e.txtRemSuperscript,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_ScriptType",value:s==Asc.c_oAscMathInterfaceScript.SubSup?Asc.c_oAscMathInterfaceScript.Sub:Asc.c_oAscMathInterfaceScript.None}}),o.push(t)));break;case Asc.c_oAscMathInterfaceType.Fraction:var a=n.get_FractionType();a!=Asc.c_oAscMathInterfaceFraction.Skewed&&a!=Asc.c_oAscMathInterfaceFraction.Linear||(t=new Common.UI.MenuItem({caption:e.txtFractionStacked,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_FractionType",value:Asc.c_oAscMathInterfaceFraction.Bar}}),o.push(t)),a!=Asc.c_oAscMathInterfaceFraction.Bar&&a!=Asc.c_oAscMathInterfaceFraction.Linear||(t=new Common.UI.MenuItem({caption:e.txtFractionSkewed,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_FractionType",value:Asc.c_oAscMathInterfaceFraction.Skewed}}),o.push(t)),a!=Asc.c_oAscMathInterfaceFraction.Bar&&a!=Asc.c_oAscMathInterfaceFraction.Skewed||(t=new Common.UI.MenuItem({caption:e.txtFractionLinear,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_FractionType",value:Asc.c_oAscMathInterfaceFraction.Linear}}),o.push(t)),a!=Asc.c_oAscMathInterfaceFraction.Bar&&a!=Asc.c_oAscMathInterfaceFraction.NoBar||(t=new Common.UI.MenuItem({caption:a==Asc.c_oAscMathInterfaceFraction.Bar?e.txtRemFractionBar:e.txtAddFractionBar,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_FractionType",value:a==Asc.c_oAscMathInterfaceFraction.Bar?Asc.c_oAscMathInterfaceFraction.NoBar:Asc.c_oAscMathInterfaceFraction.Bar}}),o.push(t));break;case Asc.c_oAscMathInterfaceType.Limit:t=new Common.UI.MenuItem({caption:n.get_Pos()==Asc.c_oAscMathInterfaceLimitPos.Top?e.txtLimitUnder:e.txtLimitOver,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_Pos",value:n.get_Pos()==Asc.c_oAscMathInterfaceLimitPos.Top?Asc.c_oAscMathInterfaceLimitPos.Bottom:Asc.c_oAscMathInterfaceLimitPos.Top}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtRemLimit,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_Pos",value:Asc.c_oAscMathInterfaceLimitPos.None}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.Matrix:t=new Common.UI.MenuItem({caption:n.get_HidePlaceholder()?e.txtShowPlaceholder:e.txtHidePlaceholder,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_HidePlaceholder",value:!n.get_HidePlaceholder()}}),o.push(t),t=new Common.UI.MenuItem({caption:e.insertText,equation:!0,disabled:e._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:e.insertRowAboveText,equationProps:{type:i,callback:"insert_MatrixRow",value:!0}},{caption:e.insertRowBelowText,equationProps:{type:i,callback:"insert_MatrixRow",value:!1}},{caption:e.insertColumnLeftText,equationProps:{type:i,callback:"insert_MatrixColumn",value:!0}},{caption:e.insertColumnRightText,equationProps:{type:i,callback:"insert_MatrixColumn",value:!1}}]})}),o.push(t),t=new Common.UI.MenuItem({caption:e.deleteText,equation:!0,disabled:e._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:e.deleteRowText,equationProps:{type:i,callback:"delete_MatrixRow"}},{caption:e.deleteColumnText,equationProps:{type:i,callback:"delete_MatrixColumn"}}]})}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtMatrixAlign,equation:!0,disabled:e._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:e.txtTop,checkable:!0,checked:n.get_MatrixAlign()==Asc.c_oAscMathInterfaceMatrixMatrixAlign.Top,equationProps:{type:i,callback:"put_MatrixAlign",value:Asc.c_oAscMathInterfaceMatrixMatrixAlign.Top}},{caption:e.centerText,checkable:!0,checked:n.get_MatrixAlign()==Asc.c_oAscMathInterfaceMatrixMatrixAlign.Center,equationProps:{type:i,callback:"put_MatrixAlign",value:Asc.c_oAscMathInterfaceMatrixMatrixAlign.Center}},{caption:e.txtBottom,checkable:!0,checked:n.get_MatrixAlign()==Asc.c_oAscMathInterfaceMatrixMatrixAlign.Bottom,equationProps:{type:i,callback:"put_MatrixAlign",value:Asc.c_oAscMathInterfaceMatrixMatrixAlign.Bottom}}]})}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtColumnAlign,equation:!0,disabled:e._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:e.leftText,checkable:!0,checked:n.get_ColumnAlign()==Asc.c_oAscMathInterfaceMatrixColumnAlign.Left,equationProps:{type:i,callback:"put_ColumnAlign",value:Asc.c_oAscMathInterfaceMatrixColumnAlign.Left}},{caption:e.centerText,checkable:!0,checked:n.get_ColumnAlign()==Asc.c_oAscMathInterfaceMatrixColumnAlign.Center,equationProps:{type:i,callback:"put_ColumnAlign",value:Asc.c_oAscMathInterfaceMatrixColumnAlign.Center}},{caption:e.rightText,checkable:!0,checked:n.get_ColumnAlign()==Asc.c_oAscMathInterfaceMatrixColumnAlign.Right,equationProps:{type:i,callback:"put_ColumnAlign",value:Asc.c_oAscMathInterfaceMatrixColumnAlign.Right}}]})}),o.push(t);break;case Asc.c_oAscMathInterfaceType.EqArray:t=new Common.UI.MenuItem({caption:e.txtInsertEqBefore,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"insert_Equation",value:!0}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtInsertEqAfter,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"insert_Equation",value:!1}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtDeleteEq,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"delete_Equation"}}),o.push(t),t=new Common.UI.MenuItem({caption:e.alignmentText,equation:!0,disabled:e._currentParaObjDisabled,menu:new Common.UI.Menu({cls:"shifted-right",menuAlign:"tl-tr",items:[{caption:e.txtTop,checkable:!0,checked:n.get_Align()==Asc.c_oAscMathInterfaceEqArrayAlign.Top,equationProps:{type:i,callback:"put_Align",value:Asc.c_oAscMathInterfaceEqArrayAlign.Top}},{caption:e.centerText,checkable:!0,checked:n.get_Align()==Asc.c_oAscMathInterfaceEqArrayAlign.Center,equationProps:{type:i,callback:"put_Align",value:Asc.c_oAscMathInterfaceEqArrayAlign.Center}},{caption:e.txtBottom,checkable:!0,checked:n.get_Align()==Asc.c_oAscMathInterfaceEqArrayAlign.Bottom,equationProps:{type:i,callback:"put_Align",value:Asc.c_oAscMathInterfaceEqArrayAlign.Bottom}}]})}),o.push(t);break;case Asc.c_oAscMathInterfaceType.LargeOperator:t=new Common.UI.MenuItem({caption:e.txtLimitChange,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_LimitLocation",value:n.get_LimitLocation()==Asc.c_oAscMathInterfaceNaryLimitLocation.UndOvr?Asc.c_oAscMathInterfaceNaryLimitLocation.SubSup:Asc.c_oAscMathInterfaceNaryLimitLocation.UndOvr}}),o.push(t),void 0!==n.get_HideUpper()&&(t=new Common.UI.MenuItem({caption:n.get_HideUpper()?e.txtShowTopLimit:e.txtHideTopLimit,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_HideUpper",value:!n.get_HideUpper()}}),o.push(t)),void 0!==n.get_HideLower()&&(t=new Common.UI.MenuItem({caption:n.get_HideLower()?e.txtShowBottomLimit:e.txtHideBottomLimit,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_HideLower",value:!n.get_HideLower()}}),o.push(t));break;case Asc.c_oAscMathInterfaceType.Delimiter:t=new Common.UI.MenuItem({caption:e.txtInsertArgBefore,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"insert_DelimiterArgument",value:!0}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtInsertArgAfter,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"insert_DelimiterArgument",value:!1}}),o.push(t),n.can_DeleteArgument()&&(t=new Common.UI.MenuItem({caption:e.txtDeleteArg,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"delete_DelimiterArgument"}}),o.push(t)),t=new Common.UI.MenuItem({caption:n.has_Separators()?e.txtDeleteCharsAndSeparators:e.txtDeleteChars,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"remove_DelimiterCharacters"}}),o.push(t),t=new Common.UI.MenuItem({caption:n.get_HideOpeningBracket()?e.txtShowOpenBracket:e.txtHideOpenBracket,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_HideOpeningBracket",value:!n.get_HideOpeningBracket()}}),o.push(t),t=new Common.UI.MenuItem({caption:n.get_HideClosingBracket()?e.txtShowCloseBracket:e.txtHideCloseBracket,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_HideClosingBracket",value:!n.get_HideClosingBracket()}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtStretchBrackets,equation:!0,disabled:e._currentParaObjDisabled,checkable:!0,checked:n.get_StretchBrackets(),equationProps:{type:i,callback:"put_StretchBrackets",value:!n.get_StretchBrackets()}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtMatchBrackets,equation:!0,disabled:!n.get_StretchBrackets()||e._currentParaObjDisabled,checkable:!0,checked:n.get_StretchBrackets()&&n.get_MatchBrackets(),equationProps:{type:i,callback:"put_MatchBrackets",value:!n.get_MatchBrackets()}}),o.push(t);break;case Asc.c_oAscMathInterfaceType.GroupChar:n.can_ChangePos()&&(t=new Common.UI.MenuItem({caption:n.get_Pos()==Asc.c_oAscMathInterfaceGroupCharPos.Top?e.txtGroupCharUnder:e.txtGroupCharOver,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_Pos",value:n.get_Pos()==Asc.c_oAscMathInterfaceGroupCharPos.Top?Asc.c_oAscMathInterfaceGroupCharPos.Bottom:Asc.c_oAscMathInterfaceGroupCharPos.Top}}),o.push(t),t=new Common.UI.MenuItem({caption:e.txtDeleteGroupChar,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_Pos",value:Asc.c_oAscMathInterfaceGroupCharPos.None}}),o.push(t));break;case Asc.c_oAscMathInterfaceType.Radical:void 0!==n.get_HideDegree()&&(t=new Common.UI.MenuItem({caption:n.get_HideDegree()?e.txtShowDegree:e.txtHideDegree,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"put_HideDegree",value:!n.get_HideDegree()}}),o.push(t)),t=new Common.UI.MenuItem({caption:e.txtDeleteRadical,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"remove_Radical"}}),o.push(t)}return n.can_IncreaseArgumentSize()&&(t=new Common.UI.MenuItem({caption:e.txtIncreaseArg,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"increase_ArgumentSize"}}),o.push(t)),n.can_DecreaseArgumentSize()&&(t=new Common.UI.MenuItem({caption:e.txtDecreaseArg,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"decrease_ArgumentSize"}}),o.push(t)),n.can_InsertManualBreak()&&(t=new Common.UI.MenuItem({caption:e.txtInsertBreak,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"insert_ManualBreak"}}),o.push(t)),n.can_DeleteManualBreak()&&(t=new Common.UI.MenuItem({caption:e.txtDeleteBreak,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"delete_ManualBreak"}}),o.push(t)),n.can_AlignToCharacter()&&(t=new Common.UI.MenuItem({caption:e.txtAlignToChar,equation:!0,disabled:e._currentParaObjDisabled,equationProps:{type:i,callback:"align_ToCharacter"}}),o.push(t)),o}},addEquationMenu:function(t){var e=this;e.clearEquationMenu(t);var i=e.documentHolder.textInShapeMenu,n=e.initEquationMenu();return n.length>0&&_.each(n,(function(n,o){n.menu?_.each(n.menu.items,(function(t){t.on("click",_.bind(e.equationCallback,e,t.options.equationProps))})):n.on("click",_.bind(e.equationCallback,e,n.options.equationProps)),i.insertItem(t,n),t++})),n.length},clearEquationMenu:function(t){for(var e=this.documentHolder.textInShapeMenu,i=t;i<e.items.length&&e.items[i].options.equation;i++)e.items[i].menu?_.each(e.items[i].menu.items,(function(t){t.off("click")})):e.items[i].off("click"),e.removeItem(e.items[i]),i--},equationCallback:function(t){if(t){var e;switch(t.type){case Asc.c_oAscMathInterfaceType.Accent:e=new CMathMenuAccent;break;case Asc.c_oAscMathInterfaceType.BorderBox:e=new CMathMenuBorderBox;break;case Asc.c_oAscMathInterfaceType.Box:e=new CMathMenuBox;break;case Asc.c_oAscMathInterfaceType.Bar:e=new CMathMenuBar;break;case Asc.c_oAscMathInterfaceType.Script:e=new CMathMenuScript;break;case Asc.c_oAscMathInterfaceType.Fraction:e=new CMathMenuFraction;break;case Asc.c_oAscMathInterfaceType.Limit:e=new CMathMenuLimit;break;case Asc.c_oAscMathInterfaceType.Matrix:e=new CMathMenuMatrix;break;case Asc.c_oAscMathInterfaceType.EqArray:e=new CMathMenuEqArray;break;case Asc.c_oAscMathInterfaceType.LargeOperator:e=new CMathMenuNary;break;case Asc.c_oAscMathInterfaceType.Delimiter:e=new CMathMenuDelimiter;break;case Asc.c_oAscMathInterfaceType.GroupChar:e=new CMathMenuGroupCharacter;break;case Asc.c_oAscMathInterfaceType.Radical:e=new CMathMenuRadical;break;case Asc.c_oAscMathInterfaceType.Common:e=new CMathMenuBase}e&&(e[t.callback](t.value),this.api.asc_SetMathProps(e))}Common.NotificationCenter.trigger("edit:complete",this.documentHolder)},onTextInShapeAfterRender:function(t){var e=this.documentHolder,i=e.paraBulletsPicker.conf;e.paraBulletsPicker=new Common.UI.DataView({el:$("#id-docholder-menu-bullets"),parentMenu:e.menuParagraphBullets.menu,outerMenu:{menu:e.menuParagraphBullets.menu,index:0},groups:e.paraBulletsPicker.groups,store:e.paraBulletsPicker.store,delayRenderTips:!0,itemTemplate:_.template('<% if (type==0) { %><div id="<%= id %>" class="item-markerlist"></div><% } else if (type==1) { %><div id="<%= id %>" class="item-multilevellist"></div><% } %>')}),e.paraBulletsPicker.on("item:click",_.bind(this.onSelectBullets,this)),e.menuParagraphBullets.menu.setInnerMenu([{menu:e.paraBulletsPicker,index:0}]),i&&e.paraBulletsPicker.selectRecord(i.rec,!0)},onBulletMenuShowAfter:function(){var t=this.documentHolder.paraBulletsPicker.store,e=[],i=[];t.each((function(t){var n=t.get("drawdata");n.divId=t.get("id"),"menu-list-bullet-group"===t.get("group")?i.push(n):e.push(n)})),this.api&&this.api.SetDrawImagePreviewBulletForMenu&&(this.api.SetDrawImagePreviewBulletForMenu(i,0),this.api.SetDrawImagePreviewBulletForMenu(e,1))},updateBulletTip:function(t,e){if(t){var i=$(t.el).data("bs.tooltip");i&&(i.options.title=e,i.$tip.find(".tooltip-inner").text(e))}},onSignatureClick:function(t){var e=t.cmpEl.attr("data-value");switch(t.value){case 0:Common.NotificationCenter.trigger("protect:sign",e);break;case 1:this.api.asc_ViewCertificate(e);break;case 2:Common.NotificationCenter.trigger("protect:signature","visible",this._isDisabled,e);break;case 3:var i=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtRemoveWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&i.api.asc_RemoveSignature(e)}})}},onOriginalSizeClick:function(t){if(this.api){var e=this.api.asc_getOriginalImageSize(),i=e.asc_getImageWidth(),n=e.asc_getImageHeight(),o=new Asc.asc_CImgProperty;o.asc_putWidth(i),o.asc_putHeight(n),o.put_ResetCrop(!0),o.put_Rot(0),this.api.asc_setGraphicObjectProps(o),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Set Image Original Size")}},onImgReplace:function(t,e){var i=this;this.api&&("file"==e.value?setTimeout((function(){i.api&&i.api.asc_changeImageFromFile(),Common.NotificationCenter.trigger("edit:complete",i.documentHolder)}),10):"storage"==e.value?Common.NotificationCenter.trigger("storage:image-load","change"):new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&i.api){var n=e.replace(/ /g,"");if(!_.isEmpty(n)){var o=new Asc.asc_CImgProperty;o.asc_putImageUrl(n),i.api.asc_setGraphicObjectProps(o)}}Common.NotificationCenter.trigger("edit:complete",i.documentHolder)}}).show())},onNumberFormatSelect:function(t,e){void 0!==e.value&&"advanced"!==e.value&&this.api&&this.api.asc_setCellFormat(e.options.format),Common.NotificationCenter.trigger("edit:complete",this.documentHolder)},onCustomNumberFormat:function(t){var e=this,i=e.api.asc_getLocale();!i&&(i=e.permissions.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(e.permissions.lang)):1033),new SSE.Views.FormatSettingsDialog({api:e.api,handler:function(t,i){i&&e.api.asc_setCellFormat(i.format),Common.NotificationCenter.trigger("edit:complete",e.documentHolder)},props:{format:t.options.numformat,formatInfo:t.options.numformatinfo,langId:i}}).show(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder)},onNumberFormatOpenAfter:function(t){if(this.api){var e=this,i=e.api.asc_getLocale();if(!i&&(i=e.permissions.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(e.permissions.lang)):1033),this._state.langId!==i){this._state.langId=i;var n=new Asc.asc_CFormatCellsInfo;n.asc_setType(Asc.c_oAscNumFormatType.None),n.asc_setSymbol(this._state.langId);for(var o=this.api.asc_getFormatCells(n),s=0;s<t.items.length-2;s++)t.items[s].options.format=o[s]}var a=t.options.numformatinfo;a=a?a.asc_getType():-1;for(s=0;s<t.items.length-2;s++){var l=t.items[s];l.options.exampleval=e.api.asc_getLocaleExample(l.options.format),$(l.el).find("label").text(l.options.exampleval),l.setChecked(a==l.value)}}},onAutoCorrectOpenAfter:function(t){this.mnuAutoCorrectStop&&this.mnuAutoCorrectStop.setChecked(!Common.Utils.InternalSettings.get("sse-settings-autoformat-new-rows"))},onAutoCorrectOptions:function(){var t=new Common.Views.AutoCorrectDialog({api:this.api});t&&(t.show(),t.setActiveCategory(2))},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&(this._state.wsProps=t.wsProps,this._state.wsLock=t.wsLock)},onShowForeignCursorLabel:function(t,e,i,n){if(this.isUserVisible(t)){var o,s=this;s.tooltips&&s.tooltips.foreignSelect&&s.tooltips.foreignSelect.userId==t&&s.hideForeignSelectTips();for(var a=0;a<s.fastcoauthtips.length;a++)if(s.fastcoauthtips[a].attr("userid")==t){o=s.fastcoauthtips[a];break}var l=this.tooltips.coauth;e<0||e+l.XY[0]>l.bodyWidth-l.rightMenuWidth||i<0||i>l.apiHeight?o&&this.onHideForeignCursorLabel(t):(o||((o=$(document.createElement("div"))).addClass("username-tip"),o.attr("userid",t),o.css({height:s._TtHeight+"px",position:"absolute",zIndex:"900",display:"none","pointer-events":"none","background-color":"#"+Common.Utils.ThemeColor.getHexColor(n.get_r(),n.get_g(),n.get_b())}),o.text(s.getUserName(t)),$("#editor_sdk").append(o),s.fastcoauthtips.push(o),o.fadeIn(150)),o.css({left:(e+l.XY[0]+o.outerWidth()>l.bodyWidth-l.rightMenuWidth?l.bodyWidth-l.rightMenuWidth-o.outerWidth()-l.XY[0]:e)+"px",top:i-s._TtHeight+"px"}))}},onHideForeignCursorLabel:function(t){for(var e=this,i=0;i<e.fastcoauthtips.length;i++)if(e.fastcoauthtips[i].attr("userid")==t){var n=e.fastcoauthtips[i];e.fastcoauthtips[i].fadeOut(150,(function(){n.remove()})),e.fastcoauthtips.splice(i,1);break}},onDoubleClickOnTableOleObject:function(t){if(this.permissions.isEdit&&!this._isDisabled){var e=SSE.getController("Common.Controllers.ExternalOleEditor").getView("Common.Views.ExternalOleEditor");e&&t&&(e.setEditMode(!0),e.show(),e.setOleData(Asc.asc_putBinaryDataToFrameFromTableOleObject(t)))}},getUserName:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return AscCommon.UserInfoParser.getParsedName(i.get("username"))}return this.guestText},isUserVisible:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return!i.get("hidden")}return!0},SetDisabled:function(t,e){this._isDisabled=t,this._canProtect=e},guestText:"Guest",textCtrlClick:"Click the link to open it or click and hold the mouse button to select the cell.",txtHeight:"Height",txtWidth:"Width",tipIsLocked:"This element is being edited by another user.",textChangeColumnWidth:"Column Width {0} symbols ({1} pixels)",textChangeRowHeight:"Row Height {0} points ({1} pixels)",textInsertLeft:"Insert Left",textInsertTop:"Insert Top",textSym:"sym",notcriticalErrorTitle:"Warning",errorInvalidLink:"The link reference does not exist. Please correct the link or delete it.",txtRemoveAccentChar:"Remove accent character",txtBorderProps:"Borders property",txtHideTop:"Hide top border",txtHideBottom:"Hide bottom border",txtHideLeft:"Hide left border",txtHideRight:"Hide right border",txtHideHor:"Hide horizontal line",txtHideVer:"Hide vertical line",txtHideLT:"Hide left top line",txtHideLB:"Hide left bottom line",txtAddTop:"Add top border",txtAddBottom:"Add bottom border",txtAddLeft:"Add left border",txtAddRight:"Add right border",txtAddHor:"Add horizontal line",txtAddVer:"Add vertical line",txtAddLT:"Add left top line",txtAddLB:"Add left bottom line",txtRemoveBar:"Remove bar",txtOverbar:"Bar over text",txtUnderbar:"Bar under text",txtRemScripts:"Remove scripts",txtRemSubscript:"Remove subscript",txtRemSuperscript:"Remove superscript",txtScriptsAfter:"Scripts after text",txtScriptsBefore:"Scripts before text",txtFractionStacked:"Change to stacked fraction",txtFractionSkewed:"Change to skewed fraction",txtFractionLinear:"Change to linear fraction",txtRemFractionBar:"Remove fraction bar",txtAddFractionBar:"Add fraction bar",txtRemLimit:"Remove limit",txtLimitOver:"Limit over text",txtLimitUnder:"Limit under text",txtHidePlaceholder:"Hide placeholder",txtShowPlaceholder:"Show placeholder",txtMatrixAlign:"Matrix alignment",txtColumnAlign:"Column alignment",txtTop:"Top",txtBottom:"Bottom",txtInsertEqBefore:"Insert equation before",txtInsertEqAfter:"Insert equation after",txtDeleteEq:"Delete equation",txtLimitChange:"Change limits location",txtHideTopLimit:"Hide top limit",txtShowTopLimit:"Show top limit",txtHideBottomLimit:"Hide bottom limit",txtShowBottomLimit:"Show bottom limit",txtInsertArgBefore:"Insert argument before",txtInsertArgAfter:"Insert argument after",txtDeleteArg:"Delete argument",txtHideOpenBracket:"Hide opening bracket",txtShowOpenBracket:"Show opening bracket",txtHideCloseBracket:"Hide closing bracket",txtShowCloseBracket:"Show closing bracket",txtStretchBrackets:"Stretch brackets",txtMatchBrackets:"Match brackets to argument height",txtGroupCharOver:"Char over text",txtGroupCharUnder:"Char under text",txtDeleteGroupChar:"Delete char",txtHideDegree:"Hide degree",txtShowDegree:"Show degree",txtIncreaseArg:"Increase argument size",txtDecreaseArg:"Decrease argument size",txtInsertBreak:"Insert manual break",txtDeleteBreak:"Delete manual break",txtAlignToChar:"Align to character",txtDeleteRadical:"Delete radical",txtDeleteChars:"Delete enclosing characters",txtDeleteCharsAndSeparators:"Delete enclosing characters and separators",insertText:"Insert",alignmentText:"Alignment",leftText:"Left",rightText:"Right",centerText:"Center",insertRowAboveText:"Row Above",insertRowBelowText:"Row Below",insertColumnLeftText:"Column Left",insertColumnRightText:"Column Right",deleteText:"Delete",deleteRowText:"Delete Row",deleteColumnText:"Delete Column",txtNoChoices:"There are no choices for filling the cell.<br>Only text values from the column can be selected for replacement.",txtExpandSort:"The data next to the selection will not be sorted. Do you want to expand the selection to include the adjacent data or continue with sorting the currently selected cells only?",txtExpand:"Expand and sort",txtSorting:"Sorting",txtSortSelected:"Sort selected",txtPaste:"Paste",txtPasteFormulas:"Formulas",txtPasteFormulaNumFormat:"Formulas & number formats",txtPasteKeepSourceFormat:"Formulas & formatting",txtPasteBorders:"All except borders",txtPasteColWidths:"Formulas & column widths",txtPasteMerge:"Merge conditional formatting",txtPasteTranspose:"Transpose",txtPasteValues:"Values",txtPasteValNumFormat:"Values & number formats",txtPasteValFormat:"Values & formatting",txtPasteFormat:"Paste only formatting",txtPasteLink:"Paste Link",txtPastePicture:"Picture",txtPasteLinkPicture:"Linked Picture",txtPasteSourceFormat:"Source formatting",txtPasteDestFormat:"Destination formatting",txtKeepTextOnly:"Keep text only",txtUseTextImport:"Use text import wizard",txtUndoExpansion:"Undo table autoexpansion",txtRedoExpansion:"Redo table autoexpansion",txtAnd:"and",txtOr:"or",txtEquals:"Equals",txtNotEquals:"Does not equal",txtGreater:"Greater than",txtGreaterEquals:"Greater than or equal to",txtLess:"Less than",txtLessEquals:"Less than or equal to",txtAboveAve:"Above average",txtBelowAve:"Below average",txtBegins:"Begins with",txtNotBegins:"Does not begin with",txtEnds:"Ends with",txtNotEnds:"Does not end with",txtContains:"Contains",txtNotContains:"Does not contain",txtFilterTop:"Top",txtFilterBottom:"Bottom",txtItems:"items",txtPercent:"percent",txtEqualsToCellColor:"Equals to cell color",txtEqualsToFontColor:"Equals to font color",txtAll:"(All)",txtBlanks:"(Blanks)",txtColumn:"Column",txtImportWizard:"Text Import Wizard",textPasteSpecial:"Paste special",textStopExpand:"Stop automatically expanding tables",textAutoCorrectSettings:"AutoCorrect options",txtLockSort:"Data is found next to your selection, but you do not have sufficient permissions to change those cells.<br>Do you wish to continue with the current selection?",txtRemoveWarning:"Do you want to remove this signature?<br>It can't be undone.",txtWarnUrl:"Clicking this link can be harmful to your device and data.<br>Are you sure you want to continue?",txtThisRowHint:"Choose only this row of the specified column",txtAllTableHint:"Returns the entire contents of the table or specified table columns including column headers, data and total rows",txtDataTableHint:"Returns the data cells of the table or specified table columns",txtHeadersTableHint:"Returns the column headers for the table or specified table columns",txtTotalsTableHint:"Returns the total rows for the table or specified table columns",txtCopySuccess:"Link copied to the clipboard"},SSE.Controllers.DocumentHolder||{}))})),define("text!spreadsheeteditor/main/app/template/CellEditor.template",[],(function(){return'<div class="ce-group-name">\r\n    <input id="ce-cell-name" class="aslabel form-control" type="text">\r\n    <div id="ce-cell-name-menu"></div>\r\n    <button id="ce-func-label" type="button" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-function"></i></button>\r\n</div>\r\n<div class="ce-group-expand">\r\n    <button id="ce-btn-expand" type="button" class="btn"><span class="caret">&nbsp;</span></button>\r\n</div>\r\n<div class="ce-group-content">\r\n    <textarea id="ce-cell-content" class="form-control" spellcheck="false" rows="1" cols="20"></textarea>\r\n</div>\r\n'})),define("spreadsheeteditor/main/app/view/CellEditor",["text!spreadsheeteditor/main/app/template/CellEditor.template","common/main/lib/component/BaseView"],(function(t){"use strict";SSE.Views.CellEditor=Common.UI.BaseView.extend(_.extend({template:_.template(t),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t)},render:function(){$(this.el).html(this.template()),this.btnNamedRanges=new Common.UI.Button({parentEl:$("#ce-cell-name-menu"),menu:new Common.UI.Menu({style:"min-width: 70px;max-width:400px;",maxHeight:250,items:[{caption:this.textManager,value:"manager"},{caption:"--"}]})}),this.btnNamedRanges.setVisible(!1),this.btnNamedRanges.menu.setOffset(-81),this.$cellname=$("#ce-cell-name",this.el),this.$btnexpand=$("#ce-btn-expand",this.el),this.$btnfunc=$("#ce-func-label",this.el);var t=this;return this.$cellname.on("focus",(function(e){var i=t.$cellname[0];i.selectionStart=0,i.selectionEnd=i.value.length,i.scrollLeft=i.scrollWidth})),this.$btnfunc.addClass("disabled"),this.$btnfunc.tooltip({title:this.tipFormula,placement:"cursor"}),this},updateCellInfo:function(t){t&&this.$cellname.val("string"==typeof t?t:t.asc_getName())},cellNameDisabled:function(t){t?this.$cellname.attr("disabled","disabled"):this.$cellname.removeAttr("disabled"),this.btnNamedRanges.setDisabled(t)},tipFormula:"Insert Function",textManager:"Manager"},SSE.Views.CellEditor||{}))})),define("text!spreadsheeteditor/main/app/template/NameManagerDlg.template",[],(function(){return'<div class="settings-panel active">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textFilter %></label>\r\n                    <div id="name-manager-combo-filter" class="input-group-nr" style="width:210px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2>\r\n                    <div style="width: 169px;display: inline-block;"><span id="name-manager-sort-name" class="header-sorted">\r\n                        <label class="header"><%= scope.textRanges %></label><div style="width: 6px;height: 6px;"></div><span id="name-manager-sort-name-span" class="sort-direction  caret"></span>\r\n                    </span></div>\r\n                    <div style="width: 115px;display: inline-block;"><span id="name-manager-sort-scope" class="header-sorted">\r\n                        <label class="header"><%= scope.textScope %></label><div style="width: 6px;height: 6px;"></div><span id="name-manager-sort-scope-span" class="sort-direction  caret"></span>\r\n                    </span></div>\r\n                    <label class="header" style=""><%= scope.textDataRange %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <div id="name-manager-range-list" class="range-tableview" style="width:100%; height: 141px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <button type="button" class="btn btn-text-default" id="name-manager-btn-new" style="min-width: 100px;margin-right:5px;"><%= scope.textNew %></button>\r\n                    <button type="button" class="btn btn-text-default" id="name-manager-btn-edit" style="min-width: 100px;"><%= scope.textEdit %></button>\r\n                </td>\r\n                <td class="padding-large" style="text-align: right;width:90px;">\r\n                    <button type="button" class="btn btn-text-default" id="name-manager-btn-delete" style="min-width: 100px;"><%= scope.textDelete %></button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>'})),define("spreadsheeteditor/main/app/view/NameManagerDlg",["text!spreadsheeteditor/main/app/template/NameManagerDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/ListView","common/main/lib/component/InputField"],(function(t){"use strict";SSE.Views=SSE.Views||{},SSE.Views.NameManagerDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"NameManagerDlg",contentWidth:525,height:353,buttons:null},initialize:function(e){_.extend(this.options,{title:this.txtTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer center">','<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+this.closeButtonText+"</button>","</div>"].join("")},e),this.api=e.api,this.handler=e.handler,this.sheets=e.sheets||[],this.sheetNames=e.sheetNames||[],this.ranges=e.ranges||[],this.props=e.props,this.sort=e.sort||{type:"name",direction:1},this.locked=e.locked||!1,this.userTooltip=!0,this.currentNamedRange=void 0,this.rangesStore=new Common.UI.DataViewStore,this.wrapEvents={onRefreshDefNameList:_.bind(this.onRefreshDefNameList,this),onLockDefNameManager:_.bind(this.onLockDefNameManager,this)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.cmbFilter=new Common.UI.ComboBox({el:$("#name-manager-combo-filter"),menuStyle:"min-width: 100%;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textFilterAll},{value:1,displayValue:this.textFilterDefNames},{value:2,displayValue:this.textFilterTableNames},{value:3,displayValue:this.textFilterSheet},{value:4,displayValue:this.textFilterWorkbook}],takeFocusOnClose:!0}).on("selected",(function(e,i){t.refreshRangeList(null,0)})),this.cmbFilter.setValue(0),this.rangeList=new Common.UI.ListView({el:$("#name-manager-range-list",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,emptyText:this.textEmpty,itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;<% if (!lock) { %>pointer-events:none;<% } %>">','<div class="listitem-icon toolbar__icon <% print(isTable?"btn-menu-table":(isSlicer ? "btn-slicer" : "btn-named-range")) %>"></div>','<div style="width:141px;padding-right: 5px;"><%= Common.Utils.String.htmlEncode(name) %></div>','<div style="width:117px;padding-right: 5px;"><%= scopeName %></div>','<div style="width:204px;"><%= range %></div>',"<% if (lock) { %>",'<div class="lock-user"><%=lockuser%></div>',"<% } %>","</div>"].join("")),tabindex:1}),this.rangeList.store.comparator=function(e,i){var n=e.get(t.sort.type).toLowerCase(),o=i.get(t.sort.type).toLowerCase();return n==o?0:n<o?-t.sort.direction:t.sort.direction},this.rangeList.on("item:select",_.bind(this.onSelectRangeItem,this)).on("item:keydown",_.bind(this.onKeyDown,this)).on("item:dblclick",_.bind(this.onDblClickItem,this)).on("entervalue",_.bind(this.onDblClickItem,this)),this.btnNewRange=new Common.UI.Button({el:$("#name-manager-btn-new")}),this.btnNewRange.on("click",_.bind(this.onEditRange,this,!1)),this.btnEditRange=new Common.UI.Button({el:$("#name-manager-btn-edit")}),this.btnEditRange.on("click",_.bind(this.onEditRange,this,!0)),this.btnDeleteRange=new Common.UI.Button({el:$("#name-manager-btn-delete")}),this.btnDeleteRange.on("click",_.bind(this.onDeleteRange,this)),$("#name-manager-sort-name").on("click",_.bind(this.onSortNames,this,"name")),$("#name-manager-sort-scope").on("click",_.bind(this.onSortNames,this,"scopeName")),this.spanSortName=$("#name-manager-sort-name-span"),this.spanSortScope=$("#name-manager-sort-scope-span"),"name"==this.sort.type?this.spanSortScope.addClass("hidden"):this.spanSortName.addClass("hidden"),this.sort.direction<0&&("name"==this.sort.type?this.spanSortName.addClass("sort-desc"):this.spanSortScope.addClass("sort-desc")),this.afterRender()},getFocusedComponents:function(){return[this.cmbFilter,this.rangeList,this.btnNewRange,this.btnEditRange,this.btnDeleteRange]},getDefaultFocusableComponent:function(){return this.rangeList},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){this.refreshRangeList(this.ranges,0),this.api.asc_registerCallback("asc_onLockDefNameManager",this.wrapEvents.onLockDefNameManager),this.api.asc_registerCallback("asc_onRefreshDefNameList",this.wrapEvents.onRefreshDefNameList)},onRefreshDefNameList:function(){this.refreshRangeList(this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All),this.currentNamedRange)},refreshRangeList:function(t,e){if(t){this.ranges=t;for(var i=[],n=0;n<this.ranges.length;n++){var o=this.ranges[n].asc_getScope(),s=this.ranges[n].asc_getIsLock(),a=this.ranges[n].asc_getType();i.push({name:this.ranges[n].asc_getName(!0),scope:o,scopeName:null===o?this.textWorkbook:this.sheetNames[o],range:a===Asc.c_oAscDefNameType.slicer?"":this.ranges[n].asc_getRef(),lock:null!=s,lockuser:s?this.isUserVisible(s)?this.getUserName(s):this.lockText:this.guestText,type:a,isTable:a===Asc.c_oAscDefNameType.table,isSlicer:a===Asc.c_oAscDefNameType.slicer})}this.rangesStore.reset(i),this.rangeList.setEmptyText(this.rangesStore.length>0?this.textnoNames:this.textEmpty)}var l=this,r=this.rangeList.store,c=this.rangesStore.models,d=this.cmbFilter.getValue(),h=d<3?2==d:-1,p=d>2?4==d:-1;if(d>0&&(c=this.rangesStore.filter((function(t){return-1!==h?h===t.get("isTable"):-1!==p&&p===(null===t.get("scope"))}))),r.reset(c,{silent:!1}),d=r.length,this.btnEditRange.setDisabled(!d),this.btnDeleteRange.setDisabled(!d),d>0){if(null==e&&(e=0),_.isNumber(e))e>d-1&&(e=d-1),this.rangeList.selectByIndex(e),setTimeout((function(){l.rangeList.scrollToRecord(r.at(e))}),50);else if(e){var m=r.findWhere({name:e.asc_getName(!0),scope:e.asc_getScope()});m&&(this.rangeList.selectRecord(m),setTimeout((function(){l.rangeList.scrollToRecord(m)}),50))}!0===this.userTooltip&&this.rangeList.cmpEl.find(".lock-user").length>0&&this.rangeList.cmpEl.on("mouseover",_.bind(l.onMouseOverLock,l)).on("mouseout",_.bind(l.onMouseOutLock,l))}_.delay((function(){l.rangeList.scroller.update({alwaysVisibleY:!0})}),100,this)},onMouseOverLock:function(t,e,i){if(!0===this.userTooltip&&$(t.target).hasClass("lock-user")){var n=this,o=$(t.target).tooltip({title:this.tipIsLocked,trigger:"manual"}).data("bs.tooltip");this.userTooltip=o.tip(),this.userTooltip.css("z-index",parseInt(this.$window.css("z-index"))+10),o.show(),setTimeout((function(){n.userTipHide()}),5e3)}},userTipHide:function(){"object"==typeof this.userTooltip&&(this.userTooltip.remove(),this.userTooltip=void 0,this.rangeList.cmpEl.off("mouseover").off("mouseout"))},onMouseOutLock:function(t,e,i){"object"==typeof this.userTooltip&&this.userTipHide()},onEditRange:function(t){if(!this._isWarningVisible)if(this.locked)Common.NotificationCenter.trigger("namedrange:locked");else{var e=this,i=e.$window.offset(),n=this.rangeList.getSelectedRec(),o=(_.indexOf(this.rangeList.store.models,n),t&&n?new Asc.asc_CDefName(n.get("name"),n.get("range"),n.get("scope"),n.get("type"),void 0,void 0,void 0,!0):null),s=new SSE.Views.NamedRangeEditDlg({api:e.api,sheets:this.sheets,props:t?o:this.props,isEdit:t,handler:function(i,n){"ok"==i&&n&&(t?(e.currentNamedRange=n,e.api.asc_editDefinedNames(o,n)):(e.cmbFilter.setValue(0),e.currentNamedRange=n,e.api.asc_setDefinedNames(n)))}}).on("close",(function(){e.show(),setTimeout((function(){e.getDefaultFocusableComponent().focus()}),100)}));e.hide(),s.show(i.left+65,i.top+77)}},onDeleteRange:function(){var t=this.rangeList.getSelectedRec();if(t){var e=this;e._isWarningVisible=!0,Common.UI.warning({msg:Common.Utils.String.format(e.warnDelete,t.get("name")),buttons:["ok","cancel"],callback:function(i){"ok"==i&&(e.currentNamedRange=_.indexOf(e.rangeList.store.models,t),e.api.asc_delDefinedNames(new Asc.asc_CDefName(t.get("name"),t.get("range"),t.get("scope"),t.get("type"),void 0,void 0,void 0,!0))),setTimeout((function(){e.getDefaultFocusableComponent().focus()}),100),e._isWarningVisible=!1}})}},getSettings:function(){return this.sort},onPrimary:function(){return!0},onDlgBtnClick:function(t){this.handler&&this.handler.call(this,t.currentTarget.attributes.result.value),this.close()},onSortNames:function(t){t!==this.sort.type?(this.sort={type:t,direction:1},this.spanSortName.toggleClass("hidden"),this.spanSortScope.toggleClass("hidden")):this.sort.direction=-this.sort.direction;var e="name"==t?this.spanSortName:this.spanSortScope;this.sort.direction>0?e.removeClass("sort-desc"):e.addClass("sort-desc"),this.rangeList.store.sort(),this.rangeList.onResetItems(),this.rangeList.scroller.update({alwaysVisibleY:!0})},getUserName:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return AscCommon.UserInfoParser.getParsedName(i.get("username"))}return this.guestText},isUserVisible:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return!i.get("hidden")}return!0},onSelectRangeItem:function(t,e,i){if(i){this.userTipHide();var n={};if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;n=i.toJSON(),this.currentNamedRange=_.indexOf(this.rangeList.store.models,i),this.btnEditRange.setDisabled(n.lock),this.btnDeleteRange.setDisabled(n.lock||n.isTable||n.isSlicer)}}},hide:function(){this.userTipHide(),Common.UI.Window.prototype.hide.call(this)},close:function(){this.userTipHide(),this.api.asc_unregisterCallback("asc_onLockDefNameManager",this.wrapEvents.onLockDefNameManager),this.api.asc_unregisterCallback("asc_onRefreshDefNameList",this.wrapEvents.onRefreshDefNameList),Common.UI.Window.prototype.close.call(this)},onKeyDown:function(t,e,i){i.keyCode!=Common.UI.Keys.DELETE||this.btnDeleteRange.isDisabled()||this.onDeleteRange()},onDblClickItem:function(t,e,i){this.btnEditRange.isDisabled()||this.onEditRange(!0)},onLockDefNameManager:function(t){this.locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager},txtTitle:"Name Manager",closeButtonText:"Close",textDataRange:"Data Range",textNew:"New",textEdit:"Edit",textDelete:"Delete",textRanges:"Named Ranges",textScope:"Scope",textFilter:"Filter",textEmpty:"No named ranges have been created yet.<br>Create at least one named range and it will appear in this field.",textnoNames:"No named ranges matching your filter could be found.",textFilterAll:"All",textFilterDefNames:"Defined names",textFilterTableNames:"Table names",textFilterSheet:"Names Scoped to Sheet",textFilterWorkbook:"Names Scoped to Workbook",textWorkbook:"Workbook",guestText:"Guest",tipIsLocked:"This element is being edited by another user.",warnDelete:"Are you sure you want to delete the name {0}?",lockText:"Locked"},SSE.Views.NameManagerDlg||{}))})),define("spreadsheeteditor/main/app/controller/CellEditor",["core","spreadsheeteditor/main/app/view/CellEditor","spreadsheeteditor/main/app/view/NameManagerDlg"],(function(t){"use strict";SSE.Controllers.CellEditor=Backbone.Controller.extend({views:["CellEditor"],events:function(){return{"keyup input#ce-cell-name":_.bind(this.onCellName,this),"keyup textarea#ce-cell-content":_.bind(this.onKeyupCellEditor,this),"blur textarea#ce-cell-content":_.bind(this.onBlurCellEditor,this),"click button#ce-btn-expand":_.bind(this.expandEditorField,this),"click button#ce-func-label":_.bind(this.onInsertFunction,this)}},initialize:function(){this.addListeners({CellEditor:{},Viewport:{"layout:resizedrag":_.bind(this.onLayoutResize,this)},ViewTab:{"viewtab:formula":function(t,e){this.editor.setVisible(e),Common.localStorage.setBool("sse-hidden-formula",!e),Common.NotificationCenter.trigger("layout:changed","celleditor",e?"showed":"hidden")}.bind(this)}})},setApi:function(t){return this.api=t,this.api.isCEditorFocused=!1,this.api.asc_registerCallback("asc_onSelectionNameChanged",_.bind(this.onApiCellSelection,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),this.api.asc_registerCallback("asc_onLockDefNameManager",_.bind(this.onLockDefNameManager,this)),this.api.asc_registerCallback("asc_onInputKeyDown",_.bind(this.onInputKeyDown,this)),this},setMode:function(t){this.mode=t,this.editor.$btnfunc[this.mode.isEdit?"removeClass":"addClass"]("disabled"),this.editor.btnNamedRanges.setVisible(this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle),this.mode.isEdit&&this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChanged,this))},onInputKeyDown:function(t){if(Common.UI.Keys.UP===t.keyCode||Common.UI.Keys.DOWN===t.keyCode||Common.UI.Keys.TAB===t.keyCode||Common.UI.Keys.RETURN===t.keyCode||Common.UI.Keys.ESC===t.keyCode||Common.UI.Keys.LEFT===t.keyCode||Common.UI.Keys.RIGHT===t.keyCode){var e=$("#menu-formula-selection");e.hasClass("open")&&e.find(".dropdown-menu").trigger("keydown",t)}},onLaunch:function(){this.editor=this.getView("CellEditor"),this.bindViewEvents(this.editor,this.events),this.editor.$el.parent().find(".after").css({zIndex:"4"});var t=Common.localStorage.getItem("sse-celleditor-height");this.editor.keep_height=null!==t&&parseInt(t)>0?parseInt(t):74,Common.localStorage.getBool("sse-celleditor-expand")&&(this.editor.$el.height(this.editor.keep_height),this.onLayoutResize(void 0,"cell:edit")),this.editor.btnNamedRanges.menu.on("item:click",_.bind(this.onNamedRangesMenu,this)).on("show:before",_.bind(this.onNameBeforeShow,this)),this.namedrange_locked=!1},onApiEditCell:function(t){this.viewmode||(t==Asc.c_oAscCellEditorState.editStart?(this.api.isCellEdited=!0,this.editor.cellNameDisabled(!0)):t==Asc.c_oAscCellEditorState.editInCell?this.api.isCEditorFocused="clear":t==Asc.c_oAscCellEditorState.editEnd&&(this.api.isCellEdited=!1,this.api.isCEditorFocused=!1,this.editor.cellNameDisabled(!1)),this.editor.$btnfunc.toggleClass("disabled",t==Asc.c_oAscCellEditorState.editText))},onApiCellSelection:function(t){this.editor.updateCellInfo(t)},onApiSelectionChanged:function(t){if(!this.viewmode){var e=t.asc_getSelectionType(),i=!(this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle)&&(!0===t.asc_getLocked()||!0===t.asc_getLockedTable()||!0===t.asc_getLockedPivotTable()),n=e==Asc.c_oAscSelectionType.RangeChartText,o=e==Asc.c_oAscSelectionType.RangeChart,s=e==Asc.c_oAscSelectionType.RangeShapeText,a=e==Asc.c_oAscSelectionType.RangeShape,l=e==Asc.c_oAscSelectionType.RangeImage||e==Asc.c_oAscSelectionType.RangeSlicer,r=s||a||n||o;this.editor.$btnfunc.toggleClass("disabled",l||r||i)}},onApiDisconnect:function(){this.mode.isEdit=!1;var t=this.getApplication().getController("FormulaDialog");t&&t.hideDialog(),this.mode.isEdit||($("#ce-func-label",this.editor.el).addClass("disabled"),this.editor.btnNamedRanges.setVisible(!1))},onCellsRange:function(t){this.editor.cellNameDisabled(t!=Asc.c_oAscSelectionDialogType.None),this.editor.$btnfunc.toggleClass("disabled",t!=Asc.c_oAscSelectionDialogType.None)},onLayoutResize:function(t,e){"cell:edit"==e&&(Math.floor(this.editor.$el.height())>19?(this.editor.$btnexpand.hasClass("btn-collapse")||(this.editor.$el.addClass("expanded"),this.editor.$btnexpand.addClass("btn-collapse")),t&&Common.localStorage.setItem("sse-celleditor-height",this.editor.$el.height()),t&&Common.localStorage.setBool("sse-celleditor-expand",!0)):(this.editor.$el.removeClass("expanded"),this.editor.$btnexpand.removeClass("btn-collapse"),t&&Common.localStorage.setBool("sse-celleditor-expand",!1)))},onCellName:function(t){if(t.keyCode==Common.UI.Keys.RETURN){var e=this.editor.$cellname.val();e&&e.length&&this.api.asc_findCell(e),Common.NotificationCenter.trigger("edit:complete",this.editor)}},onBlurCellEditor:function(){"clear"==this.api.isCEditorFocused?this.api.isCEditorFocused=void 0:this.api.isCellEdited&&(this.api.isCEditorFocused=!0)},onKeyupCellEditor:function(t){t.keyCode!=Common.UI.Keys.RETURN||t.altKey||(this.api.isCEditorFocused="clear")},expandEditorField:function(){Math.floor(this.editor.$el.height())>19?(this.editor.keep_height=this.editor.$el.height(),this.editor.$el.height(19),this.editor.$el.removeClass("expanded"),this.editor.$btnexpand.removeClass("btn-collapse"),Common.localStorage.setBool("sse-celleditor-expand",!1)):(this.editor.$el.height(this.editor.keep_height),this.editor.$el.addClass("expanded"),this.editor.$btnexpand.addClass("btn-collapse"),Common.localStorage.setBool("sse-celleditor-expand",!0)),Common.NotificationCenter.trigger("layout:changed","celleditor"),Common.NotificationCenter.trigger("edit:complete",this.editor,{restorefocus:!0})},onInsertFunction:function(){if(!this.viewmode&&this.mode.isEdit&&!this.editor.$btnfunc.hasClass("disabled")){var t=this.getApplication().getController("FormulaDialog");t&&($("#ce-func-label",this.editor.el).blur(),t.showDialog())}},onNamedRangesMenu:function(t,e){var i=this;if("manager"==e.options.value){for(var n=this.api.asc_getWorksheetsCount(),o=-1,s=[],a=[];++o<n;)this.api.asc_isWorksheetHidden(o)||(a[o]=this.api.asc_getWorksheetName(o),s.push({displayValue:a[o],value:o}));new SSE.Views.NameManagerDlg({api:this.api,handler:function(t){Common.NotificationCenter.trigger("edit:complete",i.editor)},locked:this.namedrange_locked,sheets:s,sheetNames:a,ranges:this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All),props:this.api.asc_getDefaultDefinedName(),sort:this.rangeListSort}).on("close",(function(t){i.rangeListSort=t.getSettings()})).show()}else this.api.asc_findCell(e.caption),Common.NotificationCenter.trigger("edit:complete",this.editor)},onNameBeforeShow:function(){var t=this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.WorksheetWorkbook,!0),e=this.editor.btnNamedRanges.menu,i="";e.removeItems(2,e.items.length-1),t.sort((function(t,e){var i=t.asc_getName(!0).toLowerCase(),n=e.asc_getName(!0).toLowerCase();return i==n?0:i<n?-1:1})),_.each(t,(function(t,n){var o=t.asc_getName(!0);i!==o&&e.addItem(new Common.UI.MenuItem({caption:o})),i=o})),this.editor.btnNamedRanges.menu.items[0].setDisabled(!!this.api.asc_isProtectedSheet()),this.editor.btnNamedRanges.menu.items[1].setVisible(e.items.length>2)},onLockDefNameManager:function(t){this.namedrange_locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager},SetDisabled:function(t){this.editor.$btnfunc[!t&&this.mode.isEdit?"removeClass":"addClass"]("disabled"),this.editor.btnNamedRanges.setVisible(!t&&this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle)},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,this.editor.$btnfunc[!t&&this.mode.isEdit?"removeClass":"addClass"]("disabled"),this.editor.cellNameDisabled(t&&!(this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle)))}})})),define("common/main/lib/view/ImageFromUrlDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.ImageFromUrlDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+(this.options.title||this.textUrl)+"</label>","</div>",'<div id="id-dlg-url" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputUrl=new Common.UI.InputField({el:$("#id-dlg-url"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validation:function(e){return!!/((^https?)|(^ftp)):\/\/.+/i.test(e)||t.txtNotUrl}}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay((function(){t.getChild("input").focus()}),100)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputUrl.checkValidate())return void this.inputUrl.cmpEl.find("input").focus();this.options.handler.call(this,t,this.inputUrl.getValue())}this.close()},textUrl:"Paste an image URL:",txtEmpty:"This field is required",txtNotUrl:'This field should be a URL in the format "http://www.example.com"'},Common.Views.ImageFromUrlDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/LoadMask",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.LoadMask=Common.UI.BaseView.extend({options:{cls:"",style:"",title:"Loading...",owner:document.body},template:_.template(['<div id="<%= id %>" class="asc-loadmask-body <%= cls %>" role="presentation" tabindex="-1">','<i id="loadmask-spinner" class="asc-loadmask-image"></i>','<div class="asc-loadmask-title"><%= title %></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.template=this.options.template||this.template,this.title=this.options.title,this.ownerEl=this.options.owner instanceof Common.UI.BaseView?$(this.options.owner.el):$(this.options.owner),this.loaderEl=$(this.template({id:this.id,cls:this.options.cls,style:this.options.style,title:this.title})),this.maskeEl=$('<div class="asc-loadmask"></div>'),this.timerId=0},render:function(){return this},internalShowLoader:function(){this.ownerEl.append(this.loaderEl),this.loaderEl.css("min-width",$(".asc-loadmask-title",this.loaderEl).width()+105),this.ownerEl&&0==this.ownerEl.closest(".asc-window.modal").length&&Common.util.Shortcuts.suspendEvents()},internalShowMask:function(){this.ownerEl.ismasked||(this.ownerEl.ismasked=!0,this.ownerEl.append(this.maskeEl))},show:function(t){if(this.internalShowMask(),this.ownerEl.hasloader)return this;this.ownerEl.hasloader=!0;var e=this;return e.title!=e.options.title&&(e.options.title=e.title,$(".asc-loadmask-title",this.loaderEl).html(e.title)),t?e.internalShowLoader():e.timerId||(e.timerId=setTimeout((function(){e.internalShowLoader()}),500)),this},hide:function(){var t=this.ownerEl;this.timerId&&(clearTimeout(this.timerId),this.timerId=0),t&&t.ismasked&&this.maskeEl&&this.maskeEl.remove(),delete t.ismasked,t&&t.hasloader&&(0!=t.closest(".asc-window.modal").length||Common.Utils.ModalWindow.isVisible()||Common.util.Shortcuts.resumeEvents(),this.loaderEl&&this.loaderEl.remove()),delete t.hasloader},setTitle:function(t){if(this.title=t,this.ownerEl&&this.ownerEl.hasloader&&this.loaderEl){var e=$(".asc-loadmask-title",this.loaderEl);e.html(t),this.loaderEl.css("min-width",e.width()+105)}},isVisible:function(){return!!this.ownerEl.ismasked},updatePosition:function(){var t=this.ownerEl,e=this.loaderEl;t&&t.hasloader&&e&&(e.css({top:Math.round(t.height()/2-(e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")))/2)+"px",left:Math.round(t.width()/2-(e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("padding-right")))/2)+"px"}),e.css({visibility:"visible"}))}})})),define("common/main/lib/view/SelectFileDlg",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],(function(){"use strict";Common.Views.SelectFileDlg=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:1024,height:621,header:!0},t),this.template=['<div id="id-select-file-placeholder"></div>'].join(""),e.tpl=_.template(this.template)(e),this.fileChoiceUrl=t.fileChoiceUrl||"",Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var t=document.createElement("iframe");t.width="100%",t.height=585,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=_.bind(this._onLoad,this),$("#id-select-file-placeholder").append(t),this.loadMask=new Common.UI.LoadMask({owner:$("#id-select-file-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),t.src=this.fileChoiceUrl;var e=this;this._eventfunc=function(t){e._onWindowMessage(t)},this._bindWindowEvents.call(this),this.on("close",(function(t){e._unbindWindowEvents()}))},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){if(t&&"onlyoffice"==t.Referer&&void 0!==t.file){Common.NotificationCenter.trigger("window:close",this);var e=this;setTimeout((function(){_.isEmpty(t.file)||e.trigger("selectfile",e,t.file)}),50)}},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Select Data Source",textLoading:"Loading"},Common.Views.SelectFileDlg||{}))})),define("common/main/lib/view/OptionsDialog",["common/main/lib/component/Window","common/main/lib/component/RadioBox"],(function(){"use strict";Common.Views.OptionsDialog=Common.UI.Window.extend(_.extend({options:{width:214,header:!0,style:"min-width: 214px;",cls:"modal-dlg",items:[],buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<% if (typeof label !== "undefined" && label !=="") { %>','<label style="margin-bottom: 10px;"><%= label %></label>',"<% } %>","<% _.each(items, function(item, index) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div id="<%= item.id %>" style="margin-bottom: 10px;"></div>',"<% }) %>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.radio=[],Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=t.getChild(),i=this.options.items,n=!0;if(this.checkedIndex=-1,i){for(var o=0;o<i.length;o++){var s=i[o];this.radio.push(new Common.UI.RadioBox({el:e.find("#"+s.id),labelText:s.caption||"",name:"asc-radio-opt-dlg",value:s.value,disabled:!!s.disabled,checked:n&&!s.disabled}).on("change",(function(e,i,n){i&&(t.currentCell=e.options.value)}))),!n&&!s.checked||s.disabled||(n=!1,this.checkedIndex=o)}this.checkedIndex>=0&&this.radio[this.checkedIndex].setValue(!0)}e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return this.radio},getDefaultFocusableComponent:function(){return this.checkedIndex>=0?this.radio[this.checkedIndex]:null},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},getSettings:function(){return this.currentCell},onPrimary:function(){return this._handleInput("ok"),!1}},Common.Views.OptionsDialog||{}))})),void 0===Common)var Common={};if(void 0===Common.define&&(Common.define={}),define("common/main/lib/util/define",[],(function(){"use strict";Common.define.c_oAscMathMainType={Symbol:0,Fraction:1,Script:2,Radical:3,Integral:4,LargeOperator:5,Bracket:6,Function:7,Accent:8,LimitLog:9,Operator:10,Matrix:11},Common.define.c_oAscMathType={Symbol_pm:0,Symbol_infinity:1,Symbol_equals:2,Symbol_neq:3,Symbol_about:4,Symbol_times:5,Symbol_div:6,Symbol_factorial:7,Symbol_propto:8,Symbol_less:9,Symbol_ll:10,Symbol_greater:11,Symbol_gg:12,Symbol_leq:13,Symbol_geq:14,Symbol_mp:15,Symbol_cong:16,Symbol_approx:17,Symbol_equiv:18,Symbol_forall:19,Symbol_additional:20,Symbol_partial:21,Symbol_sqrt:22,Symbol_cbrt:23,Symbol_qdrt:24,Symbol_cup:25,Symbol_cap:26,Symbol_emptyset:27,Symbol_percent:28,Symbol_degree:29,Symbol_fahrenheit:30,Symbol_celsius:31,Symbol_inc:32,Symbol_nabla:33,Symbol_exists:34,Symbol_notexists:35,Symbol_in:36,Symbol_ni:37,Symbol_leftarrow:38,Symbol_uparrow:39,Symbol_rightarrow:40,Symbol_downarrow:41,Symbol_leftrightarrow:42,Symbol_therefore:43,Symbol_plus:44,Symbol_minus:45,Symbol_not:46,Symbol_ast:47,Symbol_bullet:48,Symbol_vdots:49,Symbol_cdots:50,Symbol_rddots:51,Symbol_ddots:52,Symbol_aleph:53,Symbol_beth:54,Symbol_QED:55,Symbol_alpha:65536,Symbol_beta:65537,Symbol_gamma:65538,Symbol_delta:65539,Symbol_varepsilon:65540,Symbol_epsilon:65541,Symbol_zeta:65542,Symbol_eta:65543,Symbol_theta:65544,Symbol_vartheta:65545,Symbol_iota:65546,Symbol_kappa:65547,Symbol_lambda:65548,Symbol_mu:65549,Symbol_nu:65550,Symbol_xsi:65551,Symbol_o:65552,Symbol_pi:65553,Symbol_varpi:65554,Symbol_rho:65555,Symbol_varrho:65556,Symbol_sigma:65557,Symbol_varsigma:65558,Symbol_tau:65559,Symbol_upsilon:65560,Symbol_varphi:65561,Symbol_phi:65562,Symbol_chi:65563,Symbol_psi:65564,Symbol_omega:65565,Symbol_Alpha:131072,Symbol_Beta:131073,Symbol_Gamma:131074,Symbol_Delta:131075,Symbol_Epsilon:131076,Symbol_Zeta:131077,Symbol_Eta:131078,Symbol_Theta:131079,Symbol_Iota:131080,Symbol_Kappa:131081,Symbol_Lambda:131082,Symbol_Mu:131083,Symbol_Nu:131084,Symbol_Xsi:131085,Symbol_O:131086,Symbol_Pi:131087,Symbol_Rho:131088,Symbol_Sigma:131089,Symbol_Tau:131090,Symbol_Upsilon:131091,Symbol_Phi:131092,Symbol_Chi:131093,Symbol_Psi:131094,Symbol_Omega:131095,FractionVertical:16777216,FractionDiagonal:16777217,FractionHorizontal:16777218,FractionSmall:16777219,FractionDifferential_1:16842752,FractionDifferential_2:16842753,FractionDifferential_3:16842754,FractionDifferential_4:16842755,FractionPi_2:16842756,ScriptSup:33554432,ScriptSub:33554433,ScriptSubSup:33554434,ScriptSubSupLeft:33554435,ScriptCustom_1:33619968,ScriptCustom_2:33619969,ScriptCustom_3:33619970,ScriptCustom_4:33619971,RadicalSqrt:50331648,RadicalRoot_n:50331649,RadicalRoot_2:50331650,RadicalRoot_3:50331651,RadicalCustom_1:50397184,RadicalCustom_2:50397185,Integral:67108864,IntegralSubSup:67108865,IntegralCenterSubSup:67108866,IntegralDouble:67108867,IntegralDoubleSubSup:67108868,IntegralDoubleCenterSubSup:67108869,IntegralTriple:67108870,IntegralTripleSubSup:67108871,IntegralTripleCenterSubSup:67108872,IntegralOriented:67174400,IntegralOrientedSubSup:67174401,IntegralOrientedCenterSubSup:67174402,IntegralOrientedDouble:67174403,IntegralOrientedDoubleSubSup:67174404,IntegralOrientedDoubleCenterSubSup:67174405,IntegralOrientedTriple:67174406,IntegralOrientedTripleSubSup:67174407,IntegralOrientedTripleCenterSubSup:67174408,Integral_dx:67239936,Integral_dy:67239937,Integral_dtheta:67239938,LargeOperator_Sum:83886080,LargeOperator_Sum_CenterSubSup:83886081,LargeOperator_Sum_SubSup:83886082,LargeOperator_Sum_CenterSub:83886083,LargeOperator_Sum_Sub:83886084,LargeOperator_Prod:83951616,LargeOperator_Prod_CenterSubSup:83951617,LargeOperator_Prod_SubSup:83951618,LargeOperator_Prod_CenterSub:83951619,LargeOperator_Prod_Sub:83951620,LargeOperator_CoProd:83951621,LargeOperator_CoProd_CenterSubSup:83951622,LargeOperator_CoProd_SubSup:83951623,LargeOperator_CoProd_CenterSub:83951624,LargeOperator_CoProd_Sub:83951625,LargeOperator_Union:84017152,LargeOperator_Union_CenterSubSup:84017153,LargeOperator_Union_SubSup:84017154,LargeOperator_Union_CenterSub:84017155,LargeOperator_Union_Sub:84017156,LargeOperator_Intersection:84017157,LargeOperator_Intersection_CenterSubSup:84017158,LargeOperator_Intersection_SubSup:84017159,LargeOperator_Intersection_CenterSub:84017160,LargeOperator_Intersection_Sub:84017161,LargeOperator_Disjunction:84082688,LargeOperator_Disjunction_CenterSubSup:84082689,LargeOperator_Disjunction_SubSup:84082690,LargeOperator_Disjunction_CenterSub:84082691,LargeOperator_Disjunction_Sub:84082692,LargeOperator_Conjunction:84082693,LargeOperator_Conjunction_CenterSubSup:84082694,LargeOperator_Conjunction_SubSup:84082695,LargeOperator_Conjunction_CenterSub:84082696,LargeOperator_Conjunction_Sub:84082697,LargeOperator_Custom_1:84148224,LargeOperator_Custom_2:84148225,LargeOperator_Custom_3:84148226,LargeOperator_Custom_4:84148227,LargeOperator_Custom_5:84148228,Bracket_Round:100663296,Bracket_Square:100663297,Bracket_Curve:100663298,Bracket_Angle:100663299,Bracket_LowLim:100663300,Bracket_UppLim:100663301,Bracket_Line:100663302,Bracket_LineDouble:100663303,Bracket_Square_OpenOpen:100663304,Bracket_Square_CloseClose:100663305,Bracket_Square_CloseOpen:100663306,Bracket_SquareDouble:100663307,Bracket_Round_Delimiter_2:100728832,Bracket_Curve_Delimiter_2:100728833,Bracket_Angle_Delimiter_2:100728834,Bracket_Angle_Delimiter_3:100728835,Bracket_Round_OpenNone:100794368,Bracket_Round_NoneOpen:100794369,Bracket_Square_OpenNone:100794370,Bracket_Square_NoneOpen:100794371,Bracket_Curve_OpenNone:100794372,Bracket_Curve_NoneOpen:100794373,Bracket_Angle_OpenNone:100794374,Bracket_Angle_NoneOpen:100794375,Bracket_LowLim_OpenNone:100794376,Bracket_LowLim_NoneNone:100794377,Bracket_UppLim_OpenNone:100794378,Bracket_UppLim_NoneOpen:100794379,Bracket_Line_OpenNone:100794380,Bracket_Line_NoneOpen:100794381,Bracket_LineDouble_OpenNone:100794382,Bracket_LineDouble_NoneOpen:100794383,Bracket_SquareDouble_OpenNone:100794384,Bracket_SquareDouble_NoneOpen:100794385,Bracket_Custom_1:100859904,Bracket_Custom_2:100859905,Bracket_Custom_3:100859906,Bracket_Custom_4:100859907,Bracket_Custom_5:100925440,Bracket_Custom_6:100925441,Bracket_Custom_7:100925442,Function_Sin:117440512,Function_Cos:117440513,Function_Tan:117440514,Function_Csc:117440515,Function_Sec:117440516,Function_Cot:117440517,Function_1_Sin:117506048,Function_1_Cos:117506049,Function_1_Tan:117506050,Function_1_Csc:117506051,Function_1_Sec:117506052,Function_1_Cot:117506053,Function_Sinh:117571584,Function_Cosh:117571585,Function_Tanh:117571586,Function_Csch:117571587,Function_Sech:117571588,Function_Coth:117571589,Function_1_Sinh:117637120,Function_1_Cosh:117637121,Function_1_Tanh:117637122,Function_1_Csch:117637123,Function_1_Sech:117637124,Function_1_Coth:117637125,Function_Custom_1:117702656,Function_Custom_2:117702657,Function_Custom_3:117702658,Accent_Dot:134217728,Accent_DDot:134217729,Accent_DDDot:134217730,Accent_Hat:134217731,Accent_Check:134217732,Accent_Accent:134217733,Accent_Grave:134217734,Accent_Smile:134217735,Accent_Tilde:134217736,Accent_Bar:134217737,Accent_DoubleBar:134217738,Accent_CurveBracketTop:134217739,Accent_CurveBracketBot:134217740,Accent_GroupTop:134217741,Accent_GroupBot:134217742,Accent_ArrowL:134217743,Accent_ArrowR:134217744,Accent_ArrowD:134217745,Accent_HarpoonL:134217746,Accent_HarpoonR:134217747,Accent_BorderBox:134283264,Accent_BorderBoxCustom:134283265,Accent_BarTop:134348800,Accent_BarBot:134348801,Accent_Custom_1:134414336,Accent_Custom_2:134414337,Accent_Custom_3:134414338,LimitLog_LogBase:150994944,LimitLog_Log:150994945,LimitLog_Lim:150994946,LimitLog_Min:150994947,LimitLog_Max:150994948,LimitLog_Ln:150994949,LimitLog_Custom_1:151060480,LimitLog_Custom_2:151060481,Operator_ColonEquals:167772160,Operator_EqualsEquals:167772161,Operator_PlusEquals:167772162,Operator_MinusEquals:167772163,Operator_Definition:167772164,Operator_UnitOfMeasure:167772165,Operator_DeltaEquals:167772166,Operator_ArrowL_Top:167837696,Operator_ArrowR_Top:167837697,Operator_ArrowL_Bot:167837698,Operator_ArrowR_Bot:167837699,Operator_DoubleArrowL_Top:167837700,Operator_DoubleArrowR_Top:167837701,Operator_DoubleArrowL_Bot:167837702,Operator_DoubleArrowR_Bot:167837703,Operator_ArrowD_Top:167837704,Operator_ArrowD_Bot:167837705,Operator_DoubleArrowD_Top:167837706,Operator_DoubleArrowD_Bot:167837707,Operator_Custom_1:167903232,Operator_Custom_2:167903233,Matrix_1_2:184549376,Matrix_2_1:184549377,Matrix_1_3:184549378,Matrix_3_1:184549379,Matrix_2_2:184549380,Matrix_2_3:184549381,Matrix_3_2:184549382,Matrix_3_3:184549383,Matrix_Dots_Center:184614912,Matrix_Dots_Baseline:184614913,Matrix_Dots_Vertical:184614914,Matrix_Dots_Diagonal:184614915,Matrix_Identity_2:184680448,Matrix_Identity_2_NoZeros:184680449,Matrix_Identity_3:184680450,Matrix_Identity_3_NoZeros:184680451,Matrix_2_2_RoundBracket:184745984,Matrix_2_2_SquareBracket:184745985,Matrix_2_2_LineBracket:184745986,Matrix_2_2_DLineBracket:184745987,Matrix_Flat_Round:184811520,Matrix_Flat_Square:184811521},Common.define.chartData=_.extend(new function(){return{textLine:"Line",textColumn:"Column",textBar:"Bar",textArea:"Area",textPie:"Pie",textPoint:"XY (Scatter)",textStock:"Stock",textSurface:"Surface",textCharts:"Charts",textSparks:"Sparklines",textLineSpark:"Line",textColumnSpark:"Column",textWinLossSpark:"Win/Loss",textCombo:"Combo",textBarNormal:"Clustered column",textBarStacked:"Stacked column",textBarStackedPer:"100% Stacked column",textBarNormal3d:"3-D Clustered column",textBarStacked3d:"3-D Stacked column",textBarStackedPer3d:"3-D 100% Stacked column",textBarNormal3dPerspective:"3-D column",textLineStacked:"Stacked line",textLineStackedPer:"100% Stacked line",textLineMarker:"Line with markers",textLineStackedMarker:"Stacked line with markers",textLineStackedPerMarker:"100% Stacked line with markers",textLine3d:"3-D line",textDoughnut:"Doughnut",textPie3d:"3-D pie",textHBarNormal:"Clustered bar",textHBarStacked:"Stacked bar",textHBarStackedPer:"100% Stacked bar",textHBarNormal3d:"3-D Clustered bar",textHBarStacked3d:"3-D Stacked bar",textHBarStackedPer3d:"3-D 100% Stacked bar",textAreaStacked:"Stacked area",textAreaStackedPer:"100% Stacked area",textScatter:"Scatter",textScatterSmoothMarker:"Scatter with smooth lines and markers",textScatterSmooth:"Scatter with smooth lines",textScatterLineMarker:"Scatter with straight lines and markers",textScatterLine:"Scatter with straight lines",textComboBarLine:"Clustered column - line",textComboBarLineSecondary:"Clustered column - line on secondary axis",textComboAreaBar:"Stacked area - clustered column",textComboCustom:"Custom combination",getChartGroupData:function(t){return[{id:"menu-chart-group-bar",caption:this.textColumn,headername:t?this.textCharts:void 0},{id:"menu-chart-group-line",caption:this.textLine},{id:"menu-chart-group-pie",caption:this.textPie},{id:"menu-chart-group-hbar",caption:this.textBar},{id:"menu-chart-group-area",caption:this.textArea,inline:!0},{id:"menu-chart-group-stock",caption:this.textStock,inline:!0},{id:"menu-chart-group-scatter",caption:this.textPoint},{id:"menu-chart-group-combo",caption:this.textCombo}]},getChartData:function(){return[{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barNormal,iconCls:"column-normal",tip:this.textBarNormal},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStacked,iconCls:"column-stack",tip:this.textBarStacked},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStackedPer,iconCls:"column-pstack",tip:this.textBarStackedPer},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barNormal3d,iconCls:"column-3d-normal",tip:this.textBarNormal3d,is3d:!0},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStacked3d,iconCls:"column-3d-stack",tip:this.textBarStacked3d,is3d:!0},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barStackedPer3d,iconCls:"column-3d-pstack",tip:this.textBarStackedPer3d,is3d:!0},{group:"menu-chart-group-bar",type:Asc.c_oAscChartTypeSettings.barNormal3dPerspective,iconCls:"column-3d-normal-per",tip:this.textBarNormal3dPerspective,is3d:!0},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineNormal,iconCls:"line-normal",tip:this.textLine},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStacked,iconCls:"line-stack",tip:this.textLineStacked},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStackedPer,iconCls:"line-pstack",tip:this.textLineStackedPer},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineNormalMarker,iconCls:"line-normal-marker",tip:this.textLineMarker},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStackedMarker,iconCls:"line-stack-marker",tip:this.textLineStackedMarker},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.lineStackedPerMarker,iconCls:"line-pstack-marker",tip:this.textLineStackedPerMarker},{group:"menu-chart-group-line",type:Asc.c_oAscChartTypeSettings.line3d,iconCls:"line-3d",tip:this.textLine3d,is3d:!0},{group:"menu-chart-group-pie",type:Asc.c_oAscChartTypeSettings.pie,iconCls:"pie-normal",tip:this.textPie},{group:"menu-chart-group-pie",type:Asc.c_oAscChartTypeSettings.doughnut,iconCls:"pie-doughnut",tip:this.textDoughnut},{group:"menu-chart-group-pie",type:Asc.c_oAscChartTypeSettings.pie3d,iconCls:"pie-3d-normal",tip:this.textPie3d,is3d:!0},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarNormal,iconCls:"bar-normal",tip:this.textHBarNormal},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStacked,iconCls:"bar-stack",tip:this.textHBarStacked},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStackedPer,iconCls:"bar-pstack",tip:this.textHBarStackedPer},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarNormal3d,iconCls:"bar-3d-normal",tip:this.textHBarNormal3d,is3d:!0},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStacked3d,iconCls:"bar-3d-stack",tip:this.textHBarStacked3d,is3d:!0},{group:"menu-chart-group-hbar",type:Asc.c_oAscChartTypeSettings.hBarStackedPer3d,iconCls:"bar-3d-pstack",tip:this.textHBarStackedPer3d,is3d:!0},{group:"menu-chart-group-area",type:Asc.c_oAscChartTypeSettings.areaNormal,iconCls:"area-normal",tip:this.textArea},{group:"menu-chart-group-area",type:Asc.c_oAscChartTypeSettings.areaStacked,iconCls:"area-stack",tip:this.textAreaStacked},{group:"menu-chart-group-area",type:Asc.c_oAscChartTypeSettings.areaStackedPer,iconCls:"area-pstack",tip:this.textAreaStackedPer},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatter,iconCls:"point-normal",tip:this.textScatter},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterSmoothMarker,iconCls:"point-smooth-marker",tip:this.textScatterSmoothMarker},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterSmooth,iconCls:"point-smooth",tip:this.textScatterSmooth},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterLineMarker,iconCls:"point-line-marker",tip:this.textScatterLineMarker},{group:"menu-chart-group-scatter",type:Asc.c_oAscChartTypeSettings.scatterLine,iconCls:"point-line",tip:this.textScatterLine},{group:"menu-chart-group-stock",type:Asc.c_oAscChartTypeSettings.stock,iconCls:"stock-normal",tip:this.textStock},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboBarLine,iconCls:"combo-bar-line",tip:this.textComboBarLine},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboBarLineSecondary,iconCls:"combo-bar-line-sec",tip:this.textComboBarLineSecondary},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboAreaBar,iconCls:"combo-area-bar",tip:this.textComboAreaBar},{group:"menu-chart-group-combo",type:Asc.c_oAscChartTypeSettings.comboCustom,iconCls:"combo-custom",tip:this.textComboCustom}]},getSparkGroupData:function(t){return[{id:"menu-chart-group-sparkcolumn",inline:!0,headername:t?this.textSparks:void 0},{id:"menu-chart-group-sparkline",inline:!0},{id:"menu-chart-group-sparkwin",inline:!0}]},getSparkData:function(){return[{group:"menu-chart-group-sparkcolumn",type:Asc.c_oAscSparklineType.Column,allowSelected:!0,iconCls:"spark-column",tip:this.textColumnSpark},{group:"menu-chart-group-sparkline",type:Asc.c_oAscSparklineType.Line,allowSelected:!0,iconCls:"spark-line",tip:this.textLineSpark},{group:"menu-chart-group-sparkwin",type:Asc.c_oAscSparklineType.Stacked,allowSelected:!0,iconCls:"spark-win",tip:this.textWinLossSpark}]}}},Common.define.chartData||{}),Common.define.conditionalData=_.extend(new function(){return{textDate:"Date",textYesterday:"Yesterday",textToday:"Today",textTomorrow:"Tomorrow",textLast7days:"In the last 7 days",textLastWeek:"Last week",textThisWeek:"This week",textNextWeek:"Next week",textLastMonth:"Last month",textThisMonth:"This month",textNextMonth:"Next month",textText:"Text",textContains:"Contains",textNotContains:"Does not contain",textBegins:"Begins with",textEnds:"Ends with",textAverage:"Average",textAbove:"Above",textBelow:"Below",textEqAbove:"Equal to or above",textEqBelow:"Equal to or below",text1Above:"1 std dev above",text1Below:"1 std dev below",text2Above:"2 std dev above",text2Below:"2 std dev below",text3Above:"3 std dev above",text3Below:"3 std dev below",textGreater:"Greater than",textGreaterEq:"Greater than or equal to",textLess:"Less than",textLessEq:"Less than or equal to",textEqual:"Equal to",textNotEqual:"Not equal to",textBetween:"Between",textNotBetween:"Not between",textTop:"Top",textBottom:"Bottom",textBlank:"Blank",textError:"Error",textBlanks:"Contains blanks",textNotBlanks:"Does not contain blanks",textErrors:"Contains errors",textNotErrors:"Does not contain errors",textDuplicate:"Duplicate",textUnique:"Unique",textDataBar:"Data bar",textIconSets:"Icon sets",textFormula:"Formula",exampleText:"AaBbCcYyZz",noFormatText:"No format set",textValue:"Value is"}},Common.define.conditionalData||{}),Common.define.effectData=_.extend(new function(){return{textEntrance:"Entrance Effect",textEmphasis:"Emphasis Effect",textExit:"Exit Effect",textPath:"Motion Path",textAppear:"Appear",textFade:"Fade",textFlyIn:"Fly in",textFloatIn:"Float In",textSplit:"Split",textWipe:"Wipe",textShape:"Shape",textWheel:"Wheel",textRandomBars:"Random Bars ",textGrowTurn:"Grow & Turn",textZoom:"Zoom",textSwivel:"Swivel",textBounce:"Bounce",textPulse:"Pulse",textColorPulse:"Color Pulse",textTeeter:"Teeter",textSpin:"Spin",textGrowShrink:"Grow/Shrink",textShrinkTurn:"Shrink & Turn",textDesaturate:"Desaturate",textDarken:"Darken",textLighten:"Lighten",textTransparency:"Transparency",textObjectColor:"Object Color",textComplementaryColor:"Complementary Color",textComplementaryColor2:"Complementary Color 2",textLineColor:"Line Color",textFillColor:"Fill Color",textBrushColor:"Brush Color",textFontColor:"Font Color",textUnderline:"Underline",textBoldFlash:"Bold Flash",textBoldReveal:"Bold Reveal",textWave:"Wave",textDisappear:"Disappear",textFlyOut:"Fly Out",textFloatOut:"Float Out",textBasic:"Basic",textSubtle:"Subtle",textModerate:"Moderate",textExciting:"Exciting",textLinesCurves:"Lines Curves",textSpecial:"Special",textBox:"Box",textCircle:"Circle",textPlus:"Plus",textDiamond:"Diamond",textDissolveIn:"Dissolve In",textBlinds:"Blinds",textCheckerboard:"Checkerboard",textPeekIn:"Peek In",textStrips:"Strips",textExpand:"Expand",textBasicZoom:"Basic Zoom",textCompress:"Compress",textFloatUp:"Float Up",textRiseUp:"Rise Up",textStretch:"Stretch",textCenterRevolve:"Center Revolve",textFloatDown:"Float Down",textSpinner:"Spinner",textBasicSwivel:"Basic Swivel",textBoomerang:"Boomerang",textCredits:"Credits",textCuverUp:"Cuver Up",textDrop:"Drop",textFloat:"Float",textPinwheel:"Pinwheel",textSpiralIn:"Spiral In",textWhip:"Whip",textGrowWithColor:"Grow With Color",textShimmer:"Shimmer",textBlink:"Blink",textDissolveOut:"Dissolve Out",textPeekOut:"Peek Out",textContrast:"Contrast",textCollapse:"Collapse",textSinkDown:"Sink Down",textCurveDown:"CurveDown",textSpiralOut:"Spiral Out",textContrastingColor:"Contrasting Color",textPointStar4:"4 Point Star",textPointStar5:"5 Point Star",textPointStar6:"6 Point Star",textPointStar8:"8 Point Star",textCrescentMoon:"Crescent Moon",textEqualTriangle:"Equal Triangle",textFootball:"Football",textHeart:"Heart",textHexagon:"Hexagon",textOctagon:"Octagon",textParallelogram:"Parallelogram",textPentagon:"Pentagon",textSquare:"Square",textTeardrop:"Teardrop",textTrapezoid:"Trapezoid",textArcDown:"Arc Down",textArcLeft:"Arc Left",textArcRight:"Arc Right",textArcUp:"Arc Up",textBounceLeft:"Bounce Left",textBounceRight:"Bounce Right",textCurvyLeft:"Curvy Left",textCurvyRight:"Curvy Right",textDecayingWave:"Decaying Wave",textDiagonalDownRight:"Diagonal Down Right",textDiagonalUpRight:"Diagonal Up Right",textDown:"Down",textFunnel:"Funnel",textHeartbeat:"Heartbeat",textLeft:"Left",textRight:"Right",textSCurve1:"S Curve 1",textSCurve2:"S Curve 2",textSineWave:"Sine Wave",textSpiralLeft:"Spiral Left",textSpiralRight:"Spiral Right",textSpring:"Spring:",textStairsDown:"Stairs Down",textTurnDown:"Turn Down",textTurnDownRight:"Turn Down Right",textTurnUp:"Turn Up",textTurnUpRight:"Turn Up Right",textUp:"Up",textZigzag:"Zigzag",textBean:"Bean",textCurvedSquare:"CurvedSquare",textCurvedX:"Curved X",textCurvyStar:"Curvy Star",textFigureFour:"Figure 8 Four",textHorizontalFigure:"Horizontal Figure 8",textInvertedSquare:"Inverted Square",textInvertedTriangle:"Inverted Triangle",textLoopDeLoop:"Loop de Loop",textNeutron:"Neutron",textPeanut:"Peanut",textPointStar:"Point Star",textSwoosh:"Swoosh",textVerticalFigure:"Vertical Figure 8",textRightTriangle:"Right Triangle",textAcross:"Across",textFromBottom:"From Bottom",textFromBottomLeft:"From Bottom-Left",textFromLeft:"From Left",textFromTopLeft:"From Top-Left",textFromTop:"From Top",textFromTopRight:"From Top-Right",textFromRight:"From Right",textFromBottomRight:"From Bottom-Right",textLeftDown:" Left Down",textLeftUp:" Left Up",textRightDown:" Right Down",textRightUp:" Right Up",textObjectCenter:"Object Center",textSlideCenter:"Slide Center",textInFromScreenCenter:"In From Screen Center",textOutFromScreenBottom:"Out From Screen Bottom",textInSlightly:"In Slightly",textInToScreenBottom:"In To Screen Bottom",textOutToScreenCenter:"Out To Screen Center",textOutSlightly:"Out Slightly",textToBottom:"To Bottom",textToBottomLeft:"To Bottom-Left",textToLeft:"To Left",textToTopLeft:"To Top-Left",textToTop:"To Top",textToTopRight:"To Top-Right",textToRight:"To Right",textToBottomRight:"To Bottom-Right",textSpoke1:"1 Spoke",textSpoke2:"2 Spokes",textSpoke3:"3 Spokes",textSpoke4:"4 Spokes",textSpoke8:"8 Spokes",textCustomPath:"Custom Path",textHorizontalIn:"Horizontal In",textHorizontalOut:"Horizontal Out",textVerticalIn:"Vertical In",textVerticalOut:"Vertical Out",textVertical:"Vertical",textHorizontal:"Horizontal",textIn:"In",textOut:"Out",textWedge:"Wedge",textFlip:"Flip",textLines:"Lines",textArcs:"Arcs",textTurns:"Turns",textShapes:"Shapes",textLoops:"Loops",textPathCurve:"Curve",textPathLine:"Line",textPathScribble:"Scribble",getEffectGroupData:function(){return[{id:"menu-effect-group-entrance",value:AscFormat.PRESET_CLASS_ENTR,caption:this.textEntrance,iconClsCustom:"animation-entrance-custom"},{id:"menu-effect-group-emphasis",value:AscFormat.PRESET_CLASS_EMPH,caption:this.textEmphasis,iconClsCustom:"animation-emphasis-custom"},{id:"menu-effect-group-exit",value:AscFormat.PRESET_CLASS_EXIT,caption:this.textExit,iconClsCustom:"animation-exit-custom"},{id:"menu-effect-group-path",value:AscFormat.PRESET_CLASS_PATH,caption:this.textPath,iconClsCustom:"animation-motion-paths-custom"}]},getEffectData:function(){return[{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_APPEAR,iconCls:"animation-entrance-appear",displayValue:this.textAppear},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_FADE,iconCls:"animation-entrance-fade",displayValue:this.textFade},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_FLY_IN_FROM,iconCls:"animation-entrance-fly-in",displayValue:this.textFlyIn},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_FLOAT_UP,iconCls:"animation-entrance-float-in",displayValue:this.textFloatIn,familyEffect:"entrfloat"},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_SPLIT,iconCls:"animation-entrance-split",displayValue:this.textSplit},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_WIPE_FROM,iconCls:"animation-entrance-wipe",displayValue:this.textWipe},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_CIRCLE,iconCls:"animation-entrance-shape",displayValue:this.textShape,familyEffect:"entrshape"},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_WHEEL,iconCls:"animation-entrance-wheel",displayValue:this.textWheel},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_RANDOM_BARS,iconCls:"animation-entrance-random-bars",displayValue:this.textRandomBars},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_GROW_AND_TURN,iconCls:"animation-entrance-grow-turn",displayValue:this.textGrowTurn},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_ZOOM,iconCls:"animation-entrance-zoom",displayValue:this.textZoom},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_SWIVEL,iconCls:"animation-entrance-swivel",displayValue:this.textSwivel},{group:"menu-effect-group-entrance",value:AscFormat.ENTRANCE_BOUNCE,iconCls:"animation-entrance-bounce",displayValue:this.textBounce},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_PULSE,iconCls:"animation-emphasis-pulse",displayValue:this.textPulse},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_COLOR_PULSE,iconCls:"animation-emphasis-color-pulse",displayValue:this.textColorPulse},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_TEETER,iconCls:"animation-emphasis-teeter",displayValue:this.textTeeter},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_SPIN,iconCls:"animation-emphasis-spin",displayValue:this.textSpin},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_GROW_SHRINK,iconCls:"animation-emphasis-grow-or-shrink",displayValue:this.textGrowShrink},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_DESATURATE,iconCls:"animation-emphasis-desaturate",displayValue:this.textDesaturate},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_CONTRASTING_DARKEN,iconCls:"animation-emphasis-darken",displayValue:this.textDarken},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_LIGHTEN,iconCls:"animation-emphasis-lighten",displayValue:this.textLighten},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_TRANSPARENCY,iconCls:"animation-emphasis-transparency",displayValue:this.textTransparency},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_OBJECT_COLOR,iconCls:"animation-emphasis-object-color",displayValue:this.textObjectColor},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_COMPLEMENTARY_COLOR,iconCls:"animation-emphasis-complementary-color",displayValue:this.textComplementaryColor},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_LINE_COLOR,iconCls:"animation-emphasis-line-color",displayValue:this.textLineColor},{group:"menu-effect-group-emphasis",value:AscFormat.EMPHASIS_FILL_COLOR,iconCls:"animation-emphasis-fill-color",displayValue:this.textFillColor},{group:"menu-effect-group-exit",value:AscFormat.EXIT_DISAPPEAR,iconCls:"animation-exit-disappear",displayValue:this.textDisappear},{group:"menu-effect-group-exit",value:AscFormat.EXIT_FADE,iconCls:"animation-exit-fade",displayValue:this.textFade},{group:"menu-effect-group-exit",value:AscFormat.EXIT_FLY_OUT_TO,iconCls:"animation-exit-fly-out",displayValue:this.textFlyOut},{group:"menu-effect-group-exit",value:AscFormat.EXIT_FLOAT_DOWN,iconCls:"animation-exit-float-out",displayValue:this.textFloatOut,familyEffect:"exitfloat"},{group:"menu-effect-group-exit",value:AscFormat.EXIT_SPLIT,iconCls:"animation-exit-split",displayValue:this.textSplit},{group:"menu-effect-group-exit",value:AscFormat.EXIT_WIPE_FROM,iconCls:"animation-exit-wipe",displayValue:this.textWipe},{group:"menu-effect-group-exit",value:AscFormat.EXIT_CIRCLE,iconCls:"animation-exit-shape",displayValue:this.textShape,familyEffect:"shape"},{group:"menu-effect-group-exit",value:AscFormat.EXIT_WHEEL,iconCls:"animation-exit-wheel",displayValue:this.textWheel},{group:"menu-effect-group-exit",value:AscFormat.EXIT_RANDOM_BARS,iconCls:"animation-exit-random-bars",displayValue:this.textRandomBars},{group:"menu-effect-group-exit",value:AscFormat.EXIT_SHRINK_AND_TURN,iconCls:"animation-exit-shrink-turn",displayValue:this.textShrinkTurn},{group:"menu-effect-group-exit",value:AscFormat.EXIT_ZOOM,iconCls:"animation-exit-zoom",displayValue:this.textZoom},{group:"menu-effect-group-exit",value:AscFormat.EXIT_SWIVEL,iconCls:"animation-exit-swivel",displayValue:this.textSwivel},{group:"menu-effect-group-exit",value:AscFormat.EXIT_BOUNCE,iconCls:"animation-exit-bounce",displayValue:this.textBounce},{group:"menu-effect-group-path",value:AscFormat.MOTION_DOWN,iconCls:"animation-motion-paths-lines",displayValue:this.textLines,familyEffect:"pathlines"},{group:"menu-effect-group-path",value:AscFormat.MOTION_ARC_DOWN,iconCls:"animation-motion-paths-arcs",displayValue:this.textArcs,familyEffect:"patharcs"},{group:"menu-effect-group-path",value:AscFormat.MOTION_TURN_DOWN,iconCls:"animation-motion-paths-turns",displayValue:this.textTurns,familyEffect:"pathturns"},{group:"menu-effect-group-path",value:AscFormat.MOTION_CIRCLE,iconCls:"animation-motion-paths-shapes",displayValue:this.textShapes,familyEffect:"pathshapes"},{group:"menu-effect-group-path",value:AscFormat.MOTION_HORIZONTAL_FIGURE_8_FOUR,iconCls:"animation-motion-paths-loops",displayValue:this.textLoops,familyEffect:"pathloops"},{group:"menu-effect-group-path",value:AscFormat.MOTION_CUSTOM_PATH,iconCls:"animation-motion-paths-custom-path",displayValue:this.textCustomPath}]},getLevelEffect:function(t){return t?[{id:"menu-effect-level-basic",displayValue:this.textBasic},{id:"menu-effect-level-lines_curves",displayValue:this.textSubtle},{id:"menu-effect-level-special",displayValue:this.textModerate}]:[{id:"menu-effect-level-basic",displayValue:this.textBasic},{id:"menu-effect-level-subtle",displayValue:this.textSubtle},{id:"menu-effect-level-moderate",displayValue:this.textModerate},{id:"menu-effect-level-exciting",displayValue:this.textExciting}]},getEffectFullData:function(){return[{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_APPEAR,displayValue:this.textAppear},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_BLINDS,displayValue:this.textBlinds},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_BOX,displayValue:this.textBox,familyEffect:"entrshape"},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_CHECKERBOARD,displayValue:this.textCheckerboard},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_CIRCLE,displayValue:this.textCircle,familyEffect:"entrshape"},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_DIAMOND,displayValue:this.textDiamond,familyEffect:"entrshape"},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_DISSOLVE_IN,displayValue:this.textDissolveIn},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_FLY_IN_FROM,displayValue:this.textFlyIn},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_PEEK_IN_FROM,displayValue:this.textPeekIn},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_PLUS,displayValue:this.textPlus,familyEffect:"entrshape"},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_RANDOM_BARS,displayValue:this.textRandomBars},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_SPLIT,displayValue:this.textSplit},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_STRIPS,displayValue:this.textStrips},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_WEDGE,displayValue:this.textWedge},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_WHEEL,displayValue:this.textWheel},{group:"menu-effect-group-entrance",level:"menu-effect-level-basic",value:AscFormat.ENTRANCE_WIPE_FROM,displayValue:this.textWipe},{group:"menu-effect-group-entrance",level:"menu-effect-level-subtle",value:AscFormat.ENTRANCE_EXPAND,displayValue:this.textExpand},{group:"menu-effect-group-entrance",level:"menu-effect-level-subtle",value:AscFormat.ENTRANCE_FADE,displayValue:this.textFade},{group:"menu-effect-group-entrance",level:"menu-effect-level-subtle",value:AscFormat.ENTRANCE_SWIVEL,displayValue:this.textSwivel},{group:"menu-effect-group-entrance",level:"menu-effect-level-subtle",value:AscFormat.ENTRANCE_ZOOM,displayValue:this.textZoom},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_BASIC_ZOOM,displayValue:this.textBasicZoom},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_CENTER_REVOLVE,displayValue:this.textCenterRevolve},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_CENTER_COMPRESS,displayValue:this.textCompress},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_FLOAT_DOWN,displayValue:this.textFloatDown,familyEffect:"entrfloat"},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_FLOAT_UP,displayValue:this.textFloatUp,familyEffect:"entrfloat"},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_GROW_AND_TURN,displayValue:this.textGrowTurn},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_RISE_UP,displayValue:this.textRiseUp},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_SPINNER,displayValue:this.textSpinner},{group:"menu-effect-group-entrance",level:"menu-effect-level-moderate",value:AscFormat.ENTRANCE_STRETCH,displayValue:this.textStretch},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_BASIC_SWIVEL,displayValue:this.textBasicSwivel},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_BOOMERANG,displayValue:this.textBoomerang},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_BOUNCE,displayValue:this.textBounce},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_CREDITS,displayValue:this.textCredits},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_CURVE_UP,displayValue:this.textCuverUp},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_DROP,displayValue:this.textDrop},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_FLIP,displayValue:this.textFlip},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_FLOAT,displayValue:this.textFloat},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_PINWHEEL,displayValue:this.textPinwheel},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_SPIRAL_IN,displayValue:this.textSpiralIn},{group:"menu-effect-group-entrance",level:"menu-effect-level-exciting",value:AscFormat.ENTRANCE_WHIP,displayValue:this.textWhip},{group:"menu-effect-group-emphasis",level:"menu-effect-level-basic",value:AscFormat.EMPHASIS_FILL_COLOR,displayValue:this.textFillColor},{group:"menu-effect-group-emphasis",level:"menu-effect-level-basic",value:AscFormat.EMPHASIS_GROW_SHRINK,displayValue:this.textGrowShrink},{group:"menu-effect-group-emphasis",level:"menu-effect-level-basic",value:AscFormat.EMPHASIS_FONT_COLOR,displayValue:this.textFontColor,notsupported:!0},{group:"menu-effect-group-emphasis",level:"menu-effect-level-basic",value:AscFormat.EMPHASIS_LINE_COLOR,displayValue:this.textLineColor},{group:"menu-effect-group-emphasis",level:"menu-effect-level-basic",value:AscFormat.EMPHASIS_SPIN,displayValue:this.textSpin},{group:"menu-effect-group-emphasis",level:"menu-effect-level-basic",value:AscFormat.EMPHASIS_TRANSPARENCY,displayValue:this.textTransparency},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_BOLD_FLASH,displayValue:this.textBoldFlash,notsupported:!0},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_COMPLEMENTARY_COLOR,displayValue:this.textComplementaryColor},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_COMPLEMENTARY_COLOR_2,displayValue:this.textComplementaryColor2},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_CONTRASTING_COLOR,displayValue:this.textContrastingColor},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_CONTRASTING_DARKEN,displayValue:this.textDarken},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_DESATURATE,displayValue:this.textDesaturate},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_LIGHTEN,displayValue:this.textLighten},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_OBJECT_COLOR,displayValue:this.textObjectColor},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_PULSE,displayValue:this.textPulse},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_UNDERLINE,displayValue:this.textUnderline,notsupported:!0},{group:"menu-effect-group-emphasis",level:"menu-effect-level-subtle",value:AscFormat.EMPHASIS_BRUSH_COLOR,displayValue:this.textBrushColor,notsupported:!0},{group:"menu-effect-group-emphasis",level:"menu-effect-level-moderate",value:AscFormat.EMPHASIS_COLOR_PULSE,displayValue:this.textColorPulse},{group:"menu-effect-group-emphasis",level:"menu-effect-level-moderate",value:AscFormat.EMPHASIS_GROW_WITH_COLOR,displayValue:this.textGrowWithColor},{group:"menu-effect-group-emphasis",level:"menu-effect-level-moderate",value:AscFormat.EMPHASIS_SHIMMER,displayValue:this.textShimmer},{group:"menu-effect-group-emphasis",level:"menu-effect-level-moderate",value:AscFormat.EMPHASIS_TEETER,displayValue:this.textTeeter},{group:"menu-effect-group-emphasis",level:"menu-effect-level-exciting",value:AscFormat.EMPHASIS_BLINK,displayValue:this.textBlink},{group:"menu-effect-group-emphasis",level:"menu-effect-level-exciting",value:AscFormat.EMPHASIS_BOLD_REVEAL,displayValue:this.textBoldReveal,notsupported:!0},{group:"menu-effect-group-emphasis",level:"menu-effect-level-exciting",value:AscFormat.EMPHASIS_WAVE,displayValue:this.textWave,notsupported:!0},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_BLINDS,displayValue:this.textBlinds},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_BOX,displayValue:this.textBox,familyEffect:"shape"},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_CHECKERBOARD,displayValue:this.textCheckerboard},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_CIRCLE,displayValue:this.textCircle,familyEffect:"shape"},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_DIAMOND,displayValue:this.textDiamond,familyEffect:"shape"},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_DISAPPEAR,displayValue:this.textDisappear},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_DISSOLVE_OUT,displayValue:this.textDissolveOut},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_FLY_OUT_TO,displayValue:this.textFlyOut},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_PEEK_OUT_TO,displayValue:this.textPeekOut},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_PLUS,displayValue:this.textPlus,familyEffect:"shape"},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_RANDOM_BARS,displayValue:this.textRandomBars},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_SPLIT,displayValue:this.textSplit},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_STRIPS,displayValue:this.textStrips},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_WEDGE,displayValue:this.textWedge},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_WHEEL,displayValue:this.textWheel},{group:"menu-effect-group-exit",level:"menu-effect-level-basic",value:AscFormat.EXIT_WIPE_FROM,displayValue:this.textWipe},{group:"menu-effect-group-exit",level:"menu-effect-level-subtle",value:AscFormat.EXIT_CONTRACT,displayValue:this.textContrast},{group:"menu-effect-group-exit",level:"menu-effect-level-subtle",value:AscFormat.EXIT_FADE,displayValue:this.textFade},{group:"menu-effect-group-exit",level:"menu-effect-level-subtle",value:AscFormat.EXIT_SWIVEL,displayValue:this.textSwivel},{group:"menu-effect-group-exit",level:"menu-effect-level-subtle",value:AscFormat.EXIT_ZOOM,displayValue:this.textZoom},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_BASIC_ZOOM,displayValue:this.textBasicZoom},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_CENTER_REVOLVE,displayValue:this.textCenterRevolve},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_COLLAPSE,displayValue:this.textCollapse},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_FLOAT_DOWN,displayValue:this.textFloatDown,familyEffect:"exitfloat"},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_FLOAT_UP,displayValue:this.textFloatUp,familyEffect:"exitfloat"},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_SHRINK_AND_TURN,displayValue:this.textShrinkTurn},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_SINK_DOWN,displayValue:this.textSinkDown},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_SPINNER,displayValue:this.textSpinner},{group:"menu-effect-group-exit",level:"menu-effect-level-moderate",value:AscFormat.EXIT_STRETCHY,displayValue:this.textStretch},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_BASIC_SWIVEL,displayValue:this.textBasicSwivel},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_BOOMERANG,displayValue:this.textBoomerang},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_BOUNCE,displayValue:this.textBounce},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_CREDITS,displayValue:this.textCredits},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_CURVE_DOWN,displayValue:this.textCurveDown},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_DROP,displayValue:this.textDrop},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_FLIP,displayValue:this.textFlip},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_FLOAT,displayValue:this.textFloat},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_PINWHEEL,displayValue:this.textPinwheel},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_SPIRAL_OUT,displayValue:this.textSpiralOut},{group:"menu-effect-group-exit",level:"menu-effect-level-exciting",value:AscFormat.EXIT_WHIP,displayValue:this.textWhip},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_PATH_4_POINT_STAR,displayValue:this.textPointStar4},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_PATH_5_POINT_STAR,displayValue:this.textPointStar5},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_PATH_6_POINT_STAR,displayValue:this.textPointStar6},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_PATH_8_POINT_STAR,displayValue:this.textPointStar8},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_CIRCLE,displayValue:this.textCircle,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_CRESCENT_MOON,displayValue:this.textCrescentMoon},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_DIAMOND,displayValue:this.textDiamond,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_EQUAL_TRIANGLE,displayValue:this.textEqualTriangle,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_FOOTBALL,displayValue:this.textFootball},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_HEART,displayValue:this.textHeart},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_HEXAGON,displayValue:this.textHexagon,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_OCTAGON,displayValue:this.textOctagon,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_PARALLELOGRAM,displayValue:this.textParallelogram,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_PENTAGON,displayValue:this.textPentagon,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_RIGHT_TRIANGLE,displayValue:this.textRightTriangle,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_SQUARE,displayValue:this.textSquare,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_TEARDROP,displayValue:this.textTeardrop},{group:"menu-effect-group-path",level:"menu-effect-level-basic",value:AscFormat.MOTION_TRAPEZOID,displayValue:this.textTrapezoid,familyEffect:"pathshapes"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_ARC_DOWN,displayValue:this.textArcDown,familyEffect:"patharcs"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_ARC_LEFT,displayValue:this.textArcLeft,familyEffect:"patharcs"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_ARC_RIGHT,displayValue:this.textArcRight,familyEffect:"patharcs"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_ARC_UP,displayValue:this.textArcUp,familyEffect:"patharcs"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_BOUNCE_LEFT,displayValue:this.textBounceLeft},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_BOUNCE_RIGHT,displayValue:this.textBounceRight},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_CURVY_LEFT,displayValue:this.textCurvyLeft},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_CURVY_RIGHT,displayValue:this.textCurvyRight},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_DECAYING_WAVE,displayValue:this.textDecayingWave},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_DIAGONAL_DOWN_RIGHT,displayValue:this.textDiagonalDownRight},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_DIAGONAL_UP_RIGHT,displayValue:this.textDiagonalUpRight},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_DOWN,displayValue:this.textDown,familyEffect:"pathlines"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_FUNNEL,displayValue:this.textFunnel},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_HEARTBEAT,displayValue:this.textHeartbeat},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_LEFT,displayValue:this.textLeft,familyEffect:"pathlines"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_RIGHT,displayValue:this.textRight,familyEffect:"pathlines"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_S_CURVE_1,displayValue:this.textSCurve1},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_S_CURVE_2,displayValue:this.textSCurve2},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_SINE_WAVE,displayValue:this.textSineWave},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_SINE_SPIRAL_LEFT,displayValue:this.textSpiralLeft},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_SINE_SPIRAL_RIGHT,displayValue:this.textSpiralRight},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_SPRING,displayValue:this.textSpring},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_STAIRS_DOWN,displayValue:this.textStairsDown},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_TURN_DOWN,displayValue:this.textTurnDown,familyEffect:"pathturns"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_TURN_DOWN_RIGHT,displayValue:this.textTurnDownRight,familyEffect:"pathturns"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_TURN_UP,displayValue:this.textTurnUp,familyEffect:"pathturns"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_TURN_UP_RIGHT,displayValue:this.textTurnUpRight,familyEffect:"pathturns"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_UP,displayValue:this.textUp,familyEffect:"pathlines"},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_WAVE,displayValue:this.textWave},{group:"menu-effect-group-path",level:"menu-effect-level-lines_curves",value:AscFormat.MOTION_ZIGZAG,displayValue:this.textZigzag},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_BEAN,displayValue:this.textBean},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_CURVED_SQUARE,displayValue:this.textCurvedSquare},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_CURVED_X,displayValue:this.textCurvedX},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_CURVY_STAR,displayValue:this.textCurvyStar},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_FIGURE_8_FOUR,displayValue:this.textFigureFour},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_HORIZONTAL_FIGURE_8_FOUR,displayValue:this.textHorizontalFigure,familyEffect:"pathloops"},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_INVERTED_SQUARE,displayValue:this.textInvertedSquare},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_INVERTED_TRIANGLE,displayValue:this.textInvertedTriangle},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_LOOP_DE_LOOP,displayValue:this.textLoopDeLoop,familyEffect:"pathloops"},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_NEUTRON,displayValue:this.textNeutron},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_PEANUT,displayValue:this.textPeanut},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_POINTY_STAR,displayValue:this.textPointStar},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_SWOOSH,displayValue:this.textSwoosh},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_VERTICAL_FIGURE_8,displayValue:this.textVerticalFigure,familyEffect:"pathloops"},{group:"menu-effect-group-path",level:"menu-effect-level-special",value:AscFormat.MOTION_CUSTOM_PATH,displayValue:this.textCustomPath,notsupported:!0}]},getEffectOptionsData:function(t,e){switch(t){case"menu-effect-group-entrance":switch(e){case AscFormat.ENTRANCE_BLINDS:return[{value:AscFormat.ENTRANCE_BLINDS_HORIZONTAL,caption:this.textHorizontal,defvalue:!0},{value:AscFormat.ENTRANCE_BLINDS_VERTICAL,caption:this.textVertical}];case AscFormat.ENTRANCE_BOX:return[{value:AscFormat.ENTRANCE_BOX_IN,caption:this.textIn,defvalue:!0},{value:AscFormat.ENTRANCE_BOX_OUT,caption:this.textOut}];case AscFormat.ENTRANCE_CHECKERBOARD:return[{value:AscFormat.ENTRANCE_CHECKERBOARD_ACROSS,caption:this.textAcross,defvalue:!0},{value:AscFormat.ENTRANCE_CHECKERBOARD_DOWN,caption:this.textDown}];case AscFormat.ENTRANCE_CIRCLE:return[{value:AscFormat.ENTRANCE_CIRCLE_IN,caption:this.textIn,defvalue:!0},{value:AscFormat.ENTRANCE_CIRCLE_OUT,caption:this.textOut}];case AscFormat.ENTRANCE_DIAMOND:return[{value:AscFormat.ENTRANCE_DIAMOND_IN,caption:this.textIn,defvalue:!0},{value:AscFormat.ENTRANCE_DIAMOND_OUT,caption:this.textOut}];case AscFormat.ENTRANCE_FLY_IN_FROM:return[{value:AscFormat.ENTRANCE_FLY_IN_FROM_BOTTOM,caption:this.textFromBottom,defvalue:!0},{value:AscFormat.ENTRANCE_FLY_IN_FROM_BOTTOM_LEFT,caption:this.textFromBottomLeft},{value:AscFormat.ENTRANCE_FLY_IN_FROM_LEFT,caption:this.textFromLeft},{value:AscFormat.ENTRANCE_FLY_IN_FROM_TOP_LEFT,caption:this.textFromTopLeft},{value:AscFormat.ENTRANCE_FLY_IN_FROM_TOP,caption:this.textFromTop},{value:AscFormat.ENTRANCE_FLY_IN_FROM_TOP_RIGHT,caption:this.textFromTopRight},{value:AscFormat.ENTRANCE_FLY_IN_FROM_RIGHT,caption:this.textFromRight},{value:AscFormat.ENTRANCE_FLY_IN_FROM_BOTTOM_RIGHT,caption:this.textFromBottomRight}];case AscFormat.ENTRANCE_PEEK_IN_FROM:return[{value:AscFormat.ENTRANCE_PEEK_IN_FROM_BOTTOM,caption:this.textFromBottom,defvalue:!0},{value:AscFormat.ENTRANCE_PEEK_IN_FROM_LEFT,caption:this.textFromLeft},{value:AscFormat.ENTRANCE_PEEK_IN_FROM_RIGHT,caption:this.textFromRight},{value:AscFormat.ENTRANCE_PEEK_IN_FROM_TOP,caption:this.textFromTop}];case AscFormat.ENTRANCE_PLUS:return[{value:AscFormat.ENTRANCE_PLUS_IN,caption:this.textIn,defvalue:!0},{value:AscFormat.ENTRANCE_PLUS_OUT,caption:this.textOut}];case AscFormat.ENTRANCE_RANDOM_BARS:return[{value:AscFormat.ENTRANCE_RANDOM_BARS_HORIZONTAL,caption:this.textHorizontal,defvalue:!0},{value:AscFormat.ENTRANCE_RANDOM_BARS_VERTICAL,caption:this.textVertical}];case AscFormat.ENTRANCE_SPLIT:return[{value:AscFormat.ENTRANCE_SPLIT_HORIZONTAL_IN,caption:this.textHorizontalIn},{value:AscFormat.ENTRANCE_SPLIT_HORIZONTAL_OUT,caption:this.textHorizontalOut},{value:AscFormat.ENTRANCE_SPLIT_VERTICAL_IN,caption:this.textVerticalIn,defvalue:!0},{value:AscFormat.ENTRANCE_SPLIT_VERTICAL_OUT,caption:this.textVerticalOut}];case AscFormat.ENTRANCE_STRIPS:return[{value:AscFormat.ENTRANCE_STRIPS_LEFT_DOWN,caption:this.textLeftDown,defvalue:!0},{value:AscFormat.ENTRANCE_STRIPS_LEFT_UP,caption:this.textLeftUp},{value:AscFormat.ENTRANCE_STRIPS_RIGHT_DOWN,caption:this.textRightDown},{value:AscFormat.ENTRANCE_STRIPS_RIGHT_UP,caption:this.textRightUp}];case AscFormat.ENTRANCE_WHEEL:return[{value:AscFormat.ENTRANCE_WHEEL_1_SPOKE,caption:this.textSpoke1,defvalue:!0},{value:AscFormat.ENTRANCE_WHEEL_2_SPOKES,caption:this.textSpoke2},{value:AscFormat.ENTRANCE_WHEEL_3_SPOKES,caption:this.textSpoke3},{value:AscFormat.ENTRANCE_WHEEL_4_SPOKES,caption:this.textSpoke4},{value:AscFormat.ENTRANCE_WHEEL_8_SPOKES,caption:this.textSpoke8}];case AscFormat.ENTRANCE_WIPE_FROM:return[{value:AscFormat.ENTRANCE_WIPE_FROM_BOTTOM,caption:this.textFromBottom,defvalue:!0},{value:AscFormat.ENTRANCE_WIPE_FROM_LEFT,caption:this.textFromLeft},{value:AscFormat.ENTRANCE_WIPE_FROM_RIGHT,caption:this.textFromRight},{value:AscFormat.ENTRANCE_WIPE_FROM_TOP,caption:this.textFromTop}];case AscFormat.ENTRANCE_ZOOM:return[{value:AscFormat.ENTRANCE_ZOOM_OBJECT_CENTER,caption:this.textObjectCenter,defvalue:!0},{value:AscFormat.ENTRANCE_ZOOM_SLIDE_CENTER,caption:this.textSlideCenter}];case AscFormat.ENTRANCE_BASIC_ZOOM:return[{value:AscFormat.ENTRANCE_BASIC_ZOOM_IN,caption:this.textIn,defvalue:!0},{value:AscFormat.ENTRANCE_BASIC_ZOOM_IN_FROM_SCREEN_CENTER,caption:this.textInFromScreenCenter},{value:AscFormat.ENTRANCE_BASIC_ZOOM_IN_SLIGHTLY,caption:this.textInSlightly},{value:AscFormat.ENTRANCE_BASIC_ZOOM_OUT,caption:this.textOut},{value:AscFormat.ENTRANCE_BASIC_ZOOM_OUT_FROM_SCREEN_BOTTOM,caption:this.textOutFromScreenBottom},{value:AscFormat.ENTRANCE_BASIC_ZOOM_OUT_SLIGHTLY,caption:this.textOutSlightly}];case AscFormat.ENTRANCE_STRETCH:return[{value:AscFormat.ENTRANCE_STRETCH_ACROSS,caption:this.textAcross,defvalue:!0},{value:AscFormat.ENTRANCE_STRETCH_FROM_BOTTOM,caption:this.textFromBottom},{value:AscFormat.ENTRANCE_STRETCH_FROM_LEFT,caption:this.textFromLeft},{value:AscFormat.ENTRANCE_STRETCH_FROM_RIGHT,caption:this.textFromRight},{value:AscFormat.ENTRANCE_STRETCH_FROM_TOP,caption:this.textFromTop}];case AscFormat.ENTRANCE_BASIC_SWIVEL:return[{value:AscFormat.ENTRANCE_BASIC_SWIVEL_HORIZONTAL,caption:this.textHorizontal,defvalue:!0},{value:AscFormat.ENTRANCE_BASIC_SWIVEL_VERTICAL,caption:this.textVertical}];default:return}break;case"menu-effect-group-exit":switch(e){case AscFormat.EXIT_BLINDS:return[{value:AscFormat.EXIT_BLINDS_HORIZONTAL,caption:this.textHorizontal,defvalue:!0},{value:AscFormat.EXIT_BLINDS_VERTICAL,caption:this.textVertical}];case AscFormat.EXIT_BOX:return[{value:AscFormat.EXIT_BOX_IN,caption:this.textIn},{value:AscFormat.EXIT_BOX_OUT,caption:this.textOut,defvalue:!0}];case AscFormat.EXIT_CHECKERBOARD:return[{value:AscFormat.EXIT_CHECKERBOARD_ACROSS,caption:this.textAcross,defvalue:!0},{value:AscFormat.EXIT_CIRCLE_OUT,caption:this.textUp}];case AscFormat.EXIT_CIRCLE:return[{value:AscFormat.EXIT_CIRCLE_IN,caption:this.textIn},{value:AscFormat.EXIT_CIRCLE_OUT,caption:this.textOut,defvalue:!0}];case AscFormat.EXIT_DIAMOND:return[{value:AscFormat.EXIT_DIAMOND_IN,caption:this.textIn},{value:AscFormat.EXIT_DIAMOND_OUT,caption:this.textOut,defvalue:!0}];case AscFormat.EXIT_FLY_OUT_TO:return[{value:AscFormat.EXIT_FLY_OUT_TO_BOTTOM,caption:this.textToBottom,defvalue:!0},{value:AscFormat.EXIT_FLY_OUT_TO_BOTTOM_LEFT,caption:this.textToBottomLeft},{value:AscFormat.EXIT_FLY_OUT_TO_LEFT,caption:this.textToLeft},{value:AscFormat.EXIT_FLY_OUT_TO_TOP_LEFT,caption:this.textToTopLeft},{value:AscFormat.EXIT_FLY_OUT_TO_TOP,caption:this.textToTop},{value:AscFormat.EXIT_FLY_OUT_TO_TOP_RIGHT,caption:this.textToTopRight},{value:AscFormat.EXIT_FLY_OUT_TO_RIGHT,caption:this.textToRight},{value:AscFormat.EXIT_FLY_OUT_TO_BOTTOM_RIGHT,caption:this.textToBottomRight}];case AscFormat.EXIT_PEEK_OUT_TO:return[{value:AscFormat.EXIT_PEEK_OUT_TO_BOTTOM,caption:this.textToBottom,defvalue:!0},{value:AscFormat.EXIT_PEEK_OUT_TO_LEFT,caption:this.textToLeft},{value:AscFormat.EXIT_PEEK_OUT_TO_RIGHT,caption:this.textToRight},{value:AscFormat.EXIT_PEEK_OUT_TO_TOP,caption:this.textToTop}];case AscFormat.EXIT_PLUS:return[{value:AscFormat.EXIT_PLUS_IN,caption:this.textIn},{value:AscFormat.EXIT_PLUS_OUT,caption:this.textOut,defvalue:!0}];case AscFormat.EXIT_RANDOM_BARS:return[{value:AscFormat.EXIT_RANDOM_BARS_HORIZONTAL,caption:this.textHorizontal,defvalue:!0},{value:AscFormat.EXIT_RANDOM_BARS_VERTICAL,caption:this.textVertical}];case AscFormat.EXIT_SPLIT:return[{value:AscFormat.EXIT_SPLIT_HORIZONTAL_IN,caption:this.textHorizontalIn},{value:AscFormat.EXIT_SPLIT_HORIZONTAL_OUT,caption:this.textHorizontalOut},{value:AscFormat.EXIT_SPLIT_VERTICAL_IN,caption:this.textVerticalIn,defvalue:!0},{value:AscFormat.EXIT_SPLIT_VERTICAL_OUT,caption:this.textVerticalOut}];case AscFormat.EXIT_STRIPS:return[{value:AscFormat.EXIT_STRIPS_LEFT_DOWN,caption:this.textLeftDown,defvalue:!0},{value:AscFormat.EXIT_STRIPS_LEFT_UP,caption:this.textLeftUp},{value:AscFormat.EXIT_STRIPS_RIGHT_DOWN,caption:this.textRightDown},{value:AscFormat.EXIT_STRIPS_RIGHT_UP,caption:this.textRightUp}];case AscFormat.EXIT_WHEEL:return[{value:AscFormat.EXIT_WHEEL_1_SPOKE,caption:this.textSpoke1,defvalue:!0},{value:AscFormat.EXIT_WHEEL_2_SPOKES,caption:this.textSpoke2},{value:AscFormat.EXIT_WHEEL_3_SPOKES,caption:this.textSpoke3},{value:AscFormat.EXIT_WHEEL_4_SPOKES,caption:this.textSpoke4},{value:AscFormat.EXIT_WHEEL_8_SPOKES,caption:this.textSpoke8}];case AscFormat.EXIT_WIPE_FROM:return[{value:AscFormat.EXIT_WIPE_FROM_BOTTOM,caption:this.textFromBottom,defvalue:!0},{value:AscFormat.EXIT_WIPE_FROM_LEFT,caption:this.textFromLeft},{value:AscFormat.EXIT_WIPE_FROM_RIGHT,caption:this.textFromRight},{value:AscFormat.EXIT_WIPE_FROM_TOP,caption:this.textFromTop}];case AscFormat.EXIT_ZOOM:return[{value:AscFormat.EXIT_ZOOM_OBJECT_CENTER,caption:this.textObjectCenter,defvalue:!0},{value:AscFormat.EXIT_ZOOM_SLIDE_CENTER,caption:this.textSlideCenter}];case AscFormat.EXIT_BASIC_ZOOM:return[{value:AscFormat.EXIT_BASIC_ZOOM_OUT,caption:this.textOut,defvalue:!0},{value:AscFormat.EXIT_BASIC_ZOOM_OUT_TO_SCREEN_CENTER,caption:this.textOutToScreenCenter},{value:AscFormat.EXIT_BASIC_ZOOM_OUT_SLIGHTLY,caption:this.textOutSlightly},{value:AscFormat.EXIT_BASIC_ZOOM_IN,caption:this.textIn},{value:AscFormat.EXIT_BASIC_ZOOM_IN_TO_SCREEN_BOTTOM,caption:this.textInToScreenBottom},{value:AscFormat.EXIT_BASIC_ZOOM_IN_SLIGHTLY,caption:this.textInSlightly}];case AscFormat.EXIT_COLLAPSE:return[{value:AscFormat.EXIT_COLLAPSE_ACROSS,caption:this.textAcross,defvalue:!0},{value:AscFormat.EXIT_COLLAPSE_TO_BOTTOM,caption:this.textToBottom},{value:AscFormat.EXIT_COLLAPSE_TO_LEFT,caption:this.textToLeft},{value:AscFormat.EXIT_COLLAPSE_TO_RIGHT,caption:this.textToRight},{value:AscFormat.EXIT_COLLAPSE_TO_TOP,caption:this.textToTop}];case AscFormat.EXIT_BASIC_SWIVEL:return[{value:AscFormat.EXIT_BASIC_SWIVEL_HORIZONTAL,caption:this.textHorizontal,defvalue:!0},{value:AscFormat.EXIT_BASIC_SWIVEL_VERTICAL,caption:this.textVertical}];default:return}break;case"menu-effect-group-path":if(e===AscFormat.MOTION_CUSTOM_PATH)return[{value:AscFormat.MOTION_CUSTOM_PATH_CURVE,caption:this.textPathCurve,isCustom:!0},{value:AscFormat.MOTION_CUSTOM_PATH_LINE,caption:this.textPathLine,isCustom:!0},{value:AscFormat.MOTION_CUSTOM_PATH_SCRIBBLE,caption:this.textPathScribble,isCustom:!0}];break;default:return}},getSimilarEffectsArray:function(t){switch(t){case"shape":return[{value:AscFormat.EXIT_CIRCLE,caption:this.textCircle},{value:AscFormat.EXIT_BOX,caption:this.textBox},{value:AscFormat.EXIT_DIAMOND,caption:this.textDiamond},{value:AscFormat.EXIT_PLUS,caption:this.textPlus}];case"entrshape":return[{value:AscFormat.ENTRANCE_CIRCLE,caption:this.textCircle},{value:AscFormat.ENTRANCE_BOX,caption:this.textBox},{value:AscFormat.ENTRANCE_DIAMOND,caption:this.textDiamond},{value:AscFormat.ENTRANCE_PLUS,caption:this.textPlus}];case"pathlines":return[{value:AscFormat.MOTION_DOWN,caption:this.textDown},{value:AscFormat.MOTION_LEFT,caption:this.textLeft},{value:AscFormat.MOTION_RIGHT,caption:this.textRight},{value:AscFormat.MOTION_UP,caption:this.textUp}];case"patharcs":return[{value:AscFormat.MOTION_ARC_DOWN,caption:this.textArcDown},{value:AscFormat.MOTION_ARC_LEFT,caption:this.textArcLeft},{value:AscFormat.MOTION_ARC_RIGHT,caption:this.textArcRight},{value:AscFormat.MOTION_ARC_UP,caption:this.textArcUp}];case"pathturns":return[{value:AscFormat.MOTION_TURN_DOWN,caption:this.textTurnDown},{value:AscFormat.MOTION_TURN_DOWN_RIGHT,caption:this.textTurnDownRight},{value:AscFormat.MOTION_TURN_UP,caption:this.textTurnUp},{value:AscFormat.MOTION_TURN_UP_RIGHT,caption:this.textTurnUpRight}];case"pathshapes":return[{value:AscFormat.MOTION_CIRCLE,caption:this.textCircle},{value:AscFormat.MOTION_DIAMOND,caption:this.textDiamond},{value:AscFormat.MOTION_EQUAL_TRIANGLE,caption:this.textEqualTriangle},{value:AscFormat.MOTION_HEXAGON,caption:this.textHexagon},{value:AscFormat.MOTION_OCTAGON,caption:this.textOctagon},{value:AscFormat.MOTION_PARALLELOGRAM,caption:this.textParallelogram},{value:AscFormat.MOTION_PENTAGON,caption:this.textPentagon},{value:AscFormat.MOTION_RIGHT_TRIANGLE,caption:this.textRightTriangle},{value:AscFormat.MOTION_SQUARE,caption:this.textSquare},{value:AscFormat.MOTION_TRAPEZOID,caption:this.textTrapezoid}];case"pathloops":return[{value:AscFormat.MOTION_HORIZONTAL_FIGURE_8_FOUR,caption:this.textHorizontalFigure},{value:AscFormat.MOTION_VERTICAL_FIGURE_8,caption:this.textVerticalFigure},{value:AscFormat.MOTION_LOOP_DE_LOOP,caption:this.textLoopDeLoop}];case"entrfloat":return[{value:AscFormat.ENTRANCE_FLOAT_UP,caption:this.textFloatUp},{value:AscFormat.ENTRANCE_FLOAT_DOWN,caption:this.textFloatDown}];case"exitfloat":return[{value:AscFormat.EXIT_FLOAT_UP,caption:this.textFloatUp},{value:AscFormat.EXIT_FLOAT_DOWN,caption:this.textFloatDown}];default:return[]}}}},Common.define.effectData||{})})),define("text!spreadsheeteditor/main/app/template/Toolbar.template",[],(function(){return'<section class="toolbar">\n    <section class="box-tabs">\n        <div class="extra left"></div>\n        <%= tabsmarkup %>\n        <div class="extra right"></div>\n    </section>\n    <section class="box-controls">\n        <section class="panel static">\n            <div class="group no-mask small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-print"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-save" data-layout-name="toolbar-save"></span>\n                </div>\n            </div>\n            <div class="separator long"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot" id="slot-btn-paste"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-cut"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-select-all"></span>\n                </div>\n            </div>\n            <div class="separator long"></div>\n        </section>\n        <section class="box-panels">\n            <section class="panel" data-tab="home">\n                <div class="group small">\n                    <div class="elset font-attr-top">\n                        <span class="btn-slot" id="slot-field-fontname" style="width: 127px;"></span>\n                        <span class="btn-slot" id="slot-field-fontsize"></span>\n                        <span class="btn-slot" id="slot-btn-incfont"></span>\n                        <span class="btn-slot" id="slot-btn-decfont"></span>\n                    </div>\n                    <div class="elset font-attr">\n                        <span class="btn-slot" id="slot-btn-bold"></span>\n                        <span class="btn-slot" id="slot-btn-italic"></span>\n                        <span class="btn-slot" id="slot-btn-underline"></span>\n                        <span class="btn-slot" id="slot-btn-strikeout"></span>\n                        <span class="btn-slot split" id="slot-btn-subscript"></span>\n                        <span class="btn-slot split" id="slot-btn-fontcolor"></span>\n                        <span class="btn-slot split" id="slot-btn-fillparag"></span>\n                        <span class="btn-slot split" id="slot-btn-borders"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split-small" id="slot-btn-top"></span>\n                        <span class="btn-slot split-small" id="slot-btn-middle"></span>\n                        <span class="btn-slot split-small" id="slot-btn-bottom"></span>\n                        <span class="btn-slot split-small" id="slot-btn-wrap"></span>\n                        <span class="btn-slot split" id="slot-btn-text-orient"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split-small" id="slot-btn-align-left"></span>\n                        <span class="btn-slot split-small" id="slot-btn-align-center"></span>\n                        <span class="btn-slot split-small" id="slot-btn-align-right"></span>\n                        <span class="btn-slot split-small" id="slot-btn-align-just"></span>\n                        <span class="btn-slot split" id="slot-btn-merge"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-formula"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-named-range"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split slot-sortdesc"></span>\n                        <span class="btn-slot slot-sortasc"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split slot-btn-setfilter"></span>\n                        <span class="btn-slot slot-btn-clear-filter"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot" id="slot-btn-format" style="width: 100%"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-percents"></span>\n                        <span class="btn-slot split" id="slot-btn-currency"></span>\n                        <span class="btn-slot split" id="slot-btn-digit-dec"></span>\n                        <span class="btn-slot" id="slot-btn-digit-inc"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-cell-ins"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-cell-del"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-clear"></span>\n                        <span class="btn-slot split" id="slot-btn-condformat"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-copystyle"></span>\n                        <span class="btn-slot split" id="slot-btn-table-tpl"></span>\n                    </div>\n                </div>\n                <div class="separator long invisible"></div>\n                <div class="group small flex field-styles" id="slot-field-styles" style="min-width: 168px;width: 100%;" data-group-width="100%"></div>\n            </section>\n            <section class="panel" data-tab="ins">\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-add-pivot"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-instable"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insimage"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-insshape"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-instext"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-instextart"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inschart"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inssparkline"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-comment"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inshyperlink"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-editheader"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insequation"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inssymbol"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insslicer"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="layout">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-pagemargins"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pageorient"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pagesize"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-printarea"></span>\n                    <span class="btn-slot text x-huge slot-editheader"></span>\n                    <span class="btn-slot text" id="slot-btn-scale"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-printtitles"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-chk-print-gridlines"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-chk-print-headings"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-img-movefrwd"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-movebkwd"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-align"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-group"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-colorschemas"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="formula">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-additional-formula"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-autosum"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-recent"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-financial"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-logical"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-text"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-datetime"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-lookup"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-math"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-more"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-named-range-huge"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-calculate"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="data">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-data-from-text"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <div class="elset">\n                        <span class="btn-slot split slot-btn-setfilter"></span>\n                        <span class="btn-slot slot-sortdesc"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split slot-btn-clear-filter"></span>\n                        <span class="btn-slot slot-sortasc"></span>\n                    </div>\n                </div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-custom-sort"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-text-column"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-rem-duplicates"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-data-validation"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-group"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-ungroup"></span>\n                </div>\n                \x3c!--<div class="group">--\x3e\n                    \x3c!--<div class="elset">--\x3e\n                        \x3c!--<span class="btn-slot" id="slot-btn-show-details" style="width:auto;"></span>--\x3e\n                    \x3c!--</div>--\x3e\n                    \x3c!--<div class="elset">--\x3e\n                        \x3c!--<span class="btn-slot" id="slot-btn-hide-details" style="width:auto;"></span>--\x3e\n                    \x3c!--</div>--\x3e\n                \x3c!--</div>--\x3e\n            </section>\n        </section>\n    </section>\n</section>'})),define("text!spreadsheeteditor/main/app/template/ToolbarAnother.template",[],(function(){return'<div class="toolbar" style="height: 41px; padding: 10px 0;">\n    <% if ( isEditDiagram ) { %>\n        \x3c!-----------------------\x3e\n        \x3c!-- Edit diagram mode --\x3e\n        \x3c!-----------------------\x3e\n        <section class="simple-bar">\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot split" id="slot-btn-paste"></span>\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-formula"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-digit-dec"></span>\n                    <span class="btn-slot split" id="slot-btn-digit-inc"></span>\n                    <span class="btn-slot" id="slot-btn-format" style="width: 84px; vertical-align: middle;"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot text" id="slot-btn-chart-data"></span>\n                    <span class="btn-slot text" id="slot-btn-chart-type" style="margin-left: 12px;"></span>\n                    <span class="btn-slot" id="slot-btn-chart" style="margin-left: 12px;width: auto;"></span>\n                </div>\n            </div>\n            <div class="group" style="width: 100%;"></div>\n        </section>\n    <% } else if ( isEditMailMerge ) { %>\n        \x3c!-----------------------\x3e\n        \x3c!-- Edit mail merge mode --\x3e\n        \x3c!-----------------------\x3e\n        <section class="simple-bar">\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot split" id="slot-btn-paste"></span>\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-sortdesc"></span>\n                    <span class="btn-slot" id="slot-btn-sortasc"></span>\n                </div>\n            </div>\n            <div class="separator short" style="margin-left: 5px;"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-setfilter"></span>\n                    <span class="btn-slot" id="slot-btn-clear-filter"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-search"></span>\n                </div>\n            </div>\n            <div class="group" style="width: 100%;"></div>\n        </section>\n    <% } else if ( isEditOle ) { %>\n        \x3c!-----------------------\x3e\n        \x3c!-- Edit ole object --\x3e\n        \x3c!-----------------------\x3e\n        <section class="simple-bar">\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split-small" id="slot-btn-copy"></span>\n                    <span class="btn-slot split-small" id="slot-btn-paste"></span>\n                    <span class="btn-slot split-small" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset" style="width: 202px;">\n                    <span class="btn-slot" id="slot-field-fontname" style="width: 100px;float: left;"></span>\n                    <span class="btn-slot" id="slot-field-fontsize" style="margin-left: 2px;float: left;"></span>\n                    <span class="btn-slot split" id="slot-btn-fontcolor" style="margin-left: 2px;margin-top: 1px;float: left;"></span>\n                    <span class="btn-slot" id="slot-btn-formatting" style="margin-left: 2px;margin-top: 1px;float: left;"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset font-attr">\n                    <span class="btn-slot split" id="slot-btn-halign"></span>\n                    <span class="btn-slot split" id="slot-btn-valign"></span>\n                    <span class="btn-slot split-small" id="slot-btn-wrap"></span>\n                    <span class="btn-slot split" id="slot-btn-merge"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset font-attr">\n                    <span class="btn-slot split" id="slot-btn-borders"></span>\n                    <span class="btn-slot split" id="slot-btn-fillparag"></span>\n                    <span class="btn-slot split" id="slot-btn-table-tpl"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-format" style="width: 84px; float: left;"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-formula"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-search"></span>\n                </div>\n            </div>\n            <div class="group" style="width: 100%;"></div>\n            <div class="group small" style="padding-right: 10px;">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-visible-area" style="width: auto;float: left;"></span>\n                    <span class="btn-slot" id="slot-btn-visible-area-close" style="width: auto;float: left;"></span>\n                </div>\n            </div>\n        </section>\n    <% } %>\n</div>'})),define("text!spreadsheeteditor/main/app/template/ToolbarView.template",[],(function(){return'<section class="toolbar toolbar-view">\n    <section class="box-tabs">\n        <div class="extra left"></div>\n        <%= tabsmarkup %>\n        <div class="extra right">\n        </div>\n    </section>\n    <section class="box-controls">\n        <section class="box-panels">\n        </section>\n    </section>\n</section>'})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Font",["backbone"],(function(t){"use strict";Common.Models.Font=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,cloneid:null,imgidx:0,type:0}}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Fonts",["backbone","common/main/lib/model/Font"],(function(t){"use strict";Common.Collections.Fonts=t.Collection.extend({model:Common.Models.Font})})),void 0===Common)var Common={};if(define("common/main/lib/component/ColorPalette",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.ColorPalette=Common.UI.BaseView.extend({options:{allowReselect:!0,cls:"",style:""},template:_.template(['<div class="palette-color">',"<% _.each(colors, function(color, index) { %>",'<span class="color-item" data-color="<%= color %>" style="background-color: #<%= color %>;"></span>',"<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id,this.cls=e.options.cls,this.style=e.options.style,this.colors=e.options.colors||[],this.value=e.options.value,e.options.el&&e.render()},render:function(t){var e=this;return e.rendered?this.cmpEl=e.$el||$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,colors:this.colors})),t?(this.setElement(t,!1),t.html(this.cmpEl)):e.$el.html(this.cmpEl)),e.rendered||e.cmpEl.on("click","span.color-item",e.itemClick.bind(e)),e.rendered=!0,this},itemClick:function(t){var e=$(t.target);this.select(e.attr("data-color"))},select:function(t,e){if(this.value!=t){$("span.color-item",this.cmpEl).removeClass("selected"),this.value=t,t&&/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),$("span[data-color="+t+"]",this.cmpEl).addClass("selected"),e||this.trigger("select",this,this.value))}}})})),void 0===Common)var Common={};if(define("common/main/lib/component/DimensionPicker",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.DimensionPicker=Common.UI.BaseView.extend({options:{itemSize:20,minRows:5,minColumns:5,maxRows:20,maxColumns:20},template:_.template(['<div style="width: 100%; height: 100%;">','<div class="dimension-picker-status">0x0</div>','<div class="dimension-picker-observecontainer">','<div class="dimension-picker-mousecatcher"></div>','<div class="dimension-picker-unhighlighted"></div>','<div class="dimension-picker-highlighted"></div>',"</div>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.render(),this.cmpEl=e.$el||$(this.el);var i=this.cmpEl;e.itemSize=e.options.itemSize,e.minRows=e.options.minRows,e.minColumns=e.options.minColumns,e.maxRows=e.options.maxRows,e.maxColumns=e.options.maxColumns,e.curColumns=0,e.curRows=0;var n=function(t){e.setTableSize(Math.ceil((void 0===t.offsetX?t.originalEvent.layerX:t.offsetX*Common.Utils.zoom())/e.itemSize),Math.ceil((void 0===t.offsetY?t.originalEvent.layerY:t.offsetY*Common.Utils.zoom())/e.itemSize),t)},o=function(t){e.setTableSize(0,0,t)},s=function(t){e.trigger("select",e,e.curColumns,e.curRows,t)};if(i){var a=i.find(".dimension-picker-mousecatcher");e.areaUnHighLighted=i.find(".dimension-picker-unhighlighted"),e.areaHighLighted=i.find(".dimension-picker-highlighted"),e.areaStatus=i.find(".dimension-picker-status"),i.css({width:e.minColumns+"em"}),a.css("z-index",1),a.width(e.maxColumns+"em").height(e.maxRows+"em"),e.areaUnHighLighted.width(e.minColumns+"em").height(e.minRows+"em"),e.areaStatus.html(e.curColumns+" x "+e.curRows),e.areaStatus.width(e.areaUnHighLighted.width()),a.on("mousemove",n),e.areaHighLighted.on("mousemove",n),e.areaUnHighLighted.on("mousemove",n),a.on("mouseleave",o),e.areaHighLighted.on("mouseleave",o),e.areaUnHighLighted.on("mouseleave",o),a.on("click",s),e.areaHighLighted.on("click",s),e.areaUnHighLighted.on("click",s)}},render:function(){return(this.$el||$(this.el)).html(this.template()),this},setTableSize:function(t,e,i){t>this.maxColumns&&(t=this.maxColumns),e>this.maxRows&&(e=this.maxRows),this.curColumns==t&&this.curRows==e||(this.curColumns=t,this.curRows=e,this.areaHighLighted.width(this.curColumns+"em").height(this.curRows+"em"),this.areaUnHighLighted.width((this.curColumns<this.minColumns?this.minColumns:this.curColumns+1>this.maxColumns?this.maxColumns:this.curColumns+1)+"em").height((this.curRows<this.minRows?this.minRows:this.curRows+1>this.maxRows?this.maxRows:this.curRows+1)+"em"),this.cmpEl.width(this.areaUnHighLighted.width()),this.areaStatus.html(this.curColumns+" x "+this.curRows),this.areaStatus.width(this.areaUnHighLighted.width()),this.trigger("change",this,this.curColumns,this.curRows,i))},getColumnsCount:function(){return this.curColumns},getRowsCount:function(){return this.curRows}})})),void 0===Common)var Common={};var FONT_TYPE_RECENT=4;if(define("common/main/lib/component/ComboBoxFonts",["common/main/lib/component/ComboBox"],(function(){"use strict";Common.UI.ComboBoxFonts=Common.UI.ComboBox.extend(function(){var t=300,e=Asc.FONT_THUMBNAIL_HEIGHT||28,i=document.createElement("canvas"),n=i.getContext("2d"),o=/^(zh|ja|ko)$/i.test(Common.Locale.getCurrentLanguage())?"_ea":"",s=[{ratio:1,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+o+".png",width:t,height:e},{ratio:1.25,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+o+"@1.25x.png",width:375,height:1.25*e},{ratio:1.5,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+o+"@1.5x.png",width:450,height:1.5*e},{ratio:1.75,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+o+"@1.75x.png",width:525,height:1.75*e},{ratio:2,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+o+"@2x.png",width:600,height:2*e}],a=0,l=1,r=Common.Utils.applicationPixelRatio();Common.Controllers.Desktop.isActive()&&(s[0].path=Common.Controllers.Desktop.call("getFontsSprite"),s[1].path=Common.Controllers.Desktop.call("getFontsSprite","@1.25x"),s[2].path=Common.Controllers.Desktop.call("getFontsSprite","@1.5x"),s[3].path=Common.Controllers.Desktop.call("getFontsSprite","@1.75x"),s[4].path=Common.Controllers.Desktop.call("getFontsSprite","@2x"));for(var c=Math.abs(r-s[0].ratio),d=0,h=1;h<s.length;h++)(d=Math.abs(r-s[h].ratio))<c-1e-4&&(c=d,a=h);function p(){this.supportBinaryFormat=!(Common.Controllers.Desktop.isActive()&&!Common.Controllers.Desktop.isFeatureAvailable("isSupportBinaryFontsSprite")),this.image=null,this.binaryFormat=null,this.data=null,this.width=0,this.height=0,this.heightOne=0,this.count=0,this.offsets=null,this.load=function(t,e){if(e)if(this.supportBinaryFormat){var i=this,n=new XMLHttpRequest;n.open("GET",t+".bin",!0),n.responseType="arraybuffer",n.overrideMimeType?n.overrideMimeType("text/plain; charset=x-user-defined"):n.setRequestHeader("Accept-Charset","x-user-defined"),n.onload=function(){i.binaryFormat=new Uint8Array(this.response),e()},n.send(null)}else this.width=s[a].width,this.heightOne=s[a].height,this.image=new Image,this.image.onload=e,this.image.src=s[a].path},this.openBinary=function(t){var e=this.binaryFormat;this.width=e[0]<<24|e[1]<<16|e[2]<<8|e[3]<<0,this.heightOne=e[4]<<24|e[5]<<16|e[6]<<8|e[7]<<0,this.count=e[8]<<24|e[9]<<16|e[10]<<8|e[11]<<0,this.height=this.count*this.heightOne;var i=4*this.width*this.height,n=i>5e7;n?this.offsets=new Array(this.count):this.data=new Uint8ClampedArray(i);var o=12,s=e.length,a=0,l=0,r=0;if(n)for(var c=this.width*this.heightOne,d=c-1;o<s;)if(0==(r=e[o++]))for(l=e[o++];l>0;)l--,++d===c&&(this.offsets[a++]={pos:o,len:l+1},d=0);else++d===c&&(this.offsets[a++]={pos:o-1,len:-1},d=0);else for(var h=this.data;o<s;)if(0==(r=e[o++]))for(l=e[o++];l>0;)l--,h[a]=h[a+1]=h[a+2]=255,h[a+3]=0,a+=4;else h[a]=h[a+1]=h[a+2]=255-r,h[a+3]=r,a+=4;this.offsets||delete this.binaryFormat},this.getImage=function(t,i,n){if(i||((i=document.createElement("canvas")).width=this.width,i.height=this.heightOne,i.style.width="300px",i.style.height=e+"px",n=i.getContext("2d")),this.supportBinaryFormat){this.data||this.offsets||this.openBinary(this.binaryFormat);var o=n.createImageData(this.width,this.heightOne),s=4*this.width*this.heightOne;if(this.offsets){var a=this.binaryFormat,l=this.offsets[t].pos,r=0,c=this.width*this.heightOne,d=0,h=0,p=o.data;for(-1!=this.offsets[t].len&&(r+=4*this.offsets[t].len);c>0;)if(0==(d=a[l++]))for((h=a[l++])>c&&(h=c);h>0;)h--,p[r]=p[r+1]=p[r+2]=255,p[r+3]=0,r+=4,c--;else p[r]=p[r+1]=p[r+2]=255-d,p[r+3]=d,r+=4,c--}else o.data.set(new Uint8ClampedArray(this.data.buffer,t*s,s));n.putImageData(o,0,0)}else n.clearRect(0,0,this.width,this.heightOne),n.drawImage(this.image,0,-this.heightOne*t);return i}}return i.height=s[a].height,i.width=s[a].width,{template:_.template(['<div class="input-group combobox fonts <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control" spellcheck="false" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>"> ','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>','<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">','<li class="divider">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>">','<a class="font-item" tabindex="-1" type="menuitem" style="height:<%=scope.getListItemHeight()%>px;"></a>',"</li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){Common.UI.ComboBox.prototype.initialize.call(this,_.extend(t,{displayField:"name",scroller:{wheelSpeed:20,alwaysVisibleY:!0,onChange:this.updateVisibleFontsTiles.bind(this)}})),this.recent=_.isNumber(t.recent)?t.recent:5;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",Common.NotificationCenter.on("fonts:load",_.bind(this.fillFonts,this))},render:function(t){var e=null,i="";return _.isUndefined(this._input)||(e=this._input.val(),i=this._input.attr("tabindex")),Common.UI.ComboBox.prototype.render.call(this,t),this.setRawValue(e),this._input.attr("tabindex",i),this._input.on("keyup",_.bind(this.onInputKeyUp,this)),this._input.on("keydown",_.bind(this.onInputKeyDown,this)),this._input.on("focus",_.bind((function(){this.inFormControl=!0}),this)),this._input.on("blur",_.bind((function(){this.inFormControl=!1}),this)),this},onAfterKeydownMenu:function(t){var e=this;if(t.keyCode==Common.UI.Keys.RETURN){if($(t.target).closest("input").length){if(this.lastValue===this._input.val())return!0;this._input.trigger("change")}else $(t.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur());return!1}if(t.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),setTimeout((function(){e.closeMenu(),e.onAfterHideMenu(t)}),10),!1;(t.keyCode==Common.UI.Keys.HOME&&!t.shiftKey||t.keyCode==Common.UI.Keys.END&&!t.shiftKey||t.keyCode==Common.UI.Keys.BACKSPACE&&!e._input.is(":focus"))&&this.isMenuOpen()&&(e._input.focus(),setTimeout((function(){e._input[0].selectionStart=e._input[0].selectionEnd=t.keyCode==Common.UI.Keys.HOME?0:e._input[0].value.length}),10)),this.updateVisibleFontsTiles()},onInputKeyUp:function(t){if(this._isKeyDown){if(t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!==Common.UI.Keys.SHIFT&&t.keyCode!==Common.UI.Keys.CTRL&&t.keyCode!==Common.UI.Keys.ALT&&t.keyCode!==Common.UI.Keys.LEFT&&t.keyCode!==Common.UI.Keys.RIGHT&&t.keyCode!==Common.UI.Keys.HOME&&t.keyCode!==Common.UI.Keys.END&&t.keyCode!==Common.UI.Keys.ESC&&t.keyCode!==Common.UI.Keys.INSERT&&t.keyCode!==Common.UI.Keys.TAB&&(t.stopPropagation(),this.selectCandidate(t.keyCode==Common.UI.Keys.DELETE||t.keyCode==Common.UI.Keys.BACKSPACE),this._selectedItem)){var e=this;void 0===e._timerSelection&&(e._timerSelection=setInterval((function(){if(!(new Date-e._inInputKeyDown<100)&&e._selectedItem){clearInterval(e._timerSelection),e._timerSelection=void 0;var t=e._input[0],i=e._selectedItem.get(e.displayField),n=t.value;e.rendered&&(document.selection?document.selection.createRange().text=i:(t.selectionStart||"0"==t.selectionStart)&&(t.value=i,t.selectionStart=n.length,t.selectionEnd=i.length))}}),10))}this._isKeyDown=!1}},onInputKeyDown:function(t){this._isKeyDown=!0,this._inInputKeyDown=new Date;var e=this;t.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),setTimeout((function(){e.closeMenu(),e.onAfterHideMenu(t)}),10)):t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.CTRL&&t.keyCode!=Common.UI.Keys.SHIFT&&t.keyCode!=Common.UI.Keys.ALT&&t.keyCode!=Common.UI.Keys.TAB?(this.isMenuOpen()||t.ctrlKey||(this.openMenu(),this.recent>0&&this.flushVisibleFontsTiles()),t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN?_.delay((function(){var i=t.keyCode==Common.UI.Keys.DOWN?e.cmpEl.find("ul li.selected").nextAll("li:not(.divider)"):e.cmpEl.find("ul li.selected").prevAll("li:not(.divider)");i=(i=i.length>0?i.eq(0):t.keyCode==Common.UI.Keys.DOWN?e.cmpEl.find("ul li:not(.divider):first"):e.cmpEl.find("ul li:not(.divider):last")).find("a"),e._skipInputChange=!0,i.focus(),e.updateVisibleFontsTiles()}),10):e._skipInputChange=!1):t.keyCode==Common.UI.Keys.RETURN&&this._input.val()===e.lastValue&&this._input.trigger("change",{reapply:!0})},onInputChanged:function(t,e){if(!e||!e.synthetic)if(this._skipInputChange)this._skipInputChange=!1;else if(this._isMouseDownMenu)this._isMouseDownMenu=!1;else{var i=$(t.target).val(),n={};this.lastValue!==i||e&&e.reapply?(n[this.valueField]=i,n[this.displayField]=i,this.trigger("changed:before",this,n,t),t.isDefaultPrevented()||(this._selectedItem?(n[this.valueField]=this._selectedItem.get(this.displayField),this.setRawValue(n[this.valueField]),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),this.addItemToRecent(this._selectedItem),this.closeMenu()):(this.setRawValue(n[this.valueField]),n.isNewFont=!0,this.trigger("selected",this,n,t),this.closeMenu()),this.trigger("changed:after",this,n,t))):e&&e.onkeydown&&this.trigger("combo:blur",this,t)}},getImageUri:function(t){if(t.cloneid){var e=$(this.el).find("ul > li#"+t.cloneid+" img");return null!=e?e[0].src:void 0}var o=Math.floor(t.imgidx/l);return this.spriteThumbs.getImage(o,i,n).toDataURL()},getImageWidth:function(){return t},getImageHeight:function(){return e},getListItemHeight:function(){return 28},loadSprite:function(t){this.spriteThumbs=new p,this.spriteThumbs.load(s[a].path,t)},fillFonts:function(t,e){var i=this;this.loadSprite((function(){if(l=Math.floor(i.spriteThumbs.width/s[a].width)||1,i.store.set(t.toJSON()),i.rendered=!1,_.isUndefined(i.scroller)||(i.scroller.destroy(),delete i.scroller),i._scrollerIsInited=!1,i.render($(i.el)),i._fontsArray=i.store.toJSON(),i.recent>0){i.store.on("add",i.onInsertItem,i),i.store.on("remove",i.onRemoveItem,i),Common.Utils.InternalSettings.set(i.appPrefix+"-settings-recent-fonts",Common.localStorage.getItem(i.appPrefix+"-settings-recent-fonts"));var e=Common.Utils.InternalSettings.get(i.appPrefix+"-settings-recent-fonts");(e=e?e.split(";"):[]).reverse().forEach((function(t){t&&i.addItemToRecent(i.store.findWhere({name:t}),!0)}))}}))},onApiChangeFont:function(t){var e=this,i=_.isFunction(t.get_Name)?t.get_Name():t.asc_getFontName();this.__name!==i&&(this.__name=i,this.__nameId||(this.__nameId=setTimeout((function(){e.onApiChangeFontInternal(e.__name),e.__nameId=null}),100)))},onApiChangeFontInternal:function(t){if(!this.inFormControl&&this.getRawValue()!==t){var e=this.store.findWhere({name:t});if($(".selected",$(this.el)).removeClass("selected"),e){this.setRawValue(e.get(this.displayField));var i=$("#"+e.get("id"),$(this.el)),n=$("ul.dropdown-menu",this.cmpEl);i&&n&&(i.addClass("selected"),this.recent<=0&&n.scrollTop(i.offset().top-n.offset().top))}else this.setRawValue(t)}},itemClicked:function(t){this.__name=void 0,this.__nameId&&(clearTimeout(this.__nameId),this.__nameId=void 0),Common.UI.ComboBox.prototype.itemClicked.apply(this,arguments);var e=$(t.target).closest("li"),i=this.store.findWhere({id:e.attr("id")});this.addItemToRecent(i)},onInsertItem:function(t){$(this.el).find("ul").prepend(_.template(['<li id="<%= item.id %>">','<a class="font-item" tabindex="-1" type="menuitem" style="height:<%=scope.getListItemHeight()%>px;"></a>',"</li>"].join(""))({item:t.attributes,scope:this}))},onRemoveItem:function(t,e,i){$(this.el).find("ul > li#"+t.id).remove()},onBeforeShowMenu:function(t){if(this.store.length<1)t.preventDefault();else if(Common.UI.ComboBox.prototype.onBeforeShowMenu.apply(this,arguments),!this.getSelectedRecord()&&this.getRawValue()){var e=this.store.where({name:this.getRawValue()});e&&e.length&&this.selectRecord(e[e.length-1])}},onAfterShowMenu:function(t){this.recent>0?(this.scroller&&!this._scrollerIsInited&&(this.scroller.update(),this._scrollerIsInited=!0),$(this.el).find("ul").scrollTop(0),this.trigger("show:after",this,t),this.flushVisibleFontsTiles(),this.updateVisibleFontsTiles(null,0),Common.Utils.isGecko&&this.scroller&&this.scroller.update()):Common.UI.ComboBox.prototype.onAfterShowMenu.apply(this,arguments)},onAfterHideMenu:function(t){this.lastValue!==this._input.val()&&this._input.val(this.lastValue),Common.UI.ComboBox.prototype.onAfterHideMenu.apply(this,arguments)},addItemToRecent:function(t,e){if(t&&!(this.recent<1)){var i=this.store.findWhere({name:t.get("name"),type:FONT_TYPE_RECENT});i&&this.store.remove(i);var n=this.store.where({type:FONT_TYPE_RECENT});n.length<this.recent||this.store.remove(n[this.recent-1]);var o=t.clone();if(o.set({type:FONT_TYPE_RECENT,id:Common.UI.getId(),cloneid:t.id}),this.store.add(o,{at:0}),!e){var s=[];this.store.where({type:FONT_TYPE_RECENT}).forEach((function(t){s.push(t.get("name"))})),s=s.join(";"),Common.localStorage.setItem(this.appPrefix+"-settings-recent-fonts",s),Common.Utils.InternalSettings.set(this.appPrefix+"-settings-recent-fonts",s)}}},selectCandidate:function(t){var e=this,i=this._input.val().toLowerCase();this._fontsArray||(this._fontsArray=this.store.toJSON());var n=_.find(this._fontsArray,(function(n){return t?n[e.displayField].toLowerCase()==i:0==n[e.displayField].toLowerCase().indexOf(i)}));if(this._selectedItem=n?this.store.findWhere({id:n.id}):null,$(".selected",$(this.el)).removeClass("selected"),this._selectedItem){var o=$("#"+this._selectedItem.get("id"),$(this.el)),s=$("ul[role=menu]",$(this.el));if(o.length>0&&s.length>0){o.addClass("selected");var a=o.position().top,l=s.scrollTop();0!=a&&s.scrollTop(l+a)}}},updateVisibleFontsTiles:function(t,e){var i=this,n=0,o=i.store.length,s=0;if(i.tiles||(i.tiles=[]),o!==i.tiles.length)for(n=i.tiles.length;n<o;++n)i.tiles.unshift(null);_.isUndefined(e)&&(e=parseInt($(i.el).find(".ps-scrollbar-x-rail").css("bottom")));var a=$(i.el).find(".dropdown-menu").height(),r=Math.max(Math.floor(a/28)+3,0),c=Math.max(Math.floor(-e/28)-1,0),d=c+r,h=$(i.el).find("a");for(n=0;n<o;++n)if(c<=n&&n<d){if(null===i.tiles[n]){s=Math.floor(i.store.at(n).get("imgidx")/l);var p=i.spriteThumbs.getImage(s);i.tiles[n]=p,$(h[n]).get(0).appendChild(p)}}else i.tiles[n]&&(i.tiles[n].parentNode.removeChild(i.tiles[n]),i.tiles[n]=null)},flushVisibleFontsTiles:function(){for(var t=this.tiles.length-1;t>=0;--t)this.tiles[t]&&(this.tiles[t].parentNode.removeChild(this.tiles[t]),this.tiles[t]=null)}}}())})),void 0===Common)var Common={};if(define("common/main/lib/component/SynchronizeTip",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.SynchronizeTip=Common.UI.BaseView.extend(_.extend({options:{target:$(document.body),text:"",placement:"right-bottom",showLink:!0,showButton:!1,closable:!0},template:_.template(['<div class="synch-tip-root <% if (!!scope.options.extCls) {print(scope.options.extCls + " ");} %><%= scope.placement %>" style="<%= scope.style %>">','<div class="asc-synchronizetip">','<div class="tip-arrow <%= scope.placement %>"></div>',"<div>",'<div class="tip-text"><%= scope.text %></div>',"<% if ( scope.closable ) { %>",'<div class="close"></div>',"<% } %>","</div>","<% if ( scope.showLink ) { %>",'<div class="show-link"><label><%= scope.textLink %></label></div>',"<% } %>","<% if ( scope.showButton ) { %>",'<div class="btn-div"><%= scope.textButton %></div>',"<% } %>","</div>","</div>"].join("")),initialize:function(t){this.textSynchronize+=Common.Utils.String.platformKey("Ctrl+S"),Common.UI.BaseView.prototype.initialize.call(this,t),this.target=this.options.target,this.text=_.isEmpty(this.options.text)?this.textSynchronize:this.options.text,this.textLink=_.isEmpty(this.options.textLink)?this.textDontShow:this.options.textLink,this.placement=this.options.placement,this.showLink=this.options.showLink,this.showButton=this.options.showButton,this.closable=this.options.closable,this.textButton=this.options.textButton||"",this.position=this.options.position,this.style=this.options.style||""},render:function(){return this.cmpEl||(this.cmpEl=$(this.template({scope:this})),$(document.body).append(this.cmpEl),this.cmpEl.find(".close").on("click",_.bind((function(){this.trigger("closeclick")}),this)),this.cmpEl.find(".show-link label").on("click",_.bind((function(){this.trigger("dontshowclick")}),this)),this.cmpEl.find(".btn-div").on("click",_.bind((function(){this.trigger("buttonclick")}),this)),this.closable&&this.cmpEl.addClass("closable")),this.applyPlacement(),this},show:function(){this.cmpEl?(this.applyPlacement(),this.cmpEl.show()):this.render()},hide:function(){this.cmpEl&&this.cmpEl.hide(),this.trigger("hide")},close:function(){this.cmpEl&&this.cmpEl.remove()},applyPlacement:function(){var t=this.target&&this.target.length>0?this.target:$(document.body),e=t.offset();if("target"!=this.placement||this.position){if(this.position&&"object"==typeof this.position){var i=this.position.top,n=this.position.left,o=this.position.bottom,s=this.position.right;return void 0!==o||void 0!==i?n=e.left+(t.width()-this.cmpEl.width())/2:i=e.top+(t.height()-this.cmpEl.height())/2,i=void 0!==i?i+"px":"auto",o=void 0!==o?o+"px":"auto",s=void 0!==s?s+"px":"auto",n=void 0!==n?n+"px":"auto",void this.cmpEl.css({top:i,left:n,right:s,bottom:o})}var a=this.placement.split("-");if(a.length>0){var l=a[0];if("top"==l?o=Common.Utils.innerHeight()-e.top:"bottom"==l?i=e.top+t.height():"left"==l?s=Common.Utils.innerWidth()-e.left:"right"==l&&(n=e.left+t.width()),"top"==(l=a[1]))o=Common.Utils.innerHeight()-e.top-t.height()/2;else if("bottom"==l){i=e.top+t.height()/2;var r=this.cmpEl.height();i+r>Common.Utils.innerHeight()&&(i=Common.Utils.innerHeight()-r-10)}else"left"==l?s=Common.Utils.innerWidth()-e.left-t.width()/2:"right"==l?n=e.left+t.width()/2:void 0!==o||void 0!==i?n=e.left+(t.width()-this.cmpEl.width())/2:i=e.top+(t.height()-this.cmpEl.height())/2;if(i=void 0!==i?i+"px":"auto",o=void 0!==o?o+"px":"auto",s=void 0!==s?s+"px":"auto",void 0!==n){var c=this.cmpEl.width();n+c>Common.Utils.innerWidth()&&(n=Common.Utils.innerWidth()-c-10),n+="px"}else n="auto";this.cmpEl.css({top:i,left:n,right:s,bottom:o})}}else this.cmpEl.css({top:e.top+5+"px",left:e.left+5+"px"})},isVisible:function(){return this.cmpEl&&this.cmpEl.is(":visible")},textDontShow:"Don't show this message again",textSynchronize:"The document has been changed by another user.<br>Please click to save your changes and reload the updates."},Common.UI.SynchronizeTip||{}))})),define("common/main/lib/component/Mixtbar",["backbone","common/main/lib/component/BaseView"],(function(t){"use strict";Common.UI.Mixtbar=Common.UI.BaseView.extend(function(){var t,e={timeout:2e3},i={},n=[],o=function(e,i){var n=t.scrollLeft();(n||"right"==e)&&t.animate({scrollLeft:"left"==e?n-100:n+100},200)};function s(t){var e=$(t.currentTarget).find("> a[data-tab]").data("tab");this.dblclick_el==e&&(this.fireEvent("change:compact",[e]),this.dblclick_el=void 0)}function a(t){this.isFolded&&($(t.target).parents(".toolbar, #file-menu-panel").length||e.$bar&&e.$bar.hasClass("expanded")&&this.collapse())}return{$tabs:void 0,$panels:void 0,isFolded:!1,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);this.$layout=$(t.template({tabsmarkup:_.template('<section class="tabs"><a class="scroll left" data-hint="0" data-hint-direction="bottom" data-hint-offset="-7, 0" data-hint-title="V"></a><ul><% for(var i in items) { %><% if (typeof items[i] == "object") { %><li class="ribtab<% if (items[i].haspanel===false) print(" x-lone") %><% if (items[i].extcls) print(\' \' + items[i].extcls) %>"<% if (typeof items[i].layoutname == "string") print(" data-layout-name=" + \' \' +  items[i].layoutname) + \' \' %>><a data-tab="<%= items[i].action %>" data-title="<%= items[i].caption %>" data-hint="0" data-hint-direction="bottom" data-hint-offset="small" <% if (typeof items[i].dataHintTitle !== "undefined") { %> data-hint-title="<%= items[i].dataHintTitle %>" <% } %>><%= items[i].caption %></a></li><% } %><% } %></ul><a class="scroll right" data-hint="0" data-hint-direction="bottom" data-hint-offset="-7, 0" data-hint-title="R"></a></section>')({items:t.tabs})})),i.tabs=t.tabs,$(document.body).on("click",a.bind(this)),Common.NotificationCenter.on("tab:visible",_.bind((function(t,e){this.setVisible(t,e)}),this)),Common.NotificationCenter.on("tab:resize",_.bind(this.onResizeTabs,this))},afterRender:function(){var i=this;t=i.$(".tabs > ul"),i.$tabs=t.find("> li"),i.$boxpanels=i.$(".box-panels"),i.$panels=i.$boxpanels.find("> .panel"),e.$bar=i.$(".toolbar");var n=i.$(".tabs .scroll.right");i.$(".tabs .scroll.left").on("click",o.bind(this,"left")),n.on("click",o.bind(this,"right")),t.on("dblclick","> .ribtab",s.bind(this)),t.on("click","> .ribtab",i.onTabClick.bind(this))},isTabActive:function(t){var e=this.$tabs.filter(".active").find("> a");return e.length&&e.data("tab")==t},setFolded:function(t){this.isFolded=t;var i=this;if(this.isFolded)e.$box||(e.$box=i.$el.find(".box-controls")),e.$bar.addClass("folded z-clear").toggleClass("expanded",!1),e.$bar.find(".tabs .ribtab").removeClass("active"),e.$bar.on($.support.transition.end,(function(t){e.$bar.hasClass("folded")&&!e.$bar.hasClass("expanded")&&e.$bar.toggleClass("z-clear",!0)})),e.$box.on({mouseleave:function(t){},mouseenter:function(t){}});else{e.$bar.removeClass("folded z-clear"),e.$box.off();var n=e.$box.find(".panel.active");if(n.length){var o=n.data("tab");i.$tabs.find("> a[data-tab="+o+"]").parent().toggleClass("active",!0)}else o=i.$tabs.siblings(":not(.x-lone):visible").first().find("> a[data-tab]").data("tab"),i.setTab(o)}},collapse:function(){Common.UI.Menu.Manager.hideAll(),this.isFolded&&e.$bar&&(e.$bar.removeClass("expanded"),e.$bar.find(".tabs .ribtab").removeClass("active"))},expand:function(){e.$bar.removeClass("z-clear"),e.$bar.addClass("expanded")},onResizeTabs:function(e){this.hasTabInvisible()?t.parent().hasClass("short")||t.parent().addClass("short"):t.parent().hasClass("short")&&t.parent().removeClass("short")},onResize:function(t){this.onResizeTabs(),this.hideMoreBtns(),this.processPanelVisible()},onTabClick:function(t){var e=this,i=$(t.currentTarget),n=i.find("> a[data-tab]").data("tab");i.hasClass("x-lone")?e.isFolded&&e.collapse():i.hasClass("active")?e._timerSetTab||(e.dblclick_el=n,e.isFolded&&(e.collapse(),setTimeout((function(){e.dblclick_el=void 0}),500))):(e._timerSetTab=!0,setTimeout((function(){e._timerSetTab=!1}),500),e.setTab(n),e.isFolded?e.dblclick_el=n:(e.dblclick_timer&&clearTimeout(e.dblclick_timer),e.dblclick_timer=setTimeout((function(){e.dblclick_el=n,delete e.dblclick_timer}),500)))},setTab:function(t){var e=this;if(t||(this.isFolded?this.collapse():t=this.lastPanel),t){e.$tabs.removeClass("active"),e.$panels.removeClass("active"),e.hideMoreBtns();var i=this.$panels.filter("[data-tab="+t+"]");i.length&&(this.lastPanel=t,i.addClass("active"),e.setMoreButton(t,i),e.processPanelVisible(null,!0,!0)),i.length?e.isFolded&&e.expand():e.isFolded&&e.collapse();var n=this.$tabs.find("> a[data-tab="+t+"]").parent();n.length&&n.addClass("active"),this.fireEvent("tab:active",[t])}},addTab:function(e,n,o){var s=_.template('<li class="ribtab" style="display: none;" <% if (typeof layoutname == "string") print(" data-layout-name=" + \' \' +  layoutname) + \' \' %>><a data-tab="<%= action %>" data-title="<%= caption %>" data-hint="0" data-hint-direction="bottom" data-hint-offset="small" <% if (typeof dataHintTitle !== "undefined") { %> data-hint-title="<%= dataHintTitle %>" <% } %> ><%= caption %></a></li>');i.tabs[o+1]=e;var a=function t(e){return i.tabs[e]?i.tabs[e].action:t(--e)}(o),l=this.$tabs||this.$layout.find(".tabs"),r=l.find("a[data-tab="+a+"]");r.length&&(r.parent().after(s(e)),n&&((r=(l=this.$panels||this.$layout.find(".box-panels > .panel")).filter("[data-tab="+a+"]")).length?r.after(n):n.appendTo(this.$layout.find(".box-panels"))),this.$tabs&&(this.$tabs=t.find("> li")),this.$panels&&(this.$panels=this.$el.find(".box-panels > .panel")))},isCompact:function(){return this.isFolded},hasTabInvisible:function(){if(t.length<1)return!1;var e=Math.round(t.offset().left),i=Math.round(e+t.width()),n=this.$tabs.filter(":visible:first").get(0);if(!n)return!1;var o=n.getBoundingClientRect();return Math.round(o.left)<e||(o=(n=this.$tabs.filter(":visible:last").get(0)).getBoundingClientRect(),Math.round(o.right)>i)},processPanelVisible:function(t,e,i){var n=this;function o(){var e=t||n.$panels.filter(".active");if(e&&e.length){var o=e.parents(".box-controls").width(),s=e.data(),a=s.rightedge,l=s.buttons,r=s.flex,c=e.find(".more-box");if(a||(a=e.get(0).getBoundingClientRect().right),l||(l=[],_.each(e.find(".btn-slot .x-huge"),(function(t){l.push($(t).closest(".btn-slot"))})),s.buttons=l),r||(r=[],_.each(e.find(".group.flex"),(function(t){var e=$(t);r.push({el:e,width:e.attr("data-group-width")||e.attr("max-width")})})),s.flex=r),a>o){if(!c.is(":visible")){if(r.length>0)for(var d=0;d<r.length;d++){var h=r[d].el;if(a=e.get(0).getBoundingClientRect().right,h.outerWidth()>parseInt(h.css("min-width")))return void(s.rightedge=a);h.css("width",h.css("min-width"))}for(d=l.length-1;d>=0;d--){if(!(p=l[d]).hasClass("compactwidth")&&!p.hasClass("slot-btn-more")&&(p.addClass("compactwidth"),(a=e.get(0).getBoundingClientRect().right)<=o))break}s.rightedge=a}n.resizeToolbar(i)}else if(c.is(":visible")&&n.resizeToolbar(i),!c.is(":visible")){for(d=0;d<l.length;d++){var p;if((p=l[d]).hasClass("compactwidth")&&(p.removeClass("compactwidth"),(a=e.get(0).getBoundingClientRect().right)>o)){p.addClass("compactwidth"),a=e.get(0).getBoundingClientRect().right;break}}if(s.rightedge=a,r.length>0&&e.find(".btn-slot.compactwidth").length<1)for(d=0;d<r.length;d++){(h=r[d]).el.css("width",h.width),s.rightedge=e.get(0).getBoundingClientRect().right}}}}n._timer_id&&clearTimeout(n._timer_id),!0===e?o():n._timer_id=setTimeout((function(){delete n._timer_id,o()}),100)},setExtra:function(t,e){e&&(this.$tabs||("right"==t?this.$layout.find(".extra.right").html(e):"left"==t&&this.$layout.find(".extra.left").html(e)))},setVisible:function(t,e){t&&this.$tabs&&(this.$tabs.find("> a[data-tab="+t+"]").parent().css("display",e?"":"none"),this.onResize())},setMoreButton:function(t,i){var o=this;if(!n[t]){var s=i.position().top,a=$('<div class="more-box" style="position: absolute;right: 0; top:'+s+'px; padding-left: 12px;padding-right: 6px;display: none;"><div class="separator long" style="position: relative;display: table-cell;"></div><div class="group" style=""><span class="btn-slot text x-huge slot-btn-more"></span></div></div>');i.append(a),n[t]=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top dropdown-manual",caption:Common.Locale.get("textMoreButton",{name:"Common.Translation",default:"More"}),iconCls:"toolbar__icon btn-more",enableToggle:!0}),n[t].render(a.find(".slot-btn-more")),n[t].on("toggle",(function(t,e,i){e?o.onMoreShow(t,i):o.onMoreHide(t,i),Common.NotificationCenter.trigger("more:toggle",t,e)}));var l=$('<div class="dropdown-menu more-container" data-tab="'+t+'"><div style="display: inline;"></div></div>');e.$bar.append(l),n[t].panel=l.find("div")}this.$moreBar=n[t].panel},resizeToolbar:function(t){var e=this.$panels.filter(".active"),i=e.find(".more-box"),n=parseInt(i.css("width"))||0,o=e.parents(".box-controls").width(),s=o,a=e.get(0).getBoundingClientRect().right,l=this._prevBoxWidth?s-this._prevBoxWidth:-1,r=!1;if(this._prevBoxWidth=s,i.is(":visible")&&(s-=n),this.$moreBar&&this.$moreBar.parent().is(":visible")&&this.$moreBar.parent().css("max-width",Common.Utils.innerWidth()),(t||l<0)&&a>s){i.is(":visible")||(i.css("display",""),s-=parseInt(i.css("width")));var c=null,d=null;(x=this.$moreBar.children().filter("[data-hidden-tb-item!=true]")).length>0&&((x=$(x[0])).hasClass("separator")&&(c=x),x.hasClass("group")&&"open"==x.attr("group-state")&&(d=x));for(var h=!1,p=(y=e.find("> div:not(.more-box)")).length-1;p>=0;p--){if((S=$(y[p])).is(":visible")||S.attr("hidden-on-resize"))if(S.hasClass("group")){if((a=e.get(0).getBoundingClientRect().right)<=s)break;var m=S.offset(),u=S.outerWidth(),g=S.children();if(!S.attr("inner-width")&&"open"!==S.attr("group-state")){S.attr("inner-width",u);for(var f=g.length-1;f>=0;f--){(k=$(g[f])).attr("inner-width",k.outerWidth())}}if((m.left>s||1==g.length)&&"open"!=S.attr("group-state"))this.$moreBar.prepend(S),c&&(c.css("display",""),c.removeAttr("hidden-on-resize")),r=!0;else{if(!(m.left+u>s))break;for(f=g.length-1;f>=0;f--){if((k=$(g[f])).hasClass("elset")){this.$moreBar.prepend(S),c&&(c.css("display",""),c.removeAttr("hidden-on-resize")),r=!0;break}var b=k.offset(),C=k.outerWidth();if(!(b.left+C>s)){h=!0;break}if(!d){(d=$("<div></div>")).addClass(y[p].className);for(var v=y[p].attributes,_=0;_<v.length;_++)d.attr(v[_].name,v[_].value);this.$moreBar.prepend(d),c&&(c.css("display",""),c.removeAttr("hidden-on-resize"))}d.prepend(k),r=!0}if(S.children().length<1?(S.remove(),d&&d.removeAttr("group-state").attr("inner-width",S.attr("inner-width")),d=null):d&&d.attr("group-state","open")&&S.attr("group-state","open"),h)break}c=null}else S.hasClass("separator")&&(this.$moreBar.prepend(S),S.css("display","none"),S.attr("hidden-on-resize",!0),c=S,r=!0);else S.attr("data-hidden-tb-item",!0),this.$moreBar.prepend(S),r=!0}}else if((t||l>0)&&i.is(":visible")){c=null,d=null;var x,y,w=0;if((x=e.find("> div:not(.more-box)")).length>0&&((x=$(x[x.length-1])).hasClass("separator")&&(c=x,w=parseInt(c.css("margin-left"))+parseInt(c.css("margin-right"))+1),x.hasClass("group")&&"open"==x.attr("group-state")&&(d=x)),(y=this.$moreBar.children()).length>0)for(p=0;p<y.length;p++){var S=$(y[p]);if(a=e.get(0).getBoundingClientRect().right,!S.is(":visible")&&S.attr("data-hidden-tb-item"))S.removeAttr("data-hidden-tb-item"),i.before(S),0==this.$moreBar.children().filter(".group").length&&(this.hideMoreBtns(),i.css("display","none"));else if(S.hasClass("group")){var A=!1;if(1==this.$moreBar.children().filter(".group").length&&(s=o,A=!0),a+w+(u=parseInt(S.attr("inner-width")||0))<s&&"open"!=S.attr("group-state"))i.before(S),c&&(c.css("display",""),c.removeAttr("hidden-on-resize")),0==this.$moreBar.children().filter(".group").length&&(this.hideMoreBtns(),i.css("display","none")),r=!0;else{if(!(a+w<s))break;g=S.children();s=o-n;for(f=0;f<g.length;f++){var k;if(A&&f==g.length-1&&(s=o),a=e.get(0).getBoundingClientRect().right,(k=$(g[f])).hasClass("elset")){h=!0;break}if(!(a+w+(C=parseInt(k.attr("inner-width")||0)+(d?0:parseInt(S.css("padding-left"))))<s)){h=!0;break}if(!d){(d=$("<div></div>")).addClass(y[p].className);for(v=y[p].attributes,_=0;_<v.length;_++)d.attr(v[_].name,v[_].value);d.hasClass("flex")&&(e.data().flex=null),i.before(d),c&&(c.css("display",""),c.removeAttr("hidden-on-resize"))}d.append(k),r=!0}if(S.children().length<1?(S.remove(),d&&d.removeAttr("group-state").attr("inner-width",S.attr("inner-width")),d=null,0==this.$moreBar.children().filter(".group").length&&(this.hideMoreBtns(),i.css("display","none"))):d&&d.attr("group-state","open")&&S.attr("group-state","open"),h)break}c=null,w=0}else S.hasClass("separator")&&(i.before(S),S.css("display","none"),S.attr("hidden-on-resize",!0),c=S,w=parseInt(c.css("margin-left"))+parseInt(c.css("margin-right"))+1,r=!0)}else this.hideMoreBtns(),i.css("display","none")}r&&Common.UI.Menu.Manager.hideAll()},onMoreHide:function(t,e){var i=t.panel.parent();t.pressed&&t.toggle(!1,!0),i.is(":visible")&&(i.hide(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,t))},onMoreShow:function(t,e){var i=t.panel.parent(),n=i.parent().offset(),o=t.$el,s=o.offset(),a=Common.Utils.innerWidth()-(s.left-n.left+o.width()),l=s.top-n.top+o.height()+10;i.css({right:a,left:"auto",top:l,"max-width":Common.Utils.innerWidth()+"px"}),i.show()},hideMoreBtns:function(){for(var t in n)n[t]&&n[t].toggle(!1)}}}())})),define("spreadsheeteditor/main/app/view/Toolbar",["backbone","text!spreadsheeteditor/main/app/template/Toolbar.template","text!spreadsheeteditor/main/app/template/ToolbarAnother.template","text!spreadsheeteditor/main/app/template/ToolbarView.template","common/main/lib/collection/Fonts","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/ColorPalette","common/main/lib/component/ThemeColorPalette","common/main/lib/component/Menu","common/main/lib/component/DimensionPicker","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts","common/main/lib/component/ComboDataView","common/main/lib/component/SynchronizeTip","common/main/lib/component/Mixtbar"],(function(t,e,i,n){"use strict";Common.enumLock||(Common.enumLock={});var o={editCell:"cell-editing",editFormula:"is-formula",editText:"is-text",editPivot:"is-pivot",selImage:"sel-image",selShape:"sel-shape",selShapeText:"sel-shape-txt",selChart:"sel-chart",selChartText:"sel-chart-txt",selRange:"sel-range",selRangeEdit:"sel-range-edit",lostConnect:"disconnect",coAuth:"co-auth",coAuthText:"co-auth-text",ruleMerge:"rule-btn-merge",ruleFilter:"rule-filter",ruleDelFilter:"rule-clear-filter",menuFileOpen:"menu-file-open",cantPrint:"cant-print",multiselect:"is-multiselect",cantHyperlink:"cant-hyperlink",commentLock:"can-comment",cantModifyFilter:"cant-filter",disableOnStart:"on-start",cantGroup:"cant-group",cantGroupUngroup:"cant-group-ungroup",docPropsLock:"doc-props-lock",printAreaLock:"print-area-lock",namedRangeLock:"named-range-lock",multiselectCols:"is-multiselect-cols",headerLock:"header-lock",sheetLock:"sheet-lock",noPivot:"no-pivot",noSubitems:"no-subitems",noSlicerSource:"no-slicer-source",selSlicer:"sel-slicer",cantSort:"cant-sort",pivotLock:"pivot-lock",tableHasSlicer:"table-has-slicer",sheetView:"sheet-view",wbLock:"workbook-lock",wsLock:"worksheet-lock",itemsDisabled:"all-items-disabled",wsLockText:"worksheet-lock-text",wsLockShape:"worksheet-lock-shape",wsLockFormat:"worksheet-lock-format",inSmartartInternal:"in-smartart-internal",wsLockFormatFill:"worksheet-lock-format-fill",editVisibleArea:"is-visible-area"};for(var s in o)o.hasOwnProperty(s)&&(Common.enumLock[s]=o[s]);SSE.Views.Toolbar=Common.UI.Mixtbar.extend(_.extend({el:"#toolbar",template:_.template(e),events:{},initialize:function(){var t=this;return t.SchemeNames=[t.txtScheme22,t.txtScheme1,t.txtScheme2,t.txtScheme3,t.txtScheme4,t.txtScheme5,t.txtScheme6,t.txtScheme7,t.txtScheme8,t.txtScheme9,t.txtScheme10,t.txtScheme11,t.txtScheme12,t.txtScheme13,t.txtScheme14,t.txtScheme15,t.txtScheme16,t.txtScheme17,t.txtScheme18,t.txtScheme19,t.txtScheme20,t.txtScheme21],t._state={hasCollaborativeChanges:void 0},t.btnSaveCls="btn-save",t.btnSaveTip=this.tipSave+Common.Utils.String.platformKey("Ctrl+S"),t.ascFormatOptions={General:"General",Number:"0.00",Currency:"$#,##0.00",Accounting:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',DateShort:"m/d/yyyy",DateLong:"[$-F800]dddd, mmmm dd, yyyy",Time:"[$-F400]h:mm:ss AM/PM",Percentage:"0.00%",Percent:"0%",Fraction:"# ?/?",Scientific:"0.00E+00",Text:"@"},t.numFormatData=[{value:Asc.c_oAscNumFormatType.General,format:this.ascFormatOptions.General,displayValue:this.txtGeneral,exampleval:"100"},{value:Asc.c_oAscNumFormatType.Number,format:this.ascFormatOptions.Number,displayValue:this.txtNumber,exampleval:"100,00"},{value:Asc.c_oAscNumFormatType.Scientific,format:this.ascFormatOptions.Scientific,displayValue:this.txtScientific,exampleval:"1,00E+02"},{value:Asc.c_oAscNumFormatType.Accounting,format:this.ascFormatOptions.Accounting,displayValue:this.txtAccounting,exampleval:"100,00 $"},{value:Asc.c_oAscNumFormatType.Currency,format:this.ascFormatOptions.Currency,displayValue:this.txtCurrency,exampleval:"100,00 $"},{value:Asc.c_oAscNumFormatType.Date,format:"MM-dd-yyyy",displayValue:this.txtDate,exampleval:"04-09-1900"},{value:Asc.c_oAscNumFormatType.Time,format:"HH:MM:ss",displayValue:this.txtTime,exampleval:"00:00:00"},{value:Asc.c_oAscNumFormatType.Percent,format:this.ascFormatOptions.Percentage,displayValue:this.txtPercentage,exampleval:"100,00%"},{value:Asc.c_oAscNumFormatType.Fraction,format:this.ascFormatOptions.Fraction,displayValue:this.txtFraction,exampleval:"100"},{value:Asc.c_oAscNumFormatType.Text,format:this.ascFormatOptions.Text,displayValue:this.txtText,exampleval:"100"}],this},lockToolbar:function(t,e,i){Common.Utils.lockControls(t,e,i,this.lockControls)},applyLayout:function(t){var o=this;var s=Common.enumLock;if(o.btnCopy=new Common.UI.Button({id:"id-toolbar-btn-copy",cls:"btn-toolbar",iconCls:"toolbar__icon btn-copy",dataHint:"1",dataHintDirection:t.isEditDiagram||t.isEditMailMerge||t.isEditOle?"bottom":"top",dataHintTitle:"C"}),o.btnPaste=new Common.UI.Button({id:"id-toolbar-btn-paste",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paste",lock:[s.coAuth,s.lostConnect,s.editVisibleArea],dataHint:"1",dataHintDirection:t.isEditDiagram||t.isEditMailMerge||t.isEditOle?"bottom":"top",dataHintTitle:"V"}),o.btnUndo=new Common.UI.Button({id:"id-toolbar-btn-undo",cls:"btn-toolbar",iconCls:"toolbar__icon btn-undo",disabled:!0,lock:[s.lostConnect],signals:["disabled"],dataHint:"1",dataHintDirection:"bottom",dataHintTitle:"Z"}),o.btnRedo=new Common.UI.Button({id:"id-toolbar-btn-redo",cls:"btn-toolbar",iconCls:"toolbar__icon btn-redo",disabled:!0,lock:[s.lostConnect],signals:["disabled"],dataHint:"1",dataHintDirection:"bottom",dataHintTitle:"Y"}),t.isEditDiagram||t.isEditMailMerge||t.isEditOle){if(o.$layout=$(_.template(i)(t)),t.isEditDiagram||t.isEditOle){o.btnInsertFormula=new Common.UI.Button({id:"id-toolbar-btn-insertformula",cls:"btn-toolbar",iconCls:"toolbar__icon btn-formula",split:!0,lock:[s.editText,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selRangeEdit,s.lostConnect,s.coAuth,s.editVisibleArea],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:"SUM",value:"SUM"},{caption:"AVERAGE",value:"AVERAGE"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:o.txtAdditional,value:"more",hint:o.txtFormula+Common.Utils.String.platformKey("Shift+F3")}]}),dataHint:"1",dataHintDirection:"bottom"});var a=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="position: relative;"><div style="position: absolute; left: 0; width: 100px;"><%= scope.getDisplayValue(item) %></div>','<div style="display: inline-block; width: 100%; max-width: 300px; overflow: hidden; text-overflow: ellipsis; text-align: right; vertical-align: bottom; padding-left: 100px; color: silver;white-space: nowrap;"><%= item.exampleval ? item.exampleval : "" %></div>',"</div></a></li>","<% }); %>",'<li class="divider">','<li id="id-toolbar-mnu-item-more-formats" data-value="-1"><a tabindex="-1" type="menuitem">'+o.textMoreFormats+"</a></li>"].join(""));o.cmbNumberFormat=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 180px;",hint:o.tipNumFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selRangeEdit,s.lostConnect,s.coAuth,s.editVisibleArea],itemsTemplate:a,editable:!1,data:o.numFormatData,dataHint:"1",dataHintDirection:"bottom"})}(t.isEditMailMerge||t.isEditOle)&&(o.btnSearch=new Common.UI.Button({id:"id-toolbar-btn-search",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-search",lock:[s.lostConnect],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"})),t.isEditDiagram&&(o.btnDecDecimal=new Common.UI.Button({id:"id-toolbar-btn-decdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),o.btnIncDecimal=new Common.UI.Button({id:"id-toolbar-btn-incdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),o.btnEditChart=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart",cls:"btn-toolbar btn-text-default auto",caption:o.tipEditChart,lock:[s.lostConnect],style:"min-width: 120px;",dataHint:"1",dataHintDirection:"bottom"}),o.btnEditChartData=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart-data",cls:"btn-toolbar",iconCls:"toolbar__icon btn-select-range",caption:o.tipEditChartData,lock:[s.editCell,s.selRange,s.selRangeEdit,s.lostConnect],dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"}),o.btnEditChartType=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart-type",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-chart",caption:o.tipEditChartType,lock:[s.editCell,s.selRange,s.selRangeEdit,s.lostConnect],style:"min-width: 120px;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"})),t.isEditMailMerge&&(o.btnSortDown=new Common.UI.Button({id:"id-toolbar-btn-sort-down",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sort-down",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter,s.editPivot,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),o.btnSortUp=new Common.UI.Button({id:"id-toolbar-btn-sort-up",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sort-up",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter,s.editPivot,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),o.btnSetAutofilter=new Common.UI.Button({id:"id-toolbar-btn-setautofilter",cls:"btn-toolbar",iconCls:"toolbar__icon btn-autofilter",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter,s.editPivot,s.editVisibleArea],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnClearAutofilter=new Common.UI.Button({id:"id-toolbar-btn-clearfilter",cls:"btn-toolbar",iconCls:"toolbar__icon btn-clear-filter",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleDelFilter,s.editPivot,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"})),t.isEditOle&&(o.cmbFontSize=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:o.tipFontSize,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.editVisibleArea],data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}],dataHint:"1",dataHintDirection:"bottom"}),o.cmbFontName=new Common.UI.ComboBoxFonts({cls:"input-group-nr",menuCls:"scrollable-menu",menuStyle:"min-width: 325px;",hint:o.tipFontName,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.editVisibleArea],store:new Common.Collections.Fonts,recent:0,dataHint:"1",dataHintDirection:"bottom"}),o.btnWrap=new Common.UI.Button({id:"id-toolbar-rtn-wrap",cls:"btn-toolbar",iconCls:"toolbar__icon btn-wrap",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.editVisibleArea],enableToggle:!0,allowDepress:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnMerge=new Common.UI.Button({id:"id-toolbar-rtn-merge",cls:"btn-toolbar",iconCls:"toolbar__icon btn-merge-and-center",enableToggle:!0,allowDepress:!0,split:!0,lock:[s.editCell,s.selShape,s.selShapeText,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleMerge,s.editPivot,s.wsLock,s.editVisibleArea],menu:new Common.UI.Menu({items:[{caption:o.txtMergeCenter,iconCls:"menu__icon btn-merge-and-center",value:Asc.c_oAscMergeOptions.MergeCenter},{caption:o.txtMergeAcross,iconCls:"menu__icon btn-merge-across",value:Asc.c_oAscMergeOptions.MergeAcross},{caption:o.txtMergeCells,iconCls:"menu__icon btn-merge-cells",value:Asc.c_oAscMergeOptions.Merge},{caption:o.txtUnmerge,iconCls:"menu__icon btn-unmerge-cells",value:Asc.c_oAscMergeOptions.None}]}),dataHint:"1",dataHintDirection:"bottom"}),o.mnuTextColorPicker={isDummy:!0,on:function(){}},o.btnTextColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fontcolor",cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",split:!0,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.editVisibleArea],menu:!0,auto:!0,dataHint:"1",dataHintDirection:"bottom"}),o.mnuBackColorPicker={isDummy:!0,on:function(){}},o.btnBackColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fillparag",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paracolor",split:!0,lock:[s.selImage,s.editCell,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormatFill,s.editVisibleArea],transparent:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnBorders=new Common.UI.Button({id:"id-toolbar-btn-borders",cls:"btn-toolbar",iconCls:"toolbar__icon btn-border-out",icls:"btn-border-out",borderId:"outer",borderswidth:Asc.c_oAscBorderStyles.Thin,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.editVisibleArea],split:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnTableTemplate=new Common.UI.Button({id:"id-toolbar-btn-ttempl",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-table",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.wsLock,s.editVisibleArea],menu:new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-menu-table-templates" style="width: 487px; height: 300px; margin: 0px 4px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom"}),o.btnTextFormatting=new Common.UI.Button({id:"id-toolbar-btn-formatting",cls:"btn-toolbar no-caret",iconCls:"toolbar__icon more-vertical",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.editVisibleArea],menu:new Common.UI.Menu({items:[{caption:o.textBold,iconCls:"menu__icon btn-bold",value:"bold",checkable:!0,checkmark:!1,allowDepress:!0},{caption:o.textItalic,iconCls:"menu__icon btn-italic",value:"italic",checkable:!0,checkmark:!1,allowDepress:!0},{caption:o.textUnderline,iconCls:"menu__icon btn-underline",value:"underline",checkable:!0,checkmark:!1,allowDepress:!0},{caption:o.textStrikeout,iconCls:"menu__icon btn-strikeout",value:"strikeout",checkable:!0,checkmark:!1,allowDepress:!0},{caption:o.textSuperscript,iconCls:"menu__icon btn-superscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"superscript"},{caption:o.textSubscript,iconCls:"menu__icon btn-subscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"subscript"}]}),dataHint:"1",dataHintDirection:"bottom"}),o.btnHorizontalAlign=new Common.UI.Button({id:"id-toolbar-btn-halign",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-left",icls:"btn-align-left",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.editVisibleArea],menu:new Common.UI.Menu({items:[{caption:o.tipAlignLeft,iconCls:"menu__icon btn-align-left",icls:"btn-align-left",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",checked:!0,value:AscCommon.align_Left},{caption:o.tipAlignCenter,iconCls:"menu__icon btn-align-center",icls:"btn-align-center",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",value:AscCommon.align_Center},{caption:o.tipAlignRight,iconCls:"menu__icon btn-align-right",icls:"btn-align-right",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",value:AscCommon.align_Right},{caption:o.tipAlignJust,iconCls:"menu__icon btn-align-just",icls:"btn-align-just",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",value:AscCommon.align_Justify}]}),dataHint:"1",dataHintDirection:"bottom"}),o.btnVerticalAlign=new Common.UI.Button({id:"id-toolbar-btn-valign",cls:"btn-toolbar",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.editVisibleArea],iconCls:"toolbar__icon btn-align-middle",icls:"btn-align-middle",menu:new Common.UI.Menu({items:[{caption:o.textAlignTop,iconCls:"menu__icon btn-align-top",icls:"btn-align-top",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"valignGroup",value:Asc.c_oAscVAlign.Top},{caption:o.textAlignMiddle,iconCls:"menu__icon btn-align-middle",icls:"btn-align-middle",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"valignGroup",value:Asc.c_oAscVAlign.Center,checked:!0},{caption:o.textAlignBottom,iconCls:"menu__icon btn-align-bottom",icls:"btn-align-bottom",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"valignGroup",value:Asc.c_oAscVAlign.Bottom}]}),dataHint:"1",dataHintDirection:"bottom"}),o.btnVisibleArea=new Common.UI.Button({id:"id-toolbar-btn-visible-area",cls:"btn-toolbar btn-icon-default",iconCls:"toolbar__icon btn-sheet-view",menu:new Common.UI.Menu({items:[{caption:o.textShowVA,value:"show"},{caption:o.textHideVA,value:"hide",visible:!1},{caption:o.textEditVA,value:"edit"}]}),lock:[s.lostConnect],dataHint:"1",dataHintDirection:"bottom"}),o.btnVisibleAreaClose=new Common.UI.Button({id:"id-toolbar-btn-visible-area-close",cls:"btn-toolbar btn-text-default auto",caption:o.textDone,lock:[s.lostConnect],visible:!1,dataHint:"1",dataHintDirection:"bottom"}))}else if(t.isEdit){Common.UI.Mixtbar.prototype.initialize.call(this,{template:_.template(e),tabs:[{caption:o.textTabFile,action:"file",extcls:"canedit",layoutname:"toolbar-file",haspanel:!1,dataHintTitle:"F"},{caption:o.textTabHome,action:"home",extcls:"canedit",dataHintTitle:"H"},{caption:o.textTabInsert,action:"ins",extcls:"canedit",dataHintTitle:"I"},{caption:o.textTabLayout,action:"layout",extcls:"canedit",layoutname:"toolbar-layout",dataHintTitle:"L"},{caption:o.textTabFormula,action:"formula",extcls:"canedit",dataHintTitle:"O"},{caption:o.textTabData,action:"data",extcls:"canedit",dataHintTitle:"D"}]}),o.btnCut=new Common.UI.Button({id:"id-toolbar-btn-cut",cls:"btn-toolbar",iconCls:"toolbar__icon btn-cut",lock:[s.coAuth,s.lostConnect,s.disableOnStart],dataHint:"1",dataHintDirection:"top",dataHintTitle:"X"}),o.btnSelectAll=new Common.UI.Button({id:"id-toolbar-btn-select-all",cls:"btn-toolbar",iconCls:"toolbar__icon select-all",lock:[s.disableOnStart],dataHint:"1",dataHintDirection:"bottom"}),o.cmbFontSize=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:o.tipFontSize,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect],data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}],dataHint:"1",dataHintDirection:"top"}),o.cmbFontName=new Common.UI.ComboBoxFonts({cls:"input-group-nr",menuCls:"scrollable-menu",menuStyle:"min-width: 325px;",hint:o.tipFontName,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect],store:new Common.Collections.Fonts,dataHint:"1",dataHintDirection:"top"}),o.btnPrint=new Common.UI.Button({id:"id-toolbar-btn-print",cls:"btn-toolbar",iconCls:"toolbar__icon btn-print no-mask",lock:[s.editCell,s.cantPrint,s.disableOnStart],signals:["disabled"],dataHint:"1",dataHintDirection:"top",dataHintTitle:"P"}),o.btnSave=new Common.UI.Button({id:"id-toolbar-btn-save",cls:"btn-toolbar",iconCls:"toolbar__icon no-mask "+o.btnSaveCls,lock:[s.lostConnect],signals:["disabled"],dataHint:"1",dataHintDirection:"bottom",dataHintTitle:"S"}),o.btnCollabChanges=o.btnSave,o.btnIncFontSize=new Common.UI.Button({id:"id-toolbar-btn-incfont",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incfont",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],dataHint:"1",dataHintDirection:"top"}),o.btnDecFontSize=new Common.UI.Button({id:"id-toolbar-btn-decfont",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decfont",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],dataHint:"1",dataHintDirection:"top"}),o.btnBold=new Common.UI.Button({id:"id-toolbar-btn-bold",cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnItalic=new Common.UI.Button({id:"id-toolbar-btn-italic",cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnUnderline=new Common.UI.Button({id:"id-toolbar-btn-underline",cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnStrikeout=new Common.UI.Button({id:"id-toolbar-btn-strikeout",cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnSubscript=new Common.UI.Button({id:"id-toolbar-btn-subscript",cls:"btn-toolbar",iconCls:"toolbar__icon btn-subscript",icls:"btn-subscript",split:!0,enableToggle:!0,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],menu:new Common.UI.Menu({items:[{caption:o.textSuperscript,iconCls:"menu__icon btn-superscript",icls:"btn-superscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"super"},{caption:o.textSubscript,iconCls:"menu__icon btn-subscript",icls:"btn-subscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"sub"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),o.mnuTextColorPicker={isDummy:!0,on:function(){}},o.btnTextColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fontcolor",cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",split:!0,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat],menu:!0,auto:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),o.mnuBackColorPicker={isDummy:!0,on:function(){}},o.btnBackColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fillparag",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paracolor",split:!0,lock:[s.selImage,s.editCell,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormatFill],transparent:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),o.btnBorders=new Common.UI.Button({id:"id-toolbar-btn-borders",cls:"btn-toolbar",iconCls:"toolbar__icon btn-border-out",icls:"btn-border-out",borderId:"outer",borderswidth:Asc.c_oAscBorderStyles.Thin,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],split:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),o.btnAlignLeft=new Common.UI.Button({id:"id-toolbar-btn-align-left",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-left",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),o.btnAlignCenter=new Common.UI.Button({id:"id-toolbar-btn-align-center",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-center",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),o.btnAlignRight=new Common.UI.Button({id:"id-toolbar-btn-align-right",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-right",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),o.btnAlignJust=new Common.UI.Button({id:"id-toolbar-btn-align-just",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-just",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),o.btnMerge=new Common.UI.Button({id:"id-toolbar-rtn-merge",cls:"btn-toolbar",iconCls:"toolbar__icon btn-merge-and-center",enableToggle:!0,allowDepress:!0,split:!0,lock:[s.editCell,s.selShape,s.selShapeText,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleMerge,s.editPivot,s.wsLock],menu:new Common.UI.Menu({items:[{caption:o.txtMergeCenter,iconCls:"menu__icon btn-merge-and-center",value:Asc.c_oAscMergeOptions.MergeCenter},{caption:o.txtMergeAcross,iconCls:"menu__icon btn-merge-across",value:Asc.c_oAscMergeOptions.MergeAcross},{caption:o.txtMergeCells,iconCls:"menu__icon btn-merge-cells",value:Asc.c_oAscMergeOptions.Merge},{caption:o.txtUnmerge,iconCls:"menu__icon btn-unmerge-cells",value:Asc.c_oAscMergeOptions.None}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),o.btnAlignTop=new Common.UI.Button({id:"id-toolbar-rtn-valign-top",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-top",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],enableToggle:!0,toggleGroup:"vAlignGroup",dataHint:"1",dataHintDirection:"top"}),o.btnAlignMiddle=new Common.UI.Button({id:"id-toolbar-rtn-valign-middle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-middle",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],toggleGroup:"vAlignGroup",dataHint:"1",dataHintDirection:"top"}),o.btnAlignBottom=new Common.UI.Button({id:"id-toolbar-rtn-valign-bottom",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-bottom",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],enableToggle:!0,toggleGroup:"vAlignGroup",dataHint:"1",dataHintDirection:"top"}),o.btnWrap=new Common.UI.Button({id:"id-toolbar-rtn-wrap",cls:"btn-toolbar",iconCls:"toolbar__icon btn-wrap",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],enableToggle:!0,allowDepress:!0,dataHint:"1",dataHintDirection:"top"}),o.btnTextOrient=new Common.UI.Button({id:"id-toolbar-rtn-textorient",cls:"btn-toolbar",iconCls:"toolbar__icon text-orient-ccw",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat],menu:new Common.UI.Menu({items:[{caption:o.textHorizontal,iconCls:"menu__icon text-orient-hor",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"horiz"},{caption:o.textCounterCw,iconCls:"menu__icon text-orient-ccw",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"countcw"},{caption:o.textClockwise,iconCls:"menu__icon text-orient-cw",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"clockwise"},{caption:o.textVertical,iconCls:"menu__icon text-orient-vertical",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"vertical"},{caption:o.textRotateUp,iconCls:"menu__icon text-orient-rup",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"rotateup"},{caption:o.textRotateDown,iconCls:"menu__icon text-orient-rdown",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"rotatedown"}]}),dataHint:"1",dataHintDirection:"top"}),o.btnInsertImage=new Common.UI.Button({id:"tlbtn-insertimage",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertimage",caption:o.capInsertImage,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],menu:new Common.UI.Menu({items:[{caption:o.mniImageFromFile,value:"file"},{caption:o.mniImageFromUrl,value:"url"},{caption:o.mniImageFromStorage,value:"storage"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertHyperlink=new Common.UI.Button({id:"tlbtn-insertlink",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-inserthyperlink",caption:o.capInsertHyperlink,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selShape,s.cantHyperlink,s.selSlicer,s.multiselect,s.lostConnect,s.coAuth,s.editPivot,s.InsertHyperlinks],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertChart=new Common.UI.Button({id:"tlbtn-insertchart",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertchart",lock:[s.editCell,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],caption:o.capInsertChart,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertSparkline=new Common.UI.Button({id:"tlbtn-insertsparkline",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-sparkline",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selShape,s.selSlicer,s.multiselect,s.lostConnect,s.coAuth,s.coAuthText,s.editPivot,s.wsLock],caption:o.capInsertSpark,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertShape=new Common.UI.Button({id:"tlbtn-insertshape",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertshape",enableToggle:!0,caption:o.capInsertShape,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],menu:new Common.UI.Menu({cls:"menu-shapes menu-insert-shape"}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertText=new Common.UI.Button({id:"tlbtn-inserttext",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-text",caption:o.capInsertText,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertTextArt=new Common.UI.Button({id:"tlbtn-inserttextart",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-textart",caption:o.capInsertTextart,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],menu:new Common.UI.Menu({cls:"menu-shapes",items:[{template:_.template('<div id="id-toolbar-menu-insart" style="width: 239px; margin-left: 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertEquation=new Common.UI.Button({id:"tlbtn-insertequation",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertequation",caption:o.capInsertEquation,split:!0,lock:[s.editCell,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({cls:"menu-shapes"}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertSymbol=new Common.UI.Button({id:"tlbtn-insertsymbol",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-symbol",caption:o.capBtnInsSymbol,lock:[s.selImage,s.selChart,s.selShape,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnInsertSlicer=new Common.UI.Button({id:"tlbtn-insertslicer",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-slicer",caption:o.capBtnInsSlicer,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.multiselect,s.noSlicerSource,s.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnTableTemplate=new Common.UI.Button({id:"id-toolbar-btn-ttempl",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-table",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.wsLock],menu:new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-menu-table-templates" style="width: 487px; height: 300px; margin: 0px 4px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),o.btnInsertTable=new Common.UI.Button({id:"tlbtn-inserttable",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-inserttable",caption:o.capInsertTable,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.ruleMerge,s.editPivot,s.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.listStyles=new Common.UI.ComboDataView({cls:"combo-styles",enableKeyEvents:!0,itemWidth:112,itemHeight:40,style:"min-width:158px;",menuMaxHeight:226,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"-16, -4",delayRenderTips:!0,beforeOpenHandler:function(t){var e=this,i=e.openButton.menu;if(i.cmpEl){var n=$(e.cmpEl.find(".dataview.inner .style").get(0)).parent(),o=-1;Common.Utils.applicationPixelRatio()>1&&Common.Utils.applicationPixelRatio()<2&&(o=-1/Common.Utils.applicationPixelRatio());var s=n.is(":visible")?parseFloat(n.css("width")):e.itemWidth+parseFloat(n.css("padding-left"))+parseFloat(n.css("padding-right"))+parseFloat(n.css("border-left-width"))+parseFloat(n.css("border-right-width")),a=e.menuPicker.store.length>=6?6:e.menuPicker.store.length,l=Math.min(e.menuPicker.store.length,Math.round($(".dataview",$(e.fieldPicker.el)).width()/(o+s)+.5));l=l<a?a:l,i.menuAlignEl=e.cmpEl,i.menuAlign="tl-tl";var r=l*(o+s),c=e.openButton.$el.offset().left;r>Common.Utils.innerWidth()&&(r=Math.max(Math.floor(Common.Utils.innerWidth()/(o+s)),2)*(o+s));var d=e.cmpEl.width()-e.openButton.$el.width()-Math.min(r,c)-1;i.setOffset(Math.min(d,0)),i.cmpEl.css({width:r,"min-height":e.cmpEl.height()})}}});a=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="position: relative;"><div style="position: absolute; left: 0; width: 100px;"><%= scope.getDisplayValue(item) %></div>','<div style="display: inline-block; width: 100%; max-width: 300px; overflow: hidden; text-overflow: ellipsis; text-align: right; vertical-align: bottom; padding-left: 100px; color: silver;white-space: nowrap;"><%= item.exampleval ? item.exampleval : "" %></div>',"</div></a></li>","<% }); %>",'<li class="divider">','<li id="id-toolbar-mnu-item-more-formats" data-value="-1"><a tabindex="-1" type="menuitem">'+o.textMoreFormats+"</a></li>"].join(""));o.cmbNumberFormat=new Common.UI.ComboBox({cls:"input-group-nr",style:"width: 113px;",menuStyle:"min-width: 180px;",hint:o.tipNumFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.selRangeEdit,s.lostConnect,s.coAuth,s.FormatCells],itemsTemplate:a,editable:!1,data:o.numFormatData,dataHint:"1",dataHintDirection:"top"}),o.btnPercentStyle=new Common.UI.Button({id:"id-toolbar-btn-percent-style",cls:"btn-toolbar",iconCls:"toolbar__icon btn-percent-style",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],styleName:"Percent",dataHint:"1",dataHintDirection:"bottom"}),o.btnCurrencyStyle=new Common.UI.Button({id:"id-toolbar-btn-accounting-style",cls:"btn-toolbar",iconCls:"toolbar__icon btn-currency-style",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],styleName:"Currency",split:!0,menu:new Common.UI.Menu({style:"min-width: 120px;",items:[{caption:o.txtDollar,value:1033},{caption:o.txtEuro,value:1031},{caption:o.txtPound,value:2057},{caption:o.txtRouble,value:1049},{caption:o.txtYen,value:1041},{caption:"--"},{caption:o.textMoreFormats,value:-1}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),o.btnDecDecimal=new Common.UI.Button({id:"id-toolbar-btn-decdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],dataHint:"1",dataHintDirection:"bottom"}),o.btnIncDecimal=new Common.UI.Button({id:"id-toolbar-btn-incdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells],dataHint:"1",dataHintDirection:"bottom"}),o.btnInsertFormula=new Common.UI.Button({id:"id-toolbar-btn-insertformula",cls:"btn-toolbar",iconCls:"toolbar__icon btn-formula",split:!0,lock:[s.editText,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.selRangeEdit,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:"SUM",value:"SUM"},{caption:"AVERAGE",value:"AVERAGE"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:o.txtAdditional,value:"more",hint:o.txtFormula+Common.Utils.String.platformKey("Shift+F3")}]}),dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -16"}),o.btnNamedRange=new Common.UI.Button({id:"id-toolbar-btn-insertrange",cls:"btn-toolbar",iconCls:"toolbar__icon btn-named-range",lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.selRangeEdit,s.wsLock],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:o.txtManageRange,lock:[s.editCell],value:"manage"},{caption:o.txtNewRange,lock:[s.editCell],value:"new"},{caption:o.txtPasteRange,value:"paste"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),o.btnClearStyle=new Common.UI.Button({id:"id-toolbar-btn-clear",cls:"btn-toolbar",iconCls:"toolbar__icon btn-clearstyle",lock:[s.lostConnect,s.coAuth,s.selRangeEdit,s.selSlicer],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:o.txtClearAll,lock:[s.cantModifyFilter],value:Asc.c_oAscCleanOptions.All},{caption:o.txtClearText,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:Asc.c_oAscCleanOptions.Text},{caption:o.txtClearFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth,s.cantModifyFilter],value:Asc.c_oAscCleanOptions.Format},{caption:o.txtClearComments,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:Asc.c_oAscCleanOptions.Comments},{caption:o.txtClearHyper,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:Asc.c_oAscCleanOptions.Hyperlinks}]}),dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -6"}),o.btnCopyStyle=new Common.UI.Button({id:"id-toolbar-btn-copystyle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-copystyle",lock:[s.editCell,s.lostConnect,s.coAuth,s.selChart,s.selSlicer],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),o.btnAddCell=new Common.UI.Button({id:"id-toolbar-btn-addcell",cls:"btn-toolbar",iconCls:"toolbar__icon btn-addcell",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.itemsDisabled,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:o.textInsRight,value:Asc.c_oAscInsertOptions.InsertCellsAndShiftRight,lock:[s.wsLock]},{caption:o.textInsDown,value:Asc.c_oAscInsertOptions.InsertCellsAndShiftDown,lock:[s.wsLock]},{caption:o.textEntireRow,value:Asc.c_oAscInsertOptions.InsertRows},{caption:o.textEntireCol,value:Asc.c_oAscInsertOptions.InsertColumns}]}),dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -6"}),o.btnDeleteCell=new Common.UI.Button({id:"id-toolbar-btn-delcell",cls:"btn-toolbar",iconCls:"toolbar__icon btn-delcell",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.itemsDisabled,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:o.textDelLeft,value:Asc.c_oAscDeleteOptions.DeleteCellsAndShiftLeft,lock:[s.wsLock]},{caption:o.textDelUp,value:Asc.c_oAscDeleteOptions.DeleteCellsAndShiftTop,lock:[s.wsLock]},{caption:o.textEntireRow,value:Asc.c_oAscDeleteOptions.DeleteRows},{caption:o.textEntireCol,value:Asc.c_oAscDeleteOptions.DeleteColumns}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),o.btnCondFormat=new Common.UI.Button({id:"id-toolbar-btn-condformat",cls:"btn-toolbar",iconCls:"toolbar__icon btn-cond-format",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.FormatCells],menu:!0,dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -6"}),o.btnColorSchemas=new Common.UI.Button({id:"id-toolbar-btn-colorschemas",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-colorschemas",caption:o.capBtnColorSchemas,lock:[s.editCell,s.lostConnect,s.coAuth,s.wsLock],menu:new Common.UI.Menu({cls:"shifted-left",items:[],restoreHeight:!0}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var l=Common.localStorage.getItem("sse-hide-synch");o.showSynchTip=!(l&&1==parseInt(l)),o.btnPageOrient=new Common.UI.Button({id:"tlbtn-pageorient",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pageorient",caption:o.capBtnPageOrient,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:o.textPortrait,iconCls:"menu__icon page-portrait",checkable:!0,checkmark:!1,toggleGroup:"menuOrient",value:Asc.c_oAscPageOrientation.PagePortrait},{caption:o.textLandscape,iconCls:"menu__icon page-landscape",checkable:!0,checkmark:!1,toggleGroup:"menuOrient",value:Asc.c_oAscPageOrientation.PageLandscape}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var r=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><% if (options.value !== null) { %><div style="display: inline-block;margin-right: 20px;min-width: 80px;"><label style="display: block;">'+this.textTop+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label><label style="display: block;">'+this.textLeft+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label></div><div style="display: inline-block;"><label style="display: block;">'+this.textBottom+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[2]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label><label style="display: block;">'+this.textRight+"<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[3]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label></div><% } %></a>");o.btnPageMargins=new Common.UI.Button({id:"tlbtn-pagemargins",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagemargins",caption:o.capBtnMargins,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({items:[{caption:o.textMarginsLast,checkable:!0,template:r,toggleGroup:"menuPageMargins"},{caption:o.textMarginsNormal,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[19.1,17.8,19.1,17.8]},{caption:o.textMarginsNarrow,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[19.1,6.4,19.1,6.4]},{caption:o.textMarginsWide,checkable:!0,template:r,toggleGroup:"menuPageMargins",value:[25.4,25.4,25.4,25.4]},{caption:"--"},{caption:o.textPageMarginsCustom,value:"advanced"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var c=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><div><%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %> x <%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></div></a>');o.btnPageSize=new Common.UI.Button({id:"tlbtn-pagesize",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagesize",caption:o.capBtnPageSize,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({restoreHeight:!0,items:[{caption:"US Letter",subtitle:"21,59cm x 27,94cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[215.9,279.4]},{caption:"US Legal",subtitle:"21,59cm x 35,56cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[215.9,355.6]},{caption:"A4",subtitle:"21cm x 29,7cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[210,297],checked:!0},{caption:"A5",subtitle:"14,81cm x 20,99cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[148,210]},{caption:"B5",subtitle:"17,6cm x 25,01cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[176,250]},{caption:"Envelope #10",subtitle:"10,48cm x 24,13cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[104.8,241.3]},{caption:"Envelope DL",subtitle:"11,01cm x 22,01cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[110,220]},{caption:"Tabloid",subtitle:"27,94cm x 43,17cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[279.4,431.8]},{caption:"A3",subtitle:"29,7cm x 42,01cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[297,420]},{caption:"Tabloid Oversize",subtitle:"30,48cm x 45,71cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[304.8,457.1]},{caption:"ROC 16K",subtitle:"19,68cm x 27,3cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[196.8,273]},{caption:"Envelope Choukei 3",subtitle:"11,99cm x 23,49cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[119.9,234.9]},{caption:"Super B/A3",subtitle:"33,02cm x 48,25cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[330.2,482.5]}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.mnuPageSize=o.btnPageSize.menu,o.btnPrintArea=new Common.UI.Button({id:"tlbtn-printarea",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-print-area",caption:o.capBtnPrintArea,lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.editCell,s.selRangeEdit,s.printAreaLock,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:o.textSetPrintArea,lock:[s.namedRangeLock],value:Asc.c_oAscChangePrintAreaType.set},{caption:o.textClearPrintArea,value:Asc.c_oAscChangePrintAreaType.clear},{caption:o.textAddPrintArea,lock:[s.namedRangeLock],value:Asc.c_oAscChangePrintAreaType.add}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.mnuCustomScale=new Common.UI.MenuItem({template:_.template(['<div class="checkable custom-scale" style="padding: 5px 5px 5px 20px;font-weight: normal;line-height: 1.42857143;font-size: 11px;height: 32px;"',"<% if(!_.isUndefined(options.stopPropagation)) { %>",'data-stopPropagation="true"',"<% } %>",">",'<label class="title" style="padding-top: 3px;padding-right: 5px;">'+o.textScale+"</label>",'<button id="custom-scale-up" type="button" style="float:right;" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomup">&nbsp;</i></button>','<label id="value-custom-scale" style="float:right;padding: 3px 3px;min-width: 40px; text-align: center;"></label>','<button id="custom-scale-down" type="button" style="float:right;" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomdown">&nbsp;</i></button>',"</div>"].join("")),stopPropagation:!0,value:4}),o.btnScale=new Common.UI.Button({id:"tlbtn-scale",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-scale",caption:o.capBtnScale,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({items:[],cls:"scale-menu"}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var d=new Common.UI.MenuItem({caption:o.textWidth,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textAuto,value:0,checkable:!0,toggleGroup:"scaleWidth"},{caption:"1 "+this.textOnePage,value:1,checkable:!0,toggleGroup:"scaleWidth"},{caption:"2 "+this.textFewPages,value:2,checkable:!0,toggleGroup:"scaleWidth"},{caption:"3 "+this.textFewPages,value:3,checkable:!0,toggleGroup:"scaleWidth"},{caption:"4 "+this.textFewPages,value:4,checkable:!0,toggleGroup:"scaleWidth"},{caption:"5 "+this.textManyPages,value:5,checkable:!0,toggleGroup:"scaleWidth"},{caption:"6 "+this.textManyPages,value:6,checkable:!0,toggleGroup:"scaleWidth"},{caption:"7 "+this.textManyPages,value:7,checkable:!0,toggleGroup:"scaleWidth"},{caption:"8 "+this.textManyPages,value:8,checkable:!0,toggleGroup:"scaleWidth"},{caption:"9 "+this.textManyPages,value:9,checkable:!0,toggleGroup:"scaleWidth"},{caption:"--"},{caption:this.textMorePages,value:"more",checkable:!0,toggleGroup:"scaleWidth"}]})}),h=new Common.UI.MenuItem({caption:o.textHeight,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textAuto,value:0,checkable:!0,toggleGroup:"scaleHeight"},{caption:"1 "+this.textOnePage,value:1,checkable:!0,toggleGroup:"scaleHeight"},{caption:"2 "+this.textFewPages,value:2,checkable:!0,toggleGroup:"scaleHeight"},{caption:"3 "+this.textFewPages,value:3,checkable:!0,toggleGroup:"scaleHeight"},{caption:"4 "+this.textFewPages,value:4,checkable:!0,toggleGroup:"scaleHeight"},{caption:"5 "+this.textManyPages,value:5,checkable:!0,toggleGroup:"scaleHeight"},{caption:"6 "+this.textManyPages,value:6,checkable:!0,toggleGroup:"scaleHeight"},{caption:"7 "+this.textManyPages,value:7,checkable:!0,toggleGroup:"scaleHeight"},{caption:"8 "+this.textManyPages,value:8,checkable:!0,toggleGroup:"scaleHeight"},{caption:"9 "+this.textManyPages,value:9,checkable:!0,toggleGroup:"scaleHeight"},{caption:"--"},{caption:this.textMorePages,value:"more",checkable:!0,toggleGroup:"scaleHeight"}]})});o.btnScale.menu.addItem(d),o.btnScale.menu.addItem(h),o.btnScale.menu.addItem(o.mnuCustomScale),o.btnScale.menu.addItem({caption:"--"}),o.btnScale.menu.addItem({caption:o.textScaleCustom,value:"custom"}),o.menuWidthScale=o.btnScale.menu.items[0].menu,o.menuHeightScale=o.btnScale.menu.items[1].menu,o.mnuScale=o.btnScale.menu,o.mnuScale.on("show:after",_.bind(o.onAfterShowMenuScale,o)),o.btnPrintTitles=new Common.UI.Button({id:"tlbtn-printtitles",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-print-titles",caption:o.capBtnPrintTitles,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.chPrintGridlines=new Common.UI.CheckBox({labelText:this.textPrintGridlines,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),o.chPrintHeadings=new Common.UI.CheckBox({labelText:this.textPrintHeadings,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),o.btnImgAlign=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-align",caption:o.capImgAlign,lock:[s.selRange,s.selRangeEdit,s.cantGroup,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnImgGroup=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-group",caption:o.capImgGroup,lock:[s.selRange,s.selRangeEdit,s.cantGroupUngroup,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnImgForward=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-frwd",caption:o.capImgForward,split:!0,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects,s.inSmartartInternal],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),o.btnImgBackward=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-bkwd",caption:o.capImgBackward,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects,s.inSmartartInternal],split:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"})}else Common.UI.Mixtbar.prototype.initialize.call(this,{template:_.template(n),tabs:[{caption:o.textTabFile,action:"file",layoutname:"toolbar-file",haspanel:!1,dataHintTitle:"F"}]});return o.lockControls=[],t.isEdit&&(o.lockControls=[o.cmbFontName,o.cmbFontSize,o.btnIncFontSize,o.btnDecFontSize,o.btnBold,o.btnItalic,o.btnUnderline,o.btnStrikeout,o.btnSubscript,o.btnTextColor,o.btnAlignLeft,o.btnAlignCenter,o.btnAlignRight,o.btnAlignJust,o.btnAlignTop,o.btnAlignMiddle,o.btnAlignBottom,o.btnWrap,o.btnTextOrient,o.btnBackColor,o.btnInsertTable,o.btnMerge,o.btnInsertFormula,o.btnNamedRange,o.btnIncDecimal,o.btnInsertShape,o.btnInsertEquation,o.btnInsertSymbol,o.btnInsertSlicer,o.btnInsertText,o.btnInsertTextArt,o.btnSortUp,o.btnSortDown,o.btnSetAutofilter,o.btnClearAutofilter,o.btnTableTemplate,o.btnPercentStyle,o.btnCurrencyStyle,o.btnDecDecimal,o.btnAddCell,o.btnDeleteCell,o.btnCondFormat,o.cmbNumberFormat,o.btnBorders,o.btnInsertImage,o.btnInsertHyperlink,o.btnInsertChart,o.btnColorSchemas,o.btnInsertSparkline,o.btnCopy,o.btnPaste,o.btnCut,o.btnSelectAll,o.listStyles,o.btnPrint,o.btnClearStyle,o.btnCopyStyle,o.btnPageMargins,o.btnPageSize,o.btnPageOrient,o.btnPrintArea,o.btnPrintTitles,o.btnImgAlign,o.btnImgBackward,o.btnImgForward,o.btnImgGroup,o.btnScale,o.chPrintGridlines,o.chPrintHeadings,o.btnVisibleArea,o.btnVisibleAreaClose,o.btnTextFormatting,o.btnHorizontalAlign,o.btnVerticalAlign],_.each(o.lockControls.concat([o.btnSave]),(function(t){t&&_.isFunction(t.setDisabled)&&t.setDisabled(!0)})),this.lockToolbar(Common.enumLock.disableOnStart,!0,{array:[o.btnPrint]}),this.on("render:after",_.bind(this.onToolbarAfterRender,this))),this},onAfterShowMenuScale:function(){var t=this;if(t.api){var e=t.api.asc_getPageOptions().asc_getPageSetup().asc_getScale();$("#value-custom-scale",t.mnuCustomScale.$el).html(e+"%"),t.valueCustomScale=e}t.itemCustomScale||(t.itemCustomScale=$(".custom-scale",t.mnuCustomScale.$el).on("click",_.bind((function(){t.fireEvent("click:customscale",["scale",void 0,void 0,void 0,t.valueCustomScale],this)}),this))),t.btnCustomScaleUp||(t.btnCustomScaleUp=new Common.UI.Button({el:$("#custom-scale-up",t.mnuCustomScale.$el),cls:"btn-toolbar"}).on("click",_.bind((function(){t.fireEvent("change:scalespn",["up",t.valueCustomScale],this)}),this))),t.btnCustomScaleDown||(t.btnCustomScaleDown=new Common.UI.Button({el:$("#custom-scale-down",t.mnuCustomScale.$el),cls:"btn-toolbar"}).on("click",_.bind((function(){t.fireEvent("change:scalespn",["down",t.valueCustomScale],this)}),this))),SSE.getController("Toolbar").onChangeScaleSettings()},setValueCustomScale:function(t){this.api&&null!=t&&($("#value-custom-scale",this.mnuCustomScale.$el).html(t+"%"),this.valueCustomScale=t)},render:function(t){var e=this;if(e.isCompactView=t.isCompactView,this.fireEvent("render:before",[this]),t.isEdit?e.$el.html(e.rendererComponents(e.$layout)):(e.$layout.find(".canedit").hide(),e.$layout.addClass("folded"),e.$el.html(e.$layout)),this.fireEvent("render:after",[this]),Common.UI.Mixtbar.prototype.afterRender.call(this),Common.NotificationCenter.on({"window:resize":function(){Common.UI.Mixtbar.prototype.onResize.apply(e,arguments)}}),t.isEdit){if(!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle){var i=Common.localStorage.getItem("sse-pgmargins-top"),n=Common.localStorage.getItem("sse-pgmargins-left"),o=Common.localStorage.getItem("sse-pgmargins-bottom"),s=Common.localStorage.getItem("sse-pgmargins-right");if(null!==i&&null!==n&&null!==o&&null!==s){var a=this.btnPageMargins.menu.items[0];a.options.value=a.value=[parseFloat(i),parseFloat(n),parseFloat(o),parseFloat(s)],a.setVisible(!0),$(a.el).html(a.template({id:Common.UI.getId(),caption:a.caption,options:a.options}))}else this.btnPageMargins.menu.items[0].setVisible(!1);this.btnInsertImage.menu.items[2].setVisible(t.canRequestInsertImage||t.fileChoiceUrl&&t.fileChoiceUrl.indexOf("{documentType}")>-1)}e.setTab("home")}return e.isCompactView&&e.setFolded(!0),this},onTabClick:function(t){var e=this,i=$(t.currentTarget).find("> a[data-tab]").data("tab"),n=e.isTabActive("file");if(Common.UI.Mixtbar.prototype.onTabClick.apply(e,arguments),n?e.fireEvent("file:close"):"file"==i&&(e.fireEvent("file:open"),e.setTab(i)),e.isTabActive("home")&&e.fireEvent("home:open"),e.isTabActive("pivot")){var o=SSE.getController("PivotTable");o&&o.getView("PivotTable").fireEvent("pivot:open")}},rendererComponents:function(t){var e=$(t),i=function(t,i){Common.Utils.injectComponent(e.find(t),i)};return i("#slot-field-fontname",this.cmbFontName),i("#slot-field-fontsize",this.cmbFontSize),i("#slot-btn-print",this.btnPrint),i("#slot-btn-save",this.btnSave),i("#slot-btn-undo",this.btnUndo),i("#slot-btn-redo",this.btnRedo),i("#slot-btn-copy",this.btnCopy),i("#slot-btn-paste",this.btnPaste),i("#slot-btn-cut",this.btnCut),i("#slot-btn-select-all",this.btnSelectAll),i("#slot-btn-incfont",this.btnIncFontSize),i("#slot-btn-decfont",this.btnDecFontSize),i("#slot-btn-bold",this.btnBold),i("#slot-btn-italic",this.btnItalic),i("#slot-btn-underline",this.btnUnderline),i("#slot-btn-strikeout",this.btnStrikeout),i("#slot-btn-subscript",this.btnSubscript),i("#slot-btn-fontcolor",this.btnTextColor),i("#slot-btn-fillparag",this.btnBackColor),i("#slot-btn-borders",this.btnBorders),i("#slot-btn-align-left",this.btnAlignLeft),i("#slot-btn-align-center",this.btnAlignCenter),i("#slot-btn-align-right",this.btnAlignRight),i("#slot-btn-align-just",this.btnAlignJust),i("#slot-btn-merge",this.btnMerge),i("#slot-btn-top",this.btnAlignTop),i("#slot-btn-middle",this.btnAlignMiddle),i("#slot-btn-bottom",this.btnAlignBottom),i("#slot-btn-wrap",this.btnWrap),i("#slot-btn-text-orient",this.btnTextOrient),i("#slot-btn-insimage",this.btnInsertImage),i("#slot-btn-instable",this.btnInsertTable),i("#slot-btn-inshyperlink",this.btnInsertHyperlink),i("#slot-btn-insshape",this.btnInsertShape),i("#slot-btn-instext",this.btnInsertText),i("#slot-btn-instextart",this.btnInsertTextArt),i("#slot-btn-insequation",this.btnInsertEquation),i("#slot-btn-inssymbol",this.btnInsertSymbol),i("#slot-btn-insslicer",this.btnInsertSlicer),i("#slot-btn-sortdesc",this.btnSortDown),i("#slot-btn-sortasc",this.btnSortUp),i("#slot-btn-setfilter",this.btnSetAutofilter),i("#slot-btn-clear-filter",this.btnClearAutofilter),i("#slot-btn-table-tpl",this.btnTableTemplate),i("#slot-btn-format",this.cmbNumberFormat),i("#slot-btn-percents",this.btnPercentStyle),i("#slot-btn-currency",this.btnCurrencyStyle),i("#slot-btn-digit-dec",this.btnDecDecimal),i("#slot-btn-digit-inc",this.btnIncDecimal),i("#slot-btn-formula",this.btnInsertFormula),i("#slot-btn-named-range",this.btnNamedRange),i("#slot-btn-clear",this.btnClearStyle),i("#slot-btn-copystyle",this.btnCopyStyle),i("#slot-btn-cell-ins",this.btnAddCell),i("#slot-btn-cell-del",this.btnDeleteCell),i("#slot-btn-colorschemas",this.btnColorSchemas),i("#slot-btn-search",this.btnSearch),i("#slot-btn-inschart",this.btnInsertChart),i("#slot-btn-inssparkline",this.btnInsertSparkline),i("#slot-field-styles",this.listStyles),i("#slot-btn-chart",this.btnEditChart),i("#slot-btn-chart-data",this.btnEditChartData),i("#slot-btn-chart-type",this.btnEditChartType),i("#slot-btn-pageorient",this.btnPageOrient),i("#slot-btn-pagemargins",this.btnPageMargins),i("#slot-btn-pagesize",this.btnPageSize),i("#slot-btn-printarea",this.btnPrintArea),i("#slot-btn-printtitles",this.btnPrintTitles),i("#slot-chk-print-gridlines",this.chPrintGridlines),i("#slot-chk-print-headings",this.chPrintHeadings),i("#slot-img-align",this.btnImgAlign),i("#slot-img-group",this.btnImgGroup),i("#slot-img-movefrwd",this.btnImgForward),i("#slot-img-movebkwd",this.btnImgBackward),i("#slot-btn-scale",this.btnScale),i("#slot-btn-condformat",this.btnCondFormat),i("#slot-btn-visible-area",this.btnVisibleArea),i("#slot-btn-visible-area-close",this.btnVisibleAreaClose),i("#slot-btn-formatting",this.btnTextFormatting),i("#slot-btn-halign",this.btnHorizontalAlign),i("#slot-btn-valign",this.btnVerticalAlign),this.btnsEditHeader=Common.Utils.injectButtons(e.find(".slot-editheader"),"tlbtn-editheader-","toolbar__icon btn-editheader",this.capBtnInsHeader,[Common.enumLock.editCell,Common.enumLock.selRangeEdit,Common.enumLock.headerLock,Common.enumLock.lostConnect,Common.enumLock.coAuth],void 0,void 0,void 0,"1","bottom","small"),Array.prototype.push.apply(this.lockControls,this.btnsEditHeader),e},createDelayedElements:function(){var t,e=this;function i(t,e){t&&t.updateHint(e)}if(i(this.btnPrint,this.tipPrint+Common.Utils.String.platformKey("Ctrl+P")),i(this.btnSave,this.btnSaveTip),i(this.btnCopy,this.tipCopy+Common.Utils.String.platformKey("Ctrl+C")),i(this.btnPaste,this.tipPaste+Common.Utils.String.platformKey("Ctrl+V")),i(this.btnCut,this.tipCut+Common.Utils.String.platformKey("Ctrl+X")),i(this.btnSelectAll,this.tipSelectAll+Common.Utils.String.platformKey("Ctrl+A")),i(this.btnUndo,this.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")),i(this.btnRedo,this.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")),i(this.btnIncFontSize,this.tipIncFont+Common.Utils.String.platformKey("Ctrl+]")),i(this.btnDecFontSize,this.tipDecFont+Common.Utils.String.platformKey("Ctrl+[")),i(this.btnBold,this.textBold+Common.Utils.String.platformKey("Ctrl+B")),i(this.btnItalic,this.textItalic+Common.Utils.String.platformKey("Ctrl+I")),i(this.btnUnderline,this.textUnderline+Common.Utils.String.platformKey("Ctrl+U")),i(this.btnStrikeout,this.textStrikeout),i(this.btnSubscript,this.textSubSuperscript),i(this.btnTextColor,this.tipFontColor),i(this.btnBackColor,this.tipPrColor),i(this.btnBorders,this.tipBorders),i(this.btnAlignLeft,this.tipAlignLeft),i(this.btnAlignCenter,this.tipAlignCenter),i(this.btnAlignRight,this.tipAlignRight),i(this.btnAlignJust,this.tipAlignJust),i(this.btnMerge,this.tipMerge),i(this.btnAlignTop,this.tipAlignTop),i(this.btnAlignMiddle,this.tipAlignMiddle),i(this.btnAlignBottom,this.tipAlignBottom),i(this.btnWrap,this.tipWrap),i(this.btnTextOrient,this.tipTextOrientation),i(this.btnInsertTable,this.tipInsertTable),i(this.btnInsertImage,this.tipInsertImage),i(this.btnInsertChart,this.tipInsertChartSpark),i(this.btnInsertSparkline,this.tipInsertSpark),i(this.btnInsertText,this.tipInsertText),i(this.btnInsertTextArt,this.tipInsertTextart),i(this.btnInsertHyperlink,this.tipInsertHyperlink+Common.Utils.String.platformKey("Ctrl+K")),i(this.btnInsertShape,this.tipInsertShape),i(this.btnInsertEquation,this.tipInsertEquation),i(this.btnInsertSymbol,this.tipInsertSymbol),i(this.btnInsertSlicer,this.tipInsertSlicer),i(this.btnSortDown,this.txtSortAZ),i(this.btnSortUp,this.txtSortZA),i(this.btnSetAutofilter,this.txtFilter+" (Ctrl+Shift+L)"),i(this.btnClearAutofilter,this.txtClearFilter),i(this.btnSearch,this.txtSearch),i(this.btnTableTemplate,this.txtTableTemplate),i(this.btnPercentStyle,this.tipDigStylePercent),i(this.btnCurrencyStyle,this.tipDigStyleAccounting),i(this.btnDecDecimal,this.tipDecDecimal),i(this.btnIncDecimal,this.tipIncDecimal),i(this.btnInsertFormula,[this.txtAutosumTip+Common.Utils.String.platformKey("Alt+="),this.txtFormula+Common.Utils.String.platformKey("Shift+F3")]),i(this.btnNamedRange,this.txtNamedRange),i(this.btnClearStyle,this.tipClearStyle),i(this.btnCopyStyle,this.tipCopyStyle),i(this.btnAddCell,this.tipInsertOpt+Common.Utils.String.platformKey("Ctrl+Shift+=")),i(this.btnDeleteCell,this.tipDeleteOpt+Common.Utils.String.platformKey("Ctrl+Shift+-")),i(this.btnColorSchemas,this.tipColorSchemas),i(this.btnPageOrient,this.tipPageOrient),i(this.btnPageSize,this.tipPageSize),i(this.btnPageMargins,this.tipPageMargins),i(this.btnPrintArea,this.tipPrintArea),i(this.btnPrintTitles,this.tipPrintTitles),i(this.btnScale,this.tipScale),i(this.btnCondFormat,this.tipCondFormat),i(this.btnVisibleArea,this.tipVisibleArea),i(this.btnTextFormatting,this.tipTextFormatting),i(this.btnHorizontalAlign,this.tipHAlighOle),i(this.btnVerticalAlign,this.tipVAlighOle),this.btnsEditHeader.forEach((function(t){i(t,e.tipEditHeader)})),this.btnBorders&&this.btnBorders.rendered&&(this.btnBorders.setMenu(new Common.UI.Menu({items:[{caption:this.textOutBorders,iconCls:"menu__icon btn-border-out",icls:"btn-border-out",borderId:"outer"},{caption:this.textAllBorders,iconCls:"menu__icon btn-border-all",icls:"btn-border-all",borderId:"all"},{caption:this.textTopBorders,iconCls:"menu__icon btn-border-top",icls:"btn-border-top",borderId:Asc.c_oAscBorderOptions.Top},{caption:this.textBottomBorders,iconCls:"menu__icon btn-border-bottom",icls:"btn-border-bottom",borderId:Asc.c_oAscBorderOptions.Bottom},{caption:this.textLeftBorders,iconCls:"menu__icon btn-border-left",icls:"btn-border-left",borderId:Asc.c_oAscBorderOptions.Left},{caption:this.textRightBorders,iconCls:"menu__icon btn-border-right",icls:"btn-border-right",borderId:Asc.c_oAscBorderOptions.Right},{caption:this.textNoBorders,iconCls:"menu__icon btn-border-no",icls:"btn-border-no",borderId:"none"},{caption:"--"},{caption:this.textInsideBorders,iconCls:"menu__icon btn-border-inside",icls:"btn-border-inside",borderId:"inner"},{caption:this.textCenterBorders,iconCls:"menu__icon btn-border-insidevert",icls:"btn-border-insidevert",borderId:Asc.c_oAscBorderOptions.InnerV},{caption:this.textMiddleBorders,iconCls:"menu__icon btn-border-insidehor",icls:"btn-border-insidehor",borderId:Asc.c_oAscBorderOptions.InnerH},{caption:this.textDiagUpBorder,iconCls:"menu__icon btn-border-diagup",icls:"btn-border-diagup",borderId:Asc.c_oAscBorderOptions.DiagU},{caption:this.textDiagDownBorder,iconCls:"menu__icon btn-border-diagdown",icls:"btn-border-diagdown",borderId:Asc.c_oAscBorderOptions.DiagD},{caption:"--"},{id:"id-toolbar-mnu-item-border-width",caption:this.textBordersStyle,iconCls:"menu__icon btn-border-style",menu:(t=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div class="border-size-item" style="background-position: 0 -<%= options.offsety %>px;"></div></a>'),e.mnuBorderWidth=new Common.UI.Menu({style:"min-width: 100px;",menuAlign:"tl-tr",id:"toolbar-menu-borders-width",items:[{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Thin,offsety:0,checked:!0},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Hair,offsety:20},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Dotted,offsety:40},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Dashed,offsety:60},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.DashDot,offsety:80},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.DashDotDot,offsety:100},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Medium,offsety:120},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashed,offsety:140},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashDot,offsety:160},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashDotDot,offsety:180},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Thick,offsety:200}]}),e.mnuBorderWidth)},this.mnuBorderColor=new Common.UI.MenuItem({id:"id-toolbar-mnu-item-border-color",caption:this.textBordersColor,iconCls:"mnu-icon-item mnu-border-color",template:_.template('<a id="<%= id %>"tabindex="-1" type="menuitem"><span class="menu-item-icon" style="background-image: none; width: 12px; height: 12px; margin: 2px 9px 0 -11px; border-style: solid; border-width: 3px; border-color: #000;"></span><%= caption %></a>'),menu:new Common.UI.Menu({menuAlign:"tl-tr",cls:"shifted-left",items:[{id:"id-toolbar-menu-auto-bordercolor",caption:this.textAutoColor,template:_.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto" style="background-image: none; width: 12px; height: 12px; margin: 1px 7px 0 1px; background-color: #000;"></span><%= caption %></a>'),stopPropagation:!0},{caption:"--"},{template:_.template('<div id="id-toolbar-menu-bordercolor" style="width: 164px;display: inline-block;"></div>'),stopPropagation:!0},{caption:"--"},{id:"id-toolbar-menu-new-bordercolor",template:_.template('<a tabindex="-1" type="menuitem" style="padding-left:12px;">'+this.textNewColor+"</a>"),stopPropagation:!0}]})})]})),this.mnuBorderColorPicker=new Common.UI.ThemeColorPalette({el:$("#id-toolbar-menu-bordercolor"),outerMenu:{menu:this.mnuBorderColor.menu,index:2}}),this.mnuBorderColor.menu.setInnerMenu([{menu:this.mnuBorderColorPicker,index:2}])),this.btnInsertChart){this.btnInsertChart.setMenu(new Common.UI.Menu({style:"width: 364px;padding-top: 12px;",items:[{template:_.template('<div id="id-toolbar-menu-insertchart" class="menu-insertchart"></div>')}]}));var n=function(t){new Common.UI.DataView({el:$("#id-toolbar-menu-insertchart"),parentMenu:t,showLast:!1,restoreHeight:465,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getChartGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getChartData()),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')}).on("item:click",(function(i,n,o,s){o&&e.fireEvent("add:chart",[o.get("group"),o.get("type")]),"click"!==s.type&&t.hide()})),t.off("show:before",n)};this.btnInsertChart.menu.on("show:before",n)}if(this.btnInsertSparkline){this.btnInsertSparkline.setMenu(new Common.UI.Menu({style:"width: 166px;padding: 5px 0 10px;",items:[{template:_.template('<div id="id-toolbar-menu-insertspark" class="menu-insertchart"></div>')}]}));n=function(t){new Common.UI.DataView({el:$("#id-toolbar-menu-insertspark"),parentMenu:t,showLast:!1,restoreHeight:50,store:new Common.UI.DataViewStore(Common.define.chartData.getSparkData()),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')}).on("item:click",(function(i,n,o,s){o&&e.fireEvent("add:spark",[o.get("type")]),"click"!==s.type&&t.hide()})),t.off("show:before",n)};this.btnInsertSparkline.menu.on("show:before",n)}if(this.btnInsertTextArt){var o=function(t){var i=SSE.getCollection("Common.Collections.TextArt");i.length<1&&SSE.getController("Main").fillTextArt(e.api.asc_getTextArtPreviews()),new Common.UI.DataView({el:$("#id-toolbar-menu-insart"),store:i,parentMenu:t,showLast:!1,itemTemplate:_.template('<div class="item-art"><img src="<%= imageUrl %>" id="<%= id %>" style="width:50px;height:50px;"></div>')}).on("item:click",(function(i,n,o,s){o&&e.fireEvent("insert:textart",[o.get("data")]),"click"!==s.type&&t.hide()})),t.off("show:before",o)};this.btnInsertTextArt.menu.on("show:before",o)}this.btnCondFormat&&this.btnCondFormat.rendered&&this.btnCondFormat.setMenu(new Common.UI.Menu({items:[{caption:Common.define.conditionalData.textValue,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textGreater,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThan},{caption:Common.define.conditionalData.textGreaterEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThanOrEqual},{caption:Common.define.conditionalData.textLess,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThan},{caption:Common.define.conditionalData.textLessEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThanOrEqual},{caption:Common.define.conditionalData.textEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.equal},{caption:Common.define.conditionalData.textNotEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notEqual},{caption:Common.define.conditionalData.textBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.between},{caption:Common.define.conditionalData.textNotBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notBetween}]})},{caption:Common.define.conditionalData.textTop+"/"+Common.define.conditionalData.textBottom,type:Asc.c_oAscCFType.top10,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textTop+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:0,percent:!1},{caption:Common.define.conditionalData.textTop+" 10%",type:Asc.c_oAscCFType.top10,value:0,percent:!0},{caption:Common.define.conditionalData.textBottom+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:1,percent:!1},{caption:Common.define.conditionalData.textBottom+" 10%",type:Asc.c_oAscCFType.top10,value:1,percent:!0}]})},{caption:Common.define.conditionalData.textAverage,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textAbove,type:Asc.c_oAscCFType.aboveAverage,value:0},{caption:Common.define.conditionalData.textBelow,type:Asc.c_oAscCFType.aboveAverage,value:1},{caption:Common.define.conditionalData.textEqAbove,type:Asc.c_oAscCFType.aboveAverage,value:2},{caption:Common.define.conditionalData.textEqBelow,type:Asc.c_oAscCFType.aboveAverage,value:3},{caption:Common.define.conditionalData.text1Above,type:Asc.c_oAscCFType.aboveAverage,value:4},{caption:Common.define.conditionalData.text1Below,type:Asc.c_oAscCFType.aboveAverage,value:5},{caption:Common.define.conditionalData.text2Above,type:Asc.c_oAscCFType.aboveAverage,value:6},{caption:Common.define.conditionalData.text2Below,type:Asc.c_oAscCFType.aboveAverage,value:7},{caption:Common.define.conditionalData.text3Above,type:Asc.c_oAscCFType.aboveAverage,value:8},{caption:Common.define.conditionalData.text3Below,type:Asc.c_oAscCFType.aboveAverage,value:9}]})},{caption:Common.define.conditionalData.textText,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textContains,type:Asc.c_oAscCFType.containsText},{caption:Common.define.conditionalData.textNotContains,type:Asc.c_oAscCFType.notContainsText},{caption:Common.define.conditionalData.textBegins,type:Asc.c_oAscCFType.beginsWith},{caption:Common.define.conditionalData.textEnds,type:Asc.c_oAscCFType.endsWith}]})},{caption:Common.define.conditionalData.textDate,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textYesterday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.yesterday},{caption:Common.define.conditionalData.textToday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.today},{caption:Common.define.conditionalData.textTomorrow,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.tomorrow},{caption:Common.define.conditionalData.textLast7days,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.last7Days},{caption:Common.define.conditionalData.textLastWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastWeek},{caption:Common.define.conditionalData.textThisWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisWeek},{caption:Common.define.conditionalData.textNextWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextWeek},{caption:Common.define.conditionalData.textLastMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastMonth},{caption:Common.define.conditionalData.textThisMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisMonth},{caption:Common.define.conditionalData.textNextMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextMonth}]})},{caption:Common.define.conditionalData.textBlank+"/"+Common.define.conditionalData.textError,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textBlanks,type:Asc.c_oAscCFType.containsBlanks},{caption:Common.define.conditionalData.textNotBlanks,type:Asc.c_oAscCFType.notContainsBlanks},{caption:Common.define.conditionalData.textErrors,type:Asc.c_oAscCFType.containsErrors},{caption:Common.define.conditionalData.textNotErrors,type:Asc.c_oAscCFType.notContainsErrors}]})},{caption:Common.define.conditionalData.textDuplicate+"/"+Common.define.conditionalData.textUnique,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textDuplicate,type:Asc.c_oAscCFType.duplicateValues},{caption:Common.define.conditionalData.textUnique,type:Asc.c_oAscCFType.uniqueValues}]})},{caption:"--"},this.mnuDataBars=new Common.UI.MenuItem({caption:this.textDataBars,type:Asc.c_oAscCFType.dataBar,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuColorScales=new Common.UI.MenuItem({caption:this.textColorScales,type:Asc.c_oAscCFType.colorScale,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuIconSets=new Common.UI.MenuItem({caption:Common.define.conditionalData.textIconSets,type:Asc.c_oAscCFType.iconSet,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),{caption:"--"},{caption:Common.define.conditionalData.textFormula,type:Asc.c_oAscCFType.expression},{caption:"--"},{caption:this.textNewRule,value:"new"},{caption:this.textClearRule,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:"clear",type:Asc.c_oAscSelectionForCFType.selection,caption:this.textSelection},{value:"clear",type:Asc.c_oAscSelectionForCFType.worksheet,caption:this.textThisSheet},{value:"clear",type:Asc.c_oAscSelectionForCFType.table,caption:this.textThisTable},{value:"clear",type:Asc.c_oAscSelectionForCFType.pivot,caption:this.textThisPivot}]})},{caption:this.textManageRule,value:"manage"}]})),this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||this.updateMetricUnit()},onToolbarAfterRender:function(t){this.btnTextColor&&this.btnTextColor.cmpEl&&(this.btnTextColor.setMenu(),this.mnuTextColorPicker=this.btnTextColor.getPicker(),this.btnTextColor.setColor(this.btnTextColor.currentColor||"transparent")),this.btnBackColor&&this.btnBackColor.cmpEl&&(this.btnBackColor.setMenu(),this.mnuBackColorPicker=this.btnBackColor.getPicker(),this.btnBackColor.setColor(this.btnBackColor.currentColor||"transparent"))},updateMetricUnit:function(){for(var t=this.btnPageMargins.menu.items,e=0;e<t.length;e++){if((n=t[e]).checkable){var i=n.checked;$(n.el).html(n.template({id:Common.UI.getId(),caption:n.caption,options:n.options})),i&&n.setChecked(i)}}t=this.btnPageSize.menu.items;for(e=0;e<t.length;e++){var n;if((n=t[e]).checkable){i=n.checked;$(n.el).html(n.template({id:Common.UI.getId(),caption:n.caption,options:n.options})),i&&n.setChecked(i)}}},setApi:function(t){return this.api=t,this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||(this.api.asc_registerCallback("asc_onCollaborativeChanges",_.bind(this.onApiCollaborativeChanges,this)),this.api.asc_registerCallback("asc_onSendThemeColorSchemes",_.bind(this.onApiSendThemeColorSchemes,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onApiUsersChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onApiUsersChanged,this))),this},setMode:function(t){return t.isDisconnected?(this.lockToolbar(Common.enumLock.lostConnect,!0),this.lockToolbar(Common.enumLock.lostConnect,!0,{array:[this.btnEditChart,this.btnEditChartData,this.btnEditChartType,this.btnUndo,this.btnRedo,this.btnSave,this.btnVisibleArea,this.btnVisibleAreaClose]}),this.synchTooltip&&this.synchTooltip.hide(),t.enableDownload||this.lockToolbar(Common.enumLock.cantPrint,!0,{array:[this.btnPrint]})):(this.mode=t,this.lockToolbar(Common.enumLock.cantPrint,!t.canPrint,{array:[this.btnPrint]})),this},onApiSendThemeColorSchemes:function(t){var e=this;this.mnuColorSchema=this.btnColorSchemas.menu,this.mnuColorSchema&&this.mnuColorSchema.items.length>0&&_.each(this.mnuColorSchema.items,(function(t){t.remove()})),null==this.mnuColorSchema&&(this.mnuColorSchema=new Common.UI.Menu({cls:"shifted-left",restoreHeight:!0})),this.mnuColorSchema.items=[];var i=_.template(['<a id="<%= id %>" class="<%= options.cls %>" tabindex="-1" type="menuitem">','<span class="colors">',"<% _.each(options.colors, function(color) { %>",'<span class="color" style="background: <%= color %>;"></span>',"<% }) %>","</span>",'<span class="text"><%= caption %></span>',"</a>"].join(""));_.each(t,(function(t,n){for(var o=t.get_colors(),s=[],a=2;a<7;a++){var l="#"+Common.Utils.ThemeColor.getHexColor(o[a].get_r(),o[a].get_g(),o[a].get_b());s.push(l)}22==n&&this.mnuColorSchema.addItem({caption:"--"});var r=t.get_name();this.mnuColorSchema.addItem({template:i,cls:"color-schemas-menu",colors:s,caption:n<22&&e.SchemeNames[n]||r,value:n,checkable:!0,toggleGroup:"menuSchema"})}),this)},onApiCollaborativeChanges:function(){this._state.hasCollaborativeChanges||this.btnCollabChanges.rendered&&(this._state.hasCollaborativeChanges=!0,this.btnCollabChanges.cmpEl.addClass("notify"),this.showSynchTip?(this.btnCollabChanges.updateHint(""),void 0===this.synchTooltip&&this.createSynchTip(),this.synchTooltip.show()):this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),this.btnSave.setDisabled(!1),Common.Gateway.collaborativeChanges())},createSynchTip:function(){this.synchTooltip=new Common.UI.SynchronizeTip({extCls:this.mode.customization&&this.mode.customization.compactHeader?void 0:"inc-index",placement:"right-bottom",target:this.btnCollabChanges.$el}),this.synchTooltip.on("dontshowclick",(function(){this.showSynchTip=!1,this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),Common.localStorage.setItem("sse-hide-synch",1)}),this),this.synchTooltip.on("closeclick",(function(){this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S"))}),this)},synchronizeChanges:function(){if(this.btnCollabChanges.rendered){var t=this;t.btnCollabChanges.cmpEl.hasClass("notify")&&(t.btnCollabChanges.cmpEl.removeClass("notify"),this.synchTooltip&&this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.btnSaveTip),this.btnSave.setDisabled(!t.mode.forcesave),this._state.hasCollaborativeChanges=!1)}},onApiUsersChanged:function(t){var e=[];_.each(t,(function(t){t.asc_getView()||e.push(t)}));var i=_.size(e),n=i>1?"btn-save-coauth":"btn-save";n!==this.btnSaveCls&&this.btnCollabChanges.rendered&&(this.btnSaveTip=(i>1?this.tipSaveCoauth:this.tipSave)+Common.Utils.String.platformKey("Ctrl+S"),this.btnCollabChanges.updateHint(this.btnSaveTip),this.btnCollabChanges.$icon.removeClass(this.btnSaveCls).addClass(n),this.btnSaveCls=n)},onAppReady:function(t){if(this.mode.isEdit&&!this.mode.isEditMailMerge&&!this.mode.isEditDiagram&&!this.mode.isEditOle){var e=this,i=SSE.getController("DocumentHolder").getView("DocumentHolder");e.btnImgForward.updateHint(e.tipSendForward),e.btnImgForward.setMenu(new Common.UI.Menu({items:[{caption:i.textArrangeFront,iconCls:"menu__icon arrange-front",value:Asc.c_oAscDrawingLayerType.BringToFront},{caption:i.textArrangeForward,iconCls:"menu__icon arrange-forward",value:Asc.c_oAscDrawingLayerType.BringForward}]})),e.btnImgBackward.updateHint(e.tipSendBackward),e.btnImgBackward.setMenu(new Common.UI.Menu({items:[{caption:i.textArrangeBack,iconCls:"menu__icon arrange-back",value:Asc.c_oAscDrawingLayerType.SendToBack},{caption:i.textArrangeBackward,iconCls:"menu__icon arrange-backward",value:Asc.c_oAscDrawingLayerType.SendBackward}]})),e.btnImgAlign.updateHint(e.tipImgAlign),e.btnImgAlign.setMenu(new Common.UI.Menu({items:[{caption:i.textShapeAlignLeft,iconCls:"menu__icon shape-align-left",value:0},{caption:i.textShapeAlignCenter,iconCls:"menu__icon shape-align-center",value:4},{caption:i.textShapeAlignRight,iconCls:"menu__icon shape-align-right",value:1},{caption:i.textShapeAlignTop,iconCls:"menu__icon shape-align-top",value:3},{caption:i.textShapeAlignMiddle,iconCls:"menu__icon shape-align-middle",value:5},{caption:i.textShapeAlignBottom,iconCls:"menu__icon shape-align-bottom",value:2},{caption:"--"},{caption:i.txtDistribHor,iconCls:"menu__icon shape-distribute-hor",value:6},{caption:i.txtDistribVert,iconCls:"menu__icon shape-distribute-vert",value:7}]})),e.btnImgGroup.updateHint(e.tipImgGroup),e.btnImgGroup.setMenu(new Common.UI.Menu({items:[{caption:i.txtGroup,iconCls:"menu__icon shape-group",value:"grouping"},{caption:i.txtUngroup,iconCls:"menu__icon shape-ungroup",value:"ungrouping"}]}))}},textBold:"Bold",textItalic:"Italic",textUnderline:"Underline",textStrikeout:"Strikeout",textSuperscript:"Superscript",textSubscript:"Subscript",textSubSuperscript:"Subscript/Superscript",tipFontName:"Font Name",tipFontSize:"Font Size",tipCellStyle:"Cell Style",tipCopy:"Copy",tipPaste:"Paste",tipUndo:"Undo",tipRedo:"Redo",tipPrint:"Print",tipSave:"Save",tipFontColor:"Font color",tipPrColor:"Background color",tipClearStyle:"Clear",tipCopyStyle:"Copy Style",tipBack:"Back",tipAlignLeft:"Align Left",tipAlignRight:"Align Right",tipAlignCenter:"Align Center",tipAlignJust:"Justified",textAlignTop:"Align text to the top",textAlignMiddle:"Align text to the middle",textAlignBottom:"Align text to the bottom",tipNumFormat:"Number Format",txtNumber:"Number",txtInteger:"Integer",txtGeneral:"General",txtCustom:"Custom",txtCurrency:"Currency",txtDollar:"$ Dollar",txtEuro:"€ Euro",txtRouble:"₽ Rouble",txtPound:"£ Pound",txtYen:"¥ Yen",txtAccounting:"Accounting",txtDate:"Date",txtTime:"Time",txtDateTime:"Date & Time",txtPercentage:"Percentage",txtFraction:"Fraction",txtScientific:"Scientific",txtText:"Text",tipBorders:"Borders",textOutBorders:"Outside Borders",textAllBorders:"All Borders",textTopBorders:"Top Borders",textBottomBorders:"Bottom Borders",textLeftBorders:"Left Borders",textRightBorders:"Right Borders",textNoBorders:"No Borders",textInsideBorders:"Inside Borders",textMiddleBorders:"Inside Horizontal Borders",textCenterBorders:"Inside Vertical Borders",textDiagDownBorder:"Diagonal Down Border",textDiagUpBorder:"Diagonal Up Border",tipWrap:"Wrap Text",txtClearAll:"All",txtClearText:"Text",txtClearFormat:"Format",txtClearFormula:"Formula",txtClearHyper:"Hyperlink",txtClearComments:"Comments",tipMerge:"Merge",txtMergeCenter:"Merge Center",txtMergeAcross:"Merge Across",txtMergeCells:"Merge Cells",txtUnmerge:"Unmerge Cells",tipIncDecimal:"Increase Decimal",tipDecDecimal:"Decrease Decimal",tipAutofilter:"Set Autofilter",tipInsertImage:"Insert Image",tipInsertHyperlink:"Add Hyperlink",tipSynchronize:"The document has been changed by another user. Please click to save your changes and reload the updates.",tipIncFont:"Increment font size",tipDecFont:"Decrement font size",tipInsertText:"Insert Text",tipInsertTextart:"Insert Text Art",tipInsertShape:"Insert Autoshape",tipDigStylePercent:"Percent Style",tipDigStyleAccounting:"Accounting Style",tipTextOrientation:"Orientation",tipInsertOpt:"Insert Cells",tipDeleteOpt:"Delete Cells",tipAlignTop:"Align Top",tipAlignMiddle:"Align Middle",tipAlignBottom:"Align Bottom",textBordersStyle:"Border Style",textBordersColor:"Borders Color",textAlignLeft:"Left align text",textAlignRight:"Right align text",textAlignCenter:"Center text",textAlignJust:"Justify",txtSort:"Sort",txtFormula:"Insert Function",txtNoBorders:"No borders",txtAdditional:"Insert Function",mniImageFromFile:"Image from file",mniImageFromUrl:"Image from url",textNewColor:"Add New Custom Color",tipInsertChart:"Insert Chart",tipEditChart:"Edit Chart",textPrint:"Print",textPrintOptions:"Print Options",tipColorSchemas:"Change Color Scheme",txtSortAZ:"Sort A to Z",txtSortZA:"Sort Z to A",txtFilter:"Filter",txtTableTemplate:"Format As Table Template",textHorizontal:"Horizontal Text",textCounterCw:"Angle Counterclockwise",textClockwise:"Angle Clockwise",textRotateUp:"Rotate Text Up",textRotateDown:"Rotate Text Down",textInsRight:"Shift Cells Right",textInsDown:"Shift Cells Down",textEntireRow:"Entire Row",textEntireCol:"Entire Column",textDelLeft:"Shift Cells Left",textDelUp:"Shift Cells Up",textZoom:"Zoom",txtScheme1:"Office",txtScheme2:"Grayscale",txtScheme3:"Apex",txtScheme4:"Aspect",txtScheme5:"Civic",txtScheme6:"Concourse",txtScheme7:"Equity",txtScheme8:"Flow",txtScheme9:"Foundry",txtScheme10:"Median",txtScheme11:"Metro",txtScheme12:"Module",txtScheme13:"Opulent",txtScheme14:"Oriel",txtScheme15:"Origin",txtScheme16:"Paper",txtScheme17:"Solstice",txtScheme18:"Technic",txtScheme19:"Trek",txtScheme20:"Urban",txtScheme21:"Verve",txtClearFilter:"Clear Filter",tipSaveCoauth:"Save your changes for the other users to see them.",txtSearch:"Search",txtNamedRange:"Named Ranges",txtNewRange:"Define Name",txtManageRange:"Name manager",txtPasteRange:"Paste name",textInsCharts:"Charts",tipInsertEquation:"Insert Equation",tipInsertChartSpark:"Insert Chart",textMoreFormats:"More formats",capInsertText:"Text",capInsertTextart:"Text Art",capInsertImage:"Image",capInsertShape:"Shape",capInsertChart:"Chart",capInsertHyperlink:"Hyperlink",capInsertEquation:"Equation",capBtnComment:"Comment",textTabFile:"File",textTabHome:"Home",textTabInsert:"Insert",tipChangeChart:"Change Chart Type",textTabCollaboration:"Collaboration",textTabProtect:"Protection",textTabLayout:"Layout",capBtnPageOrient:"Orientation",capBtnMargins:"Margins",capBtnPageSize:"Size",tipImgAlign:"Align objects",tipImgGroup:"Group objects",tipSendForward:"Bring forward",tipSendBackward:"Send backward",capImgAlign:"Align",capImgGroup:"Group",capImgForward:"Bring Forward",capImgBackward:"Send Backward",tipPageSize:"Page Size",tipPageOrient:"Page Orientation",tipPageMargins:"Page Margins",textMarginsLast:"Last Custom",textMarginsNormal:"Normal",textMarginsNarrow:"Narrow",textMarginsWide:"Wide",textPageMarginsCustom:"Custom margins",textTop:"Top: ",textLeft:"Left: ",textBottom:"Bottom: ",textRight:"Right: ",textPortrait:"Portrait",textLandscape:"Landscape",mniImageFromStorage:"Image from Storage",capBtnPrintArea:"Print Area",textSetPrintArea:"Set Print Area",textClearPrintArea:"Clear Print Area",textAddPrintArea:"Add to Print Area",tipPrintArea:"Print area",capBtnInsHeader:"Header/Footer",tipEditHeader:"Edit header or footer",textTabData:"Data",capInsertTable:"Table",tipInsertTable:"Insert table",textTabFormula:"Formula",capBtnScale:"Scale to Fit",tipScale:"Scale to Fit",textScaleCustom:"Custom",textScale:"Scale",textAuto:"Auto",textOnePage:"page",textFewPages:"pages",textManyPages:"pages",textHeight:"Height",textWidth:"Width",textMorePages:"More pages",capBtnAddComment:"Add Comment",capBtnInsSymbol:"Symbol",tipInsertSymbol:"Insert symbol",txtAutosumTip:"Summation",capBtnPrintTitles:"Print Titles",tipPrintTitles:"Print titles",capBtnColorSchemas:"Color Scheme",tipCondFormat:"Conditional formatting",textDataBars:"Data Bars",textColorScales:"Color Scales",textNewRule:"New Rule",textClearRule:"Clear Rules",textSelection:"From current selection",textThisSheet:"From this worksheet",textThisTable:"From this table",textThisPivot:"From this pivot",textManageRule:"Manage Rules",capBtnInsSlicer:"Slicer",tipInsertSlicer:"Insert slicer",textVertical:"Vertical Text",textTabView:"View",tipEditChartData:"Select Data",tipEditChartType:"Change Chart Type",textAutoColor:"Automatic",textItems:"Items",tipInsertSpark:"Insert sparkline",capInsertSpark:"Sparklines",txtScheme22:"New Office",textPrintGridlines:"Print gridlines",textPrintHeadings:"Print headings",textShowVA:"Show Visible Area",textHideVA:"Hide Visible Area",textEditVA:"Edit Visible Area",tipVisibleArea:"Visible area",textDone:"Done",tipTextFormatting:"More text formatting tools",tipHAlighOle:"Horizontal Align",tipVAlighOle:"Vertical Align",tipSelectAll:"Select all",tipCut:"Cut"},SSE.Views.Toolbar||{}))})),define("spreadsheeteditor/main/app/model/TableTemplate",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.TableTemplate=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,caption:null,type:null,imageUrl:null}}})})),define("spreadsheeteditor/main/app/collection/TableTemplates",["backbone","spreadsheeteditor/main/app/model/TableTemplate"],(function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},SSE.Collections.TableTemplates=t.Collection.extend({model:SSE.Models.TableTemplate})})),define("spreadsheeteditor/main/app/view/PivotTable",["common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboDataView","common/main/lib/component/Layout"],(function(t){"use strict";SSE.Views.PivotTable=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;this.btnsAddPivot.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("pivottable:create")}))})),this.btnPivotLayout.menu.on("item:click",(function(e,i,n){t.fireEvent("pivottable:layout",[i.value])})),this.btnPivotBlankRows.menu.on("item:click",(function(e,i,n){t.fireEvent("pivottable:blankrows",[i.value])})),this.btnPivotSubtotals.menu.on("item:click",(function(e,i,n){t.fireEvent("pivottable:subtotals",[i.value])})),this.btnPivotGrandTotals.menu.on("item:click",(function(e,i,n){t.fireEvent("pivottable:grandtotals",[i.value])})),this.btnRefreshPivot.on("click",(function(e){t.fireEvent("pivottable:refresh")})),this.btnSelectPivot.on("click",(function(e){t.fireEvent("pivottable:select")})),this.chRowHeader.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[0,i])})),this.chColHeader.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[1,i])})),this.chRowBanded.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[2,i])})),this.chColBanded.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[3,i])})),this.pivotStyles.on("click",(function(e,i){t.fireEvent("pivottable:style",[i])})),this.pivotStyles.openButton.menu.on("show:after",(function(){t.pivotStyles.menuPicker.scroller.update({alwaysVisibleY:!0})}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.toolbar=t.toolbar,this.lockedControls=[];var e=Common.enumLock;this.btnsAddPivot=Common.Utils.injectButtons(this.toolbar.$el.find(".btn-slot.slot-add-pivot"),"","toolbar__icon btn-pivot-sum",this.txtPivotTable,[e.lostConnect,e.coAuth,e.editPivot,e.selRangeEdit,e.selChart,e.selChartText,e.selShape,e.selShapeText,e.selImage,e.selSlicer,e.editCell,e.wsLock],void 0,void 0,void 0,"1","bottom","small"),this.chRowHeader=new Common.UI.CheckBox({labelText:this.textRowHeader,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chRowHeader),this.chColHeader=new Common.UI.CheckBox({labelText:this.textColHeader,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chColHeader),this.chRowBanded=new Common.UI.CheckBox({labelText:this.textRowBanded,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chRowBanded),this.chColBanded=new Common.UI.CheckBox({labelText:this.textColBanded,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chColBanded),this.btnPivotLayout=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pivot-layout",caption:this.capLayout,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotLayout),this.btnPivotBlankRows=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-blank-rows",caption:this.capBlankRows,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotBlankRows),this.btnPivotSubtotals=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-subtotals",caption:this.capSubtotals,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotSubtotals),this.btnPivotGrandTotals=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-grand-totals",caption:this.capGrandTotals,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotGrandTotals),this.btnRefreshPivot=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-update",caption:this.txtRefresh,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnRefreshPivot),this.btnSelectPivot=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-select-pivot",caption:this.txtSelect,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.PivotTables],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnSelectPivot),this.pivotStyles=new Common.UI.ComboDataView({cls:"combo-pivot-template",enableKeyEvents:!0,itemWidth:61,itemHeight:49,menuMaxHeight:300,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],beforeOpenHandler:function(t){var e=this,i=e.openButton.menu;if(i.cmpEl){var n=$(e.cmpEl.find(".dataview.inner .style").get(0)).parent(),o=n.is(":visible")?parseFloat(n.css("width")):e.itemWidth+parseFloat(n.css("padding-left"))+parseFloat(n.css("padding-right"))+parseFloat(n.css("border-left-width"))+parseFloat(n.css("border-right-width"));i.menuAlignEl=e.cmpEl,i.menuAlign="tl-tl";var s=4*(8+o)+17,a=e.openButton.$el.offset().left;s>Common.Utils.innerWidth()&&(s=Math.max(Math.floor((Common.Utils.innerWidth()-17)/(8+o)),2)*(8+o)+17);var l=e.cmpEl.width()-e.openButton.$el.width()-Math.min(s,a)-1;i.setOffset(Math.min(l,0)),i.cmpEl.css({width:s,"min-height":e.cmpEl.height()})}},dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"-16, 0"}),this.lockedControls.push(this.pivotStyles),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnsAddPivot.forEach((function(t){t.updateHint(i.tipCreatePivot)})),i.btnRefreshPivot.updateHint(i.tipRefresh),i.btnSelectPivot.updateHint(i.tipSelect),i.btnPivotLayout.updateHint(i.capLayout),i.btnPivotLayout.setMenu(new Common.UI.Menu({items:[{caption:i.mniLayoutCompact,value:0},{caption:i.mniLayoutOutline,value:1},{caption:i.mniLayoutTabular,value:2},{caption:"--"},{caption:i.mniLayoutRepeat,value:3},{caption:i.mniLayoutNoRepeat,value:4}]})),i.btnPivotBlankRows.updateHint(i.capBlankRows),i.btnPivotBlankRows.setMenu(new Common.UI.Menu({items:[{caption:i.mniInsertBlankLine,value:"insert"},{caption:i.mniRemoveBlankLine,value:"remove"}]})),i.btnPivotSubtotals.updateHint(i.tipSubtotals),i.btnPivotSubtotals.setMenu(new Common.UI.Menu({items:[{caption:i.mniNoSubtotals,value:0},{caption:i.mniBottomSubtotals,value:1},{caption:i.mniTopSubtotals,value:2}]})),i.btnPivotGrandTotals.updateHint(i.tipGrandTotals),i.btnPivotGrandTotals.setMenu(new Common.UI.Menu({items:[{caption:i.mniOffTotals,value:0},{caption:i.mniOnTotals,value:1},{caption:i.mniOnRowsTotals,value:2},{caption:i.mniOnColumnsTotals,value:3}]})),t.call(i)}))},getPanel:function(){this.$el=$(_.template('<section id="pivot-table-panel" class="panel" data-tab="pivot"><div class="group"><span class="btn-slot text x-huge slot-add-pivot"></span></div><div class="separator long"></div><div class="group"><span id="slot-btn-pivot-report-layout" class="btn-slot text x-huge"></span><span id="slot-btn-pivot-blank-rows" class="btn-slot text x-huge"></span><span id="slot-btn-pivot-subtotals" class="btn-slot text x-huge"></span><span id="slot-btn-pivot-grand-totals" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group"><span id="slot-btn-refresh-pivot" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group"><span id="slot-btn-select-pivot" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-header-row"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-header-column"></span></div></div><div class="separator long invisible"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-banded-row"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-banded-column"></span></div></div><div class="separator long invisible"></div><div class="group flex small" id="slot-field-pivot-styles" style="width: 324px;max-width: 324px;min-width: 105px;" data-group-width="324px"></div></section>')({}));var t=Common.enumLock;return this.btnsAddPivot=this.btnsAddPivot.concat(Common.Utils.injectButtons(this.$el.find(".btn-slot.slot-add-pivot"),"","toolbar__icon btn-pivot-sum",this.txtCreate,[t.lostConnect,t.coAuth,t.editPivot,t.selRangeEdit,t.selChart,t.selChartText,t.selShape,t.selShapeText,t.selImage,t.selSlicer,t.editCell,t.wsLock],void 0,void 0,void 0,"1","bottom","small")),this.chRowHeader.render(this.$el.find("#slot-chk-header-row")),this.chColHeader.render(this.$el.find("#slot-chk-header-column")),this.chRowBanded.render(this.$el.find("#slot-chk-banded-row")),this.chColBanded.render(this.$el.find("#slot-chk-banded-column")),this.btnRefreshPivot.render(this.$el.find("#slot-btn-refresh-pivot")),this.btnSelectPivot.render(this.$el.find("#slot-btn-select-pivot")),this.btnPivotLayout.render(this.$el.find("#slot-btn-pivot-report-layout")),this.btnPivotBlankRows.render(this.$el.find("#slot-btn-pivot-blank-rows")),this.btnPivotSubtotals.render(this.$el.find("#slot-btn-pivot-subtotals")),this.btnPivotGrandTotals.render(this.$el.find("#slot-btn-pivot-grand-totals")),this.pivotStyles.render(this.$el.find("#slot-field-pivot-styles")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return this.btnsAddPivot.concat(this.lockedControls)},SetDisabled:function(t){this.btnsAddPivot.concat(this.lockedControls).forEach((function(e){e&&e.setDisabled(t)}),this)},txtCreate:"Insert Table",tipCreatePivot:"Insert Pivot Table",textRowHeader:"Row Headers",textColHeader:"Column Headers",textRowBanded:"Banded Rows",textColBanded:"Banded Columns",capBlankRows:"Blank Rows",mniInsertBlankLine:"Insert Blank Line after Each Item",mniRemoveBlankLine:"Remove Blank Line after Each Item",capGrandTotals:"Grand Totals",mniOffTotals:"Off for Rows and Columns",mniOnTotals:"On for Rows and Columns",mniOnRowsTotals:"On for Rows Only",mniOnColumnsTotals:"On for Columns Only",capLayout:"Report Layout",capSubtotals:"Subtotals",mniLayoutCompact:"Show in Compact Form",mniLayoutOutline:"Show in Outline Form",mniLayoutTabular:"Show in Tabular Form",mniLayoutRepeat:"Repeat All Item Labels",mniLayoutNoRepeat:"Don't Repeat All Item Labels",mniNoSubtotals:"Don't Show Subtotals",mniBottomSubtotals:"Show all Subtotals at Bottom of Group",mniTopSubtotals:"Show all Subtotals at Top of Group",txtRefresh:"Refresh",tipRefresh:"Update the information from data source",tipGrandTotals:"Show or hide grand totals",tipSubtotals:"Show or hide subtotals",txtSelect:"Select",tipSelect:"Select entire pivot table",txtPivotTable:"Pivot Table"}}(),SSE.Views.PivotTable||{}))})),define("spreadsheeteditor/main/app/view/CreatePivotDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/ComboBox","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.CreatePivotDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:310,height:250},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td style="padding-bottom: 2px;">','<label class="input-label">'+e.textDataRange+"</label>","</td>","</tr>","<tr>",'<td class="padding-large">','<div id="create-pivot-input-source" class="input-row" style=""></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="input-label">'+e.textDestination+"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="create-pivot-radio-new"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="create-pivot-radio-exist"></div>',"</td>","</tr>","<tr>",'<td style="padding-left: 22px;">','<div id="create-pivot-input-dest" class="input-row" style=""></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.api=t.api,this.props=t.props,this.options.handler=function(e,i){if("ok"==e&&!this.isRangeValid())return!0;t.handler&&t.handler.call(this,e,i)},this.dataSourceValid="",this.dataDestValid="",Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.txtSourceRange=new Common.UI.InputFieldBtn({el:$("#create-pivot-input-source"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0}),this.txtSourceRange.on("button:click",_.bind(this.onSelectData,this,"source")),this.txtDestRange=new Common.UI.InputFieldBtn({el:$("#create-pivot-input-dest"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0,validateOnBlur:!1,disabled:!0}),this.txtDestRange.on("button:click",_.bind(this.onSelectData,this,"dest")),this.radioNew=new Common.UI.RadioBox({el:$("#create-pivot-radio-new"),labelText:this.textNew,name:"asc-radio-pivot-dest",checked:!0}).on("change",(function(e,i){t.txtDestRange.setDisabled(i),t.txtDestRange.showError()})),this.radioExist=new Common.UI.RadioBox({el:$("#create-pivot-radio-exist"),labelText:this.textExist,name:"asc-radio-pivot-dest"}).on("change",(function(e,i){t.txtDestRange.setDisabled(!i),t.txtDestRange.cmpEl.find("input").focus()})),this.afterRender()},getFocusedComponents:function(){return[this.txtSourceRange,this.radioNew,this.radioExist,this.txtDestRange]},getDefaultFocusableComponent:function(){if(!this._alreadyRendered)return this._alreadyRendered=!0,this.txtSourceRange},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){if(t){var e=t.asc_getRange();this.txtSourceRange.setValue(e||""),this.dataSourceValid=e;var i=this;this.txtSourceRange.validation=function(t){return i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PivotTableData,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange},this.txtDestRange.validation=function(t){return i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PivotTableReport,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange}}},getSettings:function(){return{source:this.txtSourceRange.getValue(),destination:this.radioExist.getValue()?this.txtDestRange.getValue():null}},isRangeValid:function(){var t=!0,e="";return _.isEmpty(this.txtSourceRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PivotTableData,this.txtSourceRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),t?this.radioExist.getValue()&&(_.isEmpty(this.txtDestRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PivotTableReport,this.txtDestRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),!t)?(this.txtDestRange.showError([e]),this.txtDestRange.cmpEl.find("input").focus(),t):t:(this.txtSourceRange.showError([e]),this.txtSourceRange.cmpEl.find("input").focus(),t)},onSelectData:function(t){var e=this,i="source"==t?e.txtSourceRange:e.txtDestRange;if(e.api){var n=new SSE.Views.CellRangeDialog({handler:function(n,o){if("ok"==o){var s=n.getSettings();"source"==t?e.dataSourceValid=s:e.dataDestValid=s,i.setValue(s),i.checkValidate()}}}).on("close",(function(){e.show(),_.delay((function(){i.focus()}),1)})),o=e.$window.offset();e.hide(),n.show(o.left+160,o.top+125),n.setSettings({api:e.api,range:_.isEmpty(i.getValue())||1!=i.checkValidate()?"source"==t?e.dataSourceValid:e.dataDestValid:i.getValue(),type:"source"==t?Asc.c_oAscSelectionDialogType.PivotTableData:Asc.c_oAscSelectionDialogType.PivotTableReport})}},textTitle:"Create Pivot Table",textDataRange:"Source data range",textSelectData:"Select data",textDestination:"Choose, where to place the table",textNew:"New worksheet",textExist:"Existing worksheet",txtEmpty:"This field is required",textInvalidRange:"Invalid cells range"},SSE.Views.CreatePivotDialog||{}))})),define("spreadsheeteditor/main/app/controller/PivotTable",["core","spreadsheeteditor/main/app/view/PivotTable","spreadsheeteditor/main/app/view/CreatePivotDialog"],(function(){"use strict";SSE.Controllers.PivotTable=Backbone.Controller.extend(_.extend({models:[],views:["PivotTable"],sdkViewName:"#id_main",initialize:function(){this.addListeners({PivotTable:{"pivottable:rowscolumns":_.bind(this.onCheckTemplateChange,this),"pivottable:create":_.bind(this.onCreateClick,this),"pivottable:refresh":_.bind(this.onRefreshClick,this),"pivottable:select":_.bind(this.onSelectClick,this),"pivottable:style":_.bind(this.onPivotStyleSelect,this),"pivottable:layout":_.bind(this.onPivotLayout,this),"pivottable:blankrows":_.bind(this.onPivotBlankRows,this),"pivottable:subtotals":_.bind(this.onPivotSubtotals,this),"pivottable:grandtotals":_.bind(this.onPivotGrandTotals,this),"pivot:open":_.bind(this.onPivotOpen,this)},TableSettings:{"pivottable:create":_.bind(this.onCreateClick,this)}})},onLaunch:function(){this._state={TableName:"",TemplateName:"",RowHeader:void 0,RowBanded:void 0,ColHeader:void 0,ColBanded:void 0,DisabledControls:!1},this._originalProps=null,Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.SetDisabled,this)),Common.NotificationCenter.on("more:toggle",_.bind(this.onMoreToggle,this))},setConfig:function(t){this.view=this.createView("PivotTable",{toolbar:t.toolbar.toolbar})},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.SetDisabled,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.SetDisabled,this)),this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this))),this},setMode:function(t){return this.appConfig=t,this},SetDisabled:function(){this.view&&this.view.SetDisabled(!0)},onCheckTemplateChange:function(t,e){switch(t){case 0:this._originalProps.asc_getStyleInfo().asc_setShowRowHeaders(this.api,this._originalProps,"checked"==e);break;case 1:this._originalProps.asc_getStyleInfo().asc_setShowColHeaders(this.api,this._originalProps,"checked"==e);break;case 2:this._originalProps.asc_getStyleInfo().asc_setShowRowStripes(this.api,this._originalProps,"checked"==e);break;case 3:this._originalProps.asc_getStyleInfo().asc_setShowColStripes(this.api,this._originalProps,"checked"==e)}Common.NotificationCenter.trigger("edit:complete",this)},createSheetName:function(){for(var t=[],e=this.api.asc_getWorksheetsCount();e--;)t.push(this.api.asc_getWorksheetName(e).toLowerCase());for(var i,n=0;++n<1e3&&(i=this.strSheet+n,!(t.indexOf(i.toLowerCase())<0)););return i},onCreateClick:function(t,e){if(this.api){var i=this.api.asc_getAddPivotTableOptions();if(i){var n=this;new SSE.Views.CreatePivotDialog({props:i,api:n.api,handler:function(t,e){"ok"==t&&e&&(n.view&&n.view.fireEvent("insertpivot",n.view),e.destination?n.api.asc_insertPivotExistingWorksheet(e.source,e.destination):n.api.asc_insertPivotNewWorksheet(e.source,n.createSheetName())),Common.NotificationCenter.trigger("edit:complete",n)}}).show()}}Common.NotificationCenter.trigger("edit:complete",this)},onRefreshClick:function(t,e){this.api&&this._originalProps.asc_refresh(this.api),Common.NotificationCenter.trigger("edit:complete",this)},onSelectClick:function(t,e){this.api&&this._originalProps.asc_select(this.api),Common.NotificationCenter.trigger("edit:complete",this)},onPivotStyleSelect:function(t){this.api&&this._originalProps.asc_getStyleInfo().asc_setName(this.api,this._originalProps,t.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},onPivotBlankRows:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;e.asc_setInsertBlankRow("insert"===t),this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},onPivotLayout:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;switch(t){case 0:e.asc_setCompact(!0),e.asc_setOutline(!0);break;case 1:e.asc_setCompact(!1),e.asc_setOutline(!0);break;case 2:e.asc_setCompact(!1),e.asc_setOutline(!1);break;case 3:e.asc_setFillDownLabelsDefault(!0);break;case 4:e.asc_setFillDownLabelsDefault(!1)}this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},onPivotGrandTotals:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;e.asc_setColGrandTotals(1==t||2==t),e.asc_setRowGrandTotals(1==t||3==t),this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},onPivotSubtotals:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;switch(t){case 0:e.asc_setDefaultSubtotal(!1);break;case 1:e.asc_setDefaultSubtotal(!0),e.asc_setSubtotalTop(!1);break;case 2:e.asc_setDefaultSubtotal(!0),e.asc_setSubtotalTop(!0)}this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},ChangeSettings:function(t){if(t){this._originalProps=t;var e=this.view,i=!1,n=t.asc_getStyleInfo(),o=n.asc_getShowRowHeaders();if(this._state.RowHeader!==o&&(e.chRowHeader.setValue(o,!0),this._state.RowHeader=o,i=!0),o=n.asc_getShowColHeaders(),this._state.ColHeader!==o&&(e.chColHeader.setValue(o,!0),this._state.ColHeader=o,i=!0),o=n.asc_getShowColStripes(),this._state.ColBanded!==o&&(e.chColBanded.setValue(o,!0),this._state.ColBanded=o,i=!0),o=n.asc_getShowRowStripes(),this._state.RowBanded!==o&&(e.chRowBanded.setValue(o,!0),this._state.RowBanded=o,i=!0),o=t.asc_getColGrandTotals(),this._state.ColGrandTotals!==o&&(this._state.ColGrandTotals=o,i=!0),o=t.asc_getRowGrandTotals(),this._state.RowGrandTotals!==o&&(this._state.RowGrandTotals=o,i=!0),i&&this.onApiInitPivotStyles(this.api.asc_getTablePictures(this._originalProps,!0)),o=n.asc_getName(),this._state.TemplateName!==o||this._isTemplatesChanged){e.pivotStyles.suspendEvents();var s=e.pivotStyles.menuPicker.store.findWhere({name:o});e.pivotStyles.menuPicker.selectRecord(s),e.pivotStyles.resumeEvents(),this._isTemplatesChanged&&(s?e.pivotStyles.fillComboView(e.pivotStyles.menuPicker.getSelectedRec(),!0):e.pivotStyles.fillComboView(e.pivotStyles.menuPicker.store.at(0),!0)),this._state.TemplateName=o}this._isTemplatesChanged=!1}},onSendThemeColors:function(){this.view.pivotStyles&&this._originalProps&&(this.onApiInitPivotStyles(this.api.asc_getTablePictures(this._originalProps,!0)),this.view.pivotStyles.menuPicker.scroller.update({alwaysVisibleY:!0}))},onApiInitPivotStyles:function(t){var e=this.view.pivotStyles;this._isTemplatesChanged=!0;var i=e.menuPicker.store.length;if(i>0&&i==t.length){var n=e.menuPicker.dataViewItems;n&&_.each(t,(function(t,e){var i=t.asc_getImage();n[e].model.set("imageUrl",i,{silent:!0}),$(n[e].el).find("img").attr("src",i)})),e.fieldPicker.store.reset(e.fieldPicker.store.models)}else{e.menuPicker.store.reset([]);var o=[];_.each(t,(function(t){o.push({id:Common.UI.getId(),name:t.asc_getName(),caption:t.asc_getDisplayName(),type:t.asc_getType(),imageUrl:t.asc_getImage(),allowSelected:!0,selected:!1,tip:t.asc_getDisplayName()})})),e.menuPicker.store.add(o)}},onPivotOpen:function(){var t,e=this.view.pivotStyles;e&&e.needFillComboView&&e.menuPicker.store.length>0&&e.rendered&&(this._state.TemplateName&&(t=e.menuPicker.store.findWhere({name:this._state.TemplateName})),e.fillComboView(t||e.menuPicker.store.at(0),!0))},onSelectionChanged:function(t){if(!this.rangeSelectionMode&&this.appConfig.isEdit&&this.view){var e=t.asc_getPivotTableInfo();Common.Utils.lockControls(Common.enumLock.noPivot,!e,{array:this.view.lockedControls}),Common.Utils.lockControls(Common.enumLock.pivotLock,e&&!0===t.asc_getLockedPivotTable(),{array:this.view.lockedControls}),Common.Utils.lockControls(Common.enumLock.editPivot,!!e,{array:this.view.btnsAddPivot}),e&&this.ChangeSettings(e)}},onCellsRange:function(t){this.rangeSelectionMode=t!=Asc.c_oAscSelectionDialogType.None},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){new Promise((function(t){t()})).then((function(){}))},onMoreToggle:function(t,e,i){if(this.view&&this.view.toolbar&&this.view.toolbar.isTabActive("pivot")&&e){var n,o=this.view.pivotStyles;if(o&&o.needFillComboView&&o.menuPicker.store.length>0&&o.rendered)this._state.TemplateName&&(n=o.menuPicker.store.findWhere({name:this._state.TemplateName})),o.fillComboView(n||o.menuPicker.store.at(0),!0)}},strSheet:"Sheet"},SSE.Controllers.PivotTable||{}))})),void 0===Common)var Common={};if(define("spreadsheeteditor/main/app/view/TableOptionsDialog",["common/main/lib/component/ComboBox","common/main/lib/component/CheckBox","common/main/lib/component/InputField","common/main/lib/component/Window"],(function(){"use strict";SSE.Views.TableOptionsDialog=Common.UI.Window.extend(_.extend({options:{width:355,cls:"modal-dlg",modal:!1,buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.txtFormat},t),this.template=['<div class="box">','<div id="id-dlg-tableoptions-range" class="input-row"  style="margin-bottom: 5px;"></div>','<div class="input-row hidden" id="id-dlg-tableoptions-title" style="margin-top: 5px;"></div>','<label class="" id="id-dlg-tableoptions-lbl" style="margin-top: 5px;">'+this.txtNote+"</label>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.checkRangeType=Asc.c_oAscSelectionDialogType.FormatTable,this.selectionType=Asc.c_oAscSelectionType.RangeCells,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild(),e=this;e.inputRange=new Common.UI.InputField({el:$("#id-dlg-tableoptions-range"),name:"range",style:"width: 100%;",allowBlank:!1,blankError:this.txtEmpty,validateOnChange:!0}),e.cbTitle=new Common.UI.CheckBox({el:$("#id-dlg-tableoptions-title"),labelText:this.txtTitle}),e.lblNote=t.find("#id-dlg-tableoptions-lbl"),t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.on("close",_.bind(this.onClose,this))},onPrimary:function(){return this._handleInput("ok"),!1},setSettings:function(t){var e=this;if(t.api){if(e.api=t.api,t.range)e.checkRangeType=Asc.c_oAscSelectionDialogType.FormatTableChangeRange,e.inputRange.setValue(t.range),e.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.FormatTable,t.range);else{e.cbTitle.$el&&e.cbTitle.$el.removeClass("hidden"),e.lblNote.addClass("hidden"),e.setHeight(152);var i=e.api.asc_getAddFormatTableOptions();e.inputRange.setValue(i.asc_getRange()),e.cbTitle.setValue(i.asc_getIsTitle()),e.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.FormatTable,i.asc_getRange())}t.title&&e.setTitle(t.title),t.selectionType&&(e.selectionType=t.selectionType),e.wrapEvents={onApiRangeChanged:_.bind(e.onApiRangeChanged,e)},e.api.asc_registerCallback("asc_onSelectionRangeChanged",e.wrapEvents.onApiRangeChanged),Common.NotificationCenter.trigger("cells:range",Asc.c_oAscSelectionDialogType.FormatTable)}e.inputRange.validation=function(t){return e.api.asc_checkDataRange(e.checkRangeType,t,!1)!=Asc.c_oAscError.ID.DataRangeError||e.txtInvalidRange}},getSettings:function(){if(this.checkRangeType==Asc.c_oAscSelectionDialogType.FormatTable){var t=this.api.asc_getAddFormatTableOptions(this.inputRange.getValue());return t.asc_setIsTitle(this.cbTitle.checked),{selectionType:this.selectionType,range:t}}return{selectionType:this.selectionType,range:this.inputRange.getValue()}},onApiRangeChanged:function(t){this.inputRange.setValue(t),this.inputRange.cmpEl.hasClass("error")&&this.inputRange.cmpEl.removeClass("error")},isRangeValid:function(){var t=this.api.asc_checkDataRange(this.checkRangeType,this.inputRange.getValue(),!0);if(t==Asc.c_oAscError.ID.No)return!0;switch(t){case Asc.c_oAscError.ID.AutoFilterDataRangeError:Common.UI.warning({msg:this.errorAutoFilterDataRange});break;case Asc.c_oAscError.ID.FTChangeTableRangeError:Common.UI.warning({msg:this.errorFTChangeTableRangeError});break;case Asc.c_oAscError.ID.FTRangeIncludedOtherTables:Common.UI.warning({msg:this.errorFTRangeIncludedOtherTables});break;case Asc.c_oAscError.ID.MultiCellsInTablesFormulaArray:Common.UI.warning({msg:this.errorMultiCellFormula});break;case Asc.c_oAscError.ID.LargeRangeWarning:return this.selectionType=Asc.c_oAscSelectionType.RangeMax,!0}return!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onClose:function(t){this.api&&(this.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None),this.api.asc_unregisterCallback("asc_onSelectionRangeChanged",this.wrapEvents.onApiRangeChanged)),Common.NotificationCenter.trigger("cells:range",Asc.c_oAscSelectionDialogType.None),Common.NotificationCenter.trigger("edit:complete",this),SSE.getController("RightMenu").SetDisabled(!1)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.isRangeValid())return;this.options.handler.call(this,this,t)}this.close()},show:function(){Common.UI.Window.prototype.show.call(this),SSE.getController("RightMenu").SetDisabled(!0)},txtTitle:"Title",txtFormat:"Create Table",txtEmpty:"This field is required",txtInvalidRange:"ERROR! Invalid cells range",errorAutoFilterDataRange:"The operation could not be done for the selected range of cells.<br>Select a uniform data range inside or outside the table and try again.",errorFTChangeTableRangeError:"Operation could not be completed for the selected cell range.<br>Select a range so that the first table row was on the same row<br>and the resulting table overlapped the current one.",errorFTRangeIncludedOtherTables:"Operation could not be completed for the selected cell range.<br>Select a range which does not include other tables.",errorMultiCellFormula:"Multi-cell array formulas are not allowed in tables.",txtNote:"The headers must remain in the same row, and the resulting table range must overlap the original table range."},SSE.Views.TableOptionsDialog||{}))})),define("spreadsheeteditor/main/app/view/NamedRangeEditDlg",["common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/InputField"],(function(){"use strict";SSE.Views=SSE.Views||{},SSE.Views.NamedRangeEditDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"NamedRangeEditDlg",contentWidth:380,height:250},initialize:function(t){var e=this;_.extend(this.options,{title:this.txtTitleNew,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-small">','<label class="header">',e.textName,"</label>",'<div id="named-range-txt-name" class="input-row" style="width:100%;"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="header">',e.textScope,"</label>",'<div id="named-range-combo-scope" class="input-group-nr" style="width:100%;"></div>',"</td>","</tr>","<tr>","<td>",'<label class="header">',e.textDataRange,"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="named-range-txt-range" class="input-row"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>",'<div class="separator horizontal"></div>'].join("")},t),this.api=t.api,this.handler=t.handler,this.isEdit=t.isEdit||!1,this.sheets=t.sheets||[],this.props=t.props,this.dataRangeValid="",this.wrapEvents={onRefreshDefNameList:_.bind(this.onRefreshDefNameList,this),onLockDefNameManager:_.bind(this.onLockDefNameManager,this)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.inputName=new Common.UI.InputField({el:$("#named-range-txt-name"),allowBlank:!1,placeHolder:this.namePlaceholder,blankError:this.txtEmpty,validateOnChange:!1,validateOnBlur:!1,style:"width: 100%;",validation:function(e){var i=t.api.asc_checkDefinedName(e,-255==t.cmbScope.getValue()?null:t.cmbScope.getValue());if(!0===i.asc_getStatus())return!0;switch(i.asc_getReason()){case Asc.c_oAscDefinedNameReason.IsLocked:return t.textIsLocked;case Asc.c_oAscDefinedNameReason.Existed:return!(!t.isEdit||t.props.asc_getName(!0).toLowerCase()!=e.toLowerCase())||t.textExistName;case Asc.c_oAscDefinedNameReason.NameReserved:return!t.isEdit||t.textReservedName;default:return t.textInvalidName}}}),this.inputName._input.on("input",(function(e,i){t.isInputFirstChange&&t.inputName.showError(),t.isInputFirstChange=!1})),this.cmbScope=new Common.UI.ComboBox({el:$("#named-range-combo-scope"),style:"width: 100%;",menuStyle:"min-width: 100%;max-height: 280px;",editable:!1,cls:"input-group-nr",data:[],takeFocusOnClose:!0}),this.txtDataRange=new Common.UI.InputFieldBtn({el:$("#named-range-txt-range"),name:"range",style:"width: 100%;",allowBlank:!0,btnHint:this.textSelectData,blankError:this.txtEmpty,validateOnChange:!0,validation:function(e){return!!_.isEmpty(e)||(!!(t.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,e,!1)!==Asc.c_oAscError.ID.DataRangeError||t.isEdit&&t.props.asc_getRef().toLowerCase()==e.toLowerCase())||t.textInvalidRange)}}),this.txtDataRange.on("button:click",_.bind(this.onSelectData,this)),this.afterRender()},getFocusedComponents:function(){return[this.inputName,this.cmbScope,this.txtDataRange]},getDefaultFocusableComponent:function(){if(!this._alreadyRendered)return this._alreadyRendered=!0,this.inputName},afterRender:function(){this._setDefaults(this.props),this.setTitle(this.isEdit?this.txtTitleEdit:this.txtTitleNew),this.api.asc_registerCallback("asc_onLockDefNameManager",this.wrapEvents.onLockDefNameManager),this.api.asc_registerCallback("asc_onRefreshDefNameList",this.wrapEvents.onRefreshDefNameList)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){if(this.cmbScope.setData([{value:-255,displayValue:this.strWorkbook}].concat(this.sheets)),t){var e=t.asc_getScope();this.cmbScope.setValue(null===e?-255:e),e=t.asc_getName(!0),_.isEmpty(e)||this.inputName.setValue(e),e=t.asc_getRef(),this.txtDataRange.setValue(e||""),this.dataRangeValid=e,this.txtDataRange.setDisabled(this.isEdit&&(t.asc_getType()===Asc.c_oAscDefNameType.table||t.asc_getType()===Asc.c_oAscDefNameType.slicer))}else this.cmbScope.setValue(-255);this.cmbScope.setDisabled(this.isEdit)},onSelectData:function(){var t=this;if(t.api){var e=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.dataRangeValid=e.getSettings(),t.txtDataRange.setValue(t.dataRangeValid),t.txtDataRange.checkValidate())}}).on("close",(function(){t.show(),_.delay((function(){t.txtDataRange.focus()}),1)})),i=t.$window.offset();t.hide(),e.show(i.left+65,i.top+77),e.setSettings({api:t.api,range:_.isEmpty(t.txtDataRange.getValue())||1!=t.txtDataRange.checkValidate()?t.dataRangeValid:t.txtDataRange.getValue(),type:Asc.c_oAscSelectionDialogType.Chart})}},getSettings:function(){return new Asc.asc_CDefName(this.inputName.getValue(),this.txtDataRange.getValue(),-255==this.cmbScope.getValue()?null:this.cmbScope.getValue(),this.props.asc_getType(),void 0,void 0,void 0,!0)},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},onDlgBtnClick:function(t){var e=this,i="object"==typeof t?t.currentTarget.attributes.result.value:t;if("ok"==i){if(this.locked)return void Common.UI.alert({msg:this.errorCreateDefName,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:function(t){e.close()}});var n=this.inputName.checkValidate(),o=this.txtDataRange.checkValidate();if(!0!==n)return this.inputName.focus(),void(this.isInputFirstChange=!0);if(!0!==o)return void this.txtDataRange.focus();this.handler&&this.handler.call(this,i,"ok"==i?this.getSettings():void 0)}this.close()},onLockDefNameManager:function(t){this.locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager},onRefreshDefNameList:function(t){var e=this;this.isEdit&&Common.Utils.InternalSettings.get("sse-settings-coauthmode")&&t&&t.asc_getIsLock()&&t.asc_getName(!0).toLowerCase()==this.props.asc_getName(!0).toLowerCase()&&(null===t.asc_getScope()&&null===this.props.asc_getScope()||t.asc_getScope().toLowerCase()==this.props.asc_getScope().toLowerCase())&&!this._listRefreshed&&(this._listRefreshed=!0,Common.UI.alert({closable:!1,msg:this.errorCreateDefName,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:function(t){e.close()}}))},close:function(){this.api.asc_unregisterCallback("asc_onLockDefNameManager",this.wrapEvents.onLockDefNameManager),this.api.asc_unregisterCallback("asc_onRefreshDefNameList",this.wrapEvents.onRefreshDefNameList),Common.UI.Window.prototype.close.call(this)},txtTitleNew:"New Name",txtTitleEdit:"Edit Name",textSelectData:"Select Data",textName:"Name",textScope:"Scope",textDataRange:"Data Range",namePlaceholder:"Defined name",strWorkbook:"Workbook",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",textInvalidName:"ERROR! Invalid range name",textExistName:"ERROR! Range with such a name already exists",textIsLocked:"This element is being edited by another user.",errorCreateDefName:"The existing named ranges cannot be edited and the new ones cannot be created<br>at the moment as some of them are being edited.",notcriticalErrorTitle:"Warning",textReservedName:"The name you are trying to use is already referenced in cell formulas. Please use some other name."},SSE.Views.NamedRangeEditDlg||{}))})),define("spreadsheeteditor/main/app/view/NamedRangePasteDlg",["common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ListView"],(function(){"use strict";SSE.Views=SSE.Views||{},SSE.Views.NamedRangePasteDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"NamedRangePasteDlg",contentWidth:250,height:282},initialize:function(t){_.extend(this.options,{title:this.txtTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-small">','<label class="input-label">',this.textNames,"</label>",'<div id="named-range-paste-list" class="range-tableview" style="width:100%; height: 169px;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.handler=t.handler,this.ranges=t.ranges||[],Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.rangeList=new Common.UI.ListView({el:$("#named-range-paste-list",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,cls:"dbl-clickable",itemTemplate:_.template(['<div style="pointer-events:none;">','<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;">','<div class="listitem-icon toolbar__icon <% print(isTable?"btn-menu-table":(isSlicer ? "btn-slicer" : "btn-named-range")) %>"></div>','<div style="width:186px;padding-right: 5px;"><%= Common.Utils.String.htmlEncode(name) %></div>',"</div>","</div>"].join(""))}),this.rangeList.store.comparator=function(t,e){var i=t.get("name").toLowerCase(),n=e.get("name").toLowerCase();return i==n?0:i<n?-1:1},this.rangeList.on("item:dblclick",_.bind(this.onDblClickFunction,this)),this.rangeList.on("entervalue",_.bind(this.onPrimary,this)),this.afterRender()},afterRender:function(){this._setDefaults()},_setDefaults:function(){if(this.ranges){for(var t=this,e=[],i="",n=0;n<this.ranges.length;n++){var o=this.ranges[n].asc_getName(!0);if(o!==i){var s=this.ranges[n].asc_getType();e.push({name:o,scope:this.ranges[n].asc_getScope(),range:this.ranges[n].asc_getRef(),type:s,isTable:s===Asc.c_oAscDefNameType.table,isSlicer:s===Asc.c_oAscDefNameType.slicer})}i=o}this.rangeList.store.reset(e),this.rangeList.store.sort(),this.rangeList.store.length>0&&this.rangeList.selectByIndex(0),this.rangeList.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t.rangeList.focus()}),100,this)}},getSettings:function(){var t=this.rangeList.getSelectedRec();return t?new Asc.asc_CDefName(t.get("name"),t.get("range"),t.get("scope"),t.get("type"),void 0,void 0,void 0,!0):null},onPrimary:function(){return this.handler&&this.handler.call(this,"ok",this.getSettings()),this.close(),!1},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onDblClickFunction:function(){this.handler&&this.handler.call(this,"ok",this.getSettings()),this.close()},txtTitle:"Paste Name",textNames:"Named Ranges"},SSE.Views.NamedRangePasteDlg||{}))})),define("spreadsheeteditor/main/app/view/FormatSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboBox","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.FormatSettingsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:284,height:340},initialize:function(t){var e=this;e.numFormatData=[{value:Asc.c_oAscNumFormatType.General,displayValue:this.txtGeneral},{value:Asc.c_oAscNumFormatType.Number,displayValue:this.txtNumber},{value:Asc.c_oAscNumFormatType.Scientific,displayValue:this.txtScientific},{value:Asc.c_oAscNumFormatType.Accounting,displayValue:this.txtAccounting},{value:Asc.c_oAscNumFormatType.Currency,displayValue:this.txtCurrency},{value:Asc.c_oAscNumFormatType.Date,displayValue:this.txtDate},{value:Asc.c_oAscNumFormatType.Time,displayValue:this.txtTime},{value:Asc.c_oAscNumFormatType.Percent,displayValue:this.txtPercentage},{value:Asc.c_oAscNumFormatType.Fraction,displayValue:this.txtFraction},{value:Asc.c_oAscNumFormatType.Text,displayValue:this.txtText},{value:Asc.c_oAscNumFormatType.Custom,displayValue:this.txtCustom}],e.FractionData=[{displayValue:this.txtUpto1,value:"# ?/?"},{displayValue:this.txtUpto2,value:"# ??/??"},{displayValue:this.txtUpto3,value:"# ???/???"},{displayValue:this.txtAs2,value:"# ?/2"},{displayValue:this.txtAs4,value:"# ?/4"},{displayValue:this.txtAs8,value:"# ?/8"},{displayValue:this.txtAs16,value:"# ??/16"},{displayValue:this.txtAs10,value:"# ?/10"},{displayValue:this.txtAs100,value:"# ??/100"}],e.CurrencySymbolsData=null,e.langId=1033,this.api=t.api,this.handler=t.handler,this.props=t.props,this.linked=t.linked||!1;var i=this.linked?360:340;_.extend(this.options,{title:this.textTitle,height:i,template:['<div class="box" style="height:'+(i-85)+'px;">','<div class="content-panel" style="padding: 0 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td style="width:170px;padding-bottom: 3px;">','<label class="header">',e.textCategory,"</label>",'<div id="format-settings-combo-format" class="input-group-nr" style="width:264px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large" style="white-space: nowrap;">','<label class="format-sample" style="vertical-align: middle; margin-right: 4px;">'+e.txtSample+"</label>",'<label class="format-sample" id="format-settings-label-example" style="vertical-align: middle; max-width: 220px; overflow: hidden; text-overflow: ellipsis;">100</label>',"</td>","</tr>",'<tr class="format-no-code">','<td class="padding-small">',"</td>","</tr>",'<tr class="format-decimal">','<td class="padding-large" style="vertical-align: bottom;">','<label class="header">',e.textDecimal,"</label>",'<div id="format-settings-spin-decimal"></div>',"</td>","</tr>",'<tr class="format-separator">','<td class="padding-large">','<div id="format-settings-checkbox-separator"></div>',"</td>","</tr>",'<tr class="format-symbols">','<td class="padding-large">','<label class="header">',e.textSymbols,"</label>",'<div id="format-settings-combo-symbols" class="input-group-nr" style="width:264px;"></div>',"</td>","</tr>",'<tr class="format-decimal">','<td class="padding-large format-negative">','<label class="header">',e.textFormat,"</label>",'<div id="format-settings-combo-negative" class="input-group-nr" style="width:264px;"></div>',"</td>","</tr>",'<tr class="format-type">','<td class="padding-large">','<label class="header">',e.textFormat,"</label>",'<div id="format-settings-combo-type" class="input-group-nr" style="width:264px;"></div>',"</td>","</tr>",'<tr class="format-code">','<td colspan="1" class="padding-large">','<label class="header">',e.textFormat,"</label>",'<div id="format-settings-txt-code" class="input-group-nr" style="height:22px;width:264px;margin-bottom: 8px;"></div>','<div id="format-settings-list-code" style="width:264px; height: 116px;"></div>',"</td>","</tr>","<tr>",'<td colspan="1">','<div id="format-settings-chk-linked"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>",'<div class="separator horizontal"></div>'].join("")},t),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._state={hasDecimal:!1,hasNegative:!1,hasSeparator:!1,hasType:!1,hasSymbols:!1,hasCode:!1},this.FormatType=Asc.c_oAscNumFormatType.General,this.Format="General",this.CustomFormat=null},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.cmbFormat=new Common.UI.ComboBox({el:$("#format-settings-combo-format"),cls:"input-group-nr",menuStyle:"min-width: 264px;",editable:!1,data:this.numFormatData,takeFocusOnClose:!0}),this.cmbFormat.setValue(this.FormatType),this.cmbFormat.on("selected",_.bind(this.onFormatSelect,this)),this.cmbNegative=new Common.UI.ComboBox({el:$("#format-settings-combo-negative"),cls:"input-group-nr",menuStyle:"min-width: 264px;max-height:235px;",editable:!1,data:[],scrollAlwaysVisible:!0,takeFocusOnClose:!0}),this.cmbNegative.on("selected",_.bind(this.onNegativeSelect,this)),this.spnDecimal=new Common.UI.MetricSpinner({el:$("#format-settings-spin-decimal"),step:1,width:45,defaultUnit:"",value:2,maxValue:30,minValue:0,allowDecimal:!1}),this.spnDecimal.on("change",_.bind(this.onDecimalChange,this)),this.chSeparator=new Common.UI.CheckBox({el:$("#format-settings-checkbox-separator"),labelText:this.textSeparator}),this.chSeparator.on("change",_.bind(this.onSeparatorChange,this)),this.cmbSymbols=new Common.UI.ComboBox({el:$("#format-settings-combo-symbols"),cls:"input-group-nr",menuStyle:"min-width: 264px;max-height:235px;",editable:!1,data:[],scrollAlwaysVisible:!0,takeFocusOnClose:!0,search:!0}),this.cmbSymbols.on("selected",_.bind(this.onSymbolsSelect,this)),this.cmbType=new Common.UI.ComboBox({el:$("#format-settings-combo-type"),cls:"input-group-nr",menuStyle:"min-width: 264px;max-height:235px;",editable:!1,data:[],scrollAlwaysVisible:!0,takeFocusOnClose:!0}),this.cmbType.on("selected",_.bind(this.onTypeSelect,this)),this.codesList=new Common.UI.ListView({el:$("#format-settings-list-code"),store:new Common.UI.DataViewStore,tabindex:1,itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="pointer-events:none;overflow: hidden; text-overflow: ellipsis;"><%= value %></div>')}),this.codesList.on("item:select",_.bind(this.onCodeSelect,this)),this.codesList.on("entervalue",_.bind(this.onPrimary,this)),this.inputCustomFormat=new Common.UI.InputField({el:$("#format-settings-txt-code"),allowBlank:!0,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(e,i){t.codesList.deselectAll(),t.Format=t.api.asc_convertNumFormatLocal2NumFormat(i),t.lblExample.text(t.api.asc_getLocaleExample(t.Format)),t.chLinked.setValue(!1,!0),t._state.warning||(e.showWarning([t.txtCustomWarning]),t._state.warning=!0)})),this.chLinked=new Common.UI.CheckBox({el:$("#format-settings-chk-linked"),labelText:this.textLinked}).on("change",(function(e,i,n,o){t.props.linked="checked"==e.getValue(),t.props.linked&&(t.props.chartFormat.putSourceLinked(!0),t.props.format=t.props.chartFormat.getFormatCode(),t.props.formatInfo=t.props.chartFormat.getFormatCellsInfo(),t._setDefaults(t.props))})),this.chLinked.setVisible(this.linked),this._decimalPanel=this.$window.find(".format-decimal"),this._negativePanel=this.$window.find(".format-negative"),this._separatorPanel=this.$window.find(".format-separator"),this._typePanel=this.$window.find(".format-type"),this._symbolsPanel=this.$window.find(".format-symbols"),this._codePanel=this.$window.find(".format-code"),this._nocodePanel=this.$window.find(".format-no-code"),this.$window.find(".format-sample").toggleClass("hidden",this.linked),this.lblExample=this.$window.find("#format-settings-label-example"),this.afterRender()},getFocusedComponents:function(){return[this.cmbFormat,this.spnDecimal,this.chSeparator,this.cmbSymbols,this.cmbNegative,this.cmbType,this.inputCustomFormat,this.codesList,this.chLinked]},getDefaultFocusableComponent:function(){return this.cmbFormat},afterRender:function(){this._setDefaults(this.props)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){if(t&&t.formatInfo&&(this.langId&&(this.langId=t.langId),this.cmbFormat.setValue(t.formatInfo.asc_getType(),this.txtCustom),t.formatInfo.asc_getType()==Asc.c_oAscNumFormatType.Custom&&t.format&&(this.CustomFormat=this.Format=t.format),this.onFormatSelect(this.cmbFormat,this.cmbFormat.getSelectedRecord(),null,t.formatInfo),this._state.hasDecimal&&this.spnDecimal.setValue(t.formatInfo.asc_getDecimalPlaces()),this._state.hasSeparator&&this.chSeparator.setValue(t.formatInfo.asc_getSeparator()),this._state.hasSymbols&&this.cmbSymbols.setValue(t.formatInfo.asc_getSymbol()||t.formatInfo.asc_getCurrencySymbol()),t.format)){if(this._state.hasNegative)(e=this.cmbNegative.store.findWhere({value:t.format}))?this.cmbNegative.selectRecord(e):this.cmbNegative.setValue(this.api.asc_getLocaleExample(t.format));else if(this._state.hasType){var e;(e=this.cmbType.store.findWhere({value:t.format}))?this.cmbType.selectRecord(e):t.formatInfo.asc_getType()==Asc.c_oAscNumFormatType.Fraction?this.cmbType.setValue(this.txtCustom):t.formatInfo.asc_getType()==Asc.c_oAscNumFormatType.Time?this.cmbType.setValue(this.api.asc_getLocaleExample(t.format,1.534)):this.cmbType.setValue(this.api.asc_getLocaleExample(t.format,38822))}this.Format=t.format,this.lblExample.text(this.api.asc_getLocaleExample(this.Format))}t&&t.chartFormat&&this.chLinked.setValue(!!t.chartFormat.getSourceLinked(),!0)},getSettings:function(){return{format:this.Format,linked:"checked"===this.chLinked.getValue()}},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;"ok"==e&&this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},onNegativeSelect:function(t,e){this.Format=e.value,this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this.chLinked.setValue(!1,!0)},onSymbolsSelect:function(t,e){var i=this,n=new Asc.asc_CFormatCellsInfo;n.asc_setType(this.FormatType),n.asc_setDecimalPlaces(this.spnDecimal.getNumberValue()),n.asc_setSeparator(!1),"string"==typeof e.value?n.asc_setCurrencySymbol(e.value):n.asc_setSymbol(e.value);var o=this.api.asc_getFormatCells(n),s=[];o.forEach((function(t){s.push({value:t,displayValue:i.api.asc_getLocaleExample(t,-1234.1234567890124)})})),this.cmbNegative.setData(s),this.cmbNegative.selectRecord(this.cmbNegative.store.at(0)),this.cmbNegative.cmpEl.find("li:nth-child(2) a, li:nth-child(4) a").css({color:"#ff0000"}),this.Format=o[0],this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this.chLinked.setValue(!1,!0)},onDecimalChange:function(t,e,i,n){var o=this,s=new Asc.asc_CFormatCellsInfo;if(s.asc_setType(this.FormatType),s.asc_setDecimalPlaces(t.getNumberValue()),s.asc_setSeparator(this.FormatType==Asc.c_oAscNumFormatType.Number&&"checked"==this.chSeparator.getValue()),this.FormatType==Asc.c_oAscNumFormatType.Currency||this.FormatType==Asc.c_oAscNumFormatType.Accounting){var a=this.cmbSymbols.getValue();"string"==typeof a?s.asc_setCurrencySymbol(a):s.asc_setSymbol(a)}else s.asc_setSymbol(!1);var l=this.api.asc_getFormatCells(s);if(this.FormatType==Asc.c_oAscNumFormatType.Number||this.FormatType==Asc.c_oAscNumFormatType.Currency||this.FormatType==Asc.c_oAscNumFormatType.Accounting){var r=[];l.forEach((function(t){r.push({value:t,displayValue:o.api.asc_getLocaleExample(t,-1234.1234567890124)})})),this.cmbNegative.setData(r),this.cmbNegative.selectRecord(this.cmbNegative.store.at(0)),this.cmbNegative.cmpEl.find("li:nth-child(2) a, li:nth-child(4) a").css({color:"#ff0000"}),this.Format=l[0]}else this.Format=l[0];this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this.chLinked.setValue(!1,!0)},onSeparatorChange:function(t,e,i,n){var o=this,s=new Asc.asc_CFormatCellsInfo;s.asc_setType(this.FormatType),s.asc_setDecimalPlaces(this.spnDecimal.getNumberValue()),s.asc_setSeparator("checked"==t.getValue());var a=this.api.asc_getFormatCells(s),l=[];a.forEach((function(t){l.push({value:t,displayValue:o.api.asc_getLocaleExample(t,-1234.1234567890124)})})),this.cmbNegative.setData(l),this.cmbNegative.selectRecord(this.cmbNegative.store.at(0)),this.cmbNegative.cmpEl.find("li:nth-child(2) a, li:nth-child(4) a").css({color:"#ff0000"}),this.Format=a[0],this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this.chLinked.setValue(!1,!0)},onTypeSelect:function(t,e){this.Format=e.value,this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this.chLinked.setValue(!1,!0)},onCodeSelect:function(t,e,i){i&&(this.Format=i.get("format"),this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this.inputCustomFormat.setValue(i.get("value")),this.chLinked.setValue(!1,!0),this.inputCustomFormat.showWarning(),this._state.warning=!1)},onFormatSelect:function(t,e,i,n){if(e){this.FormatType=e.value;var o=e.value==Asc.c_oAscNumFormatType.Number||e.value==Asc.c_oAscNumFormatType.Scientific||e.value==Asc.c_oAscNumFormatType.Accounting||e.value==Asc.c_oAscNumFormatType.Currency||e.value==Asc.c_oAscNumFormatType.Percent,s=e.value==Asc.c_oAscNumFormatType.Number||e.value==Asc.c_oAscNumFormatType.Currency||e.value==Asc.c_oAscNumFormatType.Accounting,a=e.value==Asc.c_oAscNumFormatType.Number,l=e.value==Asc.c_oAscNumFormatType.Date||e.value==Asc.c_oAscNumFormatType.Time||e.value==Asc.c_oAscNumFormatType.Fraction,r=e.value==Asc.c_oAscNumFormatType.Accounting||e.value==Asc.c_oAscNumFormatType.Currency,c=e.value==Asc.c_oAscNumFormatType.Custom,d=this,h=n?n.asc_getDecimalPlaces():this.spnDecimal.getNumberValue(),p=n?n.asc_getSeparator():"checked"==this.chSeparator.getValue(),m=n?n.asc_getSymbol()||n.asc_getCurrencySymbol():this.langId;if(e.value!==Asc.c_oAscNumFormatType.Custom){if((v=new Asc.asc_CFormatCellsInfo).asc_setType(e.value),v.asc_setDecimalPlaces(o?h:0),v.asc_setSeparator(!!a&&p),s||e.value==Asc.c_oAscNumFormatType.Date||e.value==Asc.c_oAscNumFormatType.Time){if(r){if(!d.CurrencySymbolsData){d.CurrencySymbolsData=[];var u=this.api.asc_getCurrencySymbols();for(var g in u)u.hasOwnProperty(g)&&d.CurrencySymbolsData.push({value:parseInt(g),displayValue:u[g]+" "+Common.util.LanguageInfo.getLocalLanguageName(g)[1]});d.CurrencySymbolsData.sort((function(t,e){return t.displayValue<e.displayValue?-1:t.displayValue>e.displayValue?1:0})),d.CurrencySymbolsData.unshift({value:null,displayValue:d.txtNone}),(u=this.api.asc_getAdditionalCurrencySymbols()).forEach((function(t){d.CurrencySymbolsData.push({value:t,displayValue:t})})),this.cmbSymbols.setData(this.CurrencySymbolsData),this.cmbSymbols.setValue(m)}v.asc_setSymbol(this.cmbSymbols.getValue())}var f=this.api.asc_getFormatCells(v),b=[],C=e.value==Asc.c_oAscNumFormatType.Date?38822:e.value==Asc.c_oAscNumFormatType.Time?1.534:parseFloat("-1234.12345678901234567890");f.forEach((function(t){b.push({value:t,displayValue:d.api.asc_getLocaleExample(t,C)})})),s?(this.cmbNegative.setData(b),this.cmbNegative.selectRecord(this.cmbNegative.store.at(0)),this.cmbNegative.cmpEl.find("li:nth-child(2) a, li:nth-child(4) a").css({color:"#ff0000"})):(this.cmbType.setData(b),this.cmbType.selectRecord(this.cmbType.store.at(0))),this.Format=f[0]}else e.value==Asc.c_oAscNumFormatType.Fraction?(this.cmbType.setData(this.FractionData),this.cmbType.selectRecord(this.cmbType.store.at(0)),this.Format=this.cmbType.getValue()):this.Format=this.api.asc_getFormatCells(v)[0]}else{var v;(v=new Asc.asc_CFormatCellsInfo).asc_setType(Asc.c_oAscNumFormatType.Custom),v.asc_setSymbol(m);f=this.api.asc_getFormatCells(v),b=[];var _,x=!!this.CustomFormat;if(f.forEach((function(t){var e=new Common.UI.DataViewModel;e.set({value:d.api.asc_convertNumFormat2NumFormatLocal(t),format:t}),b.push(e),d.CustomFormat==t&&(x=!1)})),x)(_=new Common.UI.DataViewModel).set({value:d.api.asc_convertNumFormat2NumFormatLocal(this.CustomFormat),format:this.CustomFormat}),b.push(_);this.codesList.store.reset(b,{silent:!1}),(_=this.codesList.store.findWhere({value:this.Format}))&&this.codesList.selectRecord(_),_&&this.codesList.scrollToRecord(_),this.inputCustomFormat.setValue(d.api.asc_convertNumFormat2NumFormatLocal(this.Format))}this.lblExample.text(this.api.asc_getLocaleExample(this.Format)),this._decimalPanel.toggleClass("hidden",!o),this._negativePanel.toggleClass("hidden",!s),this._separatorPanel.toggleClass("hidden",!a),this._typePanel.toggleClass("hidden",!l),this._symbolsPanel.toggleClass("hidden",!r),this._codePanel.toggleClass("hidden",!c),this._nocodePanel.toggleClass("hidden",c),this._state={hasDecimal:o,hasNegative:s,hasSeparator:a,hasType:l,hasSymbols:r,hasCode:c},!n&&this.chLinked.setValue(!1,!0)}},textTitle:"Number Format",textCategory:"Category",textDecimal:"Decimal",textSeparator:"Use 1000 separator",textFormat:"Format",textSymbols:"Symbols",txtGeneral:"General",txtNumber:"Number",txtCustom:"Custom",txtCurrency:"Currency",txtAccounting:"Accounting",txtDate:"Date",txtTime:"Time",txtPercentage:"Percentage",txtFraction:"Fraction",txtScientific:"Scientific",txtText:"Text",txtUpto1:"Up to one digit (1/3)",txtUpto2:"Up to two digits (12/25)",txtUpto3:"Up to three digits (131/135)",txtAs2:"As halfs (1/2)",txtAs8:"As eighths (4/8)",txtAs4:"As fourths (2/4)",txtAs16:"As sixteenths (8/16)",txtAs10:"As tenths (5/10)",txtAs100:"As hundredths (50/100)",txtSample:"Sample:",txtNone:"None",textLinked:"Linked to source",txtCustomWarning:"Please enter the custom number format carefully. Spreadsheet Editor does not check custom formats for errors that may affect the xlsx file."},SSE.Views.FormatSettingsDialog||{}))})),define("spreadsheeteditor/main/app/view/PageMarginsDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner"],(function(){"use strict";SSE.Views.PageMarginsDialog=Common.UI.Window.extend(_.extend({options:{width:215,header:!0,style:"min-width: 216px;",cls:"modal-dlg",id:"window-page-margins",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 85px;">','<table cols="2" style="width: 100%;margin-bottom: 10px;">',"<tr>",'<td style="padding-right: 10px;padding-bottom: 8px;">','<label class="input-label">'+this.textTop+"</label>",'<div id="page-margins-spin-top"></div>',"</td>",'<td style="padding-bottom: 8px;">','<label class="input-label">'+this.textBottom+"</label>",'<div id="page-margins-spin-bottom"></div>',"</td>","</tr>","<tr>",'<td class="padding-small" style="padding-right: 10px;">','<label class="input-label">'+this.textLeft+"</label>",'<div id="page-margins-spin-left"></div>',"</td>",'<td class="padding-small">','<label class="input-label">'+this.textRight+"</label>",'<div id="page-margins-spin-right"></div>',"</td>","</tr>","</table>","</div>",'<div class="separator horizontal"></div>'].join(""),this.options.tpl=_.template(this.template)(this.options),this.spinners=[],this._noApply=!1,this.maxMarginsW=this.maxMarginsH=0,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.spnTop=new Common.UI.MetricSpinner({el:$("#page-margins-spin-top"),step:.1,width:86,defaultUnit:"cm",value:"0",maxValue:48.25,minValue:0}),this.spinners.push(this.spnTop),this.spnBottom=new Common.UI.MetricSpinner({el:$("#page-margins-spin-bottom"),step:.1,width:86,defaultUnit:"cm",value:"0",maxValue:48.25,minValue:0}),this.spinners.push(this.spnBottom),this.spnLeft=new Common.UI.MetricSpinner({el:$("#page-margins-spin-left"),step:.1,width:86,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnLeft),this.spnRight=new Common.UI.MetricSpinner({el:$("#page-margins-spin-right"),step:.1,width:86,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnRight);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),t.find("input").on("keypress",_.bind(this.onKeyPress,this)),this.updateMetricUnit()},getFocusedComponents:function(){return this.spinners},getDefaultFocusableComponent:function(){return this.spnTop},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onKeyPress:function(t){t.keyCode==Common.UI.Keys.RETURN&&this._handleInput("ok")},setSettings:function(t){if(t){var e=t.asc_getPageMargins();this.spnTop.setValue(Common.Utils.Metric.fnRecalcFromMM(e.asc_getTop()),!0),this.spnBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(e.asc_getBottom()),!0),this.spnLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(e.asc_getLeft()),!0),this.spnRight.setValue(Common.Utils.Metric.fnRecalcFromMM(e.asc_getRight()),!0)}},getSettings:function(){var t=new Asc.asc_CPageMargins;return t.asc_setTop(Common.Utils.Metric.fnRecalcToMM(this.spnTop.getNumberValue())),t.asc_setBottom(Common.Utils.Metric.fnRecalcToMM(this.spnBottom.getNumberValue())),t.asc_setLeft(Common.Utils.Metric.fnRecalcToMM(this.spnLeft.getNumberValue())),t.asc_setRight(Common.Utils.Metric.fnRecalcToMM(this.spnRight.getNumberValue())),t},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){this.spinners[t].setDefaultUnit(Common.Utils.Metric.getCurrentMetricName())}},textTitle:"Margins",textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right"},SSE.Views.PageMarginsDialog||{}))})),define("spreadsheeteditor/main/app/view/HeaderFooterDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts"],(function(){"use strict";SSE.Views.HeaderFooterDialog=Common.UI.Window.extend(_.extend({options:{width:650,style:"min-width: 350px;",cls:"modal-dlg enable-key-events",animate:{mask:!1},buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.api=this.options.api,this.props=this.options.props,this.fontStore=this.options.fontStore,this.pageSetup=this.options.pageSetup,this.isFooter=!1,this.currentCanvas=null,this.headerControls=[],this.footerControls=[],this._state={clrtext:void 0,bold:void 0,italic:void 0,underline:void 0,strikeout:void 0,subscript:void 0,superscript:void 0,fontsize:void 0,fontname:""},this.template=['<div class="box" style="height: 400px;">','<table cols="2" style="width: 450px;margin-bottom: 30px;">',"<tr>",'<td style="padding-bottom: 8px;">','<div id="id-dlg-hf-ch-first"></div>',"</td>",'<td style="padding-bottom: 8px;">','<div id="id-dlg-hf-ch-scale"></div>',"</td>","</tr>","<tr>","<td>",'<div id="id-dlg-hf-ch-odd"></div>',"</td>","<td>",'<div id="id-dlg-hf-ch-align"></div>',"</td>","</tr>","</table>",'<div class="input-row input-row--tabs" style="margin-bottom: 15px;">','<button type="button" class="btn btn-text-default auto" id="id-dlg-hf-btn-all" style="border-radius: 0;">',this.textAll,"</button>",'<button type="button" class="btn btn-text-default auto hidden" id="id-dlg-hf-btn-odd" style="border-radius: 0;">',this.textOdd,"</button>",'<button type="button" class="btn btn-text-default auto hidden" id="id-dlg-hf-btn-even" style="border-radius: 0; margin-left:-1px;">',this.textEven,"</button>",'<button type="button" class="btn btn-text-default auto hidden" id="id-dlg-hf-btn-first" style="border-radius: 0; margin-left:-1px;">',this.textFirst,"</button>","</div>",'<label style="display: block; margin-bottom: 3px;">'+this.textHeader+"</label>",'<div id="id-dlg-h-presets" class="input-row" style="display: inline-block; vertical-align: middle;"></div>','<div id="id-dlg-h-insert" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>','<div id="id-dlg-h-fonts" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>','<div id="id-dlg-h-font-size" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>','<div id="id-dlg-h-textcolor" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-h-bold" style="display: inline-block;margin-left: 2px;"></div>','<div id="id-dlg-h-italic" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-h-underline" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-h-strikeout" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-h-subscript" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-h-superscript" style="display: inline-block;margin-left: 6px;"></div>','<div style="display: inline-block;margin-right: -1px;margin-top: 7px;vertical-align: middle;">','<div class="preview-canvas-container" style="width: 206px; height: 92px; position:relative; overflow:hidden;">','<div id="header-left-img" style="width: 190px; height: 100%;"></div>',"</div>","</div>",'<div style="display: inline-block;margin-right: -1px;margin-top: 7px;vertical-align: middle;">','<div class="preview-canvas-container" style="width: 206px; height: 92px; position:relative; overflow:hidden;">','<div id="header-center-img" style="width: 190px; height: 100%;"></div>',"</div>","</div>",'<div style="display: inline-block;margin-top: 7px;vertical-align: middle;">','<div class="preview-canvas-container" style="width: 206px; height: 92px; position:relative; overflow:hidden;">','<div id="header-right-img" style="width: 190px; height: 100%;"></div>',"</div>","</div>",'<label style="display: block; margin-top: 10px;margin-bottom: 3px;">'+this.textFooter+"</label>",'<div id="id-dlg-f-presets" class="input-row" style="display: inline-block; vertical-align: middle;"></div>','<div id="id-dlg-f-insert" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>','<div id="id-dlg-f-fonts" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>','<div id="id-dlg-f-font-size" class="input-row" style="display: inline-block; vertical-align: middle; margin-left: 2px;"></div>','<div id="id-dlg-f-textcolor" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-f-bold" style="display: inline-block;margin-left: 2px;"></div>','<div id="id-dlg-f-italic" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-f-underline" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-f-strikeout" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-f-subscript" style="display: inline-block;margin-left: 6px;"></div>','<div id="id-dlg-f-superscript" style="display: inline-block;margin-left: 6px;"></div>','<div style="display: inline-block;margin-right: -1px;margin-top: 7px;vertical-align: middle;">','<div class="preview-canvas-container" style="width: 206px; height: 92px; position:relative; overflow:hidden;">','<div id="footer-left-img" style="width: 190px; height: 100%;"></div>',"</div>","</div>",'<div style="display: inline-block;margin-right: -1px;margin-top: 7px;vertical-align: middle;">','<div class="preview-canvas-container" style="width: 206px; height: 92px; position:relative; overflow:hidden;">','<div id="footer-center-img" style="width: 190px; height: 100%;"></div>',"</div>","</div>",'<div style="display: inline-block;margin-top: 7px;vertical-align: middle;">','<div class="preview-canvas-container" style="width: 206px; height: 92px; position:relative; overflow:hidden;">','<div id="footer-right-img" style="width: 190px; height: 100%;"></div>',"</div>","</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();this.chFirstPage=new Common.UI.CheckBox({el:$("#id-dlg-hf-ch-first"),labelText:this.textDiffFirst}),this.chFirstPage.on("change",_.bind((function(t,e,i,n){var o="checked"==t.getValue(),s=this.HFObject?this.HFObject.setDifferentFirst(o):null;if(s){var a=this;this.showError((function(){t.setValue(!o,!0),_.delay((function(){a.onCanvasClick(s)}),50)}))}else this.btnFirst.setVisible(o),!o&&this.btnFirst.isActive()&&(this.btnAll.isVisible()?this.btnAll.toggle(!0):this.btnOdd.toggle(!0))}),this)),this.chOddPage=new Common.UI.CheckBox({el:$("#id-dlg-hf-ch-odd"),labelText:this.textDiffOdd}),this.chOddPage.on("change",_.bind((function(t,e,i,n){var o="checked"==t.getValue(),s=this.HFObject?this.HFObject.setDifferentOddEven(o):null;if(s){var a=this;this.showError((function(){t.setValue(!o,!0),_.delay((function(){a.onCanvasClick(s)}),50)}))}else this.btnOdd.setVisible(o),this.btnEven.setVisible(o),this.btnAll.setVisible(!o),o||!this.btnOdd.isActive()&&!this.btnEven.isActive()||this.btnAll.toggle(!0),o&&this.btnAll.isActive()&&this.btnOdd.toggle(!0)}),this)),this.chScale=new Common.UI.CheckBox({el:$("#id-dlg-hf-ch-scale"),labelText:this.textScale}),this.chScale.on("change",_.bind((function(t,e,i,n){var o="checked"==t.getValue();this.HFObject&&this.HFObject.setScaleWithDoc(o)}),this)),this.chAlign=new Common.UI.CheckBox({el:$("#id-dlg-hf-ch-align"),labelText:this.textAlign}),this.chAlign.on("change",_.bind((function(t,e,i,n){var o="checked"==t.getValue();this.HFObject&&this.HFObject.setAlignWithMargins(o)}),this)),this.btnAll=new Common.UI.Button({el:$("#id-dlg-hf-btn-all"),enableToggle:!0,toggleGroup:"hf-pages",allowDepress:!1,pressed:!0}),this.btnAll.on("toggle",_.bind(this.onPageTypeToggle,this,Asc.c_oAscHeaderFooterType.odd)),this.btnOdd=new Common.UI.Button({el:$("#id-dlg-hf-btn-odd"),enableToggle:!0,toggleGroup:"hf-pages",allowDepress:!1}),this.btnOdd.on("toggle",_.bind(this.onPageTypeToggle,this,Asc.c_oAscHeaderFooterType.odd)),this.btnEven=new Common.UI.Button({el:$("#id-dlg-hf-btn-even"),enableToggle:!0,toggleGroup:"hf-pages",allowDepress:!1}),this.btnEven.on("toggle",_.bind(this.onPageTypeToggle,this,Asc.c_oAscHeaderFooterType.even)),this.btnFirst=new Common.UI.Button({el:$("#id-dlg-hf-btn-first"),enableToggle:!0,toggleGroup:"hf-pages",allowDepress:!1}),this.btnFirst.on("toggle",_.bind(this.onPageTypeToggle,this,Asc.c_oAscHeaderFooterType.first)),this.btnPresetsH=new Common.UI.Button({parentEl:$("#id-dlg-h-presets"),cls:"btn-text-menu-default",caption:this.textPresets,style:"width: 115px;",menu:!0}),this.btnPresetsF=new Common.UI.Button({parentEl:$("#id-dlg-f-presets"),cls:"btn-text-menu-default",caption:this.textPresets,style:"width: 115px;",menu:!0});var i=[{caption:this.textPageNum,value:Asc.c_oAscHeaderFooterField.pageNumber},{caption:this.textPageCount,value:Asc.c_oAscHeaderFooterField.pageCount},{caption:this.textDate,value:Asc.c_oAscHeaderFooterField.date},{caption:this.textTime,value:Asc.c_oAscHeaderFooterField.time},{caption:this.textFileName,value:Asc.c_oAscHeaderFooterField.fileName},{caption:this.textSheet,value:Asc.c_oAscHeaderFooterField.sheetName}];this.btnInsertH=new Common.UI.Button({parentEl:$("#id-dlg-h-insert"),cls:"btn-text-menu-default",caption:this.textInsert,style:"width: 115px;",menu:new Common.UI.Menu({style:"min-width: 115px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:i})}),this.btnInsertH.menu.on("item:click",_.bind(this.onObjectSelect,this)),this.headerControls.push(this.btnInsertH),this.btnInsertF=new Common.UI.Button({parentEl:$("#id-dlg-f-insert"),cls:"btn-text-menu-default",caption:this.textInsert,style:"width: 115px;",menu:new Common.UI.Menu({style:"min-width: 115px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:i})}),this.btnInsertF.menu.on("item:click",_.bind(this.onObjectSelect,this)),this.footerControls.push(this.btnInsertF),this.cmbFonts=[],this.cmbFonts.push(new Common.UI.ComboBoxFonts({el:$("#id-dlg-h-fonts"),cls:"input-group-nr",style:"width: 142px;",menuCls:"scrollable-menu",menuStyle:"min-width: 100%;max-height: 270px;",store:new Common.Collections.Fonts,recent:0,hint:this.tipFontName})),this.cmbFonts[0].on("selected",_.bind(this.onFontSelect,this)),this.cmbFonts[0].setValue(this._state.fontname),this.headerControls.push(this.cmbFonts[0]),this.cmbFonts.push(new Common.UI.ComboBoxFonts({el:$("#id-dlg-f-fonts"),cls:"input-group-nr",style:"width: 142px;",menuCls:"scrollable-menu",menuStyle:"min-width: 100%;max-height: 270px;",store:new Common.Collections.Fonts,recent:0,hint:this.tipFontName})),this.cmbFonts[1].on("selected",_.bind(this.onFontSelect,this)),this.cmbFonts[1].setValue(this._state.fontname),this.footerControls.push(this.cmbFonts[1]),Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this)),i=[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"}],this.cmbFontSize=[],this.cmbFontSize.push(new Common.UI.ComboBox({el:$("#id-dlg-h-font-size"),cls:"input-group-nr",style:"width: 45px;",menuCls:"scrollable-menu",menuStyle:"min-width: 45px;max-height: 270px;",hint:this.tipFontSize,data:i})),this.cmbFontSize[0].on("selected",_.bind(this.onFontSizeSelect,this)),this.cmbFontSize[0].on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),this.cmbFontSize[0].on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),this.cmbFontSize[0].setValue(this._state.fontsize),this.headerControls.push(this.cmbFontSize[0]),this.cmbFontSize.push(new Common.UI.ComboBox({el:$("#id-dlg-f-font-size"),cls:"input-group-nr",style:"width: 45px;",menuCls:"scrollable-menu",menuStyle:"min-width: 45px;max-height: 270px;",hint:this.tipFontSize,data:i})),this.cmbFontSize[1].on("selected",_.bind(this.onFontSizeSelect,this)),this.cmbFontSize[1].on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),this.cmbFontSize[1].on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),this.cmbFontSize[1].setValue(this._state.fontsize),this.footerControls.push(this.cmbFontSize[1]),this.btnBold=[],this.btnBold.push(new Common.UI.Button({parentEl:$("#id-dlg-h-bold"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0,hint:this.textBold})),this.btnBold[0].on("click",_.bind(this.onBoldClick,this)),this.headerControls.push(this.btnBold[0]),this.btnBold.push(new Common.UI.Button({parentEl:$("#id-dlg-f-bold"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0,hint:this.textBold})),this.btnBold[1].on("click",_.bind(this.onBoldClick,this)),this.footerControls.push(this.btnBold[1]),this.btnItalic=[],this.btnItalic.push(new Common.UI.Button({parentEl:$("#id-dlg-h-italic"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0,hint:this.textItalic})),this.btnItalic[0].on("click",_.bind(this.onItalicClick,this)),this.headerControls.push(this.btnItalic[0]),this.btnItalic.push(new Common.UI.Button({parentEl:$("#id-dlg-f-italic"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0,hint:this.textItalic})),this.btnItalic[1].on("click",_.bind(this.onItalicClick,this)),this.footerControls.push(this.btnItalic[1]),this.btnUnderline=[],this.btnUnderline.push(new Common.UI.Button({parentEl:$("#id-dlg-h-underline"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",enableToggle:!0,hint:this.textUnderline})),this.btnUnderline[0].on("click",_.bind(this.onUnderlineClick,this)),this.headerControls.push(this.btnUnderline[0]),this.btnUnderline.push(new Common.UI.Button({parentEl:$("#id-dlg-f-underline"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",enableToggle:!0,hint:this.textUnderline})),this.btnUnderline[1].on("click",_.bind(this.onUnderlineClick,this)),this.footerControls.push(this.btnUnderline[1]),this.btnStrikeout=[],this.btnStrikeout.push(new Common.UI.Button({parentEl:$("#id-dlg-h-strikeout"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",enableToggle:!0,hint:this.textStrikeout})),this.btnStrikeout[0].on("click",_.bind(this.onStrikeoutClick,this)),this.headerControls.push(this.btnStrikeout[0]),this.btnStrikeout.push(new Common.UI.Button({parentEl:$("#id-dlg-f-strikeout"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",enableToggle:!0,hint:this.textStrikeout})),this.btnStrikeout[1].on("click",_.bind(this.onStrikeoutClick,this)),this.footerControls.push(this.btnStrikeout[1]),this.btnSuperscript=[],this.btnSuperscript.push(new Common.UI.Button({parentEl:$("#id-dlg-h-superscript"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-superscript",enableToggle:!0,toggleGroup:"superscriptHFGroup",hint:this.textSuperscript})),this.btnSuperscript[0].on("click",_.bind(this.onSuperscriptClick,this)),this.headerControls.push(this.btnSuperscript[0]),this.btnSuperscript.push(new Common.UI.Button({parentEl:$("#id-dlg-f-superscript"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-superscript",enableToggle:!0,toggleGroup:"superscriptHFGroup",hint:this.textSuperscript})),this.btnSuperscript[1].on("click",_.bind(this.onSuperscriptClick,this)),this.footerControls.push(this.btnSuperscript[1]),this.btnSubscript=[],this.btnSubscript.push(new Common.UI.Button({parentEl:$("#id-dlg-h-subscript"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-subscript",enableToggle:!0,toggleGroup:"superscriptHFGroup",hint:this.textSubscript})),this.btnSubscript[0].on("click",_.bind(this.onSubscriptClick,this)),this.headerControls.push(this.btnSubscript[0]),this.btnSubscript.push(new Common.UI.Button({parentEl:$("#id-dlg-f-subscript"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-subscript",enableToggle:!0,toggleGroup:"superscriptHFGroup",hint:this.textSubscript})),this.btnSubscript[1].on("click",_.bind(this.onSubscriptClick,this)),this.footerControls.push(this.btnSubscript[1]);var n=function(e){e.setMenu(),e.currentColor="000000",e.setColor(e.currentColor);var i=e.getPicker();return i.currentColor=e.currentColor,e.on("color:select",_.bind(t.onColorSelect,t)),i};this.btnTextColor=[],this.btnTextColor.push(new Common.UI.ButtonColored({parentEl:$("#id-dlg-h-textcolor"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",hint:this.textColor,split:!0,additionalAlign:this.menuAddAlign,menu:!0})),this.btnTextColor[0].on("click",_.bind(this.onTextColor,this)),this.mnuTextColorPicker=[],this.mnuTextColorPicker.push(n(this.btnTextColor[0])),this.headerControls.push(this.btnTextColor[0]),this.btnTextColor.push(new Common.UI.ButtonColored({parentEl:$("#id-dlg-f-textcolor"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",hint:this.textColor,split:!0,additionalAlign:this.menuAddAlign,menu:!0})),this.btnTextColor[1].on("click",_.bind(this.onTextColor,this)),this.mnuTextColorPicker.push(n(this.btnTextColor[1])),this.footerControls.push(this.btnTextColor[1]),this.btnOk=new Common.UI.Button({el:e.find(".primary")}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.scrollers=[],this.initCanvas("#header-left-img"),this.initCanvas("#header-center-img"),this.initCanvas("#header-right-img"),this.initCanvas("#footer-left-img"),this.initCanvas("#footer-center-img"),this.initCanvas("#footer-right-img"),this.wrapEvents={onApiEditorSelectionChanged:_.bind(this.onApiEditorSelectionChanged,this),onApiResizeEditorHeight:_.bind(this.onApiResizeEditorHeight,this),onUpdateEditorCursorPosition:_.bind(this.onUpdateEditorCursorPosition,this)},this.afterRender()},initCanvas:function(t){var e=this.$window.find(t);e.on("click",_.bind(this.onCanvasClick,this,t)),this.canvasBoxHeight=e.height(),this.scrollers[t]=new Common.UI.Scroller({el:e.parent(),minScrollbarLength:20}),this.scrollers[t].update(),this.scrollers[t].scrollTop(0)},show:function(){Common.UI.Window.prototype.show.apply(this,arguments)},close:function(){this.api.asc_unregisterCallback("asc_onEditorSelectionChanged",this.wrapEvents.onApiEditorSelectionChanged),this.api.asc_unregisterCallback("asc_resizeEditorHeight",this.wrapEvents.onApiResizeEditorHeight),this.api.asc_unregisterCallback("asc_updateEditorCursorPosition",this.wrapEvents.onUpdateEditorCursorPosition),Common.UI.Window.prototype.close.apply(this,arguments),this.HFObject&&this.HFObject.destroy(!1,this.pageSetup)},afterRender:function(){this.api.asc_registerCallback("asc_onEditorSelectionChanged",this.wrapEvents.onApiEditorSelectionChanged),this.api.asc_registerCallback("asc_resizeEditorHeight",this.wrapEvents.onApiResizeEditorHeight),this.api.asc_registerCallback("asc_updateEditorCursorPosition",this.wrapEvents.onUpdateEditorCursorPosition),this.cmbFonts[0].fillFonts(this.fontStore),this.cmbFonts[1].fillFonts(this.fontStore),this.updateThemeColors(),this.HFObject=new Asc.asc_CHeaderFooterEditor(["header-left-img","header-center-img","header-right-img","footer-left-img","footer-center-img","footer-right-img"],205,void 0,this.pageSetup),this._setDefaults(this.props),this.editorCanvas=this.$window.find("#ce-canvas-menu");var t=this;_.delay((function(){t.onCanvasClick("#header-left-img")}),500)},_setDefaults:function(t){var e=[];this.HFObject.getTextPresetsArr().forEach((function(t,i){e.push({caption:t,value:i})})),this.btnPresetsH.setMenu(new Common.UI.Menu({style:"min-width: 115px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:e})),this.btnPresetsH.menu.on("item:click",_.bind(this.onPresetSelect,this,!1)),this.btnPresetsF.setMenu(new Common.UI.Menu({style:"min-width: 115px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:e})),this.btnPresetsF.menu.on("item:click",_.bind(this.onPresetSelect,this,!0)),this.chOddPage.setValue(this.HFObject.getDifferentOddEven()),this.chFirstPage.setValue(this.HFObject.getDifferentFirst()),this.chAlign.setValue(this.HFObject.getAlignWithMargins()),this.chScale.setValue(this.HFObject.getScaleWithDoc());var i="checked"==this.chOddPage.getValue();this.btnOdd.setVisible(i),this.btnEven.setVisible(i),this.btnAll.setVisible(!i),i?this.btnOdd.toggle(!0):this.btnAll.toggle(!0),i="checked"==this.chFirstPage.getValue(),this.btnFirst.setVisible(i)},updateThemeColors:function(){this.mnuTextColorPicker[0].updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.mnuTextColorPicker[1].updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},getSettings:function(){return{}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.HFObject){var e=this.HFObject.destroy("ok"==t,this.pageSetup);if(e){var i=this;return void this.showError((function(){_.delay((function(){i.onCanvasClick(e)}),50)}))}this.HFObject=null}this.options.handler&&this.options.handler.call(this,this,t),this.close()},showError:function(t){Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.textMaxError,callback:t})},scrollerUpdate:function(){for(var t in this.scrollers)this.scrollers[t]&&this.scrollers[t].update()},scrollerScrollTop:function(){for(var t in this.scrollers)this.scrollers[t]&&this.scrollers[t].scrollTop(0)},onCanvasClick:function(t,e){if(this.HFObject){t=t||"#header-left-img";var i=this.currentCanvas!==t;if(i){this.currentCanvas=t,this.isFooter="#footer-left-img"==t||"#footer-center-img"==t||"#footer-right-img"==t;var n=this;this.headerControls.forEach((function(t){t.setDisabled(n.isFooter)})),this.footerControls.forEach((function(t){t.setDisabled(!n.isFooter)}))}e?this.HFObject.click(t,e.pageX,e.pageY):this.HFObject.click(t),i&&this.scrollerUpdate()}},onApiResizeEditorHeight:function(t){if(this.editorCanvas){var e=this.editorCanvas.height();e!=this.editorCanvasHeight&&(this.editorCanvasHeight=e,this.scrollers[this.currentCanvas]&&this.scrollers[this.currentCanvas].update())}},onUpdateEditorCursorPosition:function(t,e){if(this.editorCanvas){var i=this.currentCanvas;if(this.scrollers[i]){var n=this.scrollers[i].getScrollTop();t+e>n+this.canvasBoxHeight?this.scrollers[i].scrollTop(t+e-this.canvasBoxHeight):t<n&&this.scrollers[i].scrollTop(t)}}},onPresetSelect:function(t,e,i){this.HFObject&&this.HFObject.applyPreset(i.value,!!t),this.onCanvasClick(t?"#footer-left-img":"#header-left-img")},onObjectSelect:function(t,e){this.HFObject&&this.HFObject.addField(e.value),this.onCanvasClick(this.currentCanvas)},onFontSelect:function(t,e){this.HFObject&&this.HFObject.setFontName(e.name),this.onCanvasClick(this.currentCanvas)},onFontSizeSelect:function(t,e){this.HFObject&&this.HFObject.setFontSize(e.value),this.onCanvasClick(this.currentCanvas)},onFontSizeChanged:function(t,e,i,n){var o;if(t){if(!e.store.findWhere({displayValue:i.value})&&!(o=/^\+?(\d*(\.|,)?\d+)$|^\+?(\d+(\.|,)?\d*)$/.exec(i.value)))return o=e.getValue(),e.setRawValue(o),n.preventDefault(),!1}else o=(o=Common.Utils.String.parseFloat(i.value))>409?409:o<1?1:Math.floor(2*(o+.4))/2,e.setRawValue(o),this.HFObject&&this.HFObject.setFontSize(o)},onBoldClick:function(t,e){this.HFObject&&(this.HFObject.setBold(t.pressed),this.scrollerUpdate())},onItalicClick:function(t,e){this.HFObject&&(this.HFObject.setItalic(t.pressed),this.scrollerUpdate())},onUnderlineClick:function(t,e){this.HFObject&&(this.HFObject.setUnderline(t.pressed),this.scrollerUpdate())},onStrikeoutClick:function(t,e){this.HFObject&&(this.HFObject.setStrikeout(t.pressed),this.scrollerUpdate())},onSuperscriptClick:function(t,e){this.HFObject&&(this.HFObject.setSuperscript(t.pressed),this.scrollerUpdate())},onSubscriptClick:function(t,e){this.HFObject&&(this.HFObject.setSubscript(t.pressed),this.scrollerUpdate())},onTextColor:function(){var t=this.mnuTextColorPicker[this.isFooter?1:0];t.trigger("select",t,t.currentColor,!0)},onColorSelect:function(t,e){t.currentColor=e,t.colorPicker.currentColor=e,this.HFObject&&this.HFObject.setTextColor(Common.Utils.ThemeColor.getRgbColor(e)),this.onCanvasClick(this.currentCanvas)},onPageTypeToggle:function(t,e,i){if(!this._pagetype&&i&&this.HFObject){var n=this.HFObject.getPageType(),o=this.HFObject.switchHeaderFooterType(t);if(o){this._pagetype=!0;var s=this;return void this.showError((function(){switch(n){case Asc.c_oAscHeaderFooterType.odd:s.btnOdd.isVisible()?s.btnOdd.toggle(!0):s.btnAll.toggle(!0);break;case Asc.c_oAscHeaderFooterType.even:s.btnEven.toggle(!0);break;case Asc.c_oAscHeaderFooterType.first:s.btnFirst.toggle(!0)}_.delay((function(){s.onCanvasClick(o)}),50),s._pagetype=!1}))}this.scrollerScrollTop(),this.onCanvasClick(this.currentCanvas,void 0,!0)}},onApiChangeFont:function(t){this.cmbFonts[this.isFooter?1:0].onApiChangeFont(t)},onApiEditorSelectionChanged:function(t){var e,i=this.isFooter?1:0;t.asc_getFontName()!=this.cmbFonts[i].getValue()&&Common.NotificationCenter.trigger("fonts:change",t),e=t.asc_getFontBold(),this.btnBold[i].isActive()!==e&&this.btnBold[i].toggle(!0===e,!0),e=t.asc_getFontItalic(),this.btnItalic[i].isActive()!==e&&this.btnItalic[i].toggle(!0===e,!0),e=t.asc_getFontUnderline(),this.btnUnderline[i].isActive()!==e&&this.btnUnderline[i].toggle(!0===e,!0),e=t.asc_getFontStrikeout(),this.btnStrikeout[i].isActive()!==e&&this.btnStrikeout[i].toggle(!0===e,!0),e=t.asc_getFontSubscript(),this.btnSubscript[i].isActive()!==e&&this.btnSubscript[i].toggle(!0===e,!0),e=t.asc_getFontSuperscript(),this.btnSuperscript[i].isActive()!==e&&this.btnSuperscript[i].toggle(!0===e,!0);var n=t.asc_getFontSize();this.cmbFontSize[i].getValue()!==n&&this.cmbFontSize[i].setValue(void 0!==n?n:"");var o,s,a=this.mnuTextColorPicker[i];if((s=t.asc_getFontColor())&&(o=s.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b()),effectValue:s.get_value()}:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b())),_.isObject(o)){for(var l=!1,r=0;r<10;r++)if(Common.Utils.ThemeColor.ThemeValues[r]==o.effectValue){a.select(o,!0),l=!0;break}l||a.clearSelection()}else a.select(o,!0)},tipFontName:"Font",tipFontSize:"Font size",textBold:"Bold",textItalic:"Italic",textUnderline:"Underline",textStrikeout:"Strikeout",textSuperscript:"Superscript",textSubscript:"Subscript",textTitle:"Header/Footer Settings",textHeader:"Header",textFooter:"Footer",textLeft:"Left",textCenter:"Center",textRight:"Right",textPageNum:"Page number",textPageCount:"Page count",textDate:"Date",textTime:"Time",textFileName:"File name",textSheet:"Sheet name",textColor:"Text color",textNewColor:"Add New Custom Color",textInsert:"Insert",textPresets:"Presets",textDiffFirst:"Different first page",textDiffOdd:"Different odd and even pages",textScale:"Scale with document",textAlign:"Align with page margins",textFirst:"First page",textOdd:"Odd page",textEven:"Even page",textAll:"All pages",textMaxError:"The text string you entered is too long. Reduce the number of characters used."},SSE.Views.HeaderFooterDialog||{}))})),define("spreadsheeteditor/main/app/view/PrintTitlesDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner"],(function(){"use strict";SSE.Views.PrintTitlesDialog=Common.UI.Window.extend(_.extend({options:{width:300,header:!0,style:"min-width: 216px;",cls:"modal-dlg",id:"window-page-margins",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 100px;">','<table cols="2" style="width: 100%;margin-bottom: 10px;">',"<tr>",'<td colspan="2" style="padding-right: 10px;">','<label class="input-label">'+this.textTop+"</label>","</td>","</tr>","<tr>",'<td style="padding-right: 10px;padding-bottom: 16px;">','<div id="print-titles-txt-top"></div>',"</td>",'<td style="padding-bottom: 16px;">','<div id="print-titles-presets-top"></div>',"</td>","</tr>","<tr>",'<td colspan="2" style="padding-right: 10px;">','<label class="input-label">'+this.textLeft+"</label>","</td>","</tr>","<tr>",'<td style="padding-right: 10px;">','<div id="print-titles-txt-left"></div>',"</td>","<td>",'<div id="print-titles-presets-left"></div>',"</td>","</tr>","</table>","</div>",'<div class="separator horizontal"></div>'].join(""),this.options.tpl=_.template(this.template)(this.options),this.api=this.options.api,this.sheet=this.options.sheet,Common.UI.Window.prototype.initialize.call(this,this.options),this.dataRangeTop="",this.dataRangeLeft=""},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;this.txtRangeTop=new Common.UI.InputFieldBtn({el:$("#print-titles-txt-top"),style:"width: 100%;",btnHint:this.textSelectRange,allowBlank:!0,validateOnChange:!0,validation:function(e){return!!_.isEmpty(e)||(t.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,e,!1)!=Asc.c_oAscError.ID.DataRangeError||t.textInvalidRange)}});var e=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,!1,this.sheet);this.btnPresetsTop=new Common.UI.Button({parentEl:$("#print-titles-presets-top"),cls:"btn-text-menu-default",caption:this.textRepeat,style:"width: 95px;",menu:new Common.UI.Menu({style:"min-width: 100px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:[{caption:this.textSelectRange+"...",value:"select"},{caption:this.textFrozenRows,value:"frozen",range:e,disabled:!e},{caption:this.textFirstRow,value:"first",range:this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.first,!1,this.sheet)},{caption:"--"},{caption:this.textNoRepeat,value:"empty",range:""}]})}),this.btnPresetsTop.menu.on("item:click",_.bind(this.onPresetSelect,this,"top")),this.txtRangeTop.on("button:click",_.bind(this.onPresetSelect,this,"top",this.btnPresetsTop.menu,{value:"select"})),this.txtRangeLeft=new Common.UI.InputFieldBtn({el:$("#print-titles-txt-left"),style:"width: 100%;",btnHint:this.textSelectRange,allowBlank:!0,validateOnChange:!0,validation:function(e){return!!_.isEmpty(e)||(t.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,e,!1)!=Asc.c_oAscError.ID.DataRangeError||t.textInvalidRange)}}),e=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,!0,this.sheet),this.btnPresetsLeft=new Common.UI.Button({parentEl:$("#print-titles-presets-left"),cls:"btn-text-menu-default",caption:this.textRepeat,style:"width: 95px;",menu:new Common.UI.Menu({style:"min-width: 100px;",maxHeight:200,additionalAlign:this.menuAddAlign,items:[{caption:this.textSelectRange+"...",value:"select"},{caption:this.textFrozenCols,value:"frozen",range:e,disabled:!e},{caption:this.textFirstCol,value:"first",range:this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.first,!0,this.sheet)},{caption:"--"},{caption:this.textNoRepeat,value:"empty",range:""}]})}),this.btnPresetsLeft.menu.on("item:click",_.bind(this.onPresetSelect,this,"left")),this.txtRangeLeft.on("button:click",_.bind(this.onPresetSelect,this,"left",this.btnPresetsLeft.menu,{value:"select"}));var i=this.getChild();i.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),i.find("input").on("keypress",_.bind(this.onKeyPress,this)),this.setSettings()},getFocusedComponents:function(){return[this.txtRangeTop,this.txtRangeLeft]},getDefaultFocusableComponent:function(){if(!this._alreadyRendered)return this._alreadyRendered=!0,this.txtRangeTop},isRangeValid:function(){return this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,this.txtRangeTop.getValue(),!1)==Asc.c_oAscError.ID.DataRangeError?(this.txtRangeTop.focus(),!1):this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,this.txtRangeLeft.getValue(),!1)!=Asc.c_oAscError.ID.DataRangeError||(this.txtRangeLeft.focus(),!1)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!this.isRangeValid())return;this.options.handler.call(this,this,t)}this.close()},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onKeyPress:function(t){t.keyCode==Common.UI.Keys.RETURN&&this._handleInput("ok")},setSettings:function(t){if(this.api){var e=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.current,!1,this.sheet);this.txtRangeTop.setValue(e||""),this.dataRangeTop=e,e=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.current,!0,this.sheet),this.txtRangeLeft.setValue(e||""),this.dataRangeLeft=e}},getSettings:function(){return{width:this.txtRangeLeft.getValue(),height:this.txtRangeTop.getValue()}},onPresetSelect:function(t,e,i){var n="top"==t?this.txtRangeTop:this.txtRangeLeft;if("select"==i.value){var o=this;if(o.api){o.btnPresetsTop.menu.options.additionalAlign=o.menuAddAlign,o.btnPresetsLeft.menu.options.additionalAlign=o.menuAddAlign;var s=new SSE.Views.CellRangeDialog({handler:function(e,i){if("ok"==i){var s=e.getSettings();"top"==t?o.dataRangeTop=s:o.dataRangeLeft=s,n.setValue(s),n.checkValidate()}}}).on("close",(function(){o.show(),_.delay((function(){n.focus()}),1)})),a=o.$window.offset();o.hide(),s.show(a.left+160,a.top+125),s.setSettings({api:o.api,range:_.isEmpty(n.getValue())||1!=n.checkValidate()?"top"==t?o.dataRangeTop:o.dataRangeLeft:n.getValue(),type:Asc.c_oAscSelectionDialogType.PrintTitles})}}else{var l=i.options.range||"";n.setValue(l),n.checkValidate(),"top"==t?this.dataRangeTop=l:this.dataRangeLeft=l,_.delay((function(){n.focus()}),1)}},textTitle:"Print Titles",textTop:"Repeat rows at top",textLeft:"Repeat columns at left",textRepeat:"Repeat...",textNoRepeat:"Not repeat",textSelectRange:"Select range",textFrozenRows:"Frozen rows",textFrozenCols:"Frozen columns",textFirstRow:"First row",textFirstCol:"First column",textInvalidRange:"ERROR! Invalid cells range"},SSE.Views.PrintTitlesDialog||{}))})),define("spreadsheeteditor/main/app/view/ScaleDialog",["common/main/lib/component/Window","common/main/lib/component/MetricSpinner"],(function(){"use strict";SSE.Views.ScaleDialog=Common.UI.Window.extend(_.extend({options:{width:215,height:235,header:!0,style:"min-width: 215px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this._state={width:null,height:null},this.template=['<div class="box">','<div id="radio-fit-to" style="margin-bottom: 4px;"></div>','<div style="padding-left: 22px;">',"<div>",'<label style="height: 22px;width: 55px;padding-top: 4px;display: inline-block;margin-bottom: 4px;">'+this.textWidth+"</label>",'<div id="scale-width" style="display: inline-block;margin-bottom: 4px;"></div>',"</div>","<div>",'<label style="height: 22px;width: 55px;padding-top: 4px;display: inline-block;margin-bottom: 16px;">'+this.textHeight+"</label>",'<div id="scale-height" style="display: inline-block;margin-bottom: 16px;"></div>',"</div>","</div>",'<div id="radio-scale-to" style="margin-bottom: 6px;"></div>','<div id="scale" style="padding-left: 22px; margin-bottom: 6px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.api=this.options.api,this._originalProps=this.options.props,this.arrDataScale=[{displayValue:this.textAuto,value:0},{displayValue:"1 "+this.textOnePage,value:1},{displayValue:"2 "+this.textFewPages,value:2},{displayValue:"3 "+this.textFewPages,value:3},{displayValue:"4 "+this.textFewPages,value:4},{displayValue:"5 "+this.textManyPages,value:5},{displayValue:"6 "+this.textManyPages,value:6},{displayValue:"7 "+this.textManyPages,value:7},{displayValue:"8 "+this.textManyPages,value:8},{displayValue:"9 "+this.textManyPages,value:9}],Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.radioFitTo=new Common.UI.RadioBox({el:$("#radio-fit-to"),labelText:this.textFitTo,name:"asc-radio-scale"}),this.radioFitTo.on("change",_.bind(this.onRadioScale,this,"fitto")),this.radioScaleTo=new Common.UI.RadioBox({el:$("#radio-scale-to"),labelText:this.textScaleTo,name:"asc-radio-scale"}),this.radioScaleTo.on("change",_.bind(this.onRadioScale,this,"scaleto")),this.cmbScaleWidth=new Common.UI.ComboBox({el:$("#scale-width"),cls:"input-group-nr",style:"width: 90px;",menuStyle:"min-width: 90px;",editable:!0,data:this.arrDataScale,scrollAlwaysVisible:!0,takeFocusOnClose:!0}).on("selected",_.bind(this.changeWidthHeight,this,"width")).on("changed:after",_.bind(this.changeWidthHeight,this,"width")).on("changed:before",_.bind(this.onChangeComboScale,this,"width")),this.cmbScaleHeight=new Common.UI.ComboBox({el:$("#scale-height"),cls:"input-group-nr",style:"width: 90px;",menuStyle:"min-width: 90px;",editable:!0,data:this.arrDataScale,scrollAlwaysVisible:!0,takeFocusOnClose:!0}).on("selected",_.bind(this.changeWidthHeight,this,"height")).on("changed:after",_.bind(this.changeWidthHeight,this,"height")).on("changed:before",_.bind(this.onChangeComboScale,this,"height")),this.spnScale=new Common.UI.MetricSpinner({el:$("#scale"),step:1,width:75,defaultUnit:"%",maxValue:400,minValue:10,defaultValue:"100 %"}).on("change",_.bind((function(t){this.radioScaleTo.setValue(!0,!0),this.cmbScaleHeight.setValue(0,!0),this.cmbScaleWidth.setValue(0,!0),this._state.width=0,this._state.height=0}),this)),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.afterRender()},getFocusedComponents:function(){return[this.radioFitTo,this.cmbScaleWidth,this.cmbScaleHeight,this.radioScaleTo,this.spnScale]},getDefaultFocusableComponent:function(){return this.radioScaleTo.getValue()?this.spnScale:this.cmbScaleWidth},afterRender:function(){this._setDefaults(this._originalProps)},_handleInput:function(t){this.options.handler&&"ok"===t&&this.options.handler.call(this,"ok",this.getSettings()),this.close(t)},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(){return this._handleInput("ok"),!1},changeWidthHeight:function(t,e){var i=e.getValue();"string"==typeof i&&(i=parseInt(i),isNaN(i)&&(i=0)),"width"===t?this._state.width=i:this._state.height=i,0!==this._state.width&&null!==this._state.width||0!==this._state.height&&null!==this._state.height?this.radioFitTo.setValue(!0,!0):this.radioScaleTo.setValue(!0,!0)},onRadioScale:function(t,e,i){"scaleto"===t?(this.cmbScaleHeight.setValue(0,!0),this._state.height=0,this.cmbScaleWidth.setValue(0,!0),this._state.width=0):(this.cmbScaleHeight.setValue(0,!0),this._state.height=0,this.cmbScaleWidth.setValue(1,!0),this._state.width=1)},_setDefaults:function(t){if(this.api){var e=(t||this.api.asc_getPageOptions()).asc_getPageSetup(),i=e.asc_getFitToWidth(),n=e.asc_getFitToHeight(),o=e.asc_getScale();this._state.width=null!==i&&0!==i?i:null,this._state.height=null!==n&&0!==n?n:null,n=null!=n?n:0,0===(i=null!=i?i:0)&&0===n?this.radioScaleTo.setValue(!0,!0):this.radioFitTo.setValue(!0,!0),_.findWhere(this.arrDataScale,{value:i})?this.cmbScaleWidth.setValue(i):this.cmbScaleWidth.setRawValue(i.toString()+" "+this.getTextPages(i)),_.findWhere(this.arrDataScale,{value:n})?this.cmbScaleHeight.setValue(n):this.cmbScaleHeight.setRawValue(n.toString()+" "+this.getTextPages(n)),this.spnScale.setValue(null!=o?o:"",!0)}},getSettings:function(){var t={};return t.width=null===this._state.width?null:this._state.width,t.height=null===this._state.height?null:this._state.height,t.scale=this.spnScale.getNumberValue(),t},getTextPages:function(t){var e=t%10;return e>0&&e<1.001?this.textOnePage:e>0&&e<4.001?this.textFewPages:this.textManyPages},onChangeComboScale:function(t,e,i,n){var o,s=this,a=i.value.toLowerCase();new RegExp("^\\s*("+s.textAuto.toLowerCase()+")\\s*$").exec(a)?a=0:(a=parseInt(a),!isNaN(a)&&(o=s.getTextPages(a))),(isNaN(a)||a<0||a>32767)&&(Common.UI.error({msg:s.textError,callback:function(){_.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}}),a="width"===t?s._state.width:s._state.height,o=s.getTextPages(a)),null===a&&(a=0),"width"===t?(_.findWhere(s.arrDataScale,{value:a})?s.cmbScaleWidth.setValue(a):(s.cmbScaleWidth.setValue(""),s.cmbScaleWidth.setRawValue(a.toString()+" "+o)),s._state.width=a):"height"===t&&(_.findWhere(s.arrDataScale,{value:a})?s.cmbScaleHeight.setValue(a):(s.cmbScaleHeight.setValue(""),s.cmbScaleHeight.setRawValue(a.toString()+" "+o)),s._state.height=a)},close:function(t){this.options.handler&&"ok"!==t&&this.options.handler.call(this,"cancel",void 0),Common.UI.Window.prototype.close.call(this)},textTitle:"Scale Settings",textWidth:"Width",textHeight:"Height",textAuto:"Auto",textOnePage:"page",textFewPages:"pages",textManyPages:"pages",textError:"The entered value is incorrect.",textScaleTo:"Scale To",textFitTo:"Fit To"},SSE.Views.ScaleDialog||{}))})),define("text!spreadsheeteditor/main/app/template/FormatRulesManagerDlg.template",[],(function(){return'<div class="settings-panel active">\n    <div class="inner-content">\n        <table cols="2" style="width: 100%;">\n            <tr>\n                <td colspan=2 class="padding-large">\n                    <label><%= scope.textScope %></label>\n                    <div id="format-manager-combo-scope" class="input-group-nr" style="width:185px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=2>\n                    <label id="format-manager-label-column" class="header" style="width: 186px;"><%= scope.textRules %></label>\n                    <label id="format-manager-label-sort" class="header" style="width: 177px;"><%= scope.textApply %></label>\n                    <label class="header" style=""><%= scope.textFormat %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=2 class="padding-small">\n                    <div id="format-manager-rules-list" class="range-tableview" style="width:100%; height: 151px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <button type="button" class="btn btn-text-default" id="format-manager-btn-new" style="min-width: 100px;margin-right:5px;"><%= scope.textNew %></button>\n                    <button type="button" class="btn btn-text-default" id="format-manager-btn-edit" style="min-width: 100px;margin-right:5px;"><%= scope.textEdit %></button>\n                    <div id="format-manager-btn-up" style="display: inline-block;"></div>\n                    <div id="format-manager-btn-down" style="display: inline-block;"></div>\n                </td>\n                <td class="padding-large" style="text-align: right;width:90px;">\n                    <button type="button" class="btn btn-text-default" id="format-manager-btn-delete" style="min-width: 100px;"><%= scope.textDelete %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),define("text!spreadsheeteditor/main/app/template/FormatRulesEditDlg.template",[],(function(){return'<div class="settings-panel active">\n    <div class="inner-content">\n    <table cols="1" style="width: 100%;">\n        <tr>\n            <td class="padding-small">\n                <div style="width:150px; display: inline-block; margin-right: 10px;vertical-align: top;">\n                    <label class="header"><%= scope.textRule %></label>\n                    <div id="format-rules-edit-combo-category" class="input-group-nr"></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="hasformat">\n            <td class="padding-large">\n                <div id="format-rules-edit-combo-rule" class="input-group-nr" style="display: inline-block;vertical-align: top;margin-right: 10px;"></div>\x3c!--\n             --\x3e<div id="format-rules-edit-txt-r1" class="input-row" style="display: inline-block;vertical-align: top;margin-right: 10px;"></div>\x3c!--\n             --\x3e<div id="format-rules-edit-txt-r2" class="input-row" style="display: inline-block;vertical-align: top;"></div>\x3c!--\n             --\x3e<div id="format-rules-edit-spin-rank" class="input-row" style="display: inline-block;vertical-align: top;margin-right: 10px;"></div>\x3c!--\n             --\x3e<div id="format-rules-edit-combo-percent" class="input-row" style="display: inline-block;vertical-align: top;"></div>\n                </td>\n            </tr>\n        <tr class="hasformat">\n            <td class="padding-small">\n                <label class="header"><%= scope.textFormat %></label>\n                <div>\n                    <div id="format-rules-format-preset" class="input-group-nr" style="display: inline-block;vertical-align: middle;"></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="hasformat">\n            <td class="padding-large">\n                <div>\n                    <div id="format-rules-bold" style="display: inline-block;"></div><div id="format-rules-italic" style="display: inline-block;margin-left: 3px;"></div>\n                    <div id="format-rules-underline" style="display: inline-block;margin-left: 3px;"></div><div id="format-rules-strikeout" style="display: inline-block;margin-left: 3px;"></div>\n                    <div id="format-rules-fontcolor" style="display: inline-block;margin-left: 3px;"></div><div id="format-rules-fillcolor" style="display: inline-block;margin-left: 3px;"></div>\n                    <div id="format-rules-borders" style="display: inline-block;margin-left: 3px;"></div>\n                    <div id="format-rules-edit-combo-num-format" class="input-group-nr" style="display: inline-block;vertical-align: middle;margin-left: 3px;"></div>\x3c!--\n                --\x3e<button type="button" class="btn btn-text-default auto" id="format-rules-edit-btn-clear" style="display: inline-block;vertical-align: middle;margin-left: 10px;min-width: 80px;"><%= scope.textClear %></button>\n                    </div>\n                </td>\n            </tr>\n        <tr class="hasformat">\n            <td class="padding-small">\n                <label class="header"><%= scope.textPreview %></label>\n                <div style="border: 1px solid #cbcbcb;width: 150px; height: 40px; padding: 3px;">\n                    <div id="format-rules-edit-preview-format" style="width: 100%; height: 100%; position: relative; margin: 0 auto;background-color: #ffffff;"></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="scale">\n            <td class="padding-large" style="padding-top: 8px;">\n                <div style="width:150px; display: inline-block; margin-right: 10px;vertical-align: top;">\n                    <label style="display: block;"><%= scope.textMinpoint %></label>\n                    <div id="format-rules-edit-combo-scale-1" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-txt-scale-1" class="" style="height: 22px;margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-color-scale-1" style=""></div>\n                    </div>\x3c!--\n             --\x3e<div style="width:150px; display: inline-block; margin-right: 10px;">\n                    <label id="format-rules-edit-lbl-scale-2" style="display: block;"><%= scope.textMidpoint %></label>\n                    <div id="format-rules-edit-combo-scale-2" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-txt-scale-2" class="" style="height: 22px;margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-color-scale-2" style=""></div>\n                    </div>\x3c!--\n             --\x3e<div style="width:150px; display: inline-block;">\n                    <label style="display: block;"><%= scope.textMaxpoint %></label>\n                    <div id="format-rules-edit-combo-scale-3" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-txt-scale-3" class="" style="height: 22px;margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-color-scale-3" style=""></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="scale">\n            <td colspan="3" class="padding-small">\n                <label class="header"><%= scope.textPreview %></label>\n                <div style="border: 1px solid #cbcbcb;width: 100%; height: 40px; padding: 3px;">\n                    <div id="format-rules-edit-preview-scale" style="width: 100%; height: 100%; position: relative; margin: 0 auto;"></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="databar">\n            <td class="padding-large" style="padding-top: 8px;">\n                <div style="width:150px; display: inline-block; margin-right: 10px;vertical-align: top;">\n                    <label style="display: block;"><%= scope.textMinimum %></label>\n                    <div id="format-rules-edit-combo-bar-1" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-txt-bar-1" class="" style="height: 22px;"></div>\n                    </div>\x3c!--\n             --\x3e<div style="width:150px; display: inline-block;">\n                    <label style="display: block;"><%= scope.textMaximum %></label>\n                    <div id="format-rules-edit-combo-bar-2" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-txt-bar-2" class="" style="height: 22px;"></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="databar">\n            <td class="padding-very-small">\n                <label class="header"><%= scope.textAppearance %></label>\n                </td>\n            </tr>\n        <tr class="databar">\n            <td class="padding-large" style="">\n                <div style="width:150px; display: inline-block; margin-right: 10px;vertical-align: top;">\n                    <label style="display: block;"><%= scope.textFill %></label>\n                    <div id="format-rules-edit-combo-fill" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div style="width: 100%;margin-bottom: 4px;height: 23px;">\n                        <label style="margin-top: 4px;"><%= scope.textPositive %></label>\n                        <div id="format-rules-edit-color-pos-fill" style="float: right;"></div>\n                        </div>\n                    <div style="width: 100%;margin-bottom: 8px;height: 23px;">\n                        <label style="margin-top: 4px;"><%= scope.textNegative %></label>\n                        <div id="format-rules-edit-color-neg-fill" style="float: right;"></div>\n                        </div>\n                    <div id="format-rules-edit-chk-fill" style=""></div>\n                    </div>\x3c!--\n             --\x3e<div style="width:150px; display: inline-block; margin-right: 10px;vertical-align: top;">\n                    <label style="display: block;"><%= scope.textBorder %></label>\n                    <div id="format-rules-edit-combo-border" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div style="width: 100%;margin-bottom: 4px;height: 23px;">\n                        <label style="margin-top: 4px;"><%= scope.textPositive %></label>\n                        <div id="format-rules-edit-color-pos-border" style="float: right;"></div>\n                        </div>\n                    <div style="width: 100%;margin-bottom: 8px;height: 23px;">\n                        <label style="margin-top: 4px;"><%= scope.textNegative %></label>\n                        <div id="format-rules-edit-color-neg-border" style="float: right;"></div>\n                        </div>\n                    <div id="format-rules-edit-chk-border" style=""></div>\n                    </div>\x3c!--\n             --\x3e<div style="width:150px; display: inline-block;vertical-align: top;">\n                    <label style="display: block;"><%= scope.textBarDirection %></label>\n                    <div id="format-rules-edit-combo-direction" class="input-group-nr" style="margin-bottom: 8px;"></div>\n                    <div id="format-rules-edit-chk-show-bar" style="margin-top: 12px;"></div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="databar">\n            <td class="padding-small">\n                <div style="float:left;">\n                    <label class="header" style="display: block;"><%= scope.textAxis %></label>\n                    <label style="margin-right: 10px;margin-top: 1px;vertical-align: middle;"><%= scope.textPosition %></label>\n                    <div id="format-rules-edit-combo-axis-pos" class="input-group-nr" style="margin-right: 10px;display: inline-block;vertical-align: middle;"></div>\n                    <div id="format-rules-edit-color-axis-color" style="display: inline-block;vertical-align: middle;"></div>\n                    </div>\n                <div style="float:right; width: 155px;">\n                    <label class="header" style="display: block;"><%= scope.textPreview %></label>\n                    <div style="border: 1px solid #cbcbcb;width: 150px; height: 40px; padding: 3px;">\n                        <div id="format-rules-edit-preview-databar" style="width: 100%; height: 100%; position: relative; margin: 0 auto;"></div>\n                        </div>\n                    </div>\n                </td>\n            </tr>\n        <tr class="iconset">\n            <td>\n                <table>\n                    <tr>\n                        <td class="padding-large" style="padding-top: 8px;">\n                            <label class="header"><%= scope.textIconStyle %></label>\n                            <div>\n                                <div id="format-rules-icon-style" class="input-group-nr" style="display: inline-block;vertical-align: middle;"></div>\n                                <div id="format-rules-edit-chk-icon-show" style="margin-left: 10px;display: inline-block;vertical-align: middle;"></div>\n                                <button type="button" class="btn btn-text-default auto" id="format-rules-edit-btn-icon-reverse" style="float:right; display: inline-block;"><%= scope.textReverse %></button>\n                                </div>\n                            </td>\n                        </tr>\n                    <tr class="icons-5">\n                        <td class="padding-small">\n                            <div id="format-rules-combo-icon-5" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-txt-icon-5" class="iconset-label" style="display: inline-block;vertical-align: middle;margin-right: 5px;width: 130px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-op-5" class="input-group-nr" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-txt-value-5" class="" style="display: inline-block;height: 22px;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-type-5" class="input-group-nr" style="display: inline-block;vertical-align: middle;"></div>\n                            </td>\n                        </tr>\n                    <tr class="icons-4">\n                        <td class="padding-small">\n                            <div id="format-rules-combo-icon-4" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-txt-icon-4" class="iconset-label" style="display: inline-block;vertical-align: middle;margin-right: 5px;width: 130px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-op-4" class="input-group-nr" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-txt-value-4" class="" style="display: inline-block;height: 22px;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-type-4" class="input-group-nr" style="display: inline-block;vertical-align: middle;"></div>\n                            </td>\n                        </tr>\n                    <tr class="icons-3">\n                        <td class="padding-small">\n                            <div id="format-rules-combo-icon-3" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-txt-icon-3" class="iconset-label" style="display: inline-block;vertical-align: middle;margin-right: 5px;width: 130px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-op-3" class="input-group-nr" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-txt-value-3" class="" style="display: inline-block;height: 22px;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-type-3" class="input-group-nr" style="display: inline-block;vertical-align: middle;"></div>\n                            </td>\n                        </tr>\n                    <tr class="icons-2">\n                        <td class="padding-small">\n                            <div id="format-rules-combo-icon-2" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-txt-icon-2" class="iconset-label" style="display: inline-block;vertical-align: middle;margin-right: 5px;width: 130px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-op-2" class="input-group-nr" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-txt-value-2" class="" style="display: inline-block;height: 22px;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-type-2" class="input-group-nr" style="display: inline-block;vertical-align: middle;"></div>\n                            </td>\n                        </tr>\n                    <tr class="icons-1">\n                        <td class="padding-small">\n                            <div id="format-rules-combo-icon-1" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-txt-icon-1" class="iconset-label" style="display: inline-block;vertical-align: middle;margin-right: 5px;width: 130px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-op-1" class="input-group-nr hidden" style="display: inline-block;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-txt-value-1" class=" hidden" style="display: inline-block;height: 22px;vertical-align: middle;margin-right: 5px;"></div>\x3c!--\n                            --\x3e<div id="format-rules-edit-combo-type-1" class="input-group-nr hidden" style="display: inline-block;vertical-align: middle;"></div>\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n'})),define("spreadsheeteditor/main/app/view/FormatRulesEditDlg",["text!spreadsheeteditor/main/app/template/FormatRulesEditDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/InputField"],(function(t){"use strict";SSE.Views=SSE.Views||{},SSE.Views.FormatRulesEditDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"FormatRulesEditDlg",contentWidth:490,height:445},initialize:function(e){_.extend(this.options,{title:this.txtTitleNew,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>'].join("")},e),this.api=e.api,this.handler=e.handler,this.isEdit=e.isEdit||!1,this.props=e.props,this.type=e.type,this.subtype=e.subtype,this.percent=e.percent,this.langId=e.langId,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.dataValTypes=[{value:Asc.c_oAscCfvoType.Number,displayValue:this.txtNumber},{value:Asc.c_oAscCfvoType.Percent,displayValue:this.textPercent},{value:Asc.c_oAscCfvoType.Formula,displayValue:this.textFormula},{value:Asc.c_oAscCfvoType.Percentile,displayValue:this.textPercentile}];var e=[{name:Common.define.conditionalData.textValue,type:Asc.c_oAscCFType.cellIs,rules:[{name:Common.define.conditionalData.textGreater,subtype:Asc.c_oAscCFOperator.greaterThan},{name:Common.define.conditionalData.textGreaterEq,subtype:Asc.c_oAscCFOperator.greaterThanOrEqual},{name:Common.define.conditionalData.textLess,subtype:Asc.c_oAscCFOperator.lessThan},{name:Common.define.conditionalData.textLessEq,subtype:Asc.c_oAscCFOperator.lessThanOrEqual},{name:Common.define.conditionalData.textEqual,subtype:Asc.c_oAscCFOperator.equal},{name:Common.define.conditionalData.textNotEqual,subtype:Asc.c_oAscCFOperator.notEqual},{name:Common.define.conditionalData.textBetween,subtype:Asc.c_oAscCFOperator.between},{name:Common.define.conditionalData.textNotBetween,subtype:Asc.c_oAscCFOperator.notBetween}]},{name:Common.define.conditionalData.textTop+"/"+Common.define.conditionalData.textBottom,type:Asc.c_oAscCFType.top10,rules:[{name:Common.define.conditionalData.textTop,subtype:0},{name:Common.define.conditionalData.textBottom,subtype:1}]},{name:Common.define.conditionalData.textAverage,type:Asc.c_oAscCFType.aboveAverage,rules:[{name:Common.define.conditionalData.textAbove,subtype:0},{name:Common.define.conditionalData.textBelow,subtype:1},{name:Common.define.conditionalData.textEqAbove,subtype:2},{name:Common.define.conditionalData.textEqBelow,subtype:3},{name:Common.define.conditionalData.text1Above,subtype:4},{name:Common.define.conditionalData.text1Below,subtype:5},{name:Common.define.conditionalData.text2Above,subtype:6},{name:Common.define.conditionalData.text2Below,subtype:7},{name:Common.define.conditionalData.text3Above,subtype:8},{name:Common.define.conditionalData.text3Below,subtype:9}]},{name:Common.define.conditionalData.textText,type:Asc.c_oAscCFType.containsText,rules:[{name:Common.define.conditionalData.textContains,type:Asc.c_oAscCFType.containsText},{name:Common.define.conditionalData.textNotContains,type:Asc.c_oAscCFType.notContainsText},{name:Common.define.conditionalData.textBegins,type:Asc.c_oAscCFType.beginsWith},{name:Common.define.conditionalData.textEnds,type:Asc.c_oAscCFType.endsWith}]},{name:Common.define.conditionalData.textDate,type:Asc.c_oAscCFType.timePeriod,rules:[{name:Common.define.conditionalData.textYesterday,subtype:Asc.c_oAscTimePeriod.yesterday},{name:Common.define.conditionalData.textToday,subtype:Asc.c_oAscTimePeriod.today},{name:Common.define.conditionalData.textTomorrow,subtype:Asc.c_oAscTimePeriod.tomorrow},{name:Common.define.conditionalData.textLast7days,subtype:Asc.c_oAscTimePeriod.last7Days},{name:Common.define.conditionalData.textLastWeek,subtype:Asc.c_oAscTimePeriod.lastWeek},{name:Common.define.conditionalData.textThisWeek,subtype:Asc.c_oAscTimePeriod.thisWeek},{name:Common.define.conditionalData.textNextWeek,subtype:Asc.c_oAscTimePeriod.nextWeek},{name:Common.define.conditionalData.textLastMonth,subtype:Asc.c_oAscTimePeriod.lastMonth},{name:Common.define.conditionalData.textThisMonth,subtype:Asc.c_oAscTimePeriod.thisMonth},{name:Common.define.conditionalData.textNextMonth,subtype:Asc.c_oAscTimePeriod.nextMonth}]},{name:Common.define.conditionalData.textBlank+"/"+Common.define.conditionalData.textError,type:Asc.c_oAscCFType.containsBlanks,rules:[{name:Common.define.conditionalData.textBlanks,type:Asc.c_oAscCFType.containsBlanks},{name:Common.define.conditionalData.textNotBlanks,type:Asc.c_oAscCFType.notContainsBlanks},{name:Common.define.conditionalData.textErrors,type:Asc.c_oAscCFType.containsErrors},{name:Common.define.conditionalData.textNotErrors,type:Asc.c_oAscCFType.notContainsErrors}]},{name:Common.define.conditionalData.textDuplicate+"/"+Common.define.conditionalData.textUnique,type:Asc.c_oAscCFType.duplicateValues,rules:[{name:Common.define.conditionalData.textDuplicate,type:Asc.c_oAscCFType.duplicateValues},{name:Common.define.conditionalData.textUnique,type:Asc.c_oAscCFType.uniqueValues}]},{name:this.text2Scales,type:Asc.c_oAscCFType.colorScale,num:2},{name:this.text3Scales,type:Asc.c_oAscCFType.colorScale,num:3},{name:Common.define.conditionalData.textDataBar,type:Asc.c_oAscCFType.dataBar},{name:Common.define.conditionalData.textIconSets,type:Asc.c_oAscCFType.iconSet},{name:Common.define.conditionalData.textFormula,type:Asc.c_oAscCFType.expression}],i=[],n=[];_.each(e,(function(t,e){var o=[];t.rules&&_.each(t.rules,(function(t,e){o.push({name:t.name,type:t.type,subtype:t.subtype,allowSelected:!0,selected:!1})}));var s=new Backbone.Collection(o);i.push({name:t.name,type:t.type,rules:s,num:t.num,index:e}),n.push({value:e,displayValue:t.name})})),this.ruleStore=new Backbone.Collection(i),this.cmbCategory=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-category"),style:"width: 150px;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:n,takeFocusOnClose:!0,scrollAlwaysVisible:!1}).on("selected",(function(e,i){t.refreshRules(i.value)})),Common.UI.FocusManager.add(this,this.cmbCategory),this.cmbRule=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-rule"),style:"width: 150px;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[],takeFocusOnClose:!0}).on("selected",(function(e,i){t.setControls(t.cmbCategory.getValue(),i.value)})),Common.UI.FocusManager.add(this,this.cmbRule),this.txtRange1=new Common.UI.InputFieldBtn({el:$("#format-rules-edit-txt-r1"),name:"range",style:"width: 150px;",allowBlank:!0,btnHint:this.textSelectData,validateOnChange:!1}),this.txtRange1.on("button:click",_.bind(this.onSelectData,this)),Common.UI.FocusManager.add(this,this.txtRange1),this.txtRange2=new Common.UI.InputFieldBtn({el:$("#format-rules-edit-txt-r2"),name:"range",style:"width: 150px;",allowBlank:!0,btnHint:this.textSelectData,validateOnChange:!1}),this.txtRange2.on("button:click",_.bind(this.onSelectData,this)),Common.UI.FocusManager.add(this,this.txtRange2),this.cmbPercent=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-percent"),style:"width: 100px;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textItem},{value:1,displayValue:this.textPercent}],takeFocusOnClose:!0}).on("selected",(function(e,i){i.value;t.numRank.setValue(t.numRank.getNumberValue())})),this.cmbPercent.setValue(0),Common.UI.FocusManager.add(this,this.cmbPercent),this.numRank=new Common.UI.MetricSpinner({el:$("#format-rules-edit-spin-rank"),step:1,width:100,defaultUnit:"",defaultValue:10,allowDecimal:!1,value:"10",maxValue:1e12,minValue:-1e12}),this.numRank.on("change",_.bind((function(t,e,i,n){}),this)),Common.UI.FocusManager.add(this,this.numRank),this.CFPresets=this.api.asc_getCFPresets();var o=this.CFPresets[Asc.c_oAscCFRuleTypeSettings.format],s=[],a=_.template(['<a id="<%= id %>" tabindex="-1" type="menuitem" style="padding: 3px 10px;">','<div style="height: 22px;padding: 4px 0;<%= options.styleStr %>"><%= caption %></div>',"</a>"].join(""));_.each(o,(function(t,e){s.push({value:e,presetSettings:{fontColor:t[0],fillColor:t[1],borderColor:t[2],styleObj:{"background-color":t[1]?"#"+t[1]:"#ffffff",color:t[0]?"#"+t[0]:"transparent",border:t[2]?"1px solid #"+t[2]:"","text-align":"center"}},caption:t[0]?Common.define.conditionalData.exampleText:"",template:a,styleStr:"background-color: "+(t[1]?"#"+t[1]:"#ffffff")+";color:"+(t[0]?"#"+t[0]:"transparent")+";"+(t[2]?"border: 1px solid #"+t[2]+";":"text-align: center;")})})),this.btnFormats=new Common.UI.Button({parentEl:$("#format-rules-format-preset"),cls:"btn-text-menu-default",caption:this.textPresets,style:"width: 150px;",menu:new Common.UI.Menu({style:"min-width: 150px;",maxHeight:211,additionalAlign:this.menuAddAlign,items:s})}),this.btnFormats.menu.on("item:click",_.bind(this.onFormatsSelect,this)),this.btnBold=new Common.UI.Button({parentEl:$("#format-rules-bold"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0,hint:this.textBold}),this.btnBold.on("click",_.bind(this.onBoldClick,this)),this.btnItalic=new Common.UI.Button({parentEl:$("#format-rules-italic"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0,hint:this.textItalic}),this.btnItalic.on("click",_.bind(this.onItalicClick,this)),this.btnUnderline=new Common.UI.Button({parentEl:$("#format-rules-underline"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",enableToggle:!0,hint:this.textUnderline}),this.btnUnderline.on("click",_.bind(this.onUnderlineClick,this)),this.btnStrikeout=new Common.UI.Button({parentEl:$("#format-rules-strikeout"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",enableToggle:!0,hint:this.textStrikeout}),this.btnStrikeout.on("click",_.bind(this.onStrikeoutClick,this));var l,r=function(t){t.setMenu(),t.currentColor="000000";var e=t.getPicker();return e.currentColor=t.currentColor,e};if(this.btnTextColor=new Common.UI.ButtonColored({parentEl:$("#format-rules-fontcolor"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",hint:this.textColor,additionalAlign:this.menuAddAlign,color:"000000",menu:!0}),this.mnuTextColorPicker=r(this.btnTextColor),this.btnTextColor.on("color:select",_.bind(this.onFormatTextColorSelect,this)),this.btnFillColor=new Common.UI.ButtonColored({parentEl:$("#format-rules-fillcolor"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-paracolor",hint:this.fillColor,additionalAlign:this.menuAddAlign,color:"000000",transparent:!0,menu:!0}),this.mnuFillColorPicker=r(this.btnFillColor),this.btnFillColor.on("color:select",_.bind(this.onFormatFillColorSelect,this)),this.btnBorders=new Common.UI.Button({parentEl:$("#format-rules-borders"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-border-out",hint:this.tipBorders,icls:"btn-border-out",borderId:"outer",borderswidth:Asc.c_oAscBorderStyles.Thin,split:!0,menu:new Common.UI.Menu({items:[{caption:this.textOutBorders,iconCls:"menu__icon btn-border-out",icls:"btn-border-out",borderId:"outer"},{caption:this.textAllBorders,iconCls:"menu__icon btn-border-all",icls:"btn-border-all",borderId:"all"},{caption:this.textTopBorders,iconCls:"menu__icon btn-border-top",icls:"btn-border-top",borderId:Asc.c_oAscBorderOptions.Top},{caption:this.textBottomBorders,iconCls:"menu__icon btn-border-bottom",icls:"btn-border-bottom",borderId:Asc.c_oAscBorderOptions.Bottom},{caption:this.textLeftBorders,iconCls:"menu__icon btn-border-left",icls:"btn-border-left",borderId:Asc.c_oAscBorderOptions.Left},{caption:this.textRightBorders,iconCls:"menu__icon btn-border-right",icls:"btn-border-right",borderId:Asc.c_oAscBorderOptions.Right},{caption:this.textNoBorders,iconCls:"menu__icon btn-border-no",icls:"btn-border-no",borderId:"none"},{caption:"--"},{caption:this.textInsideBorders,iconCls:"menu__icon btn-border-inside",icls:"btn-border-center",borderId:"inner"},{caption:this.textCenterBorders,iconCls:"menu__icon btn-border-insidevert",icls:"btn-border-vmiddle",borderId:Asc.c_oAscBorderOptions.InnerV},{caption:this.textMiddleBorders,iconCls:"menu__icon btn-border-insidehor",icls:"btn-border-hmiddle",borderId:Asc.c_oAscBorderOptions.InnerH},{caption:this.textDiagUpBorder,iconCls:"menu__icon btn-border-diagup",icls:"btn-border-diagup",borderId:Asc.c_oAscBorderOptions.DiagU},{caption:this.textDiagDownBorder,iconCls:"menu__icon btn-border-diagdown",icls:"btn-border-diagdown",borderId:Asc.c_oAscBorderOptions.DiagD},{caption:"--"},{id:"format-rules-borders-border-width",caption:this.textBordersStyle,iconCls:"menu__icon btn-border-style",menu:(l=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div class="border-size-item" style="background-position: 0 -<%= options.offsety %>px;"></div></a>'),t.mnuBorderWidth=new Common.UI.Menu({style:"min-width: 100px;",menuAlign:"tl-tr",items:[{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Thin,offsety:0,checked:!0},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Hair,offsety:20},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Dotted,offsety:40},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Dashed,offsety:60},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.DashDot,offsety:80},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.DashDotDot,offsety:100},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Medium,offsety:120},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashed,offsety:140},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashDot,offsety:160},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashDotDot,offsety:180},{template:l,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Thick,offsety:200}]}),t.mnuBorderWidth)},this.mnuBorderColor=new Common.UI.MenuItem({id:"format-rules-borders-border-color",caption:this.textBordersColor,iconCls:"mnu-icon-item mnu-border-color",template:_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><span class="menu-item-icon" style="background-image: none; width: 12px; height: 12px; margin: 2px 9px 0 -11px; border-style: solid; border-width: 3px; border-color: #000;"></span><%= caption %></a>'),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="format-rules-borders-menu-bordercolor" style="width: 164px; display: inline-block;"></div>'),stopPropagation:!0},{caption:"--"},{id:"format-rules-borders-menu-new-bordercolor",template:_.template('<a tabindex="-1" type="menuitem" style="padding-left:12px;">'+this.textNewColor+"</a>"),stopPropagation:!0}]})})]})}),this.btnBorders.menu.on("item:click",_.bind(this.onBordersMenu,this)),this.btnBorders.on("click",_.bind(this.onBorders,this)),this.mnuBorderColorPicker=new Common.UI.ThemeColorPalette({el:$("#format-rules-borders-menu-bordercolor"),outerMenu:{menu:this.mnuBorderColor.menu,index:0,focusOnShow:!0}}),this.mnuBorderColor.menu.setInnerMenu([{menu:this.mnuBorderColorPicker,index:0}]),this.mnuBorderColorPicker.on("select",_.bind(this.onBordersColor,this)),$("#format-rules-borders-menu-new-bordercolor").on("click",_.bind((function(){t.mnuBorderColorPicker.addNewColor()}),this)),this.mnuBorderWidth.on("item:toggle",_.bind(this.onBordersWidth,this)),this.ascFormatOptions={General:"General",Number:"0.00",Currency:"$#,##0.00",Accounting:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',DateShort:"m/d/yyyy",DateLong:"[$-F800]dddd, mmmm dd, yyyy",Time:"[$-F400]h:mm:ss AM/PM",Percentage:"0.00%",Percent:"0%",Fraction:"# ?/?",Scientific:"0.00E+00",Text:"@"},this.numFormatData=[{value:Asc.c_oAscNumFormatType.General,format:this.ascFormatOptions.General,displayValue:this.txtGeneral,exampleval:"100"},{value:Asc.c_oAscNumFormatType.Number,format:this.ascFormatOptions.Number,displayValue:this.txtNumber,exampleval:"100,00"},{value:Asc.c_oAscNumFormatType.Scientific,format:this.ascFormatOptions.Scientific,displayValue:this.txtScientific,exampleval:"1,00E+02"},{value:Asc.c_oAscNumFormatType.Accounting,format:this.ascFormatOptions.Accounting,displayValue:this.txtAccounting,exampleval:"100,00 $"},{value:Asc.c_oAscNumFormatType.Currency,format:this.ascFormatOptions.Currency,displayValue:this.txtCurrency,exampleval:"100,00 $"},{value:Asc.c_oAscNumFormatType.Date,format:"MM-dd-yyyy",displayValue:this.txtDate,exampleval:"04-09-1900"},{value:Asc.c_oAscNumFormatType.Time,format:"HH:MM:ss",displayValue:this.txtTime,exampleval:"00:00:00"},{value:Asc.c_oAscNumFormatType.Percent,format:this.ascFormatOptions.Percentage,displayValue:this.txtPercentage,exampleval:"100,00%"},{value:Asc.c_oAscNumFormatType.Fraction,format:this.ascFormatOptions.Fraction,displayValue:this.txtFraction,exampleval:"100"},{value:Asc.c_oAscNumFormatType.Text,format:this.ascFormatOptions.Text,displayValue:this.txtText,exampleval:"100"}],this.api){var c=new Asc.asc_CFormatCellsInfo;c.asc_setType(Asc.c_oAscNumFormatType.None),c.asc_setSymbol(this.langId);var d=this.api.asc_getFormatCells(c);this.numFormatData.forEach((function(e,i){e.format=d[i],e.exampleval=t.api.asc_getLocaleExample(e.format,100)}))}var h=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="position: relative;"><div style="position: absolute; left: 0; width: 100px;"><%= scope.getDisplayValue(item) %></div>','<div style="display: inline-block; width: 100%; max-width: 300px; overflow: hidden; text-overflow: ellipsis; text-align: right; vertical-align: bottom; padding-left: 100px; color: silver;white-space: nowrap;"><%= item.exampleval ? item.exampleval : "" %></div>',"</div></a></li>","<% }); %>"].join(""));this.cmbNumberFormat=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-num-format"),cls:"input-group-nr",style:"width: 113px;",menuStyle:"min-width: 100%;max-height: 211px;",hint:this.tipNumFormat,itemsTemplate:h,editable:!1,data:this.numFormatData,takeFocusOnClose:!0}),this.cmbNumberFormat.setValue(Asc.c_oAscNumFormatType.General),this.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),Common.UI.FocusManager.add(this,this.cmbNumberFormat),this.btnClear=new Common.UI.Button({el:$("#format-rules-edit-btn-clear")}),this.btnClear.on("click",_.bind(this.clearFormat,this)),this.panels={format:{el:this.$window.find(".hasformat"),rendered:!1,initColors:!1},scale:{el:this.$window.find(".scale"),rendered:!1,initColors:!1},databar:{el:this.$window.find(".databar"),rendered:!1,initColors:!1},iconset:{el:this.$window.find(".iconset"),rendered:!1,initColors:!1}},this.panels.format.rendered=!0,this.afterRender()},addNewIconsLine:function(){var t=this,e=this.iconsControls.length;this.iconsControls.push({});var i=new Common.UI.ComboBox({el:$("#format-rules-combo-icon-"+(e+1)),type:e,template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle"  data-toggle="dropdown">','<div class="form-control image" style="display: block;width: 85px;">','<div style="display: inline-block;overflow: hidden;width: 100%;height: 100%;padding-top: 2px;background-repeat: no-repeat; background-position: 27px center;white-space:nowrap;"></div>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default"><span class="caret"></span></button>',"</div>"].join(""))}),n=new Common.UI.Menu({style:"min-width: 105px;",additionalAlign:this.menuAddAlign,items:[{caption:this.txtNoCellIcon,checkable:!0,allowDepress:!1,toggleGroup:"no-cell-icons-"+(e+1)},{template:_.template('<div id="format-rules-combo-menu-icon-'+(e+1)+'" style="width: 217px; margin: 0 5px;"></div>')}]}).render($("#format-rules-combo-icon-"+(e+1))),o=new Common.UI.DataView({el:$("#format-rules-combo-menu-icon-"+(e+1)),parentMenu:n,outerMenu:{menu:n,index:1},store:new Common.UI.DataViewStore(t.iconsList),itemTemplate:_.template('<img id="<%= id %>" class="item-icon" src="<%= imgUrl %>" style="width: 16px; height: 16px;">'),type:e});o.on("item:click",_.bind(this.onSelectIcon,this,i,n.items[0])),n.setInnerMenu([{menu:o,index:1}]),n.items[0].on("toggle",_.bind(this.onSelectNoIcon,this,i,o)),this.iconsControls[e].cmbIcons=i,this.iconsControls[e].pickerIcons=o,this.iconsControls[e].itemNoIcons=n.items[0],(i=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-op-"+(e+1)),style:"width: 55px;",menuStyle:"min-width: 100%;",editable:!1,cls:"input-group-nr",data:[{value:!0,displayValue:">=",prevOp:"<"},{value:!1,displayValue:">",prevOp:"<="}],type:e,takeFocusOnClose:!0}).on("selected",(function(e,i){t.fillIconsLabels()}))).setValue(1),this.iconsControls[e].cmbOperator=i,Common.UI.FocusManager.add(this,i);var s=new Common.UI.InputFieldBtn({el:$("#format-rules-edit-txt-value-"+(e+1)),name:"range",style:"width: 100px;",allowBlank:!0,btnHint:this.textSelectData,validateOnChange:!1,type:e}).on("changed:after",(function(e,i,n,o){t.fillIconsLabels()}));s.setValue(""),this.iconsControls[e].value=s,s.on("button:click",_.bind(this.onSelectData,this)),Common.UI.FocusManager.add(this,s),(i=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-type-"+(e+1)),style:"width: 80px;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:this.dataValTypes,type:e,takeFocusOnClose:!0}).on("selected",(function(t,e){}))).setValue(Asc.c_oAscCfvoType.Percent),this.iconsControls[e].cmbType=i,Common.UI.FocusManager.add(this,i),this.iconsControls[e].label=$("#format-rules-txt-icon-"+(e+1))},renderIconsPanel:function(){if(!this.panels.iconset.rendered){var t=this;this.collectionPresets=SSE.getCollection("ConditionalFormatIconsPresets"),this.collectionPresets.length<1&&SSE.getController("Main").fillCondFormatIconsPresets(this.api.asc_getCFIconsByType()),this.collectionIcons=SSE.getCollection("ConditionalFormatIcons"),this.collectionIcons.length<1&&SSE.getController("Main").fillCondFormatIcons(this.api.asc_getFullCFIcons()),this.iconsList=[],t.collectionIcons.each((function(e,i){t.iconsList.push({value:e.get("index"),imgUrl:e.get("icon")})}));var e=[],i=this.collectionPresets.length,n=this.CFPresets[Asc.c_oAscCFRuleTypeSettings.icons];_.each(n,(function(n,o){if(!(o>=i)){for(var s=[],a=0;a<n.length;a++){var l=new Asc.asc_CConditionalFormatValueObject;l.asc_setType(n[a][0]),l.asc_setVal(n[a][1]),n[a][2],s.push(l)}e.push({value:o,data:{iconSet:t.collectionPresets.at(o).get("icons"),values:s,icons:t.collectionIcons}})}})),this.cmbIconsPresets=new Common.UI.ComboBoxIcons({el:$("#format-rules-icon-style"),editable:!1,style:"width: 120px;",menuStyle:"max-height: 220px;min-width: 100%;",data:e}).on("selected",(function(e,i){t.fillIconsControls(i.value,i.data.values),_.delay((function(){t.iconsControls[t.iconsControls.length-1].cmbOperator.focus()}),50)})),this.cmbIconsPresets.setValue(3),this.iconsProps={iconsSet:3},this.chIconShow=new Common.UI.CheckBox({el:$("#format-rules-edit-chk-icon-show"),labelText:this.textShowIcon}),this.chIconShow.on("change",(function(t,e,i,n){})),Common.UI.FocusManager.add(this,this.chIconShow),this.btnReverse=new Common.UI.Button({el:$("#format-rules-edit-btn-icon-reverse")}),this.btnReverse.on("click",(function(){t.iconsProps.isReverse=!t.iconsProps.isReverse,t.reverseIconsControls()})),this.iconsControls=[];for(var o=0;o<3;o++)this.addNewIconsLine();var s=this.cmbIconsPresets.getSelectedRecord();s&&this.fillIconsControls(s.value,s.data.values),this.panels.iconset.rendered=!0}},renderDataBarPanel:function(){if(!this.panels.databar.rendered){var t=this;this.barControls=[];for(var e=0;e<2;e++){var i=this.dataValTypes;0==e?(i=[{value:Asc.c_oAscCfvoType.Minimum,displayValue:this.textMinimum}].concat(i)).push({value:Asc.c_oAscCfvoType.AutoMin,displayValue:this.textAutomatic}):(i=[{value:Asc.c_oAscCfvoType.Maximum,displayValue:this.textMaximum}].concat(i)).push({value:Asc.c_oAscCfvoType.AutoMax,displayValue:this.textAutomatic});var n=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-bar-"+(e+1)),style:"width: 100%;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:i,type:e,takeFocusOnClose:!0}).on("selected",(function(e,i){t.barControls[e.options.type].range.setDisabled(i.value==Asc.c_oAscCfvoType.Minimum||i.value==Asc.c_oAscCfvoType.Maximum||i.value==Asc.c_oAscCfvoType.AutoMin||i.value==Asc.c_oAscCfvoType.AutoMax),t.setDefComboValue(e.options.type,i.value,t.barControls[e.options.type].range)})),o=0==e?Asc.c_oAscCfvoType.AutoMin:Asc.c_oAscCfvoType.AutoMax;n.setValue(o),Common.UI.FocusManager.add(this,n);var s=new Common.UI.InputFieldBtn({el:$("#format-rules-edit-txt-bar-"+(e+1)),name:"range",style:"width: 100%;",allowBlank:!0,btnHint:this.textSelectData,validateOnChange:!1,type:e,disabled:o==Asc.c_oAscCfvoType.AutoMin||o==Asc.c_oAscCfvoType.AutoMax||o==Asc.c_oAscCfvoType.Minimum||o==Asc.c_oAscCfvoType.Maximum});t.setDefComboValue(e,o,s),s.on("button:click",_.bind(this.onSelectData,this)),this.barControls.push({combo:n,range:s}),Common.UI.FocusManager.add(this,s)}this.cmbFill=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-fill"),style:"width: 100%;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[{value:!1,displayValue:this.textSolid},{value:!0,displayValue:this.textGradient}],takeFocusOnClose:!0}).on("selected",(function(e,i){t.barProps&&(t.barProps.asc_setGradient(i.value),t.previewFormat())})),this.cmbFill.setValue(!1),Common.UI.FocusManager.add(this,this.cmbFill),this.btnPosFill=new Common.UI.ColorButton({parentEl:$("#format-rules-edit-color-pos-fill"),style:"width:45px;",menu:!0,color:"638EC6",cls:"move-focus",takeFocusOnClose:!0}),Common.UI.FocusManager.add(this,this.btnPosFill),this.btnNegFill=new Common.UI.ColorButton({parentEl:$("#format-rules-edit-color-neg-fill"),style:"width:45px;",menu:!0,color:"FF0000",cls:"move-focus",takeFocusOnClose:!0}),Common.UI.FocusManager.add(this,this.btnNegFill),this.chFill=new Common.UI.CheckBox({el:$("#format-rules-edit-chk-fill"),labelText:this.textSameAs}),this.chFill.on("change",(function(e,i,n,o){t.btnNegFill.setDisabled("checked"==e.getValue())})),Common.UI.FocusManager.add(this,this.chFill),this.cmbBorder=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-border"),style:"width: 100%;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[{value:!1,displayValue:this.textSolid},{value:!0,displayValue:this.textNone}],takeFocusOnClose:!0}).on("selected",(function(e,i){var n=!i.value;t.btnPosBorder.setDisabled(!n),t.btnNegBorder.setDisabled(!n||"checked"==t.chBorder.getValue()),t.chBorder.setDisabled(!n),t.barProps&&(n?t.barProps.asc_setBorderColor(Common.Utils.ThemeColor.getRgbColor(t.btnPosBorder.colorPicker.currentColor)):t.barProps.asc_setBorderColor(null),t.previewFormat())})),this.cmbBorder.setValue(!1),Common.UI.FocusManager.add(this,this.cmbBorder),this.btnPosBorder=new Common.UI.ColorButton({parentEl:$("#format-rules-edit-color-pos-border"),style:"width:45px;",menu:!0,color:"000000",cls:"move-focus",takeFocusOnClose:!0}),Common.UI.FocusManager.add(this,this.btnPosBorder),this.btnNegBorder=new Common.UI.ColorButton({parentEl:$("#format-rules-edit-color-neg-border"),style:"width:45px;",menu:!0,color:"000000",cls:"move-focus",takeFocusOnClose:!0}),Common.UI.FocusManager.add(this,this.btnNegBorder),this.chBorder=new Common.UI.CheckBox({el:$("#format-rules-edit-chk-border"),labelText:this.textSameAs}),this.chBorder.on("change",(function(e,i,n,o){t.btnNegBorder.setDisabled("checked"==e.getValue())})),Common.UI.FocusManager.add(this,this.chBorder),this.cmbBarDirection=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-direction"),style:"width: 100%;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscDataBarDirection.context,displayValue:this.textContext},{value:Asc.c_oAscDataBarDirection.leftToRight,displayValue:this.textLeft2Right},{value:Asc.c_oAscDataBarDirection.rightToLeft,displayValue:this.textRight2Left}],takeFocusOnClose:!0}).on("selected",(function(e,i){t.barProps&&(t.barProps.asc_setDirection(i.value),t.previewFormat())})),this.cmbBarDirection.setValue(Asc.c_oAscDataBarDirection.context),Common.UI.FocusManager.add(this,this.cmbBarDirection),this.chShowBar=new Common.UI.CheckBox({el:$("#format-rules-edit-chk-show-bar"),labelText:this.textShowBar}),Common.UI.FocusManager.add(this,this.chShowBar),this.cmbAxisPos=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-axis-pos"),style:"width: 150px;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscDataBarAxisPosition.automatic,displayValue:this.textAutomatic},{value:Asc.c_oAscDataBarAxisPosition.middle,displayValue:this.textCellMidpoint},{value:Asc.c_oAscDataBarAxisPosition.none,displayValue:this.textNone}],takeFocusOnClose:!0}).on("selected",(function(e,i){t.btnAxisColor.setDisabled(i.value==Asc.c_oAscDataBarAxisPosition.none)})),this.cmbAxisPos.setValue(Asc.c_oAscDataBarDirection.context),Common.UI.FocusManager.add(this,this.cmbAxisPos),this.btnAxisColor=new Common.UI.ColorButton({parentEl:$("#format-rules-edit-color-axis-color"),style:"width:45px;",menu:!0,color:"000000",cls:"move-focus",takeFocusOnClose:!0}),Common.UI.FocusManager.add(this,this.btnAxisColor),this.panels.databar.rendered=!0,this.updateThemeColors()}},renderScalesPanel:function(){if(!this.panels.scale.rendered){var t=this;this.scaleControls=[],this.lblMidScale=this.$window.find("#format-rules-edit-lbl-scale-2");for(var e=0;e<3;e++){var i=this.dataValTypes;0==e?i=[{value:Asc.c_oAscCfvoType.Minimum,displayValue:this.textMinimum}].concat(i):2==e&&(i=[{value:Asc.c_oAscCfvoType.Maximum,displayValue:this.textMaximum}].concat(i));var n=new Common.UI.ComboBox({el:$("#format-rules-edit-combo-scale-"+(e+1)),style:"width: 100%;",menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:i,type:e,takeFocusOnClose:!0}).on("selected",(function(e,i){t.scaleControls[e.options.type].range.setDisabled(i.value==Asc.c_oAscCfvoType.Minimum||i.value==Asc.c_oAscCfvoType.Maximum),t.setDefComboValue(e.options.type,i.value,t.scaleControls[e.options.type].range)}));n.setValue(1==e?Asc.c_oAscCfvoType.Percentile:i[0].value),Common.UI.FocusManager.add(this,n);var o=new Common.UI.InputFieldBtn({el:$("#format-rules-edit-txt-scale-"+(e+1)),name:"range",style:"width: 100%;",allowBlank:!0,btnHint:this.textSelectData,validateOnChange:!1,type:e,disabled:1!=e});o.setValue(1==e?50:""),o.on("button:click",_.bind(this.onSelectData,this)),Common.UI.FocusManager.add(this,o);var s=new Common.UI.ColorButton({parentEl:$("#format-rules-edit-color-scale-"+(e+1)),menu:!0,type:e,color:"000000",cls:"move-focus",takeFocusOnClose:!0});Common.UI.FocusManager.add(this,s),this.scaleControls.push({combo:n,range:o,color:s})}this.panels.scale.rendered=!0,this.updateThemeColors()}},afterRender:function(){this.updateThemeColors(),this._setDefaults(this.props),this.setTitle(this.isEdit?this.txtTitleEdit:this.txtTitleNew)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){this._originalProps=t;var e,i,n=t?t.asc_getType():this.type,o=this.subtype,s=!!this.percent;if(t)switch(n){case Asc.c_oAscCFType.containsText:case Asc.c_oAscCFType.notContainsText:case Asc.c_oAscCFType.beginsWith:case Asc.c_oAscCFType.endsWith:i=t.asc_getContainsText(),this.txtRange1.setValue(i||"");break;case Asc.c_oAscCFType.timePeriod:o=t.asc_getTimePeriod();break;case Asc.c_oAscCFType.aboveAverage:var a=t.asc_getAboveAverage(),l=t.asc_getEqualAverage(),r=t.asc_getStdDev();o=a?0:1,l?o+=2:r&&(o+=2+2*r);break;case Asc.c_oAscCFType.top10:o=t.asc_getBottom()?1:0,s=t.asc_getPercent(),this.numRank.setValue(t.asc_getRank()?t.asc_getRank():10);break;case Asc.c_oAscCFType.cellIs:o=t.asc_getOperator(),this.txtRange1.setValue(t.asc_getValue1()||""),this.txtRange2.setValue(t.asc_getValue2()||"");break;case Asc.c_oAscCFType.expression:this.txtRange1.setValue(t.asc_getValue1()||"");break;case Asc.c_oAscCFType.colorScale:this.renderScalesPanel();var c=(i=t.asc_getColorScaleOrDataBarOrIconSetRule()).asc_getCFVOs(),d=i.asc_getColors();o=c.length;for(var h=2==c.length?[this.scaleControls[0],this.scaleControls[2]]:this.scaleControls,p=0;p<c.length;p++){var m=c[p].asc_getType(),u=c[p].asc_getVal(),g=d[p];(b=h[p]).combo.setValue(m),b.range.setDisabled(m==Asc.c_oAscCfvoType.Minimum||m==Asc.c_oAscCfvoType.Maximum),b.range.setValue(m!==Asc.c_oAscCfvoType.Minimum&&m!==Asc.c_oAscCfvoType.Maximum&&null!=u?u:""),this.setColor(g,b.color)}break;case Asc.c_oAscCFType.dataBar:this.renderDataBarPanel();var f=(i=t.asc_getColorScaleOrDataBarOrIconSetRule()).asc_getCFVOs();for(h=this.barControls,p=0;p<f.length;p++){var b,C=f[p].asc_getType();u=f[p].asc_getVal();(b=h[p]).combo.setValue(C),b.range.setDisabled(C==Asc.c_oAscCfvoType.Minimum||C==Asc.c_oAscCfvoType.Maximum||C==Asc.c_oAscCfvoType.AutoMin||C==Asc.c_oAscCfvoType.AutoMax),b.range.setValue(C!==Asc.c_oAscCfvoType.Minimum&&C!==Asc.c_oAscCfvoType.Maximum&&C!==Asc.c_oAscCfvoType.AutoMin&&C!==Asc.c_oAscCfvoType.AutoMax&&null!=u?u:"")}this.cmbFill.setValue(i.asc_getGradient()),this.setColor(i.asc_getColor(),this.btnPosFill),this.setColor(i.asc_getNegativeColor()||i.asc_getColor(),this.btnNegFill),this.chFill.setValue(i.asc_getNegativeBarColorSameAsPositive());g=i.asc_getBorderColor();this.cmbBorder.setValue(null===g),this.btnPosBorder.setDisabled(null===g),g&&(this.setColor(i.asc_getBorderColor(),this.btnPosBorder),this.setColor(i.asc_getNegativeBorderColor()||i.asc_getBorderColor(),this.btnNegBorder)),this.chBorder.setValue(i.asc_getNegativeBarBorderColorSameAsPositive()),this.chBorder.setDisabled(null===g),this.btnNegBorder.setDisabled(null===g||i.asc_getNegativeBarBorderColorSameAsPositive()),this.cmbBarDirection.setValue(i.asc_getDirection()),this.chShowBar.setValue(!i.asc_getShowValue()),this.cmbAxisPos.setValue(i.asc_getAxisPosition()),i.asc_getAxisColor()&&this.setColor(i.asc_getAxisColor(),this.btnAxisColor),this.btnAxisColor.setDisabled(i.asc_getAxisPosition()==Asc.c_oAscDataBarAxisPosition.none);break;case Asc.c_oAscCFType.iconSet:this.renderIconsPanel(),i=t.asc_getColorScaleOrDataBarOrIconSetRule(),this.chIconShow.setValue(!i.asc_getShowValue()),this.iconsProps.isReverse=i.asc_getReverse(),this.fillIconsControls(i.asc_getIconSet(),i.asc_getCFVOs(),i.asc_getIconSets())}n!==Asc.c_oAscCFType.containsText&&n!==Asc.c_oAscCFType.notContainsText&&n!==Asc.c_oAscCFType.beginsWith&&n!==Asc.c_oAscCFType.endsWith&&n!==Asc.c_oAscCFType.containsBlanks&&n!==Asc.c_oAscCFType.notContainsBlanks&&n!==Asc.c_oAscCFType.duplicateValues&&n!==Asc.c_oAscCFType.uniqueValues&&n!==Asc.c_oAscCFType.containsErrors&&n!==Asc.c_oAscCFType.notContainsErrors&&n!==Asc.c_oAscCFType.timePeriod&&n!==Asc.c_oAscCFType.aboveAverage&&n!==Asc.c_oAscCFType.top10&&n!==Asc.c_oAscCFType.cellIs&&n!==Asc.c_oAscCFType.expression||(t?this.xfsFormat=t.asc_getDxf():this.onFormatsSelect(this.btnFormats.menu,this.btnFormats.menu.items[0]));var v=this.ruleStore.where({type:n});if(v.length>1)n==Asc.c_oAscCFType.colorScale&&(v=o==v[0].get("num")?v[0]:v[1]);else if(0==v.length){var _=this.ruleStore;for(p=0;p<_.length;p++){var x=_.at(p);if((y=x.get("rules"))&&y.findWhere({type:n})){v=x,e=n;break}}}else{var y;(y=(v=v[0]).get("rules"))&&y.findWhere({type:n})?e=n:void 0!==o&&y&&y.findWhere({subtype:o})&&(e=o)}v||(v=this.ruleStore.at(0)),v&&(this.cmbCategory.setValue(v.get("index")),this.refreshRules(v.get("index"),e),n===Asc.c_oAscCFType.top10&&this.cmbPercent.setValue(s?1:0));var w=this.xfsFormat?this.xfsFormat:new Asc.asc_CellXfs;this.fillXfsFormatInfo(w),this.previewFormat()},setColor:function(t,e,i){if(i=e?e.colorPicker:i,t=t&&!t.get_auto()?t.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()),effectValue:t.get_value()}:Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()):i.options.transparent?"transparent":"000000",e&&e.setColor(t),_.isObject(t)){for(var n=!1,o=0;o<10;o++)if(Common.Utils.ThemeColor.ThemeValues[o]==t.effectValue){i.select(t,!0),n=!0;break}n||i.clearSelection()}else i.select(t,!0);return i&&(i.currentColor=t),e&&(e.currentColor=t),t},fillXfsFormatInfo:function(t){if(t){this.btnBold.toggle(!0===t.asc_getFontBold(),!0),this.btnItalic.toggle(!0===t.asc_getFontItalic(),!0),this.btnUnderline.toggle(!0===t.asc_getFontUnderline(),!0),this.btnStrikeout.toggle(!0===t.asc_getFontStrikeout(),!0);this.setColor(t.asc_getFontColor(),this.btnTextColor,this.mnuTextColorPicker);this.setColor(t.asc_getFillColor(),this.btnFillColor,this.mnuFillColorPicker);var e=t.asc_getNumFormatInfo();e&&this.cmbNumberFormat.setValue(e.asc_getType(),this.textCustom)}},getSettings:function(){var t,e=this.ruleStore.findWhere({index:this.cmbCategory.getValue()});if(e){t=this._originalProps||new Asc.asc_CConditionalFormattingRule;var i=e.get("type"),n=i!==t.asc_getType();switch(t.asc_setType(i),i!=Asc.c_oAscCFType.containsText&&i!=Asc.c_oAscCFType.containsBlanks&&i!=Asc.c_oAscCFType.duplicateValues&&i!=Asc.c_oAscCFType.timePeriod&&i!=Asc.c_oAscCFType.aboveAverage&&i!=Asc.c_oAscCFType.top10&&i!=Asc.c_oAscCFType.cellIs&&i!=Asc.c_oAscCFType.expression||(this.xfsFormat||null===this.xfsFormat)&&t.asc_setDxf(this.xfsFormat),i){case Asc.c_oAscCFType.containsText:(w=this.txtRange1.getValue())&&t.asc_setContainsText(w),t.asc_setType(this.cmbRule.getValue());break;case Asc.c_oAscCFType.containsBlanks:case Asc.c_oAscCFType.duplicateValues:t.asc_setType(this.cmbRule.getValue());break;case Asc.c_oAscCFType.timePeriod:t.asc_setTimePeriod(this.cmbRule.getValue());break;case Asc.c_oAscCFType.aboveAverage:var o=this.cmbRule.getValue(),s=!(o%2);t.asc_setAboveAverage(s),t.asc_setEqualAverage(2==o||3==o),t.asc_setStdDev(o>3?Math.floor(o/2)-1:0);break;case Asc.c_oAscCFType.top10:t.asc_setBottom(!!this.cmbRule.getValue()),t.asc_setPercent(!!this.cmbPercent.getValue()),""!==this.numRank.getValue()&&t.asc_setRank(this.numRank.getNumberValue());break;case Asc.c_oAscCFType.cellIs:t.asc_setOperator(this.cmbRule.getValue()),t.asc_setValue1(this.txtRange1.getValue()),this.txtRange2.isVisible()&&t.asc_setValue2(this.txtRange2.getValue());break;case Asc.c_oAscCFType.expression:t.asc_setValue1(this.txtRange1.getValue());break;case Asc.c_oAscCFType.colorScale:for(var a=n?new Asc.asc_CColorScale:t.asc_getColorScaleOrDataBarOrIconSetRule(),l=e.get("num"),r=2==l?[this.scaleControls[0],this.scaleControls[2]]:this.scaleControls,c=[],d=[],h=0;h<l;h++){var p=new Asc.asc_CConditionalFormatValueObject,m=r[h];p.asc_setType(m.combo.getValue()),p.asc_setVal(m.range.getValue()),d.push(p),c.push(Common.Utils.ThemeColor.getRgbColor(m.colorPicker.currentColor))}a.asc_setColors(c),a.asc_setCFVOs(d),t.asc_setColorScaleOrDataBarOrIconSetRule(a);break;case Asc.c_oAscCFType.dataBar:var u=n?new Asc.asc_CDataBar:t.asc_getColorScaleOrDataBarOrIconSetRule();n&&u.asc_setInterfaceDefault();r=this.barControls;var g=[];for(h=0;h<r.length;h++){var f=new Asc.asc_CConditionalFormatValueObject,b=(m=r[h]).combo.getValue();f.asc_setType(b),b!==Asc.c_oAscCfvoType.Minimum&&b!==Asc.c_oAscCfvoType.Maximum&&b!==Asc.c_oAscCfvoType.AutoMin&&b!==Asc.c_oAscCfvoType.AutoMax&&f.asc_setVal(m.range.getValue()),g.push(f)}u.asc_setCFVOs(g),u.asc_setGradient(this.cmbFill.getValue()),u.asc_setColor(Common.Utils.ThemeColor.getRgbColor(this.btnPosFill.colorPicker.currentColor)),u.asc_setNegativeColor(Common.Utils.ThemeColor.getRgbColor("checked"==this.chFill.getValue()?this.btnPosFill.colorPicker.currentColor:this.btnNegFill.colorPicker.currentColor)),u.asc_setNegativeBarColorSameAsPositive("checked"==this.chFill.getValue()),!this.cmbBorder.getValue()?(u.asc_setBorderColor(Common.Utils.ThemeColor.getRgbColor(this.btnPosBorder.colorPicker.currentColor)),u.asc_setNegativeBorderColor(Common.Utils.ThemeColor.getRgbColor("checked"==this.chBorder.getValue()?this.btnPosBorder.colorPicker.currentColor:this.btnNegBorder.colorPicker.currentColor)),u.asc_setNegativeBarBorderColorSameAsPositive("checked"==this.chBorder.getValue())):(u.asc_setBorderColor(null),u.asc_setNegativeBorderColor(null)),u.asc_setDirection(this.cmbBarDirection.getValue()),u.asc_setShowValue("checked"!==this.chShowBar.getValue());var C=this.cmbAxisPos.getValue();u.asc_setAxisPosition(C),C!==Asc.c_oAscDataBarAxisPosition.none?u.asc_setAxisColor(Common.Utils.ThemeColor.getRgbColor(this.btnAxisColor.colorPicker.currentColor)):u.asc_setAxisColor(null),t.asc_setColorScaleOrDataBarOrIconSetRule(u);break;case Asc.c_oAscCFType.iconSet:var v=n?new Asc.asc_CIconSet:t.asc_getColorScaleOrDataBarOrIconSetRule();v.asc_setShowValue("checked"!==this.chIconShow.getValue()),v.asc_setReverse(!!this.iconsProps.isReverse),v.asc_setIconSet(this.iconsProps.iconsSet);r=this.iconsControls;var _=this.iconsProps.iconsLength,x=this.cmbIconsPresets.getSelectedRecord()?null:[],y=[];for(h=0;h<_;h++){var w;m=r[h];if((w=new Asc.asc_CConditionalFormatValueObject).asc_setType(m.cmbType.getValue()),w.asc_setVal(m.value.getValue()),w.asc_setGte(m.cmbOperator.getValue()),y.push(w),x)if(m.itemNoIcons.isChecked())(S=new Asc.asc_CConditionalFormatIconSet).asc_setIconSet(Asc.EIconSetType.NoIcons),S.asc_setIconId(0),this.iconsProps.isReverse?x.unshift(S):x.push(S);else for(var S=m.pickerIcons.getSelectedRec().get("value")+1,A=0;A<this.collectionPresets.length;A++){for(var k=this.collectionPresets.at(A).get("icons"),T=0;T<k.length;T++)if(S==k[T]){(S=new Asc.asc_CConditionalFormatIconSet).asc_setIconSet(A),S.asc_setIconId(T),this.iconsProps.isReverse?x.unshift(S):x.push(S);break}if("object"==typeof S)break}}v.asc_setCFVOs(y),v.asc_setIconSets(x),t.asc_setColorScaleOrDataBarOrIconSetRule(v)}}return t},refreshRules:function(t,e){var i=this.ruleStore.findWhere({index:t});if(i){var n=i.get("rules"),o=[];n&&n.each((function(t,e){o.push({value:void 0!==t.get("type")?t.get("type"):t.get("subtype"),displayValue:t.get("name")})})),this.cmbRule.setData(o),o.length>0&&this.cmbRule.setValue(void 0!==e?e:o[0].value)}if(this.setControls(t,this.cmbRule.getValue()),this.setHeight(9==t?445:355),i){var s=i.get("type");if(this._changedProps=new Asc.asc_CConditionalFormattingRule,this._changedProps.asc_setType(s),s==Asc.c_oAscCFType.containsText||s==Asc.c_oAscCFType.containsBlanks||s==Asc.c_oAscCFType.duplicateValues||s==Asc.c_oAscCFType.timePeriod||s==Asc.c_oAscCFType.aboveAverage||s==Asc.c_oAscCFType.top10||s==Asc.c_oAscCFType.cellIs||s==Asc.c_oAscCFType.expression)(this.xfsFormat||null===this.xfsFormat)&&this._changedProps.asc_setDxf(this.xfsFormat);else if(s==Asc.c_oAscCFType.colorScale){for(var a=2==i.get("num")?[this.scaleControls[0],this.scaleControls[2]]:this.scaleControls,l=[],r=[],c=0;c<a.length;c++){var d=new Asc.asc_CConditionalFormatValueObject,h=a[c];d.asc_setType(h.combo.getValue()),d.asc_setVal(h.range.getValue()),r.push(d),l.push(Common.Utils.ThemeColor.getRgbColor(h.colorPicker.currentColor))}this.scaleProps=new Asc.asc_CColorScale,this.scaleProps.asc_setColors(l),this.scaleProps.asc_setCFVOs(r),this._changedProps.asc_setColorScaleOrDataBarOrIconSetRule(this.scaleProps)}else if(s==Asc.c_oAscCFType.dataBar){this.barProps=new Asc.asc_CDataBar,this.barProps.asc_setInterfaceDefault(),this.barProps.asc_setGradient(this.cmbFill.getValue()),this.barProps.asc_setColor(Common.Utils.ThemeColor.getRgbColor(this.btnPosFill.colorPicker.currentColor)),!this.cmbBorder.getValue()?this.barProps.asc_setBorderColor(Common.Utils.ThemeColor.getRgbColor(this.btnPosBorder.colorPicker.currentColor)):this.barProps.asc_setBorderColor(null),this.barProps.asc_setDirection(this.cmbBarDirection.getValue()),this._changedProps.asc_setColorScaleOrDataBarOrIconSetRule(this.barProps)}this.previewFormat()}},setControls:function(t,e){var i;this.$window.find(".hasformat").toggleClass("hidden",t>=7&&t<=10),this.cmbRule.setVisible(t<7),this.txtRange1.setVisible(0==t||3==t||11==t),this.txtRange2.setVisible(0==t&&(e==Asc.c_oAscCFOperator.between||e==Asc.c_oAscCFOperator.notBetween)),this.cmbPercent.setVisible(1==t),this.numRank.setVisible(1==t),this.txtRange1.cmpEl.width(11==t?310:150),7!=t&&8!=t||(this.renderScalesPanel(),this.scaleControls[1].combo.setVisible(8==t),this.scaleControls[1].range.setVisible(8==t),this.scaleControls[1].color.setVisible(8==t),this.lblMidScale.toggleClass("hidden",7==t)),this.$window.find(".scale").toggleClass("hidden",t<7||t>8),9==t&&this.renderDataBarPanel(),10==t&&this.renderIconsPanel(),this.$window.find(".databar").toggleClass("hidden",9!==t),this.$window.find(".iconset").toggleClass("hidden",10!==t),t<7?i=this.cmbRule:7==t||8==t?i=this.scaleControls[0].combo:9==t?i=this.barControls[0].combo:10==t&&(i=this.iconsControls[this.iconsControls.length-1].cmbOperator),i&&_.delay((function(){i.focus()}),50)},onSelectData:function(t){var e=this;if(e.api){var i=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.setValue(e.getSettings()),t.checkValidate())}}).on("close",(function(){e.show()})),n=e.$window.offset();e.hide(),i.show(n.left+160,n.top+125),i.setSettings({api:e.api,range:_.isEmpty(t.getValue())||1!=t.checkValidate()?"":t.getValue(),type:Asc.c_oAscSelectionDialogType.ConditionalFormattingRule,validation:function(){return!0}})}},onFormatsSelect:function(t,e){var i=new Asc.asc_CellXfs,n=e.options.presetSettings;if(n&&n.fontColor&&i.asc_setFontColor(Common.Utils.ThemeColor.getRgbColor(n.fontColor)),n&&n.fillColor&&i.asc_setFillColor(Common.Utils.ThemeColor.getRgbColor(n.fillColor)),n&&n.borderColor){var o=[],s=Asc.c_oAscBorderStyles.Thin,a=Common.Utils.ThemeColor.getRgbColor(n.borderColor);o[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,a),i.asc_setBorder(o)}this.xfsFormat=i,this._changedProps&&this._changedProps.asc_setDxf(i),this.fillXfsFormatInfo(i),this.previewFormat()},clearFormat:function(){this.xfsFormat=null,this._changedProps&&this._changedProps.asc_setDxf(null),this.fillXfsFormatInfo(new Asc.asc_CellXfs),this.previewFormat()},onBoldClick:function(){!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setFontBold(this.btnBold.isActive()),this.previewFormat()},onItalicClick:function(){!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setFontItalic(this.btnItalic.isActive()),this.previewFormat()},onUnderlineClick:function(){!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setFontUnderline(this.btnUnderline.isActive()),this.previewFormat()},onStrikeoutClick:function(){!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setFontStrikeout(this.btnStrikeout.isActive()),this.previewFormat()},onBordersWidth:function(t,e,i){i&&(this.btnBorders.options.borderswidth=e.value)},onBordersColor:function(t,e){$("#format-rules-borders-border-color .menu-item-icon").css("border-color","#"+("object"==typeof e?e.color:e)),this.mnuBorderColor.onUnHoverItem(),this.btnBorders.options.borderscolor=Common.Utils.ThemeColor.getRgbColor(e)},onBorders:function(t){var e;_.each(t.menu.items,(function(i){if(t.options.borderId==i.options.borderId)return e=i,!1})),e&&this.onBordersMenu(t.menu,e)},onBordersMenu:function(t,e){if(!_.isUndefined(e.options.borderId)){var i=this.btnBorders,n=[],o=i.options.borderswidth,s=i.options.borderscolor;i.rendered&&(i.$icon.removeClass(i.options.icls).addClass(e.options.icls),i.options.icls=e.options.icls),i.options.borderId=e.options.borderId,"inner"==e.options.borderId?(n[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(o,s)):"all"==e.options.borderId?(n[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(o,s)):"outer"==e.options.borderId?(n[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(o,s),n[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(o,s)):"none"!=e.options.borderId&&(n[e.options.borderId]=new Asc.asc_CBorder(o,s)),!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setBorder(n),this.previewFormat()}},onFormatTextColorSelect:function(t,e,i){this.btnTextColor.currentColor=e,this.mnuTextColorPicker.currentColor=e,!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setFontColor(Common.Utils.ThemeColor.getRgbColor(this.mnuTextColorPicker.currentColor)),this.previewFormat()},onFormatFillColorSelect:function(t,e,i){this.btnFillColor.currentColor=e,this.mnuFillColorPicker.currentColor=e,!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setFillColor("transparent"==this.mnuFillColorPicker.currentColor?null:Common.Utils.ThemeColor.getRgbColor(this.mnuFillColorPicker.currentColor)),this.previewFormat()},onNumberFormatSelect:function(t,e){!this.xfsFormat&&(this.xfsFormat=new Asc.asc_CellXfs),this.xfsFormat.asc_setNumFormatInfo(e.format),this.previewFormat()},previewFormat:function(){if(this._changedProps){var t=this._changedProps.asc_getType();t==Asc.c_oAscCFType.containsText||t==Asc.c_oAscCFType.notContainsText||t==Asc.c_oAscCFType.beginsWith||t==Asc.c_oAscCFType.endsWith||t==Asc.c_oAscCFType.containsBlanks||t==Asc.c_oAscCFType.notContainsBlanks||t==Asc.c_oAscCFType.duplicateValues||t==Asc.c_oAscCFType.uniqueValues||t==Asc.c_oAscCFType.containsErrors||t==Asc.c_oAscCFType.notContainsErrors||t==Asc.c_oAscCFType.timePeriod||t==Asc.c_oAscCFType.aboveAverage||t==Asc.c_oAscCFType.top10||t==Asc.c_oAscCFType.cellIs||t==Asc.c_oAscCFType.expression?(this.xfsFormat&&!this._changedProps.asc_getDxf()&&this._changedProps.asc_setDxf(this.xfsFormat),this._changedProps.asc_getPreview("format-rules-edit-preview-format",this.xfsFormat?Common.define.conditionalData.exampleText:Common.define.conditionalData.noFormatText)):t==Asc.c_oAscCFType.colorScale?this._changedProps.asc_getPreview("format-rules-edit-preview-scale",""):t==Asc.c_oAscCFType.dataBar&&this._changedProps.asc_getPreview("format-rules-edit-preview-databar","")}},updateThemeColors:function(){if(this.panels.scale.rendered&&!this.panels.scale.initColors){for(var t=0;t<this.scaleControls.length;t++){var e=this.scaleControls[t].color;e.setMenu();var i=e.getPicker();i.options.type=t,i.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),i.currentColor=0==t?"FFC000":1==t?"FFFF00":"92D050",i.select(i.currentColor,!0),e.setColor(i.currentColor),this.scaleControls[t].colorPicker=i,e.on("color:select",_.bind(this.onScaleColorsSelect,this))}this.panels.scale.initColors=!0}if(this.panels.databar.rendered&&!this.panels.databar.initColors){var n=function(t){t.setMenu();var e=t.getPicker();e.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),t.colorPicker=e,e.currentColor=t.color,e.select(e.currentColor,!0)};n(this.btnPosFill),this.btnPosFill.on("color:select",_.bind(this.onBarColorsSelect,this,"pos")),n(this.btnNegFill),this.btnNegFill.on("color:select",_.bind(this.onBarColorsSelect,this,"")),n(this.btnPosBorder),this.btnPosBorder.on("color:select",_.bind(this.onBarColorsSelect,this,"pos-border")),n(this.btnNegBorder),this.btnNegBorder.on("color:select",_.bind(this.onBarColorsSelect,this,"")),n(this.btnAxisColor),this.btnAxisColor.on("color:select",_.bind(this.onBarColorsSelect,this,"")),this.panels.databar.initColors=!0}this.panels.format.rendered&&!this.panels.format.initColors&&(this.mnuTextColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.mnuFillColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.mnuBorderColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.panels.format.initColors=!0)},onScaleColorsSelect:function(t,e){if(t.colorPicker.currentColor=e,this.scaleProps){var i=this.scaleProps.asc_getColors();i[Math.min(t.options.type,i.length-1)]=Common.Utils.ThemeColor.getRgbColor(t.colorPicker.currentColor),this.scaleProps.asc_setColors(i),this.previewFormat()}},onBarColorsSelect:function(t,e,i){e.colorPicker.currentColor=i,!this.barProps||"pos"!=t&&"pos-border"!=t||("pos"==t?this.barProps.asc_setColor(Common.Utils.ThemeColor.getRgbColor(i)):this.barProps.asc_setBorderColor(Common.Utils.ThemeColor.getRgbColor(i)),this.previewFormat())},setDefComboValue:function(t,e,i){var n=this.cmbCategory.getValue(),o="";switch(e){case Asc.c_oAscCfvoType.Number:o=0;break;case Asc.c_oAscCfvoType.Percent:o=0==t?0:1==t&&8==n?50:100;break;case Asc.c_oAscCfvoType.Percentile:o=0==t?10:1==t&&8==n?50:90}i.setValue(o)},fillIconsControls:function(t,e,i){var n=this;this.iconsProps.iconsSet=t,this.iconsProps.iconsLength=e.length,this.$window.find(".icons-5").toggleClass("hidden",this.iconsProps.iconsLength<5),this.$window.find(".icons-4").toggleClass("hidden",this.iconsProps.iconsLength<4);var o=this.iconsControls;o.length<this.iconsProps.iconsLength&&this.addNewIconsLine(),o.length<this.iconsProps.iconsLength&&this.addNewIconsLine();for(var s=0;s<e.length;s++){(c=o[s]).cmbType.setValue(e[s].asc_getType()),c.value.setValue(e[s].asc_getVal()||""),c.cmbOperator.setValue(e[s].asc_getGte())}var a=[];i&&i.length>0?(this.cmbIconsPresets.setValue(this.textCustom),_.each(i,(function(t){t.asc_getIconSet()==Asc.EIconSetType.NoIcons?a.push(-1):a.push(n.collectionPresets.at(t.asc_getIconSet()).get("icons")[t.asc_getIconId()])}))):(this.cmbIconsPresets.setValue(t),a=n.collectionPresets.at(t).get("icons"));var l=this.iconsProps.isReverse,r=a.length;for(s=0;s<a.length;s++){var c=o[l?r-s-1:s],d=-1==a[s]?null:c.pickerIcons.store.findWhere({value:a[s]-1});d?c.pickerIcons.selectRecord(d,!0):c.pickerIcons.deselectAll(!0),c.itemNoIcons.setChecked(!d,!0),this.selectIconItem(c.cmbIcons,d)}this.fillIconsLabels()},fillIconsLabels:function(){var t=this.iconsControls,e=this.iconsProps.iconsLength,i=new RegExp("^s*[0-9]+[,.]?[0-9]*s*$"),n=t[1].value.getValue();t[0].label.text(Common.Utils.String.format(this.textIconLabelFirst,t[1].cmbOperator.getSelectedRecord().prevOp,i.test(n)?parseFloat(n):this.textFormula));for(var o=1;o<e-1;o++)n=t[o+1].value.getValue(),t[o].label.text(Common.Utils.String.format(this.textIconLabel,t[o+1].cmbOperator.getSelectedRecord().prevOp,i.test(n)?parseFloat(n):this.textFormula));t[e-1].label.text(this.textIconLabelLast)},reverseIconsControls:function(){for(var t=this.iconsControls,e=this.iconsProps.iconsLength,i=0;i<e/2;i++){var n=t[i],o=t[e-i-1],s=n.itemNoIcons.isChecked()?-1:n.pickerIcons.getSelectedRec().get("value"),a=o.itemNoIcons.isChecked()?-1:o.pickerIcons.getSelectedRec().get("value"),l=n.pickerIcons.store.findWhere({value:a});l?n.pickerIcons.selectRecord(l,!0):n.pickerIcons.deselectAll(!0),n.itemNoIcons.setChecked(!l,!0),this.selectIconItem(n.cmbIcons,l),(l=o.pickerIcons.store.findWhere({value:s}))?o.pickerIcons.selectRecord(l,!0):o.pickerIcons.deselectAll(!0),o.itemNoIcons.setChecked(!l,!0),this.selectIconItem(o.cmbIcons,l)}},onSelectIcon:function(t,e,i,n,o){this.selectIconItem(t,o),e.setChecked(!1,!0),this.cmbIconsPresets.setValue(this.textCustom)},onSelectNoIcon:function(t,e,i,n){n&&(this.selectIconItem(t),e.deselectAll(!0),this.cmbIconsPresets.setValue(this.textCustom))},selectIconItem:function(t,e){var i=$(t.el).find(".form-control > div");i.css("background-image",e?"url("+e.get("imgUrl")+")":""),i.text(e?"":this.txtNoCellIcon)},isRangeValid:function(){var t,e=this.ruleStore.findWhere({index:this.cmbCategory.getValue()});if(e){var i,n,o=e.get("type"),s=[];switch(o){case Asc.c_oAscCFType.containsText:case Asc.c_oAscCFType.expression:""===this.txtRange1.getValue()?i=o==Asc.c_oAscCFType.containsText?this.textEmptyText:this.textEmptyFormulaExt:(t=this.api.asc_isValidDataRefCf(o,[[this.txtRange1.getValue()]]))&&(t=t[0]),(t||i)&&(n=this.txtRange1);break;case Asc.c_oAscCFType.cellIs:var a=this.cmbRule.getValue();""===this.txtRange1.getValue()?(i=this.textEmptyValue,n=this.txtRange1):a!=Asc.c_oAscCFOperator.notBetween&&a!=Asc.c_oAscCFOperator.between||""!==this.txtRange2.getValue()?(s=[[this.txtRange1.getValue()]],a!=Asc.c_oAscCFOperator.notBetween&&a!=Asc.c_oAscCFOperator.between||s.push([this.txtRange2.getValue()]),(t=this.api.asc_isValidDataRefCf(o,s))&&(n=t[1]?this.txtRange2:this.txtRange1,t=t[0])):(i=this.textEmptyValue,n=this.txtRange2);break;case Asc.c_oAscCFType.top10:var l=!!this.cmbPercent.getValue();(t=this.api.asc_isValidDataRefCf(o,[[this.numRank.getNumberValue(),l]]))&&(t=t[0]),t==Asc.c_oAscError.ID.ErrorTop10Between&&(i=Common.Utils.String.format(this.textErrorTop10Between,l?0:1,l?100:1e3));break;case Asc.c_oAscCFType.colorScale:for(var r=e.get("num"),c=2==r?[this.scaleControls[0],this.scaleControls[2]]:this.scaleControls,d=0;d<r;d++)if(!c[d].range.isDisabled()&&""===c[d].range.getValue()){i=c[d].combo.getValue()==Asc.c_oAscCfvoType.Formula?this.textEmptyFormula:this.textEmptyText,n=c[d].range;break}if(!i){for(d=0;d<r;d++)s.push([c[d].range.getValue(),c[d].combo.getValue()]);if(t=this.api.asc_isValidDataRefCf(o,s)){var h=t[1];n=c[h].range,(t=t[0])==Asc.c_oAscError.ID.ValueMustBeGreaterThen?i=Common.Utils.String.format(this.textErrorGreater,0==h?this.textMinpoint:h==r-1?this.textMaxpoint:this.textMidpoint,h==r-1&&3==r?this.textMidpoint:this.textMinpoint):t==Asc.c_oAscError.ID.NotValidPercentage?i=Common.Utils.String.format(this.textNotValidPercentageExt,0==h?this.textMinpoint:h==r-1?this.textMaxpoint:this.textMidpoint):t==Asc.c_oAscError.ID.NotValidPercentile&&(i=Common.Utils.String.format(this.textNotValidPercentileExt,0==h?this.textMinpoint:h==r-1?this.textMaxpoint:this.textMidpoint))}}break;case Asc.c_oAscCFType.dataBar:var p=this.barControls;for(d=0;d<p.length;d++)if(!p[d].range.isDisabled()&&""===p[d].range.getValue()){i=p[d].combo.getValue()==Asc.c_oAscCfvoType.Formula?this.textEmptyFormula:this.textEmptyText,n=p[d].range;break}if(!i){for(d=0;d<p.length;d++)s.push([p[d].range.getValue(),p[d].combo.getValue()]);if(t=this.api.asc_isValidDataRefCf(o,s)){h=t[1];n=p[h].range,(t=t[0])==Asc.c_oAscError.ID.NotValidPercentage?i=Common.Utils.String.format(this.textNotValidPercentageExt,h?this.textLongBar:this.textShortBar):t==Asc.c_oAscError.ID.NotValidPercentile&&(i=Common.Utils.String.format(this.textNotValidPercentileExt,h?this.textLongBar:this.textShortBar))}}break;case Asc.c_oAscCFType.iconSet:var m=this.iconsControls;for(d=0;d<this.iconsProps.iconsLength;d++)if(!m[d].value.isDisabled()&&""===m[d].value.getValue()){i=m[d].cmbType.getValue()==Asc.c_oAscCfvoType.Formula?this.textEmptyFormula:this.textEmptyText,n=m[d].value;break}if(!i){for(d=0;d<this.iconsProps.iconsLength;d++)s.push([m[d].value.getValue(),m[d].cmbType.getValue()]);(t=this.api.asc_isValidDataRefCf(o,s))&&(n=m[t[1]].value,t=t[0])}}if(!i&&t){var u=SSE.getController("Main");switch(t){case Asc.c_oAscError.ID.NotValidPercentile:i=this.textNotValidPercentile;break;case Asc.c_oAscError.ID.NotValidPercentage:i=this.textNotValidPercentage;break;case Asc.c_oAscError.ID.CannotAddConditionalFormatting:i=this.textCannotAddCF;break;case Asc.c_oAscError.ID.NotSingleReferenceCannotUsed:i=this.textSingleRef;break;case Asc.c_oAscError.ID.CannotUseRelativeReference:i=this.textRelativeRef;break;case Asc.c_oAscError.ID.IconDataRangesOverlap:i=this.textIconsOverlap;break;case Asc.c_oAscError.ID.FrmlWrongCountParentheses:i=u.errorWrongBracketsCount;break;case Asc.c_oAscError.ID.FrmlWrongOperator:i=u.errorWrongOperator;break;case Asc.c_oAscError.ID.FrmlWrongMaxArgument:i=u.errorCountArgExceed;break;case Asc.c_oAscError.ID.FrmlWrongCountArgument:i=u.errorCountArg;break;case Asc.c_oAscError.ID.FrmlWrongFunctionName:i=u.errorFormulaName;break;case Asc.c_oAscError.ID.FrmlAnotherParsingError:i=u.errorFormulaParsing;break;case Asc.c_oAscError.ID.FrmlWrongArgumentRange:i=u.errorArgsRange;break;case Asc.c_oAscError.ID.FrmlOperandExpected:i=u.errorOperandExpected;break;case Asc.c_oAscError.ID.FrmlWrongReferences:i=u.errorFrmlWrongReferences;break;case Asc.c_oAscError.ID.FrmlMaxTextLength:i=u.errorFrmlMaxTextLength;break;case Asc.c_oAscError.ID.FrmlMaxReference:i=u.errorFrmlMaxReference;break;case Asc.c_oAscError.ID.FrmlMaxLength:i=u.errorFrmlMaxLength;break;default:i=this.textInvalid}}return i&&Common.UI.warning({msg:i,maxwidth:600,callback:function(t){n&&n.focus()}}),!i}},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;if("ok"==e){if(!this.isRangeValid())return;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0)}this.close()},txtTitleNew:"New Formatting Rule",txtTitleEdit:"Edit Formatting Rule",textSelectData:"Select Data",textApply:"Apply to Range",textRule:"Rule",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",notcriticalErrorTitle:"Warning",textFormat:"Format",textCustom:"Custom",textBold:"Bold",textItalic:"Italic",textUnderline:"Underline",textStrikeout:"Strikeout",textSuperscript:"Superscript",textSubscript:"Subscript",textColor:"Text color",fillColor:"Background color",textMinpoint:"Minpoint",textMidpoint:"Midpoint",textMaxpoint:"Maxpoint",textMinimum:"Minimum",textMaximum:"Maximum",textAppearance:"Bar Appearance",txtNumber:"Number",txtGeneral:"General",txtCurrency:"Currency",txtAccounting:"Accounting",txtDate:"Date",txtTime:"Time",txtPercentage:"Percentage",txtFraction:"Fraction",txtScientific:"Scientific",txtText:"Text",tipBorders:"Borders",textOutBorders:"Outside Borders",textAllBorders:"All Borders",textTopBorders:"Top Borders",textBottomBorders:"Bottom Borders",textLeftBorders:"Left Borders",textRightBorders:"Right Borders",textNoBorders:"No Borders",textInsideBorders:"Inside Borders",textMiddleBorders:"Inside Horizontal Borders",textCenterBorders:"Inside Vertical Borders",textDiagDownBorder:"Diagonal Down Border",textDiagUpBorder:"Diagonal Up Border",textBordersStyle:"Border Style",textBordersColor:"Borders Color",textNewColor:"Add New Custom Color",tipNumFormat:"Number Format",textPreview:"Preview",text2Scales:"2 Color scale",text3Scales:"3 Color scale",textPercent:"Percent",textFormula:"Formula",textPercentile:"Percentile",textAutomatic:"Automatic",textContext:"Context",textLeft2Right:"Left to right",textRight2Left:"Right to left",textNone:"None",textSolid:"Solid",textCellMidpoint:"Cell midpoint",textGradient:"Gradient",textFill:"Fill",textPositive:"Positive",textNegative:"Negative",textBorder:"Border",textBarDirection:"Bar Direction",textAxis:"Axis",textPosition:"Position",textShowBar:"Show bar only",textSameAs:"Same as positive",textIconStyle:"Icon Style",textReverse:"Reverse Icons Order",textShowIcon:"Show icon only",textIconLabelFirst:"when {0} {1}",textIconLabel:"when {0} {1} and",textIconLabelLast:"when value is",textEmptyText:"Enter a value.",textEmptyFormula:"Enter a valid formula.",textEmptyFormulaExt:"The formula you entered does not evaluate to a number, date, time or string.",textEmptyValue:"The value you entered is not a valid number, date, time or string.",textErrorTop10Between:"Enter a number between {0} and {1}.",textNotValidPercentage:"One or more of the specified values is not a valid percentage.",textNotValidPercentile:"One or more of the specified values is not a valid percentile.",textNotValidPercentageExt:"The specified {0} value is not a valid percentage.",textNotValidPercentileExt:"The specified {0} value is not a valid percentile.",textShortBar:"shortest bar",textLongBar:"longest bar",textCannotAddCF:"Cannot add the conditional formatting.",textIconsOverlap:"One or more icon data ranges overlap.<br>Adjust icon data range values so that the ranges do not overlap.",textSingleRef:"This type of reference cannot be used in a conditional formatting formula.<br>Change the reference to a single cell, or use the reference with a worksheet function, such as =SUM(A1:B5).",textRelativeRef:"You cannot use relative references in conditional formatting criteria for color scales, data bars, and icon sets.",textErrorGreater:"The value for the {0} must be greater than the value for the {1}.",textInvalid:"Invalid data range.",textClear:"Clear",textItem:"Item",textPresets:"Presets",txtNoCellIcon:"No Icon"},SSE.Views.FormatRulesEditDlg||{}))})),define("spreadsheeteditor/main/app/view/FormatRulesManagerDlg",["text!spreadsheeteditor/main/app/template/FormatRulesManagerDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/ListView","common/main/lib/component/InputField","spreadsheeteditor/main/app/view/FormatRulesEditDlg"],(function(t){"use strict";SSE.Views=SSE.Views||{};var e=Common.UI.DataViewItem.extend({initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.listenTo(e.model,"change:name",(function(){e.render(),e.trigger("change",e,e.model)})),e.listenTo(e.model,"change:lock",(function(){e.render(),e.trigger("change",e,e.model)})),e.listenTo(e.model,"change:tip",(function(){var t=e.$el||$(e.el),i=t.data("bs.tooltip");if(i){var n=i.options.zIndex;t.removeData("bs.tooltip"),t.tooltip({title:e.model.get("tip"),placement:"cursor",zIndex:n})}})),e.listenTo(e.model,"change:selected",(function(){(e.$el||$(e.el)).toggleClass("selected",e.model.get("selected")&&e.model.get("allowSelected")),e.onSelectChange(e.model,e.model.get("selected")&&e.model.get("allowSelected"))})),e.listenTo(e.model,"remove",e.remove)}});SSE.Views.FormatRulesManagerDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"FormatRulesManagerDlg",contentWidth:510,height:361,buttons:["ok","cancel"]},initialize:function(e){_.extend(this.options,{title:this.txtTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"/>'].join("")},e),this.api=e.api,this.handler=e.handler,this.props=e.props,this.langId=e.langId,this.rules=[],this.rulesStores={},this.rulesDeleted=[],this.listSettings={length:0,min:0,max:0},this.locked=e.locked||!1,this.userTooltip=!0,this.wrapEvents={onLockCFManager:_.bind(this.onLockCFManager,this),onUnLockCFManager:_.bind(this.onUnLockCFManager,this),onLockCFRule:_.bind(this.onLockCFRule,this),onUnLockCFRule:_.bind(this.onUnLockCFRule,this)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.cmbScope=new Common.UI.ComboBox({el:$("#format-manager-combo-scope"),menuStyle:"min-width: 100%;max-height: 211px;",editable:!1,cls:"input-group-nr",data:[],takeFocusOnClose:!0}).on("selected",(function(e,i){t.refreshRuleList(i)})),this.rulesList=new Common.UI.ListView({el:$("#format-manager-rules-list",this.$window),store:new Common.UI.DataViewStore,emptyText:"",template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div class="list-item" style="width: 100%;display:inline-block;" id="format-manager-item-<%= ruleIndex %>">','<div style="width:181px;padding-right: 10px;display: inline-block;vertical-align: middle;overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><%= name %></div>','<div style="width:181px;padding-right: 10px;display: inline-block;vertical-align: middle;"><div id="format-manager-txt-rule-<%= ruleIndex %>" style=""></div></div>','<div style="width:112px;display: inline-block;vertical-align: middle;"><div id="format-manager-item-preview-<%= ruleIndex %>" style="height:22px;background-color: #ffffff;"></div></div>',"<% if (lock) { %>",'<div class="lock-user"><%=lockuser%></div>',"<% } %>","</div>"].join("")),tabindex:1}),this.rulesList.createNewItem=function(t){return new e({template:this.itemTemplate,model:t})},this.rulesList.on("item:select",_.bind(this.onSelectRule,this)).on("item:keydown",_.bind(this.onKeyDown,this)),this.btnNew=new Common.UI.Button({el:$("#format-manager-btn-new")}),this.btnNew.on("click",_.bind(this.onEditRule,this,!1)),this.btnEdit=new Common.UI.Button({el:$("#format-manager-btn-edit")}),this.btnEdit.on("click",_.bind(this.onEditRule,this,!0)),this.btnDelete=new Common.UI.Button({el:$("#format-manager-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDeleteRule,this)),this.btnUp=new Common.UI.Button({parentEl:$("#format-manager-btn-up"),cls:"btn-toolbar bg-white",iconCls:"caret-up",hint:this.textUp}),this.btnUp.on("click",_.bind(this.onMoveClick,this,!0)),this.btnDown=new Common.UI.Button({parentEl:$("#format-manager-btn-down"),cls:"btn-toolbar bg-white",iconCls:"caret-down",hint:this.textDown}),this.btnDown.on("click",_.bind(this.onMoveClick,this,!1)),this.afterRender()},getDefaultFocusableComponent:function(){return this.cmbScope},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){Common.UI.FocusManager.add(this,this.cmbScope),Common.UI.FocusManager.add(this,this.rulesList),Common.UI.FocusManager.add(this,this.btnNew),Common.UI.FocusManager.add(this,this.btnEdit),Common.UI.FocusManager.add(this,this.btnUp),Common.UI.FocusManager.add(this,this.btnDown),Common.UI.FocusManager.add(this,this.btnDelete),this.rulesList.on("item:add",_.bind(this.addControls,this)),this.rulesList.on("item:change",_.bind(this.addControls,this)),this.currentSheet=this.api.asc_getActiveWorksheetIndex(),this.refreshScopeList(),this.refreshRuleList(this.cmbScope.getSelectedRecord()),this.api.asc_registerCallback("asc_onLockCFManager",this.wrapEvents.onLockCFManager),this.api.asc_registerCallback("asc_onUnLockCFManager",this.wrapEvents.onUnLockCFManager),this.api.asc_registerCallback("asc_onLockCFRule",this.wrapEvents.onLockCFRule),this.api.asc_registerCallback("asc_onUnLockCFRule",this.wrapEvents.onUnLockCFRule)},refreshScopeList:function(){this.api.asc_getWorksheetsCount();var t=[{value:Asc.c_oAscSelectionForCFType.selection,displayValue:this.textSelection,sheetIndex:-1},{value:Asc.c_oAscSelectionForCFType.worksheet,displayValue:this.textThisSheet,sheetIndex:-1},{value:Asc.c_oAscSelectionForCFType.table,displayValue:this.textThisTable,sheetIndex:-1},{value:Asc.c_oAscSelectionForCFType.pivot,displayValue:this.textThisPivot,sheetIndex:-1}];this.cmbScope.setData(t),this.cmbScope.setValue(Asc.c_oAscSelectionForCFType.selection)},refreshRuleList:function(t){this.rules=[];var e=t.sheetIndex>-1?t.sheetIndex:this.currentSheet,i=this.rulesStores[e];if(!i){i=new Common.UI.DataViewStore,this.rulesStores[e]=i;var n=this.api.asc_getCF(Asc.c_oAscSelectionForCFType.worksheet,e),o=n[0];this.currentRange=n[1];var s=[];if(o)for(var a=0;a<o.length;a++){var l=o[a],r=this.getRuleName(l),c=l.asc_getLocation(),d=l.asc_getIsLock();s.push({ruleIndex:a,ruleId:l.asc_getId(),name:r,tip:r,range:c[1],activeSheet:c[0],priority:l.asc_getPriority(),ruleChanged:!1,props:l,lock:null!=d,lockuser:d?this.isUserVisible(d)?this.getUserName(d):this.lockText:this.guestText})}i.reset(s)}e==this.currentSheet&&i.each((function(e){var i=t.value!==Asc.c_oAscSelectionForCFType.worksheet&&!e.get("props").asc_checkScope(t.value);e.set("cls",i?"hidden":void 0)})),this.rulesList.setStore(i),this.rulesList.onResetItems(),this.rulesList.deselectAll(),this.updateRulesCount(),this.listSettings.length>0&&(this.rulesList.selectByIndex(this.listSettings.min),!0===this.userTooltip&&this.rulesList.cmpEl.find(".lock-user").length>0&&this.rulesList.cmpEl.on("mouseover",_.bind(this.onMouseOverLock,this)).on("mouseout",_.bind(this.onMouseOutLock,this))),this.updateButtons()},onMouseOverLock:function(t,e,i){if(!0===this.userTooltip&&$(t.target).hasClass("lock-user")){var n=this,o=$(t.target).tooltip({title:this.tipIsLocked,trigger:"manual"}).data("bs.tooltip");this.userTooltip=o.tip(),this.userTooltip.css("z-index",parseInt(this.$window.css("z-index"))+10),o.show(),setTimeout((function(){n.userTipHide()}),5e3)}},userTipHide:function(){"object"==typeof this.userTooltip&&(this.userTooltip.remove(),this.userTooltip=void 0,this.rulesList.cmpEl.off("mouseover").off("mouseout"))},onMouseOutLock:function(t,e,i){"object"==typeof this.userTooltip&&this.userTipHide()},getRuleName:function(t){var e="";switch(t.asc_getType()){case Asc.c_oAscCFType.aboveAverage:e=this.textAbove;var i=t.asc_getAboveAverage(),n=t.asc_getEqualAverage(),o=t.asc_getStdDev();switch(s=i?0:1,n?s+=2:o&&(s+=2+2*o),s){case 0:e=this.textAbove;break;case 1:e=this.textBelow;break;case 2:e=this.textEqAbove;break;case 3:e=this.textEqBelow;break;case 4:e=this.text1Above;break;case 5:e=this.text1Below;break;case 6:e=this.text2Above;break;case 7:e=this.text2Below;break;case 8:e=this.text3Above;break;case 9:e=this.text3Below}break;case Asc.c_oAscCFType.beginsWith:e=this.textBeginsWith+" "+(t.asc_getContainsText()||"");break;case Asc.c_oAscCFType.cellIs:switch(e=this.textCellValue,s=t.asc_getOperator()){case Asc.c_oAscCFOperator.greaterThan:e=e+" "+">"+" "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFOperator.greaterThanOrEqual:e=e+" "+">="+" "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFOperator.lessThan:e=e+" "+"<"+" "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFOperator.lessThanOrEqual:e=e+" "+"<="+" "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFOperator.equal:e=e+" "+"="+" "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFOperator.notEqual:e=e+" "+"<>"+" "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFOperator.between:e=e+" "+Common.Utils.String.format(this.textBetween,t.asc_getValue1()||"",t.asc_getValue2()||"");break;case Asc.c_oAscCFOperator.notBetween:e=e+" "+Common.Utils.String.format(this.textNotBetween,t.asc_getValue1()||"",t.asc_getValue2()||"")}break;case Asc.c_oAscCFType.colorScale:e=this.textColorScale;break;case Asc.c_oAscCFType.containsBlanks:e=this.textContainsBlank;break;case Asc.c_oAscCFType.containsErrors:e=this.textContainsError;break;case Asc.c_oAscCFType.containsText:e=this.textContains+" "+(t.asc_getContainsText()||"");break;case Asc.c_oAscCFType.dataBar:e=Common.define.conditionalData.textDataBar;break;case Asc.c_oAscCFType.duplicateValues:e=this.textDuplicate;break;case Asc.c_oAscCFType.expression:e=Common.define.conditionalData.textFormula+": "+(t.asc_getValue1()||"");break;case Asc.c_oAscCFType.iconSet:e=this.textIconSet;break;case Asc.c_oAscCFType.notContainsBlanks:e=this.textNotContainsBlank;break;case Asc.c_oAscCFType.notContainsErrors:e=this.textNotContainsError;break;case Asc.c_oAscCFType.notContainsText:e=this.textNotContains+" "+(t.asc_getContainsText()||"");break;case Asc.c_oAscCFType.timePeriod:var s;switch(s=t.asc_getTimePeriod()){case Asc.c_oAscTimePeriod.yesterday:e=Common.define.conditionalData.textYesterday;break;case Asc.c_oAscTimePeriod.today:e=Common.define.conditionalData.textToday;break;case Asc.c_oAscTimePeriod.tomorrow:e=Common.define.conditionalData.textTomorrow;break;case Asc.c_oAscTimePeriod.last7Days:e=Common.define.conditionalData.textLast7days;break;case Asc.c_oAscTimePeriod.lastWeek:e=Common.define.conditionalData.textLastWeek;break;case Asc.c_oAscTimePeriod.thisWeek:e=Common.define.conditionalData.textThisWeek;break;case Asc.c_oAscTimePeriod.nextWeek:e=Common.define.conditionalData.textNextWeek;break;case Asc.c_oAscTimePeriod.lastMonth:e=Common.define.conditionalData.textLastMonth;break;case Asc.c_oAscTimePeriod.thisMonth:e=Common.define.conditionalData.textThisMonth;break;case Asc.c_oAscTimePeriod.nextMonth:e=Common.define.conditionalData.textNextMonth}break;case Asc.c_oAscCFType.top10:e=(e=t.asc_getBottom()?Common.define.conditionalData.textBottom:Common.define.conditionalData.textTop)+" "+t.asc_getRank()+(t.asc_getPercent()?"%":"");break;case Asc.c_oAscCFType.uniqueValues:e=this.textUnique;break;case Asc.c_oAscCFType.endsWith:e=this.textEnds+" "+(t.asc_getContainsText()||"")}return e},addControls:function(t,e,i){if(i){var n=this,o=i.get("ruleIndex"),s=this.rulesList.cmpEl.find("#format-manager-item-"+o);this.rules[o]||(this.rules[o]={});var a=this.rules[o],l=new Common.UI.InputFieldBtn({el:s.find("#format-manager-txt-rule-"+o),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,disabled:!i.get("activeSheet")||i.get("lock"),validateOnChange:!0}).on("changed:after",(function(t,e,o,s){a.dataRangeValid!==e&&(n.isRangeValid(e)?(a.dataRangeValid=e,i.set("ruleChanged",!0),i.get("props").asc_setLocation(a.dataRangeValid)):a.txtDataRange.setValue(a.dataRangeValid))})).on("button:click",_.bind(this.onSelectData,this,a,i));Common.UI.FocusManager.add(this,l);var r=i.get("range");null!==r&&l.setValue(r),a.txtDataRange=l,a.dataRangeValid=r,a.previewDiv="format-manager-item-preview-"+o,n.drawRulePreview(i),s.on("mousedown","input",(function(){n.rulesList.selectRecord(i)}))}},drawRulePreview:function(t){var e=t.get("props"),i=e.asc_getType(),n="";i!=Asc.c_oAscCFType.containsText&&i!=Asc.c_oAscCFType.notContainsText&&i!=Asc.c_oAscCFType.beginsWith&&i!=Asc.c_oAscCFType.endsWith&&i!=Asc.c_oAscCFType.containsBlanks&&i!=Asc.c_oAscCFType.notContainsBlanks&&i!=Asc.c_oAscCFType.duplicateValues&&i!=Asc.c_oAscCFType.uniqueValues&&i!=Asc.c_oAscCFType.containsErrors&&i!=Asc.c_oAscCFType.notContainsErrors&&i!=Asc.c_oAscCFType.timePeriod&&i!=Asc.c_oAscCFType.aboveAverage&&i!=Asc.c_oAscCFType.top10&&i!=Asc.c_oAscCFType.cellIs&&i!=Asc.c_oAscCFType.expression||(n=e.asc_getDxf()?Common.define.conditionalData.exampleText:Common.define.conditionalData.noFormatText),e.asc_getPreview(this.rules[t.get("ruleIndex")].previewDiv,n)},isRangeValid:function(t){return Asc.c_oAscError.ID.No===this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.ConditionalFormattingRule,t,!0)},onSelectData:function(t,e){var i=this;if(i.api){var n=new SSE.Views.CellRangeDialog({handler:function(n,o){"ok"==o&&(i.isRangeValid(n.getSettings())&&(t.dataRangeValid=n.getSettings(),e.set("ruleChanged",!0),e.get("props").asc_setLocation(t.dataRangeValid)),t.txtDataRange.setValue(t.dataRangeValid))}}).on("close",(function(){i.show()})),o=i.$window.offset();i.hide(),n.show(o.left+160,o.top+125),n.setSettings({api:i.api,range:_.isEmpty(t.txtDataRange.getValue())?t.dataRangeValid:t.txtDataRange.getValue(),type:Asc.c_oAscSelectionDialogType.ConditionalFormattingRule,validation:function(){return!0}})}},onEditRule:function(t){var e,i=this,n=(i.$window.offset(),this.rulesList.getSelectedRec()),o=new SSE.Views.FormatRulesEditDlg({api:i.api,props:t&&n?n.get("props"):null,isEdit:t,langId:i.langId,handler:function(o,s){if("ok"==o&&s){var a=i.getRuleName(s);if(t)n.set("name",a),n.set("tip",a),n.set("ruleChanged",!0),n.set("props",s),e=n;else{s.asc_setLocation(i.currentRange);var l=i.rulesStores[i.currentSheet];e=l.add({ruleIndex:i.rules.length,name:a,tip:a,range:i.currentRange,activeSheet:!0,ruleChanged:!0,priority:1,props:s,lock:!1,lockuser:""},{at:0}),i.updateRulesPriority(l)}}}}).on("close",(function(){i.show(),t?e&&i.drawRulePreview(e):e&&(i.cmbScope.setValue(Asc.c_oAscSelectionForCFType.selection),i.refreshRuleList(i.cmbScope.getSelectedRecord()))}));i.hide(),o.show()},onDeleteRule:function(){var t=this.rulesList.store,e=this.rulesList.getSelectedRec();if(e){var i=e.get("ruleId");void 0!==i&&this.rulesDeleted.push(i);var n=e.get("ruleIndex");this.rules[n]=void 0,n=t.indexOf(e),t.remove(e),this.updateRulesCount(),this.listSettings.length>0&&this.rulesList.selectByIndex(n<=this.listSettings.max?n:this.listSettings.max),this.rulesList.scrollToRecord(this.rulesList.getSelectedRec())}this.updateButtons()},onMoveClick:function(t){var e=this.rulesList.store,i=e.length,n=this.rulesList.getSelectedRec();if(n){var o=e.indexOf(n),s=t?this.getPrevRuleIndex(o):this.getNextRuleIndex(o),a=e.at(s),l=a.get("priority");a.set("priority",n.get("priority")),n.set("priority",l),e.add(e.remove(n),{at:t?Math.max(0,s):Math.min(i-1,s)}),e.add(e.remove(a),{at:t?Math.max(0,o):Math.min(i-1,o)}),this.rulesList.selectRecord(n),this.rulesList.scrollToRecord(n)}this.updateMoveButtons()},onSelectRule:function(t,e,i){this.userTipHide(),this.updateButtons()},updateButtons:function(){var t=this.rulesList.getSelectedRec(),e=!!t&&t.get("lock");this.btnNew.setDisabled(this.rulesList.store.length>63||this.locked),this.btnDelete.setDisabled(this.listSettings.length<1||e),this.btnEdit.setDisabled(this.listSettings.length<1||e),this.updateMoveButtons(),this.rulesList.scroller&&this.rulesList.scroller.update()},updateMoveButtons:function(){var t=this.rulesList.getSelectedRec(),e=t?this.rulesList.store.indexOf(t):-1;this.btnUp.setDisabled(e<=this.listSettings.min||this.locked),this.btnDown.setDisabled(e<0||e==this.listSettings.max||this.locked)},getPrevRuleIndex:function(t){var e=this.rulesList.store;if(this.cmbScope.getValue()==Asc.c_oAscSelectionForCFType.worksheet)return Math.max(0,t-1);for(var i=t-1;i>=this.listSettings.min;i--)if("hidden"!==e.at(i).get("cls"))return i;return this.listSettings.min},getNextRuleIndex:function(t){var e=this.rulesList.store;if(this.cmbScope.getValue()==Asc.c_oAscSelectionForCFType.worksheet)return Math.min(e.length-1,t+1);for(var i=t+1;i<=this.listSettings.max;i++)if("hidden"!==e.at(i).get("cls"))return i;return this.listSettings.max},updateRulesCount:function(){var t=this.rulesList.store;if(this.cmbScope.getValue()==Asc.c_oAscSelectionForCFType.worksheet)this.listSettings={length:t.length,min:0,max:t.length-1};else{this.listSettings={length:0,min:-1,max:0};for(var e=0;e<t.length;e++)"hidden"!==t.at(e).get("cls")&&(this.listSettings.length++,this.listSettings.max=e,this.listSettings.min<0&&(this.listSettings.min=e))}},updateRulesPriority:function(t){for(var e=1;e<t.length;e++){var i=t.at(e);i.set("priority",i.get("priority")+1)}},getSettings:function(){var t=[];for(var e in this.rulesStores)if(this.rulesStores.hasOwnProperty(e)){var i=this.rulesStores[e],n=[];i&&i.each((function(t){var e=t.get("props");t.get("priority")!==e.asc_getPriority()&&(e.asc_setPriority(t.get("priority")),t.set("ruleChanged",!0)),t.get("ruleChanged")&&n.push(e)})),n.length>0&&(t[e]=n)}return{rules:t,deleted:this.rulesDeleted}},onKeyDown:function(t,e,i){i.keyCode!=Common.UI.Keys.DELETE||this.btnDelete.isDisabled()||/form-control/.test(i.target.className)||this.onDeleteRule()},close:function(){this.userTipHide(),this.api.asc_unregisterCallback("asc_onLockCFManager",this.wrapEvents.onLockCFManager),this.api.asc_unregisterCallback("asc_onUnLockCFManager",this.wrapEvents.onUnLockCFManager),this.api.asc_unregisterCallback("asc_onLockCFRule",this.wrapEvents.onLockCFRule),this.api.asc_unregisterCallback("asc_onUnLockCFRule",this.wrapEvents.onUnLockCFRule),Common.UI.Window.prototype.close.call(this)},onLockCFManager:function(t){this.currentSheet===t&&(this.locked=!0,this.updateButtons(),!0===this.userTooltip&&this.rulesList.cmpEl.find(".lock-user").length>0&&this.rulesList.cmpEl.on("mouseover",_.bind(this.onMouseOverLock,this)).on("mouseout",_.bind(this.onMouseOutLock,this)))},onUnLockCFManager:function(t){this.currentSheet===t&&(this.locked=!1,this.updateButtons())},onLockCFRule:function(t,e,i){if(this.currentSheet===t){var n=this.rulesList.store.findWhere({ruleId:e});n&&(n.set("lockuser",i?this.isUserVisible(i)?this.getUserName(i):this.lockText:this.guestText),n.set("lock",!0),this.updateButtons()),!0===this.userTooltip&&this.rulesList.cmpEl.find(".lock-user").length>0&&this.rulesList.cmpEl.on("mouseover",_.bind(this.onMouseOverLock,this)).on("mouseout",_.bind(this.onMouseOutLock,this))}},onUnLockCFRule:function(t,e){if(this.currentSheet===t){var i=this.rulesList.store.findWhere({ruleId:e});i&&(i.set("lockuser",""),i.set("lock",!1),this.updateButtons())}},getUserName:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return AscCommon.UserInfoParser.getParsedName(i.get("username"))}return this.guestText},isUserVisible:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return!i.get("hidden")}return!0},txtTitle:"Conditional Formatting",textNew:"New",textEdit:"Edit",textDelete:"Delete",textUp:"Move rule up",textDown:"Move rule down",textSelection:"Current selection",textThisSheet:"This worksheet",textThisTable:"This table",textThisPivot:"This pivot",textScope:"Show formatting rules for",textRules:"Rules",textApply:"Apply to",textFormat:"Format",textSelectData:"Select data",textAbove:"Above average",textBelow:"Below average",textEqAbove:"Equal to or above average",textEqBelow:"Equal to or below average",text1Above:"1 std dev above average",text1Below:"1 std dev below average",text2Above:"2 std dev above average",text2Below:"2 std dev below average",text3Above:"3 std dev above average",text3Below:"3 std dev below average",textBeginsWith:"Cell value begins with",textCellValue:"Cell value",textBetween:"is between {0} and {1}",textNotBetween:"is not between {0} and {1}",textColorScale:"Graded color scale",textContainsBlank:"Cell contains a blank value",textContainsError:"Cell contains an error",textContains:"Cell value contains",textNotContains:"Cell value does not contain",textNotContainsError:"Cell does not contain an error",textNotContainsBlank:"Cell does not contain a blank value",textEnds:"Cell value ends with",textIconSet:"Icon set",textDuplicate:"Duplicate values",textUnique:"Unique values",tipIsLocked:"This element is being edited by another user.",guestText:"Guest",lockText:"Locked"},SSE.Views.FormatRulesManagerDlg||{}))})),define("spreadsheeteditor/main/app/view/SlicerAddDialog",["common/main/lib/component/Window","common/main/lib/component/ListView"],(function(){"use strict";SSE.Views.SlicerAddDialog=Common.UI.Window.extend(_.extend({options:{width:250,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.txtTitle},t||{}),this.template=['<div class="box" style="height: 195px;">','<div class="input-row">','<label style="font-weight: bold;">'+this.textColumns+"</label>","</div>",'<div id="add-slicers-dlg-columns" class="" style="width: 100%; height: 162px; overflow: hidden;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.props=this.options.props,this.handler=this.options.handler,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.columnsList=new Common.UI.ListView({el:$("#add-slicers-dlg-columns",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,scrollAlwaysVisible:!0,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(["<div>",'<label class="checkbox-indeterminate" style="position:absolute;">','<input id="rdcheckbox-<%= id %>" type="checkbox" class="button__checkbox">','<label for="rdcheckbox-<%= id %>" class="checkbox__shape" ></label>',"</label>",'<div id="<%= id %>" class="list-item" style="pointer-events:none; margin-left: 20px;display: flex;">','<div style="flex-grow: 1;"><%= Common.Utils.String.htmlEncode(value) %></div>',"</div>","</div>"].join(""))}),this.columnsList.on({"item:change":this.onItemChanged.bind(this),"item:add":this.onItemChanged.bind(this),"item:select":this.onCellCheck.bind(this)}),this.columnsList.onKeyDown=_.bind(this.onListKeyDown,this),this.columnsList.on("entervalue",_.bind(this.onPrimary,this)),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.afterRender()},updateColumnsList:function(t){var e=[];t&&t.length>0&&(this.props.forEach((function(t,i){e.push(new Common.UI.DataViewModel({id:i,selected:!1,allowSelected:!0,value:t,check:!1}))})),this.columnsList.store.reset(e),this.columnsList.scroller.update({minScrollbarLength:this.columnsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}))},onItemChanged:function(t,e){var i=e.model.get("check");"indeterminate"==i?$("input[type=checkbox]",e.$el).prop("indeterminate",!0):$("input[type=checkbox]",e.$el).prop({checked:i,indeterminate:!1})},onCellCheck:function(t,e,i){if(!this.checkCellTrigerBlock){var n="",o=!1,s=null,a=window.event?window.event:window._event;if(a){if((n=$(a.currentTarget).find(".list-item")).length){s=n.get(0).getBoundingClientRect();var l=a.clientX*Common.Utils.zoom(),r=a.clientY*Common.Utils.zoom();s.left<l&&l<s.right&&s.top<r&&r<s.bottom&&(o=!0)}(o||a.target.className.match("checkbox")&&"input"!==a.target.localName)&&(this.updateCellCheck(t,i),_.delay((function(){t.focus()}),100,this))}}},onListKeyDown:function(t,e){var i=this.columnsList;i.disabled||(_.isUndefined(void 0)&&(e=t),e.keyCode==Common.UI.Keys.SPACE?(e.preventDefault(),e.stopPropagation(),this.updateCellCheck(i,i.getSelectedRec())):Common.UI.DataView.prototype.onKeyDown.call(this.columnsList,t,e))},updateCellCheck:function(t,e){e&&t&&e.set("check",!e.get("check"))},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){t&&this.updateColumnsList(t);var e=this;_.delay((function(){e.columnsList.focus()}),100,this)},getSettings:function(){var t=this.columnsList.store,e=[];return t.each((function(t,i){t.get("check")&&e.push(t.get("value"))})),e},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onDblClickFormat:function(){this._handleInput("ok")},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,"ok"==t?this.getSettings():this.props),this.close()},txtTitle:"Insert Slicers",textColumns:"Columns"},SSE.Views.SlicerAddDialog||{}))})),define("spreadsheeteditor/main/app/view/AdvancedSeparatorDialog",["common/main/lib/component/Window","common/main/lib/component/InputField"],(function(){"use strict";SSE.Views.AdvancedSeparatorDialog=Common.UI.Window.extend(_.extend({options:{width:330,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div class="input-row" style="margin-bottom: 8px;">',"<label>"+this.textLabel+"</label>","</div>",'<div style="margin-bottom: 12px;">','<div id="id-adv-separator-decimal" class=""></div><label class="input-row" style="margin-left: 10px; padding-top: 4px;">'+this.strDecimalSeparator+"</label>","</div>",'<div style="margin-bottom: 10px;">','<div id="id-adv-separator-thousands" class=""></div><label class="input-row" style="margin-left: 10px; padding-top: 4px;">'+this.strThousandsSeparator+"</label>","</div>",'<div class="input-row" style="margin-bottom: 8px;">',"<label>"+this.textQualifier+"</label>","</div>",'<div style="margin-bottom: 12px;">','<div id="id-adv-separator-qualifier" class="input-group-nr"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.props=t.props,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.inputDecimalSeparator=new Common.UI.InputField({el:$("#id-adv-separator-decimal"),style:"width: 35px;",maxLength:1,validateOnBlur:!1}),this.inputThousandsSeparator=new Common.UI.InputField({el:$("#id-adv-separator-thousands"),style:"width: 35px;",maxLength:1,validateOnBlur:!1}),this.cmbQualifier=new Common.UI.ComboBox({el:$("#id-adv-separator-qualifier"),style:"width: 100px;",menuStyle:"min-width: 100px;",cls:"input-group-nr",data:[{value:'"',displayValue:'"'},{value:"'",displayValue:"'"},{value:null,displayValue:this.txtNone}],editable:!1,takeFocusOnClose:!0}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.afterRender()},getFocusedComponents:function(){return[this.inputDecimalSeparator,this.inputThousandsSeparator,this.cmbQualifier]},getDefaultFocusableComponent:function(){return this.inputDecimalSeparator},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){t&&(this.inputDecimalSeparator.setValue(t.decimal||""),this.inputThousandsSeparator.setValue(t.thousands||""),this.cmbQualifier.setValue(t.qualifier||null))},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,{decimal:this.inputDecimalSeparator.getValue(),thousands:this.inputThousandsSeparator.getValue(),qualifier:this.cmbQualifier.getValue()}),this.close()},textTitle:"Advanced Settings",textLabel:"Settings used to recognize numeric data",strDecimalSeparator:"Decimal separator",strThousandsSeparator:"Thousands separator",txtNone:"(none)",textQualifier:"Text qualifier"},SSE.Views.AdvancedSeparatorDialog||{}))})),define("spreadsheeteditor/main/app/view/CreateSparklineDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.CreateSparklineDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:310,height:195},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td style="padding-bottom: 2px;">','<label class="input-label">'+e.textDataRange+"</label>","</td>","</tr>","<tr>",'<td class="padding-large">','<div id="create-spark-input-source" class="input-row" style=""></div>',"</td>","</tr>","<tr>","<td>",'<label class="input-label">'+e.textDestination+"</label>","</td>","</tr>","<tr>","<td>",'<div id="create-spark-input-dest" class="input-row" style=""></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.api=t.api,this.props=t.props,this.options.handler=function(e,i){if("ok"==e&&!this.isRangeValid())return!0;t.handler&&t.handler.call(this,e,i)},this.dataSourceValid="",this.dataDestValid="",Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.txtSourceRange=new Common.UI.InputFieldBtn({el:$("#create-spark-input-source"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0}),this.txtSourceRange.on("button:click",_.bind(this.onSelectData,this,"source")),this.txtDestRange=new Common.UI.InputFieldBtn({el:$("#create-spark-input-dest"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0,validateOnBlur:!1}),this.txtDestRange.on("button:click",_.bind(this.onSelectData,this,"dest")),this.afterRender()},getFocusedComponents:function(){return[this.txtSourceRange,this.txtDestRange]},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){var e=t?t.selectedCells:0,i=this;if(e>0){var n=this.api.asc_getActiveRangeStr(Asc.referenceType.R);this.txtSourceRange.setValue(n),this.dataSourceValid=n,setTimeout((function(){i.txtDestRange.focus()}),100)}else{n=this.api.asc_getActiveRangeStr(Asc.referenceType.A);this.txtDestRange.setValue(n),this.dataDestValid=n,setTimeout((function(){i.txtSourceRange.focus()}),100)}this.txtSourceRange.validation=function(t){return i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange},this.txtDestRange.validation=function(t){return i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.FormatTable,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange}},getSettings:function(){return{source:this.txtSourceRange.getValue(),destination:this.txtDestRange.getValue()}},isRangeValid:function(){var t=!0,e="";return _.isEmpty(this.txtSourceRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,this.txtSourceRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),t?(_.isEmpty(this.txtDestRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.FormatTable,this.txtDestRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),t||(this.txtDestRange.showError([e]),this.txtDestRange.focus(),t)):(this.txtSourceRange.showError([e]),this.txtSourceRange.focus(),t)},onSelectData:function(t){var e=this,i="source"==t?e.txtSourceRange:e.txtDestRange;if(e.api){var n=new SSE.Views.CellRangeDialog({handler:function(n,o){if("ok"==o){var s=n.getSettings();"source"==t?e.dataSourceValid=s:e.dataDestValid=s,i.setValue(s),i.checkValidate()}}}).on("close",(function(){e.show(),_.delay((function(){i.focus()}),1)})),o=e.$window.offset();e.hide(),n.show(o.left+160,o.top+125),n.setSettings({api:e.api,range:_.isEmpty(i.getValue())||1!=i.checkValidate()?"source"==t?e.dataSourceValid:e.dataDestValid:i.getValue(),type:"source"==t?Asc.c_oAscSelectionDialogType.Chart:Asc.c_oAscSelectionDialogType.FormatTable})}},textTitle:"Create Sparklines",textDataRange:"Source data range",textSelectData:"Select data",textDestination:"Choose, where to place the sparklines",txtEmpty:"This field is required",textInvalidRange:"Invalid cells range"},SSE.Views.CreateSparklineDialog||{}))})),define("spreadsheeteditor/main/app/controller/Toolbar",["core","common/main/lib/component/Window","common/main/lib/view/CopyWarningDialog","common/main/lib/view/ImageFromUrlDialog","common/main/lib/view/SelectFileDlg","common/main/lib/view/SymbolTableDialog","common/main/lib/view/OptionsDialog","common/main/lib/util/define","common/main/lib/view/SearchBar","spreadsheeteditor/main/app/view/Toolbar","spreadsheeteditor/main/app/collection/TableTemplates","spreadsheeteditor/main/app/controller/PivotTable","spreadsheeteditor/main/app/view/HyperlinkSettingsDialog","spreadsheeteditor/main/app/view/TableOptionsDialog","spreadsheeteditor/main/app/view/NamedRangeEditDlg","spreadsheeteditor/main/app/view/NamedRangePasteDlg","spreadsheeteditor/main/app/view/NameManagerDlg","spreadsheeteditor/main/app/view/FormatSettingsDialog","spreadsheeteditor/main/app/view/PageMarginsDialog","spreadsheeteditor/main/app/view/HeaderFooterDialog","spreadsheeteditor/main/app/view/PrintTitlesDialog","spreadsheeteditor/main/app/view/ScaleDialog","spreadsheeteditor/main/app/view/FormatRulesManagerDlg","spreadsheeteditor/main/app/view/SlicerAddDialog","spreadsheeteditor/main/app/view/AdvancedSeparatorDialog","spreadsheeteditor/main/app/view/CreateSparklineDialog"],(function(){"use strict";SSE.Controllers.Toolbar=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Toolbar"],initialize:function(){var t=this;this.addListeners({Toolbar:{"change:compact":this.onClickChangeCompact.bind(t),"add:chart":this.onSelectChart,"add:spark":this.onSelectSpark,"insert:textart":this.onInsertTextart,"change:scalespn":this.onClickChangeScaleInMenu.bind(t),"click:customscale":this.onScaleClick.bind(t),"home:open":this.onHomeOpen},FileMenu:{"menu:hide":t.onFileMenu.bind(t,"hide"),"menu:show":t.onFileMenu.bind(t,"show")},Statusbar:{"sheet:changed":_.bind(this.onApiSheetChanged,this)},"Common.Views.Header":{print:function(t){this.getApplication().getController("Main").onPrint()},save:function(t){this.api.asc_Save()},undo:this.onUndo,redo:this.onRedo,downloadas:function(t){var e,i=this.getApplication().getController("Main"),n=i.appOptions.spreadsheet.fileType;n&&(e=Asc.c_oAscFileType[n.toUpperCase()]);var o=[Asc.c_oAscFileType.XLSX,Asc.c_oAscFileType.ODS,Asc.c_oAscFileType.CSV,Asc.c_oAscFileType.PDFA,Asc.c_oAscFileType.XLTX,Asc.c_oAscFileType.OTS,Asc.c_oAscFileType.XLSM];(!e||o.indexOf(e)<0)&&(e=Asc.c_oAscFileType.PDF),e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA?Common.NotificationCenter.trigger("download:settings",this.toolbar,e):i.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e))},"go:editor":function(){Common.Gateway.requestEditRights()}},DataTab:{"data:sort":this.onSortType,"data:setfilter":this.onAutoFilter,"data:clearfilter":this.onClearFilter},FormulaTab:{"function:namedrange":this.onNamedRangeMenu,"function:namedrange-open":this.onNamedRangeMenuOpen},CellSettings:{"cf:init":this.onShowBeforeCondFormat},ViewTab:{"viewtab:showtoolbar":this.onChangeViewMode.bind(this)},LeftMenu:{"search:show":this.searchShow.bind(this)}}),Common.NotificationCenter.on("page:settings",_.bind(this.onApiSheetChanged,this)),Common.NotificationCenter.on("formula:settings",_.bind(this.applyFormulaSettings,this)),Common.NotificationCenter.on("toolbar:collapse",_.bind((function(){this.toolbar.collapse()}),this)),Common.NotificationCenter.on("oleedit:close",_.bind(this.onOleEditClose,this)),this.editMode=!0,this._isAddingShape=!1,this._state={activated:!1,prstyle:void 0,clrtext:void 0,pralign:void 0,clrback:void 0,valign:void 0,can_undo:void 0,can_redo:void 0,bold:void 0,italic:void 0,underline:void 0,strikeout:void 0,subscript:void 0,superscript:void 0,wrap:void 0,merge:void 0,angle:void 0,controlsdisabled:{filters:void 0},selection_type:void 0,filter:void 0,filterapplied:!1,tablestylename:void 0,tablename:void 0,namedrange_locked:!1,fontsize:void 0,multiselect:!1,sparklines_disabled:!1,numformatinfo:void 0,numformattype:void 0,numformat:void 0,langId:void 0,pgsize:[0,0],pgmargins:void 0,pgorient:void 0,lock_doc:void 0,cf_locked:[],selectedCells:0,wsLock:!1,wsProps:[],is_lockText:!1,is_lockShape:!1},this.binding={};var e=function(e,i){var n=$(e.target),o=n.closest("#editor_sdk"),s=n.closest("button").attr("id");void 0===s&&(s=n.closest(".btn-group").attr("id")),t.api&&t.api.asc_isAddAutoshape()&&(o.length<=0||"cancel"==i)&&(t.toolbar.btnInsertText.pressed&&s!=t.toolbar.btnInsertText.id||t.toolbar.btnInsertShape.pressed&&s!=t.toolbar.btnInsertShape.id?(t._isAddingShape=!1,t._addAutoshape(!1),t.toolbar.btnInsertShape.toggle(!1,!0),t.toolbar.btnInsertText.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",t.toolbar)):t.toolbar.btnInsertShape.pressed&&s==t.toolbar.btnInsertShape.id&&_.defer((function(){t.api.asc_endAddShape(),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}),100))};this.checkInsertAutoshape=function(t){e({},t.action)},this._addAutoshape=function(t,i){this.api&&(t?(this.api.asc_startAddShape(i),$(document.body).on("mouseup",e)):(this.api.asc_endAddShape(),$(document.body).off("mouseup",e)))},this.onApiEndAddShape=function(){this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),this.toolbar.btnInsertText.pressed&&this.toolbar.btnInsertText.toggle(!1,!0),$(document.body).off("mouseup",e)}},onLaunch:function(){this.toolbar=this.createView("Toolbar"),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this))},setMode:function(t){this.mode=t,this.toolbar.applyLayout(t)},attachUIEvents:function(t){var e=this;e.appConfig.isEditDiagram?(t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),t.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),t.btnDecDecimal.on("click",_.bind(this.onDecrement,this)),t.btnIncDecimal.on("click",_.bind(this.onIncrement,this)),t.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),t.cmbNumberFormat.on("show:before",_.bind(this.onNumberFormatOpenBefore,this,!0)),t.cmbNumberFormat.cmpEl&&t.cmbNumberFormat.cmpEl.on("click","#id-toolbar-mnu-item-more-formats a",_.bind(this.onNumberFormatSelect,this)),t.btnEditChart.on("click",_.bind(this.onEditChart,this)),t.btnEditChartData.on("click",_.bind(this.onEditChartData,this)),t.btnEditChartType.on("click",_.bind(this.onEditChartType,this))):e.appConfig.isEditMailMerge?(t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnSearch.on("toggle",_.bind(this.onSearch,this)),t.btnSortDown.on("click",_.bind(this.onSortType,this,Asc.c_oAscSortOptions.Ascending)),t.btnSortUp.on("click",_.bind(this.onSortType,this,Asc.c_oAscSortOptions.Descending)),t.btnSetAutofilter.on("click",_.bind(this.onAutoFilter,this)),t.btnClearAutofilter.on("click",_.bind(this.onClearFilter,this))):e.appConfig.isEditOle?(t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnSearch.on("toggle",_.bind(this.onSearch,this)),t.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),t.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),t.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),t.cmbNumberFormat.on("show:before",_.bind(this.onNumberFormatOpenBefore,this,!0)),t.cmbNumberFormat.cmpEl&&t.cmbNumberFormat.cmpEl.on("click","#id-toolbar-mnu-item-more-formats a",_.bind(this.onNumberFormatSelect,this)),t.btnWrap.on("click",_.bind(this.onWrap,this)),t.btnTextColor.on("click",_.bind(this.onTextColor,this)),t.btnTextColor.on("color:select",_.bind(this.onTextColorSelect,this)),t.btnTextColor.on("auto:select",_.bind(this.onAutoFontColor,this)),t.btnBackColor.on("click",_.bind(this.onBackColor,this)),t.btnBackColor.on("color:select",_.bind(this.onBackColorSelect,this)),t.btnBorders.on("click",_.bind(this.onBorders,this)),t.btnBorders.rendered&&(t.btnBorders.menu.on("item:click",_.bind(this.onBordersMenu,this)),t.mnuBorderWidth.on("item:toggle",_.bind(this.onBordersWidth,this)),t.mnuBorderColorPicker.on("select",_.bind(this.onBordersColor,this)),$("#id-toolbar-menu-auto-bordercolor").on("click",_.bind(this.onAutoBorderColor,this))),t.btnMerge.on("click",_.bind(this.onMergeCellsMenu,this,t.btnMerge.menu,t.btnMerge.menu.items[0])),t.btnMerge.menu.on("item:click",_.bind(this.onMergeCellsMenu,this)),t.btnTableTemplate.menu.on("show:after",_.bind(this.onTableTplMenuOpen,this)),t.btnVisibleArea.menu.on("item:click",_.bind(this.onVisibleAreaMenu,this)),t.btnVisibleAreaClose.on("click",_.bind(this.onVisibleAreaClose,this)),t.cmbFontName.on("selected",_.bind(this.onFontNameSelect,this)),t.cmbFontName.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontName.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontName.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontName.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.cmbFontSize.on("selected",_.bind(this.onFontSizeSelect,this)),t.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),t.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.cmbFontSize.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontSize.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontSize.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontSize.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.btnTextFormatting.menu.on("item:click",_.bind(this.onTextFormattingMenu,this)),t.btnHorizontalAlign.menu.on("item:click",_.bind(this.onHorizontalAlignMenu,this)),t.btnVerticalAlign.menu.on("item:click",_.bind(this.onVerticalAlignMenu,this))):(t.btnPrint.on("click",_.bind(this.onPrint,this)),t.btnPrint.on("disabled",_.bind(this.onBtnChangeState,this,"print:disabled")),t.btnSave.on("click",_.bind(this.onSave,this)),t.btnSave.on("disabled",_.bind(this.onBtnChangeState,this,"save:disabled")),t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnUndo.on("disabled",_.bind(this.onBtnChangeState,this,"undo:disabled")),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnRedo.on("disabled",_.bind(this.onBtnChangeState,this,"redo:disabled")),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnCut.on("click",_.bind(this.onCopyPaste,this,"cut")),t.btnSelectAll.on("click",_.bind(this.onSelectAll,this)),t.btnIncFontSize.on("click",_.bind(this.onIncreaseFontSize,this)),t.btnDecFontSize.on("click",_.bind(this.onDecreaseFontSize,this)),t.btnBold.on("click",_.bind(this.onBold,this)),t.btnItalic.on("click",_.bind(this.onItalic,this)),t.btnUnderline.on("click",_.bind(this.onUnderline,this)),t.btnStrikeout.on("click",_.bind(this.onStrikeout,this)),t.btnSubscript.on("click",_.bind(this.onSubscript,this)),t.btnSubscript.menu.on("item:click",_.bind(this.onSubscriptMenu,this)),t.btnTextColor.on("click",_.bind(this.onTextColor,this)),t.btnTextColor.on("color:select",_.bind(this.onTextColorSelect,this)),t.btnTextColor.on("auto:select",_.bind(this.onAutoFontColor,this)),t.btnBackColor.on("click",_.bind(this.onBackColor,this)),t.btnBackColor.on("color:select",_.bind(this.onBackColorSelect,this)),t.btnBorders.on("click",_.bind(this.onBorders,this)),t.btnBorders.rendered&&(t.btnBorders.menu.on("item:click",_.bind(this.onBordersMenu,this)),t.mnuBorderWidth.on("item:toggle",_.bind(this.onBordersWidth,this)),t.mnuBorderColorPicker.on("select",_.bind(this.onBordersColor,this)),$("#id-toolbar-menu-auto-bordercolor").on("click",_.bind(this.onAutoBorderColor,this))),t.btnAlignLeft.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Left)),t.btnAlignCenter.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Center)),t.btnAlignRight.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Right)),t.btnAlignJust.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Justify)),t.btnMerge.on("click",_.bind(this.onMergeCellsMenu,this,t.btnMerge.menu,t.btnMerge.menu.items[0])),t.btnMerge.menu.on("item:click",_.bind(this.onMergeCellsMenu,this)),t.btnAlignTop.on("click",_.bind(this.onVerticalAlign,this,Asc.c_oAscVAlign.Top)),t.btnAlignMiddle.on("click",_.bind(this.onVerticalAlign,this,Asc.c_oAscVAlign.Center)),t.btnAlignBottom.on("click",_.bind(this.onVerticalAlign,this,Asc.c_oAscVAlign.Bottom)),t.btnWrap.on("click",_.bind(this.onWrap,this)),t.btnTextOrient.menu.on("item:click",_.bind(this.onTextOrientationMenu,this)),t.btnInsertTable.on("click",_.bind(this.onBtnInsertTableClick,this)),t.btnInsertImage.menu.on("item:click",_.bind(this.onInsertImageMenu,this)),t.btnInsertHyperlink.on("click",_.bind(this.onHyperlink,this)),t.btnInsertText.on("click",_.bind(this.onBtnInsertTextClick,this)),t.btnInsertShape.menu.on("hide:after",_.bind(this.onInsertShapeHide,this)),t.btnInsertEquation.on("click",_.bind(this.onInsertEquationClick,this)),t.btnInsertSymbol.on("click",_.bind(this.onInsertSymbolClick,this)),t.btnInsertSlicer.on("click",_.bind(this.onInsertSlicerClick,this)),t.btnTableTemplate.menu.on("show:after",_.bind(this.onTableTplMenuOpen,this)),t.btnPercentStyle.on("click",_.bind(this.onNumberFormat,this)),t.btnCurrencyStyle.on("click",_.bind(this.onNumberFormat,this)),t.btnDecDecimal.on("click",_.bind(this.onDecrement,this)),t.btnIncDecimal.on("click",_.bind(this.onIncrement,this)),t.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),t.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),t.btnNamedRange.menu.on("item:click",_.bind(this.onNamedRangeMenu,this)),t.btnNamedRange.menu.on("show:after",_.bind(this.onNamedRangeMenuOpen,this)),t.btnClearStyle.menu.on("item:click",_.bind(this.onClearStyleMenu,this)),t.btnAddCell.menu.on("item:click",_.bind(this.onCellInsertMenu,this)),t.btnCopyStyle.on("toggle",_.bind(this.onCopyStyleToggle,this)),t.btnDeleteCell.menu.on("item:click",_.bind(this.onCellDeleteMenu,this)),t.btnColorSchemas.menu.on("item:click",_.bind(this.onColorSchemaClick,this)),t.btnColorSchemas.menu.on("show:after",_.bind(this.onColorSchemaShow,this)),t.cmbFontName.on("selected",_.bind(this.onFontNameSelect,this)),t.cmbFontName.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontName.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontName.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontName.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.cmbFontSize.on("selected",_.bind(this.onFontSizeSelect,this)),t.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),t.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.cmbFontSize.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontSize.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontSize.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontSize.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.listStyles.on("click",_.bind(this.onListStyleSelect,this)),t.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),t.cmbNumberFormat.on("show:before",_.bind(this.onNumberFormatOpenBefore,this,!0)),t.cmbNumberFormat.cmpEl&&t.cmbNumberFormat.cmpEl.on("click","#id-toolbar-mnu-item-more-formats a",_.bind(this.onNumberFormatSelect,this)),t.btnCurrencyStyle.menu.on("item:click",_.bind(this.onNumberFormatMenu,this)),$("#id-toolbar-menu-new-bordercolor").on("click",_.bind(this.onNewBorderColor,this)),t.btnPageOrient.menu.on("item:click",_.bind(this.onPageOrientSelect,this)),t.btnPageMargins.menu.on("item:click",_.bind(this.onPageMarginsSelect,this)),t.mnuPageSize.on("item:click",_.bind(this.onPageSizeClick,this)),t.mnuScale.on("item:click",_.bind(this.onScaleClick,this,"scale")),t.menuWidthScale.on("item:click",_.bind(this.onScaleClick,this,"width")),t.menuHeightScale.on("item:click",_.bind(this.onScaleClick,this,"height")),t.btnPrintArea.menu.on("item:click",_.bind(this.onPrintAreaClick,this)),t.btnPrintArea.menu.on("show:after",_.bind(this.onPrintAreaMenuOpen,this)),t.btnImgGroup.menu.on("item:click",_.bind(this.onImgGroupSelect,this)),t.btnImgBackward.menu.on("item:click",_.bind(this.onImgArrangeSelect,this)),t.btnImgForward.menu.on("item:click",_.bind(this.onImgArrangeSelect,this)),t.btnImgAlign.menu.on("item:click",_.bind(this.onImgAlignSelect,this)),t.btnImgForward.on("click",this.onImgArrangeSelect.bind(this,"forward")),t.btnImgBackward.on("click",this.onImgArrangeSelect.bind(this,"backward")),t.btnsEditHeader.forEach((function(t){t.on("click",_.bind(e.onEditHeaderClick,e,void 0))})),t.btnPrintTitles.on("click",_.bind(this.onPrintTitlesClick,this)),t.chPrintGridlines.on("change",_.bind(this.onPrintGridlinesChange,this)),t.chPrintHeadings.on("change",_.bind(this.onPrintHeadingsChange,this)),t.btnCondFormat.rendered&&t.btnCondFormat.menu.on("show:before",_.bind(this.onShowBeforeCondFormat,this,this.toolbar,"toolbar")),Common.Gateway.on("insertimage",_.bind(this.insertImage,this)),this.onSetupCopyStyleButton())},setApi:function(t){this.api=t;var e=SSE.getController("Main").appOptions;e.isEdit?(e.isEditDiagram||e.isEditMailMerge||e.isEditOle||(this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onMathTypes",_.bind(this.onApiMathTypes,this)),this.api.asc_registerCallback("asc_onContextMenu",_.bind(this.onContextMenu,this)),Common.NotificationCenter.on("storage:image-load",_.bind(this.openImageFromStorage,this)),Common.NotificationCenter.on("storage:image-insert",_.bind(this.insertImageFromStorage,this)),this.api.asc_registerCallback("asc_onSelectionMathChanged",_.bind(this.onApiMathChanged,this))),this.api.asc_registerCallback("asc_onInitEditorStyles",_.bind(this.onApiInitEditorStyles,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onLockDefNameManager",_.bind(this.onLockDefNameManager,this)),this.api.asc_registerCallback("asc_onLockCFManager",_.bind(this.onLockCFManager,this)),this.api.asc_registerCallback("asc_onUnLockCFManager",_.bind(this.onUnLockCFManager,this)),this.api.asc_registerCallback("asc_onZoomChanged",_.bind(this.onApiZoomChange,this)),Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this))):e.isEditOle?Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this)):e.isRestrictedEdit&&(this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChangedRestricted,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this)))},onApiChangeFont:function(t){!Common.Utils.ModalWindow.isVisible()&&this.toolbar.cmbFontName.onApiChangeFont(t)},onContextMenu:function(){this.toolbar.collapse()},onPrint:function(t){Common.NotificationCenter.trigger("print",this.toolbar)},onSave:function(t){if(this.api){var e=this.api.asc_isDocumentCanSave(),i=this.toolbar.btnCollabChanges&&this.toolbar.btnCollabChanges.cmpEl.hasClass("notify");if(!e&&!i&&!this.toolbar.mode.forcesave)return;this.api.asc_Save()}Common.component.Analytics.trackEvent("Save"),Common.component.Analytics.trackEvent("ToolBar","Save")},onBtnChangeState:function(t){if(/\:disabled$/.test(t)){var e=arguments[2];this.toolbar.fireEvent(t,[e])}},onUndo:function(t,e){this.api&&this.api.asc_Undo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Undo")},onRedo:function(t,e){this.api&&this.api.asc_Redo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Redo")},onCopyPaste:function(t,e){var i=this;if(i.api)if("cut"===t?i.api.asc_Cut():"copy"===t?i.api.asc_Copy():i.api.asc_Paste())Common.component.Analytics.trackEvent("ToolBar","Copy Warning");else{var n=Common.localStorage.getItem("sse-hide-copywarning");n&&1==parseInt(n)||new Common.Views.CopyWarningDialog({handler:function(t){t&&Common.localStorage.setItem("sse-hide-copywarning",1),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}Common.NotificationCenter.trigger("edit:complete",i.toolbar)},onSelectAll:function(t){this.api&&this.api.asc_EditSelectAll(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Select All")},onIncreaseFontSize:function(t){this.api&&this.api.asc_increaseFontSize(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onDecreaseFontSize:function(t){this.api&&this.api.asc_decreaseFontSize(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onBold:function(t,e){this._state.bold=void 0,this.api&&this.api.asc_setCellBold(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Bold")},onItalic:function(t,e){this._state.italic=void 0,this.api&&this.api.asc_setCellItalic(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Italic")},onUnderline:function(t,e){this._state.underline=void 0,this.api&&this.api.asc_setCellUnderline(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Underline")},onStrikeout:function(t,e){this._state.strikeout=void 0,this.api&&this.api.asc_setCellStrikeout(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Strikeout")},onSubscriptMenu:function(t,e){var i=this.toolbar.btnSubscript;"sub"==e.value?(this._state.subscript=void 0,this.api.asc_setCellSubscript(e.checked)):(this._state.superscript=void 0,this.api.asc_setCellSuperscript(e.checked)),e.checked&&(i.$icon.removeClass(i.options.icls).addClass(e.options.icls),i.options.icls=e.options.icls),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","sub"==e.value?"Subscript":"Superscript")},onSubscript:function(t,e){var i="btn-subscript"==t.options.icls;i?(this._state.subscript=void 0,this.api.asc_setCellSubscript(t.pressed)):(this._state.superscript=void 0,this.api.asc_setCellSuperscript(t.pressed)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar",i?"Subscript":"Superscript")},onTextColor:function(){this.toolbar.mnuTextColorPicker.trigger("select",this.toolbar.mnuTextColorPicker,this.toolbar.mnuTextColorPicker.currentColor)},onBackColor:function(){this.toolbar.mnuBackColorPicker.trigger("select",this.toolbar.mnuBackColorPicker,this.toolbar.mnuBackColorPicker.currentColor)},onTextColorSelect:function(t,e){this._state.clrtext_asccolor=this._state.clrtext=void 0,this.toolbar.btnTextColor.currentColor=e,this.toolbar.mnuTextColorPicker.currentColor=e,this.api&&this.api.asc_setCellTextColor(e.isAuto?e.color:Common.Utils.ThemeColor.getRgbColor(e)),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Text Color")},onBackColorSelect:function(t,e){this._state.clrshd_asccolor=this._state.clrback=void 0,this.toolbar.btnBackColor.currentColor=e,this.toolbar.mnuBackColorPicker.currentColor=e,this.api&&this.api.asc_setCellBackgroundColor("transparent"==e?null:Common.Utils.ThemeColor.getRgbColor(e)),Common.component.Analytics.trackEvent("ToolBar","Background Color")},onNewBorderColor:function(t,e){this.toolbar.btnBorders.menu.hide(),this.toolbar.btnBorders.toggle(!1,!0),this.toolbar.mnuBorderColorPicker.addNewColor()},onAutoFontColor:function(t){this._state.clrtext_asccolor=this._state.clrtext=void 0;var e=new Asc.asc_CColor;e.put_auto(!0),this.toolbar.btnTextColor.currentColor={color:e,isAuto:!0},this.toolbar.mnuTextColorPicker.currentColor={color:e,isAuto:!0},this.api&&this.api.asc_setCellTextColor(e),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Text Color")},onBorders:function(t){var e;_.each(t.menu.items,(function(i){if(t.options.borderId==i.options.borderId)return e=i,!1})),e&&this.onBordersMenu(t.menu,e)},onBordersMenu:function(t,e){var i=this;if(i.api&&!_.isUndefined(e.options.borderId)){var n=i.toolbar.btnBorders,o=[],s=n.options.borderswidth,a=n.options.borderscolor;n.rendered&&(n.$icon.removeClass(n.options.icls).addClass(e.options.icls),n.options.icls=e.options.icls),n.options.borderId=e.options.borderId,"inner"==e.options.borderId?(o[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(s,a)):"all"==e.options.borderId?(o[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,a)):"outer"==e.options.borderId?(o[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,a),o[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,a)):"none"!=e.options.borderId&&(o[e.options.borderId]=new Asc.asc_CBorder(s,a)),i.api.asc_setCellBorders(o),Common.NotificationCenter.trigger("edit:complete",i.toolbar),Common.component.Analytics.trackEvent("ToolBar","Borders")}},onBordersWidth:function(t,e,i){i&&(this.toolbar.btnBorders.options.borderswidth=e.value,Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Width"))},onBordersColor:function(t,e){$("#id-toolbar-mnu-item-border-color > a .menu-item-icon").css("border-color","#"+("object"==typeof e?e.color:e)),this.toolbar.mnuBorderColor.onUnHoverItem(),this.toolbar.btnBorders.options.borderscolor=Common.Utils.ThemeColor.getRgbColor(e),this.toolbar.mnuBorderColorPicker.currentColor=e;var i=this.toolbar.btnBorders.menu.$el.find("#id-toolbar-menu-auto-bordercolor > a");i.hasClass("selected")&&i.removeClass("selected"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Color")},onAutoBorderColor:function(t){$("#id-toolbar-mnu-item-border-color > a .menu-item-icon").css("border-color","#000"),this.toolbar.mnuBorderColor.onUnHoverItem();var e=new Asc.asc_CColor;e.put_auto(!0),this.toolbar.btnBorders.options.borderscolor=e,this.toolbar.mnuBorderColorPicker.clearSelection(),this.toolbar.mnuBorderColorPicker.currentColor={color:e,isAuto:!0};var i=this.toolbar.btnBorders.menu.$el.find("#id-toolbar-menu-auto-bordercolor > a");!i.hasClass("selected")&&i.addClass("selected"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Color")},onHorizontalAlign:function(t,e,i){this._state.pralign=void 0,this.api&&(this.api.asc_setCellAlign(e.pressed?t:null),this.toolbar.btnWrap.allowDepress=!(t==AscCommon.align_Justify)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Horizontal align")},onVerticalAlign:function(t,e,i){this._state.valign=void 0,this.api&&this.api.asc_setCellVertAlign(e.pressed?t:Asc.c_oAscVAlign.Bottom),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Vertical align")},onMergeCellsMenu:function(t,e){var i=this;function n(t){i._state.merge=void 0,i.api.asc_mergeCells(t),Common.NotificationCenter.trigger("edit:complete",i.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge")}i.api&&(i.api.asc_getCellInfo().asc_getMerge()!==Asc.c_oAscMergeOptions.Merge&&i.api.asc_mergeCellsDataLost(e.value)?Common.UI.warning({msg:i.warnMergeLostData,buttons:["yes","no"],primary:"yes",callback:function(t){"yes"==t?n(e.value):(i.toolbar.btnMerge.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",i.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge"))}}):n(e.value));Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge cells")},onWrap:function(t,e){this._state.wrap=void 0,this.api&&this.api.asc_setCellTextWrap(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Wrap")},onTextOrientationMenu:function(t,e){var i=0;switch(e.value){case"countcw":i=45;break;case"clockwise":i=-45;break;case"vertical":i=255;break;case"rotateup":i=90;break;case"rotatedown":i=-90}this._state.angle=void 0,this.api&&this.api.asc_setCellAngle(i),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Text orientation")},onBtnInsertTableClick:function(t,e){this.api&&this._setTableFormat(this.api.asc_getDefaultTableStyle()),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Table")},onInsertImageMenu:function(t,e,i){var n=this;"file"===e.value?(this.toolbar.fireEvent("insertimage",this.toolbar),this.api&&setTimeout((function(){n.api.asc_addImage()}),1),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Image")):"url"===e.value?new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t){if(n.api){var i=e.replace(/\s/g,"");_.isEmpty(i)?Common.UI.warning({msg:this.textEmptyImgUrl}):(n.toolbar.fireEvent("insertimage",n.toolbar),n.api.asc_addImageDrawingObject([i]),Common.component.Analytics.trackEvent("ToolBar","Image"))}Common.NotificationCenter.trigger("edit:complete",n.toolbar)}}}).show():"storage"===e.value&&Common.NotificationCenter.trigger("storage:image-load","add")},openImageFromStorage:function(t){var e=this;this.toolbar.mode.canRequestInsertImage?Common.Gateway.requestInsertImage(t):new Common.Views.SelectFileDlg({fileChoiceUrl:this.toolbar.mode.fileChoiceUrl.replace("{fileExt}","").replace("{documentType}","ImagesOnly")}).on("selectfile",(function(i,n){n&&(n.c=t),!n.images&&(n.images=[{fileType:n.fileType,url:n.url}]),n.url=null,e.insertImage(n)})).show()},insertImageFromStorage:function(t){!t||!t._urls||t.c&&"add"!=t.c||(this.toolbar.fireEvent("insertimage",this.toolbar),t._urls.length>0&&this.api.asc_addImageDrawingObject(t._urls,void 0,t.token),Common.component.Analytics.trackEvent("ToolBar","Image"))},insertImage:function(t){if(t&&(t.url||t.images)){t.url&&console.log("Obsolete: The 'url' parameter of the 'insertImage' method is deprecated. Please use 'images' parameter instead.");var e=[];if(t.images&&t.images.length>0)for(var i=0;i<t.images.length;i++)t.images[i]&&t.images[i].url&&e.push(t.images[i].url);else t.url&&e.push(t.url);t._urls=e}Common.NotificationCenter.trigger("storage:image-insert",t)},onHyperlink:function(t){Common.NotificationCenter.trigger("protect:check",this.onHyperlinkCallback,this,[t])},onHyperlinkCallback:function(t){var e,i,n=this;if(n.api){for(var o=n.api.asc_getWorksheetsCount(),s=-1,a=[];++s<o;)a.push({name:n.api.asc_getWorksheetName(s),hidden:n.api.asc_isWorksheetHidden(s)});var l=n.api.asc_getCellInfo(),r=l.asc_getSelectionType();i=l.asc_getHyperlink(),(e=new SSE.Views.HyperlinkSettingsDialog({api:n.api,appOptions:n.appOptions,handler:function(t,e){"ok"==e&&(i=t.getSettings(),n.api.asc_insertHyperlink(i)),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}})).show(),e.setSettings({sheets:a,ranges:n.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All,!0),currentSheet:n.api.asc_getWorksheetName(n.api.asc_getActiveWorksheetIndex()),props:i,text:l.asc_getText(),isLock:l.asc_getLockText(),allowInternal:r!==Asc.c_oAscSelectionType.RangeImage&&r!==Asc.c_oAscSelectionType.RangeShape&&r!==Asc.c_oAscSelectionType.RangeShapeText&&r!==Asc.c_oAscSelectionType.RangeChart&&r!==Asc.c_oAscSelectionType.RangeChartText&&r!==Asc.c_oAscSelectionType.RangeSlicer})}Common.component.Analytics.trackEvent("ToolBar","Add Hyperlink")},onEditChart:function(t){if(this.editMode){var e,i=this,n=i.api.asc_getCellInfo().asc_getSelectionType();if(n!==Asc.c_oAscSelectionType.RangeImage)if(i.api){e=i.api.asc_getChartObject();for(var o=i.api.asc_getGraphicObjectProps(),s=null,a=0;a<o.length;a++)if(o[a].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var l=o[a].asc_getObjectValue();l.asc_getChartProperties()&&(s=l)}if(e){var r=i.toolbar.mode.isEditDiagram||n===Asc.c_oAscSelectionType.RangeChart||n===Asc.c_oAscSelectionType.RangeChartText;new SSE.Views.ChartSettingsDlg({chartSettings:e,imageSettings:s,isChart:!0,api:i.api,handler:function(t,e){"ok"==t&&i.api&&(r?i.api.asc_editChartDrawingObject(e.chartSettings):i.api.asc_addChartDrawingObject(e.chartSettings),e.imageSettings&&i.api.asc_setGraphicObjectProps(e.imageSettings)),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}}}},onEditChartData:function(t){if(this.editMode){var e,i=this;if(i.api)if(e=i.api.asc_getChartObject())i._isEditRanges=!0,e.startEdit(),new SSE.Views.ChartDataDialog({chartSettings:e,api:i.api,handler:function(t,n){"ok"==t&&(e.endEdit(),i._isEditRanges=!1),Common.NotificationCenter.trigger("edit:complete",i)}}).on("close",(function(){i._isEditRanges&&e.cancelEdit(),i._isEditRanges=!1})).show()}},onEditChartType:function(t){if(this.editMode){var e,i=this;if(i.api)if(e=i.api.asc_getChartObject())i._isEditType=!0,e.startEdit(),new SSE.Views.ChartTypeDialog({chartSettings:e,api:i.api,handler:function(t,n){"ok"==t&&(e.endEdit(),i._isEditType=!1),Common.NotificationCenter.trigger("edit:complete",i)}}).on("close",(function(){i._isEditType&&e.cancelEdit(),i._isEditType=!1})).show()}},onSelectChart:function(t,e){if(this.editMode){var i=this,n=i.api.asc_getCellInfo().asc_getSelectionType();if(i.api){var o,s=n==Asc.c_oAscSelectionType.RangeChart||n==Asc.c_oAscSelectionType.RangeChartText;if(o=i.api.asc_getChartObject(!0))if(s)o.changeType(e);else{o.putType(e);var a=o.getRange(),l=_.isEmpty(a)?Asc.c_oAscError.ID.No:i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,a,!0,o.getInRows(),o.getType());if(l==Asc.c_oAscError.ID.No)i.api.asc_addChartDrawingObject(o);else{var r=i.txtInvalidRange;switch(l){case Asc.c_oAscError.ID.StockChartError:r=i.errorStockChart;break;case Asc.c_oAscError.ID.MaxDataSeriesError:r=i.errorMaxRows;break;case Asc.c_oAscError.ID.ComboSeriesError:r=i.errorComboSeries}Common.UI.warning({msg:r,callback:function(){_.defer((function(t){Common.NotificationCenter.trigger("edit:complete",i.toolbar)}))}})}}}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onSelectSpark:function(t){if(this.editMode){var e=(s=this).api.asc_getCellInfo(),i=e.asc_getSelectionType();if(s.api&&(i==Asc.c_oAscSelectionType.RangeCells||i==Asc.c_oAscSelectionType.RangeCol||i==Asc.c_oAscSelectionType.RangeRow||i==Asc.c_oAscSelectionType.RangeMax)){var n=e.asc_getSparklineInfo();if(n){var o=new Asc.sparklineGroup;o.asc_setType(t),this.api.asc_setSparklineGroup(n.asc_getId(),o)}else{var s=this;new SSE.Views.CreateSparklineDialog({api:s.api,props:{selectedCells:s._state.selectedCells},handler:function(e,i){"ok"==e&&i&&(s.view&&s.view.fireEvent("insertspark",s.view),i.destination&&s.api.asc_addSparklineGroup(t,i.source,i.destination)),Common.NotificationCenter.trigger("edit:complete",s)}}).show()}}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onApiMathChanged:function(t){this._state.selectedCells=t.asc_getCount()},onInsertTextart:function(t){this.api&&(this.toolbar.fireEvent("inserttextart",this.toolbar),this.api.asc_addTextArt(t),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertTextArt),Common.component.Analytics.trackEvent("ToolBar","Add Text Art"))},onBtnInsertTextClick:function(t,e){this.api&&this._addAutoshape(t.pressed,"textRect"),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Text")},onInsertShapeHide:function(t,e){this.toolbar.btnInsertShape.pressed&&!this._isAddingShape&&this.toolbar.btnInsertShape.toggle(!1,!0),this._isAddingShape=!1,Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onSortType:function(t,e){Common.NotificationCenter.trigger("protect:check",this.onSortTypeCallback,this,[t,e])},onSortTypeCallback:function(t,e){if(this.api)if(this.api.asc_getCellInfo().asc_getSelectionType()==Asc.c_oAscSelectionType.RangeSlicer){for(var i=this.api.asc_getGraphicObjectProps(),n=0;n<i.length;n++)if(i[n].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var o=i[n].asc_getObjectValue();if(o.asc_getSlicerProperties()){o.asc_getSlicerProperties().asc_setSortOrder(t==Asc.c_oAscSortOptions.Ascending?Asc.ST_tabularSlicerCacheSortOrder.Ascending:Asc.ST_tabularSlicerCacheSortOrder.Descending),this.api.asc_setGraphicObjectProps(o);break}}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}else{var s=this,a=this.api.asc_sortCellsRangeExpand();switch(a){case Asc.c_oAscSelectionSortExpand.showExpandMessage:var l={width:500,title:this.txtSorting,msg:this.txtExpandSort,buttons:[{caption:this.txtExpand,primary:!0,value:"expand"},{caption:this.txtSortSelected,primary:!0,value:"sort"},"cancel"],callback:function(e){"expand"!=e&&"sort"!=e||s.api.asc_sortColFilter(t,"",void 0,void 0,"expand"==e)}};Common.UI.alert(l);break;case Asc.c_oAscSelectionSortExpand.showLockMessage:l={width:500,title:this.txtSorting,msg:this.txtLockSort,buttons:["yes","no"],primary:"yes",callback:function(e){"yes"==e&&s.api.asc_sortColFilter(t,"",void 0,void 0,!1)}};Common.UI.alert(l);break;case Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage:case Asc.c_oAscSelectionSortExpand.notExpandAndNotShowMessage:this.api.asc_sortColFilter(t,"",void 0,void 0,a===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage)}}},searchShow:function(){if(this.toolbar.btnSearch){if(this.searchBar&&this.searchBar.isVisible())return void this.searchBar.focus();this.toolbar.btnSearch.toggle(!0)}},onSearch:function(t,e){this.searchBar||(this.searchBar=new Common.UI.SearchBar({showOpenPanel:!1,width:303}),this.searchBar.on("hide",_.bind((function(){this.toolbar.btnSearch.toggle(!1,!0)}),this))),this.toolbar.btnSearch.pressed?this.searchBar.show(this.api.asc_GetSelectedText()):this.searchBar.hide()},onAutoFilter:function(t){var e=this._state.filter;this._state.filter=void 0,this.api&&(this._state.tablename||e?this.api.asc_changeAutoFilter(this._state.tablename,Asc.c_oAscChangeFilterOptions.filter,!e):this.api.asc_addAutoFilter()),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Auto filter")},onClearFilter:function(t){this.api&&this.api.asc_clearFilter(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Clear filter")},onNumberFormat:function(t){this.api&&this.api.asc_setCellStyle(t.options.styleName),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatMenu:function(t,e){if(this.api)if(-1==e.value)if(this._state.numformatinfo&&this._state.numformatinfo.asc_getType()==Asc.c_oAscNumFormatType.Accounting)this.onCustomNumberFormat();else{var i,n=this.api.asc_getLocale();!n&&(n=this.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.toolbar.mode.lang)):1033),(i=new Asc.asc_CFormatCellsInfo).asc_setType(Asc.c_oAscNumFormatType.Accounting),i.asc_setSeparator(!1),i.asc_setSymbol(n);var o=this.api.asc_getFormatCells(i);this.onCustomNumberFormat(o&&o.length>0?o[0]:void 0,i)}else(i=new Asc.asc_CFormatCellsInfo).asc_setType(Asc.c_oAscNumFormatType.Accounting),i.asc_setSeparator(!1),i.asc_setSymbol(e.value),(o=this.api.asc_getFormatCells(i))&&o.length>0&&this.api.asc_setCellFormat(o[0]);Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatSelect:function(t,e){e?this.api&&this.api.asc_setCellFormat(e.format):this.onCustomNumberFormat(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onCustomNumberFormat:function(t,e){var i=this,n=i.api.asc_getLocale();!n&&(n=i.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(i.toolbar.mode.lang)):1033),new SSE.Views.FormatSettingsDialog({api:i.api,handler:function(t,e){e&&i.api.asc_setCellFormat(e.format),Common.NotificationCenter.trigger("edit:complete",i.toolbar)},props:{format:t||i._state.numformat,formatInfo:e||i._state.numformatinfo,langId:n}}).show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatOpenBefore:function(t){if(this.api){var e=this,i=e.api.asc_getLocale();if(!i&&(i=e.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(e.toolbar.mode.lang)):1033),this._state.langId!==i){this._state.langId=i;var n=new Asc.asc_CFormatCellsInfo;n.asc_setType(Asc.c_oAscNumFormatType.None),n.asc_setSymbol(this._state.langId);var o=this.api.asc_getFormatCells(n);e.toolbar.numFormatData.forEach((function(t,i){e.toolbar.numFormatData[i].format=o[i]}))}e.toolbar.numFormatData.forEach((function(t,i){t.exampleval=e.api.asc_getLocaleExample(t.format)})),e.toolbar.cmbNumberFormat.setData(e.toolbar.numFormatData),e.toolbar.cmbNumberFormat.setValue(e._state.numformattype,e.toolbar.txtCustom)}},onDecrement:function(t){this.api&&this.api.asc_decreaseCellDigitNumbers(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Decrement")},onIncrement:function(t){this.api&&this.api.asc_increaseCellDigitNumbers(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Increment")},onInsertFormulaMenu:function(t,e,i){if(this.api)if("more"===e.value){var n=this.getApplication().getController("FormulaDialog");n&&n.showDialog()}else e.value=e.value||"SUM",this.toolbar.fireEvent("function:apply",[{name:this.api.asc_getFormulaLocaleName(e.value),origin:e.value},!0]),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Insert formula")},onNamedRangeMenu:function(t,e,i){if(this.api){var n=this;if("paste"===e.value)new SSE.Views.NamedRangePasteDlg({handler:function(t,e){"ok"==t&&e&&(n.api.asc_insertInCell(e.asc_getName(!0),e.asc_getType()===Asc.c_oAscDefNameType.table?Asc.c_oAscPopUpSelectorType.Table:Asc.c_oAscPopUpSelectorType.Range,!1),Common.component.Analytics.trackEvent("ToolBar","Paste Named Range")),Common.NotificationCenter.trigger("edit:complete",n.toolbar)},ranges:n.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.WorksheetWorkbook)}).show(),Common.component.Analytics.trackEvent("ToolBar","Paste Named Range");else{var o=n.api.asc_getWorksheetsCount(),s=-1,a=[],l=[];if("new"===e.value){if(this._state.namedrange_locked)return void Common.NotificationCenter.trigger("namedrange:locked");for(;++s<o;)this.api.asc_isWorksheetHidden(s)||a.push({displayValue:n.api.asc_getWorksheetName(s),value:s});new SSE.Views.NamedRangeEditDlg({api:n.api,handler:function(t,e){"ok"==t&&e&&(n.api.asc_setDefinedNames(e),Common.component.Analytics.trackEvent("ToolBar","New Named Range")),Common.NotificationCenter.trigger("edit:complete",n.toolbar)},sheets:a,props:n.api.asc_getDefaultDefinedName(),isEdit:!1}).show()}else{for(var r=this.getApplication().getController("CellEditor");++s<o;)this.api.asc_isWorksheetHidden(s)||(l[s]=n.api.asc_getWorksheetName(s),a.push({displayValue:l[s],value:s}));new SSE.Views.NameManagerDlg({api:n.api,handler:function(t){Common.component.Analytics.trackEvent("ToolBar","Name Manager"),Common.NotificationCenter.trigger("edit:complete",n.toolbar)},locked:n._state.namedrange_locked,sheets:a,sheetNames:l,ranges:n.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All),props:n.api.asc_getDefaultDefinedName(),sort:r.rangeListSort}).on("close",(function(t){r.rangeListSort=t.getSettings()})).show()}}}},onNamedRangeMenuOpen:function(t){if(this.api&&t){var e=this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.WorksheetWorkbook);t.items[2].setDisabled(e.length<1)}},onClearStyleMenu:function(t,e,i){(e.value!=Asc.c_oAscCleanOptions.Format||this._state.wsProps.FormatCells&&this.api.asc_checkLockedCells())&&(e.value!=Asc.c_oAscCleanOptions.All||this.api.asc_checkLockedCells())?e.value==Asc.c_oAscCleanOptions.Comments?this._state.wsProps.Objects?Common.NotificationCenter.trigger("showerror",Asc.c_oAscError.ID.ChangeOnProtectedSheet,Asc.c_oAscError.Level.NoCritical):this.onClearStyleMenuCallback(t,e):Common.NotificationCenter.trigger("protect:check",this.onClearStyleMenuCallback,this,[t,e]):this.onClearStyleMenuCallback(t,e)},onClearStyleMenuCallback:function(t,e,i){this.api&&(e.value==Asc.c_oAscCleanOptions.Comments?this.api.asc_RemoveAllComments(!this.mode.canDeleteComments,!0):this.api.asc_emptyCells(e.value,e.value==Asc.c_oAscCleanOptions.All&&!this.mode.canDeleteComments)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Clear")},onCopyStyleToggle:function(t,e,i){this.api&&this.api.asc_formatPainter(e?1:0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),this.modeAlwaysSetStyle=e},onCellInsertMenu:function(t,e,i){this.api&&this.api.asc_insertCells(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Cell insert")},onCellDeleteMenu:function(t,e,i){this.api&&this.api.asc_deleteCells(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Cell delete")},onColorSchemaClick:function(t,e){this.api&&(this.api.asc_ChangeColorSchemeByIdx(e.value),Common.component.Analytics.trackEvent("ToolBar","Color Scheme")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onColorSchemaShow:function(t){if(this.api){var e=this.api.asc_GetCurrentColorSchemeIndex(),i=_.find(t.items,(function(t){return t.value==e}));i?i.setChecked(!0):t.clearAll()}},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onFontNameSelect:function(t,e){this.api&&(e.isNewFont?!Common.Utils.ModalWindow.isVisible()&&Common.UI.warning({width:500,msg:this.confirmAddFontName,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t){"yes"==t?(this.api.asc_setCellFontName(e.name),Common.component.Analytics.trackEvent("ToolBar","Font Name")):this.toolbar.cmbFontName.setValue(this.api.asc_getCellInfo().asc_getXfs().asc_getFontName()),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})}),this)}):(this.api.asc_setCellFontName(e.name),Common.component.Analytics.trackEvent("ToolBar","Font Name"))),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})},onComboOpen:function(t,e){_.delay((function(){var i=$("input",e.cmpEl).select();t?i.focus():e.isMenuOpen()||i.one("mouseup",(function(t){t.preventDefault()}))}),10)},onFontSizeSelect:function(t,e){this._state.fontsize=void 0,this.api&&this.api.asc_setCellFontSize(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onFontSizeChanged:function(t,e,i,n){var o,s=this;if(t){if(!e.store.findWhere({displayValue:i.value})&&!(o=/^\+?(\d*(\.|,)?\d+)$|^\+?(\d+(\.|,)?\d*)$/.exec(i.value)))return o=this._getApiTextSize(),setTimeout((function(){Common.UI.warning({msg:s.textFontSizeErr,callback:function(){_.defer((function(t){$("input",e.cmpEl).focus()}))}})}),1),e.setRawValue(o),n.preventDefault(),!1}else o=(o=Common.Utils.String.parseFloat(i.value))>409?409:o<1?1:Math.floor(2*(o+.4))/2,e.setRawValue(o),this._state.fontsize=void 0,this.api&&this.api.asc_setCellFontSize(o),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onListStyleSelect:function(t,e){this._state.prstyle=void 0,this.api&&(this.api.asc_setCellStyle(e.get("name")),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Style"))},onShowBeforeCondFormat:function(t,e){if(!(t.mnuDataBars.menu.items.length>0)){t.btnCondFormat.menu.on("item:click",_.bind(this.onCondFormatMenu,this));for(var i=0;i<7;i++)t.btnCondFormat.menu.items[i].menu.on("item:click",_.bind(this.onCondFormatMenu,this));t.btnCondFormat.menu.items[15].menu.on("item:click",_.bind(this.onCondFormatMenu,this));var n=SSE.getCollection("ConditionalFormatIconsPresets");n.length<1&&SSE.getController("Main").fillCondFormatIconsPresets(this.api.asc_getCFIconsByType());var o=SSE.getCollection("ConditionalFormatIcons");o.length<1&&SSE.getController("Main").fillCondFormatIcons(this.api.asc_getFullCFIcons());var s=this,a=t.mnuDataBars;a.menu.addItem(new Common.UI.MenuItem({template:_.template('<div id="id-'+e+'-menu-databar" class="menu-shapes" style="margin-left: 5px; width: 203px;"></div>')}));var l=new Common.UI.DataViewSimple({el:$("#id-"+e+"-menu-databar",a.$el),parentMenu:a.menu,itemTemplate:_.template('<div class="item-databar" id="<%= id %>"><svg width="25" height="25" class="icon"><use xlink:href="#bar-<%= data.name %>"></use></svg></div>')});l.on("item:click",(function(e,i,n,o){s.api&&(n&&s.api.asc_setCF([],[],[Asc.c_oAscCFRuleTypeSettings.dataBar,n.get("data").index]),"click"!==o.type&&t.btnCondFormat.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t,t.btnCondFormat))}));var r=[{data:{name:"gradient-blue",index:0}},{data:{name:"gradient-green",index:1}},{data:{name:"gradient-red",index:2}},{data:{name:"gradient-yellow",index:3}},{data:{name:"gradient-lightblue",index:4}},{data:{name:"gradient-purple",index:5}},{data:{name:"solid-blue",index:6}},{data:{name:"solid-green",index:7}},{data:{name:"solid-red",index:8}},{data:{name:"solid-yellow",index:9}},{data:{name:"solid-lightblue",index:10}},{data:{name:"solid-purple",index:11}}];l.setStore(new Common.UI.DataViewStore(r)),(a=t.mnuColorScales).menu.addItem(new Common.UI.MenuItem({template:_.template('<div id="id-'+e+'-menu-colorscales" class="menu-shapes" style="margin-left: 5px; width: 136px;"></div>')})),(l=new Common.UI.DataViewSimple({el:$("#id-"+e+"-menu-colorscales",a.$el),parentMenu:a.menu,itemTemplate:_.template('<div class="item-colorscale" id="<%= id %>"><svg width="25" height="25" class="icon"><use xlink:href="#color-scale-<%= data.name %>"></use></svg></div>')})).on("item:click",(function(e,i,n,o){s.api&&(n&&s.api.asc_setCF([],[],[Asc.c_oAscCFRuleTypeSettings.colorScale,n.get("data").index]),"click"!==o.type&&t.btnCondFormat.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t,t.btnCondFormat))})),r=[{data:{name:"green-yellow-red",index:0}},{data:{name:"red-yellow-green",index:1}},{data:{name:"green-white-red",index:2}},{data:{name:"red-white-green",index:3}},{data:{name:"blue-white-red",index:4}},{data:{name:"red-white-blue",index:5}},{data:{name:"white-red",index:6}},{data:{name:"red-white",index:7}},{data:{name:"green-white",index:8}},{data:{name:"white-green",index:9}},{data:{name:"green-yellow",index:10}},{data:{name:"yellow-green",index:11}}],l.setStore(new Common.UI.DataViewStore(r)),(a=t.mnuIconSets).menu.addItem(new Common.UI.MenuItem({template:_.template('<div id="id-'+e+'-menu-iconsets" class="menu-iconsets" style="width: 227px;"></div>')})),r=[];var c=[Asc.EIconSetType.Arrows3,Asc.EIconSetType.Arrows3Gray,Asc.EIconSetType.Triangles3,Asc.EIconSetType.Arrows4Gray,Asc.EIconSetType.Arrows4,Asc.EIconSetType.Arrows5Gray,Asc.EIconSetType.Arrows5];for(i=0;i<c.length;i++)r.push({group:"menu-iconset-group-direct",data:{index:c[i],iconSet:n.at([c[i]]).get("icons"),icons:o}});c=[Asc.EIconSetType.Traffic3Lights1,Asc.EIconSetType.Traffic3Lights2,Asc.EIconSetType.Signs3,Asc.EIconSetType.Traffic4Lights,Asc.EIconSetType.RedToBlack4];for(i=0;i<c.length;i++)r.push({group:"menu-iconset-group-shape",data:{index:c[i],iconSet:n.at([c[i]]).get("icons"),icons:o}});c=[Asc.EIconSetType.Symbols3,Asc.EIconSetType.Symbols3_2,Asc.EIconSetType.Flags3];for(i=0;i<c.length;i++)r.push({group:"menu-iconset-group-indicator",data:{index:c[i],iconSet:n.at([c[i]]).get("icons"),icons:o}});c=[Asc.EIconSetType.Stars3,Asc.EIconSetType.Rating4,Asc.EIconSetType.Quarters5,Asc.EIconSetType.Rating5,Asc.EIconSetType.Boxes5];for(i=0;i<c.length;i++)r.push({group:"menu-iconset-group-rating",data:{index:c[i],iconSet:n.at([c[i]]).get("icons"),icons:o}});(l=new Common.UI.DataView({el:$("#id-"+e+"-menu-iconsets",a.$el),parentMenu:a.menu,groups:new Common.UI.DataViewGroupStore([{id:"menu-iconset-group-direct",caption:this.textDirectional},{id:"menu-iconset-group-shape",caption:this.textShapes},{id:"menu-iconset-group-indicator",caption:this.textIndicator},{id:"menu-iconset-group-rating",caption:this.textRating}]),store:new Common.UI.DataViewStore(r),showLast:!1,itemTemplate:_.template('<div class="item-iconset" id="<%= id %>"><% _.each(data.iconSet, function(icon) { %><img src="<%= data.icons.at(icon-1).get(\'icon\') %>" style="width:16px;height:16px;"><% }) %></div>')})).on("item:click",(function(e,i,n,o){s.api&&(n&&s.api.asc_setCF([],[],[Asc.c_oAscCFRuleTypeSettings.icons,n.get("data").index]),"click"!==o.type&&t.btnCondFormat.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t,t.btnCondFormat))}))}},onCondFormatMenu:function(t,e){var i=this,n=this.api.asc_getLocale();!n&&(n=this.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.toolbar.mode.lang)):1033),"manage"==e.value?new SSE.Views.FormatRulesManagerDlg({api:i.api,langId:n,locked:!!i._state.cf_locked[this.api.asc_getActiveWorksheetIndex()],handler:function(t,e){i&&i.api&&"ok"==t&&i.api.asc_setCF(e.rules,e.deleted)}}).show():"clear"==e.value?i.api.asc_clearCF(e.options.type):new SSE.Views.FormatRulesEditDlg({api:i.api,props:null,type:e.options.type,subtype:e.value,percent:e.options.percent,isEdit:!1,langId:n,handler:function(t,e){"ok"==t&&e&&i.api.asc_setCF([e],[])}}).show()},createDelayedElements:function(){var t=this;this.toolbar.createDelayedElements(),this.attachUIEvents(this.toolbar),this.appConfig.isEditDiagram||this.appConfig.isEditMailMerge||this.appConfig.isEditOle||(this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.onApiSheetChanged,this)),this.api.asc_registerCallback("asc_onUpdateSheetViewSettings",_.bind(this.onApiSheetChanged,this)),this.api.asc_registerCallback("asc_onEndAddShape",_.bind(this.onApiEndAddShape,this)),this.api.asc_registerCallback("asc_onEditorSelectionChanged",_.bind(this.onApiEditorSelectionChanged,this)),this.api.asc_registerCallback("asc_onUpdateDocumentProps",_.bind(this.onUpdateDocumentProps,this)),this.api.asc_registerCallback("asc_onLockDocumentProps",_.bind(this.onApiLockDocumentProps,this)),this.api.asc_registerCallback("asc_onUnLockDocumentProps",_.bind(this.onApiUnLockDocumentProps,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this))),this.appConfig.isEditOle&&this.api.asc_registerCallback("asc_onEditorSelectionChanged",_.bind(this.onApiEditorSelectionChanged_OleEditor,this)),this.appConfig.isEditMailMerge||this.applyFormulaSettings(),this.api.asc_registerCallback("asc_onShowChartDialog",_.bind(this.onApiChartDblClick,this)),this.api.asc_registerCallback("asc_onCanUndoChanged",_.bind(this.onApiCanRevert,this,"undo")),this.api.asc_registerCallback("asc_onCanRedoChanged",_.bind(this.onApiCanRevert,this,"redo")),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onStopFormatPainter",_.bind(this.onApiStyleChange,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChanged,this));var e={"command+l,ctrl+l":function(e){if(t.editMode&&!t._state.multiselect&&t.appConfig.canModifyFilter&&!t._state.wsLock){var i=t.api.asc_getCellInfo(),n=i.asc_getAutoFilterInfo(),o=i.asc_getFormatTableInfo();null===(n=n?n.asc_getIsAutoFilter():null)||o||t._setTableFormat(t.api.asc_getDefaultTableStyle())}return!1},"command+shift+l,ctrl+shift+l":function(e){if(t.editMode&&t.api&&!t._state.multiselect&&t.appConfig.canModifyFilter&&!t._state.wsLock){var i=t._state.filter;t._state.filter=void 0,t._state.tablename||i?t.api.asc_changeAutoFilter(t._state.tablename,Asc.c_oAscChangeFilterOptions.filter,!i):t.api.asc_addAutoFilter()}return!1},"command+s,ctrl+s":function(e){t.onSave(),e.preventDefault(),e.stopPropagation()},"command+k,ctrl+k":function(e){!t.editMode||t.toolbar.mode.isEditMailMerge||t.toolbar.mode.isEditDiagram||t.toolbar.mode.isEditOle||t.api.isCellEdited||t._state.multiselect||t._state.inpivot||t.getApplication().getController("LeftMenu").leftMenu.menuFile.isVisible()||t._state.wsProps.InsertHyperlinks||(t.api.asc_getCellInfo().asc_getSelectionType()===Asc.c_oAscSelectionType.RangeShapeText&&!1===t.api.asc_canAddShapeHyperlink()||t.onHyperlink());e.preventDefault()},"command+1,ctrl+1":function(e){return!t.editMode||t.toolbar.mode.isEditMailMerge||t.toolbar.mode.isEditOle||t.api.isCellEdited||t.toolbar.cmbNumberFormat.isDisabled()||t.onCustomNumberFormat(),!1},"shift+f3":function(e){if(t.editMode&&!t.toolbar.btnInsertFormula.isDisabled()){var i=t.getApplication().getController("FormulaDialog");i&&i.showDialog()}return!1}};e["command+shift+=,ctrl+shift+="+(Common.Utils.isGecko?",command+shift+ff=,ctrl+shift+ff=":"")]=function(e){if(t.editMode&&!t.toolbar.btnAddCell.isDisabled()){var i=t.api.asc_getCellInfo().asc_getSelectionType();if(i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeCol)i===Asc.c_oAscSelectionType.RangeRow&&!t.toolbar.btnAddCell.menu.items[2].isDisabled()&&t.api.asc_insertCells(Asc.c_oAscInsertOptions.InsertRows),i===Asc.c_oAscSelectionType.RangeCol&&!t.toolbar.btnAddCell.menu.items[3].isDisabled()&&t.api.asc_insertCells(Asc.c_oAscInsertOptions.InsertColumns),Common.NotificationCenter.trigger("edit:complete",t.toolbar);else{for(var n=t.toolbar.btnAddCell.menu.items,o=[],s=!1,a=0;a<4;a++)o.push({caption:n[a].caption,value:n[a].value,disabled:n[a].isDisabled()}),!n[a].isDisabled()&&(s=!0);s&&new Common.Views.OptionsDialog({title:t.txtInsertCells,items:o,handler:function(e,i){"ok"==i&&t.api.asc_insertCells(e.getSettings()),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()}}return!1},e["command+shift+-,ctrl+shift+-"+(Common.Utils.isGecko?",command+shift+ff-,ctrl+shift+ff-":"")]=function(e){if(t.editMode&&!t.toolbar.btnDeleteCell.isDisabled()){var i=t.api.asc_getCellInfo().asc_getSelectionType();if(i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeCol)t.api.asc_deleteCells(i===Asc.c_oAscSelectionType.RangeRow?Asc.c_oAscDeleteOptions.DeleteRows:Asc.c_oAscDeleteOptions.DeleteColumns),Common.NotificationCenter.trigger("edit:complete",t.toolbar);else{for(var n=t.toolbar.btnDeleteCell.menu.items,o=[],s=!1,a=0;a<4;a++)o.push({caption:n[a].caption,value:n[a].value,disabled:n[a].isDisabled()}),!n[a].isDisabled()&&(s=!0);s&&new Common.Views.OptionsDialog({title:t.txtDeleteCells,items:o,handler:function(e,i){"ok"==i&&t.api.asc_deleteCells(e.getSettings()),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()}}return!1},Common.util.Shortcuts.delegateShortcuts({shortcuts:e}),this.onChangeProtectSheet(),this.attachToControlEvents(),this.onApiSheetChanged(),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this))},onChangeViewMode:function(t,e){this.toolbar.setFolded(e),this.toolbar.fireEvent("view:compact",[this,e]),Common.localStorage.setBool("sse-compact-toolbar",e),Common.NotificationCenter.trigger("layout:changed","toolbar"),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onClickChangeCompact:function(t){"file"!=t&&Common.Utils.asyncCall((function(){this.onChangeViewMode(null,!this.toolbar.isCompact())}),this)},fillTableTemplates:function(){if(this.toolbar.btnTableTemplate.rendered){var t,e,i,n=this;_.isUndefined(this.toolbar.mnuTableTemplatePicker)&&(this.toolbar.mnuTableTemplatePicker=(t=$("#id-toolbar-menu-table-templates"),e=this.toolbar.btnTableTemplate.menu,(i=new Common.UI.DataView({el:t,parentMenu:e,restoreHeight:300,style:"max-height: 300px;",store:n.getCollection("TableTemplates"),itemTemplate:_.template('<div class="item-template"><img src="<%= imageUrl %>" id="<%= id %>" style="width:60px;height:44px;"></div>'),delayRenderTips:!0})).on("item:click",(function(t,e,i){n.api&&(n._state.tablestylename=null,n._setTableFormat(i?i.get("name"):n.api.asc_getDefaultTableStyle()),Common.NotificationCenter.trigger("edit:complete",n.toolbar),Common.component.Analytics.trackEvent("ToolBar","Table Templates"))})),i.scroller&&i.scroller.update({alwaysVisibleY:!0}),i))}},onTableTplMenuOpen:function(t){if(this.onApiInitTableTemplates(this.api.asc_getTablePictures(this.api.asc_getCellInfo().asc_getFormatTableInfo())),t&&this.toolbar.mnuTableTemplatePicker){var e=this.toolbar.mnuTableTemplatePicker;if(e.cmpEl){var i=$(e.cmpEl.find(".dataview.inner .item-template").get(0)).parent(),n=i.is(":visible")?parseFloat(i.css("width")):60,o=7*(8+n)+11,s=parseFloat(e.cmpEl.css("margin-left"))+parseFloat(e.cmpEl.css("margin-right"));o+s>Common.Utils.innerWidth()&&(o=Math.max(Math.floor((Common.Utils.innerWidth()-s-11)/(8+n)),2)*(8+n)+11),e.cmpEl.css({width:o}),t.alignPosition()}}var a=this.toolbar.mnuTableTemplatePicker.scroller;a&&(a.update({alwaysVisibleY:!0}),a.scrollTop(0));var l=this.toolbar.mnuTableTemplatePicker.store.findWhere({name:this._state.tablestylename});l?this.toolbar.mnuTableTemplatePicker.selectRecord(l):this.toolbar.mnuTableTemplatePicker.deselectAll()},onSendThemeColors:function(){this.toolbar.btnTableTemplate.rendered&&this.toolbar.btnTableTemplate.cmpEl.hasClass("open")&&this.onTableTplMenuOpen()},onApiInitTableTemplates:function(t){var e=this,i=this.getCollection("TableTemplates");if(i){var n=[];_.each(t,(function(t){var i=t.asc_getDisplayName();if(0==t.asc_getType()){var o=i.split(" "),s=o.pop();o="txtTable_"+o.join(""),i=e[o]?e[o]+" "+s:i}n.push({name:t.asc_getName(),caption:t.asc_getDisplayName(),type:t.asc_getType(),imageUrl:t.asc_getImage(),allowSelected:!0,selected:!1,tip:i})})),i.reset(n)}this.fillTableTemplates()},onApiInitEditorStyles:function(t){window.styles_loaded=!1;var e=this.toolbar.listStyles;if(e){var i=this.getApplication().getController("Main"),n=e.menuPicker.store.length,o=e.menuPicker.getSelectedRec();if(n>0&&n==t.length){var s=e.menuPicker.dataViewItems;s&&_.each(t,(function(t,e){var n=t.asc_getImage();s[e].model.set("imageUrl",n,{silent:!0}),s[e].model.set({name:t.asc_getName(),tip:i.translationTable[t.get_Name()]||t.get_Name()}),$(s[e].el).find("img").attr("src",n)}))}else{var a=[];_.each(t,(function(t){a.push({imageUrl:t.asc_getImage(),name:t.asc_getName(),tip:i.translationTable[t.get_Name()]||t.get_Name(),uid:Common.UI.getId()})})),e.menuPicker.store.reset(a)}e.menuPicker.store.length>0&&e.rendered&&(o=o?e.menuPicker.store.findWhere({name:o.get("name")}):null,e.fillComboView(o||e.menuPicker.store.at(0),!0,!0)),window.styles_loaded=!0}else this.styles=t},onHomeOpen:function(){var t,e=this.toolbar.listStyles;e&&e.needFillComboView&&e.menuPicker.store.length>0&&e.rendered&&(this._state.prstyle&&(t=e.menuPicker.store.findWhere({name:this._state.prstyle})),e.fillComboView(t||e.menuPicker.store.at(0),!0))},onApiCoAuthoringDisconnect:function(t){this.toolbar.setMode({isDisconnected:!0,enableDownload:!!t}),this.editMode=!1},onApiChartDblClick:function(){this.onEditChart(this.btnInsertChart)},onApiCanRevert:function(t,e){"undo"==t?this._state.can_undo!==e&&(this.toolbar.btnUndo.setDisabled(!e),this._state.can_undo=e):this._state.can_redo!==e&&(this.toolbar.btnRedo.setDisabled(!e),this._state.can_redo=e)},setDisabledComponents:function(t,e){_.each([].concat(t),(function(t){t.isDisabled()!==e&&t.setDisabled(e)}))},onApiEditCell:function(t){if(!($(".asc-window.enable-key-events:visible").length>0)){var e=this.toolbar;if(e.mode.isEditDiagram||e.mode.isEditMailMerge){var i=t==Asc.c_oAscCellEditorState.editStart;e.lockToolbar(Common.enumLock.editCell,t==Asc.c_oAscCellEditorState.editStart,{array:[e.btnDecDecimal,e.btnIncDecimal,e.cmbNumberFormat,e.btnEditChartData,e.btnEditChartType]})}else if(e.mode.isEditOle)if(t==Asc.c_oAscCellEditorState.editStart||t==Asc.c_oAscCellEditorState.editEnd){i=t==Asc.c_oAscCellEditorState.editStart;e.lockToolbar(Common.enumLock.editCell,t==Asc.c_oAscCellEditorState.editStart,{array:[e.cmbNumberFormat,e.btnWrap,e.btnMerge,e.btnBackColor,e.btnBorders,e.btnTableTemplate,e.btnHorizontalAlign,e.btnVerticalAlign],merge:!0,clear:[Common.enumLock.editFormula,Common.enumLock.editText]}),i?Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l"):Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l")}else{if(t==Asc.c_oAscCellEditorState.editText)var n=!0,o=!1;else t==Asc.c_oAscCellEditorState.editFormula?n=!(o=!0):t==Asc.c_oAscCellEditorState.editEmptyCell&&(n=o=!1);e.lockToolbar(Common.enumLock.editFormula,o,{array:[e.cmbFontName,e.cmbFontSize,e.btnTextFormatting,e.btnTextColor]}),e.lockToolbar(Common.enumLock.editText,n,{array:[e.btnInsertFormula]})}else if(t==Asc.c_oAscCellEditorState.editStart||t==Asc.c_oAscCellEditorState.editEnd){e.lockToolbar(Common.enumLock.editCell,t==Asc.c_oAscCellEditorState.editStart,{array:[e.btnClearStyle.menu.items[1],e.btnClearStyle.menu.items[2],e.btnClearStyle.menu.items[3],e.btnClearStyle.menu.items[4],e.btnNamedRange.menu.items[0],e.btnNamedRange.menu.items[1]].concat(e.itemsNamedRange),merge:!0,clear:[Common.enumLock.editFormula,Common.enumLock.editText]}),(i=t==Asc.c_oAscCellEditorState.editStart)?Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, alt+h, command+1, ctrl+1"):Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, alt+h, command+1, ctrl+1"),i&&(e.listStyles.suspendEvents(),e.listStyles.menuPicker.selectRecord(null),e.listStyles.resumeEvents(),this._state.prstyle=void 0),this.appConfig.isDesktopApp&&this.appConfig.canProtect&&this.getApplication().getController("Common.Controllers.Protection").SetDisabled(i,!1)}else{if(t==Asc.c_oAscCellEditorState.editText)n=!0,o=!1;else t==Asc.c_oAscCellEditorState.editFormula?n=!(o=!0):t==Asc.c_oAscCellEditorState.editEmptyCell&&(n=o=!1);e.lockToolbar(Common.enumLock.editFormula,o,{array:[e.cmbFontName,e.cmbFontSize,e.btnIncFontSize,e.btnDecFontSize,e.btnBold,e.btnItalic,e.btnUnderline,e.btnStrikeout,e.btnSubscript,e.btnTextColor]}),e.lockToolbar(Common.enumLock.editText,n,{array:[e.btnInsertFormula].concat(e.btnsFormula)})}this._state.coauthdisable=void 0,this._state.selection_type=void 0,this.checkInsertAutoshape({action:"cancel"})}},onApiZoomChange:function(t,e){},onApiSheetChanged:function(){if(this.toolbar.mode&&this.toolbar.mode.isEdit&&!this.toolbar.mode.isEditDiagram&&!this.toolbar.mode.isEditMailMerge&&!this.toolbar.mode.isEditOle){var t=this.api.asc_getActiveWorksheetIndex(),e=this.api.asc_getPageOptions(t),i=e.asc_getPageSetup();this.onApiPageOrient(i.asc_getOrientation()),this.onApiPageSize(i.asc_getWidth(),i.asc_getHeight()),this.onApiPageMargins(e.asc_getPageMargins()),this.onChangeScaleSettings(i.asc_getFitToWidth(),i.asc_getFitToHeight(),i.asc_getScale()),this.onApiGridLines(e.asc_getGridLines()),this.onApiHeadings(e.asc_getHeadings()),this.api.asc_isLayoutLocked(t)?this.onApiLockDocumentProps(t):this.onApiUnLockDocumentProps(t),this.toolbar.lockToolbar(Common.enumLock.printAreaLock,this.api.asc_isPrintAreaLocked(t),{array:[this.toolbar.btnPrintArea]})}},onUpdateDocumentProps:function(t){t==this.api.asc_getActiveWorksheetIndex()&&this.onApiSheetChanged()},onApiGridLines:function(t){this.toolbar.chPrintGridlines.setValue(t,!0)},onApiHeadings:function(t){this.toolbar.chPrintHeadings.setValue(t,!0)},onApiPageSize:function(t,e){void 0!==this._state.pgorient&&(Math.abs(this._state.pgsize[0]-t)>.1||Math.abs(this._state.pgsize[1]-e)>.1)&&(this._state.pgsize=[t,e],this.toolbar.mnuPageSize&&(this.toolbar.mnuPageSize.clearAll(),_.each(this.toolbar.mnuPageSize.items,(function(i){if(i.value&&"object"==typeof i.value&&Math.abs(i.value[0]-t)<.1&&Math.abs(i.value[1]-e)<.1)return i.setChecked(!0),!1}),this)))},onApiPageMargins:function(t){if(t){var e=t.asc_getLeft(),i=t.asc_getTop(),n=t.asc_getRight(),o=t.asc_getBottom();(!this._state.pgmargins||Math.abs(this._state.pgmargins[0]-i)>.1||Math.abs(this._state.pgmargins[1]-e)>.1||Math.abs(this._state.pgmargins[2]-o)>.1||Math.abs(this._state.pgmargins[3]-n)>.1)&&(this._state.pgmargins=[i,e,o,n],this.toolbar.btnPageMargins.menu&&(this.toolbar.btnPageMargins.menu.clearAll(),_.each(this.toolbar.btnPageMargins.menu.items,(function(t){if(t.value&&"object"==typeof t.value&&Math.abs(t.value[0]-i)<.1&&Math.abs(t.value[1]-e)<.1&&Math.abs(t.value[2]-o)<.1&&Math.abs(t.value[3]-n)<.1)return t.setChecked(!0),!1}),this)))}},onApiPageOrient:function(t){this._state.pgorient!==t&&(this.toolbar.btnPageOrient.menu.items[t==Asc.c_oAscPageOrientation.PagePortrait?0:1].setChecked(!0),this._state.pgorient=t)},onChangeScaleSettings:function(t,e,i){if(this.toolbar.btnScale.menu)if(void 0!==t){var n=!1,o=!1;t=t||0,e=e||0;void 0!==i?this.toolbar.setValueCustomScale(i):this.toolbar.setValueCustomScale(this.api.asc_getPageOptions().asc_getPageSetup().asc_getScale()),this.toolbar.menuWidthScale.clearAll(),this.toolbar.menuWidthScale.items.forEach((function(e){if(e.value===t)return e.setChecked(!0),n=!0,!1})),n||this.toolbar.menuWidthScale.items[11].setChecked(!0),this.toolbar.menuHeightScale.clearAll(),this.toolbar.menuHeightScale.items.forEach((function(t){if(t.value===e)return t.setChecked(!0),o=!0,!1})),o||this.toolbar.menuHeightScale.items[11].setChecked(!0),this.toolbar.btnCustomScaleUp&&this.toolbar.btnCustomScaleDown&&(this.toolbar.btnCustomScaleUp.setDisabled(!(!t&&!e)),this.toolbar.btnCustomScaleDown.setDisabled(!(!t&&!e)),this.toolbar.mnuCustomScale.setDisabled(!(!t&&!e))),this._state.scaleWidth=t,this._state.scaleHeight=e,this._state.scale=i}else this.toolbar.btnCustomScaleUp&&this.toolbar.btnCustomScaleDown&&(this.toolbar.btnCustomScaleUp.setDisabled(!(!this._state.scaleWidth&&!this._state.scaleHeight)),this.toolbar.btnCustomScaleDown.setDisabled(!(!this._state.scaleWidth&&!this._state.scaleHeight)),this.toolbar.mnuCustomScale.setDisabled(!(!this._state.scaleWidth&&!this._state.scaleHeight)))},onApiLockDocumentProps:function(t){!0!==this._state.lock_doc&&t==this.api.asc_getActiveWorksheetIndex()&&(this.toolbar.lockToolbar(Common.enumLock.docPropsLock,!0,{array:[this.toolbar.btnPageSize,this.toolbar.btnPageMargins,this.toolbar.btnPageOrient,this.toolbar.btnScale,this.toolbar.btnPrintTitles]}),this._state.lock_doc=!0)},onApiUnLockDocumentProps:function(t){!1!==this._state.lock_doc&&t==this.api.asc_getActiveWorksheetIndex()&&(this.toolbar.lockToolbar(Common.enumLock.docPropsLock,!1,{array:[this.toolbar.btnPageSize,this.toolbar.btnPageMargins,this.toolbar.btnPageOrient,this.toolbar.btnScale,this.toolbar.btnPrintTitles]}),this._state.lock_doc=!1)},onApiEditorSelectionChanged:function(t){if(this.editMode&&!($(".asc-window.enable-key-events:visible").length>0)){var e,i=this.toolbar;if(Common.NotificationCenter.trigger("fonts:change",t),!i.mode.isEditMailMerge&&!i.mode.isEditDiagram&&!i.mode.isEditOle){e=t.asc_getFontBold(),this._state.bold!==e&&(i.btnBold.toggle(!0===e,!0),this._state.bold=e),e=t.asc_getFontItalic(),this._state.italic!==e&&(i.btnItalic.toggle(!0===e,!0),this._state.italic=e),e=t.asc_getFontUnderline(),this._state.underline!==e&&(i.btnUnderline.toggle(!0===e,!0),this._state.underline=e),e=t.asc_getFontStrikeout(),this._state.strikeout!==e&&(i.btnStrikeout.toggle(!0===e,!0),this._state.strikeout=e);var n=t.asc_getFontSubscript(),o=t.asc_getFontSuperscript();if(this._state.subscript!==n||this._state.superscript!==o){var s=o?0:n?1:-1,a=i.btnSubscript;a.toggle(s>-1,!0),s<0?a.menu.clearAll():(a.menu.items[s].setChecked(!0),a.rendered&&a.$icon&&(a.$icon.removeClass(a.options.icls),a.options.icls=a.menu.items[s].options.icls,a.$icon.addClass(a.options.icls))),this._state.subscript=n,this._state.superscript=o}}var l=t.asc_getFontSize();this._state.fontsize!==l&&(i.cmbFontSize.setValue(void 0!==l?l:""),this._state.fontsize=l);var r,c,d=this.toolbar.mnuTextColorPicker;if(!d.isDummy){if(c=t.asc_getFontColor())if(c.get_auto())"auto"!==this._state.clrtext&&(d.clearSelection(),this.toolbar.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var h=typeof(r=c.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b()),effectValue:c.get_value()}:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b())),p=typeof this._state.clrtext;if("auto"==this._state.clrtext||h!==p||"object"==h&&(r.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(r.color)<0)||"object"!=h&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(r)<0){if(this.toolbar.btnTextColor.setAutoColor(!1),_.isObject(r)){for(var m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==r.effectValue){d.select(r,!0),m=!0;break}m||d.clearSelection()}else d.select(r,!0);this._state.clrtext=r}}this._state.clrtext_asccolor=c}}},onApiSelectionChanged:function(t){if(this.editMode&&!($(".asc-window.enable-key-events:visible").length>0)){if(this.toolbar.mode.isEditDiagram)return this.onApiSelectionChanged_DiagramEditor(t);if(this.toolbar.mode.isEditMailMerge)return this.onApiSelectionChanged_MailMergeEditor(t);if(this.toolbar.mode.isEditOle)return this.onApiSelectionChanged_OleEditor(t);var e,i=t.asc_getSelectionType(),n=!(this.toolbar.mode.isEditMailMerge||this.toolbar.mode.isEditDiagram||this.toolbar.mode.isEditOle)&&(!0===t.asc_getLocked()||!0===t.asc_getLockedTable()||!0===t.asc_getLockedPivotTable()),o=this._disableEditOptions(i,n),s=this.toolbar,a=t.asc_getXfs(),l=!1;Common.NotificationCenter.trigger("fonts:change",a);var r=a.asc_getFontSize();this._state.fontsize!==r&&(s.cmbFontSize.setValue(void 0!==r?r:""),this._state.fontsize=r),s.lockToolbar(Common.enumLock.cantHyperlink,i===Asc.c_oAscSelectionType.RangeShapeText&&!1===this.api.asc_canAddShapeHyperlink(),{array:[s.btnInsertHyperlink]}),l=i===Asc.c_oAscSelectionType.RangeCells||i===Asc.c_oAscSelectionType.RangeCol||i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeMax,s.lockToolbar(Common.enumLock.selRange,l,{array:[s.btnImgAlign,s.btnImgBackward,s.btnImgForward,s.btnImgGroup]});var c=this.api.asc_canGroupGraphicsObjects(),d=this.api.asc_canUnGroupGraphicsObjects();s.lockToolbar(Common.enumLock.cantGroupUngroup,!c&&!d,{array:[s.btnImgGroup]}),s.btnImgGroup.menu.items[0].setDisabled(!c),s.btnImgGroup.menu.items[1].setDisabled(!d),s.lockToolbar(Common.enumLock.cantGroup,!c,{array:[s.btnImgAlign]});var h=this.api.asc_getSelectedDrawingObjectsCount();if(s.btnImgAlign.menu.items[7].setDisabled(h<3),s.btnImgAlign.menu.items[8].setDisabled(h<3),l=i===Asc.c_oAscSelectionType.RangeImage||i===Asc.c_oAscSelectionType.RangeChart||i===Asc.c_oAscSelectionType.RangeChartText||i===Asc.c_oAscSelectionType.RangeShape||i===Asc.c_oAscSelectionType.RangeShapeText||i===Asc.c_oAscSelectionType.RangeSlicer,s.lockToolbar(Common.enumLock.wsLockFormat,l&&!!this._state.wsProps.Objects&&!!this._state.is_lockText||!l&&!!this._state.wsProps.FormatCells),s.lockToolbar(Common.enumLock.wsLockFormatFill,l&&!!this._state.wsProps.Objects&&!!this._state.is_lockShape||!l&&!!this._state.wsProps.FormatCells),s.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects),s.lockToolbar(Common.enumLock.FormatCells,!!this._state.wsProps.FormatCells),!o){if(!s.mode.isEditMailMerge&&!s.mode.isEditDiagram&&!s.mode.isEditOle){e=a.asc_getFontBold(),this._state.bold!==e&&(s.btnBold.toggle(!0===e,!0),this._state.bold=e),e=a.asc_getFontItalic(),this._state.italic!==e&&(s.btnItalic.toggle(!0===e,!0),this._state.italic=e),e=a.asc_getFontUnderline(),this._state.underline!==e&&(s.btnUnderline.toggle(!0===e,!0),this._state.underline=e),e=a.asc_getFontStrikeout(),this._state.strikeout!==e&&(s.btnStrikeout.toggle(!0===e,!0),this._state.strikeout=e);var p=a.asc_getFontSubscript(),m=a.asc_getFontSuperscript();if(this._state.subscript!==p||this._state.superscript!==m){var u=m?0:p?1:-1,g=s.btnSubscript;g.toggle(u>-1,!0),u<0?g.menu.clearAll():(g.menu.items[u].setChecked(!0),g.rendered&&(g.$icon.removeClass(g.options.icls),g.options.icls=g.menu.items[u].options.icls,g.$icon.addClass(g.options.icls))),this._state.subscript=p,this._state.superscript=m}}var f,b,C=this.toolbar.mnuTextColorPicker,v=this.toolbar.mnuBackColorPicker;if(!C.isDummy){if(b=a.asc_getFontColor())if(b.get_auto())"auto"!==this._state.clrtext&&(C.clearSelection(),s.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var x=typeof(f=b.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()),effectValue:b.get_value()}:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b())),y=typeof this._state.clrtext;if("auto"==this._state.clrtext||x!==y||"object"==x&&(f.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(f.color)<0)||"object"!=x&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(f)<0){if(s.btnTextColor.setAutoColor(!1),_.isObject(f)){for(var w=!1,S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==f.effectValue){C.select(f,!0),w=!0;break}w||C.clearSelection()}else C.select(f,!0);this._state.clrtext=f}}this._state.clrtext_asccolor=b}if(!v.isDummy){if((x=typeof(f=(b=a.asc_getFillColor())&&!b.get_auto()?b.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()),effectValue:b.get_value()}:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()):"transparent"))!==(y=typeof this._state.clrback)||"object"==x&&(f.effectValue!==this._state.clrback.effectValue||this._state.clrback.color.indexOf(f.color)<0)||"object"!=x&&void 0!==this._state.clrback&&this._state.clrback.indexOf(f)<0){if(_.isObject(f)){w=!1;for(S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==f.effectValue){v.select(f,!0),w=!0;break}w||v.clearSelection()}else v.select(f,!0);this._state.clrback=f}this._state.clrshd_asccolor=b}var A=i==Asc.c_oAscSelectionType.RangeChart||i==Asc.c_oAscSelectionType.RangeChartText;if(A!==this._state.in_chart&&(s.btnInsertChart.updateHint(A?s.tipChangeChart:s.tipInsertChart),this._state.in_chart=A),!A){if(!s.mode.isEditDiagram){var k=t.asc_getAutoFilterInfo(),T=t.asc_getFormatTableInfo();if(!s.mode.isEditMailMerge){var I=a.asc_getHorAlign();if(this._state.pralign!==I){this._state.pralign=I;u=-1;switch(I){case AscCommon.align_Left:u=0,"btn-align-left";break;case AscCommon.align_Center:u=1,"btn-align-center";break;case AscCommon.align_Right:u=2,"btn-align-right";break;case AscCommon.align_Justify:u=3,"btn-align-just";break;default:u=-255,"btn-align-left"}u<0?-255==u&&(s.btnAlignRight.toggle(!1,!0),s.btnAlignLeft.toggle(!1,!0),s.btnAlignCenter.toggle(!1,!0),s.btnAlignJust.toggle(!1,!0)):(s.btnAlignRight.toggle(2===u,!0),s.btnAlignLeft.toggle(0===u,!0),s.btnAlignCenter.toggle(1===u,!0),s.btnAlignJust.toggle(3===u,!0))}if(l=I==AscCommon.align_Justify||i==Asc.c_oAscSelectionType.RangeShapeText||i==Asc.c_oAscSelectionType.RangeShape,s.btnTextOrient.menu.items[1].setDisabled(l),s.btnTextOrient.menu.items[2].setDisabled(l),s.btnTextOrient.menu.items[3].setDisabled(l),I=a.asc_getVertAlign(),this._state.valign!==I){switch(this._state.valign=I,u=-1,"",I){case Asc.c_oAscVAlign.Top:u=0,"btn-valign-top";break;case Asc.c_oAscVAlign.Center:u=1,"btn-valign-middle";break;case Asc.c_oAscVAlign.Bottom:u=2,"btn-valign-bottom"}s.btnAlignTop.toggle(0===u,!0),s.btnAlignMiddle.toggle(1===u,!0),s.btnAlignBottom.toggle(2===u,!0)}l=this._state.controlsdisabled.filters||null!==T||k&&null===k.asc_getIsAutoFilter(),s.lockToolbar(Common.enumLock.ruleMerge,l,{array:[s.btnMerge,s.btnInsertTable]}),e=t.asc_getMerge(),this._state.merge!==e&&(s.btnMerge.toggle(e===Asc.c_oAscMergeOptions.Merge,!0),this._state.merge=e),s.btnWrap.isDisabled()||(e=a.asc_getWrapText(),this._state.wrap!==e&&(s.btnWrap.toggle(!0===e,!0),this._state.wrap=e))}e=k?k.asc_getIsAutoFilter():null,this._state.filter!==e&&(s.btnsSetAutofilter.toggle(!0===e,!0),this._state.filter=e),l=this._state.controlsdisabled.filters||null===e,s.lockToolbar(Common.enumLock.ruleFilter,l,{array:s.btnsSetAutofilter.concat(s.btnCustomSort,s.btnTableTemplate,s.btnInsertTable,s.btnRemoveDuplicates,s.btnDataValidation)}),s.lockToolbar(Common.enumLock.tableHasSlicer,k&&k.asc_getIsSlicerAdded(),{array:s.btnsSetAutofilter}),l=i!==Asc.c_oAscSelectionType.RangeSlicer&&(this._state.controlsdisabled.filters||null===e),s.lockToolbar(Common.enumLock.cantSort,l,{array:s.btnsSortDown.concat(s.btnsSortUp)}),e=T?T.asc_getTableStyleName():null,this._state.tablestylename!==e&&this.toolbar.mnuTableTemplatePicker&&((e=this.toolbar.mnuTableTemplatePicker.store.findWhere({name:e}))?(this.toolbar.mnuTableTemplatePicker.selectRecord(e),this._state.tablestylename=e.get("name")):(s.mnuTableTemplatePicker.deselectAll(),this._state.tablestylename=null)),l=this._state.controlsdisabled.filters||!k||!0!==k.asc_getIsApplyAutoFilter(),s.lockToolbar(Common.enumLock.ruleDelFilter,l,{array:s.btnsClearAutofilter});var E=this._state.tablename;this._state.tablename=T?T.asc_getTableName():void 0;var D=this._state.filterapplied;this._state.filterapplied=this._state.filter&&k.asc_getIsApplyAutoFilter(),this._state.tablename===E&&this._state.filterapplied===D||this.getApplication().getController("Statusbar").onApiFilterInfo(!l),this._state.multiselect=t.asc_getMultiselect(),s.lockToolbar(Common.enumLock.multiselect,this._state.multiselect,{array:[s.btnTableTemplate,s.btnInsertHyperlink,s.btnInsertTable]}),this._state.inpivot=!!t.asc_getPivotTableInfo(),s.lockToolbar(Common.enumLock.editPivot,this._state.inpivot,{array:s.btnsSetAutofilter.concat(s.btnCustomSort,s.btnMerge,s.btnInsertHyperlink,s.btnInsertTable,s.btnRemoveDuplicates,s.btnDataValidation)}),s.lockToolbar(Common.enumLock.noSlicerSource,!(this._state.inpivot||T),{array:[s.btnInsertSlicer]}),l=!this.appConfig.canModifyFilter,s.lockToolbar(Common.enumLock.cantModifyFilter,l,{array:s.btnsSetAutofilter.concat(s.btnsSortDown,s.btnsSortUp,s.btnCustomSort,s.btnTableTemplate,s.btnClearStyle.menu.items[0],s.btnClearStyle.menu.items[2],s.btnInsertTable,s.btnRemoveDuplicates,s.btnDataValidation)})}if((e=a.asc_getNumFormatInfo())&&(this._state.numformat=a.asc_getNumFormat(),this._state.numformatinfo=e,e=e.asc_getType(),this._state.numformattype!==e&&(s.cmbNumberFormat.setValue(e,s.txtCustom),this._state.numformattype=e)),e=a.asc_getAngle(),this._state.angle!==e){switch(s.btnTextOrient.menu.clearAll(),e){case 45:s.btnTextOrient.menu.items[1].setChecked(!0,!0);break;case-45:s.btnTextOrient.menu.items[2].setChecked(!0,!0);break;case 255:s.btnTextOrient.menu.items[3].setChecked(!0,!0);break;case 90:s.btnTextOrient.menu.items[4].setChecked(!0,!0);break;case-90:s.btnTextOrient.menu.items[5].setChecked(!0,!0);break;case 0:s.btnTextOrient.menu.items[0].setChecked(!0,!0)}this._state.angle=e}if(e=t.asc_getStyleName(),this._state.prstyle!=e&&!this.toolbar.listStyles.isDisabled()){var P=this.toolbar.listStyles;if(P.rendered){P.suspendEvents();var F=P.menuPicker.store.findWhere({name:e});this._state.prstyle=P.menuPicker.store.length>0?e:void 0,P.menuPicker.selectRecord(F),P.resumeEvents()}}var R=i==Asc.c_oAscSelectionType.RangeCol,V=i==Asc.c_oAscSelectionType.RangeRow,M=i==Asc.c_oAscSelectionType.RangeMax;l=V||M&&this._state.wsLock||this._state.wsProps.InsertColumns,s.btnAddCell.menu.items[3].setDisabled(l),l=V||M&&this._state.wsLock||!R&&this._state.wsLock||this._state.wsProps.DeleteColumns,s.btnDeleteCell.menu.items[3].setDisabled(l),l=R||M&&this._state.wsLock||this._state.wsProps.InsertRows,s.btnAddCell.menu.items[2].setDisabled(l),l=R||M&&this._state.wsLock||!V&&this._state.wsLock||this._state.wsProps.DeleteRows,s.btnDeleteCell.menu.items[2].setDisabled(l),e=k&&k.asc_getIsApplyAutoFilter(),l=V||e||!(R||M)&&this._state.wsLock||R&&this._state.wsProps.InsertColumns||M&&this._state.wsProps.InsertColumns&&this._state.wsProps.InsertRows,s.btnAddCell.menu.items[0].setDisabled(l),l=V||e||!(R||M)&&this._state.wsLock||R&&this._state.wsProps.DeleteColumns||M&&this._state.wsProps.DeleteColumns&&this._state.wsProps.DeleteRows,s.btnDeleteCell.menu.items[0].setDisabled(l),l=R||e||!(V||M)&&this._state.wsLock||V&&this._state.wsProps.InsertRows||M&&this._state.wsProps.InsertColumns&&this._state.wsProps.InsertRows,s.btnAddCell.menu.items[1].setDisabled(l),l=R||e||!(V||M)&&this._state.wsLock||V&&this._state.wsProps.DeleteRows||M&&this._state.wsProps.DeleteColumns&&this._state.wsProps.DeleteRows,s.btnDeleteCell.menu.items[1].setDisabled(l);var U=s.btnAddCell.menu.items,L=!1;for(S=0;S<4;S++)!U[S].isDisabled()&&(L=!0);s.lockToolbar(Common.enumLock.itemsDisabled,!L,{array:[s.btnAddCell]}),U=this.toolbar.btnDeleteCell.menu.items,L=!1;for(S=0;S<4;S++)!U[S].isDisabled()&&(L=!0);s.lockToolbar(Common.enumLock.itemsDisabled,!L,{array:[s.btnDeleteCell]}),s.lockToolbar(Common.enumLock.commentLock,i==Asc.c_oAscSelectionType.RangeCells&&(!t.asc_getComments()||t.asc_getComments().length>0||t.asc_getLocked())||this.toolbar.mode.compatibleFeatures&&i!=Asc.c_oAscSelectionType.RangeCells,{array:this.btnsComment}),s.lockToolbar(Common.enumLock.headerLock,t.asc_getLockedHeaderFooter(),{array:this.toolbar.btnsEditHeader})}}}},onApiSelectionChangedRestricted:function(t){if(this.appConfig.isRestrictedEdit){var e=t.asc_getSelectionType();this.toolbar.lockToolbar(Common.enumLock.commentLock,e==Asc.c_oAscSelectionType.RangeCells&&(!t.asc_getComments()||t.asc_getComments().length>0||t.asc_getLocked())||this.appConfig&&this.appConfig.compatibleFeatures&&e!=Asc.c_oAscSelectionType.RangeCells,{array:this.btnsComment}),this.toolbar.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects,{array:this.btnsComment})}},onApiSelectionChanged_DiagramEditor:function(t){if(this.editMode&&!this.api.isCellEdited&&!this.api.isRangeSelection){var e=this,i=t.asc_getSelectionType(),n=t.asc_getXfs();if(!function(t,i){var n=t==Asc.c_oAscSelectionType.RangeChartText,o=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,l=t==Asc.c_oAscSelectionType.RangeImage||t==Asc.c_oAscSelectionType.RangeSlicer,r=s||a||n||o,c=!1;if(!r&&!l&&e._state.selection_type===t&&e._state.coauthdisable===i)return t===Asc.c_oAscSelectionType.RangeImage;r&&(c=e.api.asc_getGraphicObjectProps().some((function(t){return t.asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&t.asc_getObjectValue().asc_getLocked()})));var d=Common.enumLock,h=t;switch(t){case Asc.c_oAscSelectionType.RangeSlicer:case Asc.c_oAscSelectionType.RangeImage:h=d.selImage;break;case Asc.c_oAscSelectionType.RangeShape:h=d.selShape;break;case Asc.c_oAscSelectionType.RangeShapeText:h=d.selShapeText;break;case Asc.c_oAscSelectionType.RangeChart:h=d.selChart;break;case Asc.c_oAscSelectionType.RangeChartText:h=d.selChartText}return e.toolbar.lockToolbar(h,h!=t,{clear:[d.selImage,d.selChart,d.selChartText,d.selShape,d.selShapeText,d.coAuth]}),e.toolbar.lockToolbar(Common.enumLock.coAuthText,c),l}(i,!1)){var o=i===Asc.c_oAscSelectionType.RangeCells||i===Asc.c_oAscSelectionType.RangeCol||i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeMax;if(this.toolbar.lockToolbar(Common.enumLock.selRange,o,{array:[this.toolbar.btnEditChartData,this.toolbar.btnEditChartType]}),i!=Asc.c_oAscSelectionType.RangeChart&&i!=Asc.c_oAscSelectionType.RangeChartText){var s=n.asc_getNumFormatInfo();s&&(this._state.numformat=n.asc_getNumFormat(),this._state.numformatinfo=s,s=s.asc_getType(),this._state.numformattype!==s&&(e.toolbar.cmbNumberFormat.setValue(s,e.toolbar.txtCustom),this._state.numformattype=s))}}}},onApiSelectionChanged_MailMergeEditor:function(t){if(this.editMode&&!this.api.isCellEdited&&!this.api.isRangeSelection){var e,i=this,n=t.asc_getSelectionType(),o=function(t,e){var n=t==Asc.c_oAscSelectionType.RangeChartText,o=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,l=t==Asc.c_oAscSelectionType.RangeImage||t==Asc.c_oAscSelectionType.RangeSlicer,r=s||a||n||o,c=!1;if(!r&&!l&&i._state.selection_type===t&&i._state.coauthdisable===e)return t===Asc.c_oAscSelectionType.RangeImage;r&&(c=i.api.asc_getGraphicObjectProps().some((function(t){return t.asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&t.asc_getObjectValue().asc_getLocked()})));return i.toolbar.lockToolbar(Common.enumLock.coAuthText,c),l}(n,!1),s=!1;if(!o&&n!=Asc.c_oAscSelectionType.RangeChart&&n!=Asc.c_oAscSelectionType.RangeChartText&&!i.toolbar.mode.isEditDiagram){var a=t.asc_getAutoFilterInfo();e=a?a.asc_getIsAutoFilter():null,this._state.filter!==e&&(i.toolbar.btnSetAutofilter.toggle(!0===e,!0),this._state.filter=e),s=this._state.controlsdisabled.filters||null===e,i.toolbar.lockToolbar(Common.enumLock.ruleFilter,s,{array:[i.toolbar.btnSetAutofilter,i.toolbar.btnSortDown,i.toolbar.btnSortUp]}),s=this._state.controlsdisabled.filters||!a||!0!==a.asc_getIsApplyAutoFilter(),i.toolbar.lockToolbar(Common.enumLock.ruleDelFilter,s,{array:[i.toolbar.btnClearAutofilter]})}}},onApiSelectionChanged_OleEditor:function(t){if(this.editMode&&!this.api.isCellEdited&&!this.api.isRangeSelection){var e,i=this,n=t.asc_getSelectionType(),o=t.asc_getXfs(),s=this.toolbar,a=function(t,e){var n=t==Asc.c_oAscSelectionType.RangeChartText,o=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,l=t==Asc.c_oAscSelectionType.RangeImage||t==Asc.c_oAscSelectionType.RangeSlicer,r=s||a||n||o,c=!1;if(!r&&!l&&i._state.selection_type===t&&i._state.coauthdisable===e)return t===Asc.c_oAscSelectionType.RangeImage;r&&(c=i.api.asc_getGraphicObjectProps().some((function(t){return t.asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&t.asc_getObjectValue().asc_getLocked()})));var d=Common.enumLock,h=t;switch(t){case Asc.c_oAscSelectionType.RangeSlicer:case Asc.c_oAscSelectionType.RangeImage:h=d.selImage;break;case Asc.c_oAscSelectionType.RangeShape:h=d.selShape;break;case Asc.c_oAscSelectionType.RangeShapeText:h=d.selShapeText;break;case Asc.c_oAscSelectionType.RangeChart:h=d.selChart;break;case Asc.c_oAscSelectionType.RangeChartText:h=d.selChartText}return i.toolbar.lockToolbar(h,h!=t,{clear:[d.selImage,d.selChart,d.selChartText,d.selShape,d.selShapeText,d.coAuth]}),i.toolbar.lockToolbar(Common.enumLock.coAuthText,c),i._state.controlsdisabled.filters=l||r,l}(n,!1),l=!1;if(!a&&n!=Asc.c_oAscSelectionType.RangeChart&&n!=Asc.c_oAscSelectionType.RangeChartText){Common.NotificationCenter.trigger("fonts:change",o);var r=o.asc_getFontSize();this._state.fontsize!==r&&(s.cmbFontSize.setValue(void 0!==r?r:""),this._state.fontsize=r),e=o.asc_getFontBold(),this._state.bold!==e&&(s.btnTextFormatting.menu.items[0].setChecked(!0===e),this._state.bold=e),e=o.asc_getFontItalic(),this._state.italic!==e&&(s.btnTextFormatting.menu.items[1].setChecked(!0===e),this._state.italic=e),e=o.asc_getFontUnderline(),this._state.underline!==e&&(s.btnTextFormatting.menu.items[2].setChecked(!0===e),this._state.underline=e),e=o.asc_getFontStrikeout(),this._state.strikeout!==e&&(s.btnTextFormatting.menu.items[3].setChecked(!0===e),this._state.strikeout=e),e=o.asc_getFontSuperscript(),this._state.superscript!==e&&(s.btnTextFormatting.menu.items[4].setChecked(!0===e),this._state.superscript=e),e=o.asc_getFontSubscript(),this._state.subscript!==e&&(s.btnTextFormatting.menu.items[5].setChecked(!0===e),this._state.subscript=e);var c,d,h=s.mnuTextColorPicker,p=s.mnuBackColorPicker;if(!h.isDummy){if(d=o.asc_getFontColor())if(d.get_auto())"auto"!==this._state.clrtext&&(h.clearSelection(),s.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var m=typeof(c=d.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(d.get_r(),d.get_g(),d.get_b()),effectValue:d.get_value()}:Common.Utils.ThemeColor.getHexColor(d.get_r(),d.get_g(),d.get_b())),u=typeof this._state.clrtext;if("auto"==this._state.clrtext||m!==u||"object"==m&&(c.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(c.color)<0)||"object"!=m&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(c)<0){if(s.btnTextColor.setAutoColor(!1),_.isObject(c)){for(var g=!1,f=0;f<10;f++)if(Common.Utils.ThemeColor.ThemeValues[f]==c.effectValue){h.select(c,!0),g=!0;break}g||h.clearSelection()}else h.select(c,!0);this._state.clrtext=c}}this._state.clrtext_asccolor=d}if(!p.isDummy){if((m=typeof(c=(d=o.asc_getFillColor())&&!d.get_auto()?d.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(d.get_r(),d.get_g(),d.get_b()),effectValue:d.get_value()}:Common.Utils.ThemeColor.getHexColor(d.get_r(),d.get_g(),d.get_b()):"transparent"))!==(u=typeof this._state.clrback)||"object"==m&&(c.effectValue!==this._state.clrback.effectValue||this._state.clrback.color.indexOf(c.color)<0)||"object"!=m&&void 0!==this._state.clrback&&this._state.clrback.indexOf(c)<0){if(_.isObject(c)){g=!1;for(f=0;f<10;f++)if(Common.Utils.ThemeColor.ThemeValues[f]==c.effectValue){p.select(c,!0),g=!0;break}g||p.clearSelection()}else p.select(c,!0);this._state.clrback=c}this._state.clrshd_asccolor=d}var b=t.asc_getAutoFilterInfo(),C=t.asc_getFormatTableInfo(),v=o.asc_getHorAlign();if(this._state.pralign!==v){this._state.pralign=v;var x,y=-1;switch(v){case AscCommon.align_Left:y=0,x="btn-align-left";break;case AscCommon.align_Center:y=1,x="btn-align-center";break;case AscCommon.align_Right:y=2,x="btn-align-right";break;case AscCommon.align_Justify:y=3,x="btn-align-just";break;default:y=-255,x="btn-align-left"}y<0?-255==y&&s.btnHorizontalAlign.menu.clearAll():s.btnHorizontalAlign.menu.items[y].setChecked(!0),s.btnHorizontalAlign.rendered&&s.btnHorizontalAlign.$icon&&(s.btnHorizontalAlign.$icon.removeClass(s.btnHorizontalAlign.options.icls).addClass(x),s.btnHorizontalAlign.options.icls=x)}if(v=o.asc_getVertAlign(),this._state.valign!==v){switch(this._state.valign=v,y=-1,x="",v){case Asc.c_oAscVAlign.Top:y=0,x="btn-align-top";break;case Asc.c_oAscVAlign.Center:y=1,x="btn-align-middle";break;case Asc.c_oAscVAlign.Bottom:y=2,x="btn-align-bottom"}y<0?-255==y&&s.btnVerticalAlign.menu.clearAll():s.btnVerticalAlign.menu.items[y].setChecked(!0),s.btnVerticalAlign.rendered&&s.btnVerticalAlign.$icon&&(s.btnVerticalAlign.$icon.removeClass(s.btnVerticalAlign.options.icls).addClass(x),s.btnVerticalAlign.options.icls=x)}l=this._state.controlsdisabled.filters||null!==C||b&&null===b.asc_getIsAutoFilter(),s.lockToolbar(Common.enumLock.ruleMerge,l,{array:[s.btnMerge]}),e=t.asc_getMerge(),this._state.merge!==e&&(s.btnMerge.toggle(e===Asc.c_oAscMergeOptions.Merge,!0),this._state.merge=e),s.btnWrap.isDisabled()||(e=o.asc_getWrapText(),this._state.wrap!==e&&(s.btnWrap.toggle(!0===e,!0),this._state.wrap=e)),e=b?b.asc_getIsAutoFilter():null,this._state.filter=e,l=this._state.controlsdisabled.filters||null===e,s.lockToolbar(Common.enumLock.ruleFilter,l,{array:[s.btnTableTemplate]}),e=C?C.asc_getTableStyleName():null,this._state.tablestylename!==e&&this.toolbar.mnuTableTemplatePicker&&((e=this.toolbar.mnuTableTemplatePicker.store.findWhere({name:e}))?(this.toolbar.mnuTableTemplatePicker.selectRecord(e),this._state.tablestylename=e.get("name")):(s.mnuTableTemplatePicker.deselectAll(),this._state.tablestylename=null));var w=this._state.tablename;this._state.tablename=C?C.asc_getTableName():void 0;var S=this._state.filterapplied;this._state.filterapplied=this._state.filter&&b.asc_getIsApplyAutoFilter(),this._state.tablename===w&&this._state.filterapplied===S||this.getApplication().getController("Statusbar").onApiFilterInfo(!l),this._state.multiselect=t.asc_getMultiselect(),s.lockToolbar(Common.enumLock.multiselect,this._state.multiselect,{array:[s.btnTableTemplate]}),this._state.inpivot=!!t.asc_getPivotTableInfo(),s.lockToolbar(Common.enumLock.editPivot,this._state.inpivot,{array:[s.btnMerge]}),l=!this.appConfig.canModifyFilter,s.lockToolbar(Common.enumLock.cantModifyFilter,l,{array:[s.btnTableTemplate]}),(e=o.asc_getNumFormatInfo())&&(this._state.numformat=o.asc_getNumFormat(),this._state.numformatinfo=e,e=e.asc_getType(),this._state.numformattype!==e&&(i.toolbar.cmbNumberFormat.setValue(e,i.toolbar.txtCustom),this._state.numformattype=e))}}},onApiEditorSelectionChanged_OleEditor:function(t){if(this.editMode&&!($(".asc-window.enable-key-events:visible").length>0)){var e,i=this.toolbar;Common.NotificationCenter.trigger("fonts:change",t),e=t.asc_getFontBold(),this._state.bold!==e&&(i.btnTextFormatting.menu.items[0].setChecked(!0===e),this._state.bold=e),e=t.asc_getFontItalic(),this._state.italic!==e&&(i.btnTextFormatting.menu.items[1](!0===e),this._state.italic=e),e=t.asc_getFontUnderline(),this._state.underline!==e&&(i.btnTextFormatting.menu.items[2](!0===e),this._state.underline=e),e=t.asc_getFontStrikeout(),this._state.strikeout!==e&&(i.btnTextFormatting.menu.items[3](!0===e),this._state.strikeout=e),e=t.asc_getFontSubscript(),this._state.subscript!==e&&(i.btnTextFormatting.menu.items[4](!0===e),this._state.subscript=e),e=t.asc_getFontSuperscript(),this._state.superscript!==e&&(i.btnTextFormatting.menu.items[5](!0===e),this._state.superscript=e);var n=t.asc_getFontSize();this._state.fontsize!==n&&(i.cmbFontSize.setValue(void 0!==n?n:""),this._state.fontsize=n);var o,s,a=this.toolbar.mnuTextColorPicker;if(!a.isDummy){if(s=t.asc_getFontColor())if(s.get_auto())"auto"!==this._state.clrtext&&(a.clearSelection(),this.toolbar.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var l=typeof(o=s.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b()),effectValue:s.get_value()}:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b())),r=typeof this._state.clrtext;if("auto"==this._state.clrtext||l!==r||"object"==l&&(o.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(o.color)<0)||"object"!=l&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(o)<0){if(this.toolbar.btnTextColor.setAutoColor(!1),_.isObject(o)){for(var c=!1,d=0;d<10;d++)if(Common.Utils.ThemeColor.ThemeValues[d]==o.effectValue){a.select(o,!0),c=!0;break}c||a.clearSelection()}else a.select(o,!0);this._state.clrtext=o}}this._state.clrtext_asccolor=s}}},onApiStyleChange:function(){this.toolbar.btnCopyStyle.toggle(!1,!0),this.modeAlwaysSetStyle=!1},updateThemeColors:function(){var t=function(t,e){if(t){for(var i,n=Common.Utils.ThemeColor.getEffectColors(),o=0;o<n.length;o++)"object"==typeof t.currentColor&&void 0===i&&t.currentColor.effectId==n[o].effectId&&(i=n[o]);t.updateColors(n,Common.Utils.ThemeColor.getStandartColors()),void 0===t.currentColor?t.currentColor=e:void 0!==i&&(t.currentColor=i)}};if(t(this.toolbar.mnuTextColorPicker,Common.Utils.ThemeColor.getStandartColors()[1]),void 0!==this.toolbar.btnTextColor.currentColor&&this.toolbar.btnTextColor.currentColor.isAuto||(this.toolbar.btnTextColor.currentColor=Common.Utils.ThemeColor.getStandartColors()[1],this.toolbar.btnTextColor.setColor(this.toolbar.btnTextColor.currentColor)),t(this.toolbar.mnuBackColorPicker,Common.Utils.ThemeColor.getStandartColors()[3]),void 0===this.toolbar.btnBackColor.currentColor?this.toolbar.btnBackColor.currentColor=Common.Utils.ThemeColor.getStandartColors()[3]:this.toolbar.btnBackColor.currentColor=this.toolbar.mnuBackColorPicker.currentColor.color||this.toolbar.mnuBackColorPicker.currentColor,this.toolbar.btnBackColor.setColor(this.toolbar.btnBackColor.currentColor),void 0===this._state.clrtext_asccolor&&void 0===this._state.clrshd_asccolor||(this._state.clrtext=void 0,this._state.clrback=void 0,this.onApiSelectionChanged(this.api.asc_getCellInfo())),this._state.clrtext_asccolor=void 0,this._state.clrshd_asccolor=void 0,this.toolbar.mnuBorderColorPicker){t(this.toolbar.mnuBorderColorPicker,{color:"000",isAuto:!0});var e=this.toolbar.mnuBorderColorPicker.currentColor;if(e&&e.isAuto){var i=this.toolbar.btnBorders.menu.$el.find("#id-toolbar-menu-auto-bordercolor > a");!i.hasClass("selected")&&i.addClass("selected")}this.toolbar.btnBorders.options.borderscolor=e.color||e,$("#id-toolbar-mnu-item-border-color > a .menu-item-icon").css("border-color","#"+this.toolbar.btnBorders.options.borderscolor)}},hideElements:function(t){if(_.isUndefined(t.compact)||this.onChangeViewMode(t.compact),!_.isUndefined(t.formula)){var e=this.getApplication().getController("CellEditor").getView("CellEditor");e&&e.setVisible(!t.formula),Common.NotificationCenter.trigger("layout:changed","celleditor",t.formula?"hidden":"showed")}_.isUndefined(t.headings)||this.api&&this.api.asc_setDisplayHeadings(!t.headings),_.isUndefined(t.gridlines)||this.api&&this.api.asc_setDisplayGridlines(!t.gridlines),_.isUndefined(t.freezepanes)||this.api&&this.api.asc_freezePane(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.toolbar.btnInsertShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,e=new Common.UI.MenuItem({template:_.template('<div id="id-toolbar-menu-insertshape" class="menu-insertshape"></div>')});t.toolbar.btnInsertShape.menu.addItem(e);var i=Common.localStorage.getItem("sse-recent-shapes");new Common.UI.DataViewShape({el:$("#id-toolbar-menu-insertshape"),itemTemplate:_.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>'),groups:t.getApplication().getCollection("ShapeGroups"),parentMenu:t.toolbar.btnInsertShape.menu,restoreHeight:652,textRecentlyUsed:t.textRecentlyUsed,recentShapes:i?JSON.parse(i):null}).on("item:click",(function(e,i,n,o){t.api&&(n&&(t._addAutoshape(!0,n.get("data").shapeType),t._isAddingShape=!0),t.toolbar.btnInsertText.pressed&&t.toolbar.btnInsertText.toggle(!1,!0),"click"!==o.type&&t.toolbar.btnInsertShape.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t.toolbar,t.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Shape"))}))},fillEquations:function(){if(this.toolbar.btnInsertEquation.rendered&&!(this.toolbar.btnInsertEquation.menu.items.length>0)){var t=this,e=this.getApplication().getCollection("EquationGroups");t.toolbar.btnInsertEquation.menu.removeAll();var i=function(n){for(var o=0;o<e.length;++o){new Common.UI.DataViewSimple({el:$("#id-toolbar-menu-equationgroup"+o),parentMenu:n.items[o].menu,store:e.at(o).get("groupStore"),scrollAlwaysVisible:!0,itemTemplate:_.template('<div class="item-equation"><div class="equation-icon" style="background-position:<%= posX %>px <%= posY %>px;width:<%= width %>px;height:<%= height %>px;" id="<%= id %>"></div></div>')}).on("item:click",(function(e,i,n,o){t.api&&(n&&t.api.asc_AddMath(n.get("data").equationType),t.toolbar.btnInsertText.pressed&&t.toolbar.btnInsertText.toggle(!1,!0),t.toolbar.btnInsertShape.pressed&&t.toolbar.btnInsertShape.toggle(!1,!0),"click"!==o.type&&t.toolbar.btnInsertEquation.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t.toolbar,t.toolbar.btnInsertEquation),Common.component.Analytics.trackEvent("ToolBar","Add Equation"))}))}n.off("show:after",i)};t.toolbar.btnInsertEquation.menu.on("show:after",i);for(var n=0;n<e.length;++n){var o=e.at(n),s=new Common.UI.MenuItem({caption:o.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="id-toolbar-menu-equationgroup'+n+'" class="menu-shape" style="width:'+(o.get("groupWidth")+8)+"px; "+o.get("groupHeight")+'margin-left:5px;"></div>')}]})});t.toolbar.btnInsertEquation.menu.addItem(s)}}},onInsertEquationClick:function(){this.api&&(this.api.asc_AddMath(),Common.component.Analytics.trackEvent("ToolBar","Add Equation")),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertEquation)},onInsertSymbolClick:function(){Common.NotificationCenter.trigger("protect:check",this.onInsertSymbolClickCallback,this,[])},onInsertSymbolClickCallback:function(){if(this.api){var t=this,e=t.api.asc_GetSelectedText(),i=new Common.Views.SymbolTableDialog({api:t.api,lang:t.toolbar.mode.lang,type:1,special:!0,buttons:[{value:"ok",caption:this.textInsert},"close"],font:e&&e.length>0?t.api.asc_getCellInfo().asc_getXfs().asc_getFontName():void 0,symbol:e&&e.length>0?e.charAt(0):void 0,handler:function(e,i,n){"ok"==i?t.api.asc_insertSymbol(n.font?n.font:t.api.asc_getCellInfo().asc_getXfs().asc_getFontName(),n.code,n.special):Common.NotificationCenter.trigger("edit:complete",t.toolbar)}});i.show(),i.on("symbol:dblclick",(function(e,i,n){t.api.asc_insertSymbol(n.font?n.font:t.api.asc_getCellInfo().asc_getXfs().asc_getFontName(),n.code,n.special)}))}},onInsertSlicerClick:function(){var t=this,e=t.api.asc_beforeInsertSlicer();e&&new SSE.Views.SlicerAddDialog({props:e,handler:function(e,i){t&&t.api&&"ok"==e&&t.api.asc_insertSlicer(i),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()},onApiMathTypes:function(t){this._equationTemp=t;var e=this,i=function(t){e.onMathTypes(e._equationTemp),e.toolbar.btnInsertEquation.menu.off("show:before",i)};e.toolbar.btnInsertEquation.menu.on("show:before",i)},onMathTypes:function(t){var e=[],i=this.getCollection("EquationGroups");i.reset();var n={};n[Common.define.c_oAscMathMainType.Symbol]=[this.textSymbols,11],n[Common.define.c_oAscMathMainType.Fraction]=[this.textFraction,4],n[Common.define.c_oAscMathMainType.Script]=[this.textScript,4],n[Common.define.c_oAscMathMainType.Radical]=[this.textRadical,4],n[Common.define.c_oAscMathMainType.Integral]=[this.textIntegral,3,!0],n[Common.define.c_oAscMathMainType.LargeOperator]=[this.textLargeOperator,5,!0],n[Common.define.c_oAscMathMainType.Bracket]=[this.textBracket,4,!0],n[Common.define.c_oAscMathMainType.Function]=[this.textFunction,3,!0],n[Common.define.c_oAscMathMainType.Accent]=[this.textAccent,4],n[Common.define.c_oAscMathMainType.LimitLog]=[this.textLimitAndLog,3],n[Common.define.c_oAscMathMainType.Operator]=[this.textOperator,4],n[Common.define.c_oAscMathMainType.Matrix]=[this.textMatrix,4,!0];var o={},s="",a="";for(s in Common.define.c_oAscMathType){if(Common.define.c_oAscMathType.hasOwnProperty(s))a=2==(x=s.split("_")).length&&"Symbol"==x[0]?"txt"+x[0]+"_"+x[1].toLocaleLowerCase():"txt"+s,o[Common.define.c_oAscMathType[s]]=this[a]}var l,r,c=0,d=0,h=0,p=0,m=0,u=null,g=null,f=null;if(t&&(d=(r=t.get_Data()).length)){for(var b=0;b<d;++b){var C=r[b];if(c=C.get_Id(),p=C.get_W(),m=C.get_H(),u=new Backbone.Collection([],{model:SSE.Models.EquationModel})){var v=0,_=0,x=[];for(h=C.get_Data().length,l=0;l<h;++l){v=(g=C.get_Data()[l]).get_Data().length;for(var y=0;y<v;++y)_=(f=g.get_Data()[y]).get_Id(),a="",o.hasOwnProperty(_)&&(a=o[_]),x.push({data:{equationType:_},tip:a,allowSelected:!0,selected:!1,width:g.get_W(),height:g.get_H(),posX:-f.get_X(),posY:-f.get_Y()});v}u.add(x),p=n[c][1]*(p+10);var w=parseInt(370/(m+10))*(m+10);e.push({groupName:n[c][0],groupStore:u,groupWidth:p,groupHeight:n[c][2]?" height:"+w+"px!important; ":""})}}i.add(e),this.fillEquations()}},attachToControlEvents:function(){},_disableEditOptions:function(t,e){if(this.api.isCellEdited)return!0;if(this.api.isRangeSelection)return!0;var i=this.toolbar,n=t==Asc.c_oAscSelectionType.RangeChartText,o=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,l=t==Asc.c_oAscSelectionType.RangeImage,r=t==Asc.c_oAscSelectionType.RangeSlicer,c=s||a||n||o||r,d=!1,h=!1,p=!1,m=!1;if(!c&&!l&&this._state.selection_type===t&&this._state.coauthdisable===e)return t===Asc.c_oAscSelectionType.RangeImage;if(c){for(var u=this.api.asc_getGraphicObjectProps(),g=0;g<u.length;++g)if(u[g].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var f=u[g].asc_getObjectValue(),b=f?f.asc_getShapeProperties():null;b&&(h=b.asc_getFromSmartArtInternal()),d=d||f.asc_getLocked(),m=m||f.asc_getProtectionLockText(),p=p||f.asc_getProtectionLocked()}this._state.is_lockText=m,this._state.is_lockShape=p}if(e)i.lockToolbar(Common.enumLock.coAuth,e);else{var C=Common.enumLock,v=t;switch(t){case Asc.c_oAscSelectionType.RangeImage:v=C.selImage;break;case Asc.c_oAscSelectionType.RangeShape:v=C.selShape;break;case Asc.c_oAscSelectionType.RangeShapeText:v=C.selShapeText;break;case Asc.c_oAscSelectionType.RangeChart:v=C.selChart;break;case Asc.c_oAscSelectionType.RangeChartText:v=C.selChartText;break;case Asc.c_oAscSelectionType.RangeSlicer:v=C.selSlicer}this.appConfig.isEditDiagram||this.appConfig.isEditMailMerge||this.appConfig.isEditOle||i.lockToolbar(v,v!=t,{array:[i.btnClearStyle.menu.items[1],i.btnClearStyle.menu.items[2],i.btnClearStyle.menu.items[3],i.btnClearStyle.menu.items[4]],merge:!0,clear:[C.selImage,C.selChart,C.selChartText,C.selShape,C.selShapeText,C.selSlicer,C.coAuth]}),i.lockToolbar(Common.enumLock.coAuthText,d),i.lockToolbar(Common.enumLock.coAuthText,d&&(t==Asc.c_oAscSelectionType.RangeChart||t==Asc.c_oAscSelectionType.RangeChartText),{array:[i.btnInsertChart]}),i.lockToolbar(Common.enumLock.inSmartartInternal,h)}return this._state.controlsdisabled.filters=l||c||e,(l||c||e)&&(i.listStyles&&(i.listStyles.suspendEvents(),i.listStyles.menuPicker.selectRecord(null),i.listStyles.resumeEvents()),this._state.prstyle=void 0),this._state.selection_type=t,this._state.coauthdisable=e,l},_getApiTextSize:function(){var t=this.api.asc_getCellInfo();return t?t.asc_getXfs().asc_getFontSize():12},_setTableFormat:function(t){var e=this;if(!0!==e.api.isRangeSelection)if(e.api.asc_getCellInfo().asc_getFormatTableInfo())if(e._state.filter=void 0,e._state.tablename)e.api.asc_changeAutoFilter(e._state.tablename,Asc.c_oAscChangeFilterOptions.style,t);else{var i=e.api.asc_getCellInfo().asc_getSelectionType();i==Asc.c_oAscSelectionType.RangeMax||i==Asc.c_oAscSelectionType.RangeRow||i==Asc.c_oAscSelectionType.RangeCol?Common.UI.warning({title:e.textLongOperation,msg:e.warnLongOperation,buttons:["ok","cancel"],callback:function(i){"ok"==i&&setTimeout((function(){e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t)}),1),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}):(e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t))}else{var n=new SSE.Views.TableOptionsDialog({handler:function(i,n){if("ok"==n)if(e._state.filter=void 0,e.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None),e._state.tablename)e.api.asc_changeAutoFilter(e._state.tablename,Asc.c_oAscChangeFilterOptions.style,t);else{var o=i.getSettings();o.selectionType==Asc.c_oAscSelectionType.RangeMax||o.selectionType==Asc.c_oAscSelectionType.RangeRow||o.selectionType==Asc.c_oAscSelectionType.RangeCol?Common.UI.warning({title:e.textLongOperation,msg:e.warnLongOperation,buttons:["ok","cancel"],callback:function(i){"ok"==i&&setTimeout((function(){e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t,o.range)}),1),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}):(e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t,o.range))}Common.NotificationCenter.trigger("edit:complete",e.toolbar)}});n.show(),n.setSettings({api:e.api,selectionType:e.api.asc_getCellInfo().asc_getSelectionType()})}},onHideMenus:function(t){Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})},onSetupCopyStyleButton:function(){this.modeAlwaysSetStyle=!1;var t=this;Common.NotificationCenter.on({"edit:complete":function(e){t.api&&t.modeAlwaysSetStyle&&"tab"!==e&&(t.api.asc_formatPainter(AscCommon.c_oAscFormatPainterState.kOff),t.toolbar.btnCopyStyle.toggle(!1,!0),t.modeAlwaysSetStyle=!1)}}),$(t.toolbar.btnCopyStyle.cmpEl).dblclick((function(){t.api&&(t.modeAlwaysSetStyle=!0,t.toolbar.btnCopyStyle.toggle(!0,!0),t.api.asc_formatPainter(AscCommon.c_oAscFormatPainterState.kMultiple))}))},onCellsRange:function(t){this.api.isRangeSelection=t!=Asc.c_oAscSelectionDialogType.None,this.onApiEditCell(this.api.isRangeSelection?Asc.c_oAscCellEditorState.editStart:Asc.c_oAscCellEditorState.editEnd);var e=this.toolbar;e.lockToolbar(Common.enumLock.selRangeEdit,this.api.isRangeSelection),this.setDisabledComponents([e.btnUndo],this.api.isRangeSelection||!this.api.asc_getCanUndo()),this.setDisabledComponents([e.btnRedo],this.api.isRangeSelection||!this.api.asc_getCanRedo()),this.onApiSelectionChanged(this.api.asc_getCellInfo())},onLockDefNameManager:function(t){this._state.namedrange_locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager,this.toolbar.lockToolbar(Common.enumLock.printAreaLock,this.api.asc_isPrintAreaLocked(this.api.asc_getActiveWorksheetIndex()),{array:[this.toolbar.btnPrintArea]}),this.toolbar.lockToolbar(Common.enumLock.namedRangeLock,this._state.namedrange_locked,{array:[this.toolbar.btnPrintArea.menu.items[0],this.toolbar.btnPrintArea.menu.items[2]]})},onLockCFManager:function(t){this._state.cf_locked[t]=!0},onUnLockCFManager:function(t){this._state.cf_locked[t]=!1},activateControls:function(){this.toolbar.lockToolbar(Common.enumLock.disableOnStart,!1,{array:[this.toolbar.btnPrint]}),this._state.activated=!0},DisableToolbar:function(t,e){void 0!==e&&(this.editMode=!e),t=t||!this.editMode;var i=$(".toolbar-mask");if(!(t&&i.length>0||!t&&0==i.length)){var n=this.toolbar;n.hideMoreBtns(),n.$el.find(".toolbar").toggleClass("masked",t),this.toolbar.lockToolbar(Common.enumLock.menuFileOpen,t),t?(i=$("<div class='toolbar-mask'>").appendTo(n.$el.find(".toolbar")),Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+alt+h, ctrl+alt+h, command+1, ctrl+1")):(i.remove(),Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+alt+h, ctrl+alt+h, command+1, ctrl+1"))}},applyFormulaSettings:function(){if(this.toolbar.btnInsertFormula&&this.toolbar.btnInsertFormula.rendered)for(var t=this.toolbar.btnInsertFormula.menu.items,e=0;e<Math.min(4,t.length);e++)t[e].setCaption(this.api.asc_getFormulaLocaleName(t[e].value))},onAppShowed:function(t){var e=this;e.appConfig=t;var i=!t.isEdit;if(!t.isEdit||t.isEditDiagram||t.isEditMailMerge||t.isEditOle||(Common.localStorage.itemExists("sse-compact-toolbar")?i=Common.localStorage.getBool("sse-compact-toolbar"):t.customization&&t.customization.compactToolbar&&(i=!0)),e.toolbar.render(_.extend({isCompactView:i},t)),!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle){var n={action:"review",caption:e.toolbar.textTabCollaboration,layoutname:"toolbar-collaboration",dataHintTitle:"U"};(c=e.getApplication().getController("Common.Controllers.ReviewChanges").createToolbarPanel())&&(e.toolbar.addTab(n,c,6),e.toolbar.setVisible("review",(t.isEdit||t.canViewReview||t.canCoAuthoring&&t.canComments)&&Common.UI.LayoutManager.isElementVisible("toolbar-collaboration")))}if(t.isEdit&&(e.toolbar.setMode(t),e.toolbar.btnSave&&e.toolbar.btnSave.on("disabled",_.bind(e.onBtnChangeState,e,"save:disabled")),e.toolbar.btnUndo&&e.toolbar.btnUndo.on("disabled",_.bind(e.onBtnChangeState,e,"undo:disabled")),e.toolbar.btnRedo&&e.toolbar.btnRedo.on("disabled",_.bind(e.onBtnChangeState,e,"redo:disabled")),e.toolbar.btnPrint&&e.toolbar.btnPrint.on("disabled",_.bind(e.onBtnChangeState,e,"print:disabled")),e.toolbar.setApi(e.api),!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle)){var o=e.getApplication().getController("DataTab");o.setApi(e.api).setConfig({toolbar:e}),o=o.getView("DataTab"),Array.prototype.push.apply(e.toolbar.lockControls,o.getButtons()),e.toolbar.btnsSortDown=o.getButtons("sort-down"),e.toolbar.btnsSortUp=o.getButtons("sort-up"),e.toolbar.btnsSetAutofilter=o.getButtons("set-filter"),e.toolbar.btnsClearAutofilter=o.getButtons("clear-filter"),e.toolbar.btnCustomSort=o.getButtons("sort-custom"),e.toolbar.btnRemoveDuplicates=o.getButtons("rem-duplicates"),e.toolbar.btnDataValidation=o.getButtons("data-validation");var s=e.getApplication().getController("FormulaDialog");s.setConfig({toolbar:e}),s=s.getView("FormulaTab"),e.toolbar.btnsFormula=s.getButtons("formula");var a=s.getButtons("range");if(e.toolbar.itemsNamedRange=a&&a.menu&&a.menu.items?[a.menu.items[0],a.menu.items[1]]:[],Array.prototype.push.apply(e.toolbar.lockControls,s.getButtons()),t.canFeaturePivot){n={action:"pivot",caption:e.textPivot,dataHintTitle:"B"};var l=e.getApplication().getController("PivotTable");l.setApi(e.api).setConfig({toolbar:e}),(c=l.createToolbarPanel())&&(e.toolbar.addTab(n,c,5),e.toolbar.setVisible("pivot",!0),Array.prototype.push.apply(e.toolbar.lockControls,l.getView("PivotTable").getButtons()))}if(!t.customization||!t.customization.compactHeader){e.toolbar.btnPrint.$el.parents(".group").hide().next().hide();var r=e.toolbar.btnUndo.$el.hide().next().hide().parent();e.toolbar.btnPaste.$el.detach().appendTo(r),e.toolbar.btnPaste.$el.find("button").attr("data-hint-direction","bottom"),e.toolbar.btnCopy.$el.removeClass("split"),e.toolbar.processPanelVisible(null,!0,!0)}var c;n={action:"protect",caption:e.toolbar.textTabProtect,layoutname:"toolbar-protect",dataHintTitle:"T"};if(c=e.getApplication().getController("Common.Controllers.Protection").createToolbarPanel()){t.canProtect&&c.append($('<div class="separator long"></div>'));var d=e.getApplication().getController("WBProtection");c.append(d.createToolbarPanel()),e.toolbar.addTab(n,c,7),e.toolbar.setVisible("protect",Common.UI.LayoutManager.isElementVisible("toolbar-protect")),Array.prototype.push.apply(e.toolbar.lockControls,d.getView("WBProtection").getButtons())}}if(!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle){n={caption:e.toolbar.textTabView,action:"view",extcls:t.isEdit?"canedit":"",layoutname:"toolbar-view",dataHintTitle:"W"};var h=e.getApplication().getController("ViewTab");h.setApi(e.api).setConfig({toolbar:e,mode:t}),(c=h.createToolbarPanel())&&(e.toolbar.addTab(n,c,8),e.toolbar.setVisible("view",Common.UI.LayoutManager.isElementVisible("toolbar-view"))),t.isEdit&&Array.prototype.push.apply(e.toolbar.lockControls,h.getView("ViewTab").getButtons())}},onAppReady:function(t){var e=this;if(e.appOptions=t,this.btnsComment=[],t.canCoAuthoring&&t.canComments){var i=Common.enumLock;if(this.btnsComment=Common.Utils.injectButtons(this.toolbar.$el.find(".slot-comment"),"tlbtn-addcomment-","toolbar__icon btn-menu-comments",this.toolbar.capBtnComment,[i.lostConnect,i.commentLock,i.editCell,i.Objects],void 0,void 0,void 0,"1","bottom","small"),this.btnsComment.length){var n=SSE.getController("Common.Controllers.Comments").getView();Array.prototype.push.apply(e.toolbar.lockControls,this.btnsComment),this.btnsComment.forEach((function(t){t.updateHint(n.textHintAddComment),t.on("click",(function(t,i){Common.NotificationCenter.trigger("app:comment:add","toolbar",e.api.asc_getCellInfo().asc_getSelectionType()!=Asc.c_oAscSelectionType.RangeCells)})),t.cmpEl.closest("#review-changes-panel").length>0&&t.setCaption(e.toolbar.capBtnAddComment)}),this)}}Common.Utils.asyncCall((function(){t.isEdit&&e.toolbar.onAppReady(t)}))},onFileMenu:function(t){"show"==t?this.toolbar.isTabActive("file")||this.toolbar.setTab("file"):this.toolbar.isTabActive("file")&&this.toolbar.setTab()},onPageSizeClick:function(t,e,i){this.api&&i&&(this._state.pgsize=[0,0],this.api.asc_changeDocSize(e.value[0],e.value[1],this.api.asc_getActiveWorksheetIndex()),Common.component.Analytics.trackEvent("ToolBar","Page Size")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPageMarginsSelect:function(t,e){if(this.api){if(this._state.pgmargins=void 0,"advanced"!==e.value)this.api.asc_changePageMargins(e.value[1],e.value[3],e.value[0],e.value[2],this.api.asc_getActiveWorksheetIndex());else{var i,n,o=this;(i=new SSE.Views.PageMarginsDialog({handler:function(t,e){if("ok"==e){n=t.getSettings();var i=o.toolbar.btnPageMargins.menu.items[0];i.setVisible(!0),i.setChecked(!0),i.options.value=i.value=[n.asc_getTop(),n.asc_getLeft(),n.asc_getBottom(),n.asc_getRight()],$(i.el).html(i.template({id:Common.UI.getId(),caption:i.caption,options:i.options})),Common.localStorage.setItem("sse-pgmargins-top",n.asc_getTop()),Common.localStorage.setItem("sse-pgmargins-left",n.asc_getLeft()),Common.localStorage.setItem("sse-pgmargins-bottom",n.asc_getBottom()),Common.localStorage.setItem("sse-pgmargins-right",n.asc_getRight()),o.api.asc_changePageMargins(n.asc_getLeft(),n.asc_getRight(),n.asc_getTop(),n.asc_getBottom(),o.api.asc_getActiveWorksheetIndex()),Common.NotificationCenter.trigger("edit:complete",o.toolbar)}}})).show(),i.setSettings(o.api.asc_getPageOptions(o.api.asc_getActiveWorksheetIndex()))}Common.component.Analytics.trackEvent("ToolBar","Page Margins")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPageOrientSelect:function(t,e){this._state.pgorient=void 0,this.api&&e.checked&&this.api.asc_changePageOrient(e.value==Asc.c_oAscPageOrientation.PagePortrait,this.api.asc_getActiveWorksheetIndex()),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Page Orientation")},onImgGroupSelect:function(t,e){this.api&&this.api["grouping"==e.value?"asc_groupGraphicsObjects":"asc_unGroupGraphicsObjects"](),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Objects Group")},onImgArrangeSelect:function(t,e){this.api&&("forward"==t?this.api.asc_setSelectedDrawingObjectLayer(Asc.c_oAscDrawingLayerType.BringForward):"backward"==t?this.api.asc_setSelectedDrawingObjectLayer(Asc.c_oAscDrawingLayerType.SendBackward):this.api.asc_setSelectedDrawingObjectLayer(e.value)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Objects Arrange")},onImgAlignSelect:function(t,e){this.api&&(e.value>-1&&e.value<6?(this.api.asc_setSelectedDrawingObjectAlign(e.value),Common.component.Analytics.trackEvent("ToolBar","Objects Align")):6==e.value?(this.api.asc_DistributeSelectedDrawingObjectHor(),Common.component.Analytics.trackEvent("ToolBar","Distribute")):7==e.value&&(this.api.asc_DistributeSelectedDrawingObjectVer(),Common.component.Analytics.trackEvent("ToolBar","Distribute"))),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintAreaClick:function(t,e){this.api&&(this.api.asc_ChangePrintArea(e.value),Common.component.Analytics.trackEvent("ToolBar","Print Area")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintAreaMenuOpen:function(){this.api&&this.toolbar.btnPrintArea.menu.items[2].setVisible(this.api.asc_CanAddPrintArea())},onEditHeaderClick:function(t,e){var i=this;if(_.isUndefined(i.fontStore)){i.fontStore=new Common.Collections.Fonts;var n=i.toolbar.cmbFontName.store.toJSON(),o=[];_.each(n,(function(t,e){t.cloneid||o.push(_.clone(t))})),i.fontStore.add(o)}new SSE.Views.HeaderFooterDialog({api:i.api,fontStore:i.fontStore,pageSetup:t,handler:function(t,e){"ok"===e&&i.getApplication().getController("Print").updatePreview(),Common.NotificationCenter.trigger("edit:complete")}}).show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onClickChangeScaleInMenu:function(t,e){var i;this.api&&((i="up"===t?e%5>.001?5*Math.ceil(e/5):e+5:e%5>.001?5*Math.floor(e/5):e-5)>400?i=400:i<10&&(i=10),this.onChangeScaleSettings(0,0,i))},onScaleClick:function(t,e,i,n,o){var s=this;if(s.api)if("width"===t&&"more"!==i.value)void 0!==s._state.scaleHeight&&null!==s._state.scaleHeight||(s._state.scaleHeight=0),s.api.asc_SetPrintScale(i.value,s._state.scaleHeight,100),s.onChangeScaleSettings(i.value,s._state.scaleHeight,100);else if("height"===t&&"more"!==i.value)void 0!==s._state.scaleWidth&&null!==s._state.scaleWidth||(s._state.scaleWidth=0),s.api.asc_SetPrintScale(s._state.scaleWidth,i.value,100),s.onChangeScaleSettings(s._state.scaleWidth,i.value,100);else if("scale"===t&&void 0!==o)s.api.asc_SetPrintScale(0,0,o);else if("custom"===i.value||"more"===i.value){new SSE.Views.ScaleDialog({api:s.api,props:null,handler:function(t,e){"ok"==t?s.api&&e&&(s.api.asc_SetPrintScale(e.width,e.height,e.scale),s.onChangeScaleSettings(e.width,e.height,e.scale)):s.onChangeScaleSettings(s._state.scaleWidth,s._state.scaleHeight,s._state.scale),Common.NotificationCenter.trigger("edit:complete")}}).show()}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintTitlesClick:function(t){if(this.api){var e,i=this;new SSE.Views.PrintTitlesDialog({api:i.api,sheet:i.api.asc_getActiveWorksheetIndex(),handler:function(t,n){"ok"==n&&(e=t.getSettings(),i.api.asc_changePrintTitles(e.width,e.height,i.api.asc_getActiveWorksheetIndex()),Common.NotificationCenter.trigger("edit:complete",i.toolbar))}}).show(),Common.component.Analytics.trackEvent("ToolBar","Print Titles")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&(this._state.wsProps=t.wsProps,this._state.wsLock=t.wsLock,this.toolbar.lockToolbar(Common.enumLock.wsLock,this._state.wsLock),this.toolbar.lockToolbar(Common.enumLock.InsertHyperlinks,this._state.wsProps.InsertHyperlinks,{array:[this.toolbar.btnInsertHyperlink]}),this.appConfig&&this.appConfig.isEdit?this.onApiSelectionChanged(this.api.asc_getCellInfo()):this.onApiSelectionChangedRestricted(this.api.asc_getCellInfo()))},onPrintGridlinesChange:function(t,e){this.api.asc_SetPrintGridlines("checked"===e),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintHeadingsChange:function(t,e){this.api.asc_SetPrintHeadings("checked"===e),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onVisibleAreaClose:function(t){this.api&&this.api.asc_toggleChangeVisibleAreaOleEditor(!1),this.toolbar.lockToolbar(Common.enumLock.editVisibleArea,!1),this.toolbar.btnVisibleArea.setVisible(!0),this.toolbar.btnVisibleAreaClose.setVisible(!1),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onVisibleAreaMenu:function(t,e,i){this.api&&("edit"===e.value?(this.api.asc_toggleChangeVisibleAreaOleEditor(!0),this.toolbar.btnVisibleArea.setVisible(!1),this.toolbar.btnVisibleAreaClose.setVisible(!0),this.toolbar.lockToolbar(Common.enumLock.editVisibleArea,!0)):(this.api.asc_toggleShowVisibleAreaOleEditor("show"===e.value),this.toolbar.btnVisibleArea.menu.items[0].setVisible("show"!==e.value),this.toolbar.btnVisibleArea.menu.items[1].setVisible("show"===e.value))),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onOleEditClose:function(){this.api&&(this.api.asc_toggleChangeVisibleAreaOleEditor(!1),this.toolbar.btnVisibleArea.setVisible(!0),this.toolbar.btnVisibleAreaClose.setVisible(!1),this.toolbar.lockToolbar(Common.enumLock.editVisibleArea,!1),this.api.asc_toggleShowVisibleAreaOleEditor(!1),this.toolbar.btnVisibleArea.menu.items[0].setVisible(!0),this.toolbar.btnVisibleArea.menu.items[1].setVisible(!1))},onTextFormattingMenu:function(t,e){if(this.api)switch(e.value){case"bold":this._state.bold=void 0,this.api.asc_setCellBold(e.checked);break;case"italic":this._state.italic=void 0,this.api.asc_setCellItalic(e.checked);break;case"underline":this._state.underline=void 0,this.api.asc_setCellUnderline(e.checked);break;case"strikeout":this._state.strikeout=void 0,this.api.asc_setCellStrikeout(e.checked);break;case"subscript":this._state.subscript=void 0,this.api.asc_setCellSubscript(e.checked);break;case"superscript":this._state.superscript=void 0,this.api.asc_setCellSuperscript(e.checked)}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Text Formatting")},onHorizontalAlignMenu:function(t,e){this._state.pralign=void 0,this.api&&(this.api.asc_setCellAlign(e.checked?e.value:null),this.toolbar.btnWrap.allowDepress=!(e.value==AscCommon.align_Justify)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Horizontal align")},onVerticalAlignMenu:function(t,e){this._state.valign=void 0,this.api&&this.api.asc_setCellVertAlign(e.checked?e.value:Asc.c_oAscVAlign.Bottom),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Vertical align")},textEmptyImgUrl:"You need to specify image URL.",warnMergeLostData:"Operation can destroy data in the selected cells.<br>Continue?",textWarning:"Warning",textFontSizeErr:"The entered value is incorrect.<br>Please enter a numeric value between 1 and 409",confirmAddFontName:"The font you are going to save is not available on the current device.<br>The text style will be displayed using one of the device fonts, the saved font will be used when it is available.<br>Do you want to continue?",textSymbols:"Symbols",textFraction:"Fraction",textScript:"Script",textRadical:"Radical",textIntegral:"Integral",textLargeOperator:"Large Operator",textBracket:"Bracket",textFunction:"Function",textAccent:"Accent",textLimitAndLog:"Limit And Log",textOperator:"Operator",textMatrix:"Matrix",txtSymbol_pm:"Plus Minus",txtSymbol_infinity:"Infinity",txtSymbol_equals:"Equal",txtSymbol_neq:"Not Equal To",txtSymbol_about:"Approximately",txtSymbol_times:"Multiplication Sign",txtSymbol_div:"Division Sign",txtSymbol_factorial:"Factorial",txtSymbol_propto:"Proportional To",txtSymbol_less:"Less Than",txtSymbol_ll:"Much Less Than",txtSymbol_greater:"Greater Than",txtSymbol_gg:"Much Greater Than",txtSymbol_leq:"Less Than or Equal To",txtSymbol_geq:"Greater Than or Equal To",txtSymbol_mp:"Minus Plus",txtSymbol_cong:"Approximately Equal To",txtSymbol_approx:"Almost Equal To",txtSymbol_equiv:"Identical To",txtSymbol_forall:"For All",txtSymbol_additional:"Complement",txtSymbol_partial:"Partial Differential",txtSymbol_sqrt:"Radical Sign",txtSymbol_cbrt:"Cube Root",txtSymbol_qdrt:"Fourth Root",txtSymbol_cup:"Union",txtSymbol_cap:"Intersection",txtSymbol_emptyset:"Empty Set",txtSymbol_percent:"Percentage",txtSymbol_degree:"Degrees",txtSymbol_fahrenheit:"Degrees Fahrenheit",txtSymbol_celsius:"Degrees Celsius",txtSymbol_inc:"Increment",txtSymbol_nabla:"Nabla",txtSymbol_exists:"There Exist",txtSymbol_notexists:"There Does Not Exist",txtSymbol_in:"Element Of",txtSymbol_ni:"Contains as Member",txtSymbol_leftarrow:"Left Arrow",txtSymbol_uparrow:"Up Arrow",txtSymbol_rightarrow:"Right Arrow",txtSymbol_downarrow:"Down Arrow",txtSymbol_leftrightarrow:"Left-Right Arrow",txtSymbol_therefore:"Therefore",txtSymbol_plus:"Plus",txtSymbol_minus:"Minus",txtSymbol_not:"Not Sign",txtSymbol_ast:"Asterisk Operator",txtSymbol_bullet:"Bulet Operator",txtSymbol_vdots:"Vertical Ellipsis",txtSymbol_cdots:"Midline Horizontal Ellipsis",txtSymbol_rddots:"Up Right Diagonal Ellipsis",txtSymbol_ddots:"Down Right Diagonal Ellipsis",txtSymbol_aleph:"Alef",txtSymbol_beth:"Bet",txtSymbol_qed:"End of Proof",txtSymbol_alpha:"Alpha",txtSymbol_beta:"Beta",txtSymbol_gamma:"Gamma",txtSymbol_delta:"Delta",txtSymbol_varepsilon:"Epsilon Variant",txtSymbol_epsilon:"Epsilon",txtSymbol_zeta:"Zeta",txtSymbol_eta:"Eta",txtSymbol_theta:"Theta",txtSymbol_vartheta:"Theta Variant",txtSymbol_iota:"Iota",txtSymbol_kappa:"Kappa",txtSymbol_lambda:"Lambda",txtSymbol_mu:"Mu",txtSymbol_nu:"Nu",txtSymbol_xsi:"Xi",txtSymbol_o:"Omicron",txtSymbol_pi:"Pi",txtSymbol_varpi:"Pi Variant",txtSymbol_rho:"Rho",txtSymbol_varrho:"Rho Variant",txtSymbol_sigma:"Sigma",txtSymbol_varsigma:"Sigma Variant",txtSymbol_tau:"Tau",txtSymbol_upsilon:"Upsilon",txtSymbol_varphi:"Phi Variant",txtSymbol_phi:"Phi",txtSymbol_chi:"Chi",txtSymbol_psi:"Psi",txtSymbol_omega:"Omega",txtFractionVertical:"Stacked Fraction",txtFractionDiagonal:"Skewed Fraction",txtFractionHorizontal:"Linear Fraction",txtFractionSmall:"Small Fraction",txtFractionDifferential_1:"Differential",txtFractionDifferential_2:"Differential",txtFractionDifferential_3:"Differential",txtFractionDifferential_4:"Differential",txtFractionPi_2:"Pi Over 2",txtScriptSup:"Superscript",txtScriptSub:"Subscript",txtScriptSubSup:"Subscript-Superscript",txtScriptSubSupLeft:"Left Subscript-Superscript",txtScriptCustom_1:"Script",txtScriptCustom_2:"Script",txtScriptCustom_3:"Script",txtScriptCustom_4:"Script",txtRadicalSqrt:"Square Root",txtRadicalRoot_n:"Radical With Degree",txtRadicalRoot_2:"Square Root With Degree",txtRadicalRoot_3:"Cubic Root",txtRadicalCustom_1:"Radical",txtRadicalCustom_2:"Radical",txtIntegral:"Integral",txtIntegralSubSup:"Integral",txtIntegralCenterSubSup:"Integral",txtIntegralDouble:"Double Integral",txtIntegralDoubleSubSup:"Double Integral",txtIntegralDoubleCenterSubSup:"Double Integral",txtIntegralTriple:"Triple Integral",txtIntegralTripleSubSup:"Triple Integral",txtIntegralTripleCenterSubSup:"Triple Integral",txtIntegralOriented:"Contour Integral",txtIntegralOrientedSubSup:"Contour Integral",txtIntegralOrientedCenterSubSup:"Contour Integral",txtIntegralOrientedDouble:"Surface Integral",txtIntegralOrientedDoubleSubSup:"Surface Integral",txtIntegralOrientedDoubleCenterSubSup:"Surface Integral",txtIntegralOrientedTriple:"Volume Integral",txtIntegralOrientedTripleSubSup:"Volume Integral",txtIntegralOrientedTripleCenterSubSup:"Volume Integral",txtIntegral_dx:"Differential x",txtIntegral_dy:"Differential y",txtIntegral_dtheta:"Differential theta",txtLargeOperator_Sum:"Summation",txtLargeOperator_Sum_CenterSubSup:"Summation",txtLargeOperator_Sum_SubSup:"Summation",txtLargeOperator_Sum_CenterSub:"Summation",txtLargeOperator_Sum_Sub:"Summation",txtLargeOperator_Prod:"Product",txtLargeOperator_Prod_CenterSubSup:"Product",txtLargeOperator_Prod_SubSup:"Product",txtLargeOperator_Prod_CenterSub:"Product",txtLargeOperator_Prod_Sub:"Product",txtLargeOperator_CoProd:"Co-Product",txtLargeOperator_CoProd_CenterSubSup:"Co-Product",txtLargeOperator_CoProd_SubSup:"Co-Product",txtLargeOperator_CoProd_CenterSub:"Co-Product",txtLargeOperator_CoProd_Sub:"Co-Product",txtLargeOperator_Union:"Union",txtLargeOperator_Union_CenterSubSup:"Union",txtLargeOperator_Union_SubSup:"Union",txtLargeOperator_Union_CenterSub:"Union",txtLargeOperator_Union_Sub:"Union",txtLargeOperator_Intersection:"Intersection",txtLargeOperator_Intersection_CenterSubSup:"Intersection",txtLargeOperator_Intersection_SubSup:"Intersection",txtLargeOperator_Intersection_CenterSub:"Intersection",txtLargeOperator_Intersection_Sub:"Intersection",txtLargeOperator_Disjunction:"Vee",txtLargeOperator_Disjunction_CenterSubSup:"Vee",txtLargeOperator_Disjunction_SubSup:"Vee",txtLargeOperator_Disjunction_CenterSub:"Vee",txtLargeOperator_Disjunction_Sub:"Vee",txtLargeOperator_Conjunction:"Wedge",txtLargeOperator_Conjunction_CenterSubSup:"Wedge",txtLargeOperator_Conjunction_SubSup:"Wedge",txtLargeOperator_Conjunction_CenterSub:"Wedge",txtLargeOperator_Conjunction_Sub:"Wedge",txtLargeOperator_Custom_1:"Summation",txtLargeOperator_Custom_2:"Summation",txtLargeOperator_Custom_3:"Summation",txtLargeOperator_Custom_4:"Product",txtLargeOperator_Custom_5:"Union",txtBracket_Round:"Brackets",txtBracket_Square:"Brackets",txtBracket_Curve:"Brackets",txtBracket_Angle:"Brackets",txtBracket_LowLim:"Brackets",txtBracket_UppLim:"Brackets",txtBracket_Line:"Brackets",txtBracket_LineDouble:"Brackets",txtBracket_Square_OpenOpen:"Brackets",txtBracket_Square_CloseClose:"Brackets",txtBracket_Square_CloseOpen:"Brackets",txtBracket_SquareDouble:"Brackets",txtBracket_Round_Delimiter_2:"Brackets with Separators",txtBracket_Curve_Delimiter_2:"Brackets with Separators",txtBracket_Angle_Delimiter_2:"Brackets with Separators",txtBracket_Angle_Delimiter_3:"Brackets with Separators",txtBracket_Round_OpenNone:"Single Bracket",txtBracket_Round_NoneOpen:"Single Bracket",txtBracket_Square_OpenNone:"Single Bracket",txtBracket_Square_NoneOpen:"Single Bracket",txtBracket_Curve_OpenNone:"Single Bracket",txtBracket_Curve_NoneOpen:"Single Bracket",txtBracket_Angle_OpenNone:"Single Bracket",txtBracket_Angle_NoneOpen:"Single Bracket",txtBracket_LowLim_OpenNone:"Single Bracket",txtBracket_LowLim_NoneNone:"Single Bracket",txtBracket_UppLim_OpenNone:"Single Bracket",txtBracket_UppLim_NoneOpen:"Single Bracket",txtBracket_Line_OpenNone:"Single Bracket",txtBracket_Line_NoneOpen:"Single Bracket",txtBracket_LineDouble_OpenNone:"Single Bracket",txtBracket_LineDouble_NoneOpen:"Single Bracket",txtBracket_SquareDouble_OpenNone:"Single Bracket",txtBracket_SquareDouble_NoneOpen:"Single Bracket",txtBracket_Custom_1:"Case (Two Conditions)",txtBracket_Custom_2:"Cases (Three Conditions)",txtBracket_Custom_3:"Stack Object",txtBracket_Custom_4:"Stack Object",txtBracket_Custom_5:"Cases Example",txtBracket_Custom_6:"Binomial Coefficient",txtBracket_Custom_7:"Binomial Coefficient",txtFunction_Sin:"Sine Function",txtFunction_Cos:"Cosine Function",txtFunction_Tan:"Tangent Function",txtFunction_Csc:"Cosecant Function",txtFunction_Sec:"Secant Function",txtFunction_Cot:"Cotangent Function",txtFunction_1_Sin:"Inverse Sine Function",txtFunction_1_Cos:"Inverse Cosine Function",txtFunction_1_Tan:"Inverse Tangent Function",txtFunction_1_Csc:"Inverse Cosecant Function",txtFunction_1_Sec:"Inverse Secant Function",txtFunction_1_Cot:"Inverse Cotangent Function",txtFunction_Sinh:"Hyperbolic Sine Function",txtFunction_Cosh:"Hyperbolic Cosine Function",txtFunction_Tanh:"Hyperbolic Tangent Function",txtFunction_Csch:"Hyperbolic Cosecant Function",txtFunction_Sech:"Hyperbolic Secant Function",txtFunction_Coth:"Hyperbolic Cotangent Function",txtFunction_1_Sinh:"Hyperbolic Inverse Sine Function",txtFunction_1_Cosh:"Hyperbolic Inverse Cosine Function",txtFunction_1_Tanh:"Hyperbolic Inverse Tangent Function",txtFunction_1_Csch:"Hyperbolic Inverse Cosecant Function",txtFunction_1_Sech:"Hyperbolic Inverse Secant Function",txtFunction_1_Coth:"Hyperbolic Inverse Cotangent Function",txtFunction_Custom_1:"Sine theta",txtFunction_Custom_2:"Cos 2x",txtFunction_Custom_3:"Tangent formula",txtAccent_Dot:"Dot",txtAccent_DDot:"Double Dot",txtAccent_DDDot:"Triple Dot",txtAccent_Hat:"Hat",txtAccent_Check:"Check",txtAccent_Accent:"Acute",txtAccent_Grave:"Grave",txtAccent_Smile:"Breve",txtAccent_Tilde:"Tilde",txtAccent_Bar:"Bar",txtAccent_DoubleBar:"Double Overbar",txtAccent_CurveBracketTop:"Overbrace",txtAccent_CurveBracketBot:"Underbrace",txtAccent_GroupTop:"Grouping Character Above",txtAccent_GroupBot:"Grouping Character Below",txtAccent_ArrowL:"Leftwards Arrow Above",txtAccent_ArrowR:"Rightwards Arrow Above",txtAccent_ArrowD:"Right-Left Arrow Above",txtAccent_HarpoonL:"Leftwards Harpoon Above",txtAccent_HarpoonR:"Rightwards Harpoon Above",txtAccent_BorderBox:"Boxed Formula (With Placeholder)",txtAccent_BorderBoxCustom:"Boxed Formula (Example)",txtAccent_BarTop:"Overbar",txtAccent_BarBot:"Underbar",txtAccent_Custom_1:"Vector A",txtAccent_Custom_2:"ABC With Overbar",txtAccent_Custom_3:"x XOR y With Overbar",txtLimitLog_LogBase:"Logarithm",txtLimitLog_Log:"Logarithm",txtLimitLog_Lim:"Limit",txtLimitLog_Min:"Minimum",txtLimitLog_Max:"Maximum",txtLimitLog_Ln:"Natural Logarithm",txtLimitLog_Custom_1:"Limit Example",txtLimitLog_Custom_2:"Maximum Example",txtOperator_ColonEquals:"Colon Equal",txtOperator_EqualsEquals:"Equal Equal",txtOperator_PlusEquals:"Plus Equal",txtOperator_MinusEquals:"Minus Equal",txtOperator_Definition:"Equal to By Definition",txtOperator_UnitOfMeasure:"Measured By",txtOperator_DeltaEquals:"Delta Equal To",txtOperator_ArrowL_Top:"Leftwards Arrow Above",txtOperator_ArrowR_Top:"Rightwards Arrow Above",txtOperator_ArrowL_Bot:"Leftwards Arrow Below",txtOperator_ArrowR_Bot:"Rightwards Arrow Below",txtOperator_DoubleArrowL_Top:"Leftwards Arrow Above",txtOperator_DoubleArrowR_Top:"Rightwards Arrow Above",txtOperator_DoubleArrowL_Bot:"Leftwards Arrow Below",txtOperator_DoubleArrowR_Bot:"Rightwards Arrow Below",txtOperator_ArrowD_Top:"Right-Left Arrow Above",txtOperator_ArrowD_Bot:"Right-Left Arrow Above",txtOperator_DoubleArrowD_Top:"Right-Left Arrow Below",txtOperator_DoubleArrowD_Bot:"Right-Left Arrow Below",txtOperator_Custom_1:"Yileds",txtOperator_Custom_2:"Delta Yields",txtMatrix_1_2:"1x2 Empty Matrix",txtMatrix_2_1:"2x1 Empty Matrix",txtMatrix_1_3:"1x3 Empty Matrix",txtMatrix_3_1:"3x1 Empty Matrix",txtMatrix_2_2:"2x2 Empty Matrix",txtMatrix_2_3:"2x3 Empty Matrix",txtMatrix_3_2:"3x2 Empty Matrix",txtMatrix_3_3:"3x3 Empty Matrix",txtMatrix_Dots_Center:"Midline Dots",txtMatrix_Dots_Baseline:"Baseline Dots",txtMatrix_Dots_Vertical:"Vertical Dots",txtMatrix_Dots_Diagonal:"Diagonal Dots",txtMatrix_Identity_2:"2x2 Identity Matrix",txtMatrix_Identity_2_NoZeros:"3x3 Identity Matrix",txtMatrix_Identity_3:"3x3 Identity Matrix",txtMatrix_Identity_3_NoZeros:"3x3 Identity Matrix",txtMatrix_2_2_RoundBracket:"Empty Matrix with Brackets",txtMatrix_2_2_SquareBracket:"Empty Matrix with Brackets",txtMatrix_2_2_LineBracket:"Empty Matrix with Brackets",txtMatrix_2_2_DLineBracket:"Empty Matrix with Brackets",txtMatrix_Flat_Round:"Sparse Matrix",txtMatrix_Flat_Square:"Sparse Matrix",txtExpandSort:"The data next to the selection will not be sorted. Do you want to expand the selection to include the adjacent data or continue with sorting the currently selected cells only?",txtExpand:"Expand and sort",txtSorting:"Sorting",txtSortSelected:"Sort selected",textLongOperation:"Long operation",warnLongOperation:"The operation you are about to perform might take rather much time to complete.<br>Are you sure you want to continue?",txtInvalidRange:"ERROR! Invalid cells range",errorMaxRows:"ERROR! The maximum number of data series per chart is 255.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",textPivot:"Pivot Table",txtTable_TableStyleMedium:"Table Style Medium",txtTable_TableStyleDark:"Table Style Dark",txtTable_TableStyleLight:"Table Style Light",textInsert:"Insert",txtInsertCells:"Insert Cells",txtDeleteCells:"Delete Cells",errorComboSeries:"To create a combination chart, select at least two series of data.",textDirectional:"Directional",textShapes:"Shapes",textIndicator:"Indicators",textRating:"Ratings",txtLockSort:"Data is found next to your selection, but you do not have sufficient permissions to change those cells.<br>Do you wish to continue with the current selection?",textRecentlyUsed:"Recently Used"},SSE.Controllers.Toolbar||{}))})),define("text!spreadsheeteditor/main/app/template/StatusBar.template",[],(function(){return'\r\n<div class="statusbar">\r\n    <div id="status-tabs-scroll" class="status-group">\r\n        <button id="status-btn-tabback" type="button" class="btn small btn-toolbar" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="G"><i class="icon toolbar__icon btn-previtem">&nbsp;</i></button>\r\n        <button id="status-btn-tabnext" type="button" class="btn small btn-toolbar" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="J"><i class="icon toolbar__icon btn-nextitem">&nbsp;</i></button>\r\n    </div>\r\n    <div id="status-addtabs-box" class="status-group">\r\n        <button id="status-btn-addtab" type="button" class="btn small btn-toolbar" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="X"><i class="icon toolbar__icon btn-zoomup">&nbsp;</i></button>\r\n        <div class="cnt-tabslist">\r\n            <button id="status-btn-tabslist" type="button" class="btn small btn-toolbar dropdown-toggle" data-toggle="dropdown" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="N"><i class="icon toolbar__icon btn-sheet-list">&nbsp;</i></button>\r\n        </div>\r\n    </div>\r\n    <div id="status-zoom-box" class="status-group">\r\n        <div class="separator short"></div>\r\n        <button id="status-btn-zoomdown" type="button" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomdown">&nbsp;</i></button>\r\n        <div class="cnt-zoom">\r\n            <div class="dropdown-toggle" data-toggle="dropdown" data-hint="0" data-hint-direction="top">\r\n                <label id="status-label-zoom" class="status-label">Zoom 100%</label>\r\n            </div>\r\n        </div>\r\n        <button id="status-btn-zoomup" type="button" class="btn small btn-toolbar" style="margin-right:40px;"><i class="icon toolbar__icon btn-zoomup">&nbsp;</i></button>\r\n    </div>\r\n    <div id="status-math-box" class="status-group">\r\n        <div class="separator short"></div>\r\n        <label id="status-math-average">AVERAGE: 10</label>\r\n        <label id="status-math-count">COUNT: 3</label>\r\n        <label id="status-math-min">MIN: 1</label>\r\n        <label id="status-math-max">MAX: 5</label>\r\n        <label id="status-math-sum">SUM: 5</label>\r\n    </div>\r\n    <div id="status-filtered-box" class="status-group">\r\n        <div class="separator short"></div>\r\n        <label id="status-filtered-records"></label>\r\n    </div>\r\n    <div id="status-sheets-bar-box">\r\n        <div id="status-sheets-bar" class="status-group">\r\n        </div>\r\n    </div>\r\n    <div id="status-number-of-sheet">\r\n        <label id="label-sheets" class="status-label"></label>\r\n    </div>\r\n    <div id="status-action">\r\n        <div class="separator short"></div>\r\n        <label id="label-action" class="status-label"></label>\r\n    </div>\r\n</div>\r\n'})),void 0===Common)var Common={};define("common/main/lib/component/Tab",["common/main/lib/component/BaseView"],(function(t){"use strict";var e=function(t){return this.active=!1,this.label="Tab",this.cls="",this.iconCls="",this.iconVisible=!1,this.iconTitle="",this.index=-1,this.template=_.template(['<li class="list-item <% if(active){ %>active selected<% } %> <% if(cls.length){%><%= cls %><%}%><% if(iconVisible){%> icon-visible <%}%>" data-label="<%- label %>">','<span title="<%- label %>" draggable="true" oo_editor_input="true" tabindex="-1" data-index="<%= index %>">','<div class="toolbar__icon <% if(iconCls.length){%><%= iconCls %><%}%>" title="<% if(iconTitle.length){%><%=iconTitle%><%}%>"></div>',"<%- label %>","</span>","</li>"].join("")),this.initialize.call(this,t),this};_.extend(e.prototype,{initialize:function(t){_.extend(this,t)},render:function(){var t=this.template(this);return this.$el=$(t),this.rendered=!0,this.disable(this.disabled),this},isActive:function(){return this.$el.hasClass("active")},activate:function(){this.$el.hasClass("active")||this.$el.addClass("active")},isSelected:function(){return this.$el.hasClass("selected")},deactivate:function(){this.$el.removeClass("active")},on:function(){this.$el.on.apply(this,arguments)},disable:function(t){this.disabled=t,this.rendered&&(t&&!this.$el.hasClass("disabled")?this.$el.addClass("disabled"):this.$el.removeClass("disabled"))},addClass:function(t){t.length&&!this.$el.hasClass(t)&&this.$el.addClass(t)},removeClass:function(t){t.length&&this.$el.hasClass(t)&&this.$el.removeClass(t)},toggleClass:function(t){t.length&&this.$el.toggleClass(t)},hasClass:function(t){return this.$el.hasClass(t)},setCaption:function(t){this.$el.find("> span").text(t)},changeIconState:function(t,e){this.iconCls.length&&(this.iconVisible=t,this.iconTitle=e||"",this[t?"addClass":"removeClass"]("icon-visible"),e&&this.$el.find("."+this.iconCls).attr("title",e))}}),Common.UI.Tab=e})),define("common/main/lib/component/TabBar",["common/main/lib/component/BaseView","common/main/lib/component/Tab"],(function(){"use strict";var t={bind:function(){this.o||(this.o=$({})),this.o.on.apply(this.o,arguments)},unbind:function(){this.o&&this.o.off.apply(this.o,arguments)},trigger:function(){this.o||(this.o=$({})),this.o.trigger.apply(this.o,arguments)}},e=function(t){this.initialize.call(this,t)};_.extend(e.prototype,t),e.prototype.initialize=function(t){this.bar=t.bar},e.prototype.attach=function(t){t.changeState=$.proxy((function(e){if(e){t.toggleClass("selected");var i=_.find(this.bar.selectTabs,(function(e){return e.sheetindex===t.sheetindex}));i?this.bar.selectTabs=_.without(this.bar.selectTabs,i):this.bar.selectTabs.push(t)}else t.isSelected()||(this.bar.$el.find("ul > li.selected").removeClass("selected"),t.addClass("selected"),this.bar.selectTabs.length=0,this.bar.selectTabs.push(t)),this.trigger("tab:change",t),this.bar.$el.find("ul > li.active").removeClass("active"),t.activate(),this.bar.trigger("tab:changed",this.bar,this.bar.tabs.indexOf(t),t)}),this);new function(){};t.$el.on({click:$.proxy((function(e){if(!t.disabled)if(e.ctrlKey||e.metaKey)t.isActive()||t.changeState(!0);else if(e.shiftKey){this.bar.$el.find("ul > li.selected").removeClass("selected"),this.bar.selectTabs.length=0;for(var i=this.bar.$el.find("ul > li.active").index(),n=this.bar.tabs.indexOf(t),o=n>i?n:i,s=n>i?i:n;s<=o;s++)this.bar.tabs[s].changeState(!0)}else t.$el.hasClass("active")||(this.bar.tabs.length===this.bar.selectTabs.length&&(this.bar.$el.find("ul > li.selected").removeClass("selected"),this.bar.selectTabs.length=0),"manual"==t.control?this.bar.trigger("tab:manual",this.bar,this.bar.tabs.indexOf(t),t):(t.changeState(),this.bar.isEditFormula&&setTimeout((function(){$("#ce-cell-content").focus();var t=$("#ce-cell-content")[0];t.selectionStart=t.selectionEnd=t.value.length}),500)));!t.disabled&&Common.NotificationCenter.trigger("edit:complete","tab")}),this),dblclick:$.proxy((function(){this.trigger("tab:dblclick",this,this.tabs.indexOf(t),t)}),this.bar),contextmenu:$.proxy((function(){this.trigger("tab:contextmenu",this,this.tabs.indexOf(t),t,this.selectTabs)}),this.bar),mousedown:$.proxy((function(e){if(3===e.which||e.shiftKey)this.bar.$el.find("ul > li > span").attr("draggable","false");else{var i=t.isLockTheDrag;this.bar.selectTabs.forEach((function(t){t.isLockTheDrag&&(i=!0)})),(this.bar.selectTabs.length!==this.bar.tabs.length&&1!==this.bar.tabs.length||e.ctrlKey||Common.Utils.isMac&&e.altKey)&&!this.bar.isEditFormula||(i=!0),!(this.bar.selectTabs.length===this.bar.tabs.length&&this.bar.tabs.length>1)||e.ctrlKey||Common.Utils.isMac&&e.altKey||(i=!1,this.bar.$el.find("ul > li.selected").removeClass("selected")),this.bar.$el.find("ul > li > span").attr("draggable",!i),i||e.ctrlKey||e.metaKey||t.changeState()}$("#ce-cell-content").is(":focus")&&(this.bar.isEditFormula?setTimeout((function(){$("#ce-cell-content").focus()}),500):$("#ce-cell-content").blur())}),this)}),t.$el.children().on({dragstart:$.proxy((function(t){var e=t.originalEvent;if(Common.Utils.isIE||Common.Utils.isSafari)Common.Utils.isIE&&this.bar.selectTabs.forEach((function(t){t.$el.find("span").prop("title","")}));else{var i=document.createElement("div");e.dataTransfer.setDragImage(i,0,0)}e.dataTransfer.effectAllowed="copyMove",this.bar.trigger("tab:dragstart",e.dataTransfer,this.bar.selectTabs)}),this),dragenter:$.proxy((function(t){var e=t.originalEvent;this.bar.isEditFormula?e.dataTransfer.dropEffect="none":(this.bar.$el.find(".mousemove").removeClass("mousemove right"),$(t.currentTarget).parent().addClass("mousemove"),e.dataTransfer.dropEffect=e.ctrlKey||Common.Utils.isMac&&e.altKey?"copy":"move")}),this),dragover:$.proxy((function(t){var e=t.originalEvent;return e.preventDefault&&e.preventDefault(),this.bar.isEditFormula?e.dataTransfer.dropEffect="none":(this.bar.$el.find(".mousemove").removeClass("mousemove right"),$(t.currentTarget).parent().addClass("mousemove"),e.dataTransfer.dropEffect=e.ctrlKey||Common.Utils.isMac&&e.altKey?"copy":"move"),!1}),this),dragleave:$.proxy((function(t){$(t.currentTarget).parent().removeClass("mousemove right")}),this),dragend:$.proxy((function(t){Common.Utils.isMac&&t.altKey&&(this.bar.isDragDrop=!0);var e=t.originalEvent;"move"!==e.dataTransfer.dropEffect||e.dataTransfer.mozUserCancelled?this.bar.trigger("tab:dragend",!1):this.bar.trigger("tab:dragend",!0),this.bar.$el.find(".mousemove").removeClass("mousemove right")}),this),drop:$.proxy((function(t){Common.Utils.isMac&&t.altKey&&(this.bar.isDragDrop=!0);var e=t.originalEvent,i=$(e.currentTarget).data("index");this.bar.$el.find(".mousemove").removeClass("mousemove right"),this.bar.trigger("tab:drop",e.dataTransfer,i,e.ctrlKey||Common.Utils.isMac&&e.altKey),this.bar.isDrop=!0}),this)})},e.prototype.detach=function(t){t.$el.off()},Common.UI.TabBar=Common.UI.BaseView.extend({config:{placement:"top",items:[],draggable:!1},tabs:[],template:_.template('<ul id="statusbar_bottom" class="nav nav-tabs <%= placement %>"></ul>'),selectTabs:[],initialize:function(t){_.extend(this.config,t),Common.UI.BaseView.prototype.initialize.call(this,t),this.saved=[]},render:function(){this.$el.html(this.template(this.config)),this.$bar=this.$el.find("ul");var t=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},i=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";return t(this.$bar[0],i,_.bind(this._onMouseWheel,this)),t(this.$bar[0],"dragstart",_.bind((function(t){t.dataTransfer.effectAllowed="copyMove"}),this)),t(this.$bar[0],"dragenter",_.bind((function(t){this.isEditFormula?t.dataTransfer.dropEffect="none":t.dataTransfer.dropEffect=t.ctrlKey||Common.Utils.isMac&&t.altKey?"copy":"move"}),this)),t(this.$bar[0],"dragover",_.bind((function(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect=this.isEditFormula?"none":t.ctrlKey||Common.Utils.isMac&&t.altKey?"copy":"move",!this.isEditFormula&&this.tabs[this.tabs.length-1].$el.addClass("mousemove right"),!1}),this)),t(this.$bar[0],"dragleave",_.bind((function(t){t.dataTransfer.dropEffect="none",this.tabs[this.tabs.length-1].$el.removeClass("mousemove right")}),this)),t(this.$bar[0],"drop",_.bind((function(t){this.$el.find(".mousemove").removeClass("mousemove right"),void 0===this.isDrop?(Common.Utils.isMac&&t.altKey&&(this.isDragDrop=!0),this.trigger("tab:drop",t.dataTransfer,"last",t.ctrlKey||Common.Utils.isMac&&t.altKey)):this.isDrop=void 0}),this)),this.manager=new e({bar:this}),this.insert(-1,this.config.items),this.insert(-1,this.saved),delete this.saved,Common.Gateway.on("processmouse",_.bind(this.onProcessMouse,this)),this.rendered=!0,this},_onMouseWheel:function(t){var e=this.checkInvisible(!0);(t.detail&&-t.detail||t.wheelDelta)<0?e.last&&this.setTabVisible("forward"):e.first&&this.setTabVisible("backward"),Common.NotificationCenter.trigger("hints:clear")},onProcessMouse:function(t){if("mouseup"==t.type&&this.dragging){var e=this.getActive(!0);e&&e.mouseup()}},add:function(t){return this.insert(-1,t)>0},insert:function(t,e){var i=0;if(e&&(e instanceof Array||(e=[e]),e.length)){if(i=e.length,this.rendered){var n,o=this;if(t<0||t>o.tabs.length)for(var s=0;s<e.length;s++)n=new Common.UI.Tab(e[s]),o.$bar.append(n.render().$el),o.tabs.push(n),o.manager.attach(n),n.isActive()&&(o.selectTabs.length=0,o.selectTabs.push(n));else for(s=e.length;s-- >0;)n=new Common.UI.Tab(e[s]),0===t?(o.$bar.prepend(n.render().$el),o.tabs.unshift(n)):(o.$bar.find("li:nth-child("+t+")").before(n.render().$el),o.tabs.splice(t,0,n)),n.isActive()&&(o.selectTabs.length=0,o.selectTabs.push(n)),o.manager.attach(n)}else this.saved.push(e);this.checkInvisible()}return i},remove:function(t){if(t>=0&&t<this.tabs.length){var e=this.tabs.splice(t,1)[0];this.manager.detach(e),e.$el.remove(),this.checkInvisible()}},empty:function(t){var e=this;this.tabs.forEach((function(t){e.manager.detach(t)})),this.$bar.empty(),e.tabs=[],this.checkInvisible(t)},setActive:function(t){if(t instanceof Common.UI.Tab)e=t;else if("number"==typeof t&&t>=0&&t<this.tabs.length)var e=this.tabs[t];!e||"manual"==e.control||e.disabled||e.$el.hasClass("active")||e.changeState(),this.checkInvisible()},setSelectAll:function(t){var e=this;e.selectTabs.length=0,t?e.tabs.forEach((function(t){t.isSelected()||t.addClass("selected"),e.selectTabs.push(t)})):e.tabs.forEach((function(t){t.isActive()?e.selectTabs.push(t):t.isSelected()&&t.removeClass("selected")}))},getActive:function(t){return t?this.$bar.find("> li.active"):this.$bar.find("> li.active").index()},getAt:function(t){return t>=0&&t<this.tabs.length?this.tabs[t]:void 0},getCount:function(){return this.tabs.length},addClass:function(t){t.length&&!this.$bar.hasClass(t)&&this.$bar.addClass(t)},removeClass:function(t){t.length&&this.$bar.hasClass(t)&&this.$bar.removeClass(t)},hasClass:function(t){return this.$bar.hasClass(t)},setTabVisible:function(t,e){if(t<=0)this.$bar.scrollLeft(0),this.checkInvisible(e);else if(t>=this.tabs.length-1){var i=this.tabs[this.tabs.length-1].$el;0===this.$bar.find(".separator-item").length&&this.$bar.append('<li class="separator-item"><span></span></li>'),this.$bar.scrollLeft(this.$bar.scrollLeft()+(i.position().left+parseInt(i.css("width"))-this.$bar.width())+(this.$bar.width()>400?20:5)),this.checkInvisible(e)}else{this.isTabVisible(this.tabs.length-1)||0!==this.$bar.find(".separator-item").length||this.$bar.append('<li class="separator-item"><span></span></li>');var n,o,s=this.$bar.width();if("forward"==t){for(var a=0;a<this.tabs.length;a++)if((n=(i=this.tabs[a].$el).position().left+parseInt(i.css("width")))>s){this.$bar.scrollLeft(this.$bar.scrollLeft()+(n-s)+(this.$bar.width()>400?20:5)),this.checkInvisible(e);break}}else if("backward"==t){for(a=this.tabs.length;a-- >0;)if((o=(i=this.tabs[a].$el).position().left)<0){this.$bar.scrollLeft(this.$bar.scrollLeft()+o-26),this.checkInvisible(e);break}}else"number"==typeof t&&(n=(o=(i=this.tabs[t].$el).position().left)+parseInt(i.css("width")),o<0?(this.$bar.scrollLeft(this.$bar.scrollLeft()+o-26),this.checkInvisible(e)):n>s&&(this.$bar.scrollLeft(this.$bar.scrollLeft()+(n-s)+20),this.checkInvisible(e)))}},checkInvisible:function(t){var e={first:!this.isTabVisible(0),last:!this.isTabVisible(this.tabs.length-1)};return!t&&this.fireEvent("tab:invisible",this,e),e},hasInvisible:function(){for(var t=this.$bar.offset().left,e=t+this.$bar.width(),i=this.tabs.length;i-- >0;)if(!this.isTabVisible(i,t,e))return!0;return!1},isTabVisible:function(t){var e,i,n,o=arguments[1]||this.$bar.offset().left,s=arguments[2]||o+this.$bar.width();return t<this.tabs.length&&t>=0&&(e=(n=this.tabs[t].$el.get(0).getBoundingClientRect()).left,i=n.right,!(e<o||i-s>.5))},addDataHint:function(t,e){var i=this.$bar.find("[data-hint]");i.length>0&&(i.removeAttr("data-hint"),i.removeAttr("data-hint-direction"),i.removeAttr("data-hint-offset"),i.removeAttr("data-hint-title"));var n=this.tabs[t].$el;n.attr("data-hint",e||"0"),n.attr("data-hint-direction","top"),n.attr("data-hint-offset","medium"),n.attr("data-hint-title","M")},getWidth:function(){var t=21;return this.tabs.forEach((function(e){t+=e.$el.width()})),t}})})),define("spreadsheeteditor/main/app/view/Statusbar",["text!spreadsheeteditor/main/app/template/StatusBar.template","tip","common/main/lib/component/TabBar","common/main/lib/component/Menu","common/main/lib/component/Window","common/main/lib/component/ThemeColorPalette"],(function(t){"use strict";if(SSE.Views.Statusbar)var e=SSE.Views.Statusbar.RenameDialog,i=SSE.Views.Statusbar.CopyDialog;SSE.Views.Statusbar=Common.UI.BaseView.extend(_.extend({el:"#statusbar",template:_.template(t),events:function(){return{"click #status-btn-tabback":_.bind(this.onBtnTabScroll,this,"backward"),"click #status-btn-tabnext":_.bind(this.onBtnTabScroll,this,"forward")}},api:void 0,initialize:function(t){_.extend(this,t)},render:function(){var t=this;$(this.el).html(this.template({scope:this})),this.cntStatusbar=$(".statusbar",this.el),this.isCompact=Common.localStorage.getBool("sse-compact-statusbar",!0),this.isCompact||this.cntStatusbar.addClass("no-compact"),this.editMode=!1,this.rangeSelectionMode=Asc.c_oAscSelectionDialogType.None,this.btnZoomDown=new Common.UI.Button({el:$("#status-btn-zoomdown",this.el),hint:this.tipZoomOut+" (Ctrl+-)",hintAnchor:"top"}),this.btnZoomUp=new Common.UI.Button({el:$("#status-btn-zoomup",this.el),hint:this.tipZoomIn+" (Ctrl++)",hintAnchor:"top-right"}),this.btnScrollBack=new Common.UI.Button({el:$("#status-btn-tabback",this.el),hint:this.tipPrev,disabled:!0,hintAnchor:"top"}),this.btnScrollNext=new Common.UI.Button({el:$("#status-btn-tabnext",this.el),hint:this.tipNext,disabled:!0,hintAnchor:"top"}),this.btnAddWorksheet=new Common.UI.Button({el:$("#status-btn-addtab",this.el),hint:this.tipAddTab,disabled:!0,hintAnchor:"top"}),this.cntSheetList=new Common.UI.Button({el:$(".cnt-tabslist",this.el),hint:this.tipListOfSheets,hintAnchor:"top"}),this.btnSheetList=$("#status-btn-tabslist",this.$el),this.sheetListMenu=new Common.UI.Menu({style:"margin-top:-3px;",menuAlign:"bl-tl",maxHeight:300}),this.sheetListMenu.on("item:click",(function(e,i){t.fireEvent("show:tab",[i.value])})),this.cntSheetList.cmpEl.on({"show.bs.dropdown":function(){_.defer((function(){t.cntSheetList.cmpEl.find("ul").focus()}),100)},"hide.bs.dropdown":function(){_.defer((function(){t.api.asc_enableKeyEvents(!0)}),100)}}),this.sheetListMenu.render($(".cnt-tabslist",this.el)),this.sheetListMenu.cmpEl.attr({tabindex:-1}),this.cntZoom=new Common.UI.Button({el:$(".cnt-zoom",this.el),hint:this.tipZoomFactor,hintAnchor:"top"}),this.cntZoom.cmpEl.on({"show.bs.dropdown":function(){_.defer((function(){t.cntZoom.cmpEl.find("ul").focus()}),100)},"hide.bs.dropdown":function(){_.defer((function(){t.api.asc_enableKeyEvents(!0)}),100)}}),this.zoomMenu=new Common.UI.Menu({style:"margin-top:-5px;",menuAlign:"bl-tl",items:[{caption:"50%",value:50},{caption:"75%",value:75},{caption:"100%",value:100},{caption:"125%",value:125},{caption:"150%",value:150},{caption:"175%",value:175},{caption:"200%",value:200},{caption:"300%",value:300},{caption:"400%",value:400},{caption:"500%",value:500}]}),this.zoomMenu.render($(".cnt-zoom",this.el)),this.zoomMenu.cmpEl.attr({tabindex:-1}),this.labelZoom=$("#status-label-zoom",this.$el),this.tabBarBox=$("#status-sheets-bar-box",this.el),this.tabbar=new Common.UI.TabBar({el:"#status-sheets-bar",placement:"bottom",draggable:!1}).render(),this.tabbar.on({"tab:invisible":_.bind(this.onTabInvisible,this),"tab:changed":_.bind(this.onSheetChanged,this),"tab:contextmenu":_.bind(this.onTabMenu,this),"tab:dblclick":_.bind((function(){!t.editMode||t.mode&&t.mode.isDisconnected||t.rangeSelectionMode===Asc.c_oAscSelectionDialogType.Chart||t.rangeSelectionMode===Asc.c_oAscSelectionDialogType.FormatTable||t.rangeSelectionMode===Asc.c_oAscSelectionDialogType.PrintTitles||t.fireEvent("sheet:changename")}),this),"tab:dragstart":_.bind((function(t,e){Common.Utils.isIE&&(this.isDrop=!1),Common.UI.Menu.Manager.hideAll(),this.api.asc_closeCellEditor();for(var i=[],n=[],o=this.api.asc_getWorksheetsCount(),s=[],a=-1;++a<o;)this.api.asc_isWorksheetHidden(a)||s.push({value:this.api.asc_getWorksheetName(a),inindex:a});var l=[];e.forEach((function(t){l.push(t.sheetindex)})),s.forEach((function(t){-1!==l.indexOf(t.inindex)&&(i.push(t.inindex),n.push(t.value))}));var r,c=[];r=this.api.asc_StartMoveSheet(_.clone(i)),c.push({type:"onlyoffice",value:r}),c.push({type:"indexes",value:i}),c.push({type:"names",value:n}),c.push({type:"key",value:Common.Utils.InternalSettings.get("sse-doc-info-key")});var d=JSON.stringify(c);Common.Utils.isIE?(t.setData("text","sheet"),this.dataTransfer=d):t.setData("onlyoffice",d),this.dropTabs=e}),this),"tab:drop":_.bind((function(t,e,i){if(!(this.isEditFormula||Common.Utils.isIE&&void 0===this.dataTransfer)){Common.Utils.isIE&&(this.isDrop=!0);var n=Common.Utils.isIE?this.dataTransfer:t.getData("onlyoffice");if(n){var o=JSON.parse(n);if(o){var s=_.findWhere(o,{type:"key"}).value;if(Common.Utils.InternalSettings.get("sse-doc-info-key")===s)this.fireEvent("sheet:move",[_.findWhere(o,{type:"indexes"}).value,!i,!0,_.isNumber(e)?e:this.api.asc_getWorksheetsCount()]),Common.NotificationCenter.trigger("tabs:dragend",this);else{for(var a=[],l=this.api.asc_getWorksheetsCount();l--;)a.push(this.api.asc_getWorksheetName(l).toLowerCase());var r=[];_.findWhere(o,{type:"names"}).value.forEach((function(t){var e=1,i=/^(.*)\((\d)\)$/.exec(t=t),n=i?i[1]:t+" ",o=[];for(r.length>0&&r.forEach((function(t){o.push(t.toLowerCase())}));-1!==a.indexOf(t.toLowerCase())||-1!==o.indexOf(t.toLowerCase());)t=n+"("+ ++e+")";r.push(t)}));e=_.isNumber(e)?e:this.api.asc_getWorksheetsCount();this.api.asc_EndMoveSheet(e,r,_.findWhere(o,{type:"onlyoffice"}).value)}}}}}),this),"tab:dragend":_.bind((function(e){if(e&&(!Common.Utils.isIE||!1!==this.isDrop)&&this.dropTabs.length>0){var i=[];this.dropTabs.forEach((function(t){i.push(t.sheetindex)})),t.api.asc_deleteWorksheet(i)}this.dropTabs=void 0,Common.Utils.isIE&&(this.isDrop=void 0,this.dataTransfer=void 0),Common.NotificationCenter.trigger("tabs:dragend",this)}),this)});var e=new Common.UI.Menu({maxHeight:267,menuAlign:"tl-tr"}).on("show:after",(function(){this.scroller.update({alwaysVisibleY:!0})}));e.on("item:click",(function(e,i,n){t.fireEvent("show:hidden",[t,i.value])}));var i=new Common.UI.Menu({menuAlign:"tl-tr",cls:"color-tab",items:[{template:_.template('<div id="id-tab-menu-color" style="width: 164px;display: inline-block;"></div>')},{caption:"--"},{id:"id-tab-menu-new-color",template:_.template('<a tabindex="-1" type="menuitem" style="padding-left:12px;">'+t.textNewColor+"</a>")}]});t.mnuTabColor={isDummy:!0,on:function(){}},this.tabMenu=new Common.UI.Menu({menuAlign:"bl-tl",items:[{caption:this.itemInsert,value:"ins"},{caption:this.itemDelete,value:"del"},{caption:this.itemRename,value:"ren"},{caption:this.itemCopy,value:"copy"},{caption:this.itemMove,value:"move"},{caption:this.itemHide,value:"hide"},{caption:this.itemHidden,menu:e},{caption:this.itemProtect,value:"protect"},{caption:this.itemTabColor,menu:i},{caption:"--"},{caption:this.selectAllSheets,value:"selectall"},{caption:this.ungroupSheets,value:"noselect"}]}).on("render:after",(function(e){t.mnuTabColor=new Common.UI.ThemeColorPalette({el:$("#id-tab-menu-color"),outerMenu:{menu:i,index:0,focusOnShow:!0},transparent:!0}),i.setInnerMenu([{menu:t.mnuTabColor,index:0}]),t.mnuTabColor.on("select",(function(e,i){t.fireEvent("sheet:setcolor",[i]),setTimeout((function(){t.tabMenu.hide()}),1)}))}));var n=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div style="position: relative;"><div class="item-caption"><%= caption %></div><label class="item-value"><%= options.exampleval ? options.exampleval : "" %></label></div></a>');return this.customizeStatusBarMenu=new Common.UI.Menu({menuAlign:"bl-tl",menuAlignEl:$(this.el),items:[{id:"saved-status",caption:this.itemStatus,value:"status",checkable:!0,checked:!0,template:n,exampleval:""},{caption:"--"},{id:"math-item-average",caption:this.itemAverage,value:"average",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-count",caption:this.itemCount,value:"count",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-min",caption:this.itemMinimum,value:"min",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-max",caption:this.itemMaximum,value:"max",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-sum",caption:this.itemSum,value:"sum",checkable:!0,checked:!0,template:n,exampleval:""}]}),this.tabbar.$el.append('<div class="dropdown-toggle" data-toggle="dropdown" style="width:0; height:0;"></div>'),this.tabMenu.render(this.tabbar.$el),this.tabMenu.cmpEl.attr({tabindex:-1}),this.tabMenu.on("show:after",_.bind(this.onTabMenuAfterShow,this)),this.tabMenu.on("hide:after",_.bind(this.onTabMenuAfterHide,this)),this.tabMenu.on("item:click",_.bind(this.onTabMenuClick,this)),this.boxMath=$("#status-math-box",this.el),this.labelSum=$("#status-math-sum",this.boxMath),this.labelCount=$("#status-math-count",this.boxMath),this.labelAverage=$("#status-math-average",this.boxMath),this.labelMin=$("#status-math-min",this.boxMath),this.labelMax=$("#status-math-max",this.boxMath),this.boxMath.hide(),this.boxFiltered=$("#status-filtered-box",this.el),this.labelFiltered=$("#status-filtered-records",this.boxFiltered),this.boxFiltered.hide(),this.boxZoom=$("#status-zoom-box",this.el),this.boxZoom.find(".separator").css("border-left-color","transparent"),this.boxNumberSheets=$("#status-number-of-sheet",this.el),this.isCompact&&this.boxNumberSheets.hide(),this.labelNumberSheets=$("#label-sheets",this.boxNumberSheets),this.boxAction=$("#status-action",this.el),this.boxAction.hide(),this.labelAction=$("#label-action",this.boxAction),this.$el.append('<div id="statusbar-menu" style="width:0; height:0;"></div>'),this.$customizeStatusBarMenu=this.$el.find("#statusbar-menu"),this.$customizeStatusBarMenu.on({"show.bs.dropdown":function(){_.defer((function(){t.$customizeStatusBarMenu.find("ul").focus()}),100)},"hide.bs.dropdown":function(){_.defer((function(){t.api.asc_enableKeyEvents(!0)}),100)}}),this.$customizeStatusBarMenu.append('<div class="dropdown-toggle" data-toggle="dropdown" style="width:0; height:0;"></div>'),this.customizeStatusBarMenu.render(this.$customizeStatusBarMenu),this.customizeStatusBarMenu.cmpEl.attr({tabindex:-1}),this.customizeStatusBarMenu.on("show:after",_.bind(this.onCustomizeStatusBarAfterShow,this)),this.customizeStatusBarMenu.on("hide:after",_.bind(this.onCustomizeStatusBarAfterHide,this)),this.customizeStatusBarMenu.on("item:click",_.bind(this.onCustomizeStatusBarClick,this)),this.$el.on("contextmenu",_.bind(this.showCustomizeStatusBar,this)),this},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.update,this)),this},setMode:function(t){this.mode=_.extend({},this.mode,t),$("#status-addtabs-box")[this.mode.isEdit?"show":"hide"](),this.btnAddWorksheet.setDisabled(this.mode.isDisconnected||this.api&&(this.api.asc_isWorkbookLocked()||this.api.isCellEdited)||this.rangeSelectionMode!=Asc.c_oAscSelectionDialogType.None),this.mode.isEditOle&&(this.btnAddWorksheet.$el.find("button").addBack().filter("button").attr("data-hint","1"),this.btnScrollBack.$el.find("button").addBack().filter("button").attr("data-hint","1"),this.btnScrollNext.$el.find("button").addBack().filter("button").attr("data-hint","1"),this.cntSheetList.$el.find("button").attr("data-hint","1"),this.cntSheetList.$el.find("button").removeAttr("data-hint-title"),this.cntZoom.$el.find(".dropdown-toggle").attr("data-hint","1")),this.updateTabbarBorders()},setVisible:function(t){t?this.show():this.hide()},isVisible:function(){return this.$el&&this.$el.is(":visible")},update:function(){var t=this;if(this.tabbar.empty(!0),this.tabMenu.items[6].menu.removeAll(),this.tabMenu.items[6].hide(),this.btnAddWorksheet.setDisabled(!0),this.sheetListMenu.removeAll(),this.api){for(var e,i,n,o=this.api.asc_getWorksheetsCount(),s=-1,a=[],l=[],r=[],c=this.api.asc_getActiveWorksheetIndex(),d=this.api.asc_isProtectedWorkbook();++s<o;)i=t.api.asc_isWorksheetLockedOrDeleted(s),n=t.api.asc_getActiveNamedSheetView&&t.api.asc_getActiveNamedSheetView(s)||"",e={sheetindex:s,index:l.length,active:c==s,label:t.api.asc_getWorksheetName(s),cls:i?"coauth-locked":"",isLockTheDrag:i||t.mode.isDisconnected||d,iconCls:"btn-sheet-view",iconTitle:n,iconVisible:""!==n},this.api.asc_isWorksheetHidden(s)?a.push(e):l.push(e),r.push(e);a.length&&(a.forEach((function(e){t.tabMenu.items[6].menu.addItem(new Common.UI.MenuItem({style:"white-space: pre-wrap",caption:Common.Utils.String.htmlEncode(e.label),value:e.sheetindex}))})),this.tabMenu.items[6].show()),this.tabbar.add(l),r.forEach((function(e){var i=t.api.asc_isWorksheetHidden(e.sheetindex);t.sheetListMenu.addItem(new Common.UI.MenuItem({style:"white-space: pre",caption:Common.Utils.String.htmlEncode(e.label),value:e.sheetindex,checkable:!0,checked:e.active,hidden:i,visible:!i||!d,textHidden:t.itemHidden,template:_.template(['<a id="<%= id %>" style="<%= style %>" tabindex="-1" type="menuitem" <% if (options.hidden) { %> data-hidden="true" <% } %>>','<div class="color"></div>','<span class="name"><%= caption %></span>',"<% if (options.hidden) { %>",'<span class="hidden-mark"><%= options.textHidden %></span>',"<% } %>","</a>"].join(""))}))})),_.isUndefined(this.tabBarScroll)||(this.tabbar.$bar.scrollLeft(this.tabBarScroll.scrollLeft),this.tabBarScroll=void 0),this.tabbar.isTabVisible(c)||this.tabbar.setTabVisible(c),this.btnAddWorksheet.setDisabled(t.mode.isDisconnected||t.api.asc_isWorkbookLocked()||d||t.api.isCellEdited),this.mode.isEdit&&this.tabbar.addDataHint(_.findIndex(l,(function(t){return t.sheetindex===c})),this.mode.isEditOle?"1":"0"),$("#status-label-zoom").text(Common.Utils.String.format(this.zoomText,Math.floor(100*(this.api.asc_getZoom()+.005)))),this.updateNumberOfSheet(c,o),this.updateTabbarBorders(),t.fireEvent("sheet:changed",[t,c]),t.fireEvent("sheet:updateColors",[!0]),Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+t.api.asc_getActiveWorksheetId()],!1)}},setMathInfo:function(t){t.count>1?(this.boxMath.is(":visible")||this.boxMath.show(),this.labelCount.text(this.textCount+": "+t.count),this.labelMin.text(t.min&&t.min.length?this.textMin+": "+t.min:""),this.labelMax.text(t.max&&t.max.length?this.textMax+": "+t.max:""),this.labelSum.text(t.sum&&t.sum.length?this.textSum+": "+t.sum:""),this.labelAverage.text(t.average&&t.average.length?this.textAverage+": "+t.average:""),this.labelMin[t.min&&t.min.length>0?"show":"hide"](),this.labelMax[t.max&&t.max.length>0?"show":"hide"](),this.labelSum[t.sum&&t.sum.length>0?"show":"hide"](),this.labelAverage[t.average&&t.average.length>0?"show":"hide"](),this.customizeStatusBarMenu.items.forEach((function(e){"math-item-average"===e.options.id?e.options.exampleval=t.average&&t.average.length?t.average:"":"math-item-min"===e.options.id?e.options.exampleval=t.min&&t.min.length?t.min:"":"math-item-max"===e.options.id?e.options.exampleval=t.max&&t.max.length?t.max:"":"math-item-count"===e.options.id?e.options.exampleval=t.count?String(t.count):"":"math-item-sum"===e.options.id&&(e.options.exampleval=t.sum&&t.sum.length?t.sum:""),$(e.el).find("label").text(e.options.exampleval)}))):(this.customizeStatusBarMenu.items.forEach((function(t){t.options.exampleval="",$(t.el).find("label").text("")})),this.boxMath.is(":visible")&&this.boxMath.hide());var e=this;_.delay((function(){e.updateVisibleItemsBoxMath(),e.updateTabbarBorders(),e.onTabInvisible(void 0,e.tabbar.checkInvisible(!0))}),30)},setFilteredInfo:function(t,e){if(t>0&&e>0)this.boxFiltered.is(":visible")||this.boxFiltered.show(),this.labelFiltered.text(Common.Utils.String.format(this.filteredRecordsText,t,e));else if(t)this.boxFiltered.is(":visible")||this.boxFiltered.show(),this.labelFiltered.text(this.filteredText);else if(null!=t)this.boxFiltered.is(":visible")&&this.boxFiltered.hide();else{var i=this.api.asc_getCellInfo().asc_getAutoFilterInfo(),n=!i||!0!==i.asc_getIsApplyAutoFilter();this.setFilteredInfo(!n)}var o=this;_.delay((function(){o.onTabInvisible(void 0,o.tabbar.checkInvisible(!0))}),30)},onSheetChanged:function(t,e,i){this.api.asc_showWorksheet(i.sheetindex),this.updateNumberOfSheet(i.sheetindex,this.api.asc_getWorksheetsCount()),this.hasTabInvisible&&!this.tabbar.isTabVisible(e)&&this.tabbar.setTabVisible(e),this.mode.isEdit&&this.tabbar.addDataHint(e,this.mode.isEditOle?"1":"0"),this.fireEvent("sheet:changed",[this,i.sheetindex]),this.fireEvent("sheet:updateColors",[!0])},onTabMenu:function(t,e,i,n){var o=this;if(this.mode.isEdit&&!this.isEditFormula&&this.rangeSelectionMode!==Asc.c_oAscSelectionDialogType.Chart&&this.rangeSelectionMode!==Asc.c_oAscSelectionDialogType.FormatTable&&this.rangeSelectionMode!==Asc.c_oAscSelectionDialogType.PrintTitles&&!this.mode.isDisconnected&&i&&i.sheetindex>=0){var s=i.$el.get(0).getBoundingClientRect(),a=(i.$el.offset(),i.$el.parent().offset());if(i.isActive()||this.tabbar.setActive(i),_.isUndefined(n))l=o.api.asc_isWorksheetLockedOrDeleted(i.sheetindex);else{var l=!1;n.forEach((function(t){o.api.asc_isWorksheetLockedOrDeleted(t.sheetindex)&&(l=!0)}))}var r=this.api.asc_isWorkbookLocked(),c=this.api.asc_isProtectedWorkbook();this.tabMenu.items[0].setDisabled(r||c),this.tabMenu.items[1].setDisabled(l||c),this.tabMenu.items[2].setDisabled(l||c),this.tabMenu.items[3].setDisabled(l||c),this.tabMenu.items[4].setDisabled(l||c),this.tabMenu.items[5].setDisabled(l||c),this.tabMenu.items[6].setDisabled(r||c),this.tabMenu.items[7].setDisabled(n.length>1),this.tabMenu.items[8].setDisabled(l||c),this.tabMenu.items[7].setVisible(!this.mode.isEditOle),this.tabMenu.items[7].setCaption(this.api.asc_isProtectedSheet()?this.itemUnProtect:this.itemProtect),1===n.length?this.tabMenu.items[11].hide():this.tabMenu.items[11].show(),this.tabMenu.items[10].setDisabled(l||c),this.tabMenu.items[11].setDisabled(l||c),this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!1),this.tabMenu.atposition={top:s.top,left:s.left-a.left-2},this.tabMenu.hide(),this.tabMenu.show();var d=this.tabMenu;_.defer((function(){d.cmpEl.focus()}),10)}},onTabMenuAfterShow:function(t){t.atposition&&t.setOffset(t.atposition.left),this.enableKeyEvents=!0},onTabMenuAfterHide:function(){_.isUndefined(this.enableKeyEvents)||(this.api&&this.api.asc_enableKeyEvents(this.enableKeyEvents),this.enableKeyEvents=void 0)},onTabMenuClick:function(t,e){e&&this.api&&(this.enableKeyEvents="ins"===e.value||"hide"===e.value,"selectall"===e.value?this.tabbar.setSelectAll(!0):"noselect"===e.value&&this.tabbar.setSelectAll(!1))},onTabInvisible:function(t,e){this.btnScrollBack.isDisabled()!==!e.first&&this.btnScrollBack.setDisabled(!e.first),this.btnScrollNext.isDisabled()!==!e.last&&this.btnScrollNext.setDisabled(!e.last),this.hasTabInvisible=e.first||e.last},onBtnTabScroll:function(t,e){this.tabbar.setTabVisible(t)},updateTabbarBorders:function(){var t=!1,e=parseInt(this.boxZoom.css("width"));if(this.boxMath.is(":visible")&&(this.boxMath.css({right:e+"px"}),e+=parseInt(this.boxMath.css("width")),t=!0),this.boxFiltered.is(":visible")&&(this.boxFiltered.css({right:e+"px"}),e+=parseInt(this.boxFiltered.css("width")),t=!0),this.isCompact){if(this.boxAction.is(":visible")){var i=this.tabbar.getWidth(),n=this.actionWidth||140;if(Common.Utils.innerWidth()-e-129-n-i>0){var o=i+129;this.boxAction.css({right:e+"px",left:o+"px",width:"auto"}),this.boxAction.find(".separator").css("border-left-color","transparent")}else this.boxAction.css({right:e+"px",left:"auto",width:n+"px"}),this.boxAction.find(".separator").css("border-left-color",""),t=!0;e+=parseInt(this.boxAction.css("width"))}this.boxMath.is(":visible")&&this.boxMath.css({top:"0px",bottom:"auto"}),this.boxFiltered.is(":visible")&&this.boxFiltered.css({top:"0px",bottom:"auto"}),this.boxZoom.css({top:"0px",bottom:"auto"}),this.tabBarBox.css("right",e+"px")}else this.boxAction.is(":visible")&&(this.boxAction.css({right:e+"px",left:"135px",width:"auto"}),this.boxAction.find(".separator").css("border-left-color","transparent")),this.boxMath.is(":visible")&&this.boxMath.css({top:"auto",bottom:"0px"}),this.boxFiltered.is(":visible")&&this.boxFiltered.css({top:"auto",bottom:"0px"}),this.boxZoom.css({top:"auto",bottom:"0px"}),this.tabBarBox.css("right","0px");if(this.boxZoom.find(".separator").css("border-left-color",t?"":"transparent"),this.statusMessage){var s=this.getStatusMessage(this.statusMessage);s!==this.boxAction.text().trim()&&this.labelAction.text(s)}},updateVisibleItemsBoxMath:function(){var t=parseInt(this.$el.css("width")),e=parseInt(this.boxZoom.css("width"))+parseInt($("#status-tabs-scroll").css("width"))+parseInt($("#status-addtabs-box").css("width"));for(this.boxFiltered.is(":visible")&&(e+=parseInt(this.boxFiltered.css("width"))),this.$el.find(".over-box").removeClass("over-box");e+parseInt(this.boxMath.css("width"))+100>t;){var i=this.boxMath.find("label:not(.hide, .over-box)");if(i.length>0&&$(i[i.length-1]).addClass("over-box"),i.length<=1)break}},changeViewMode:function(t){var e=t.isEdit;e?this.tabBarBox.css("left","129px"):this.tabBarBox.css("left",""),this.tabbar.options.draggable=e,this.editMode=e},showCustomizeStatusBar:function(t){var e=$(t.target);$("#status-zoom-box").find(e).length>0||$(t.target).closest(".statusbar .list-item").length>0||$("#status-tabs-scroll").find(e).length>0||$("#status-addtabs-box").find(e).length>0||(this.customizeStatusBarMenu.hide(),this.customizeStatusBarMenu.atposition={left:t.clientX*Common.Utils.zoom(),top:t.clientY*Common.Utils.zoom()},this.customizeStatusBarMenu.show())},onCustomizeStatusBarAfterShow:function(t){if(t.atposition){var e=$(this.el).height(),i=!this.isCompact&&t.atposition.top-$(this.el).offset().top>e/2?e/2:0;t.setOffset(t.atposition.left,i)}this.enableKeyEvents=!0},onCustomizeStatusBarAfterHide:function(){_.isUndefined(this.enableKeyEvents)||(this.api&&this.api.asc_enableKeyEvents(this.enableKeyEvents),this.enableKeyEvents=void 0)},onCustomizeStatusBarClick:function(t,e,i){var n=e.value,o=e.checked;"status"===n?this.boxAction[o?"removeClass":"addClass"]("hide"):(this.boxMath.find("#status-math-"+n)[o?"removeClass":"addClass"]("hide"),this.boxMath.find("label").length===this.boxMath.find("label.hide").length?this.boxMath.find(".separator").hide():this.boxMath.find(".separator").is(":hidden")&&this.boxMath.find(".separator").show()),this.updateVisibleItemsBoxMath(),this.updateTabbarBorders(),this.onTabInvisible(void 0,this.tabbar.checkInvisible(!0)),i.stopPropagation(),e.$el.find("a").blur()},onChangeCompact:function(t){this.isCompact=t,t?(this.cntStatusbar.removeClass("no-compact"),this.boxNumberSheets.hide()):(this.cntStatusbar.addClass("no-compact"),this.boxNumberSheets.show()),this.updateTabbarBorders(),this.tabbar.getCount()>0&&this.onTabInvisible(void 0,this.tabbar.checkInvisible(!0))},updateNumberOfSheet:function(t,e){this.labelNumberSheets.text(Common.Utils.String.format(this.sheetIndexText,t+1,e))},getStatusMessage:function(t){return this.isCompact&&t.length>23&&this.boxAction.width()<180?t.substr(0,23).trim()+"...":t},showStatusMessage:function(t,e){this.statusMessage=t,this.actionWidth||(this.actionWidth=t.length>22?166:140),this.labelAction.text(this.getStatusMessage(t)),this.customizeStatusBarMenu.items.forEach((function(e){"saved-status"===e.options.id&&(e.options.exampleval=t),$(e.el).find("label").text(e.options.exampleval)})),this.boxAction.is(":visible")||this.boxAction.show();var i=this;_.delay((function(){i.updateTabbarBorders(),i.onTabInvisible(void 0,i.tabbar.checkInvisible(!0)),e&&e()}),30)},clearStatusMessage:function(){this.labelAction.text(""),this.statusMessage=void 0},getStatusLabel:function(){return this.labelAction},sheetIndexText:"Sheet {0} of {1}",tipZoomIn:"Zoom In",tipZoomOut:"Zoom Out",tipZoomFactor:"Magnification",tipPrev:"Previous Sheet",tipNext:"Next Sheet",tipAddTab:"Add Worksheet",tipListOfSheets:"List of Sheets",itemInsert:"Insert",itemDelete:"Delete",itemRename:"Rename",itemCopy:"Copy",itemMove:"Move",itemHide:"Hide",itemHidden:"Hidden",itemTabColor:"Tab Color",textNoColor:"No Color",textNewColor:"Add New Custom Color",zoomText:"Zoom {0}%",textSum:"Sum",textCount:"Count",textAverage:"Average",textMin:"Min",textMax:"Max",filteredRecordsText:"{0} of {1} records filtered",filteredText:"Filter mode",selectAllSheets:"Select All Sheets",ungroupSheets:"Ungroup Sheets",itemAverage:"Average",itemCount:"Count",itemMinimum:"Minimum",itemMaximum:"Maximum",itemSum:"Sum",itemStatus:"Saving status",itemProtect:"Protect",itemUnProtect:"Unprotect"},SSE.Views.Statusbar||{})),SSE.Views.Statusbar.RenameDialog=Common.UI.Window.extend(_.extend({options:{header:!1,width:280,cls:"modal-dlg",buttons:["ok","cancel"]},template:'<div class="box"><div class="input-row"><label><%= label %></label></div><div class="input-row" id="txt-sheet-name"></div></div>',initialize:function(t){_.extend(this.options,t||{},{label:this.labelSheetName}),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.txtName=new Common.UI.InputField({el:t.find("#txt-sheet-name"),style:"width:100%;",value:Common.Utils.String.htmlEncode(this.options.current),allowBlank:!1,maxLength:31,validation:_.bind(this.nameValidator,this)})},show:function(t,e){Common.UI.Window.prototype.show.apply(this,arguments);var i=this.txtName.$el.find("input");_.delay((function(t){i.focus(),i.select()}),100,this)},onBtnClick:function(t){this.doClose(t.currentTarget.attributes.result.value)},doClose:function(t){"ok"!=t||!0===this.txtName.checkValidate()?(this.options.handler&&this.options.handler.call(this,t,this.txtName.getValue()),this.close()):_.delay((function(t){t.txtName.focus()}),100,this)},onPrimary:function(t){return this.doClose("ok"),!1},nameValidator:function(t){var e=this.options.names;if(!e&&this.options.api){var i=this.options.api,n=i.asc_getActiveWorksheetIndex(),o=i.asc_getWorksheetsCount();for(e=[];o--;)n!==o&&e.push(i.asc_getWorksheetName(o).toLowerCase())}if(e)for(var s=t.toLowerCase(),a=e.length-1;a>=0;--a)if(e[a]===s)return this.errNameExists;return t.length>2&&'"'==t[0]&&'"'==t[t.length-1]||(!/[:\\\/\*\?\[\]\']/.test(t)||this.errNameWrongChar)},errNameExists:"Worksheet with such name already exist.",errNameWrongChar:"A sheet name cannot contains characters: \\, /, *, ?, [, ], :",labelSheetName:"Sheet Name"},e||{})),SSE.Views.Statusbar.CopyDialog=Common.UI.Window.extend(_.extend({options:{width:270,cls:"modal-dlg",buttons:["ok","cancel"]},template:'<div class="box"><div class="input-row"><label><%= label %></label></div><div id="status-list-names" style="height: 162px;"></div></div>',initialize:function(t){_.extend(this.options,t||{},{label:t.ismove?this.textMoveBefore:this.textCopyBefore}),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this));var e=[];this.options.names.forEach((function(t){e.push(new Common.UI.DataViewModel(t))}),this),e.length&&e.push(new Common.UI.DataViewModel({value:this.options.ismove?this.itemMoveToEnd:this.itemCopyToEnd,inindex:-255})),this.listNames=new Common.UI.ListView({el:$("#status-list-names",t),store:new Common.UI.DataViewStore(e),cls:"dbl-clickable",itemTemplate:_.template('<div id="<%= id %>" class="list-item"><%= Common.Utils.String.htmlEncode(value) %></div>')}),this.listNames.selectByIndex(0),this.listNames.on("entervalue",_.bind(this.onPrimary,this)),this.listNames.on("item:dblclick",_.bind(this.onPrimary,this)),this.mask=$(".modals-mask"),this.mask.on("mousedown",_.bind(this.onUpdateFocus,this))},show:function(t,e){Common.UI.Window.prototype.show.apply(this,arguments),_.delay((function(t){t.listNames.focus()}),100,this)},hide:function(){Common.UI.Window.prototype.hide.apply(this,arguments),this.mask.off("mousedown",_.bind(this.onUpdateFocus,this))},onBtnClick:function(t){var e=this.listNames.getSelectedRec();this.options.handler&&this.options.handler.call(this,t.currentTarget.attributes.result.value,e.get("inindex")),this.close()},onPrimary:function(){this.options.handler&&this.options.handler.call(this,"ok",this.listNames.getSelectedRec().get("inindex")),this.close()},onUpdateFocus:function(){_.delay((function(t){t.listNames.focus()}),100,this)},itemCopyToEnd:"(Copy to end)",itemMoveToEnd:"(Move to end)",textCopyBefore:"Copy before sheet",textMoveBefore:"Move before sheet"},i||{}))})),define("spreadsheeteditor/main/app/controller/Statusbar",["core","spreadsheeteditor/main/app/view/Statusbar"],(function(){"use strict";SSE.Controllers.Statusbar=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Statusbar"],initialize:function(){this.addListeners({Statusbar:{"show:tab":_.bind(this.showTab,this),"show:hidden":_.bind((function(t,e){this.hideWorksheet(!1,e)}),this),"sheet:changename":_.bind((function(){this.api.asc_closeCellEditor(),this.renameWorksheet()}),this),"sheet:setcolor":_.bind(this.setWorksheetColor,this),"sheet:updateColors":_.bind(this.updateTabsColors,this),"sheet:move":_.bind(this.moveWorksheet,this)},ViewTab:{"statusbar:setcompact":_.bind(this.onChangeViewMode,this)}})},events:function(){return{"click #status-btn-zoomdown":_.bind(this.zoomDocument,this,"down"),"click #status-btn-zoomup":_.bind(this.zoomDocument,this,"up"),"click .cnt-zoom":_.bind(this.onZoomShow,this)}},onLaunch:function(){this.statusbar=this.createView("Statusbar").render(),this.statusbar.$el.css("z-index",10),this.statusbar.labelZoom.css("min-width",80),this.statusbar.labelZoom.text(Common.Utils.String.format(this.zoomText,100)),this.statusbar.zoomMenu.on("item:click",_.bind(this.menuZoomClick,this)),this.bindViewEvents(this.statusbar,this.events),$("#id-tab-menu-new-color",this.statusbar.$el).on("click",_.bind(this.onNewBorderColor,this))},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onZoomChanged",_.bind(this.onZoomChange,this)),this.api.asc_registerCallback("asc_onSelectionMathChanged",_.bind(this.onApiMathChanged,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiDisconnect,this)),this.api.asc_registerCallback("asc_onUpdateTabColor",_.bind(this.onApiUpdateTabColor,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onWorkbookLocked",_.bind(this.onWorkbookLocked,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onChangeProtectWorkbook",_.bind(this.onChangeProtectWorkbook,this)),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this)),this.api.asc_registerCallback("asc_onFilterInfo",_.bind(this.onApiFilterInfo,this)),this.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(this.onApiActiveSheetChanged,this)),this.api.asc_registerCallback("asc_onRefreshNamedSheetViewList",_.bind(this.onRefreshNamedSheetViewList,this)),this.statusbar.setApi(t)},zoomDocument:function(t,e){if(this.api){switch(t){case"up":var i=Math.floor(10*this.api.asc_getZoom())/10;!((i+=.1)>5)&&this.api.asc_setZoom(i);break;case"down":i=Math.ceil(10*this.api.asc_getZoom())/10,!((i-=.1)<.1)&&this.api.asc_setZoom(i)}Common.NotificationCenter.trigger("edit:complete",this.statusbar)}},menuZoomClick:function(t,e){this.api&&this.api.asc_setZoom(e.value/100),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},onZoomChange:function(t,e){this.statusbar.labelZoom.text(Common.Utils.String.format(this.zoomText,Math.floor(100*(t+.005))))},onApiDisconnect:function(){this.SetDisabled(!0)},SetDisabled:function(t){this.statusbar.setMode({isDisconnected:t}),this.statusbar.update()},onWorkbookLocked:function(t){this.statusbar.tabbar[t?"addClass":"removeClass"]("coauth-locked"),this.statusbar.btnAddWorksheet.setDisabled(t||this.api.isCellEdited||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.Chart||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.FormatTable||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.PrintTitles||this.api.asc_isProtectedWorkbook());for(var e,i=this.statusbar.tabbar.getCount();i-- >0;)(e=this.statusbar.tabbar.getAt(i)).sheetindex>=0||(e.disable(t),e.$el.children(":first-child").attr("draggable",t?"false":"true"))},onWorksheetLocked:function(t,e){for(var i,n=this.statusbar.tabbar.getCount(),o=this.api.asc_isProtectedWorkbook(),s=n;s-- >0;)if(t==(i=this.statusbar.tabbar.getAt(s)).sheetindex){i[e?"addClass":"removeClass"]("coauth-locked"),i.isLockTheDrag=e||o||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.FormatTable||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.PrintTitles,i.$el.children(":first-child").attr("draggable",i.isLockTheDrag?"false":"true");break}var a=this.statusbar.sheetListMenu.items[t];a.$el.children().first().data("hidden")&&a.setDisabled(e)},onChangeProtectWorkbook:function(){var t=this.api.asc_isProtectedWorkbook();this.statusbar.btnAddWorksheet.setDisabled(this.api.isCellEdited||this.api.asc_isWorkbookLocked()||t||this.statusbar.rangeSelectionMode!=Asc.c_oAscSelectionDialogType.None);for(var e,i=this.statusbar.tabbar.getCount();i-- >0;){var n=(e=this.statusbar.tabbar.getAt(i)).hasClass("coauth-locked");e.isLockTheDrag=n||t||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.FormatTable||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.PrintTitles,e.$el.children(":first-child").attr("draggable",e.isLockTheDrag?"false":"true")}this.statusbar.update()},onApiMathChanged:function(t){this.statusbar.setMathInfo({count:t.asc_getCount(),average:t.asc_getAverage(),min:t.asc_getMin(),max:t.asc_getMax(),sum:t.asc_getSum()}),this.statusbar.updateTabbarBorders()},onApiFilterInfo:function(t,e){this.statusbar.setFilteredInfo(t,e),this.statusbar.updateTabbarBorders()},onApiEditCell:function(t){var e=t==Asc.c_oAscCellEditorState.editFormula,i=t!=Asc.c_oAscCellEditorState.editEnd,n=$(".statusbar-mask"),o=this.statusbar;o.isEditFormula=e,o.tabbar&&(o.tabbar.isEditFormula=e),o.btnZoomUp.setDisabled(i),o.btnZoomDown.setDisabled(i),o.labelZoom[i?"addClass":"removeClass"]("disabled"),o.btnAddWorksheet.setDisabled(i||this.api.asc_isWorkbookLocked()||this.api.asc_isProtectedWorkbook()||o.rangeSelectionMode!=Asc.c_oAscSelectionDialogType.None),o.$el.find("#statusbar_bottom li span").attr("oo_editor_input",!e),e&&n.length>0||!e&&0==n.length||(o.$el.find(".statusbar").toggleClass("masked",e),e?n=$("<div class='statusbar-mask'>").appendTo(o.$el):n.remove())},createDelayedElements:function(){this.statusbar.$el.css("z-index",""),this.statusbar.tabMenu.on("item:click",_.bind(this.onTabMenu,this)),this.statusbar.btnAddWorksheet.on("click",_.bind(this.onAddWorksheetClick,this)),Common.UI.LayoutManager.isElementVisible("statusBar-actionStatus")&&!this.statusbar.mode.isEditOle||(this.statusbar.customizeStatusBarMenu.items[0].setVisible(!1),this.statusbar.customizeStatusBarMenu.items[1].setVisible(!1),this.statusbar.boxAction.addClass("hide")),Common.NotificationCenter.on("window:resize",_.bind(this.onWindowResize,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onRangeDialogMode,this))},onWindowResize:function(t){this.statusbar.updateVisibleItemsBoxMath(),this.statusbar.updateTabbarBorders(),this.statusbar.onTabInvisible(void 0,this.statusbar.tabbar.checkInvisible(!0))},onRangeDialogMode:function(t){var e=this.statusbar.tabbar.hasClass("coauth-locked"),i=this.api.asc_getActiveWorksheetIndex();this.statusbar.btnAddWorksheet.setDisabled(e||this.api.isCellEdited||this.api.asc_isProtectedWorkbook()||t!=Asc.c_oAscSelectionDialogType.None),this.statusbar.btnSheetList[t==Asc.c_oAscSelectionDialogType.FormatTable||t==Asc.c_oAscSelectionDialogType.PrintTitles?"addClass":"removeClass"]("disabled");for(var n,o=this.statusbar.tabbar.getCount(),s=this.api.asc_isProtectedWorkbook();o-- >0;)(n=this.statusbar.tabbar.getAt(o)).sheetindex!==i&&n.disable(t==Asc.c_oAscSelectionDialogType.FormatTable||t==Asc.c_oAscSelectionDialogType.PrintTitles),n.isLockTheDrag=n.hasClass("coauth-locked")||s||t!=Asc.c_oAscSelectionDialogType.None;this.statusbar.rangeSelectionMode=t},onTabMenu:function(t,e,i){var n=this,o=this.statusbar.tabbar.selectTabs,s=[];switch(o.forEach((function(t){s.push(t.sheetindex)})),e.value){case"ins":for(var a=[],l=0;l<s.length;l++)a.push(n.createSheetName(a));setTimeout((function(){n.api.asc_insertWorksheet(a)}),1);break;case"del":this.deleteWorksheet(s);break;case"ren":this.renameWorksheet();break;case"copy":this.moveWorksheet(s,!1);break;case"move":this.moveWorksheet(s,!0);break;case"hide":setTimeout((function(){n.hideWorksheet(!0,s)}),1);break;case"protect":this.protectWorksheet()}},createSheetName:function(t){for(var e=[],i=this.api.asc_getWorksheetsCount();i--;)e.push(this.api.asc_getWorksheetName(i).toLowerCase());for(var n,o=0;o++,n=this.strSheet+o,!(e.indexOf(n.toLowerCase())<0););if(t&&t.length>0){var s=[];for(t.forEach((function(t){s.push(t.toLowerCase())}));-1!==s.indexOf(n.toLowerCase())||-1!==e.indexOf(n.toLowerCase());)o++,n=this.strSheet+o}return n},createCopyName:function(t,e){for(var i=this.api.asc_getWorksheetsCount(),n=[];i--;)n.push(this.api.asc_getWorksheetName(i).toLowerCase());for(var o,s=/^(.*)\((\d)\)$/.exec(t),a=s?s[1]:t+" ",l=1;o=a+"("+ ++l+")",!(n.indexOf(o.toLowerCase())<0););if(e&&e.length>0){var r=[];for(e.forEach((function(t){r.push(t.toLowerCase())}));-1!==r.indexOf(o.toLowerCase());)o=a+"("+ ++l+")"}return o},deleteWorksheet:function(t){var e=this;1==this.statusbar.tabbar.tabs.length||t.length===this.statusbar.tabbar.tabs.length?Common.UI.warning({msg:this.errorLastSheet}):Common.UI.warning({msg:this.warnDeleteSheet,buttons:["ok","cancel"],callback:function(i){"ok"!=i||e.api.asc_deleteWorksheet(t)||_.delay((function(){Common.UI.error({msg:e.errorRemoveSheet})}),10)}})},hideWorksheet:function(t,e){if(t)1==this.statusbar.tabbar.tabs.length||e.length===this.statusbar.tabbar.tabs.length?Common.UI.warning({msg:this.errorLastSheet}):this.api.asc_hideWorksheet(e);else{this.api.asc_showWorksheet(e),this.loadTabColor(e);var i=this;setTimeout((function(){i.statusbar.tabMenu.hide()}),1)}},renameWorksheet:function(){var t=this,e=t.api.asc_getWorksheetsCount(),i=null;if(e>0){var n=t.api.asc_getActiveWorksheetIndex();if(t.api.asc_isWorksheetLockedOrDeleted(n))return;if(!Common.Utils.InternalSettings.get("sse-settings-coauthmode"))for(i=[];e--;)n!==e&&i.push(t.api.asc_getWorksheetName(e).toLowerCase());var o=t.statusbar.tabbar.tabs[t.statusbar.tabbar.getActive()],s=t.statusbar.$el.position().top-115,a=o.$el.offset().left,l=t.api.asc_getWorksheetName(t.api.asc_getActiveWorksheetIndex()),r=new SSE.Views.Statusbar.RenameDialog({current:l,names:i,api:t.api,handler:function(e,i){"ok"==e&&i!=l&&t.api.asc_renameWorksheet(i),t.api.asc_enableKeyEvents(!0)}});if("number"==typeof r.options.width){var c=$("body").width();a+r.options.width>c&&(a=c-r.options.width-5)}r.show(a,s)}},moveWorksheet:function(t,e,i,n){for(var o=this,s=o.api.asc_getWorksheetsCount(),a=[],l=[],r=-1;++r<s;)this.api.asc_isWorksheetHidden(r)||a.push({value:o.api.asc_getWorksheetName(r),inindex:r});if(_.isUndefined(t)||a.forEach((function(e){-1!==t.indexOf(e.inindex)&&l.push(e.inindex)})),_.isUndefined(i))new SSE.Views.Statusbar.CopyDialog({title:e?o.statusbar.itemMove:o.statusbar.itemCopy,ismove:e,names:a,handler:function(t,i){if("ok"==t)if(e)o.api.asc_moveWorksheet(-255==i?s:i,l);else{var n=[];l.forEach((function(t){n.push(o.createCopyName(o.api.asc_getWorksheetName(t),n))})),o.api.asc_copyWorksheet(-255==i?s:i,n,l)}o.api.asc_enableKeyEvents(!0)}}).show();else if(e)o.api.asc_moveWorksheet(n,l),o.api.asc_enableKeyEvents(!0);else{var c=[];l.forEach((function(t){c.push(o.createCopyName(o.api.asc_getWorksheetName(t),c))})),o.api.asc_copyWorksheet(n,c,l)}},onAddWorksheetClick:function(t,e,i){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_addWorksheet(this.createSheetName()),Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+this.api.asc_getActiveWorksheetId()],!1)),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},showTab:function(t){this.api&&this.api.asc_getActiveWorksheetIndex()!==t&&(this.api.asc_showWorksheet(t),this.loadTabColor(t));var e=this;setTimeout((function(){e.statusbar.sheetListMenu.hide()}),1)},selectTab:function(t){if(this.api&&!this.api.asc_isWorksheetHidden(t)){var e=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:t});e&&this.statusbar.tabbar.setActive(e)}},onApiUpdateTabColor:function(t){this.loadTabColor(t)},setWorksheetColor:function(t){var e=this;if(this.api){var i=this.statusbar.tabbar.selectTabs,n=[];if(i.forEach((function(t){n.push(t.sheetindex)})),n)if("transparent"===t)this.api.asc_setWorksheetTabColor(null,n),i.forEach((function(t){t.$el.find("span").css("box-shadow","")}));else{var o=Common.Utils.ThemeColor.getRgbColor(t);o&&(this.api.asc_setWorksheetTabColor(o,n),i.forEach((function(t){e.setTabLineColor(t,o)})))}}},updateThemeColors:function(){this.statusbar&&function(t,e){if(t){for(var i,n=Common.Utils.ThemeColor.getEffectColors(),o=0;o<n.length;++o)"object"==typeof t.currentColor&&void 0===i&&t.currentColor.effectId==n[o].effectId&&(i=n[o]);t.updateColors(n,Common.Utils.ThemeColor.getStandartColors()),void 0===t.currentColor?t.currentColor=n[e]:void 0!==i&&(t.currentColor=i)}}(this.statusbar.mnuTabColor,1)},onNewBorderColor:function(){this.statusbar&&this.statusbar.mnuTabColor&&this.statusbar.mnuTabColor.addNewColor()},updateTabsColors:function(t){var e=-1,i=-1,n=null,o=null,s=!1,a=this.api.asc_getWorksheetsCount(),l=this.api.asc_getActiveWorksheetIndex();if(!_.isUndefined(t)&&this.application.getController("Toolbar"))if(this.statusbar.mnuTabColor.updateCustomColors(),(n=this.api.asc_getWorksheetTabColor(l))&&(o=n.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(n.get_r(),n.get_g(),n.get_b()),effectValue:n.get_value()}:Common.Utils.ThemeColor.getHexColor(n.get_r(),n.get_g(),n.get_b())),_.isObject(o)){var r=!1;for(e=0;e<10;e++)if(Common.Utils.ThemeColor.ThemeValues[e]===o.effectValue){this.statusbar.mnuTabColor.select(o,!0),r=!0;break}r||this.statusbar.mnuTabColor.clearSelection()}else this.statusbar.mnuTabColor.select(o||"transparent",!0);for(e=-1;++e<a;)++i,(s=this.api.asc_isWorksheetHidden(e))&&--i,s||this.setTabLineColor(this.statusbar.tabbar.getAt(i),this.api.asc_getWorksheetTabColor(e))},loadTabColor:function(t){if(this.api&&!this.api.asc_isWorksheetHidden(t)){var e=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:t});e&&this.setTabLineColor(e,this.api.asc_getWorksheetTabColor(t))}},setTabLineColor:function(t,e){t&&((e=null!==e?"#"+Common.Utils.ThemeColor.getHexColor(e.get_r(),e.get_g(),e.get_b()):"").length?(this.statusbar.sheetListMenu.items[t.sheetindex].$el.find(".color").css("background-color",e),e=t.isActive()?"0px 4px 0 "+e+" inset":"0px 4px 0 "+Common.Utils.RGBColor(e).toRGBA(1)+" inset",t.$el.find("span").css("box-shadow",e)):(t.$el.find("span").css("box-shadow",""),this.statusbar.sheetListMenu.items[t.sheetindex].$el.find(".color").css("background-color","")))},onZoomShow:function(t){if(t.target.classList.contains("disabled"))return!1},onError:function(t,e,i){t==Asc.c_oAscError.ID.LockedWorksheetRename&&this.statusbar.update()},onApiActiveSheetChanged:function(t){this.statusbar.tabMenu.hide(),this.statusbar.sheetListMenu.hide(),this.statusbar.sheetListMenu.items[t]&&(this.statusbar.sheetListMenu.clearAll(),this.statusbar.sheetListMenu.items[t].setChecked(!0)),this._sheetViewTip&&this._sheetViewTip.isVisible()&&this.api.asc_getActiveNamedSheetView&&!this.api.asc_getActiveNamedSheetView(t)&&this._sheetViewTip.hide()},onRefreshNamedSheetViewList:function(){for(var t=this.api.asc_getNamedSheetViews(),e=!1,i="",n=this,o=0;o<t.length;o++)if(t[o].asc_getIsActive()){e=!0,i=t[o].asc_getName();break}var s=this.statusbar.tabbar.getAt(this.statusbar.tabbar.getActive());s&&s.changeIconState(e,i),!e||Common.localStorage.getBool("sse-hide-sheet-view-tip")||Common.Utils.InternalSettings.get("sse-hide-sheet-view-tip")?!e&&this._sheetViewTip&&this._sheetViewTip.isVisible()&&this._sheetViewTip.hide():(this._sheetViewTip||(this._sheetViewTip=new Common.UI.SynchronizeTip({target:$("#editor_sdk"),extCls:"no-arrow",text:this.textSheetViewTipFilters,placement:"target"}),this._sheetViewTip.on({dontshowclick:function(){Common.localStorage.setBool("sse-hide-sheet-view-tip",!0),Common.Utils.InternalSettings.set("sse-hide-sheet-view-tip",!0),this.close(),n._sheetViewTip=void 0},closeclick:function(){Common.Utils.InternalSettings.set("sse-hide-sheet-view-tip",!0),this.close(),n._sheetViewTip=void 0}})),this._sheetViewTip.isVisible()||this._sheetViewTip.show())},onChangeViewMode:function(t,e,i){this.statusbar.fireEvent("view:compact",[this.statusbar,e]),!i&&Common.localStorage.setBool("sse-compact-statusbar",e),Common.NotificationCenter.trigger("layout:changed","status"),this.statusbar.onChangeCompact(e),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},setStatusCaption:function(t,e,i,n){this.timerCaption&&(new Date<this.timerCaption||0==t.length)&&!e||(this.timerCaption=void 0,t.length?(this.statusbar.showStatusMessage(t,n),i>0&&(this.timerCaption=(new Date).getTime()+i)):this.statusbar.clearStatusMessage())},protectWorksheet:function(){Common.NotificationCenter.trigger("protect:sheet",!this.api.asc_isProtectedSheet())},getIsDragDrop:function(){var t=this.statusbar.tabbar.isDragDrop;return this.statusbar.tabbar.isDragDrop=!1,t},showDisconnectTip:function(){var t=this;if(!this.disconnectTip){var e=this.statusbar.getStatusLabel();e=e.is(":visible")?e.parent():this.statusbar.isVisible()?this.statusbar.$el:$(document.body),this.disconnectTip=new Common.UI.SynchronizeTip({target:e,text:this.textDisconnect,placement:"top",position:this.statusbar.isVisible()?void 0:{bottom:0},showLink:!1,style:"max-width: 310px;"}),this.disconnectTip.on({closeclick:function(){t.disconnectTip.hide(),t.disconnectTip=null}})}this.disconnectTip.show()},hideDisconnectTip:function(){this.disconnectTip&&this.disconnectTip.hide(),this.disconnectTip=null},zoomText:"Zoom {0}%",errorLastSheet:"Workbook must have at least one visible worksheet.",errorRemoveSheet:"Can't delete the worksheet.",warnDeleteSheet:"The worksheet maybe has data. Proceed operation?",strSheet:"Sheet",textSheetViewTip:"You are in Sheet View mode. Filters and sorting are visible only to you and those who are still in this view.",textSheetViewTipFilters:"You are in Sheet View mode. Filters are visible only to you and those who are still in this view.",textDisconnect:"<b>Connection is lost</b><br>Trying to connect. Please check connection settings."},SSE.Controllers.Statusbar||{}))})),define("text!spreadsheeteditor/main/app/template/RightMenu.template",[],(function(){return'<div id="view-right-menu" class="tool-menu right">\n    <div class="right-panel">\n        <div id="id-table-settings" class="settings-panel">\n        </div>\n        <div id="id-shape-settings" class="settings-panel">\n        </div>\n        <div id="id-image-settings" class="settings-panel">\n        </div>\n        <div id="id-chart-settings" class="settings-panel">\n        </div>\n        <div id="id-paragraph-settings" class="settings-panel">\n        </div>\n        <div id="id-textart-settings" class="settings-panel">\n        </div>\n        <div id="id-pivot-settings" class="settings-panel">\n        </div>\n        <div id="id-signature-settings" class="settings-panel">\n        </div>\n        <div id="id-cell-settings" class="settings-panel">\n        </div>\n        <div id="id-slicer-settings" class="settings-panel">\n        </div>\n    </div>\n    <div class="tool-menu-btns">\n        <div class="ct-btn-category arrow-left"></div>\n        <button id="id-right-menu-cell" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-cell-settings"><i class="icon toolbar__icon btn-menu-cell">&nbsp;</i></button>\n        <button id="id-right-menu-table" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-table-settings"><i class="icon toolbar__icon btn-menu-table">&nbsp;</i></button>\n        <button id="id-right-menu-shape" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-shape-settings"><i class="icon toolbar__icon btn-menu-shape">&nbsp;</i></button>\n        <button id="id-right-menu-image" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-image-settings"><i class="icon toolbar__icon btn-menu-image">&nbsp;</i></button>\n        <button id="id-right-menu-chart" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-chart-settings"><i class="icon toolbar__icon btn-menu-chart">&nbsp;</i></button>\n        <button id="id-right-menu-text" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-paragraph-settings"><i class="icon toolbar__icon btn-paragraph">&nbsp;</i></button>\n        <button id="id-right-menu-textart" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-textart-settings"><i class="icon toolbar__icon btn-menu-textart">&nbsp;</i></button>\n        <button id="id-right-menu-pivot" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-pivot-settings"><i class="icon toolbar__icon btn-pivot-sum">&nbsp;</i></button>\n        <button id="id-right-menu-slicer" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-slicer-settings"><i class="icon toolbar__icon btn-slicer">&nbsp;</i></button>\n        <button id="id-right-menu-signature" class="btn btn-category arrow-left hidden" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-signature-settings"><i class="icon toolbar__icon btn-menu-signature">&nbsp;</i></button>\n    </div>\n</div>'})),define("text!spreadsheeteditor/main/app/template/ParagraphSettings.template",[],(function(){return'<table cols="2">\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strLineHeight %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-combo-line-rule" style="width: 85px;"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-spin-line-height"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strParagraphSpacing %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strSpacingBefore %></label>\r\n            <div id="paragraph-spin-spacing-before"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strSpacingAfter %></label>\r\n            <div id="paragraph-spin-spacing-after"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link" id="paragraph-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}));var c_paragraphLinerule={LINERULE_LEAST:0,LINERULE_AUTO:1,LINERULE_EXACT:2};if(define("spreadsheeteditor/main/app/view/ParagraphSettings",["text!spreadsheeteditor/main/app/template/ParagraphSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","spreadsheeteditor/main/app/view/ParagraphSettingsAdvanced"],(function(t,e,i,n){"use strict";SSE.Views.ParagraphSettings=n.View.extend(i.extend({el:"#id-paragraph-settings",template:i.template(t),events:{},options:{alias:"ParagraphSettings"},initialize:function(){this._initSettings=!0,this._state={LineRule:c_paragraphLinerule.LINERULE_AUTO,LineHeight:1.5,LineSpacingBefore:0,LineSpacingAfter:.35,DisabledControls:!1},this.spinners=[],this.lockedControls=[],this._locked=!1,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#paragraph-advanced-link")},setApi:function(t){return this.api=t,this.api&&this.api.asc_registerCallback("asc_onParaSpacingLine",i.bind(this._onLineSpacing,this)),this},onNumLineHeightChange:function(t,e,i,n){""!==this.cmbLineRule.getRawValue()&&this.api&&this.api.asc_putPrLineSpacing(this.cmbLineRule.getValue(),this.cmbLineRule.getValue()==c_paragraphLinerule.LINERULE_AUTO?t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},onNumSpacingBeforeChange:function(t,e,i,n){this.api&&(t.getNumberValue()<0?this.api.asc_putLineSpacingBeforeAfter(0,-1):this.api.asc_putLineSpacingBeforeAfter(0,Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},onNumSpacingAfterChange:function(t,e,i,n){this.api&&(t.getNumberValue()<0?this.api.asc_putLineSpacingBeforeAfter(1,-1):this.api.asc_putLineSpacingBeforeAfter(1,Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},onLineRuleSelect:function(t,e){this.api&&this.api.asc_putPrLineSpacing(e.value,e.defaultValue),this.numLineHeight.setDefaultUnit(e.defaultUnit),this.numLineHeight.setMinValue(e.minValue),this.numLineHeight.setStep(e.step),Common.NotificationCenter.trigger("edit:complete",this)},_onLineSpacing:function(t){if(!this._initSettings){var e=t.asc_getLineRule(),i=t.asc_getLine();if(this._state.LineRule!==e){var n,o=this.cmbLineRule.store.findWhere(((n={}).value=e,n));o||(o=this.cmbLineRule.store.at(0)),this.cmbLineRule.setValue(null!==e?e:""),this.numLineHeight.setMinValue(o.get("minValue")),this.numLineHeight.setDefaultUnit(o.get("defaultUnit")),this.numLineHeight.setStep(o.get("step")),this._state.LineRule=e}if(Math.abs(this._state.LineHeight-i)>.001||(null===this._state.LineHeight||null===i)&&this._state.LineHeight!==i){var s="";e==c_paragraphLinerule.LINERULE_AUTO?s=i:null!==e&&null!==i&&(s=Common.Utils.Metric.fnRecalcFromMM(i)),this.numLineHeight.setValue(null!==s?s:"",!0),this._state.LineHeight=i}}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){var e={Line:t.asc_getSpacing().asc_getLine(),Before:t.asc_getSpacing().asc_getBefore(),After:t.asc_getSpacing().asc_getAfter(),LineRule:t.asc_getSpacing().asc_getLineRule()};if(this._state.LineRule!==e.LineRule){var i,n=this.cmbLineRule.store.findWhere(((i={}).value=e.LineRule,i));n||(n=this.cmbLineRule.store.at(0)),this.cmbLineRule.setValue(null!==e.LineRule?e.LineRule:""),this.numLineHeight.setMinValue(n.get("minValue")),this.numLineHeight.setDefaultUnit(n.get("defaultUnit")),this.numLineHeight.setStep(n.get("step")),this._state.LineRule=e.LineRule}if(Math.abs(this._state.LineHeight-e.Line)>.001||(null===this._state.LineHeight||null===e.Line)&&this._state.LineHeight!==e.Line){var o="";e.LineRule==c_paragraphLinerule.LINERULE_AUTO?o=e.Line:null!==e.LineRule&&null!==e.Line&&(o=Common.Utils.Metric.fnRecalcFromMM(e.Line)),this.numLineHeight.setValue(null!==o?o:"",!0),this._state.LineHeight=e.Line}(Math.abs(this._state.LineSpacingBefore-e.Before)>.001||(null===this._state.LineSpacingBefore||null===e.Before)&&this._state.LineSpacingBefore!==e.Before)&&(this.numSpacingBefore.setValue(null!==e.Before?e.Before<0?e.Before:Common.Utils.Metric.fnRecalcFromMM(e.Before):"",!0),this._state.LineSpacingBefore=e.Before),(Math.abs(this._state.LineSpacingAfter-e.After)>.001||(null===this._state.LineSpacingAfter||null===e.After)&&this._state.LineSpacingAfter!==e.After)&&(this.numSpacingAfter.setValue(null!==e.After?e.After<0?e.After:Common.Utils.Metric.fnRecalcFromMM(e.After):"",!0),this._state.LineSpacingAfter=e.After)}},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01)}var i=this._state.LineSpacingBefore;this.numSpacingBefore&&this.numSpacingBefore.setValue(null!==i?i<0?i:Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=this._state.LineSpacingAfter,this.numSpacingAfter&&this.numSpacingAfter.setValue(null!==i?i<0?i:Common.Utils.Metric.fnRecalcFromMM(i):"",!0)}if(this.cmbLineRule){var n=this.cmbLineRule.store.at(1);if(n.set({defaultUnit:Common.Utils.Metric.getCurrentMetricName(),minValue:parseFloat(Common.Utils.Metric.fnRecalcFromMM(.3).toFixed(2)),step:Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01}),null!==this._state.LineRule){var o;(n=this.cmbLineRule.store.findWhere(((o={}).value=this._state.LineRule,o)))||(n=this.cmbLineRule.store.at(0)),this.numLineHeight.setDefaultUnit(n.get("defaultUnit")),this.numLineHeight.setStep(n.get("step"));i="";this._state.LineRule==c_paragraphLinerule.LINERULE_AUTO?i=this._state.LineHeight:null!==this._state.LineHeight&&(i=Common.Utils.Metric.fnRecalcFromMM(this._state.LineHeight)),this.numLineHeight&&this.numLineHeight.setValue(null!==i?i:"",!0)}}},createDelayedControls:function(){var t=this;this._arrLineRule=[{displayValue:this.textAuto,defaultValue:1,value:c_paragraphLinerule.LINERULE_AUTO,minValue:.5,step:.01,defaultUnit:""},{displayValue:this.textExact,defaultValue:5,value:c_paragraphLinerule.LINERULE_EXACT,minValue:.03,step:.01,defaultUnit:"cm"}],this.cmbLineRule=new Common.UI.ComboBox({el:e("#paragraph-combo-line-rule"),cls:"input-group-nr",menuStyle:"min-width: 85px;",editable:!1,data:this._arrLineRule,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbLineRule.setValue(c_paragraphLinerule.LINERULE_AUTO),this.lockedControls.push(this.cmbLineRule),this.numLineHeight=new Common.UI.MetricSpinner({el:e("#paragraph-spin-line-height"),step:.01,width:85,value:"1.5",defaultUnit:"",maxValue:132,minValue:.5,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.numLineHeight),this.numSpacingBefore=new Common.UI.MetricSpinner({el:e("#paragraph-spin-spacing-before"),step:.1,width:85,value:"0 cm",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.numSpacingBefore),this.lockedControls.push(this.numSpacingBefore),this.numSpacingAfter=new Common.UI.MetricSpinner({el:e("#paragraph-spin-spacing-after"),step:.1,width:85,value:"0.35 cm",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.numSpacingAfter),this.lockedControls.push(this.numSpacingAfter),this.numLineHeight.on("change",i.bind(this.onNumLineHeightChange,this)),this.numSpacingBefore.on("change",i.bind(this.onNumSpacingBeforeChange,this)),this.numSpacingAfter.on("change",i.bind(this.onNumSpacingAfterChange,this)),this.numLineHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.numSpacingBefore.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.numSpacingAfter.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.cmbLineRule.on("selected",i.bind(this.onLineRuleSelect,this)),this.cmbLineRule.on("hide:after",i.bind(this.onHideMenus,this)),e(this.el).on("click","#paragraph-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].asc_getObjectType(),o=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Paragraph==n){new SSE.Views.ParagraphSettingsAdvanced({paragraphProps:o,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.borderAdvancedProps=i.borderProps,e.api.asc_setGraphicObjectProps(i.paragraphProps)),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},onHideMenus:function(t,e,i){i||Common.NotificationCenter.trigger("edit:complete",this)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t))},strParagraphSpacing:"Paragraph Spacing",strLineHeight:"Line Spacing",strSpacingBefore:"Before",strSpacingAfter:"After",textAuto:"Multiple",textAtLeast:"At least",textExact:"Exactly",textAdvanced:"Show advanced settings",textAt:"At",txtAutoText:"Auto"},SSE.Views.ParagraphSettings||{}))})),define("text!spreadsheeteditor/main/app/template/ImageSettings.template",[],(function(){return'<table cols="3">\r\n    <tr>\r\n        <td colspan=3>\r\n            <label class="header"><%= scope.textSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textWidth %></label>\r\n            <div id="image-spin-width"></div>\r\n        </td>\r\n        <td class="padding-small" width="28px" style="vertical-align: bottom;">\r\n            <div id="image-button-ratio"></div>\r\n        </td>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textHeight %></label>\r\n            <div id="image-spin-height"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="2">\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default" id="image-button-original-size" style="min-width:100px;width: auto;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textOriginalSize %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="image-button-crop" style="min-width:100px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <label class="header"><%= scope.textRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.textRotate90 %></label>\r\n            <div>\r\n                <div id="image-button-270" style="display: inline-block;margin-right: 4px;"></div>\r\n                <div id="image-button-90" style="display: inline-block;"></div>\r\n            </div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.textFlip %></label>\r\n            <div>\r\n                <div id="image-button-fliph" style="display: inline-block;margin-right: 4px;"></div>\r\n                <div id="image-button-flipv" style="display: inline-block;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <div id="image-button-replace" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default hidden" id="image-button-edit-object" style="width:100%;"><%= scope.textEditObject %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link" id="image-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),define("spreadsheeteditor/main/app/view/ImageSettings",["text!spreadsheeteditor/main/app/template/ImageSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/view/ImageFromUrlDialog","spreadsheeteditor/main/app/view/ImageSettingsAdvanced"],(function(t,e,i,n){"use strict";SSE.Views.ImageSettings=n.View.extend(i.extend({el:"#id-image-settings",template:i.template(t),events:{},options:{alias:"ImageSettings"},initialize:function(){this._initSettings=!0,this._nRatio=1,this._state={Width:0,Height:0,DisabledControls:!1,keepRatio:!1,isOleObject:!1,cropMode:!1},this.spinners=[],this.lockedControls=[],this._locked=!1,this._noApply=!1,this._originalProps=null,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#image-advanced-link")},setApi:function(t){if(null!=t)return this.api=t,this.api&&this.api.asc_registerCallback("asc_ChangeCropState",i.bind(this._changeCropState,this)),Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this.spnWidth&&this.spnWidth.setValue(null!==this._state.Width?Common.Utils.Metric.fnRecalcFromMM(this._state.Width):"",!0),this.spnHeight&&this.spnHeight.setValue(null!==this._state.Height?Common.Utils.Metric.fnRecalcFromMM(this._state.Height):"",!0)}},createDelayedControls:function(){var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:e("#image-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnWidth),this.lockedControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:e("#image-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnHeight),this.lockedControls.push(this.spnHeight),this.btnRatio=new Common.UI.Button({parentEl:e("#image-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnRatio),this.btnRatio.on("click",i.bind((function(t,e){if(t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this.api){var i=new Asc.asc_CImgProperty;i.asc_putLockAspect(t.pressed),this.api.asc_setGraphicObjectProps(i)}}),this)),this.btnOriginalSize=new Common.UI.Button({el:e("#image-button-original-size")}),this.lockedControls.push(this.btnOriginalSize),this.btnSelectImage=new Common.UI.Button({parentEl:e("#image-button-replace"),cls:"btn-text-menu-default",caption:this.textInsert,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this.btnEditObject=new Common.UI.Button({el:e("#image-button-edit-object")}),this.lockedControls.push(this.btnEditObject),this.spnWidth.on("change",i.bind(this.onWidthChange,this)),this.spnHeight.on("change",i.bind(this.onHeightChange,this)),this.spnWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnOriginalSize.on("click",i.bind(this.setOriginalSize,this)),this.btnEditObject.on("click",i.bind((function(t){if(this.api){var e=this.api.asc_canEditTableOleObject(!0);if(e){var i=SSE.getController("Common.Controllers.ExternalOleEditor").getView("Common.Views.ExternalOleEditor");i&&(i.setEditMode(!0),i.show(),i.setOleData(Asc.asc_putBinaryDataToFrameFromTableOleObject(e)))}else this.api.asc_startEditCurrentOleObject()}Common.NotificationCenter.trigger("edit:complete",this)}),this));var n=this.btnOriginalSize.cmpEl.outerWidth();this.btnCrop=new Common.UI.Button({parentEl:e("#image-button-crop"),cls:"btn-text-split-default",caption:this.textCrop,split:!0,enableToggle:!0,allowDepress:!0,pressed:this._state.cropMode,width:n,menu:new Common.UI.Menu({style:"min-width:"+n+"px;",items:[{caption:this.textCrop,checkable:!0,allowDepress:!0,checked:this._state.cropMode,value:0},{caption:this.textCropToShape,menu:new Common.UI.Menu({menuAlign:"tl-tl",cls:"menu-shapes menu-change-shape",items:[]})},{caption:this.textCropFill,value:1},{caption:this.textCropFit,value:2}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnCrop.on("click",i.bind(this.onCrop,this)),this.btnCrop.menu.on("item:click",i.bind(this.onCropMenu,this)),this.lockedControls.push(this.btnCrop),this.btnChangeShape=this.btnCrop.menu.items[1],this.btnRotate270=new Common.UI.Button({parentEl:e("#image-button-270",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",value:0,hint:this.textHint270,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnRotate270.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate270),this.btnRotate90=new Common.UI.Button({parentEl:e("#image-button-90",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",value:1,hint:this.textHint90,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnRotate90.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate90),this.btnFlipV=new Common.UI.Button({parentEl:e("#image-button-flipv",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-vert",value:0,hint:this.textHintFlipV,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnFlipV.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipV),this.btnFlipH=new Common.UI.Button({parentEl:e("#image-button-fliph",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-hor",value:1,hint:this.textHintFlipH,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnFlipH.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipH),e(this.el).on("click","#image-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this.onApiAutoShapes(),this._initSettings=!1},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].asc_getObjectType(),o=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Image==n){new SSE.Views.ImageSettingsAdvanced({imageProps:o,api:e.api,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_setGraphicObjectProps(i.imageProps),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.btnChangeShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,n=Common.localStorage.getItem("sse-recent-shapes"),o=new Common.UI.MenuItem({template:i.template('<div id="id-img-change-shape-menu" class="menu-insertshape"></div>'),index:0});t.btnChangeShape.menu.addItem(o),new Common.UI.DataViewShape({el:e("#id-img-change-shape-menu"),itemTemplate:i.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>'),groups:t.application.getCollection("ShapeGroups"),parentMenu:t.btnChangeShape.menu,restoreHeight:652,textRecentlyUsed:t.textRecentlyUsed,recentShapes:n?JSON.parse(n):null,hideTextRect:!0}).on("item:click",(function(e,i,n,o){t.api&&(t.api.asc_changeShapeType(n.get("data").shapeType),Common.NotificationCenter.trigger("edit:complete",t)),"click"!==o.type&&t.btnCrop.menu.hide()}))},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){this._originalProps=new Asc.asc_CImgProperty(t);var e=t.asc_getWidth();(Math.abs(this._state.Width-e)>.001||(null===this._state.Width||null===e)&&this._state.Width!==e)&&(this.spnWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Width=e),e=t.asc_getHeight(),(Math.abs(this._state.Height-e)>.001||(null===this._state.Height||null===e)&&this._state.Height!==e)&&(this.spnHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Height=e),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),e=t.asc_getLockAspect(),this._state.keepRatio!==e&&(this.btnRatio.toggle(e),this._state.keepRatio=e),this.btnOriginalSize.setDisabled(null===t.asc_getImageUrl()||void 0===t.asc_getImageUrl()||this._locked);var i=t.asc_getPluginGuid();if(e=null!=i,this._state.isOleObject!==e&&(this.btnSelectImage.setVisible(!e),this.btnEditObject.setVisible(e),this._state.isOleObject=e),this.btnRotate270.setDisabled(e||this._locked),this.btnRotate90.setDisabled(e||this._locked),this.btnFlipV.setDisabled(e||this._locked),this.btnFlipH.setDisabled(e||this._locked),this._state.isOleObject){var n=SSE.getCollection("Common.Collections.Plugins").findWhere({guid:i});this.btnEditObject.setDisabled(!this.api.asc_canEditTableOleObject()&&null==n||this._locked)}else this.btnSelectImage.setDisabled(null===i||this._locked)}},onWidthChange:function(t,e,i,n){var o=t.getNumberValue(),s=this.spnHeight.getNumberValue();if(this.btnRatio.pressed&&((s=o/this._nRatio)>this.spnHeight.options.maxValue&&(o=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(o,!0)),this.spnHeight.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(o)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(a)}},onHeightChange:function(t,e,i,n){var o=t.getNumberValue(),s=this.spnWidth.getNumberValue();if(this.btnRatio.pressed&&((s=o*this._nRatio)>this.spnWidth.options.maxValue&&(o=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(o,!0)),this.spnWidth.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(o)),this.api.asc_setGraphicObjectProps(a)}},setOriginalSize:function(){if(this.api){var t=this.api.asc_getOriginalImageSize(),e=t.asc_getImageWidth(),i=t.asc_getImageHeight(),n=new Asc.asc_CImgProperty;n.asc_putWidth(e),n.asc_putHeight(i),n.put_ResetCrop(!0),n.put_Rot(0),this.api.asc_setGraphicObjectProps(n),Common.NotificationCenter.trigger("edit:complete",this)}},setImageUrl:function(t,e){var i=new Asc.asc_CImgProperty;i.asc_putImageUrl(t,e),this.api.asc_setGraphicObjectProps(i)},insertImageFromStorage:function(t){t&&t._urls&&"change"==t.c&&this.setImageUrl(t._urls[0],t.token)},onImageSelect:function(t,e){if(1==e.value){var n=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&n.api){var o=e.replace(/ /g,"");i.isEmpty(o)||n.setImageUrl(o)}Common.NotificationCenter.trigger("edit:complete",n)}}).show()}else if(2==e.value)Common.NotificationCenter.trigger("storage:image-load","change");else{if(this._isFromFile)return;this._isFromFile=!0,this.api&&this.api.asc_changeImageFromFile(),Common.NotificationCenter.trigger("edit:complete",this),this._isFromFile=!1}},_changeCropState:function(t){this._state.cropMode=t,this.btnCrop&&(this.btnCrop.toggle(t,!0),this.btnCrop.menu.items[0].setChecked(t,!0))},onCrop:function(t,e){this.api&&(t.pressed?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),Common.NotificationCenter.trigger("edit:complete",this)},onCropMenu:function(t,e){this.api&&(1==e.value?this.api.asc_cropFill():2==e.value?this.api.asc_cropFit():e.checked?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),Common.NotificationCenter.trigger("edit:complete",this)},onBtnRotateClick:function(t){var e=new Asc.asc_CImgProperty;e.asc_putRotAdd(3.14159265358979*(1==t.options.value?90:270)/180),this.api.asc_setGraphicObjectProps(e),Common.NotificationCenter.trigger("edit:complete",this)},onBtnFlipClick:function(t){var e=new Asc.asc_CImgProperty;1==t.options.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.api.asc_setGraphicObjectProps(e),Common.NotificationCenter.trigger("edit:complete",this)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||(this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t)),this.btnCrop.setDisabled(t||!this.api.asc_canEditCrop()))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textOriginalSize:"Actual Size",textInsert:"Replace Image",textFromUrl:"From URL",textFromFile:"From File",textEditObject:"Edit Object",textEdit:"Edit",textAdvanced:"Show advanced settings",textRotation:"Rotation",textRotate90:"Rotate 90°",textFlip:"Flip",textHint270:"Rotate 90° Counterclockwise",textHint90:"Rotate 90° Clockwise",textHintFlipV:"Flip Vertically",textHintFlipH:"Flip Horizontally",textCrop:"Crop",textCropFill:"Fill",textCropFit:"Fit",textCropToShape:"Crop to shape",textFromStorage:"From Storage",textRecentlyUsed:"Recently Used"},SSE.Views.ImageSettings||{}))})),define("text!spreadsheeteditor/main/app/template/ChartSettings.template",[],(function(){return'<table cols="3" id="chart-panel-size">\r\n    <tr>\r\n        <td colspan=3>\r\n            <label class="header"><%= scope.textSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textWidth %></label>\r\n            <div id="chart-spin-width"></div>\r\n        </td>\r\n        <td class="padding-small" width="28px" style="vertical-align: bottom;">\r\n            <div id="chart-button-ratio"></div>\r\n        </td>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textHeight %></label>\r\n            <div id="chart-spin-height"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="chart-panel-types">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="not-combined">\r\n        <td class="padding-large">\r\n            <label class="header" style=""><%= scope.textStyle %></label>\r\n            <div class="" id="chart-combo-style" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-btn-change-type" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-btn-select-data" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-btn-switch" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="spark-panel-types">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textType %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="spark-button-type" style=""></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textStyle %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="input-label" style=""><%= scope.strTemplate %></label>\r\n            <div class="" id="spark-combo-style" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div style="display:inline-block;vertical-align: middle;width:55px;">\r\n                <label class="input-label" style=""><%= scope.strSparkColor %></label>\r\n                <div id="spark-color-btn" style=""></div>\r\n            </div>\r\n            <div style="display:inline-block;vertical-align: middle;">\r\n                <label class="input-label" style=""><%= scope.strLineWeight %></label>\r\n                <div id="spark-combo-line-type" style="width: 93px;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="spark-panel-points">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="header" style="margin-bottom: 4px;"><%= scope.textShow %></label>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-high" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-high-color-btn" style="display: inline-block; float:right;"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-low" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-low-color-btn" style="display: inline-block; float:right;"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-negative" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-negative-color-btn" style="display: inline-block; float:right;"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-first" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-first-color-btn" style="display: inline-block; float:right;"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-last" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-last-color-btn" style="display: inline-block; float:right;"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px;">\r\n                <div id="spark-checkbox-markers" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-markers-color-btn" style="display: inline-block; float:right;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center">\r\n            <label class="link" id="chart-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),define("text!spreadsheeteditor/main/app/template/ChartSettingsDlg.template",[],(function(){return'<div id="id-chart-settings-dlg-style" class="settings-panel active">\r\n    <div class="inner-content">\r\n        <table cols="1" style="">\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textType %></label>\r\n                    <div id="chart-dlg-button-type" style="margin-right: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-layout" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td class="padding-small" width="50%">\r\n                    <label class="input-label"><%= scope.textChartTitle %></label>\r\n                    <div id="chart-dlg-combo-chart-title" class="input-group-nr" style="margin-right: 7px;"></div>\r\n                </td>\r\n                <td class="padding-small" width="50%">\r\n                    <label class="input-label" style="margin-left: 7px;"><%= scope.textLegendPos %></label>\r\n                    <div id="chart-dlg-combo-legend-pos" class="input-group-nr" style="margin-left: 7px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="50%">\r\n                    <label class="input-label"><%= scope.textDataLabels %></label>\r\n                    <div id="chart-dlg-combo-data-labels" class="input-group-nr" style="margin-right: 7px;"></div>\r\n                </td>\r\n                <td rowspan="2" class="padding-small" width="50%">\r\n                    <div id="chart-dlg-check-series" style="margin: 20px 0 9px 7px;"></div>\r\n                    <div id="chart-dlg-check-category" style="margin: 0 0 9px 7px;"></div>\r\n                    <div id="chart-dlg-check-value" style="margin: 0 0 5px 7px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="50%">\r\n                    <label class="input-label"><%= scope.textSeparator %></label>\r\n                    <div id="chart-dlg-txt-separator" class="input-row"  style="margin-right: 7px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="50%">\r\n                    <label id="chart-dlg-label-lines" class="input-label"><%= scope.textLines %></label>\r\n                    <div id="chart-dlg-combo-lines" class="input-group-nr padding-small" style="margin-right: 7px;"></div>\r\n                </td>\r\n                <td style="vertical-align: bottom;" width="50%">\r\n                    <div id="chart-dlg-check-markers" style="margin: 0 0 12px 7px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-vert" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%">\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <div id="chart-dlg-chk-vert-hide-0" class="input-group-nr"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textAxisTitle %></label>\r\n                    <div id="chart-dlg-combo-vert-title-0" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textGridLines %></label>\r\n                    <div id="chart-dlg-combo-vert-grid-0" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <table cols="3" style="width: 100%">\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textMinValue %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-mintype-0"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="chart-dlg-input-min-value-0"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textMaxValue %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-maxtype-0"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="chart-dlg-input-max-value-0"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="100">\r\n                    <label class="input-label"><%= scope.textAxisCrosses %></label>\r\n                </td>\r\n                <td class="padding-large" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-v-crosstype-0"></div>\r\n                </td>\r\n                <td class="padding-large" width="90">\r\n                    <div id="chart-dlg-input-v-axis-crosses-0"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="input-label"><%= scope.textUnits %></label>\r\n                    <div id="chart-dlg-combo-units-0" class="input-group-nr" style="width: 140px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <div id="chart-dlg-check-v-reverse-0"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <div id="chart-dlg-check-v-logscale-0"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <div style="float: right;">\r\n                        <label class="input-label"><%= scope.textBase %></label>\r\n                        <div id="chart-dlg-input-base-0" style="display: inline-block;margin-left: 5px;"></div>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textTickOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textMajorType %></label>\r\n                    <div id="chart-dlg-combo-v-major-type-0" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textMinorType %></label>\r\n                    <div id="chart-dlg-combo-v-minor-type-0" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textLabelOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label class="input-label"><%= scope.textLabelPos %></label>\r\n                </td>\r\n                <td>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <div id="chart-dlg-combo-v-label-pos-0" class="input-group-nr"></div>\r\n                </td>\r\n                <td>\r\n                    <button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-v-format-0" style="min-width: 100px;margin-left: 15px;"><%= scope.textFormat %></button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-vert-sec" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%">\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <div id="chart-dlg-chk-vert-hide-1" class="input-group-nr"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textAxisTitle %></label>\r\n                    <div id="chart-dlg-combo-vert-title-1" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textGridLines %></label>\r\n                    <div id="chart-dlg-combo-vert-grid-1" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <table cols="3" style="width: 100%">\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textMinValue %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-mintype-1"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="chart-dlg-input-min-value-1"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textMaxValue %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-maxtype-1"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="chart-dlg-input-max-value-1"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="100">\r\n                    <label class="input-label"><%= scope.textAxisCrosses %></label>\r\n                </td>\r\n                <td class="padding-large" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-v-crosstype-1"></div>\r\n                </td>\r\n                <td class="padding-large" width="90">\r\n                    <div id="chart-dlg-input-v-axis-crosses-1"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="input-label"><%= scope.textUnits %></label>\r\n                    <div id="chart-dlg-combo-units-1" class="input-group-nr" style="width: 140px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <div id="chart-dlg-check-v-reverse-1"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <div id="chart-dlg-check-v-logscale-1"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <div style="float: right;">\r\n                        <label class="input-label"><%= scope.textBase %></label>\r\n                        <div id="chart-dlg-input-base-1" style="display: inline-block;margin-left: 5px;"></div>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textTickOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textMajorType %></label>\r\n                    <div id="chart-dlg-combo-v-major-type-1" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textMinorType %></label>\r\n                    <div id="chart-dlg-combo-v-minor-type-1" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textLabelOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label class="input-label"><%= scope.textLabelPos %></label>\r\n                </td>\r\n                <td>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <div id="chart-dlg-combo-v-label-pos-1" class="input-group-nr" ></div>\r\n                </td>\r\n                <td>\r\n                    <button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-v-format-1" style="min-width: 100px;margin-left: 15px;"><%= scope.textFormat %></button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-hor" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%">\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <div id="chart-dlg-chk-hor-hide-0" class="input-group-nr"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textAxisTitle %></label>\r\n                    <div id="chart-dlg-combo-hor-title-0" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textGridLines %></label>\r\n                    <div id="chart-dlg-combo-hor-grid-0" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <table cols="3" style="width: 100%">\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textAxisCrosses %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-h-crosstype-0"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="chart-dlg-input-h-axis-crosses-0"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="100">\r\n                    <label class="input-label"><%= scope.textAxisPos %></label>\r\n                </td>\r\n                <td colspan=2 class="padding-large">\r\n                    <div id="chart-dlg-combo-axis-pos-0" class="input-group-nr" style="width:140px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=3 class="padding-large">\r\n                    <div id="chart-dlg-check-h-reverse-0"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textTickOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="140">\r\n                    <label class="input-label"><%= scope.textMajorType %></label>\r\n                    <div id="chart-dlg-combo-h-major-type-0" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textMinorType %></label>\r\n                    <div id="chart-dlg-combo-h-minor-type-0" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="100%" colspan="2">\r\n                    <label class="input-label"><%= scope.textMarksInterval %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="140">\r\n                    <div id="chart-dlg-input-marks-interval-0"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textLabelOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="140">\r\n                    <label class="input-label"><%= scope.textLabelPos %></label>\r\n                    <div id="chart-dlg-combo-h-label-pos-0" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textLabelDist %></label>\r\n                    <div id="chart-dlg-input-label-dist-0" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="100%" colspan="2">\r\n                    <label class="input-label"><%= scope.textLabelInterval %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="100%" colspan="2">\r\n                    <div id="chart-dlg-combo-label-int-0" class="input-group-nr" style="display: inline-block;width: 100px;vertical-align: middle;"></div>\r\n                    <div id="chart-dlg-input-label-int-0" style="display: inline-block;margin-left: 3px;width: 60px;vertical-align: middle;"></div>\r\n                    <button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-h-format-0" style="min-width:100px; margin-left: 5px;vertical-align: middle;float: right;"><%= scope.textFormat %></button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-hor-sec" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%">\r\n            <tr>\r\n                <td colspan="2" class="padding-small">\r\n                    <div id="chart-dlg-chk-hor-hide-1" class="input-group-nr"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textAxisTitle %></label>\r\n                    <div id="chart-dlg-combo-hor-title-1" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textGridLines %></label>\r\n                    <div id="chart-dlg-combo-hor-grid-1" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <table cols="3" style="width: 100%">\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textAxisCrosses %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="chart-dlg-combo-h-crosstype-1"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="chart-dlg-input-h-axis-crosses-1"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="100">\r\n                    <label class="input-label"><%= scope.textAxisPos %></label>\r\n                </td>\r\n                <td colspan=2 class="padding-large">\r\n                    <div id="chart-dlg-combo-axis-pos-1" class="input-group-nr" style="width:140px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=3 class="padding-large">\r\n                    <div id="chart-dlg-check-h-reverse-1"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textTickOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="140">\r\n                    <label class="input-label"><%= scope.textMajorType %></label>\r\n                    <div id="chart-dlg-combo-h-major-type-1" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textMinorType %></label>\r\n                    <div id="chart-dlg-combo-h-minor-type-1" class="input-group-nr" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="100%" colspan="2">\r\n                    <label class="input-label"><%= scope.textMarksInterval %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="140">\r\n                    <div id="chart-dlg-input-marks-interval-1"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textLabelOptions %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="140">\r\n                    <label class="input-label"><%= scope.textLabelPos %></label>\r\n                    <div id="chart-dlg-combo-h-label-pos-1" class="input-group-nr"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textLabelDist %></label>\r\n                    <div id="chart-dlg-input-label-dist-1" style="margin-left: 15px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="100%" colspan="2">\r\n                    <label class="input-label"><%= scope.textLabelInterval %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td width="100%" colspan="2">\r\n                    <div id="chart-dlg-combo-label-int-1" class="input-group-nr" style="display: inline-block;width: 100px;vertical-align: middle;"></div>\r\n                    <div id="chart-dlg-input-label-int-1" style="display: inline-block;margin-left: 3px;width: 60px;vertical-align: middle;"></div>\r\n                    <button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-h-format-1" style="min-width:100px; margin-left: 5px;vertical-align: middle;float: right;"><%= scope.textFormat %></button>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-spark-settings-dlg-style" class="settings-panel">\r\n    <div class="inner-content padding-large">\r\n        <table cols="2" style="">\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textType %></label>\r\n                    <div id="spark-dlg-button-type" style="margin-right: 15px;"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textStyle %></label>\r\n                    <div id="spark-dlg-combo-style" style="width: 190px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textEmptyCells %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="230">\r\n                    <label class="input-label"><%= scope.textShowEmptyCells %></label>\r\n                    <div id="spark-dlg-combo-empty" class="input-group-nr" style="margin-right: 10px;"></div>\r\n                </td>\r\n                <td></td>\r\n            </tr>\r\n            <tr>\r\n                <td colspan=2>\r\n                    <div id="spark-dlg-check-show-data"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-spark-settings-dlg-axis" class="settings-panel">\r\n    <div class="inner-content">\r\n        <div class="padding-large" >\r\n            <label class="header padding-small" style="display: block;"><%= scope.textHorAxis %></label>\r\n            <div id="spark-dlg-check-show" class="padding-small" style="display: block;"></div>\r\n            <div id="spark-dlg-check-reverse" class="padding-small" style="display: block;"></div>\r\n        </div>\r\n        <table cols="3" style="width: 100%">\r\n            <tr>\r\n                <td colspan="3">\r\n                    <label class="header  padding-small"><%= scope.textVertAxis %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="100">\r\n                    <label class="input-label"><%= scope.textMinValue %></label>\r\n                </td>\r\n                <td class="padding-small" width="115" style="padding-right: 10px;">\r\n                    <div id="spark-dlg-combo-mintype"></div>\r\n                </td>\r\n                <td class="padding-small" width="90">\r\n                    <div id="spark-dlg-input-min-value"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="100">\r\n                    <label class="input-label"><%= scope.textMaxValue %></label>\r\n                </td>\r\n                <td class="padding-large" width="115" style="padding-right: 10px;">\r\n                    <div id="spark-dlg-combo-maxtype"></div>\r\n                </td>\r\n                <td class="padding-large" width="90">\r\n                    <div id="spark-dlg-input-max-value"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-snap" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="chart-dlg-radio-twocell"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="chart-dlg-radio-onecell"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="chart-dlg-radio-absolute"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-chart-settings-dlg-alttext" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" width="100%">\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textAltTitle %></label>\r\n                    <div id="chart-advanced-alt-title"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label class="header"><%= scope.textAltDescription %></label>\r\n                    <textarea id="chart-advanced-alt-description" class="form-control" style="width: 100%; height: 120px;"></textarea>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label><%= scope.textAltTip %></label>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>'})),void 0===Common)var Common={};if(define("spreadsheeteditor/main/app/view/CellRangeDialog",["common/main/lib/component/InputField","common/main/lib/component/Window"],(function(){"use strict";SSE.Views.CellRangeDialog=Common.UI.Window.extend(_.extend({options:{width:350,cls:"modal-dlg",modal:!1,buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.txtTitle},t),this.template=['<div class="box">','<div id="id-dlg-cell-range" class="input-row" style="margin-bottom: 5px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();this.inputRange=new Common.UI.InputField({el:$("#id-dlg-cell-range"),name:"range",style:"width: 100%;",allowBlank:this.options.allowBlank||!1,blankError:this.txtEmpty,validateOnChange:!0}),t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.on("close",_.bind(this.onClose,this))},onPrimary:function(){return this._handleInput("ok"),!1},setSettings:function(t){var e=this;this.settings=t,this.inputRange.setValue(t.range?t.range:""),void 0===t.type&&(t.type=Asc.c_oAscSelectionDialogType.Chart),t.api&&(e.api=t.api,e.wrapEvents={onApiRangeChanged:_.bind(e.onApiRangeChanged,e)},e.api.asc_setSelectionDialogMode(t.type,t.range?t.range:""),e.api.asc_registerCallback("asc_onSelectionRangeChanged",e.wrapEvents.onApiRangeChanged),Common.NotificationCenter.trigger("cells:range",t.type)),e.inputRange.validation=function(i){return t.validation?t.validation.call(e,i):(t.type===Asc.c_oAscSelectionDialogType.Function&&(t.argvalues[t.argindex]=i,e.api.asc_insertArgumentsInFormula(t.argvalues)),(t.type===Asc.c_oAscSelectionDialogType.Function||e.api.asc_checkDataRange(t.type,i,!1))!=Asc.c_oAscError.ID.DataRangeError||e.txtInvalidRange)},t.type==Asc.c_oAscSelectionDialogType.Function&&(_.delay((function(){e.inputRange._input.focus(),t.selection&&(e.inputRange._input[0].selectionStart=t.selection.start,e.inputRange._input[0].selectionEnd=t.selection.end)}),10),e.inputRange._input.on("focus",(function(){e._addedTextLength=0,e.api.asc_cleanSelectRange()})))},getSettings:function(){return this.inputRange.getValue()},onApiRangeChanged:function(t){if(this.settings.type==Asc.c_oAscSelectionDialogType.Function){var e=this._addedTextLength||0,i=this.inputRange.getValue(),n=this.inputRange._input[0],o=n.selectionStart-e,s=n.selectionEnd,a=o>0&&0==e&&!this.api.asc_canEnterWizardRange(i.charAt(o-1))?"+":"";this._addedTextLength=t.length,i=i.substring(0,o)+a+t+i.substring(s,i.length),this.inputRange.setValue(i),n.selectionStart=n.selectionEnd=o+a.length+this._addedTextLength,this.settings.argvalues[this.settings.argindex]=i,this.api.asc_insertArgumentsInFormula(this.settings.argvalues)}else this.settings.type==Asc.c_oAscSelectionDialogType.DataValidation||this.settings.type==Asc.c_oAscSelectionDialogType.ConditionalFormattingRule?this.inputRange.setValue("="+t):this.inputRange.setValue(t);this.inputRange.cmpEl.hasClass("error")&&this.inputRange.cmpEl.removeClass("error")},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onClose:function(t){this.api&&(this.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None),this.api.asc_unregisterCallback("asc_onSelectionRangeChanged",this.wrapEvents.onApiRangeChanged)),Common.NotificationCenter.trigger("cells:range",Asc.c_oAscSelectionDialogType.None),SSE.getController("RightMenu").SetDisabled(!1)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputRange.checkValidate())return;if(this.options.handler.call(this,this,t))return}this.close()},show:function(){Common.UI.Window.prototype.show.call(this),SSE.getController("RightMenu").SetDisabled(!0)},txtTitle:"Select Data Range",txtEmpty:"This field is required",txtInvalidRange:"ERROR! Invalid cells range",errorMaxRows:"ERROR! The maximum number of data series per chart is 255.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price."},SSE.Views.CellRangeDialog||{}))})),void 0===Common)var Common={};if(define("spreadsheeteditor/main/app/view/ChartDataRangeDialog",["common/main/lib/component/InputField","common/main/lib/component/Window"],(function(){"use strict";SSE.Views.ChartDataRangeDialog=Common.UI.Window.extend(_.extend({options:{type:0,width:350,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){this.type=t.type||0,this.isScatter=t.isScatter,_.extend(this.options,{title:1==this.type?this.txtTitleSeries:this.txtTitleCategory},t),this.template=['<div class="box">','<table cols="2" style="width: 100%;">',"<tr>",'<td colspan="2">',"<label>"+(1==this.type?this.txtSeriesName:this.txtAxisLabel)+"</label>","</td>","</tr>","<tr>",'<td style="padding-bottom: 8px;width: 100%;">','<div id="id-dlg-chart-range-range1"></div>',"</td>",'<td style="padding-bottom: 8px;">','<label id="id-dlg-chart-range-lbl1" style="width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-left: 5px;margin-top: 4px;">'+this.txtChoose+"</label>","</td>","</tr>","<% if (type==1) { %>","<tr>",'<td colspan="2">',"<label>"+(this.isScatter?this.txtXValues:this.txtValues)+"</label>","</td>","</tr>","<tr>",'<td style="padding-bottom: 8px;width: 100%;">','<div id="id-dlg-chart-range-range2"></div>',"</td>",'<td style="padding-bottom: 8px;">','<label id="id-dlg-chart-range-lbl2" style="width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-left: 5px;margin-top: 4px;"></label>',"</td>","</tr>","<% if (isScatter) { %>","<tr>",'<td colspan="2">',"<label>"+this.txtYValues+"</label>","</td>","</tr>","<tr>",'<td style="padding-bottom: 8px;width: 100%;">','<div id="id-dlg-chart-range-range3"></div>',"</td>",'<td style="padding-bottom: 8px;">','<label id="id-dlg-chart-range-lbl3" style="width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-left: 5px;margin-top: 4px;"></label>',"</td>","</tr>","<% } %>","<% } %>","</table>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild(),e=this;e.inputRange1=new Common.UI.InputFieldBtn({el:$("#id-dlg-chart-range-range1"),style:"100%",btnHint:this.textSelectData,validateOnBlur:!1}).on("changed:after",(function(t,i,n,o){i!=n&&e.updateRangeData(1,i)})).on("changing",(function(t,e,i,n){})).on("button:click",_.bind(this.onSelectData,this,1)),this.lblRange1=t.find("#id-dlg-chart-range-lbl1"),e.inputRange2=new Common.UI.InputFieldBtn({el:$("#id-dlg-chart-range-range2"),style:"100%",btnHint:this.textSelectData,validateOnBlur:!1}).on("changed:after",(function(t,i,n,o){i!=n&&e.updateRangeData(2,i)})).on("changing",(function(t,e,i,n){})).on("button:click",_.bind(this.onSelectData,this,2)),this.lblRange2=t.find("#id-dlg-chart-range-lbl2"),e.inputRange3=new Common.UI.InputFieldBtn({el:$("#id-dlg-chart-range-range3"),style:"100%",btnHint:this.textSelectData,validateOnBlur:!1}).on("changed:after",(function(t,i,n,o){i!=n&&e.updateRangeData(3,i)})).on("changing",(function(t,e,i,n){})).on("button:click",_.bind(this.onSelectData,this,3)),this.lblRange3=t.find("#id-dlg-chart-range-lbl3"),t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return[this.inputRange1,this.inputRange2,this.inputRange3]},getDefaultFocusableComponent:function(){if(!this._alreadyRendered)return this._alreadyRendered=!0,this.inputRange1},onPrimary:function(){return this._handleInput("ok"),!1},setSettings:function(t){if(this.api=t.api,this.props=t.props,this.chartSettings=t.chartSettings,1==this.type){if(this.props.series){var e=this.props.series;if(this.inputRange1.setValue(e.asc_getName()),this.lblRange1.html(""!==this.inputRange1.getValue()?"= "+(e.asc_getNameVal()||""):this.txtChoose),this.props.isScatter){var i=e.asc_getXValuesArr();this.inputRange2.setValue(e.asc_getXValues()),this.lblRange2.html(""!==this.inputRange2.getValue()?"= "+(i?i.join("; "):""):this.txtChoose),this.inputRange3.setValue(e.asc_getYValues()),i=e.asc_getYValuesArr(),this.lblRange3.html(""!==this.inputRange3.getValue()?"= "+(i?i.join("; "):""):this.txtChoose)}else{i=e.asc_getValuesArr();this.inputRange2.setValue(e.asc_getValues()),this.lblRange2.html(""!==this.inputRange2.getValue()?"= "+(i?i.join("; "):""):this.txtChoose)}}}else{i=this.props.values;this.inputRange1.setValue(this.props.category||""),this.lblRange1.html(""!==this.inputRange1.getValue()?"= "+(i?i.join("; "):""):this.txtChoose)}},getSettings:function(){return{name:this.inputRange1.getValue(),valuesX:this.inputRange2.getValue(),valuesY:this.inputRange3.getValue()}},onSelectData:function(t,e){var i=this;if(i.api){var n=new SSE.Views.CellRangeDialog({allowBlank:!0,handler:function(n,o){"ok"==o&&(e.setValue(n.getSettings()),_.delay((function(){i.updateRangeData(t,n.getSettings())}),10))}}).on("close",(function(){i.show(),_.delay((function(){i._noApply=!0,e.focus(),i._noApply=!1}),1)})),o=i.$window.offset();i.hide(),n.show(o.left+65,o.top+77),n.setSettings({api:i.api,range:_.isEmpty(e.getValue())?"":e.getValue(),type:Asc.c_oAscSelectionDialogType.Chart,validation:function(){return!0}})}},isRangeValid:function(t,e){var i;switch(t){case 1:i=this.props.series?this.props.series.asc_IsValidName(e):this.chartSettings.isValidCatFormula(e);break;case 2:i=this.props.isScatter?this.props.series.asc_IsValidXValues(e):this.props.series.asc_IsValidValues(e);break;case 3:i=this.props.series.asc_IsValidYValues(e)}if(!0===i||i==Asc.c_oAscError.ID.No)return!0;var n=this.textInvalidRange;switch(i){case Asc.c_oAscError.ID.StockChartError:n=this.errorStockChart;break;case Asc.c_oAscError.ID.MaxDataSeriesError:n=this.errorMaxRows;break;case Asc.c_oAscError.ID.MaxDataPointsError:n=this.errorMaxPoints;break;case Asc.c_oAscError.ID.ErrorInFormula:n=this.errorInFormula;break;case Asc.c_oAscError.ID.InvalidReference:n=this.errorInvalidReference;break;case Asc.c_oAscError.ID.NoSingleRowCol:n=this.errorNoSingleRowCol;break;case Asc.c_oAscError.ID.NoValues:n=this.errorNoValues}return Common.UI.warning({msg:n,maxwidth:600}),!1},updateRangeData:function(t,e){if(this.isRangeValid(t,e))if(this.props.series){var i=this.props.series;switch(t){case 1:i.asc_setName(e),this.lblRange1.html(""!==this.inputRange1.getValue()?"= "+(i.asc_getNameVal()||""):this.txtChoose);break;case 2:if(this.isScatter){var n=i.asc_getXValuesArr();i.asc_setXValues(e),this.lblRange2.html(""!==this.inputRange2.getValue()?"= "+(n?n.join("; "):""):this.txtChoose)}else{n=i.asc_getValuesArr();i.asc_setValues(e),this.lblRange2.html(""!==this.inputRange2.getValue()?"= "+(n?n.join("; "):""):this.txtChoose)}break;case 3:n=i.asc_getYValuesArr();i.asc_setYValues(e),this.lblRange3.html(""!==this.inputRange3.getValue()?"= "+(n?n.join("; "):""):this.txtChoose)}}else{this.chartSettings.setCatFormula(e);n=this.chartSettings.getCatValues();this.lblRange1.html(""!==this.inputRange1.getValue()?"= "+(n?n.join("; "):""):this.txtChoose)}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t){if(!this.isRangeValid(1,this.inputRange1.getValue()))return;if(1==this.type&&!this.isRangeValid(2,this.inputRange2.getValue()))return;if(1==this.type&&this.isScatter&&!this.isRangeValid(3,this.inputRange3.getValue()))return}if(this.options.handler.call(this,this,t))return}this.close()},txtTitleSeries:"Edit Series",txtTitleCategory:"Axis Labels",txtSeriesName:"Series name",txtValues:"Values",txtXValues:"X Values",txtYValues:"Y Values",txtAxisLabel:"Axis label range",txtChoose:"Choose range",textSelectData:"Select data",textInvalidRange:"Invalid cells range",errorMaxRows:"The maximum number of data series per chart is 255.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",errorMaxPoints:"The maximum number of points in series per chart is 4096.",errorInFormula:"There's an error in formula you entered.",errorInvalidReference:"The reference is not valid. Reference must be to an open worksheet.",errorNoSingleRowCol:"The reference is not valid. References for titles, values, sizes, or data labels must be a single cell, row, or column.",errorNoValues:"To create a chart, the series must contain at least one value."},SSE.Views.ChartDataRangeDialog||{}))})),define("spreadsheeteditor/main/app/view/ChartSettingsDlg",["text!spreadsheeteditor/main/app/template/ChartSettingsDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/CheckBox","common/main/lib/component/InputField","spreadsheeteditor/main/app/view/CellRangeDialog","spreadsheeteditor/main/app/view/ChartDataRangeDialog","spreadsheeteditor/main/app/view/FormatSettingsDialog"],(function(t){"use strict";SSE.Views.ChartSettingsDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:327,height:535,toggleGroup:"chart-settings-dlg-group",storageName:"sse-chart-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-chart-settings-dlg-style",panelCaption:this.textType},{panelId:"id-chart-settings-dlg-layout",panelCaption:this.textLayout},{panelId:"id-chart-settings-dlg-vert",panelCaption:this.textVertAxis},{panelId:"id-chart-settings-dlg-vert-sec",panelCaption:this.textVertAxisSec},{panelId:"id-chart-settings-dlg-hor",panelCaption:this.textHorAxis},{panelId:"id-chart-settings-dlg-hor-sec",panelCaption:this.textHorAxisSec},{panelId:"id-spark-settings-dlg-style",panelCaption:this.textTypeData},{panelId:"id-spark-settings-dlg-axis",panelCaption:this.textAxisOptions},{panelId:"id-chart-settings-dlg-snap",panelCaption:this.textSnap},{panelId:"id-chart-settings-dlg-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),this.options.handler=function(t,i){if("ok"==t&&!this.isRangeValid())return!0;e.handler&&e.handler.call(this,t,i)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._state={ChartType:Asc.c_oAscChartTypeSettings.barNormal,SparkType:-1},this._noApply=!0,this._changedProps=null,this._changedImageProps=null,this.api=this.options.api,this.chartSettings=this.options.chartSettings,this.imageSettings=this.options.imageSettings,this.sparklineStyles=this.options.sparklineStyles,this.isChart=this.options.isChart,this.isDiagramMode=!!this.options.isDiagramMode,this.vertAxisProps=[],this.horAxisProps=[],this.currentAxisProps=[],this.dataRangeValid="",this.sparkDataRangeValid="",this.dataLocationRangeValid="",this.currentChartType=this._state.ChartType,this.storageName=this.isChart?"sse-chart-settings-adv-category":"sse-spark-settings-adv-category"},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.getChild();this.isDiagramMode&&(this.btnChartType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"svgicon chart-bar-normal",menu:new Common.UI.Menu({style:"width: 364px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="id-chart-dlg-menu-type" class="menu-insertchart"></div>')}]})}),this.btnChartType.on("render:after",(function(e){t.mnuChartTypePicker=new Common.UI.DataView({el:$("#id-chart-dlg-menu-type"),parentMenu:e.menu,restoreHeight:465,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getChartGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getChartData()),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')})})),this.btnChartType.render($("#chart-dlg-button-type")),this.mnuChartTypePicker.on("item:click",_.bind(this.onSelectType,this,this.btnChartType))),this.cmbChartTitle=new Common.UI.ComboBox({el:$("#chart-dlg-combo-chart-title"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscChartTitleShowSettings.none,displayValue:this.textNone},{value:Asc.c_oAscChartTitleShowSettings.overlay,displayValue:this.textOverlay},{value:Asc.c_oAscChartTitleShowSettings.noOverlay,displayValue:this.textNoOverlay}],takeFocusOnClose:!0}),this.cmbLegendPos=new Common.UI.ComboBox({el:$("#chart-dlg-combo-legend-pos"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscChartLegendShowSettings.none,displayValue:this.textNone},{value:Asc.c_oAscChartLegendShowSettings.bottom,displayValue:this.textLegendBottom},{value:Asc.c_oAscChartLegendShowSettings.top,displayValue:this.textLegendTop},{value:Asc.c_oAscChartLegendShowSettings.right,displayValue:this.textLegendRight},{value:Asc.c_oAscChartLegendShowSettings.left,displayValue:this.textLegendLeft},{value:Asc.c_oAscChartLegendShowSettings.leftOverlay,displayValue:this.textLeftOverlay},{value:Asc.c_oAscChartLegendShowSettings.rightOverlay,displayValue:this.textRightOverlay}],takeFocusOnClose:!0}),this.cmbDataLabels=new Common.UI.ComboBox({el:$("#chart-dlg-combo-data-labels"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscChartDataLabelsPos.none,displayValue:this.textNone},{value:Asc.c_oAscChartDataLabelsPos.ctr,displayValue:this.textCenter},{value:Asc.c_oAscChartDataLabelsPos.inBase,displayValue:this.textInnerBottom},{value:Asc.c_oAscChartDataLabelsPos.inEnd,displayValue:this.textInnerTop},{value:Asc.c_oAscChartDataLabelsPos.outEnd,displayValue:this.textOuterTop}],takeFocusOnClose:!0}),this.cmbDataLabels.on("selected",_.bind(t.onSelectDataLabels,this)),this.txtSeparator=new Common.UI.InputField({el:$("#chart-dlg-txt-separator"),name:"range",style:"width: 100%;",allowBlank:!0,blankError:this.txtEmpty}),this.chSeriesName=new Common.UI.CheckBox({el:$("#chart-dlg-check-series"),labelText:this.textSeriesName}),this.chCategoryName=new Common.UI.CheckBox({el:$("#chart-dlg-check-category"),labelText:this.textCategoryName}),this.chValue=new Common.UI.CheckBox({el:$("#chart-dlg-check-value"),labelText:this.textValue}),this.cmbLines=new Common.UI.ComboBox({el:$("#chart-dlg-combo-lines"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textNone},{value:1,displayValue:this.textStraight},{value:2,displayValue:this.textSmooth}],takeFocusOnClose:!0}).on("selected",_.bind((function(t,e){this.chartSettings&&(this.chartSettings.putLine(0!==e.value),e.value>0&&this.chartSettings.putSmooth(2==e.value))}),this)),this.chMarkers=new Common.UI.CheckBox({el:$("#chart-dlg-check-markers"),labelText:this.textMarkers}).on("change",_.bind((function(t,e){this.chartSettings&&this.chartSettings.putShowMarker("checked"==e)}),this)),this.lblLines=$("#chart-dlg-label-lines"),this.cmbMinType=[],this.spnMinValue=[],this.cmbMaxType=[],this.spnMaxValue=[],this.cmbVCrossType=[],this.spnVAxisCrosses=[],this.cmbUnits=[],this.chVReverse=[],this.cmbVMajorType=[],this.cmbVMinorType=[],this.cmbVLabelPos=[],this.cmbVertTitle=[],this.cmbVertGrid=[],this.chVertHide=[],this.btnVFormat=[],this.chVLogScale=[],this.spnBase=[],this._arrVertTitle=[{value:Asc.c_oAscChartVertAxisLabelShowSettings.none,displayValue:t.textNone},{value:Asc.c_oAscChartVertAxisLabelShowSettings.rotated,displayValue:t.textRotated},{value:Asc.c_oAscChartVertAxisLabelShowSettings.horizontal,displayValue:t.textHorizontal}];var e=function(e){t.chVertHide[e]=new Common.UI.CheckBox({el:$("#chart-dlg-chk-vert-hide-"+e),labelText:t.textHideAxis}).on("change",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putShow("checked"!==n)}),t)),t.cmbVertTitle[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-vert-title-"+e),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:t._arrVertTitle,takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putLabel(n.value)}),t)),t.cmbVertGrid[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-vert-grid-"+e),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscGridLinesSettings.none,displayValue:t.textNone},{value:Asc.c_oAscGridLinesSettings.major,displayValue:t.textMajor},{value:Asc.c_oAscGridLinesSettings.minor,displayValue:t.textMinor},{value:Asc.c_oAscGridLinesSettings.majorMinor,displayValue:t.textMajorMinor}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putGridlines(n.value)}),t)),t.cmbMinType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-mintype-"+e),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:t.textAuto,value:Asc.c_oAscValAxisRule.auto},{displayValue:t.textFixed,value:Asc.c_oAscValAxisRule.fixed}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&(t.currentAxisProps[e].putMinValRule(n.value),n.value==Asc.c_oAscValAxisRule.auto&&t.spnMinValue[e].setValue(t._originalAxisVValues[e].minAuto,!0))}),t)),t.spnMinValue[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-min-value-"+e),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""}).on("change",_.bind((function(i,n,o){t.cmbMinType[e].suspendEvents(),t.cmbMinType[e].setValue(Asc.c_oAscValAxisRule.fixed),t.cmbMinType[e].resumeEvents(),t.currentAxisProps[e]&&(t.currentAxisProps[e].putMinValRule(Asc.c_oAscValAxisRule.fixed),t.currentAxisProps[e].putMinVal(i.getNumberValue()))}),t)),t.cmbMaxType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-maxtype-"+e),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:t.textAuto,value:Asc.c_oAscValAxisRule.auto},{displayValue:t.textFixed,value:Asc.c_oAscValAxisRule.fixed}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&(t.currentAxisProps[e].putMaxValRule(n.value),n.value==Asc.c_oAscValAxisRule.auto&&t.spnMaxValue[e].setValue(t._originalAxisVValues[e].maxAuto,!0))}),t)),t.spnMaxValue[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-max-value-"+e),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""}).on("change",_.bind((function(i,n,o){t.cmbMaxType[e].suspendEvents(),t.cmbMaxType[e].setValue(Asc.c_oAscValAxisRule.fixed),t.cmbMaxType[e].resumeEvents(),t.currentAxisProps[e]&&(t.currentAxisProps[e].putMaxValRule(Asc.c_oAscValAxisRule.fixed),t.currentAxisProps[e].putMaxVal(i.getNumberValue()))}),t)),t.cmbVCrossType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-crosstype-"+e),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:t.textAuto,value:Asc.c_oAscCrossesRule.auto},{displayValue:t.textValue,value:Asc.c_oAscCrossesRule.value},{displayValue:t.textMinValue,value:Asc.c_oAscCrossesRule.minValue},{displayValue:t.textMaxValue,value:Asc.c_oAscCrossesRule.maxValue}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){if(t.currentAxisProps[e])switch(t.currentAxisProps[e].putCrossesRule(n.value),n.value){case Asc.c_oAscCrossesRule.minValue:t.spnVAxisCrosses[e].setValue(t.spnMinValue[e].getNumberValue(),!0);break;case Asc.c_oAscCrossesRule.maxValue:t.spnVAxisCrosses[e].setValue(t.spnMaxValue[e].getNumberValue(),!0);break;case Asc.c_oAscCrossesRule.auto:t.spnVAxisCrosses[e].setValue(t._originalAxisVValues[e].crossesAuto,!0)}}),t)),t.spnVAxisCrosses[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-v-axis-crosses-"+e),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""}).on("change",_.bind((function(i,n,o){t.cmbVCrossType[e].suspendEvents(),t.cmbVCrossType[e].setValue(Asc.c_oAscCrossesRule.value),t.cmbVCrossType[e].resumeEvents(),t.currentAxisProps[e]&&(t.currentAxisProps[e].putCrossesRule(Asc.c_oAscCrossesRule.value),t.currentAxisProps[e].putCrosses(i.getNumberValue()))}),t)),t.cmbUnits[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-units-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscValAxUnits.none},{displayValue:t.textHundreds,value:Asc.c_oAscValAxUnits.HUNDREDS},{displayValue:t.textThousands,value:Asc.c_oAscValAxUnits.THOUSANDS},{displayValue:t.textTenThousands,value:Asc.c_oAscValAxUnits.TEN_THOUSANDS},{displayValue:t.textHundredThousands,value:Asc.c_oAscValAxUnits.HUNDRED_THOUSANDS},{displayValue:t.textMillions,value:Asc.c_oAscValAxUnits.MILLIONS},{displayValue:t.textTenMillions,value:Asc.c_oAscValAxUnits.TEN_MILLIONS},{displayValue:t.textHundredMil,value:Asc.c_oAscValAxUnits.HUNDRED_MILLIONS},{displayValue:t.textBillions,value:Asc.c_oAscValAxUnits.BILLIONS},{displayValue:t.textTrillions,value:Asc.c_oAscValAxUnits.TRILLIONS}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putDispUnitsRule(n.value)}),t)),t.chVReverse[e]=new Common.UI.CheckBox({el:$("#chart-dlg-check-v-reverse-"+e),labelText:t.textReverse}).on("change",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putInvertValOrder("checked"==n)}),t)),t.cmbVMajorType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-major-type-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscTickMark.TICK_MARK_NONE},{displayValue:t.textCross,value:Asc.c_oAscTickMark.TICK_MARK_CROSS},{displayValue:t.textIn,value:Asc.c_oAscTickMark.TICK_MARK_IN},{displayValue:t.textOut,value:Asc.c_oAscTickMark.TICK_MARK_OUT}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putMajorTickMark(n.value)}),t)),t.cmbVMinorType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-minor-type-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscTickMark.TICK_MARK_NONE},{displayValue:t.textCross,value:Asc.c_oAscTickMark.TICK_MARK_CROSS},{displayValue:t.textIn,value:Asc.c_oAscTickMark.TICK_MARK_IN},{displayValue:t.textOut,value:Asc.c_oAscTickMark.TICK_MARK_OUT}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putMinorTickMark(n.value)}),t)),t.cmbVLabelPos[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-label-pos-"+e),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_NONE},{displayValue:t.textLow,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_LOW},{displayValue:t.textHigh,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_HIGH},{displayValue:t.textNextToAxis,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_NEXT_TO}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putTickLabelsPos(n.value)}),t)),t.btnVFormat[e]=new Common.UI.Button({el:$("#chart-dlg-btn-v-format-"+e)}).on("click",_.bind(t.openFormat,t,e)),t.chVLogScale[e]=new Common.UI.CheckBox({el:$("#chart-dlg-check-v-logscale-"+e),labelText:t.textLogScale}).on("change",_.bind((function(i,n){t.currentAxisProps[e]&&(t.currentAxisProps[e].putLogScale("checked"==n),"checked"==n&&t.currentAxisProps[e].putLogBase(t.spnBase[e].getNumberValue())),t.spnBase[e].setDisabled("checked"!==n)}),t)),t.spnBase[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-base-"+e),maxValue:1e3,minValue:2,step:1,defaultUnit:"",value:10}).on("change",_.bind((function(i,n,o){t.currentAxisProps[e]&&t.currentAxisProps[e].putLogBase(i.getNumberValue())}),t))};e(0),e(1),this.cmbHCrossType=[],this.cmbAxisPos=[],this.spnHAxisCrosses=[],this.chHReverse=[],this.cmbHMajorType=[],this.cmbHMinorType=[],this.spnMarksInterval=[],this.cmbHLabelPos=[],this.spnLabelDist=[],this.cmbLabelInterval=[],this.spnLabelInterval=[],this.cmbHorTitle=[],this.cmbHorGrid=[],this.chHorHide=[],this.btnHFormat=[],this._arrHorTitle=[{value:Asc.c_oAscChartHorAxisLabelShowSettings.none,displayValue:t.textNone},{value:Asc.c_oAscChartHorAxisLabelShowSettings.noOverlay,displayValue:t.textNoOverlay}];var i=function(e){t.chHorHide[e]=new Common.UI.CheckBox({el:$("#chart-dlg-chk-hor-hide-"+e),labelText:t.textHideAxis}).on("change",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putShow("checked"!==n)}),t)),t.cmbHorTitle[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-hor-title-"+e),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:t._arrHorTitle,takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putLabel(n.value)}),t)),t.cmbHorGrid[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-hor-grid-"+e),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscGridLinesSettings.none,displayValue:t.textNone},{value:Asc.c_oAscGridLinesSettings.major,displayValue:t.textMajor},{value:Asc.c_oAscGridLinesSettings.minor,displayValue:t.textMinor},{value:Asc.c_oAscGridLinesSettings.majorMinor,displayValue:t.textMajorMinor}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putGridlines(n.value)}),t)),t.cmbHCrossType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-crosstype-"+e),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:t.textAuto,value:Asc.c_oAscCrossesRule.auto},{displayValue:t.textValue,value:Asc.c_oAscCrossesRule.value},{displayValue:t.textMinValue,value:Asc.c_oAscCrossesRule.minValue},{displayValue:t.textMaxValue,value:Asc.c_oAscCrossesRule.maxValue}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&(t.currentAxisProps[e].putCrossesRule(n.value),n.value==Asc.c_oAscCrossesRule.auto?t.spnHAxisCrosses[e].setValue(t._originalAxisHValues[e].crossesAuto,!0):n.value==Asc.c_oAscCrossesRule.minValue?t.spnHAxisCrosses[e].setValue(t._originalAxisHValues[e].minAuto,!0):n.value==Asc.c_oAscCrossesRule.maxValue&&t.spnHAxisCrosses[e].setValue(t._originalAxisHValues[e].maxAuto,!0))}),t)),t.spnHAxisCrosses[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-h-axis-crosses-"+e),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""}).on("change",_.bind((function(i,n,o){t.cmbHCrossType[e].suspendEvents(),t.cmbHCrossType[e].setValue(Asc.c_oAscCrossesRule.value),t.cmbHCrossType[e].resumeEvents(),t.currentAxisProps[e]&&(t.currentAxisProps[e].putCrossesRule(Asc.c_oAscCrossesRule.value),t.currentAxisProps[e].putCrosses(i.getNumberValue()))}),t)),t.cmbAxisPos[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-axis-pos-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textOnTickMarks,value:Asc.c_oAscLabelsPosition.byDivisions},{displayValue:t.textBetweenTickMarks,value:Asc.c_oAscLabelsPosition.betweenDivisions}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putLabelsPosition(n.value)}),t)),t.chHReverse[e]=new Common.UI.CheckBox({el:$("#chart-dlg-check-h-reverse-"+e),labelText:t.textReverse}).on("change",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putInvertCatOrder("checked"==n)}),t)),t.cmbHMajorType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-major-type-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscTickMark.TICK_MARK_NONE},{displayValue:t.textCross,value:Asc.c_oAscTickMark.TICK_MARK_CROSS},{displayValue:t.textIn,value:Asc.c_oAscTickMark.TICK_MARK_IN},{displayValue:t.textOut,value:Asc.c_oAscTickMark.TICK_MARK_OUT}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putMajorTickMark(n.value)}),t)),t.cmbHMinorType[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-minor-type-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscTickMark.TICK_MARK_NONE},{displayValue:t.textCross,value:Asc.c_oAscTickMark.TICK_MARK_CROSS},{displayValue:t.textIn,value:Asc.c_oAscTickMark.TICK_MARK_IN},{displayValue:t.textOut,value:Asc.c_oAscTickMark.TICK_MARK_OUT}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putMinorTickMark(n.value)}),t)),t.spnMarksInterval[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-marks-interval-"+e),width:140,maxValue:1e6,minValue:1,step:1,defaultUnit:"",value:""}).on("change",_.bind((function(i,n,o){t.currentAxisProps[e]&&t.currentAxisProps[e].putIntervalBetweenTick(i.getNumberValue())}),t)),t.cmbHLabelPos[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-label-pos-"+e),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:t.textNone,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_NONE},{displayValue:t.textLow,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_LOW},{displayValue:t.textHigh,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_HIGH},{displayValue:t.textNextToAxis,value:Asc.c_oAscTickLabelsPos.TICK_LABEL_POSITION_NEXT_TO}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&t.currentAxisProps[e].putTickLabelsPos(n.value)}),t)),t.spnLabelDist[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-label-dist-"+e),width:140,maxValue:1e3,minValue:0,step:1,defaultUnit:"",value:""}).on("change",_.bind((function(i,n,o){t.currentAxisProps[e]&&t.currentAxisProps[e].putLabelsAxisDistance(i.getNumberValue())}),t)),t.spnLabelInterval[e]=new Common.UI.MetricSpinner({el:$("#chart-dlg-input-label-int-"+e),width:60,maxValue:1e6,minValue:1,step:1,defaultUnit:"",value:""}).on("change",_.bind((function(i,n,o){t.cmbLabelInterval[e].suspendEvents(),t.cmbLabelInterval[e].setValue(Asc.c_oAscBetweenLabelsRule.manual),t.cmbLabelInterval[e].resumeEvents(),t.currentAxisProps[e]&&(t.currentAxisProps[e].putIntervalBetweenLabelsRule(Asc.c_oAscBetweenLabelsRule.manual),t.currentAxisProps[e].putIntervalBetweenLabels(i.getNumberValue()))}),t)),t.cmbLabelInterval[e]=new Common.UI.ComboBox({el:$("#chart-dlg-combo-label-int-"+e),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:t.textAuto,value:Asc.c_oAscBetweenLabelsRule.auto},{displayValue:t.textManual,value:Asc.c_oAscBetweenLabelsRule.manual}],takeFocusOnClose:!0}).on("selected",_.bind((function(i,n){t.currentAxisProps[e]&&(t.currentAxisProps[e].putIntervalBetweenLabelsRule(n.value),n.value==Asc.c_oAscBetweenLabelsRule.auto&&t.spnLabelInterval[e].setValue(1,!0))}),t)),t.btnHFormat[e]=new Common.UI.Button({el:$("#chart-dlg-btn-h-format-"+e)}).on("click",_.bind(t.openFormat,t,e))};i(0),i(1),this.btnSparkType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"svgicon chart-spark-column",menu:new Common.UI.Menu({style:"width: 167px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="id-spark-dlg-menu-type" class="menu-insertchart"></div>')}]})}),this.btnSparkType.on("render:after",(function(e){t.mnuSparkTypePicker=new Common.UI.DataView({el:$("#id-spark-dlg-menu-type"),parentMenu:e.menu,restoreHeight:120,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getSparkGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getSparkData()),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')})})),this.btnSparkType.render($("#spark-dlg-button-type")),this.mnuSparkTypePicker.on("item:click",_.bind(this.onSelectSparkType,this,this.btnSparkType)),this.cmbSparkStyle=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:272,enableKeyEvents:!0,cls:"combo-spark-style",minWidth:190}),this.cmbSparkStyle.render($("#spark-dlg-combo-style")),this.cmbSparkStyle.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbSparkStyle.on("click",_.bind(this.onSelectSparkStyle,this)),this.cmbSparkStyle.openButton.menu.on("show:after",(function(){t.cmbSparkStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this._arrEmptyCells=[{value:Asc.c_oAscEDispBlanksAs.Gap,displayValue:this.textGaps},{value:Asc.c_oAscEDispBlanksAs.Zero,displayValue:this.textZero},{value:Asc.c_oAscEDispBlanksAs.Span,displayValue:this.textEmptyLine}],this.cmbEmptyCells=new Common.UI.ComboBox({el:$("#spark-dlg-combo-empty"),menuStyle:"min-width: 220px;",editable:!1,cls:"input-group-nr",takeFocusOnClose:!0}),this.cmbEmptyCells.on("selected",_.bind((function(t,e){this._changedProps&&this._changedProps.asc_setDisplayEmpty(e.value)}),this)),this.chShowEmpty=new Common.UI.CheckBox({el:$("#spark-dlg-check-show-data"),labelText:this.textShowData}),this.chShowEmpty.on("change",_.bind((function(t,e,i,n){this._changedProps&&this._changedProps.asc_setDisplayHidden("checked"==t.getValue())}),this)),this.chShowAxis=new Common.UI.CheckBox({el:$("#spark-dlg-check-show"),labelText:this.textShowSparkAxis}),this.chShowAxis.on("change",_.bind((function(t,e,i,n){this._changedProps&&this._changedProps.asc_setDisplayXAxis("checked"==t.getValue())}),this)),this.chReverse=new Common.UI.CheckBox({el:$("#spark-dlg-check-reverse"),labelText:this.textReverseOrder}),this.chReverse.on("change",_.bind((function(t,e,i,n){this._changedProps&&this._changedProps.asc_setRightToLeft("checked"==t.getValue())}),this)),this.cmbSparkMinType=new Common.UI.ComboBox({el:$("#spark-dlg-combo-mintype"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:this.textAutoEach,value:Asc.c_oAscSparklineAxisMinMax.Individual},{displayValue:this.textSameAll,value:Asc.c_oAscSparklineAxisMinMax.Group},{displayValue:this.textFixed,value:Asc.c_oAscSparklineAxisMinMax.Custom}],takeFocusOnClose:!0}).on("selected",_.bind((function(t,e){this.spnSparkMinValue.setDisabled(e.value!==Asc.c_oAscSparklineAxisMinMax.Custom),this._changedProps&&this._changedProps.asc_setMinAxisType(e.value),e.value==Asc.c_oAscSparklineAxisMinMax.Custom&&_.isEmpty(this.spnSparkMinValue.getValue())&&this.spnSparkMinValue.setValue(0)}),this)),this.spnSparkMinValue=new Common.UI.MetricSpinner({el:$("#spark-dlg-input-min-value"),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""}).on("change",_.bind((function(t,e,i){this._changedProps&&this._changedProps.asc_setManualMin(t.getNumberValue())}),this)),this.cmbSparkMaxType=new Common.UI.ComboBox({el:$("#spark-dlg-combo-maxtype"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:this.textAutoEach,value:Asc.c_oAscSparklineAxisMinMax.Individual},{displayValue:this.textSameAll,value:Asc.c_oAscSparklineAxisMinMax.Group},{displayValue:this.textFixed,value:Asc.c_oAscSparklineAxisMinMax.Custom}],takeFocusOnClose:!0}).on("selected",_.bind((function(t,e){this.spnSparkMaxValue.setDisabled(e.value!==Asc.c_oAscSparklineAxisMinMax.Custom),this._changedProps&&this._changedProps.asc_setMaxAxisType(e.value),e.value==Asc.c_oAscSparklineAxisMinMax.Custom&&_.isEmpty(this.spnSparkMaxValue.getValue())&&this.spnSparkMaxValue.setValue(0)}),this)),this.spnSparkMaxValue=new Common.UI.MetricSpinner({el:$("#spark-dlg-input-max-value"),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""}).on("change",_.bind((function(t,e,i){this._changedProps&&this._changedProps.asc_setManualMax(t.getNumberValue())}),this)),this.radioTwoCell=new Common.UI.RadioBox({el:$("#chart-dlg-radio-twocell"),name:"asc-radio-snap",labelText:this.textTwoCell,value:AscCommon.c_oAscCellAnchorType.cellanchorTwoCell}),this.radioTwoCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioOneCell=new Common.UI.RadioBox({el:$("#chart-dlg-radio-onecell"),name:"asc-radio-snap",labelText:this.textOneCell,value:AscCommon.c_oAscCellAnchorType.cellanchorOneCell}),this.radioOneCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioAbsolute=new Common.UI.RadioBox({el:$("#chart-dlg-radio-absolute"),name:"asc-radio-snap",labelText:this.textAbsolute,value:AscCommon.c_oAscCellAnchorType.cellanchorAbsolute}),this.radioAbsolute.on("change",_.bind(this.onRadioSnapChange,this)),this.inputAltTitle=new Common.UI.InputField({el:$("#chart-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",(function(){t.isAltTitleChanged=!0})),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown((function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0})),this.afterRender()},getFocusedComponents:function(){return[this.cmbChartTitle,this.cmbLegendPos,this.cmbDataLabels,this.chSeriesName,this.chCategoryName,this.chValue,this.txtSeparator,this.cmbVertTitle[0],this.cmbVertGrid[0],this.chVertHide[0],this.cmbMinType[0],this.spnMinValue[0],this.cmbMaxType[0],this.spnMaxValue[0],this.cmbVCrossType[0],this.spnVAxisCrosses[0],this.cmbUnits[0],this.chVReverse[0],this.chVLogScale[0],this.spnBase[0],this.cmbVMajorType[0],this.cmbVMinorType[0],this.cmbVLabelPos[0],this.cmbVertTitle[1],this.cmbVertGrid[1],this.chVertHide[1],this.cmbMinType[1],this.spnMinValue[1],this.cmbMaxType[1],this.spnMaxValue[1],this.cmbVCrossType[1],this.spnVAxisCrosses[1],this.cmbUnits[1],this.chVReverse[1],this.chVLogScale[1],this.spnBase[1],this.cmbVMajorType[1],this.cmbVMinorType[1],this.cmbVLabelPos[1],this.chHorHide[0],this.cmbHorTitle[0],this.cmbHorGrid[0],this.cmbHCrossType[0],this.spnHAxisCrosses[0],this.cmbAxisPos[0],this.chHReverse[0],this.cmbHMajorType[0],this.cmbHMinorType[0],this.spnMarksInterval[0],this.cmbHLabelPos[0],this.spnLabelDist[0],this.cmbLabelInterval[0],this.spnLabelInterval[0],this.chHorHide[1],this.cmbHorTitle[1],this.cmbHorGrid[1],this.cmbHCrossType[1],this.spnHAxisCrosses[1],this.cmbAxisPos[1],this.chHReverse[1],this.cmbHMajorType[1],this.cmbHMinorType[1],this.spnMarksInterval[1],this.cmbHLabelPos[1],this.spnLabelDist[1],this.cmbLabelInterval[1],this.spnLabelInterval[1],this.cmbEmptyCells,this.chShowEmpty,this.chShowAxis,this.chReverse,this.cmbSparkMinType,this.spnSparkMinValue,this.cmbSparkMaxType,this.spnSparkMaxValue,this.radioTwoCell,this.radioOneCell,this.radioAbsolute,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 1:i.cmbChartTitle.focus();break;case 2:case 3:i.onVCategoryClick(e-2),i.cmbMinType[e-2].focus();break;case 4:case 5:i.onHCategoryClick(e-4),i.cmbHCrossType[e-4].focus();break;case 6:i.cmbEmptyCells.focus();break;case 7:i.chShowAxis.focus();break;case 8:i.radioTwoCell.focus();break;case 9:i.inputAltTitle.focus()}}),10)},afterRender:function(){if(this._setDefaults(this.chartSettings),this.setTitle(this.isChart?this.textTitle:this.textTitleSparkline),this.btnsCategory[0].setVisible(this.isDiagramMode),this.isChart?(this.btnsCategory[6].setVisible(!1),this.btnsCategory[7].setVisible(!1)):(this.btnsCategory[1].setVisible(!1),this.btnsCategory[2].setVisible(!1),this.btnsCategory[3].setVisible(!1),this.btnsCategory[4].setVisible(!1),this.btnsCategory[5].setVisible(!1),this.btnsCategory[8].setVisible(!1),this.btnsCategory[9].setVisible(!1)),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0),2==(t=this.getActiveCategory())||3==t?this.onVCategoryClick(t-2):4!=t&&5!=t||this.onHCategoryClick(t-4)}},onSelectType:function(t,e,i,n){if(!this._noApply){var o={};if(_.isFunction(n.toJSON)){if(!n.get("selected"))return;o=n.toJSON()}else o=n;this.btnChartType.setIconCls("svgicon chart-"+o.iconCls),this.chartSettings.changeType(o.type),this.updateAxisProps(o.type,!0),this.vertAxisProps=this.chartSettings.getVertAxesProps(),this.horAxisProps=this.chartSettings.getHorAxesProps(),this.updateDataLabels(o.type,this.cmbDataLabels.getValue()),this.currentChartType=o.type}},updateAxisProps:function(t,e){var i=t==Asc.c_oAscChartTypeSettings.lineNormal||t==Asc.c_oAscChartTypeSettings.lineStacked||t==Asc.c_oAscChartTypeSettings.lineStackedPer||t==Asc.c_oAscChartTypeSettings.lineNormalMarker||t==Asc.c_oAscChartTypeSettings.lineStackedMarker||t==Asc.c_oAscChartTypeSettings.lineStackedPerMarker||t==Asc.c_oAscChartTypeSettings.scatter||t==Asc.c_oAscChartTypeSettings.scatterSmoothMarker||t==Asc.c_oAscChartTypeSettings.scatterSmooth||t==Asc.c_oAscChartTypeSettings.scatterLineMarker||t==Asc.c_oAscChartTypeSettings.scatterLine;this.chMarkers.setVisible(i),this.cmbLines.setVisible(i),this.lblLines.toggleClass("hidden",!i),i&&(this.chMarkers.setValue(this.chartSettings.getShowMarker(),!0),this.cmbLines.setValue(this.chartSettings.getLine()?this.chartSettings.getSmooth()?2:1:0)),i=t==Asc.c_oAscChartTypeSettings.pie||t==Asc.c_oAscChartTypeSettings.doughnut||t==Asc.c_oAscChartTypeSettings.pie3d,this.btnsCategory[2].setDisabled(i),this.btnsCategory[3].setDisabled(i),this.btnsCategory[4].setDisabled(i),this.btnsCategory[5].setDisabled(i),this.btnsCategory[2].setVisible(this.vertAxisProps.length>0),this.btnsCategory[3].setVisible(this.vertAxisProps.length>1),this.btnsCategory[4].setVisible(this.horAxisProps.length>0),this.btnsCategory[5].setVisible(this.horAxisProps.length>1),i=t==Asc.c_oAscChartTypeSettings.barNormal3d||t==Asc.c_oAscChartTypeSettings.barStacked3d||t==Asc.c_oAscChartTypeSettings.barStackedPer3d||t==Asc.c_oAscChartTypeSettings.hBarNormal3d||t==Asc.c_oAscChartTypeSettings.hBarStacked3d||t==Asc.c_oAscChartTypeSettings.hBarStackedPer3d||t==Asc.c_oAscChartTypeSettings.barNormal3dPerspective,this.cmbAxisPos[0].setDisabled(i),this.cmbAxisPos[1].setDisabled(i),i=t==Asc.c_oAscChartTypeSettings.hBarNormal||t==Asc.c_oAscChartTypeSettings.hBarStacked||t==Asc.c_oAscChartTypeSettings.hBarStackedPer||t==Asc.c_oAscChartTypeSettings.hBarNormal3d||t==Asc.c_oAscChartTypeSettings.hBarStacked3d||t==Asc.c_oAscChartTypeSettings.hBarStackedPer3d,this.btnsCategory[2].options.contentTarget=i?"id-chart-settings-dlg-hor":"id-chart-settings-dlg-vert",this.btnsCategory[4].options.contentTarget=i||t==Asc.c_oAscChartTypeSettings.scatter||t==Asc.c_oAscChartTypeSettings.scatterSmoothMarker||t==Asc.c_oAscChartTypeSettings.scatterSmooth||t==Asc.c_oAscChartTypeSettings.scatterLineMarker||t==Asc.c_oAscChartTypeSettings.scatterLine?"id-chart-settings-dlg-vert":"id-chart-settings-dlg-hor"},updateDataLabels:function(t,e){if(t!==this.currentChartType){var i=[{value:Asc.c_oAscChartDataLabelsPos.none,displayValue:this.textNone},{value:Asc.c_oAscChartDataLabelsPos.ctr,displayValue:this.textCenter}];t==Asc.c_oAscChartTypeSettings.barNormal||t==Asc.c_oAscChartTypeSettings.hBarNormal?i.push({value:Asc.c_oAscChartDataLabelsPos.inBase,displayValue:this.textInnerBottom},{value:Asc.c_oAscChartDataLabelsPos.inEnd,displayValue:this.textInnerTop},{value:Asc.c_oAscChartDataLabelsPos.outEnd,displayValue:this.textOuterTop}):t==Asc.c_oAscChartTypeSettings.barStacked||t==Asc.c_oAscChartTypeSettings.barStackedPer||t==Asc.c_oAscChartTypeSettings.hBarStacked||t==Asc.c_oAscChartTypeSettings.hBarStackedPer?i.push({value:Asc.c_oAscChartDataLabelsPos.inBase,displayValue:this.textInnerBottom},{value:Asc.c_oAscChartDataLabelsPos.inEnd,displayValue:this.textInnerTop}):t==Asc.c_oAscChartTypeSettings.lineNormal||t==Asc.c_oAscChartTypeSettings.lineStacked||t==Asc.c_oAscChartTypeSettings.lineStackedPer||t==Asc.c_oAscChartTypeSettings.lineNormalMarker||t==Asc.c_oAscChartTypeSettings.lineStackedMarker||t==Asc.c_oAscChartTypeSettings.lineStackedPerMarker||t==Asc.c_oAscChartTypeSettings.stock||t==Asc.c_oAscChartTypeSettings.scatter||t==Asc.c_oAscChartTypeSettings.scatterSmoothMarker||t==Asc.c_oAscChartTypeSettings.scatterSmooth||t==Asc.c_oAscChartTypeSettings.scatterLineMarker||t==Asc.c_oAscChartTypeSettings.scatterLine?i.push({value:Asc.c_oAscChartDataLabelsPos.l,displayValue:this.textLeft},{value:Asc.c_oAscChartDataLabelsPos.r,displayValue:this.textRight},{value:Asc.c_oAscChartDataLabelsPos.t,displayValue:this.textTop},{value:Asc.c_oAscChartDataLabelsPos.b,displayValue:this.textBottom}):t!=Asc.c_oAscChartTypeSettings.pie&&t!=Asc.c_oAscChartTypeSettings.pie3d||i.push({value:Asc.c_oAscChartDataLabelsPos.bestFit,displayValue:this.textFit},{value:Asc.c_oAscChartDataLabelsPos.inEnd,displayValue:this.textInnerTop},{value:Asc.c_oAscChartDataLabelsPos.outEnd,displayValue:this.textOuterTop}),this.cmbDataLabels.setData(i)}void 0!==e?this.cmbDataLabels.store.findWhere({value:e})||(e=Asc.c_oAscChartDataLabelsPos.ctr):e=Asc.c_oAscChartDataLabelsPos.none;this.cmbDataLabels.setValue(e),this.onSelectDataLabels(this.cmbDataLabels,{value:e})},onVCategoryClick:function(t){this.vertAxisProps[t].getAxisType()==Asc.c_oAscAxisType.val?this.fillVProps(this.vertAxisProps[t],t):this.fillHProps(this.vertAxisProps[t],t,!0)},onHCategoryClick:function(t){this.horAxisProps[t].getAxisType()==Asc.c_oAscAxisType.val?this.fillVProps(this.horAxisProps[t],t,!0):this.fillHProps(this.horAxisProps[t],t)},fillVProps:function(t,e,i){if(t.getAxisType()===Asc.c_oAscAxisType.val){null==this._originalAxisVValues&&(this._originalAxisVValues=[]),null==this._originalAxisVValues[e]&&(this._originalAxisVValues[e]={minAuto:null==t.getMinVal()?0:t.getMinVal(),maxAuto:null==t.getMaxVal()?10:t.getMaxVal(),crossesAuto:null==t.getCrosses()?0:t.getCrosses()}),this.chVertHide[e].setValue(!t.getShow()),this.cmbVertGrid[e].setValue(t.getGridlines()),this.cmbVertTitle[e].setData(i?this._arrHorTitle:this._arrVertTitle),this.cmbVertTitle[e].setValue(t.getLabel()),this.cmbMinType[e].setValue(t.getMinValRule());var n=t.getMinValRule()==Asc.c_oAscValAxisRule.auto?this._originalAxisVValues[e].minAuto:t.getMinVal();switch(this.spnMinValue[e].setValue(null==n?"":n,!0),this.cmbMaxType[e].setValue(t.getMaxValRule()),n=t.getMaxValRule()==Asc.c_oAscValAxisRule.auto?this._originalAxisVValues[e].maxAuto:t.getMaxVal(),this.spnMaxValue[e].setValue(null==n?"":n,!0),n=t.getCrossesRule(),this.cmbVCrossType[e].setValue(n),n){case Asc.c_oAscCrossesRule.minValue:n=this.spnMinValue[e].getNumberValue();break;case Asc.c_oAscCrossesRule.maxValue:n=this.spnMaxValue[e].getNumberValue();break;case Asc.c_oAscCrossesRule.auto:n=this._originalAxisVValues[e].crossesAuto;break;default:n=t.getCrosses()}this.spnVAxisCrosses[e].setValue(null==n?"":n,!0),this.cmbUnits[e].setValue(t.getDispUnitsRule()),this.chVReverse[e].setValue(t.getInvertValOrder(),!0),this.cmbVMajorType[e].setValue(t.getMajorTickMark()),this.cmbVMinorType[e].setValue(t.getMinorTickMark()),this.cmbVLabelPos[e].setValue(t.getTickLabelsPos()),n=t.getLogScale(),this.chVLogScale[e].setValue(!!n,!0),this.spnBase[e].setDisabled(!n),n&&this.spnBase[e].setValue(t.getLogBase(),!0),this.currentAxisProps[e]=t}},fillHProps:function(t,e,i){if(t.getAxisType()===Asc.c_oAscAxisType.cat){null==this._originalAxisHValues&&(this._originalAxisHValues=[]),null==this._originalAxisHValues[e]&&(this._originalAxisHValues[e]={minAuto:null==t.getCrossMinVal()?0:t.getCrossMinVal(),maxAuto:null==t.getCrossMaxVal()?10:t.getCrossMaxVal(),crossesAuto:null==t.getCrosses()?0:t.getCrosses()}),this.chHorHide[e].setValue(!t.getShow()),this.cmbHorGrid[e].setValue(t.getGridlines()),this.cmbHorTitle[e].setData(i?this._arrVertTitle:this._arrHorTitle),this.cmbHorTitle[e].setValue(t.getLabel());var n=t.getCrossesRule();switch(this.cmbHCrossType[e].setValue(n),n){case Asc.c_oAscCrossesRule.minValue:n=this._originalAxisHValues[e].minAuto;break;case Asc.c_oAscCrossesRule.maxValue:n=this._originalAxisHValues[e].maxAuto;break;case Asc.c_oAscCrossesRule.auto:n=this._originalAxisHValues[e].crossesAuto;break;default:n=t.getCrosses()}this.spnHAxisCrosses[e].setValue(null==n?"":n,!0),this.cmbAxisPos[e].setValue(t.getLabelsPosition()),this.chHReverse[e].setValue(t.getInvertCatOrder(),!0),this.cmbHMajorType[e].setValue(t.getMajorTickMark()),this.cmbHMinorType[e].setValue(t.getMinorTickMark()),this.spnMarksInterval[e].setValue(t.getIntervalBetweenTick(),!0),this.cmbHLabelPos[e].setValue(t.getTickLabelsPos()),this.spnLabelDist[e].setValue(t.getLabelsAxisDistance(),!0),n=t.getIntervalBetweenLabelsRule(),this.cmbLabelInterval[e].setValue(n),this.spnLabelInterval[e].setValue(n===Asc.c_oAscBetweenLabelsRule.manual?t.getIntervalBetweenLabels():1,!0),this.currentAxisProps[e]=t}},updateSparkStyles:function(t){if(t&&t.length>1){var e=this.cmbSparkStyle.menuPicker.store;if(e.length==t.length-1)for(var i=e.models,n=0;n<t.length-1;n++)i[n].set("imageUrl",t[n]);else{var o=[],s=t[t.length-1];for(n=0;n<t.length-1;n++)o.push({imageUrl:t[n],data:n});e.reset(o,{silent:!1}),this.cmbSparkStyle.fillComboView(e.at(s<0?0:s),s>-1)}}},onSelectSparkType:function(t,e,i,n){if(!this._noApply){var o={};if(_.isFunction(n.toJSON)){if(!n.get("selected"))return;o=n.toJSON()}else o=n;this.btnSparkType.setIconCls("svgicon chart-"+o.iconCls),this._changedProps&&this._changedProps.asc_setType(o.type),this._state.SparkType=o.type;var s=!1,a=this.cmbEmptyCells.getValue();o.type!==Asc.c_oAscSparklineType.Line&&this._arrEmptyCells.length>2?(this._arrEmptyCells.pop(),s=!0):o.type==Asc.c_oAscSparklineType.Line&&this._arrEmptyCells.length<3&&(this._arrEmptyCells.push({value:Asc.c_oAscEDispBlanksAs.Span,displayValue:this.textEmptyLine}),s=!0),s&&(this.cmbEmptyCells.setData(this._arrEmptyCells),this.cmbEmptyCells.setValue(o.type!==Asc.c_oAscSparklineType.Line&&a==Asc.c_oAscEDispBlanksAs.Span?this.textEmptyLine:a)),this.updateSparkStyles(this.chartSettings.asc_getStyles(o.type))}},onSelectSparkStyle:function(t,e){this._noApply||this._changedProps&&this._changedProps.asc_setStyle(e.get("data"))},_setDefaults:function(t){if(t)if(this.chartSettings=t,this.isChart){if(this._state.ChartType=t.getType(),this._noApply=!0,this.isDiagramMode){var e=this.mnuChartTypePicker.store.findWhere({type:this._state.ChartType});this.mnuChartTypePicker.selectRecord(e,!0),e?this.btnChartType.setIconCls("svgicon chart-"+e.get("iconCls")):this.btnChartType.setIconCls("svgicon")}this._noApply=!1,this.cmbChartTitle.setValue(t.getTitle()),this.cmbLegendPos.setValue(t.getLegendPos()),this.updateDataLabels(this._state.ChartType,t.getDataLabelsPos()),this.cmbDataLabels.setDisabled(this._state.ChartType==Asc.c_oAscChartTypeSettings.surfaceNormal||this._state.ChartType==Asc.c_oAscChartTypeSettings.surfaceWireframe),this.chSeriesName.setValue(this.chartSettings.getShowSerName(),!0),this.chCategoryName.setValue(this.chartSettings.getShowCatName(),!0),this.chValue.setValue(this.chartSettings.getShowVal(),!0);var i=t.getSeparator();if(this.txtSeparator.setValue(i||""),this.vertAxisProps=t.getVertAxesProps(),this.horAxisProps=t.getHorAxesProps(),this.updateAxisProps(this._state.ChartType),this.currentChartType=this._state.ChartType,this.imageSettings)switch(i=this.imageSettings.asc_getTitle(),this.inputAltTitle.setValue(i||""),i=this.imageSettings.asc_getDescription(),this.textareaAltDescription.val(i||""),i=this.imageSettings.asc_getAnchor()){case AscCommon.c_oAscCellAnchorType.cellanchorTwoCell:this.radioTwoCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorOneCell:this.radioOneCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorAbsolute:this.radioAbsolute.setValue(!0,!0)}}else{this._state.SparkType=t.asc_getType();e=this.mnuSparkTypePicker.store.findWhere({type:this._state.SparkType});this.mnuSparkTypePicker.selectRecord(e,!0),e?this.btnSparkType.setIconCls("svgicon chart-"+e.get("iconCls")):this.btnSparkType.setIconCls("svgicon"),this.updateSparkStyles(this.sparklineStyles?this.sparklineStyles:t.asc_getStyles()),this._state.SparkType!==Asc.c_oAscSparklineType.Line&&this._arrEmptyCells.pop(),this.cmbEmptyCells.setData(this._arrEmptyCells);i=t.asc_getDisplayEmpty();this.cmbEmptyCells.setValue(this._state.SparkType!==Asc.c_oAscSparklineType.Line&&i==Asc.c_oAscEDispBlanksAs.Span?this.textEmptyLine:i),this.chShowEmpty.setValue(t.asc_getDisplayHidden(),!0),this.chShowAxis.setValue(t.asc_getDisplayXAxis(),!0),this.chReverse.setValue(t.asc_getRightToLeft(),!0),this.cmbSparkMinType.setValue(t.asc_getMinAxisType(),!0),this.cmbSparkMaxType.setValue(t.asc_getMaxAxisType(),!0),this.spnSparkMinValue.setDisabled(t.asc_getMinAxisType()!==Asc.c_oAscSparklineAxisMinMax.Custom),this.spnSparkMaxValue.setDisabled(t.asc_getMaxAxisType()!==Asc.c_oAscSparklineAxisMinMax.Custom),this.spnSparkMinValue.setValue(null!==t.asc_getManualMin()?t.asc_getManualMin():"",!0),this.spnSparkMaxValue.setValue(null!==t.asc_getManualMax()?t.asc_getManualMax():"",!0),this._changedProps=new Asc.sparklineGroup,this._noApply=!1}},getSettings:function(){var t;if(this.isChart){var e=this.currentChartType;if(this.isDiagramMode){var i=this.mnuChartTypePicker.getSelectedRec();i&&(e=i.get("type"))}return this.chartSettings.putType(e),this.chartSettings.putTitle(this.cmbChartTitle.getValue()),this.chartSettings.putLegendPos(this.cmbLegendPos.getValue()),this.chartSettings.putDataLabelsPos(this.cmbDataLabels.getValue()),this.chartSettings.putShowSerName("checked"==this.chSeriesName.getValue()),this.chartSettings.putShowCatName("checked"==this.chCategoryName.getValue()),this.chartSettings.putShowVal("checked"==this.chValue.getValue()),this.chartSettings.putSeparator(_.isEmpty(this.txtSeparator.getValue())?" ":this.txtSeparator.getValue()),this.chartSettings.putShowMarker("checked"==this.chMarkers.getValue()),(t=e==Asc.c_oAscChartTypeSettings.lineNormal||e==Asc.c_oAscChartTypeSettings.lineStacked||e==Asc.c_oAscChartTypeSettings.lineStackedPer||e==Asc.c_oAscChartTypeSettings.lineNormalMarker||e==Asc.c_oAscChartTypeSettings.lineStackedMarker||e==Asc.c_oAscChartTypeSettings.lineStackedPerMarker||e==Asc.c_oAscChartTypeSettings.scatter||e==Asc.c_oAscChartTypeSettings.scatterSmoothMarker||e==Asc.c_oAscChartTypeSettings.scatterSmooth||e==Asc.c_oAscChartTypeSettings.scatterLineMarker||e==Asc.c_oAscChartTypeSettings.scatterLine)&&(t=this.cmbLines.getValue(),this.chartSettings.putLine(0!==t),t>0&&this.chartSettings.putSmooth(2==t)),!this.isAltTitleChanged&&!this.isAltDescChanged||this._changedImageProps||(this._changedImageProps=new Asc.asc_CImgProperty),this.isAltTitleChanged&&this._changedImageProps.asc_putTitle(this.inputAltTitle.getValue()),this.isAltDescChanged&&this._changedImageProps.asc_putDescription(this.textareaAltDescription.val()),{chartSettings:this.chartSettings,imageSettings:this._changedImageProps}}return{chartSettings:this._changedProps}},onRadioSnapChange:function(t,e,i){e&&(this._changedImageProps||(this._changedImageProps=new Asc.asc_CImgProperty),this._changedImageProps.asc_putAnchor(t.options.value))},isRangeValid:function(){if(this.isChart){var t,e=this.chartSettings.getRange();if(_.isEmpty(e))return!0;var i=this.currentChartType;if(this.isDiagramMode){var n=this.mnuChartTypePicker.getSelectedRec();n&&(i=n.get("type"))}return(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,e,!0,this.chartSettings.getInRows(),i))==Asc.c_oAscError.ID.No||(this.setActiveCategory(0),t==Asc.c_oAscError.ID.StockChartError?Common.UI.warning({msg:this.errorStockChart}):t==Asc.c_oAscError.ID.MaxDataSeriesError?Common.UI.warning({msg:this.errorMaxRows}):t==Asc.c_oAscError.ID.MaxDataPointsError&&Common.UI.warning({msg:this.errorMaxPoints}),!1)}return!0},onSelectDataLabels:function(t,e,i){var n=e.value==Asc.c_oAscChartDataLabelsPos.none;this.chSeriesName.setDisabled(n),this.chCategoryName.setDisabled(n),this.chValue.setDisabled(n),this.txtSeparator.setDisabled(n),n||"checked"===this.chSeriesName.getValue()||"checked"===this.chCategoryName.getValue()||"checked"===this.chValue.getValue()||this.chValue.setValue("checked",!0)},onSelectSparkData:function(){var t=this;if(t.api){var e=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.sparkDataRangeValid=e.getSettings(),t.txtSparkDataRange.setValue(t.sparkDataRangeValid),t.txtSparkDataRange.checkValidate())}}).on("close",(function(){t.show()})),i=t.$window.offset();t.hide(),e.show(i.left+160,i.top+125),e.setSettings({api:t.api,range:_.isEmpty(t.txtSparkDataRange.getValue())||1!=t.txtSparkDataRange.checkValidate()?t.sparkDataRangeValid:t.txtSparkDataRange.getValue(),type:Asc.c_oAscSelectionDialogType.Chart})}},onSelectLocationData:function(){var t=this;if(t.api){var e=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.dataLocationRangeValid=e.getSettings(),t.txtSparkDataLocation.setValue(t.dataLocationRangeValid),t.txtSparkDataLocation.checkValidate())}}).on("close",(function(){t.show()})),i=t.$window.offset();t.hide(),e.show(i.left+160,i.top+125),e.setSettings({api:t.api,range:_.isEmpty(t.txtSparkDataLocation.getValue())||1!=t.txtSparkDataLocation.checkValidate()?t.dataLocationRangeValid:t.txtSparkDataLocation.getValue(),type:Asc.c_oAscSelectionDialogType.FormatTable})}},openFormat:function(t){var e=this,i=e.currentAxisProps[t].getNumFmt(),n=e.api.asc_getLocale(),o=Common.Utils.InternalSettings.get("sse-config-lang");!n&&(n=o?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(o)):1033);var s=new SSE.Views.FormatSettingsDialog({api:e.api,handler:function(t,n){"ok"==t&&n&&(i.putSourceLinked(n.linked),i.putFormatCode(n.format),e.chartSettings.endEditData(),e._isEditFormat=!1)},linked:!0,props:{format:i.getFormatCode(),formatInfo:i.getFormatCellsInfo(),langId:n,chartFormat:i}}).on("close",(function(){e._isEditFormat&&e.chartSettings.cancelEditData(),e._isEditFormat=!1}));e._isEditFormat=!0,e.chartSettings.startEditData(),s.show()},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},close:function(){this.api.asc_onCloseChartFrame(),Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments)},textTitle:"Chart - Advanced Settings",textShowValues:"Display chart values",textShowBorders:"Display chart borders",textDataRows:"in rows",textDataColumns:"in columns",textDisplayLegend:"Display Legend",textLegendBottom:"Bottom",textLegendTop:"Top",textLegendRight:"Right",textLegendLeft:"Left",textChartTitle:"Chart Title",textXAxisTitle:"X Axis Title",textYAxisTitle:"Y Axis Title",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",textChartElementsLegend:"Chart Elements &<br>Chart Legend",textLayout:"Layout",textLegendPos:"Legend",textDataLabels:"Data Labels",textSeparator:"Data Labels Separator",textSeriesName:"Series Name",textCategoryName:"Category Name",textValue:"Value",textAxisOptions:"Axis Options",textMinValue:"Minimum Value",textMaxValue:"Maximum Value",textAxisCrosses:"Axis Crosses",textUnits:"Display Units",textTickOptions:"Tick Options",textMajorType:"Major Type",textMinorType:"Minor Type",textLabelOptions:"Label Options",textLabelPos:"Label Position",textReverse:"Values in reverse order",textVertAxis:"Vertical Axis",textHorAxis:"Horizontal Axis",textMarksInterval:"Interval between Marks",textLabelDist:"Axis Label Distance",textLabelInterval:"Interval between Labels",textAxisPos:"Axis Position",textLeftOverlay:"Left Overlay",textRightOverlay:"Right Overlay",textOverlay:"Overlay",textNoOverlay:"No Overlay",textRotated:"Rotated",textHorizontal:"Horizontal",textInnerBottom:"Inner Bottom",textInnerTop:"Inner Top",textOuterTop:"Outer Top",textNone:"None",textCenter:"Center",textFixed:"Fixed",textAuto:"Auto",textCross:"Cross",textIn:"In",textOut:"Out",textLow:"Low",textHigh:"High",textNextToAxis:"Next to axis",textHundreds:"Hundreds",textThousands:"Thousands",textTenThousands:"10 000",textHundredThousands:"100 000",textMillions:"Millions",textTenMillions:"10 000 000",textHundredMil:"100 000 000",textBillions:"Billions",textTrillions:"Trillions",textCustom:"Custom",textManual:"Manual",textBetweenTickMarks:"Between Tick Marks",textOnTickMarks:"On Tick Marks",textLines:"Lines",textMarkers:"Markers",textMajor:"Major",textMinor:"Minor",textMajorMinor:"Major and Minor",textStraight:"Straight",textSmooth:"Smooth",textType:"Type",textTypeData:"Type & Data",textStyle:"Style",textSelectData:"Select data",errorMaxRows:"ERROR! The maximum number of data series per chart is 255.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",textAxisSettings:"Axis Settings",textGridLines:"Gridlines",textShow:"Show",textHide:"Hide",textLeft:"Left",textRight:"Right",textTop:"Top",textBottom:"Bottom",textFit:"Fit Width",textSparkRanges:"Sparkline Ranges",textLocationRange:"Location Range",textEmptyCells:"Hidden and Empty cells",textShowEmptyCells:"Show empty cells as",textShowData:"Show data in hidden rows and columns",textGroup:"Group Sparkline",textSingle:"Single Sparkline",textGaps:"Gaps",textZero:"Zero",textEmptyLine:"Connect data points with line",textShowSparkAxis:"Show Axis",textReverseOrder:"Reverse order",textAutoEach:"Auto for Each",textSameAll:"Same for All",textTitleSparkline:"Sparkline - Advanced Settings",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table.",errorMaxPoints:"ERROR! The maximum number of points in series per chart is 4096.",textSnap:"Cell Snapping",textAbsolute:"Don't move or size with cells",textOneCell:"Move but don't size with cells",textTwoCell:"Move and size with cells",textVertAxisSec:"Secondary Vertical Axis",textHorAxisSec:"Secondary Horizontal Axis",textAxisTitle:"Title",textHideAxis:"Hide axis",textFormat:"Label format",textBase:"Base",textLogScale:"Logarithmic Scale"},SSE.Views.ChartSettingsDlg||{}))})),define("spreadsheeteditor/main/app/view/ChartDataDialog",["common/main/lib/util/utils","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboBox","common/main/lib/component/ListView","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.ChartDataDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:370,height:490},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>","<td>",'<label class="input-label">',e.textData,"</label>","</td>","</tr>","<tr>",'<td class="padding-small" width="200">','<div id="chart-dlg-txt-range" class="input-row" style=""></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="input-label">',e.textSeries,"</label>",'<div id="chart-dlg-series-list" class="" style="width:100%; height: 93px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-add" style="min-width: 70px;margin-right:5px;">',e.textAdd,"</button>",'<button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-edit" style="min-width: 70px;margin-right:5px;">',e.textEdit,"</button>",'<button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-delete" style="min-width: 70px;margin-right:5px;">',e.textDelete,"</button>",'<div style="display: inline-block; float: right;">','<div id="chart-dlg-btn-up" style="display: inline-block;margin-right: 2px;"></div>','<div id="chart-dlg-btn-down" style="display: inline-block;"></div>',"</div>","</td>","</tr>","<tr>",'<td class="padding-large">','<button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-switch" style="min-width: 70px;margin-right:5px;">',e.textSwitch,"</button>","</td>","</tr>","<tr>",'<td class="padding-small">','<label class="input-label">',e.textCategory,"</label>",'<div id="chart-dlg-category-list" class="" style="width:100%; height: 93px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<button type="button" class="btn btn-text-default auto" id="chart-dlg-btn-category-edit" style="min-width: 70px;margin-right:5px;">',e.textEdit,"</button>","</td>","</tr>","</table>","</div></div>","</div>","</div>",'<div class="separator horizontal"></div>'].join("")},t),this.handler=t.handler,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._noApply=!0,this._changedProps=null,this.api=this.options.api,this.chartSettings=this.options.chartSettings,this.currentChartType=Asc.c_oAscChartTypeSettings.barNormal},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.txtDataRange=new Common.UI.InputFieldBtn({el:$("#chart-dlg-txt-range"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0}),this.txtDataRange.on("button:click",_.bind(this.onSelectData,this)),this.txtDataRange.on("changed:after",(function(e,i,n,o){i!=n&&t.changeChartRange(i)})),this.seriesList=new Common.UI.ListView({el:$("#chart-dlg-series-list",this.$window),store:new Common.UI.DataViewStore,emptyText:"",scrollAlwaysVisible:!0,itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="min-height: 15px;"><%= value %></div>'),tabindex:1}),this.seriesList.onKeyDown=_.bind(this.onListKeyDown,this,"series"),this.seriesList.on("item:select",_.bind(this.onSelectSeries,this)),this.seriesList.store.comparator=function(t){return t.get("order")},this.btnAdd=new Common.UI.Button({el:$("#chart-dlg-btn-add")}),this.btnAdd.on("click",_.bind(this.onAddSeries,this,!1)),this.btnDelete=new Common.UI.Button({el:$("#chart-dlg-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDeleteSeries,this)),this.btnEdit=new Common.UI.Button({el:$("#chart-dlg-btn-edit")}),this.btnEdit.on("click",_.bind(this.onEditSeries,this,!1)),this.btnUp=new Common.UI.Button({parentEl:$("#chart-dlg-btn-up"),cls:"btn-toolbar bg-white",iconCls:"caret-up",hint:this.textUp}),this.btnUp.on("click",_.bind(this.onMoveClick,this,!0)),this.btnDown=new Common.UI.Button({parentEl:$("#chart-dlg-btn-down"),cls:"btn-toolbar bg-white",iconCls:"caret-down",hint:this.textDown}),this.btnDown.on("click",_.bind(this.onMoveClick,this,!1)),this.btnSwitch=new Common.UI.Button({el:$("#chart-dlg-btn-switch")}),this.btnSwitch.on("click",_.bind(this.onSwitch,this)),this.categoryList=new Common.UI.ListView({el:$("#chart-dlg-category-list",this.$window),store:new Common.UI.DataViewStore,emptyText:"",scrollAlwaysVisible:!0,itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="min-height: 15px;"><%= value %></div>'),tabindex:1}),this.btnEditCategory=new Common.UI.Button({el:$("#chart-dlg-btn-category-edit")}),this.btnEditCategory.on("click",_.bind(this.onEditCategory,this,!1)),this.afterRender()},getFocusedComponents:function(){return[this.txtDataRange,this.seriesList,this.btnAdd,this.btnEdit,this.btnDelete,this.btnUp,this.btnDown,this.btnSwitch,this.categoryList,this.btnEditCategory]},getDefaultFocusableComponent:function(){return this.txtDataRange},afterRender:function(){this._setDefaults(this.chartSettings)},close:function(){this.api.asc_onCloseChartFrame(),Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments)},_setDefaults:function(t){if(t){this.chartSettings=t,this.currentChartType=t.getType();var e=t.getRange();this.txtDataRange.setValue(e||""),this.txtDataRange.validation=function(t){return!0},this.updateSeriesList(t.getSeries(),0),this.updateCategoryList(t.getCatValues())}this.updateButtons()},getSettings:function(){return{chartSettings:this.chartSettings}},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;if("ok"==e){if(!this.isRangeValid())return;this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0)}this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},isRangeValid:function(){var t;if(!0===(t=this.chartSettings.isValidRange(this.txtDataRange.getValue()))||t==Asc.c_oAscError.ID.No)return!0;var e=this.textInvalidRange;switch(t){case Asc.c_oAscError.ID.StockChartError:e=this.errorStockChart;break;case Asc.c_oAscError.ID.MaxDataSeriesError:e=this.errorMaxRows;break;case Asc.c_oAscError.ID.MaxDataPointsError:e=this.errorMaxPoints;break;case Asc.c_oAscError.ID.ErrorInFormula:e=this.errorInFormula;break;case Asc.c_oAscError.ID.InvalidReference:e=this.errorInvalidReference;break;case Asc.c_oAscError.ID.NoSingleRowCol:e=this.errorNoSingleRowCol;break;case Asc.c_oAscError.ID.NoValues:e=this.errorNoValues}return Common.UI.warning({msg:e,maxwidth:600}),!1},changeChartRange:function(t){var e=this;e.isRangeValid(t)&&(e.txtDataRange.checkValidate(),e.chartSettings.setRange(t),e.updateSeriesList(e.chartSettings.getSeries(),0),e.updateCategoryList(e.chartSettings.getCatValues()),e.updateButtons())},onSelectData:function(t){var e=this;if(e.api){var i=new SSE.Views.CellRangeDialog({handler:function(i,n){"ok"==n&&(t.setValue(i.getSettings()),_.delay((function(){e.changeChartRange(i.getSettings())}),10))}}).on("close",(function(){e.show()})),n=e.$window.offset();e.hide(),i.show(n.left+160,n.top+125),i.setSettings({api:e.api,range:e.txtDataRange.getValue(),type:Asc.c_oAscSelectionDialogType.Chart,validation:function(){return!0}})}},onListKeyDown:function(t,e,i){var n=this.seriesList;n.disabled||(_.isUndefined(void 0)&&(i=e),(i.keyCode!=Common.UI.Keys.DELETE||this.btnDelete.isDisabled())&&Common.UI.DataView.prototype.onKeyDown.call(n,e,i))},onSelectSeries:function(t,e,i){this.updateMoveButtons()},updateRange:function(){this.txtDataRange.setValue(this.chartSettings.getRange()||"")},updateButtons:function(){this.btnEdit.setDisabled(this.seriesList.store.length<1),this.btnDelete.setDisabled(this.seriesList.store.length<1),this.btnSwitch.setDisabled(this.seriesList.store.length<1||!this.chartSettings.getRange()),this.updateMoveButtons()},updateMoveButtons:function(){var t=this.seriesList.getSelectedRec(),e=t?this.seriesList.store.indexOf(t):-1;this.btnUp.setDisabled(e<1),this.btnDown.setDisabled(e<0||e==this.seriesList.store.length-1)},onAddSeries:function(){var t=this;t.chartSettings.startEditData();var e=t.chartSettings.addSeries(),i=e.asc_IsScatter();this.changeDataRange(1,{series:e,isScatter:i},(function(e,i){"ok"==i&&(t.updateRange(),t.updateSeriesList(t.chartSettings.getSeries(),t.seriesList.store.length-1),t.updateCategoryList(t.chartSettings.getCatValues()),t.updateButtons(),t.chartSettings.endEditData(),t._isEditRanges=!1)}))},onDeleteSeries:function(){var t=this.seriesList.getSelectedRec();if(t){var e=t.get("order");t.get("series").asc_Remove(),this.updateRange(),this.updateSeriesList(this.chartSettings.getSeries(),e),this.updateCategoryList(this.chartSettings.getCatValues()),this.updateButtons()}},onEditSeries:function(){var t=this.seriesList.getSelectedRec();if(t){var e=t.get("series"),i=e.asc_IsScatter(),n=this;n.chartSettings.startEditData(),this.changeDataRange(1,{series:e,isScatter:i},(function(i,o){"ok"==o&&(t.set("value",e.asc_getSeriesName()),n.updateRange(),n.updateCategoryList(n.chartSettings.getCatValues()),n.updateButtons(),n.chartSettings.endEditData(),n._isEditRanges=!1)}))}},onEditCategory:function(){var t=this;t.chartSettings.startEditData(),this.changeDataRange(0,{category:this.chartSettings.getCatFormula(),values:this.chartSettings.getCatValues()},(function(e,i){"ok"==i&&(t.updateCategoryList(t.chartSettings.getCatValues()),t.updateRange(),t.updateButtons(),t.chartSettings.endEditData(),t._isEditRanges=!1)}))},changeDataRange:function(t,e,i){var n=this,o=new SSE.Views.ChartDataRangeDialog({type:t,isScatter:!!e.isScatter,handler:i}).on("close",(function(){n._isEditRanges&&n.chartSettings.cancelEditData(),n._isEditRanges=!1,n.show()}));n._isEditRanges=!0;var s=n.$window.offset();n.hide(),o.show(s.left+160,s.top+125),o.setSettings({api:n.api,props:e,chartSettings:n.chartSettings})},onMoveClick:function(t){var e=this.seriesList.store,i=e.length,n=this.seriesList.getSelectedRec();if(n){var o=e.indexOf(n),s=n.get("order"),a=t?Math.max(0,o-1):Math.min(i-1,o+1),l=e.at(a),r=l.get("order");e.add(e.remove(n),{at:a}),n.set("order",r),l.set("order",s),t?n.get("series").asc_MoveUp():n.get("series").asc_MoveDown(),this.seriesList.selectRecord(n),this.seriesList.scrollToRecord(n),this.updateRange(),this.updateCategoryList(this.chartSettings.getCatValues()),this.updateButtons()}},updateSeriesList:function(t,e){this.btnEditCategory.setDisabled(!!(t&&t.length>0)&&t[0].asc_IsScatter());for(var i=[],n=this.seriesList.store,o=0,s=t.length;o<s;o++){var a=t[o],l=new Common.UI.DataViewModel;l.set({value:a.asc_getSeriesName(),index:a.asc_getIdx(),order:a.asc_getOrder(),series:a}),i.push(l)}n.reset(i),s>0&&this.seriesList.selectByIndex(Math.min(e||0,n.length-1))},updateCategoryList:function(t){for(var e=[],i=this.categoryList.store,n=0,o=t.length;n<o;n++){var s=t[n],a=new Common.UI.DataViewModel;a.set({value:s}),e.push(a)}i.reset(e),o>0&&this.categoryList.selectByIndex(0)},onSwitch:function(){this.chartSettings.switchRowCol()===Asc.c_oAscError.ID.MaxDataSeriesError?Common.UI.warning({msg:this.errorMaxRows,maxwidth:600}):(this.updateSeriesList(this.chartSettings.getSeries(),0),this.updateCategoryList(this.chartSettings.getCatValues()),this.updateRange(),this.updateButtons())},textTitle:"Chart Data",textInvalidRange:"Invalid cells range",textSelectData:"Select data",errorMaxRows:"The maximum number of data series per chart is 255.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",errorMaxPoints:"The maximum number of points in series per chart is 4096.",textSeries:"Legend Entries (Series)",textAdd:"Add",textEdit:"Edit",textDelete:"Remove",textSwitch:"Switch Row/Column",textCategory:"Horizontal (Category) Axis Labels",textUp:"Up",textDown:"Down",textData:"Chart data range",errorInFormula:"There's an error in formula you entered.",errorInvalidReference:"The reference is not valid. Reference must be to an open worksheet.",errorNoSingleRowCol:"The reference is not valid. References for titles, values, sizes, or data labels must be a single cell, row, or column.",errorNoValues:"To create a chart, the series must contain at least one value."},SSE.Views.ChartDataDialog||{}))})),define("spreadsheeteditor/main/app/view/ChartTypeDialog",["common/main/lib/util/utils","common/main/lib/component/ComboBox","common/main/lib/component/ListView","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";var t=Common.UI.DataViewItem.extend({initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.listenTo(e.model,"change:sort",(function(){e.render(),e.trigger("change",e,e.model)})),e.listenTo(e.model,"change:selected",(function(){(e.$el||$(e.el)).toggleClass("selected",e.model.get("selected")&&e.model.get("allowSelected")),e.onSelectChange(e.model,e.model.get("selected")&&e.model.get("allowSelected"))})),e.listenTo(e.model,"remove",e.remove)}});SSE.Views.ChartTypeDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:370,height:385},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-large">','<label class="header">',e.textType,"</label>",'<div id="chart-type-dlg-button-type" style=""></div>',"</td>","</tr>",'<tr class="simple-chart">','<td class="padding-small">','<label class="header">',e.textStyle,"</label>",'<div id="chart-type-dlg-styles-list" class="" style="width:100%; height: 176px;"></div>',"</td>","</tr>",'<tr class="combined-chart">',"<td>",'<label id="chart-type-dlg-label-column" class="header" style="width: 115px;">',e.textSeries,"</label>",'<label id="chart-type-dlg-label-sort" class="header" style="width: 100px;">',e.textType,"</label>",'<label class="header" style="width: 134px;text-align: center;">',e.textSecondary,"</label>","</td>","</tr>",'<tr class="combined-chart">','<td class="padding-small">','<div id="chart-type-dlg-series-list" class="" style="width:100%; height: 180px;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.handler=t.handler,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._changedProps=null,this.api=this.options.api,this.chartSettings=this.options.chartSettings,this.currentChartType=Asc.c_oAscChartTypeSettings.barNormal,this.wrapEvents={onAddChartStylesPreview:_.bind(this.onAddChartStylesPreview,this)},this.api.asc_registerCallback("asc_onAddChartStylesPreview",this.wrapEvents.onAddChartStylesPreview)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var e=this,i=Common.define.chartData.getChartGroupData();this._arrSeriesGroups=[],i.forEach((function(t){"menu-chart-group-combo"!==t.id&&"menu-chart-group-stock"!==t.id&&e._arrSeriesGroups.push(t)})),i=Common.define.chartData.getChartData(),this._arrSeriesType=[],i.forEach((function(t){!t.is3d&&t.type!==Asc.c_oAscChartTypeSettings.stock&&t.type!==Asc.c_oAscChartTypeSettings.comboBarLine&&t.type!==Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&t.type!==Asc.c_oAscChartTypeSettings.comboAreaBar&&t.type!==Asc.c_oAscChartTypeSettings.comboCustom&&e._arrSeriesType.push(t)})),this.btnChartType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"svgicon chart-bar-normal",menu:new Common.UI.Menu({style:"width: 364px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="chart-type-dlg-menu-type" class="menu-insertchart"></div>')}]})}),this.btnChartType.on("render:after",(function(t){e.mnuChartTypePicker=new Common.UI.DataView({el:$("#chart-type-dlg-menu-type",e.$window),parentMenu:t.menu,restoreHeight:465,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getChartGroupData()),store:new Common.UI.DataViewStore(i),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')})})),this.btnChartType.render($("#chart-type-dlg-button-type"),this.$window),this.mnuChartTypePicker.on("item:click",_.bind(this.onSelectType,this)),this.stylesList=new Common.UI.DataView({el:$("#chart-type-dlg-styles-list",this.$window),store:new Common.UI.DataViewStore,cls:"bordered",enableKeyEvents:this.options.enableKeyEvents,itemTemplate:_.template(['<div class="style" id="<%= id %>">','<img src="<%= imageUrl %>" width="50" height="50" <% if(typeof imageUrl === "undefined" || imageUrl===null || imageUrl==="") { %> style="visibility: hidden;" <% } %>/>','<% if (typeof title !== "undefined") {%>','<span class="title"><%= title %></span>',"<% } %>","</div>"].join("")),delayRenderTips:!0}),this.stylesList.on("item:select",_.bind(this.onSelectStyles,this)),this.seriesList=new Common.UI.ListView({el:$("#chart-type-dlg-series-list",this.$window),store:new Common.UI.DataViewStore,emptyText:"",enableKeyEvents:!1,scrollAlwaysVisible:!0,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div class="list-item" style="width: 100%;" id="chart-type-dlg-item-<%= seriesIndex %>">','<div style="width:8px;height:12px;display: inline-block;vertical-align: middle;" id="chart-type-dlg-series-preview-<%= seriesIndex %>"></div>','<div style="width:95px;padding-left: 5px;display: inline-block;vertical-align: middle;overflow: hidden; text-overflow: ellipsis;white-space: nowrap;"><%= value %></div>','<div style="width: 110px;padding-left: 5px;display: inline-block;vertical-align: middle;"><div id="chart-type-dlg-cmb-series-<%= seriesIndex %>" class="input-group-nr" style=""></div></div>','<div style="padding-left: 55px;display: inline-block;vertical-align: middle;"><div id="chart-type-dlg-chk-series-<%= seriesIndex %>" style=""></div></div>',"</div>"].join(""))}),this.seriesList.createNewItem=function(e){return new t({template:this.itemTemplate,model:e})},this.NotCombinedSettings=$(".simple-chart",this.$window),this.CombinedSettings=$(".combined-chart",this.$window),this.afterRender()},afterRender:function(){this._setDefaults(this.chartSettings)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},close:function(){this.api.asc_onCloseChartFrame(),this.api.asc_unregisterCallback("asc_onAddChartStylesPreview",this.wrapEvents.onAddChartStylesPreview),Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments)},_setDefaults:function(t){if(t){this.chartSettings=t,this.currentChartType=t.getType();var e=this.mnuChartTypePicker.store.findWhere({type:this.currentChartType});if(this.mnuChartTypePicker.selectRecord(e,!0),e)this.btnChartType.setIconCls("svgicon chart-"+e.get("iconCls"));else{var i="";switch(this.currentChartType){case Asc.c_oAscChartTypeSettings.surfaceNormal:i="chart-surface-normal";break;case Asc.c_oAscChartTypeSettings.surfaceWireframe:i="chart-surface-wireframe";break;case Asc.c_oAscChartTypeSettings.contourNormal:case Asc.c_oAscChartTypeSettings.contourWireframe:i="chart-contour-wireframe"}this.btnChartType.setIconCls("svgicon "+i)}this.seriesList.on("item:add",_.bind(this.addControls,this)),this.seriesList.on("item:change",_.bind(this.addControls,this)),this.ShowHideSettings(this.currentChartType),this.currentChartType==Asc.c_oAscChartTypeSettings.comboBarLine||this.currentChartType==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||this.currentChartType==Asc.c_oAscChartTypeSettings.comboAreaBar||this.currentChartType==Asc.c_oAscChartTypeSettings.comboCustom?this.updateSeriesList(this.chartSettings.getSeries()):(this.updateChartStyles(this.api.asc_getChartPreviews(this.currentChartType,void 0,!0)),this.api.asc_generateChartPreviews(this.currentChartType))}},getSettings:function(){return{chartSettings:this.chartSettings}},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;"ok"==e&&this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},onSelectType:function(t,e,i){var n={};if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;n=i.toJSON()}else n=i;var o=n.type==Asc.c_oAscChartTypeSettings.comboBarLine||n.type==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||n.type==Asc.c_oAscChartTypeSettings.comboAreaBar||n.type==Asc.c_oAscChartTypeSettings.comboCustom;o&&this.chartSettings.getSeries().length<2?Common.UI.warning({msg:this.errorComboSeries,maxwidth:600}):this.chartSettings.changeType(n.type)?(this.btnChartType.setIconCls("svgicon chart-"+n.iconCls),this.currentChartType=n.type,this.ShowHideSettings(this.currentChartType),o?this.updateSeriesList(this.chartSettings.getSeries()):(this.updateChartStyles(this.api.asc_getChartPreviews(this.currentChartType,void 0,!0)),this.api.asc_generateChartPreviews(this.currentChartType))):t.selectRecord(t.store.findWhere({type:this.currentChartType}),!0)},updateChartStyles:function(t){var e=this;if(t&&t.length>0){var i=this.stylesList.store;if(i){var n=[];_.each(t,(function(t,i){n.push({imageUrl:t.asc_getImage(),data:t.asc_getName(),tip:e.textStyle+" "+t.asc_getName()})})),i.reset(n,{silent:!1})}}else this.stylesList.store.reset();this.stylesList.setDisabled(!t||t.length<1)},onSelectStyles:function(t,e,i){i&&this.chartSettings.putStyle(i.get("data"))},onAddChartStylesPreview:function(t){if(t&&t.length>0){var e=this.stylesList.store;e&&_.each(t,(function(t,i){var n=e.findWhere({data:t.asc_getName()});n&&n.set("imageUrl",t.asc_getImage())}))}},updateSeriesList:function(t,e){for(var i=[],n=this.seriesList.store,o=0,s=t.length;o<s;o++){var a=t[o],l=new Common.UI.DataViewModel;l.set({value:a.asc_getSeriesName(),type:a.asc_getChartType(),isSecondary:a.asc_getIsSecondaryAxis(),canChangeSecondary:a.asc_canChangeAxisType(),seriesIndex:o,series:a}),i.push(l)}n.reset(i),i.length>0&&void 0!==e&&e<i.length&&this.seriesList.selectByIndex(e)},addControls:function(t,e,i){if(i){var n=this,o=i.get("seriesIndex"),s=this.seriesList.cmpEl.find("#chart-type-dlg-item-"+o),a=i.get("series");a.asc_drawPreviewRect("chart-type-dlg-series-preview-"+o);this.initSeriesType("#chart-type-dlg-cmb-series-"+o,o,i);new Common.UI.CheckBox({el:s.find("#chart-type-dlg-chk-series-"+o),value:i.get("isSecondary"),disabled:!i.get("canChangeSecondary")}).on("change",(function(t,e,i,s){a.asc_TryChangeAxisType("checked"==t.getValue())!==Asc.c_oAscError.ID.No?t.setValue("checked"!=t.getValue(),!0):n.updateSeriesList(n.chartSettings.getSeries(),o)})),s.on("mousedown",".combobox",(function(){n.seriesList.selectRecord(i)}))}},initSeriesType:function(t,e,i){var n=this,o=i.get("series"),s=new Common.UI.DataViewStore(n._arrSeriesType),a=s.findWhere({type:i.get("type")}),l=a?a.get("tip"):"",r=$(t),c=new Common.UI.ComboBox({el:r,template:_.template(['<span class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle no-highlighted" tabindex="0" data-toggle="dropdown">','<input type="text" class="form-control" spellcheck="false">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" data-target="'+t+'"><span class="caret"></span></button>',"</span>"].join(""))}),d=new Common.UI.Menu({cls:"menu-absolute",style:"width: 318px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="chart-type-dlg-series-menu-'+e+'" class="menu-insertchart"></div>')}]});d.render(r),c.setValue(l);var h=function(t){var l=new Common.UI.DataView({el:$("#chart-type-dlg-series-menu-"+e),parentMenu:t,restoreHeight:465,groups:new Common.UI.DataViewGroupStore(n._arrSeriesGroups),store:s,itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')});l.selectRecord(a,!0),l.on("item:click",(function(t,s,a){var l=i.get("type"),r=o.asc_TryChangeChartType(a.get("type"));if(r==Asc.c_oAscError.ID.No)c.setValue(a.get("tip")),n.updateSeriesList(n.chartSettings.getSeries(),e);else{var d=t.store.findWhere({type:l});t.selectRecord(d,!0),r==Asc.c_oAscError.ID.SecondaryAxis&&Common.UI.warning({msg:n.errorSecondaryAxis,maxwidth:500})}})),t.off("show:before",h)};return d.on("show:before",h),c},ShowHideSettings:function(t){var e=t==Asc.c_oAscChartTypeSettings.comboBarLine||t==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||t==Asc.c_oAscChartTypeSettings.comboAreaBar||t==Asc.c_oAscChartTypeSettings.comboCustom;this.NotCombinedSettings.toggleClass("hidden",e),this.CombinedSettings.toggleClass("hidden",!e)},textTitle:"Chart Type",textType:"Type",textStyle:"Style",textSeries:"Series",textSecondary:"Secondary Axis",errorSecondaryAxis:"The selected chart type requires the secondary axis that an existing chart is using. Select another chart type.",errorComboSeries:"To create a combination chart, select at least two series of data."},SSE.Views.ChartTypeDialog||{}))})),define("spreadsheeteditor/main/app/view/ChartSettings",["text!spreadsheeteditor/main/app/template/ChartSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboDataView","spreadsheeteditor/main/app/view/ChartSettingsDlg","spreadsheeteditor/main/app/view/ChartDataDialog","spreadsheeteditor/main/app/view/ChartTypeDialog"],(function(t,e,i,n){"use strict";SSE.Views.ChartSettings=n.View.extend(i.extend({el:"#id-chart-settings",template:i.template(t),events:{},options:{alias:"ChartSettings"},initialize:function(){this._initSettings=!0,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Width:0,Height:0,ChartStyle:1,ChartType:-1,SeveralCharts:!1,DisabledControls:!1,keepRatio:!1,SparkType:-1,SparkStyle:1,LineWeight:1,MarkersPoint:!1,HighPoint:!1,LowPoint:!1,FirstPoint:!1,LastPoint:!1,NegativePoint:!1,SparkColor:"000000",MarkersColor:this.defColor,HighColor:this.defColor,LowColor:this.defColor,FirstColor:this.defColor,LastColor:this.defColor,NegativeColor:this.defColor,SparkId:void 0},this._nRatio=1,this.spinners=[],this.chPoints=[],this.lockedControls=[],this._locked=!1,this.defColor={color:"4f81bd",effectId:24},this.isChart=!0,this._noApply=!1,this._originalProps=null,this.render(),this.ChartSizeContainer=e("#chart-panel-size"),this.ChartTypesContainer=e("#chart-panel-types"),this.SparkTypesContainer=e("#spark-panel-types"),this.SparkPointsContainer=e("#spark-panel-points"),this.NotCombinedSettings=e(".not-combined")},render:function(){e(this.el).html(this.template({scope:this}))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onUpdateChartStyles",i.bind(this._onUpdateChartStyles,this)),this.api.asc_registerCallback("asc_onAddChartStylesPreview",i.bind(this.onAddChartStylesPreview,this))),this},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this._isEditType)this._props=t;else if(this.ShowHideElem(!!(t&&t.asc_getChartProperties&&t.asc_getChartProperties())),this.disableControls(this._locked),this.api&&t)if(t.asc_getChartProperties&&t.asc_getChartProperties()){this._originalProps=new Asc.asc_CImgProperty(t),this.isChart=!0,this._noApply=!0,this.chartProps=t.asc_getChartProperties();var e=t.asc_getSeveralCharts()||this._locked;this._state.SeveralCharts!==e&&(this.linkAdvanced.toggleClass("disabled",e),this._state.SeveralCharts=e),e=t.asc_getSeveralChartTypes();var n=this._state.SeveralCharts&&e?null:this.chartProps.getType();if(this._state.ChartType!==n&&(this.ShowCombinedProps(n),null!==n&&n!=Asc.c_oAscChartTypeSettings.comboBarLine&&n!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&n!=Asc.c_oAscChartTypeSettings.comboAreaBar&&n!=Asc.c_oAscChartTypeSettings.comboCustom&&this.updateChartStyles(this.api.asc_getChartPreviews(n,void 0,!0)),this._state.ChartType=n),n!=Asc.c_oAscChartTypeSettings.comboBarLine&&n!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&n!=Asc.c_oAscChartTypeSettings.comboAreaBar&&n!=Asc.c_oAscChartTypeSettings.comboCustom){if(e=t.asc_getSeveralChartStyles(),this._state.SeveralCharts&&e)this.cmbChartStyle.fieldPicker.deselectAll(),this.cmbChartStyle.menuPicker.deselectAll(),this._state.ChartStyle=null;else if(e=this.chartProps.getStyle(),this._state.ChartStyle!==e||this._isChartStylesChanged){this._state.ChartStyle=e;var o=this.selectCurrentChartStyle();this._isChartStylesChanged&&this.api.asc_generateChartPreviews(this._state.ChartType,o)}this._isChartStylesChanged=!1}this._noApply=!1,e=t.asc_getWidth(),(Math.abs(this._state.Width-e)>.001||(null===this._state.Width||null===e)&&this._state.Width!==e)&&(this.spnWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Width=e),e=t.asc_getHeight(),(Math.abs(this._state.Height-e)>.001||(null===this._state.Height||null===e)&&this._state.Height!==e)&&(this.spnHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Height=e),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),e=t.asc_getLockAspect(),this._state.keepRatio!==e&&(this.btnRatio.toggle(e),this._state.keepRatio=e);var s=this.api.asc_getChartObject(!0),a=s?s.getSeries():null;this.btnSwitch.setDisabled(this._locked||!a||a.length<1||!s||!s.getRange())}else{this._originalProps=t,this.isChart=!1,this._state.SparkId=t.asc_getId();n=t.asc_getType();var l=!1;if(this._state.SparkType!==n){var r=this.mnuSparkTypePicker.store.findWhere({type:n});this.mnuSparkTypePicker.selectRecord(r,!0),r?this.btnSparkType.setIconCls("svgicon chart-"+r.get("iconCls")):this.btnSparkType.setIconCls("svgicon"),this._state.SparkType=n,l=!0}var c=t.asc_getLineWeight(),d=Math.abs(this._state.LineWeight-c)<.001&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.LineWeight-c)>.001||d||(null===this._state.LineWeight||null===c)&&this._state.LineWeight!==c){this._state.LineWeight=c;var h=null===c?c:i.find(this.cmbBorderSize.store.models,(function(t){if(c<t.attributes.value+.01&&c>t.attributes.value-.01)return!0}));h?this.cmbBorderSize.selectRecord(h):this.cmbBorderSize.setValue(null!==c?parseFloat(c.toFixed(2))+" "+this.txtPt:""),this.BorderSize=c}this.cmbBorderSize.setDisabled(this._locked||this._state.SparkType!==Asc.c_oAscSparklineType.Line);var p=t.asc_getColorSeries();if(p)if(this.SparkColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.SparkColor)!==typeof this._state.SparkColor||"object"==g&&(this.SparkColor.effectValue!==this._state.SparkColor.effectValue||this._state.SparkColor.color.indexOf(this.SparkColor.color)<0)||"object"!=g&&(this._state.SparkColor.indexOf(this.SparkColor)<0||"object"==typeof this.btnSparkColor.color)){if(this.btnSparkColor.setColor(this.SparkColor),"object"==typeof this.SparkColor){for(var m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.SparkColor.effectValue){this.colorsSpark.select(this.SparkColor,!0),m=!0;break}m||this.colorsSpark.clearSelection()}else this.colorsSpark.select(this.SparkColor,!0);this._state.SparkColor=this.SparkColor}var g,f=t.asc_getMarkersPoint();if(p=t.asc_getColorMarkers(),this._state.MarkersPoint!==f&&(this.chMarkersPoint.setValue(null!=f?f:"indeterminate",!0),this._state.MarkersPoint=f,l=!0),this.chMarkersPoint.setDisabled(this._locked||this._state.SparkType!==Asc.c_oAscSparklineType.Line),this.btnMarkersColor.setDisabled(this._locked||this._state.SparkType!==Asc.c_oAscSparklineType.Line),p)if(this.MarkersColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.MarkersColor)!==typeof this._state.MarkersColor||"object"==g&&(this.MarkersColor.effectValue!==this._state.MarkersColor.effectValue||this._state.MarkersColor.color.indexOf(this.MarkersColor.color)<0)||"object"!=g&&(this._state.MarkersColor.indexOf(this.MarkersColor)<0||"object"==typeof this.btnMarkersColor.color)){if(this.btnMarkersColor.setColor(this.MarkersColor),"object"==typeof this.MarkersColor){for(m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.MarkersColor.effectValue){this.colorsMarkers.select(this.MarkersColor,!0),m=!0;break}m||this.colorsMarkers.clearSelection()}else this.colorsMarkers.select(this.MarkersColor,!0);this._state.MarkersColor=this.MarkersColor,l=!0}if(f=t.asc_getHighPoint(),p=t.asc_getColorHigh(),this._state.HighPoint!==f&&(this.chHighPoint.setValue(null!=f?f:"indeterminate",!0),this._state.HighPoint=f,l=!0),p)if(this.HighColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.HighColor)!==typeof this._state.HighColor||"object"==g&&(this.HighColor.effectValue!==this._state.HighColor.effectValue||this._state.HighColor.color.indexOf(this.HighColor.color)<0)||"object"!=g&&(this._state.HighColor.indexOf(this.HighColor)<0||"object"==typeof this.btnHighColor.color)){if(this.btnHighColor.setColor(this.HighColor),"object"==typeof this.HighColor){for(m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.HighColor.effectValue){this.colorsHigh.select(this.HighColor,!0),m=!0;break}m||this.colorsHigh.clearSelection()}else this.colorsHigh.select(this.HighColor,!0);this._state.HighColor=this.HighColor,l=!0}if(f=t.asc_getLowPoint(),p=t.asc_getColorLow(),this._state.LowPoint!==f&&(this.chLowPoint.setValue(null!=f?f:"indeterminate",!0),this._state.LowPoint=f,l=!0),p)if(this.LowColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.LowColor)!==typeof this._state.LowColor||"object"==g&&(this.LowColor.effectValue!==this._state.LowColor.effectValue||this._state.LowColor.color.indexOf(this.LowColor.color)<0)||"object"!=g&&(this._state.LowColor.indexOf(this.LowColor)<0||"object"==typeof this.btnLowColor.color)){if(this.btnLowColor.setColor(this.LowColor),"object"==typeof this.LowColor){for(m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.LowColor.effectValue){this.colorsLow.select(this.LowColor,!0),m=!0;break}m||this.colorsLow.clearSelection()}else this.colorsLow.select(this.LowColor,!0);this._state.LowColor=this.LowColor,l=!0}if(f=t.asc_getFirstPoint(),p=t.asc_getColorFirst(),this._state.FirstPoint!==f&&(this.chFirstPoint.setValue(null!=f?f:"indeterminate",!0),this._state.FirstPoint=f,l=!0),p)if(this.FirstColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.FirstColor)!==typeof this._state.FirstColor||"object"==g&&(this.FirstColor.effectValue!==this._state.FirstColor.effectValue||this._state.FirstColor.color.indexOf(this.FirstColor.color)<0)||"object"!=g&&(this._state.FirstColor.indexOf(this.FirstColor)<0||"object"==typeof this.btnFirstColor.color)){if(this.btnFirstColor.setColor(this.FirstColor),"object"==typeof this.FirstColor){for(m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.FirstColor.effectValue){this.colorsFirst.select(this.FirstColor,!0),m=!0;break}m||this.colorsFirst.clearSelection()}else this.colorsFirst.select(this.FirstColor,!0);this._state.FirstColor=this.FirstColor,l=!0}if(f=t.asc_getLastPoint(),p=t.asc_getColorLast(),this._state.LastPoint!==f&&(this.chLastPoint.setValue(null!=f?f:"indeterminate",!0),this._state.LastPoint=f,l=!0),p)if(this.LastColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.LastColor)!==typeof this._state.LastColor||"object"==g&&(this.LastColor.effectValue!==this._state.LastColor.effectValue||this._state.LastColor.color.indexOf(this.LastColor.color)<0)||"object"!=g&&(this._state.LastColor.indexOf(this.LastColor)<0||"object"==typeof this.btnLastColor.color)){if(this.btnLastColor.setColor(this.LastColor),"object"==typeof this.LastColor){for(m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.LastColor.effectValue){this.colorsLast.select(this.LastColor,!0),m=!0;break}m||this.colorsLast.clearSelection()}else this.colorsLast.select(this.LastColor,!0);this._state.LastColor=this.LastColor,l=!0}if(f=t.asc_getNegativePoint(),p=t.asc_getColorNegative(),this._state.NegativePoint!==f&&(this.chNegativePoint.setValue(null!=f?f:"indeterminate",!0),this._state.NegativePoint=f,l=!0),p)if(this.NegativeColor=p.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),effectValue:p.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(p.asc_getR(),p.asc_getG(),p.asc_getB()),(g=typeof this.NegativeColor)!==typeof this._state.NegativeColor||"object"==g&&(this.NegativeColor.effectValue!==this._state.NegativeColor.effectValue||this._state.NegativeColor.color.indexOf(this.NegativeColor.color)<0)||"object"!=g&&(this._state.NegativeColor.indexOf(this.NegativeColor)<0||"object"==typeof this.btnNegativeColor.color)){if(this.btnNegativeColor.setColor(this.NegativeColor),"object"==typeof this.NegativeColor){for(m=!1,u=0;u<10;u++)if(Common.Utils.ThemeColor.ThemeValues[u]==this.NegativeColor.effectValue){this.colorsNegative.select(this.NegativeColor,!0),m=!0;break}m||this.colorsNegative.clearSelection()}else this.colorsNegative.select(this.NegativeColor,!0);this._state.NegativeColor=this.NegativeColor,l=!0}l&&this.updateSparkStyles(t.asc_getStyles())}},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this.spnWidth&&this.spnWidth.setValue(null!==this._state.Width?Common.Utils.Metric.fnRecalcFromMM(this._state.Width):"",!0),this.spnHeight&&this.spnHeight.setValue(null!==this._state.Height?Common.Utils.Metric.fnRecalcFromMM(this._state.Height):"",!0)}},UpdateThemeColors:function(){var t;this._initSettings||(this.btnSparkColor||(t=this.defColor,this.btnSparkColor=new Common.UI.ColorButton({parentEl:e("#spark-color-btn"),color:"000000"}),this.lockedControls.push(this.btnSparkColor),this.colorsSpark=this.btnSparkColor.getPicker(),this.btnSparkColor.on("color:select",i.bind(this.onColorsSparkSelect,this)),this.btnHighColor=new Common.UI.ColorButton({parentEl:e("#spark-high-color-btn")}),this.btnHighColor.setColor(this.defColor.color),this.lockedControls.push(this.btnHighColor),this.colorsHigh=this.btnHighColor.getPicker(),this.btnHighColor.on("color:select",i.bind(this.onColorsPointSelect,this,0)),this.btnLowColor=new Common.UI.ColorButton({parentEl:e("#spark-low-color-btn")}),this.btnLowColor.setColor(this.defColor.color),this.lockedControls.push(this.btnLowColor),this.colorsLow=this.btnLowColor.getPicker(),this.btnLowColor.on("color:select",i.bind(this.onColorsPointSelect,this,1)),this.btnNegativeColor=new Common.UI.ColorButton({parentEl:e("#spark-negative-color-btn")}),this.btnNegativeColor.setColor(this.defColor.color),this.lockedControls.push(this.btnNegativeColor),this.colorsNegative=this.btnNegativeColor.getPicker(),this.btnNegativeColor.on("color:select",i.bind(this.onColorsPointSelect,this,2)),this.btnFirstColor=new Common.UI.ColorButton({parentEl:e("#spark-first-color-btn")}),this.lockedControls.push(this.btnFirstColor),this.btnFirstColor.setColor(this.defColor.color),this.colorsFirst=this.btnFirstColor.getPicker(),this.btnFirstColor.on("color:select",i.bind(this.onColorsPointSelect,this,3)),this.btnLastColor=new Common.UI.ColorButton({parentEl:e("#spark-last-color-btn")}),this.btnLastColor.setColor(this.defColor.color),this.lockedControls.push(this.btnLastColor),this.colorsLast=this.btnLastColor.getPicker(),this.btnLastColor.on("color:select",i.bind(this.onColorsPointSelect,this,4)),this.btnMarkersColor=new Common.UI.ColorButton({parentEl:e("#spark-markers-color-btn")}),this.btnMarkersColor.setColor(this.defColor.color),this.lockedControls.push(this.btnMarkersColor),this.colorsMarkers=this.btnMarkersColor.getPicker(),this.btnMarkersColor.on("color:select",i.bind(this.onColorsPointSelect,this,5))),this.colorsSpark.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsHigh.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsLow.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsNegative.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsFirst.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsLast.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsMarkers.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.btnSparkColor.setColor(this.colorsSpark.getColor()),this.btnHighColor.setColor(this.colorsHigh.getColor()),this.btnLowColor.setColor(this.colorsLow.getColor()),this.btnNegativeColor.setColor(this.colorsNegative.getColor()),this.btnFirstColor.setColor(this.colorsFirst.getColor()),this.btnLastColor.setColor(this.colorsLast.getColor()),this.btnMarkersColor.setColor(this.colorsMarkers.getColor()))},createDelayedControls:function(){var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:e("#chart-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnWidth),this.lockedControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:e("#chart-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnHeight),this.lockedControls.push(this.spnHeight),this.spnWidth.on("change",i.bind(this.onWidthChange,this)),this.spnHeight.on("change",i.bind(this.onHeightChange,this)),this.spnWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnRatio=new Common.UI.Button({parentEl:e("#chart-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnRatio),this.btnRatio.on("click",i.bind((function(t,e){if(t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this.api){var i=new Asc.asc_CImgProperty;i.asc_putLockAspect(t.pressed),this.api.asc_setGraphicObjectProps(i)}}),this)),this.btnSparkType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"svgicon chart-spark-column",menu:new Common.UI.Menu({style:"width: 167px;",items:[{template:i.template('<div id="id-spark-menu-type" class="menu-insertchart"></div>')}]})}),this.btnSparkType.on("render:after",(function(n){t.mnuSparkTypePicker=new Common.UI.DataView({el:e("#id-spark-menu-type"),parentMenu:n.menu,restoreHeight:120,allowScrollbar:!1,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getSparkGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getSparkData()),itemTemplate:i.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>'),delayRenderTips:!0})})),this.btnSparkType.render(e("#spark-button-type")),this.mnuSparkTypePicker.on("item:click",i.bind(this.onSelectSparkType,this,this.btnSparkType)),this.lockedControls.push(this.btnSparkType),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#spark-combo-line-type"),style:"width: 90px;",allowNoBorders:!1}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(1).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.chHighPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-high"),labelText:this.textHighPoint}),this.lockedControls.push(this.chHighPoint),this.chPoints.push(this.chHighPoint),this.chLowPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-low"),labelText:this.textLowPoint}),this.lockedControls.push(this.chLowPoint),this.chPoints.push(this.chLowPoint),this.chNegativePoint=new Common.UI.CheckBox({el:e("#spark-checkbox-negative"),labelText:this.textNegativePoint}),this.lockedControls.push(this.chNegativePoint),this.chPoints.push(this.chNegativePoint),this.chFirstPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-first"),labelText:this.textFirstPoint}),this.lockedControls.push(this.chFirstPoint),this.chPoints.push(this.chFirstPoint),this.chLastPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-last"),labelText:this.textLastPoint}),this.lockedControls.push(this.chLastPoint),this.chPoints.push(this.chLastPoint),this.chMarkersPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-markers"),labelText:this.textMarkers}),this.lockedControls.push(this.chMarkersPoint),this.chPoints.push(this.chMarkersPoint),this.chHighPoint.on("change",i.bind(this.onCheckPointChange,this,0)),this.chLowPoint.on("change",i.bind(this.onCheckPointChange,this,1)),this.chNegativePoint.on("change",i.bind(this.onCheckPointChange,this,2)),this.chFirstPoint.on("change",i.bind(this.onCheckPointChange,this,3)),this.chLastPoint.on("change",i.bind(this.onCheckPointChange,this,4)),this.chMarkersPoint.on("change",i.bind(this.onCheckPointChange,this,5)),this.btnChangeType=new Common.UI.Button({parentEl:e("#chart-btn-change-type"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-chart",caption:this.textChangeType,style:"width: 100%;text-align: left;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnChangeType.on("click",i.bind(this.onChangeType,this)),this.lockedControls.push(this.btnChangeType),this.btnSelectData=new Common.UI.Button({parentEl:e("#chart-btn-select-data"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-select-range",caption:this.textSelectData,style:"width: 100%;text-align: left;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSelectData.on("click",i.bind(this.onSelectData,this)),this.lockedControls.push(this.btnSelectData),this.btnSwitch=new Common.UI.Button({parentEl:e("#chart-btn-switch"),cls:"btn-toolbar",iconCls:"toolbar__icon switch_row_column",caption:this.textSwitch,style:"width: 100%;text-align: left;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSwitch.on("click",i.bind(this.onSwitch,this)),this.lockedControls.push(this.btnSwitch),this.linkAdvanced=e("#chart-advanced-link"),e(this.el).on("click","#chart-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls(),this.updateMetricUnit(),this.UpdateThemeColors()},ShowHideElem:function(t){this.ChartSizeContainer.toggleClass("settings-hidden",!t),this.ChartTypesContainer.toggleClass("settings-hidden",!t),this.SparkTypesContainer.toggleClass("settings-hidden",t),this.SparkPointsContainer.toggleClass("settings-hidden",t)},ShowCombinedProps:function(t){this.NotCombinedSettings.toggleClass("settings-hidden",null===t||t==Asc.c_oAscChartTypeSettings.comboBarLine||t==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||t==Asc.c_oAscChartTypeSettings.comboAreaBar||t==Asc.c_oAscChartTypeSettings.comboCustom)},onWidthChange:function(t,e,i,n){var o=t.getNumberValue(),s=this.spnHeight.getNumberValue();if(this.btnRatio.pressed&&((s=o/this._nRatio)>this.spnHeight.options.maxValue&&(o=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(o,!0)),this.spnHeight.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(o)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(a)}},onHeightChange:function(t,e,i,n){var o=t.getNumberValue(),s=this.spnWidth.getNumberValue();if(this.btnRatio.pressed&&((s=o*this._nRatio)>this.spnWidth.options.maxValue&&(o=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(o,!0)),this.spnWidth.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(o)),this.api.asc_setGraphicObjectProps(a)}},openAdvancedSettings:function(){if(!this.linkAdvanced.hasClass("disabled")){var t,e=this;e.api&&(t=e.isChart?e.api.asc_getChartObject():e._originalProps)&&new SSE.Views.ChartSettingsDlg({chartSettings:t,imageSettings:e.isChart?e._originalProps:null,sparklineStyles:e.sparklineStyles,isChart:e.isChart,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.isChart?(e.api.asc_editChartDrawingObject(i.chartSettings),i.imageSettings&&e.api.asc_setGraphicObjectProps(i.imageSettings)):e.api.asc_setSparklineGroup(e._state.SparkId,i.chartSettings)),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},onSelectData_simple:function(){var t=this;if(t.api){var e=t.api.asc_getChartObject(),n=new SSE.Views.CellRangeDialog({handler:function(i,n){"ok"==n&&(e.putRange(i.getSettings()),t.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None),t.api.asc_editChartDrawingObject(e)),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).on("close",(function(){t.api.asc_onCloseChartFrame()}));n.show(),n.setSettings({api:t.api,range:e.getRange(),validation:function(n){var o;return i.isEmpty(n)?"":(o=t.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,n,!0,e.getInRows(),t._state.ChartType))==Asc.c_oAscError.ID.No||(o==Asc.c_oAscError.ID.StockChartError?this.errorStockChart:o==Asc.c_oAscError.ID.MaxDataSeriesError?this.errorMaxRows:this.txtInvalidRange)},type:Asc.c_oAscSelectionDialogType.Chart})}},onSelectData:function(){var t,e=this;e.api&&((t=e.api.asc_getChartObject())&&(e._isEditRanges=!0,t.startEdit(),new SSE.Views.ChartDataDialog({chartSettings:t,api:e.api,handler:function(i,n){"ok"==i&&(t.endEdit(),e._isEditRanges=!1),Common.NotificationCenter.trigger("edit:complete",e)}}).on("close",(function(){e._isEditRanges&&t.cancelEdit(),e._isEditRanges=!1})).show()))},onChangeType:function(){var t,e=this;e.api&&((t=e.api.asc_getChartObject())&&(e._isEditType=!0,t.startEdit(),new SSE.Views.ChartTypeDialog({chartSettings:t,api:e.api,handler:function(i,n){"ok"==i&&(t.endEdit(),e._isEditType=!1,e._props&&e.ChangeSettings(e._props)),Common.NotificationCenter.trigger("edit:complete",e)}}).on("close",(function(){e._isEditType&&t.cancelEdit(),e._isEditType=!1,e._props=null})).show()))},onSelectStyle:function(t,e){if(!this._noApply){if(this.api&&!this._noApply&&this.chartProps){var i=new Asc.asc_CImgProperty;this.chartProps.putStyle(e.get("data")),i.asc_putChartProperties(this.chartProps),this.api.asc_setGraphicObjectProps(i)}Common.NotificationCenter.trigger("edit:complete",this)}},selectCurrentChartStyle:function(){if(this.cmbChartStyle){this.cmbChartStyle.suspendEvents();var t,e=this.cmbChartStyle.menuPicker.store.findWhere({data:this._state.ChartStyle});if(this.cmbChartStyle.menuPicker.selectRecord(e),this.cmbChartStyle.resumeEvents(),this._isChartStylesChanged)if((t=e?this.cmbChartStyle.fillComboView(this.cmbChartStyle.menuPicker.getSelectedRec(),!0):this.cmbChartStyle.fillComboView(this.cmbChartStyle.menuPicker.store.at(0),!0))&&t.length>0){var n=[];return i.each(t,(function(t,e){n.push(t.get("data"))})),n}}},onAddChartStylesPreview:function(t){if(!this._isEditType&&this.cmbChartStyle&&t&&t.length>0){var e=this.cmbChartStyle.menuPicker.store;e&&i.each(t,(function(t,i){var n=e.findWhere({data:t.asc_getName()});n&&n.set("imageUrl",t.asc_getImage())}))}},_onUpdateChartStyles:function(){this.api&&null!==this._state.ChartType&&this._state.ChartType>-1&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboBarLine&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboAreaBar&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboCustom&&(this.updateChartStyles(this.api.asc_getChartPreviews(this._state.ChartType,void 0,!0)),this.api.asc_generateChartPreviews(this._state.ChartType,this.selectCurrentChartStyle()))},updateChartStyles:function(t){var n=this;if(this._isChartStylesChanged=!0,this.cmbChartStyle||(this.cmbChartStyle=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:270,enableKeyEvents:!0,cls:"combo-chart-style",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",delayRenderTips:!0}),this.cmbChartStyle.render(e("#chart-combo-style")),this.cmbChartStyle.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbChartStyle.on("click",i.bind(this.onSelectStyle,this)),this.cmbChartStyle.openButton.menu.on("show:after",(function(){n.cmbChartStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbChartStyle)),t&&t.length>0){var o=this.cmbChartStyle.menuPicker.store;if(o){var s=[];i.each(t,(function(t,e){s.push({imageUrl:t.asc_getImage(),data:t.asc_getName(),tip:n.textStyle+" "+t.asc_getName()})})),o.reset(s,{silent:!1})}}else this.cmbChartStyle.menuPicker.store.reset(),this.cmbChartStyle.clearComboView();this.cmbChartStyle.setDisabled(!t||t.length<1||this._locked)},updateSparkStyles:function(t){var n=this;if(this.cmbSparkStyle||(this.cmbSparkStyle=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:272,enableKeyEvents:!0,cls:"combo-spark-style",delayRenderTips:!0}),this.cmbSparkStyle.render(e("#spark-combo-style")),this.cmbSparkStyle.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbSparkStyle.on("click",i.bind(this.onSelectSparkStyle,this)),this.cmbSparkStyle.openButton.menu.on("show:after",(function(){n.cmbSparkStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbSparkStyle)),t&&t.length>1){var o=this.cmbSparkStyle.menuPicker.store,s=t[t.length-1];if(this.sparklineStyles=t,o.length==t.length-1){for(var a=o.models,l=0;l<t.length-1;l++)a[l].set("imageUrl",t[l]);s<0?(this.cmbSparkStyle.fillComboView(o.at(0),!1),this.cmbSparkStyle.fieldPicker.deselectAll(),this.cmbSparkStyle.menuPicker.deselectAll()):this.cmbSparkStyle.menuPicker.selectRecord(o.at(s))}else{var r=[];for(l=0;l<t.length-1;l++)r.push({imageUrl:t[l],data:l});o.reset(r,{silent:!1}),this.cmbSparkStyle.fillComboView(o.at(s<0?0:s),s>-1)}}},onSelectSparkType:function(t,e,n,o){var s={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;s=o.toJSON()}else s=o;if(this.btnSparkType.setIconCls("svgicon chart-"+s.iconCls),this._state.SparkType=-1,this.api&&!this._noApply&&this._originalProps){var a=new Asc.sparklineGroup;a.asc_setType(s.type),this.api.asc_setSparklineGroup(this._state.SparkId,a)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectSparkStyle:function(t,e){if(!this._noApply){if(this.api&&!this._noApply&&this._originalProps){var i=new Asc.sparklineGroup;i.asc_setStyle(e.get("data")),this.api.asc_setSparklineGroup(this._state.SparkId,i)}Common.NotificationCenter.trigger("edit:complete",this)}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?1:Math.max(.01,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply&&this._originalProps){var e=new Asc.sparklineGroup;e.asc_setLineWeight(this.BorderSize),this.api.asc_setSparklineGroup(this._state.SparkId,e),Common.NotificationCenter.trigger("edit:complete",this)}},onBorderSizeChanged:function(t,e,n,o){var s=this;if(t){var a=parseFloat(n.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(n.value)||a<.01||a>1584)&&(this._state.LineWeight=-1,setTimeout((function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}})}),10))}else this.applyBorderSize(n.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onColorsSparkSelect:function(t,e){if(this.api&&!this._noApply&&this._originalProps){var i=new Asc.sparklineGroup;i.asc_setColorSeries(Common.Utils.ThemeColor.getRgbColor(e)),this.api.asc_setSparklineGroup(this._state.SparkId,i)}Common.NotificationCenter.trigger("edit:complete",this)},onCheckPointChange:function(t,e,i,n,o){if(this.api&&!this._noApply&&this._originalProps){var s=new Asc.sparklineGroup;switch(t){case 0:s.asc_setHighPoint("checked"==e.getValue());break;case 1:s.asc_setLowPoint("checked"==e.getValue());break;case 2:s.asc_setNegativePoint("checked"==e.getValue());break;case 3:s.asc_setFirstPoint("checked"==e.getValue());break;case 4:s.asc_setLastPoint("checked"==e.getValue());break;case 5:s.asc_setMarkersPoint("checked"==e.getValue())}this.api.asc_setSparklineGroup(this._state.SparkId,s)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsPointSelect:function(t,e,i){if("checked"!==this.chPoints[t].getValue()&&this.chPoints[t].setValue(!0,!0),this.api&&!this._noApply&&this._originalProps){var n=new Asc.sparklineGroup;switch(t){case 0:n.asc_setHighPoint(!0),n.asc_setColorHigh(Common.Utils.ThemeColor.getRgbColor(i));break;case 1:n.asc_setLowPoint(!0),n.asc_setColorLow(Common.Utils.ThemeColor.getRgbColor(i));break;case 2:n.asc_setNegativePoint(!0),n.asc_setColorNegative(Common.Utils.ThemeColor.getRgbColor(i));break;case 3:n.asc_setFirstPoint(!0),n.asc_setColorFirst(Common.Utils.ThemeColor.getRgbColor(i));break;case 4:n.asc_setLastPoint(!0),n.asc_setColorLast(Common.Utils.ThemeColor.getRgbColor(i));break;case 5:n.asc_setMarkersPoint(!0),n.asc_setColorMarkers(Common.Utils.ThemeColor.getRgbColor(i))}this.api.asc_setSparklineGroup(this._state.SparkId,n)}Common.NotificationCenter.trigger("edit:complete",this)},onSwitch:function(){if(this.api){var t=this.api.asc_getChartObject(!0);if(t)t.startEdit(),t.switchRowCol()===Asc.c_oAscError.ID.MaxDataSeriesError?(t.cancelEdit(),Common.UI.warning({msg:this.errorMaxRows,maxwidth:600})):t.endEdit()}},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textEditData:"Edit Data and Location",textChartType:"Change Chart Type",textStyle:"Style",textAdvanced:"Show advanced settings",strSparkColor:"Color",strLineWeight:"Line Weight",textMarkers:"Markers",textHighPoint:"High Point",textLowPoint:"Low Point",textNegativePoint:"Negative Point",textFirstPoint:"First Point",textLastPoint:"Last Point",strTemplate:"Template",textShow:"Show",textType:"Type",textSelectData:"Select Data",textRanges:"Data Range",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt.",textChangeType:"Change type",textSwitch:"Switch Row/Column",errorMaxRows:"The maximum number of data series per chart is 255."},SSE.Views.ChartSettings||{}))})),define("text!spreadsheeteditor/main/app/template/ShapeSettings.template",[],(function(){return'<table cols="1">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strFill %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="shape-combo-fill-src" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div id="shape-panel-color-fill" class="padding-small" style="width: 100%;">\r\n                <div id="shape-back-color-btn" style=""></div>\r\n            </div>\r\n            <div id="shape-panel-image-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="2" style="width: 100%;">\r\n                <tr>\r\n                    <td colspan="2" class="padding-small">\r\n                        <div id="shape-button-replace" style="width:100%;"></div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: top">\r\n                        <div id="shape-combo-fill-type" style="width: 90px;"></div>\r\n                    </td>\r\n                    <td rowspan="2">\r\n                        <div style="width: 90px; height: 80px; padding: 14px 20px; border: 1px solid #AFAFAF; border-radius: 2px; background: #ffffff;float:right;">\r\n                            <div id="shape-texture-img" style="width: 50px;height: 50px;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: bottom">\r\n                        <label class="input-label" style=""><%= scope.textTexture %></label>\r\n                        <div id="shape-combo-fill-texture" style="width: 90px;"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id="shape-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <label class="input-label" style="margin-top: 3px;"><%= scope.strPattern %></label>\r\n                <div id="shape-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\r\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strForeground %></label>\r\n                    <div id="shape-foreground-color-btn" style="display: inline-block; float:right;"></div>\r\n                </div>\r\n                <div style="width: 100%; height: 25px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strBackground %></label>\r\n                    <div id="shape-background-color-btn" style="display: inline-block; float:right;"></div>\r\n                </div>\r\n            </div>\r\n            <div id="shape-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="3" style="margin-bottom: 10px;">\r\n                    <tr valign="top">\r\n                        <td colspan="2">\r\n                            <div>\r\n                                <label class="input-label" style=""><%= scope.textStyle %></label>\r\n                                <div id="shape-combo-grad-type" style="width: 100%;"></div>\r\n                            </div>\r\n                        </td>\r\n                        <td rowspan="2" style="width: 100%;">\r\n                            <div style="float: right;">\r\n                                <label class="input-label"><%= scope.textDirection %></label>\r\n                                <div id="shape-button-direction"></div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr valign="bottom">\r\n                        <td>\r\n                            <label class="input-label" style="margin-right: 5px;margin-bottom: 3px;"><%= scope.textAngle %></label>\r\n                        </td>\r\n                        <td>\r\n                            <div id="shape-spin-gradient-angle" style="display: inline-block; width: 60px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <label class="input-label" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <div id="shape-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\r\n                </div>\r\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\r\n                    <div style="display: flex;">\r\n                    <div style="">\r\n                        <label class="input-label" style=""><%= scope.strColor %></label>\r\n                        <div id="shape-gradient-color-btn"></div>\r\n                    </div>\r\n                    <div style="margin-left: 10px;">\r\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\r\n                        <div id="shape-gradient-position"></div>\r\n                    </div>\r\n                    </div>\r\n                    <div style="display:flex;padding-top:15px;">\r\n                        <div id="shape-gradient-add-step"></div>\r\n                        <div id="shape-gradient-remove-step"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="shape-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="shape-lbl-transparency-start">0</label>\r\n                    <div id="shape-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="shape-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="shape-spin-transparency" style="display: inline-block;float: right;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strStroke %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strSize %></label>\r\n            <div id="shape-combo-border-size" style="width: 93px;"></div>\r\n        </div>\r\n        <div style="display:inline-block;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strColor %></label>\r\n            <div id="shape-border-color-btn" style=""></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strType %></label>\r\n            <div id="shape-combo-border-type" style="width: 93px;"></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-rotation">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-rotation">\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-rotation">\r\n        <td>\r\n            <table cols="2" style="width: 100%;">\r\n                <tr>\r\n                    <td class="padding-small" width="50%">\r\n                        <label class="input-label"><%= scope.textRotate90 %></label>\r\n                        <div>\r\n                            <div id="shape-button-270" style="display: inline-block;margin-right: 4px;"></div>\r\n                            <div id="shape-button-90" style="display: inline-block;"></div>\r\n                        </div>\r\n                    </td>\r\n                    <td class="padding-small" width="50%">\r\n                        <label class="input-label"><%= scope.textFlip %></label>\r\n                        <div>\r\n                            <div id="shape-button-fliph" style="display: inline-block;margin-right: 4px;"></div>\r\n                            <div id="shape-button-flipv" style="display: inline-block;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td class="padding-small">\r\n            <label class="header" style="margin-top: 3px;"><%= scope.strChange %></label>\r\n            <div id="shape-btn-change" style="display: inline-block; float:right;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="shape-checkbox-shadow"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td align="center">\r\n            <label class="link" id="shape-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),void 0===Common)var Common={};if(define("common/main/lib/component/ComboBorderSize",["common/main/lib/component/ComboBox"],(function(){"use strict";Common.UI.BordersModel=Backbone.Model.extend({defaults:function(){return{value:null,displayValue:null,pxValue:null,id:Common.UI.getId(),offsety:void 0}}}),Common.UI.BordersStore=Backbone.Collection.extend({model:Common.UI.BordersModel}),Common.UI.ComboBorderSize=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">','<i class="image"></i>','<span class="text"></span>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">',"<span><%= item.displayValue %></span>","<% if (item.offsety!==undefined) { %>",'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="right" style="background-position: 0 -<%= item.offsety %>px;">',"<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),i=[{displayValue:"0.5 "+e,value:.5,pxValue:.5,offsety:0},{displayValue:"1 "+e,value:1,pxValue:1,offsety:20},{displayValue:"1.5 "+e,value:1.5,pxValue:2,offsety:40},{displayValue:"2.25 "+e,value:2.25,pxValue:3,offsety:60},{displayValue:"3 "+e,value:3,pxValue:4,offsety:80},{displayValue:"4.5 "+e,value:4.5,pxValue:5,offsety:100},{displayValue:"6 "+e,value:6,pxValue:6,offsety:120}];!1!==t.allowNoBorders&&i.unshift({displayValue:this.txtNoBorders,value:0,pxValue:0}),Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!1,store:new Common.UI.BordersStore,data:i,menuStyle:"min-width: 160px;"},t))},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this._formControl=this.cmpEl.find(".form-control"),this},itemClicked:function(t){var e=$(t.currentTarget).parent();this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault())},updateFormControl:function(t){var e=$(this.el).find(".form-control"),i=e.find("> .image"),n=e.find("> .text");t.get("value")>0?(i.css("background-position","10px -"+t.get("offsety")+"px").show(),n.hide()):(i.hide(),n.text(this.txtNoBorders).show())},setValue:function(t){this._selectedItem=null==t?void 0:_.find(this.store.models,(function(e){if(t<e.attributes.value+.01&&t>e.attributes.value-.01)return!0})),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem?(this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")):$(this.el).find(".form-control > .text").text("").show()},focus:function(){this._formControl&&this._formControl.focus()},txtNoBorders:"No Borders"},Common.UI.ComboBorderSize||{})),Common.UI.ComboBorderSizeEditable=Common.UI.ComboBox.extend(_.extend({template:_.template(['<span class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control text" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">',"<span><%= item.displayValue %></span>","<% if (item.offsety!==undefined) { %>",'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="right" style="background-position: 0 -<%= item.offsety %>px;">',"<% } %>","</a></li>","<% }); %>","</ul>","</span>"].join("")),initialize:function(t){this.txtNoBorders=t.txtNoBorders||this.txtNoBorders;var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),i=[{displayValue:"0.5 "+e,value:.5,pxValue:.5,offsety:0},{displayValue:"1 "+e,value:1,pxValue:1,offsety:20},{displayValue:"1.5 "+e,value:1.5,pxValue:2,offsety:40},{displayValue:"2.25 "+e,value:2.25,pxValue:3,offsety:60},{displayValue:"3 "+e,value:3,pxValue:4,offsety:80},{displayValue:"4.5 "+e,value:4.5,pxValue:5,offsety:100},{displayValue:"6 "+e,value:6,pxValue:6,offsety:120}];!1!==t.allowNoBorders&&i.unshift({displayValue:this.txtNoBorders,value:0,pxValue:0}),Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!0,store:new Common.UI.BordersStore,data:i,menuStyle:"min-width: 160px;"},t))},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this},txtNoBorders:"No Borders"},Common.UI.ComboBorderSizeEditable||{})),Common.UI.ComboBorderType=Common.UI.ComboBorderSize.extend(_.extend({template:_.template(['<div class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">','<i class="image"></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem" style="padding: 2px 0 2px 10px;">','<span style="margin-top: 0;"></span>',"<% if (item.offsety!==undefined) { %>",'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="left" style="background-position: 0 -<%= item.offsety %>px;">',"<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){Common.UI.ComboBorderSize.prototype.initialize.call(this,_.extend({store:new Common.UI.BordersStore,data:[{value:Asc.c_oDashType.solid,offsety:140},{value:Asc.c_oDashType.sysDot,offsety:160},{value:Asc.c_oDashType.sysDash,offsety:180},{value:Asc.c_oDashType.dash,offsety:200},{value:Asc.c_oDashType.dashDot,offsety:220},{value:Asc.c_oDashType.lgDash,offsety:240},{value:Asc.c_oDashType.lgDashDot,offsety:260},{value:Asc.c_oDashType.lgDashDotDot,offsety:280}]},t))},render:function(t){return Common.UI.ComboBorderSize.prototype.render.call(this,t),this},updateFormControl:function(t){t?$(this.el).find(".form-control > .image").css("background-position","10px -"+t.get("offsety")+"px").show():$(this.el).find(".form-control > .image").hide()},setValue:function(t){this._selectedItem=null==t?void 0:_.find(this.store.models,(function(e){if(t<e.attributes.value+.01&&t>e.attributes.value-.01)return!0})),$(".selected",$(this.el)).removeClass("selected"),this.updateFormControl(this._selectedItem),this._selectedItem&&$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")}},Common.UI.ComboBorderType||{})),Common.UI.ComboBoxColor=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-color input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="padding:2px 14px 2px 3px; <%= style %> display: block;">','<div style="display: inline-block;overflow: hidden;width: 100%;height: 100%;"></div>',"</div>",'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;"><div style="height: 15px;<%= item.styleStr %>"><%= scope.getDisplayValue(item) %></div></a>',"</li>","<% } %>","<% }); %>","</ul>","</div>"].join("")),itemClicked:function(t){var e=$(t.currentTarget).parent();this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault())},updateFormControl:function(t){var e=$(this.el).find(".form-control > div");e[0].innerHTML=t.get("displayValue"),-1!=t.get("value")?(e.css({"margin-top":"0"}),e.css(t.get("styleObj"))):(e.css({"margin-top":"1px"}),e.css(t.get("styleObj")))},setValue:function(t){var e;if(this._selectedItem=this.store.findWhere(((e={})[this.valueField]=t,e)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem)this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected");else{var i=$(this.el).find(".form-control > div");i[0].innerHTML=t,i.css("margin-top","1px"),i.css({color:"","text-align":"",background:"",border:""})}},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;"><div style="height: 15px;<%= item.styleStr %>"><%= scope.getDisplayValue(item) %></div></a>',"</li>","<% } %>","<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))}},Common.UI.ComboBoxColor||{})),Common.UI.ComboBoxIcons=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-color input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="padding:2px 0 2px 3px; <%= style %> display: block;">','<div style="display: inline-block;overflow: hidden;width: 100%;height: 100%;"></div>',"</div>",'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;">',"<% _.each(item.data.iconSet, function(icon) { %>",'<img src="<%= item.data.icons.at(icon-1).get(\'icon\') %>" style="width:16px;height:16px;margin-right: 5px;">',"<% }) %>","</a>","</li>","<% } %>","<% }); %>","</ul>","</div>"].join("")),itemClicked:function(t){var e=$(t.currentTarget).parent();this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),e.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault())},updateFormControl:function(t){var e=$(this.el).find(".form-control > div");if(-1!=t.get("value")){var i="";_.each(t.get("data").iconSet,(function(e){i+='<img src="'+t.get("data").icons.at(e-1).get("icon")+'" style="width:16px;height:16px;margin-right: 5px;">'})),e[0].innerHTML=i,e.css({"margin-top":"0"})}else e[0].innerHTML=t.get("displayValue"),e.css({"margin-top":"1px"})},setValue:function(t){var e;if(this._selectedItem=this.store.findWhere(((e={})[this.valueField]=t,e)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem)this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected");else{var i=$(this.el).find(".form-control > div");i[0].innerHTML=t,i.css({"margin-top":"1px"})}},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding: 5px;">',"<% _.each(item.data.iconSet, function(icon) { %>",'<img src="<%= item.data.icons.at(icon-1).get(\'icon\') %>" style="width:16px;height:16px;margin-right: 5px;">',"<% }) %>","</a>","</li>","<% } %>","<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))}},Common.UI.ComboBoxIcons||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/Slider",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.SingleSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,step:1,value:100,enableKeyEvents:!1,direction:"horizontal"},disabled:!1,template:e.template(['<div class="slider single-slider <% if (this.options.direction === \'vertical\') { %>vertical<% } %>" style="">','<div class="track"></div>','<div class="thumb" style=""></div>',"<% if (this.options.enableKeyEvents) { %>",'<input type="text" style="position: absolute; top:-10px; width: 1px; height: 1px;">',"<% } %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.width=e.options.width,e.minValue=e.options.minValue,e.maxValue=e.options.maxValue,e.delta=100/(e.maxValue-e.minValue),e.step=e.options.step,e.direction=e.options.direction,e.options.el&&e.render(),this.setValue(e.options.value)},render:function(t){var i=this;i.rendered?this.cmpEl=i.$el:(this.cmpEl=$(this.template({})),t?(this.setElement(t,!1),t.html(this.cmpEl)):i.$el.html(this.cmpEl)),this.cmpEl.find(".track-center").width(i.options.width-14),this.cmpEl["vertical"===i.direction?"height":"width"](i.options.width),this.thumb=this.cmpEl.find(".thumb");var n,o=function(t){t.preventDefault(),t.stopPropagation();var e=Math.max(0,Math.min(100,Math.round(("vertical"===i.direction?t.pageY*Common.Utils.zoom()-i.cmpEl.offset().top:t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,i.thumb.removeClass("active"),$(document).off("mouseup",o),$(document).off("mousemove",s),i._dragstart=void 0,i.trigger("changecomplete",i,i.value,i.lastValue)},s=function(t){if(!i.disabled&&void 0!==i._dragstart){t.preventDefault(),t.stopPropagation();var e=Math.max(0,Math.min(100,Math.round(("vertical"===i.direction?t.pageY*Common.Utils.zoom()-i.cmpEl.offset().top:t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,Math.abs(i.value-i.lastValue)>.001&&i.trigger("change",i,i.value,i.lastValue)}},a=function(t){i.lastValue=i.value,i.value=Math.max(i.minValue,Math.min(i.maxValue,i.value+(t?i.step:-i.step))),i.setThumbPosition(Math.round((i.value-i.minValue)*i.delta)),i.trigger("change",i,i.value,i.lastValue)},l=function(t){i.disabled||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN&&t.keyCode!=Common.UI.Keys.LEFT&&t.keyCode!=Common.UI.Keys.RIGHT||(t.preventDefault(),t.stopPropagation(),r.off("keydown","input",l),n=setInterval(e.bind(a,i,t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.RIGHT),100))};if(!i.rendered){var r=i.cmpEl;r.on("mousedown",".thumb",(function(t){i.disabled||(i._dragstart="vertical"===i.direction?t.pageY*Common.Utils.zoom()-i.thumb.offset().top:t.pageX*Common.Utils.zoom()-i.thumb.offset().left-7,i.thumb.addClass("active"),$(document).on("mouseup",o),$(document).on("mousemove",s),i.options.enableKeyEvents&&setTimeout((function(){i.input.focus()}),10))})),r.on("mousedown",".track",(function(t){if(!i.disabled){var e=Math.max(0,Math.min(100,Math.round(("vertical"===i.direction?t.pageY*Common.Utils.zoom()-i.cmpEl.offset().top:t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,i.trigger("change",i,i.value,i.lastValue),i.trigger("changecomplete",i,i.value,i.lastValue)}})),this.options.enableKeyEvents&&(r.on("keydown","input",l),r.on("keyup","input",(function(t){i.disabled||(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN||Common.UI.Keys.LEFT||Common.UI.Keys.RIGHT)&&(t.stopPropagation(),t.preventDefault(),clearInterval(n),a(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.RIGHT),r.on("keydown","input",l),i.trigger("changecomplete",i,i.value,i.lastValue))})))}return i.rendered=!0,this},setThumbPosition:function(t){"vertical"===this.direction?this.thumb.css({top:t+"%"}):this.thumb.css({left:t+"%"})},setValue:function(t){this.lastValue=this.value,this.value=Math.max(this.minValue,Math.min(this.maxValue,t)),this.setThumbPosition(Math.round((t-this.minValue)*this.delta))},getValue:function(){return this.value},setDisabled:function(t){(t=!!t)!==this.disabled&&this.cmpEl.toggleClass("disabled",t),this.disabled=t}}),Common.UI.MultiSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],includeSnap:!1,intervalSnap:void 0,thumbTemplate:'<div class="thumb" style=""></div>'},disabled:!1,template:e.template(['<div class="slider multi-slider">','<div class="track">','<div class="track-left"></div>','<div class="track-center""></div>','<div class="track-right" style=""></div>',"</div>","<% _.each(items, function(item) { %>","<%= thumbTemplate %>","<% }); %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.width=e.options.width,e.minValue=e.options.minValue,e.maxValue=e.options.maxValue,e.delta=100/(e.maxValue-e.minValue),e.includeSnap=e.options.includeSnap,e.intervalSnap=e.options.intervalSnap,e.thumbs=[],e.options.el&&e.render()},render:function(t){var i=this;i.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({items:this.options.values,thumbTemplate:this.options.thumbTemplate})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl));var n=this.cmpEl;n.find(".track-center").width(i.options.width-14),n.width(i.options.width);var o=function(t){i.includeSnap&&e.each(i.centers,(function(e){t.pageX<=e+i.intervalSnap&&t.pageX>=e-i.intervalSnap&&(t.pageX=e)}))},s=function(t){for(var e,n=100,o=0,s=i.thumbs.length,a=0;a<s;a++)if(e=Math.abs(i.thumbs[a].position-t),Math.abs(e<=n)){var l=i.thumbs[a+1],r=i.thumbs[a-1];if(void 0!==r&&t<r.position)continue;if(void 0!==l&&t>l.position)continue;o=a,n=e}return o};return this.binding={onMouseUp:e.bind((function(t){t.preventDefault(),t.stopPropagation(),o(t);var n=t.data.index,s=i.thumbs[n].value,a=n-1<0?0:i.thumbs[n-1].position,l=n+1<i.thumbs.length?i.thumbs[n+1].position:100,r=Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100),c=r<a||r>l,d=Math.max(0,Math.min(100,r)),h=d/i.delta+i.minValue;i.thumbs.length<3&&(i.isRemoveThumb=!1),i.isRemoveThumb?(i.trigger("removethumb",i,e.findIndex(i.thumbs,{index:n})),i.trigger("change",i,h,s),i.trigger("changecomplete",i,h,s)):(i.setThumbPosition(n,d),i.thumbs[n].value=h,c&&i.sortThumbs()),$(document).off("mouseup",i.binding.onMouseUp),$(document).off("mousemove",i.binding.onMouseMove),i._dragstart=void 0,!i.isRemoveThumb&&i.trigger("changecomplete",i,h,s),i.isRemoveThumb=void 0}),this),onMouseMove:e.bind((function(t){if(!i.disabled&&void 0!==i._dragstart){t.preventDefault(),t.stopPropagation(),o(t);var e=t.data.index,n=i.thumbs[e].value,s=e-1<0?0:i.thumbs[e-1].position,a=e+1<i.thumbs.length?i.thumbs[e+1].position:100,l=Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left-i._dragstart)/i.width*100),r=l<s||l>a,c=Math.max(0,Math.min(100,l)),d=c/i.delta+i.minValue;i.setThumbPosition(e,c),i.thumbs[e].value=d,r&&i.sortThumbs();var h=t.pageY*Common.Utils.zoom()-i.cmpEl.offset().top;i.isRemoveThumb=h>i.cmpEl.height()||h<0,i.setRemoveThumb(e,i.isRemoveThumb),Math.abs(d-n)>.001&&i.trigger("change",i,d,n)}}),this),onMouseDown:e.bind((function(t){if(!i.disabled){var n=t.data.index,o=i.thumbs[n].thumb;i._dragstart=t.pageX*Common.Utils.zoom()-o.offset().left-o.width()/2,function(t){if(i.includeSnap){var n=i.minValue,o=function(t){return(.01*i.width*t+i.cmpEl.offset().left+i._dragstart)/Common.Utils.zoom()};i.centers=[],e.each(i.thumbs,(function(e,s){s!=t&&n!=e.position&&(i.centers.push(o((e.position-n)/2+n)),n=e.position)})),n!=i.maxValue&&i.centers.push(o((i.maxValue-n)/2+n))}}(n),i.setActiveThumb(n),e.each(i.thumbs,(function(t,e){n==e?t.thumb.css("z-index",500):t.thumb.css("z-index","")})),$(document).on("mouseup",null,t.data,i.binding.onMouseUp),$(document).on("mousemove",null,t.data,i.binding.onMouseMove)}}),this)},this.$thumbs=n.find(".thumb"),e.each(this.$thumbs,(function(t,e){var n=$(t);i.thumbs.push({thumb:n,index:e}),i.setValue(e,i.options.values[e]),n.on("mousedown",null,i.thumbs[e],i.binding.onMouseDown)})),i.setActiveThumb(0,!0),i.rendered||n.on("mouseup",".track",(function(t){if(!(i.disabled||!e.isUndefined(i._dragstart)||i.thumbs.length>9)){var n=Math.max(0,Math.min(100,Math.round((t.pageX*Common.Utils.zoom()-i.cmpEl.offset().left)/i.width*100))),o=s(n),a=(i.thumbs[o].colorValue,i.thumbs[o].value,n/i.delta+i.minValue);i.addThumb();var l=i.thumbs.length-1;i.setThumbPosition(l,n),i.thumbs[l].value=a,i.trigger("addthumb",i,l,n),i.trigger("change",i),i.trigger("changecomplete",i)}})),i.rendered=!0,this},setActiveThumb:function(t,e){this.currentThumb=t,this.$thumbs=this.cmpEl.find(".thumb"),this.$thumbs.removeClass("active"),this.thumbs[t].thumb.addClass("active"),!0!==e&&this.trigger("thumbclick",this,t)},setRemoveThumb:function(t,i){-1!==e.findIndex(this.thumbs,{index:t})&&(i&&this.thumbs.length>2?this.$el.find(".active").addClass("remove"):this.$el.find(".remove").removeClass("remove"))},setThumbPosition:function(t,e){this.thumbs[t].position=e,this.thumbs[t].thumb.css({left:e+"%"})},setValue:function(t,e){this.thumbs[t].value=Math.max(this.minValue,Math.min(this.maxValue,e)),this.setThumbPosition(t,Math.round((e-this.minValue)*this.delta))},getValue:function(t){return this.thumbs[t].value},getValues:function(){var t=[];return e.each(this.thumbs,(function(e){t.push(e.value)})),t},setDisabled:function(t){(t=!!t)!==this.disabled&&this.cmpEl.toggleClass("disabled",t),this.disabled=t},sortThumbs:function(){this.thumbs.sort((function(t,e){return t.position-e.position}));var t=[];return e.each(this.thumbs,(function(e,i){t.push(e.index),e.index=i})),t},setThumbs:function(t){var e=this.thumbs.length;if(e!=t)for(var i=0;i<Math.abs(t-e);i++)e<t?this.addThumb():this.removeThumb()},addThumb:function(){var t=this.cmpEl,e=$(this.options.thumbTemplate),i=this.thumbs.length;t.append(e),this.thumbs.push({thumb:e,index:i}),i>0&&this.setValue(i,this.getValue(i-1)),e.on("mousedown",null,this.thumbs[i],this.binding.onMouseDown)},removeThumb:function(t){void 0===t&&(t=this.thumbs.length-1),t>0&&(this.thumbs[t].thumb.remove(),this.thumbs.splice(t,1))}})})),void 0===Common)var Common={};define("common/main/lib/component/MultiSliderGradient",["common/main/lib/component/Slider","underscore"],(function(t,e){"use strict";Common.UI.MultiSliderGradient=Common.UI.MultiSlider.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],colorValues:["#000000","#ffffff"],currentThumb:0,includeSnap:!0,intervalSnap:5,thumbTemplate:'<div class="thumb" style=""><div class="thumb-top"><div class="thumb-top-inner"></div></div><div class="thumb-bottom"><div class="thumb-bottom-inner"></div></div></div>'},disabled:!1,template:e.template(['<div class="slider multi-slider-gradient">','<div class="track"></div>',"<% _.each(items, function(item) { %>","<%= thumbTemplate %>","<% }); %>","</div>"].join("")),initialize:function(t){this.styleStr={},Common.UI.MultiSlider.prototype.initialize.call(this,t)},render:function(t){Common.UI.MultiSlider.prototype.render.call(this,t);var i=this;i.trackEl=i.cmpEl.find(".track");for(var n=0;n<i.thumbs.length;n++)i.thumbs[n].thumb.on("dblclick",null,(function(){i.trigger("thumbdblclick",i)})),i.thumbs[n].thumbcolor=i.thumbs[n].thumb.find("> div"),i.setColorValue(i.options.colorValues[n],n);i.changeSliderStyle(),i.changeGradientStyle(),i.on("change",e.bind(i.changeGradientStyle,i))},setColorValue:function(t,e){var i=void 0!==e?e:this.currentThumb;this.thumbs[i].colorValue=t,this.thumbs[i].thumbcolor.css("background-color",t),this.changeGradientStyle()},getColorValue:function(t){var e=void 0!==t?t:this.currentThumb;return this.thumbs[e].colorValue},setValue:function(t,e){Common.UI.MultiSlider.prototype.setValue.call(this,t,e),this.changeGradientStyle()},getColorValues:function(){var t=[];return e.each(this.thumbs,(function(e){t.push(e.colorValue)})),t},changeGradientStyle:function(){var t;this.rendered&&(this.styleStr.specific&&(t=Common.Utils.String.format(this.styleStr.specific,this.getColorValues().concat(this.getValues())),this.trackEl.css("background",t)),Common.Utils.isIE&&(t=Common.Utils.String.format("progid:DXImageTransform.Microsoft.gradient( startColorstr={0}, endColorstr={1},GradientType=1 )",this.getColorValue(0),this.getColorValue(this.thumbs.length-1)),this.trackEl.css("filter",t)),this.styleStr.common&&(t=Common.Utils.String.format(this.styleStr.common,this.getColorValues().concat(this.getValues())),this.trackEl.css("background",t)))},sortThumbs:function(){var t=Common.UI.MultiSlider.prototype.sortThumbs.call(this);return this.trigger("sortthumbs",this,t),t},findLeftThumb:function(t){for(var e,i=this,n=100,o=0,s=this.thumbs.length,a=0;a<s;a++)if((e=t-i.thumbs[a].position)>0&&e<=n){var l=i.thumbs[a+1],r=i.thumbs[a-1];if(void 0!==r&&t<r.position)continue;if(void 0!==l&&t>l.position)continue;o=a,n=e}return o},calculationNewColor:function(t,e,i){var n=i?i/100:.5,o=1-n,s=Common.Utils.ThemeColor.getRgbColor(t),a=Common.Utils.ThemeColor.getRgbColor(e),l=[Math.round(s.get_r()*o+a.get_r()*n),Math.round(s.get_g()*o+a.get_g()*n),Math.round(s.get_b()*o+a.get_b()*n)];return Common.Utils.ThemeColor.getHexColor(l[0],l[1],l[2])},addThumb:function(){Common.UI.MultiSlider.prototype.addThumb.call(this);var t=this,e=t.thumbs.length-1;t.thumbs[e].thumb.on("dblclick",null,(function(){t.trigger("thumbdblclick",t)})),t.thumbs[e].thumbcolor=t.thumbs[e].thumb.find("> div"),e>0&&this.setColorValue(this.getColorValue(e-1),e),t.changeSliderStyle()},addNewThumb:function(t,i,n){var o,s=this,a=this.findLeftThumb(i);t=t;if(e.isUndefined(n)){var l=100*(i-this.thumbs[a].value)/(this.thumbs[a+1].value-this.thumbs[a].value);o=l<0?this.thumbs[a].colorValue:this.calculationNewColor(this.thumbs[a].colorValue,this.thumbs[a===t-1?a:a+1].colorValue,l)}else{this.addThumb(),t=this.thumbs.length-1,o=this.calculationNewColor(this.thumbs[a].colorValue,this.thumbs[a===t-1?a:a+1].colorValue),this.setThumbPosition(t,i);var r=i/this.delta+this.minValue;this.thumbs[t].value=r}return s.thumbs[t].thumbcolor=s.thumbs[t].thumb.find("> div"),t>0&&this.setColorValue("#"+o,t),s.sortThumbs(),s.changeSliderStyle(),s.changeGradientStyle(),o},removeThumb:function(t){void 0===t&&(t=this.thumbs.length-1),this.thumbs.length>2&&(this.thumbs[t].thumb.remove(),this.thumbs.splice(t,1),this.sortThumbs(),this.changeSliderStyle())},changeSliderStyle:function(){this.styleStr={specific:"",common:"linear-gradient(to right"},Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr.specific="-webkit-gradient(linear, left top, right top":Common.Utils.isChrome||Common.Utils.isSafari?this.styleStr.specific="-webkit-linear-gradient(left":Common.Utils.isGecko?this.styleStr.specific="-moz-linear-gradient(left":Common.Utils.isOpera&&Common.Utils.operaVersion>11?this.styleStr.specific="-o-linear-gradient(left":Common.Utils.isIE&&(this.styleStr.specific="-ms-linear-gradient(left");for(var t=0;t<this.thumbs.length;t++)this.styleStr.common+=", {"+t+"} {"+(this.thumbs.length+t)+"}%",Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr.specific+=", color-stop({"+(this.thumbs.length+t)+"}%,{"+t+"})":this.styleStr.specific+=", {"+t+"} {"+(this.thumbs.length+t)+"}%";this.styleStr.specific+=")",this.styleStr.common+=")"}})})),define("text!spreadsheeteditor/main/app/template/ShapeSettingsAdvanced.template",[],(function(){return'<div id="id-adv-shape-width" class="settings-panel active">\r\n    <div class="inner-content">\r\n    <table cols="3">\r\n        <tr>\r\n            <td width="108px">\r\n                <label class="input-label"><%= scope.textWidth %></label>\r\n                <div id="shape-advanced-spin-width"></div>\r\n            </td>\r\n            <td width="28px" style="vertical-align: bottom;">\r\n                <div id="shape-advanced-button-ratio"></div>\r\n            </td>\r\n            <td width="108px">\r\n                <label class="input-label"><%= scope.textHeight %></label>\r\n                <div id="shape-advanced-spin-height"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-rotate" class="settings-panel active">\r\n    <div class="inner-content  padding-large">\r\n        <div style="width: 100%;">\r\n            <label class="input-label"><%= scope.textAngle %></label>\r\n            <div id="shape-advanced-spin-angle" style="display: inline-block; margin-left: 5px;"></div>\r\n        </div>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content  padding-large">\r\n        <table cols="2">\r\n            <tr>\r\n                <td rowspan="2" class="padding-small" style="vertical-align: top;">\r\n                    <label class="input-label" style="margin-right: 15px;vertical-align: top;"><%= scope.textFlipped %></label>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <div id="shape-advanced-checkbox-hor"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="shape-advanced-checkbox-vert"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-shape" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textLineStyle %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large" width="125px">\r\n                    <label class="input-label"><%= scope.textCapType %></label>\r\n                    <div id="shape-advanced-cap-type" style="width: 100px;"></div>\r\n                </td>\r\n                <td class="padding-large">\r\n                    <label class="input-label"><%= scope.textJoinType %></label>\r\n                    <div id="shape-advanced-join-type" style="width: 100px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    <div class="separator horizontal padding-large"></div>\r\n    <div class="inner-content">\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.textArrows %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textBeginStyle %></label>\r\n                    <div id="shape-advanced-begin-style" style="width: 100px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textEndStyle %></label>\r\n                    <div id="shape-advanced-end-style" style="width: 100px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textBeginSize %></label>\r\n                    <div id="shape-advanced-begin-size" style="width: 100px;"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textEndSize %></label>\r\n                    <div id="shape-advanced-end-size" style="width: 100px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-margins" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" style="width: 100%;">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="header"><%= scope.textAutofit %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="shape-checkbox-autofit"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <div id="shape-checkbox-overflow"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <div class="separator horizontal padding-large"></div>\r\n        <table cols="2" style="width: 100%;">\r\n            <tr>\r\n                <td colspan=2 class="padding-small">\r\n                    <label class="header"><%= scope.strMargins %></label>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small" width="125px">\r\n                    <label class="input-label"><%= scope.textTop %></label>\r\n                    <div id="shape-margin-top"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textLeft %></label>\r\n                    <div id="shape-margin-left"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textBottom %></label>\r\n                    <div id="shape-margin-bottom"></div>\r\n                </td>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textRight %></label>\r\n                    <div id="shape-margin-right"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-columns" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" style="width: 100%;">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textColNumber %></label>\r\n                    <div id="shape-columns-number"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <label class="input-label"><%= scope.textSpacing %></label>\r\n                    <div id="shape-columns-spacing"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-snap" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1">\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="shape-radio-twocell"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="shape-radio-onecell"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td class="padding-small">\r\n                    <div id="shape-radio-absolute"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>\r\n<div id="id-adv-shape-alttext" class="settings-panel">\r\n    <div class="inner-content">\r\n        <table cols="1" width="100%">\r\n            <tr>\r\n                <td class="padding-large">\r\n                    <label class="header"><%= scope.textAltTitle %></label>\r\n                    <div id="shape-advanced-alt-title"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label class="header"><%= scope.textAltDescription %></label>\r\n                    <textarea id="shape-advanced-alt-description" class="form-control" style="width: 100%; height: 70px;"></textarea>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    <label><%= scope.textAltTip %></label>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n</div>'})),define("spreadsheeteditor/main/app/view/ShapeSettingsAdvanced",["text!spreadsheeteditor/main/app/template/ShapeSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox"],(function(t){"use strict";SSE.Views.ShapeSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:300,height:342,toggleGroup:"shape-adv-settings-group",sizeOriginal:{width:0,height:0},sizeMax:{width:55.88,height:55.88},properties:null,storageName:"sse-shape-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-shape-width",panelCaption:this.textSize},{panelId:"id-adv-shape-rotate",panelCaption:this.textRotation},{panelId:"id-adv-shape-shape",panelCaption:this.textWeightArrows},{panelId:"id-adv-shape-margins",panelCaption:this.textTextBox},{panelId:"id-adv-shape-columns",panelCaption:this.strColumns},{panelId:"id-adv-shape-snap",panelCaption:this.textSnap},{panelId:"id-adv-shape-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.spinners=[],this.Margins=void 0,this._nRatio=1,this._originalProps=this.options.shapeProps,this._changedProps=null},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-width"),step:.1,width:100,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnWidth.on("change",_.bind((function(t,e,i,n){if(this.btnRatio.pressed){var o=t.getNumberValue(),s=o/this._nRatio;s>this.spnHeight.options.maxValue&&(o=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(o,!0)),this.spnHeight.setValue(s,!0)}this._changedProps&&(this._changedProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._changedProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(this.spnHeight.getNumberValue())))}),this)),this.spinners.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-height"),step:.1,width:100,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnHeight.on("change",_.bind((function(t,e,i,n){var o=t.getNumberValue(),s=null;this.btnRatio.pressed&&((s=o*this._nRatio)>this.spnWidth.options.maxValue&&(o=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(o,!0)),this.spnWidth.setValue(s,!0)),this._changedProps&&(this._changedProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this._changedProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue())))}),this)),this.spinners.push(this.spnHeight),this.btnRatio=new Common.UI.Button({parentEl:$("#shape-advanced-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio}),this.btnRatio.on("click",_.bind((function(t,e){t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this._changedProps&&this._changedProps.asc_putLockAspect(t.pressed)}),this)),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#shape-margin-top"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginTop.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getPaddings()&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putTop(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#shape-margin-bottom"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginBottom.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getPaddings()&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putBottom(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#shape-margin-left"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginLeft.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getPaddings()&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putLeft(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#shape-margin-right"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginRight.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getPaddings()&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putRight(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.spnMarginRight),this.chAutofit=new Common.UI.CheckBox({el:$("#shape-checkbox-autofit"),labelText:this.textResizeFit}),this.chAutofit.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_putTextFitType("checked"==t.getValue()?AscFormat.text_fit_Auto:AscFormat.text_fit_No))}),this)),this.chOverflow=new Common.UI.CheckBox({el:$("#shape-checkbox-overflow"),labelText:this.textOverflow}),this.chOverflow.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_putVertOverflowType("checked"==t.getValue()?AscFormat.nOTOwerflow:AscFormat.nOTClip))}),this)),this.spnAngle=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-angle"),step:1,width:80,defaultUnit:"°",value:"0 °",maxValue:3600,minValue:-3600}),this.chFlipHor=new Common.UI.CheckBox({el:$("#shape-advanced-checkbox-hor"),labelText:this.textHorizontally}),this.chFlipVert=new Common.UI.CheckBox({el:$("#shape-advanced-checkbox-vert"),labelText:this.textVertically}),this._arrCapType=[{displayValue:this.textFlat,value:Asc.c_oAscLineCapType.Flat},{displayValue:this.textRound,value:Asc.c_oAscLineCapType.Round},{displayValue:this.textSquare,value:Asc.c_oAscLineCapType.Square}],this.cmbCapType=new Common.UI.ComboBox({el:$("#shape-advanced-cap-type"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:this._arrCapType,takeFocusOnClose:!0}),this.cmbCapType.setValue(Asc.c_oAscLineCapType.Flat),this.cmbCapType.on("selected",_.bind((function(t,e){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getStroke()&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinecap(e.value))}),this)),this._arrJoinType=[{displayValue:this.textRound,value:Asc.c_oAscLineJoinType.Round},{displayValue:this.textBevel,value:Asc.c_oAscLineJoinType.Bevel},{displayValue:this.textMiter,value:Asc.c_oAscLineJoinType.Miter}],this.cmbJoinType=new Common.UI.ComboBox({el:$("#shape-advanced-join-type"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:this._arrJoinType,takeFocusOnClose:!0}),this.cmbJoinType.setValue(Asc.c_oAscLineJoinType.Round),this.cmbJoinType.on("selected",_.bind((function(t,e){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getStroke()&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinejoin(e.value))}),this));for(var e=[],i=[],n=0;n<6;n++)e.push({value:n,offsetx:80*n+10,offsety:0});for(e[0].type=Asc.c_oAscLineBeginType.None,e[1].type=Asc.c_oAscLineBeginType.Triangle,e[2].type=Asc.c_oAscLineBeginType.Arrow,e[3].type=Asc.c_oAscLineBeginType.Stealth,e[4].type=Asc.c_oAscLineBeginType.Diamond,e[5].type=Asc.c_oAscLineBeginType.Oval,n=0;n<9;n++)i.push({value:n,offsetx:90,offsety:20*(n+1)});for(i[0].type=Asc.c_oAscLineBeginSize.small_small,i[1].type=Asc.c_oAscLineBeginSize.small_mid,i[2].type=Asc.c_oAscLineBeginSize.small_large,i[3].type=Asc.c_oAscLineBeginSize.mid_small,i[4].type=Asc.c_oAscLineBeginSize.mid_mid,i[5].type=Asc.c_oAscLineBeginSize.mid_large,i[6].type=Asc.c_oAscLineBeginSize.large_small,i[7].type=Asc.c_oAscLineBeginSize.large_mid,i[8].type=Asc.c_oAscLineBeginSize.large_large,this.btnBeginStyle=new Common.UI.ComboBox({el:$("#shape-advanced-begin-style"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="form-control" style="width: 100px;">','<i class="image img-arrows"></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default"><span class="caret"></span></button>',"</div>"].join(""))}),this.btnBeginStyleMenu=new Common.UI.Menu({style:"min-width: 105px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-begin-style" style="width: 105px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-begin-style")),this.mnuBeginStylePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-begin-style"),parentMenu:this.btnBeginStyleMenu,store:new Common.UI.DataViewStore(e),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuBeginStylePicker.on("item:click",_.bind(this.onSelectBeginStyle,this)),this._selectStyleItem(this.btnBeginStyle,null),this.btnBeginSize=new Common.UI.ComboBox({el:$("#shape-advanced-begin-size"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="form-control" style="width: 100px;">','<i class="image img-arrows"></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default"><span class="caret"></span></button>',"</div>"].join(""))}),this.btnBeginSizeMenu=new Common.UI.Menu({style:"min-width: 160px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-begin-size" style="width: 160px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-begin-size")),this.mnuBeginSizePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-begin-size"),parentMenu:this.btnBeginSizeMenu,store:new Common.UI.DataViewStore(i),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuBeginSizePicker.on("item:click",_.bind(this.onSelectBeginSize,this)),this._selectStyleItem(this.btnBeginSize,null),n=0;n<e.length;n++)e[n].offsety+=200;for(n=0;n<i.length;n++)i[n].offsety+=200;this.btnEndStyle=new Common.UI.ComboBox({el:$("#shape-advanced-end-style"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="form-control" style="width: 100px;">','<i class="image img-arrows"></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default"><span class="caret"></span></button>',"</div>"].join(""))}),this.btnEndStyleMenu=new Common.UI.Menu({style:"min-width: 105px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-end-style" style="width: 105px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-end-style")),this.mnuEndStylePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-end-style"),parentMenu:this.btnEndStyleMenu,store:new Common.UI.DataViewStore(e),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuEndStylePicker.on("item:click",_.bind(this.onSelectEndStyle,this)),this._selectStyleItem(this.btnEndStyle,null),this.btnEndSize=new Common.UI.ComboBox({el:$("#shape-advanced-end-size"),template:_.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">','<div class="form-control" style="width: 100px;">','<i class="image img-arrows"></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default"><span class="caret"></span></button>',"</div>"].join(""))}),this.btnEndSizeMenu=new Common.UI.Menu({style:"min-width: 160px;",additionalAlign:this.menuAddAlign,items:[{template:_.template('<div id="shape-advanced-menu-end-size" style="width: 160px; margin: 0 5px;"></div>')}]}).render($("#shape-advanced-end-size")),this.mnuEndSizePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-end-size"),parentMenu:this.btnEndSizeMenu,store:new Common.UI.DataViewStore(i),itemTemplate:_.template('<div id="<%= id %>" class="item-arrow img-arrows" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>')}),this.mnuEndSizePicker.on("item:click",_.bind(this.onSelectEndSize,this)),this._selectStyleItem(this.btnEndSize,null),this.spnColumns=new Common.UI.MetricSpinner({el:$("#shape-columns-number"),step:1,allowDecimal:!1,width:100,defaultUnit:"",value:"1",maxValue:16,minValue:1}),this.spnColumns.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_putColumnNumber(t.getNumberValue()))}),this)),this.spnSpacing=new Common.UI.MetricSpinner({el:$("#shape-columns-spacing"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:40.64,minValue:0}),this.spnSpacing.on("change",_.bind((function(t,e,i,n){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_putColumnSpace(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))}),this)),this.spinners.push(this.spnSpacing),this.radioTwoCell=new Common.UI.RadioBox({el:$("#shape-radio-twocell"),name:"asc-radio-snap",labelText:this.textTwoCell,value:AscCommon.c_oAscCellAnchorType.cellanchorTwoCell}),this.radioTwoCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioOneCell=new Common.UI.RadioBox({el:$("#shape-radio-onecell"),name:"asc-radio-snap",labelText:this.textOneCell,value:AscCommon.c_oAscCellAnchorType.cellanchorOneCell}),this.radioOneCell.on("change",_.bind(this.onRadioSnapChange,this)),this.radioAbsolute=new Common.UI.RadioBox({el:$("#shape-radio-absolute"),name:"asc-radio-snap",labelText:this.textAbsolute,value:AscCommon.c_oAscCellAnchorType.cellanchorAbsolute}),this.radioAbsolute.on("change",_.bind(this.onRadioSnapChange,this)),this.inputAltTitle=new Common.UI.InputField({el:$("#shape-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",(function(){t.isAltTitleChanged=!0})),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown((function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0})),this.afterRender()},getFocusedComponents:function(){return[this.spnWidth,this.spnHeight,this.spnAngle,this.chFlipHor,this.chFlipVert,this.cmbCapType,this.cmbJoinType,this.chAutofit,this.chOverflow,this.spnMarginTop,this.spnMarginLeft,this.spnMarginBottom,this.spnMarginRight,this.spnColumns,this.spnSpacing,this.radioTwoCell,this.radioOneCell,this.radioAbsolute,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 0:i.spnWidth.focus();break;case 1:i.spnAngle.focus();break;case 2:i.cmbCapType.focus();break;case 3:i.spnMarginTop.focus();break;case 4:i.spnColumns.focus();break;case 5:i.radioTwoCell.focus();break;case 6:i.inputAltTitle.focus()}}),10)},afterRender:function(){if(this.updateMetricUnit(),this._setDefaults(this._originalProps),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},_setDefaults:function(t){if(t&&t.asc_getShapeProperties()){var e=t.asc_getShapeProperties();e.asc_getFromSmartArt()&&this.btnsCategory[1].setDisabled(!0),e.asc_getFromSmartArtInternal()&&(this.chAutofit.setDisabled(!0),this.chOverflow.setDisabled(!0),this.chFlipHor.setDisabled(!0),this.chFlipVert.setDisabled(!0),this.btnsCategory[0].setDisabled(!0)),this.spnWidth.setValue(Common.Utils.Metric.fnRecalcFromMM(t.asc_getWidth()).toFixed(2),!0),this.spnHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(t.asc_getHeight()).toFixed(2),!0),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight());var i=t.asc_getLockAspect();this.btnRatio.toggle(i||e.asc_getFromSmartArt()),this.btnRatio.setDisabled(!!e.asc_getFromSmartArt()),this._setShapeDefaults(e);var n=e.asc_getPaddings();if(n){var o=n.asc_getLeft();this.spnMarginLeft.setValue(null!=o?Common.Utils.Metric.fnRecalcFromMM(o):"",!0),o=n.asc_getTop(),this.spnMarginTop.setValue(null!=o?Common.Utils.Metric.fnRecalcFromMM(o):"",!0),o=n.asc_getRight(),this.spnMarginRight.setValue(null!=o?Common.Utils.Metric.fnRecalcFromMM(o):"",!0),o=n.asc_getBottom(),this.spnMarginBottom.setValue(null!=o?Common.Utils.Metric.fnRecalcFromMM(o):"",!0)}this.btnsCategory[3].setDisabled(null===n),this.chAutofit.setValue(e.asc_getTextFitType()==AscFormat.text_fit_Auto),this.chOverflow.setValue(e.asc_getVertOverflowType()==AscFormat.nOTOwerflow);var s=e.asc_getType();switch(this.btnsCategory[4].setDisabled(e.asc_getFromSmartArtInternal()||"line"==s||"bentConnector2"==s||"bentConnector3"==s||"bentConnector4"==s||"bentConnector5"==s||"curvedConnector2"==s||"curvedConnector3"==s||"curvedConnector4"==s||"curvedConnector5"==s||"straightConnector1"==s),i=e.asc_getColumnNumber(),this.spnColumns.setValue(null!=i?i:"",!0),i=e.asc_getColumnSpace(),this.spnSpacing.setValue(null!=i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=t.asc_getTitle(),this.inputAltTitle.setValue(i||""),i=t.asc_getDescription(),this.textareaAltDescription.val(i||""),i=t.asc_getRot(),this.spnAngle.setValue(null==i||null===i?"":Math.floor(180*i/3.14159265358979+.5),!0),this.chFlipHor.setValue(t.asc_getFlipH()),this.chFlipVert.setValue(t.asc_getFlipV()),i=t.asc_getAnchor()){case AscCommon.c_oAscCellAnchorType.cellanchorTwoCell:this.radioTwoCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorOneCell:this.radioOneCell.setValue(!0,!0);break;case AscCommon.c_oAscCellAnchorType.cellanchorAbsolute:this.radioAbsolute.setValue(!0,!0)}this._changedProps=new Asc.asc_CImgProperty}},getSettings:function(){return this.isAltTitleChanged&&this._changedProps.asc_putTitle(this.inputAltTitle.getValue()),this.isAltDescChanged&&this._changedProps.asc_putDescription(this.textareaAltDescription.val()),this._changedProps.asc_putRot(3.14159265358979*this.spnAngle.getNumberValue()/180),this._changedProps.asc_putFlipH("checked"==this.chFlipHor.getValue()),this._changedProps.asc_putFlipV("checked"==this.chFlipVert.getValue()),{shapeProps:this._changedProps}},_setShapeDefaults:function(t){if(t){var e=t.asc_getStroke();if(e){this.btnsCategory[2].setDisabled(e.asc_getType()==Asc.c_oAscStrokeType.STROKE_NONE);for(var i=e.asc_getLinejoin(),n=0;n<this._arrJoinType.length;n++)if(i==this._arrJoinType[n].value){this.cmbJoinType.setValue(i);break}for(i=e.asc_getLinecap(),n=0;n<this._arrCapType.length;n++)if(i==this._arrCapType[n].value){this.cmbCapType.setValue(i);break}var o=e.asc_getCanChangeArrows();if(this.btnBeginStyle.setDisabled(!o),this.btnEndStyle.setDisabled(!o),this.btnBeginSize.setDisabled(!o),this.btnEndSize.setDisabled(!o),o){i=e.asc_getLinebeginsize();var s=this.mnuBeginSizePicker.store.findWhere({type:i});s?this._beginSizeIdx=s.get("value"):(this._beginSizeIdx=null,this._selectStyleItem(this.btnBeginSize,null)),i=e.asc_getLinebeginstyle(),(s=this.mnuBeginStylePicker.store.findWhere({type:i}))?(this.mnuBeginStylePicker.selectRecord(s,!0),this._updateSizeArr(this.btnBeginSize,this.mnuBeginSizePicker,s,this._beginSizeIdx),this._selectStyleItem(this.btnBeginStyle,s)):this._selectStyleItem(this.btnBeginStyle,null),i=e.asc_getLineendsize(),(s=this.mnuEndSizePicker.store.findWhere({type:i}))?this._endSizeIdx=s.get("value"):(this._endSizeIdx=null,this._selectStyleItem(this.btnEndSize,null)),i=e.asc_getLineendstyle(),(s=this.mnuEndStylePicker.store.findWhere({type:i}))?(this.mnuEndStylePicker.selectRecord(s,!0),this._updateSizeArr(this.btnEndSize,this.mnuEndSizePicker,s,this._endSizeIdx),this._selectStyleItem(this.btnEndStyle,s)):this._selectStyleItem(this.btnEndStyle,null)}else this._selectStyleItem(this.btnBeginStyle),this._selectStyleItem(this.btnEndStyle),this._selectStyleItem(this.btnBeginSize),this._selectStyleItem(this.btnEndSize)}}},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01)}this.sizeMax={width:Common.Utils.Metric.fnRecalcFromMM(10*this.options.sizeMax.width),height:Common.Utils.Metric.fnRecalcFromMM(10*this.options.sizeMax.height)},this.options.sizeOriginal&&(this.sizeOriginal={width:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeOriginal.width),height:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeOriginal.height)})},_updateSizeArr:function(t,e,i,n){i.get("value")>0?(e.store.each((function(t){t.set({offsetx:80*i.get("value")+10})}),this),t.setDisabled(!1),null!==n?(e.selectByIndex(n,!0),this._selectStyleItem(t,e.store.at(n))):this._selectStyleItem(t,null)):(this._selectStyleItem(t,null),t.setDisabled(!0))},_selectStyleItem:function(t,e){$(t.el).find(".form-control > .image").css("background-position",(e?20-e.get("offsetx")+"px":"0")+" "+(e?"-"+e.get("offsety")+"px":"-30px"))},onSelectBeginStyle:function(t,e,i){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getStroke()&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinebeginstyle(i.get("type"))),null!==this._beginSizeIdx&&void 0!==this._beginSizeIdx||(this._beginSizeIdx=4),this._updateSizeArr(this.btnBeginSize,this.mnuBeginSizePicker,i,this._beginSizeIdx),this._selectStyleItem(this.btnBeginStyle,i)},onSelectBeginSize:function(t,e,i){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getStroke()&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinebeginsize(i.get("type"))),this._beginSizeIdx=i.get("value"),this._selectStyleItem(this.btnBeginSize,i)},onSelectEndStyle:function(t,e,i){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getStroke()&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLineendstyle(i.get("type"))),null!==this._endSizeIdx&&void 0!==this._endSizeIdx||(this._endSizeIdx=4),this._updateSizeArr(this.btnEndSize,this.mnuEndSizePicker,i,this._endSizeIdx),this._selectStyleItem(this.btnEndStyle,i)},onSelectEndSize:function(t,e,i){this._changedProps&&(null!==this._changedProps.asc_getShapeProperties()&&void 0!==this._changedProps.asc_getShapeProperties()||this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),null===this._changedProps.asc_getShapeProperties().asc_getStroke()&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLineendsize(i.get("type"))),this._endSizeIdx=i.get("value"),this._selectStyleItem(this.btnEndSize,i)},onRadioSnapChange:function(t,e,i){e&&this._changedProps&&this._changedProps.asc_putAnchor(t.options.value)},textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",textSize:"Size",textWidth:"Width",textHeight:"Height",textKeepRatio:"Constant Proportions",textTitle:"Shape - Advanced Settings",strMargins:"Text Padding",textRound:"Round",textMiter:"Miter",textSquare:"Square",textFlat:"Flat",textBevel:"Bevel",textArrows:"Arrows",textLineStyle:"Line Style",textCapType:"Cap Type",textJoinType:"Join Type",textBeginStyle:"Begin Style",textBeginSize:"Begin Size",textEndStyle:"End Style",textEndSize:"End Size",textWeightArrows:"Weights & Arrows",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table.",strColumns:"Columns",textSpacing:"Spacing between columns",textColNumber:"Number of columns",textRotation:"Rotation",textAngle:"Angle",textFlipped:"Flipped",textHorizontally:"Horizontally",textVertically:"Vertically",textSnap:"Cell Snapping",textAbsolute:"Don't move or size with cells",textOneCell:"Move but don't size with cells",textTwoCell:"Move and size with cells",textTextBox:"Text Box",textAutofit:"AutoFit",textResizeFit:"Resize shape to fit text",textOverflow:"Allow text to overflow shape"},SSE.Views.ShapeSettingsAdvanced||{}))})),define("spreadsheeteditor/main/app/view/ShapeSettings",["text!spreadsheeteditor/main/app/template/ShapeSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient","common/main/lib/view/ImageFromUrlDialog","spreadsheeteditor/main/app/view/ShapeSettingsAdvanced"],(function(t,e,i,n){"use strict";SSE.Views.ShapeSettings=n.View.extend(i.extend({el:"#id-shape-settings",template:i.template(t),events:{},options:{alias:"ShapeSettings"},initialize:function(){this._initSettings=!0,this._originalProps=null,this._noApply=!0,this.imgprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this._texturearray=null,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Transparency:null,FillType:Asc.c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",BlipFillType:Asc.c_oAscFillBlipType.STRETCH,StrokeType:Asc.c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",StrokeBorderType:Asc.c_oDashType.solid,FGColor:"000000",BGColor:"ffffff",GradColor:"000000",GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,DisabledFillPanels:!1,DisabledControls:!1,HideShapeOnlySettings:!1,HideChangeTypeSettings:!1,HideRotationSettings:!1,isFromImage:!1,isFromSmartArtInternal:!1},this.lockedControls=[],this._locked=!1,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.BlipFillType=Asc.c_oAscFillBlipType.STRETCH,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.PatternFillType=0,this.FGColor={Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.BorderType=Asc.c_oDashType.solid,this.textureNames=[this.txtCanvas,this.txtCarton,this.txtDarkFabric,this.txtGrain,this.txtGranite,this.txtGreyPaper,this.txtKnit,this.txtLeather,this.txtBrownPaper,this.txtPapyrus,this.txtWood],this.fillControls=[],this.gradientColorsStr="#000, #fff",this.typeGradient=90,this.render(),this.FillColorContainer=e("#shape-panel-color-fill"),this.FillImageContainer=e("#shape-panel-image-fill"),this.FillPatternContainer=e("#shape-panel-pattern-fill"),this.FillGradientContainer=e("#shape-panel-gradient-fill"),this.TransparencyContainer=e("#shape-panel-transparent-fill"),this.ShapeOnlySettings=e(".shape-only"),this.CanChangeType=e(".change-type"),this.RotationSettings=e(".shape-rotation")},render:function(){e(this.el).html(this.template({scope:this}))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_setInterfaceDrawImagePlaceShape("shape-texture-img"),this.api.asc_registerCallback("asc_onInitStandartTextures",i.bind(this.onInitStandartTextures,this))),Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},onFillSrcSelect:function(t,e){switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,!this._noApply){var i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),a.asc_putFill(new Asc.asc_CFillSolid),a.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor("transparent"==this.ShapeColor.Color?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){i=new Asc.asc_CShapeProperty;if((a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(a.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),a.asc_getFill().asc_putLinearScale(!0)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){this.GradColor.values=[0,100],this.GradColor.colors=[this.GradColor.colors[0],this.GradColor.colors[this.GradColor.colors.length-1]],this.GradColor.currentIdx=0;var n=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();n="ffffff"===n&&"ffffff"===o?{color:"4f81bd",effectId:24}:this.GradColor.colors[0],a.asc_getFill().asc_putPositions([1e3*this.GradColor.values[0],1e3*this.GradColor.values[1]]),a.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(n),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])}i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_BLIP:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_BLIP;break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),a.asc_putFill(new Asc.asc_CFillHatch),a.asc_getFill().asc_putPatternType(this.PatternFillType);var s=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();s="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===s?{color:"4f81bd",effectId:24}:this.FGColor.Color,a.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(s)),a.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,!this._noApply){var a;i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),a.asc_putFill(null),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBackSelect:function(t,e){if(this.ShapeColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;"transparent"==this.ShapeColor.Color?(n.asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),n.asc_putFill(null)):(n.asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),n.asc_putFill(new Asc.asc_CFillSolid),n.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onPatternSelect:function(t,e){if(this.api&&!this._noApply){this.PatternFillType=e.get("type");var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),n.asc_putFill(new Asc.asc_CFillHatch),n.asc_getFill().asc_putPatternType(this.PatternFillType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),n.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(t,e){if(this.FGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),n.asc_putFill(new Asc.asc_CFillHatch),n.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.asc_getFill().asc_putPatternType(this.PatternFillType),n.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(t,e){if(this.BGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),n.asc_putFill(new Asc.asc_CFillHatch),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.asc_getFill().asc_putPatternType(this.PatternFillType),n.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color))),n.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onFillTypeSelect:function(t,e){if(this.BlipFillType=e.value,this.api&&!0!==this._fromTextureCmb&&this.OriginalFillType==Asc.c_oAscFill.FILL_TYPE_BLIP){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),n.asc_putFill(new Asc.asc_CFillBlip),n.asc_getFill().asc_putType(this.BlipFillType),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumTransparencyChange:function(t,e,i,n){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var o=t.getNumberValue(),s=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.asc_putTransparent(2.55*o),s.asc_putFill(a),this.imgprops.asc_putShapeProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops)}},onTransparencyChange:function(t,e,n){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CShapeFill;e.asc_putTransparent(2.55*this._sliderChanged),t.asc_putFill(e),this.imgprops.asc_putShapeProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=void 0}},onGradTypeSelect:function(t,e){if(this.GradFillType=e.value,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;e=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(e,!0),this.typeGradient=e?this.GradLinearDirectionType+90:-1,this.numGradientAngle.setValue(this.GradLinearDirectionType,!0),this.numGradientAngle.setDisabled(this._locked)}else this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.typeGradient=this._viewDataRadial[this.GradRadialDirectionIdx].type:this.typeGradient=-1,this.numGradientAngle.setValue(0,!0),this.numGradientAngle.setDisabled(!0));if(this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),n.asc_putFill(new Asc.asc_CFillGrad),n.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),n.asc_getFill().asc_putLinearScale(!0)),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectGradient:function(t,e,n,o){if(!this._noApply){var s={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;s=o.toJSON()}else s=o;if(this.GradFillType===Asc.c_oAscFillGradType.GRAD_LINEAR?(this.GradLinearDirectionType=s.type,this.typeGradient=s.type+90):(this.GradRadialDirectionIdx=0,this.typeGradient=s.type),this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.numGradientAngle.setValue(s.type,!0);var a=new Asc.asc_CShapeProperty,l=new Asc.asc_CShapeFill;l.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),l.asc_putFill(new Asc.asc_CFillGrad),l.asc_getFill().asc_putGradType(this.GradFillType),l.asc_getFill().asc_putLinearAngle(6e4*s.type),l.asc_getFill().asc_putLinearScale(!0),a.asc_putFill(l),this.imgprops.asc_putShapeProperties(a),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)}},onColorsGradientSelect:function(t,e){if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof e?e.color:e)),this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),n.asc_putFill(new Asc.asc_CFillGrad),n.asc_getFill().asc_putGradType(this.GradFillType);var o=[];this.GradColor.colors.forEach((function(t){o.push(Common.Utils.ThemeColor.getRgbColor(t))})),n.asc_getFill().asc_putColors(o),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),n.asc_getFill().asc_putLinearScale(!0)),o=[],this.GradColor.values.forEach((function(t){o.push(1e3*t)})),n.asc_getFill().asc_putPositions(o)),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientChange:function(t,e,n){this.GradColor.values=t.getValues(),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx],!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CShapeFill;e.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),e.asc_putFill(new Asc.asc_CFillGrad),e.asc_getFill().asc_putGradType(this.GradFillType);var i=[];this.GradColor.values.forEach((function(t){i.push(1e3*t)})),e.asc_getFill().asc_putPositions(i),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(e.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),e.asc_getFill().asc_putLinearScale(!0)),i=[],this.GradColor.colors.forEach((function(t){i.push(Common.Utils.ThemeColor.getRgbColor(t))})),e.asc_getFill().asc_putColors(i),t.asc_putFill(e),this.imgprops.asc_putShapeProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?0:Math.max(0,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply){var e=new Asc.asc_CShapeProperty,i=new Asc.asc_CStroke;this.BorderSize<1e-5?(i.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(i.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),"transparent"==this.BorderColor.Color||"transparent"==this.BorderColor.Color.color?i.asc_putColor(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):this._state.StrokeType!=Asc.c_oAscStrokeType.STROKE_NONE&&null!==this._state.StrokeType||i.asc_putColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),i.asc_putPrstDash(this.BorderType),i.asc_putWidth(this._pt2mm(this.BorderSize))),e.asc_putStroke(i),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)}},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this)},onBorderSizeChanged:function(t,e,n,o){var s=this;if(t){var a=parseFloat(n.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(n.value)||a<0||a>1584)&&(this._state.StrokeType=this._state.StrokeWidth=-1,setTimeout((function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}})}),10))}else this.applyBorderSize(n.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onBorderTypeSelect:function(t,e){if(this.BorderType=e.value,this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(n.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),n.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.put_width(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.put_stroke(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBorderSelect:function(t,e){if(this.BorderColor={Value:1,Color:e},this.api&&this.BorderSize>0&&!this._noApply){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE):(n.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),n.asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.asc_putWidth(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.asc_putStroke(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},setImageUrl:function(t,e){if(null!==this.BlipFillType){var i=new Asc.asc_CShapeProperty,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),n.asc_putFill(new Asc.asc_CFillBlip),n.asc_getFill().asc_putType(this.BlipFillType),n.asc_getFill().asc_putUrl(t,e),i.asc_putFill(n),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}},insertImageFromStorage:function(t){t&&t._urls&&"fill"==t.c&&this.setImageUrl(t._urls[0],t.token)},onImageSelect:function(t,e){if(1==e.value){var n=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&n.api){var o=e.replace(/ /g,"");i.isEmpty(o)||n.setImageUrl(o)}Common.NotificationCenter.trigger("edit:complete",n)}}).show()}else 2==e.value?Common.NotificationCenter.trigger("storage:image-load","fill"):(this.api&&this.api.asc_changeShapeImageFromFile(this.BlipFillType),Common.NotificationCenter.trigger("edit:complete",this))},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].asc_getObjectType(),o=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Image==n&&o.asc_getShapeProperties()){new SSE.Views.ShapeSettingsAdvanced({shapeProps:o,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_setGraphicObjectProps(i.shapeProps),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),null==this.imgprops&&(this.imgprops=new Asc.asc_CImgProperty),t&&t.asc_getShapeProperties()){var n=t.asc_getShapeProperties(),o=n.asc_getType();this._originalProps=n,this._noApply=!0,this._state.isFromImage=!!n.get_FromImage(),this._state.isFromSmartArtInternal=!!n.asc_getFromSmartArtInternal(),this.disableControls(this._locked,!n.asc_getCanFill()),this.hideShapeOnlySettings(n.asc_getFromChart()||!!n.asc_getFromImage()),this.hideRotationSettings(n.asc_getFromChart()||!!n.asc_getFromImage()||n.asc_getFromSmartArt());var s=n.get_FromChart()||n.asc_getFromSmartArt()||"line"==o||"bentConnector2"==o||"bentConnector3"==o||"bentConnector4"==o||"bentConnector5"==o||"curvedConnector2"==o||"curvedConnector3"==o||"curvedConnector4"==o||"curvedConnector5"==o||"straightConnector1"==o;this.hideChangeTypeSettings(s),!s&&this.btnChangeShape.menu.items.length&&this.btnChangeShape.shapePicker.hideTextRect(n.get_FromImage()||this._state.isFromSmartArtInternal);var a=null,l=n.asc_getFill(),r=l.asc_getType(),c=null,d=l.asc_getTransparent();if((Math.abs(this._state.Transparency-d)>.001||Math.abs(this.numTransparency.getNumberValue()-d)>.001||(null===this._state.Transparency||null===d)&&(this._state.Transparency!==d||this.numTransparency.getNumberValue()!==d))&&(void 0!==d&&(this.sldrTransparency.setValue(null===d?100:d/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=d),null===l||null===r)this.OriginalFillType=null;else if(r==Asc.c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(r==Asc.c_oAscFill.FILL_TYPE_SOLID)(c=(l=l.asc_getFill()).asc_getColor())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.FGColor="transparent"!==this.ShapeColor.Color?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color)}:{Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.GradColor.colors[0]="transparent"!==this.ShapeColor.Color?Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color):"000000",this.GradColor.colors[this.GradColor.colors.length-1]="ffffff";else if(r==Asc.c_oAscFill.FILL_TYPE_BLIP)l=l.asc_getFill(),this.BlipFillType=l.asc_getType(),this._state.BlipFillType!==this.BlipFillType&&(this.BlipFillType==Asc.c_oAscFillBlipType.STRETCH||this.BlipFillType==Asc.c_oAscFillBlipType.TILE?this.cmbFillType.setValue(this.BlipFillType):this.cmbFillType.setValue(""),this._state.BlipFillType=this.BlipFillType),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_BLIP;else if(r==Asc.c_oAscFill.FILL_TYPE_PATT){if(l=l.asc_getFill(),this.PatternFillType=l.asc_getPatternType(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();a=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(a),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}(c=l.asc_getColorFg())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.FGColor={Value:1,Color:"000000"},(c=l.asc_getColorBg())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT,this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[this.GradColor.colors.length-1]="ffffff"}else if(r==Asc.c_oAscFill.FILL_TYPE_GRAD){var h=(l=l.asc_getFill()).asc_getGradType();if(this._state.GradFillType===h&&this.GradFillType===h||(this.GradFillType=h,a=void 0,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),a=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,a.attributes)):(this.cmbGradType.setValue(""),this.typeGradient=-1),this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){var p=Math.floor(l.asc_getLinearAngle()/6e4);if(Math.abs(this.GradLinearDirectionType-p)>.001){this.GradLinearDirectionType=p;var m=this.mnuDirectionPicker.store.findWhere({type:p});this.mnuDirectionPicker.selectRecord(m,!0),this.typeGradient=m?p+90:-1,this.numGradientAngle.setValue(p,!0)}}else this.numGradientAngle.setValue(0,!0);var u=this,g=l.asc_getColors(),f=l.asc_getPositions(),b=g?g.length:this.GradColor.colors.length;this.sldrGradient.setThumbs(b),this.GradColor.colors.length>b&&(this.GradColor.colors.splice(b,this.GradColor.colors.length-b),this.GradColor.values.splice(b,this.GradColor.colors.length-b),this.GradColor.currentIdx=0),g&&g.forEach((function(t,e){t?t.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?(u.GradColor.colors[e]={color:Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()),effectValue:t.asc_getValue()},Common.Utils.ThemeColor.colorValue2EffectId(u.GradColor.colors[e])):u.GradColor.colors[e]=Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()):u.GradColor.colors[e]="000000";var i=f[e];null!==i&&(i/=1e3,u.GradColor.values[e]=i)}));for(var C=[],v=this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?1:.7,_=0;_<b;_++)u.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof u.GradColor.colors[_]?u.GradColor.colors[_].color:u.GradColor.colors[_]),_),u.sldrGradient.setValue(_,u.GradColor.values[_]),C.push(u.sldrGradient.getColorValue(_)+" "+u.sldrGradient.getValue(_)*v+"%");this.btnDirectionRedraw(u.sldrGradient,C.join(", ")),(i.isUndefined(u.GradColor.currentIdx)||u.GradColor.currentIdx>=this.GradColor.colors.length)&&(u.GradColor.currentIdx=0),u.sldrGradient.setActiveThumb(u.GradColor.currentIdx),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx]),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:this.GradColor.colors[0]},this.BGColor={Value:1,Color:"ffffff"},this.ShapeColor={Value:1,Color:this.GradColor.colors[0]}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType)),e(this.btnTexture.el).find(".form-control").prop("innerHTML",this.textSelectTexture);var x=typeof this.ShapeColor.Color,y=typeof this._state.ShapeColor;if(x!==y||"object"==x&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||"object"!=x&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0){if(this.btnBackColor.setColor(this.ShapeColor.Color),"object"==typeof this.ShapeColor.Color){for(var w=!1,S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==this.ShapeColor.Color.effectValue){this.colorsBack.select(this.ShapeColor.Color,!0),w=!0;break}w||this.colorsBack.clearSelection()}else this.colorsBack.select(this.ShapeColor.Color,!0);this._state.ShapeColor=this.ShapeColor.Color}var A,k=n.asc_getStroke(),T=k.asc_getType(),I="transparent"==this._state.StrokeColor&&"transparent"!==this.BorderColor.Color;if(k?(T==Asc.c_oAscStrokeType.STROKE_COLOR&&(c=k.asc_getColor())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.BorderColor={Value:1,Color:"transparent"},A=k.asc_getPrstDash()):(T=null,this.BorderColor={Value:0,Color:"transparent"}),x=typeof this.BorderColor.Color,y=typeof this._state.StrokeColor,I||x!==y||"object"==x&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||"object"!=x&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||"object"==typeof this.btnBorderColor.color)){if(this.btnBorderColor.setColor(this.BorderColor.Color),"object"==typeof this.BorderColor.Color){for(w=!1,S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==this.BorderColor.Color.effectValue){this.colorsBorder.select(this.BorderColor.Color,!0),w=!0;break}w||this.colorsBorder.clearSelection()}else this.colorsBorder.select(this.BorderColor.Color,!0);this._state.StrokeColor=this.BorderColor.Color}if(this._state.StrokeType!==T||T==Asc.c_oAscStrokeType.STROKE_COLOR){if(T==Asc.c_oAscStrokeType.STROKE_COLOR){var E=k.asc_getWidth(),D=Math.abs(this._state.StrokeWidth-E)<1e-5&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-E)>1e-5||D||(null===this._state.StrokeWidth||null===E)&&this._state.StrokeWidth!==E){this._state.StrokeWidth=E,null!==E&&(E=this._mm2pt(E));var P=null===E?E:i.find(this.cmbBorderSize.store.models,(function(t){if(E<t.attributes.value+1e-5&&E>t.attributes.value-1e-5)return!0}));P?this.cmbBorderSize.selectRecord(P):this.cmbBorderSize.setValue(null!==E?parseFloat(E.toFixed(2))+" "+this.txtPt:""),this.BorderSize=E}}else T==Asc.c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=T}if(this._state.StrokeBorderType!==A&&(this.BorderType=this._state.StrokeBorderType=A,this.cmbBorderType.setValue(A)),(x=typeof this.FGColor.Color)!==(y=typeof this._state.FGColor)||"object"==x&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=x&&this._state.FGColor.indexOf(this.FGColor.Color)<0){if(this.btnFGColor.setColor(this.FGColor.Color),"object"==typeof this.FGColor.Color){for(w=!1,S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==this.FGColor.Color.effectValue){this.colorsFG.select(this.FGColor.Color,!0),w=!0;break}w||this.colorsFG.clearSelection()}else this.colorsFG.select(this.FGColor.Color,!0);this._state.FGColor=this.FGColor.Color}if((x=typeof this.BGColor.Color)!==(y=typeof this._state.BGColor)||"object"==x&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=x&&this._state.BGColor.indexOf(this.BGColor.Color)<0){if(this.btnBGColor.setColor(this.BGColor.Color),"object"==typeof this.BGColor.Color){for(w=!1,S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==this.BGColor.Color.effectValue){this.colorsBG.select(this.BGColor.Color,!0),w=!0;break}w||this.colorsBG.clearSelection()}else this.colorsBG.select(this.BGColor.Color,!0);this._state.BGColor=this.BGColor.Color}if((x=typeof(c=this.GradColor.colors[this.GradColor.currentIdx]))!==(y=typeof this._state.GradColor)||"object"==x&&(c.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(c.color)<0)||"object"!=x&&this._state.GradColor.indexOf(c)<0){if(this.btnGradColor.setColor(c),"object"==typeof c){for(w=!1,S=0;S<10;S++)if(Common.Utils.ThemeColor.ThemeValues[S]==c.effectValue){this.colorsGrad.select(c,!0),w=!0;break}w||this.colorsGrad.clearSelection()}else this.colorsGrad.select(c,!0);this._state.GradColor=c}this.chShadow.setDisabled(!!n.get_FromChart()),this.chShadow.setValue(!!n.asc_getShadow(),!0),this._noApply=!1}},btnDirectionRedraw:function(t,e){this.gradientColorsStr=e,i.each(this._viewDataLinear,(function(t){t.gradientColorsStr=e})),this._viewDataRadial.gradientColorsStr=this.gradientColorsStr,this.mnuDirectionPicker.store.each((function(t){t.set("gradientColorsStr",e)}),this),-1==this.typeGradient?this.btnDirection.$icon.css({background:"none"}):2==this.typeGradient?this.btnDirection.$icon.css({background:"radial-gradient("+e+")"}):this.btnDirection.$icon.css({background:"linear-gradient("+this.typeGradient+"deg, "+e+")"})},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textImageTexture,value:Asc.c_oAscFill.FILL_TYPE_BLIP},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#shape-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.fillControls.push(this.cmbFillSrc);this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",itemTemplate:i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="28" height="28" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join(""))}),this.cmbPattern.render(e("#shape-combo-pattern")),this.cmbPattern.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",(function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.fillControls.push(this.cmbPattern),this.btnSelectImage=new Common.UI.Button({parentEl:e("#shape-button-replace"),cls:"btn-text-menu-default",caption:this.textSelectImage,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this._arrFillType=[{displayValue:this.textStretch,value:Asc.c_oAscFillBlipType.STRETCH},{displayValue:this.textTile,value:Asc.c_oAscFillBlipType.TILE}],this.cmbFillType=new Common.UI.ComboBox({el:e("#shape-combo-fill-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrFillType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbFillType.setValue(this._arrFillType[0].value),this.cmbFillType.on("selected",i.bind(this.onFillTypeSelect,this)),this.fillControls.push(this.cmbFillType),this.numTransparency=new Common.UI.MetricSpinner({el:e("#shape-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.fillControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#shape-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.fillControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#shape-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#shape-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:Asc.c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:Asc.c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:e("#shape-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrGradType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",i.bind(this.onGradTypeSelect,this)),this.fillControls.push(this.cmbGradType),this._viewDataLinear=[{type:45,subtype:-1},{type:90,subtype:4},{type:135,subtype:5},{type:0,subtype:6,cls:"item-gradient-separator",selected:!0},{type:180,subtype:1},{type:315,subtype:2},{type:270,subtype:3},{type:225,subtype:7}],i.each(this._viewDataLinear,(function(e){e.gradientColorsStr=t.gradientColorsStr})),this._viewDataRadial=[{type:2,subtype:5,gradientColorsStr:this.gradientColorsStr}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-shape-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnDirection.on("render:after",(function(n){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-shape-menu-direction"),parentMenu:n.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background: <% if(type!=2) {%>linear-gradient(<%= type + 90 %>deg,<%= gradientColorsStr %>) <%} else {%> radial-gradient(<%= gradientColorsStr %>) <%}%>;"></div>')})})),this.btnDirection.render(e("#shape-button-direction")),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.fillControls.push(this.btnDirection),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#shape-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",(function(e,i){t.GradColor.currentIdx=i;var n=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(n),t.colorsGrad.select(n,!1);var o=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(o,!0)})),this.sldrGradient.on("thumbdblclick",(function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")})),this.sldrGradient.on("sortthumbs",(function(e,n){var o,s=[];i.each(n,(function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(o=i)})),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=o})),this.sldrGradient.on("addthumb",(function(e,i,n){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var o=t.sldrGradient.addNewThumb(i,n);t.GradColor.colors[t.GradColor.currentIdx]=o})),this.sldrGradient.on("removethumb",(function(e,n){if(t.sldrGradient.removeThumb(n),t.GradColor.values.splice(n,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var o=n>0?n-1:n;o=0===o&&t.GradColor.values.length>2?t.GradColor.values.length-2:o,t.GradColor.currentIdx=o}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)})),this.fillControls.push(this.sldrGradient),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#shape-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#shape-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.fillControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#shape-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.fillControls.push(this.btnRemoveGradientStep),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#shape-spin-gradient-angle"),step:10,width:60,defaultUnit:"°",value:"0 °",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#shape-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#shape-combo-border-type"),style:"width: 93px;",menuStyle:"min-width: 93px;",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",i.bind(this.onBorderTypeSelect,this)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderType=Asc.c_oDashType.solid,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.btnChangeShape=new Common.UI.Button({parentEl:e("#shape-btn-change"),cls:"btn-icon-default",iconCls:"btn-change-shape",menu:new Common.UI.Menu({menuAlign:"tr-br",cls:"menu-shapes menu-change-shape",items:[]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnChangeShape),this.btnRotate270=new Common.UI.Button({parentEl:e("#shape-button-270",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",value:0,hint:this.textHint270,dataHint:"1",dataHintDirection:"bottom"}),this.btnRotate270.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate270),this.btnRotate90=new Common.UI.Button({parentEl:e("#shape-button-90",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",value:1,hint:this.textHint90,dataHint:"1",dataHintDirection:"bottom"}),this.btnRotate90.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate90),this.btnFlipV=new Common.UI.Button({parentEl:e("#shape-button-flipv",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-vert",value:0,hint:this.textHintFlipV,dataHint:"1",dataHintDirection:"bottom"}),this.btnFlipV.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipV),this.btnFlipH=new Common.UI.Button({parentEl:e("#shape-button-fliph",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-hor",value:1,hint:this.textHintFlipH,dataHint:"1",dataHintDirection:"bottom"}),this.btnFlipH.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipH),this.chShadow=new Common.UI.CheckBox({el:e("#shape-checkbox-shadow"),labelText:this.strShadow,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chShadow.on("change",i.bind(this.onCheckShadow,this)),this.lockedControls.push(this.chShadow),e(this.el).on("click","#shape-advanced-link",i.bind(this.openAdvancedSettings,this)),this.linkAdvanced=e("#shape-advanced-link")},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls();var t=[0,1,3,2,4,53,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,49,50,51,52];this.patternViewData=[];for(var e=0;e<13;e++)for(var i=0;i<4;i++){var n=4*e+i;this.patternViewData[n]={offsetx:28*i,offsety:28*e,type:t[n]}}this.patternViewData.splice(this.patternViewData.length-2,2);for(e=0;e<this.patternViewData.length;e++)this.patternViewData[e].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type),this.onInitStandartTextures(),this.onApiAutoShapes(),this.UpdateThemeColors()},onInitStandartTextures:function(t){var n=this;if(t&&t.length>0&&(n._texturearray=[],i.each(t,(function(t){n._texturearray.push({imageUrl:t.asc_getImage(),name:n.textureNames[t.asc_getId()],type:t.asc_getId(),selected:!1})}))),n._texturearray&&!(n._texturearray.length<1)&&!this._initSettings&&!this.btnTexture){this.btnTexture=new Common.UI.ComboBox({el:e("#shape-combo-fill-texture"),template:i.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle" tabindex="0" data-toggle="dropdown">','<div class="form-control text" style="width: 90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big">'+this.textSelectTexture+"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret" />',"</button>","</div>"].join(""))}),this.textureMenu=new Common.UI.Menu({items:[{template:i.template('<div id="id-shape-menu-texture" style="width: 233px; margin: 0 5px;"></div>')}]}),this.textureMenu.render(e("#shape-combo-fill-texture")),this.fillControls.push(this.btnTexture);var o=function(t){new Common.UI.DataView({el:e("#id-shape-menu-texture"),restoreHeight:174,parentMenu:t,showLast:!1,store:new Common.UI.DataViewStore(n._texturearray||[]),itemTemplate:i.template('<div class="item-texture"><img src="<%= imageUrl %>" id="<%= id %>"></div>')}).on("item:click",i.bind(n.onSelectTexture,n)),t.off("show:before",o)};this.textureMenu.on("show:before",o)}},onSelectTexture:function(t,i,n){if(this._fromTextureCmb=!0,this.cmbFillType.setValue(this._arrFillType[1].value),this._fromTextureCmb=!1,this.api){var o=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),s.asc_putFill(new Asc.asc_CFillBlip),s.asc_getFill().asc_putType(Asc.c_oAscFillBlipType.TILE),s.asc_getFill().asc_putTextureId(n.get("type")),o.asc_putFill(s),this.imgprops.asc_putShapeProperties(o),this.api.asc_setGraphicObjectProps(this.imgprops)}e(this.btnTexture.el).find(".form-control").prop("innerHTML",n.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.btnChangeShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,n=Common.localStorage.getItem("sse-recent-shapes"),o=new Common.UI.MenuItem({template:i.template('<div id="id-change-shape-menu" class="menu-insertshape"></div>')});t.btnChangeShape.menu.addItem(o),t.btnChangeShape.shapePicker=new Common.UI.DataViewShape({el:e("#id-change-shape-menu"),itemTemplate:i.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>'),groups:t.application.getCollection("ShapeGroups"),parentMenu:t.btnChangeShape.menu,restoreHeight:652,textRecentlyUsed:t.textRecentlyUsed,recentShapes:n?JSON.parse(n):null,hideTextRect:t._state.isFromImage||t._state.isFromSmartArtInternal,hideLines:!0}),t.btnChangeShape.shapePicker.on("item:click",(function(e,i,n,o){t.api&&(t.api.asc_changeShapeType(n.get("data").shapeType),Common.NotificationCenter.trigger("edit:complete",t)),"click"!==o.type&&t.btnChangeShape.menu.hide()}))},onBtnRotateClick:function(t){var e=new Asc.asc_CShapeProperty;e.asc_putRotAdd(3.14159265358979*(1==t.options.value?90:270)/180),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)},onBtnFlipClick:function(t){var e=new Asc.asc_CShapeProperty;1==t.options.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)},onCheckShadow:function(t,e,i,n){if(this.api){var o=new Asc.asc_CShapeProperty;o.asc_putShadow("checked"==t.getValue()?new Asc.asc_CShadowProperty:null),this.imgprops.asc_putShapeProperties(o),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#shape-back-color-btn"),transparent:!0,color:"transparent",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.fillControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#shape-border-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnBorderColor),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",i.bind(this.onColorsBorderSelect,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#shape-foreground-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#shape-background-color-btn"),color:"ffffff",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this)),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#shape-gradient-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this))),this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()))},_pt2mm:function(t){return 25.4*t/72},_mm2pt:function(t){return 72*t/25.4},disableFillPanels:function(t){this._state.DisabledFillPanels!==t&&(this._state.DisabledFillPanels=t,i.each(this.fillControls,(function(e){e.setDisabled(t)})),this.lblTransparencyStart.toggleClass("disabled",t),this.lblTransparencyEnd.toggleClass("disabled",t),this.numGradientAngle.setDisabled(t||this.GradFillType!==Asc.c_oAscFillGradType.GRAD_LINEAR))},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillImageContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_BLIP),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",t===Asc.c_oAscFill.FILL_TYPE_NOFILL||null===t)},setLocked:function(t){this._locked=t},disableControls:function(t,e){this._initSettings||(this.disableFillPanels(t||e),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t)),this.btnFlipV.setDisabled(t||this._state.isFromSmartArtInternal),this.btnFlipH.setDisabled(t||this._state.isFromSmartArtInternal))},hideShapeOnlySettings:function(t){this._state.HideShapeOnlySettings!==t&&(this._state.HideShapeOnlySettings=t,this.ShapeOnlySettings.toggleClass("hidden",1==t))},hideChangeTypeSettings:function(t){this._state.HideChangeTypeSettings!==t&&(this._state.HideChangeTypeSettings=t,this.CanChangeType.toggleClass("hidden",1==t))},hideRotationSettings:function(t){this._state.HideRotationSettings!==t&&(this._state.HideRotationSettings=t,this.RotationSettings.toggleClass("hidden",1==t))},onPositionChange:function(t){var e=t.getNumberValue(),i=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],n=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,o=e<i||e>n;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=e;var s=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType);var l=[];this.GradColor.values.forEach((function(t){l.push(1e3*t)})),a.asc_getFill().asc_putPositions(l),s.asc_putFill(a),this.imgprops.asc_putShapeProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops),o&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onGradientAngleChange:function(t,e,i,n){if(this.api&&!this._noApply){var o=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),s.asc_putFill(new Asc.asc_CFillGrad),s.asc_getFill().asc_putGradType(this.GradFillType),s.asc_getFill().asc_putLinearAngle(6e4*t.getNumberValue()),s.asc_getFill().asc_putLinearScale(!0),o.asc_putFill(s),this.imgprops.asc_putShapeProperties(o),this.api.asc_setGraphicObjectProps(this.imgprops)}},txtNoBorders:"No Line",strStroke:"Stroke",strColor:"Color",strSize:"Size",strChange:"Change Autoshape",strFill:"Fill",textColor:"Color Fill",textImageTexture:"Picture or Texture",textTexture:"From Texture",textFromUrl:"From URL",textFromFile:"From File",textStretch:"Stretch",textTile:"Tile",txtCanvas:"Canvas",txtCarton:"Carton",txtDarkFabric:"Dark Fabric",txtGrain:"Grain",txtGranite:"Granite",txtGreyPaper:"Grey Paper",txtKnit:"Knit",txtLeather:"Leather",txtBrownPaper:"Brown Paper",txtPapyrus:"Papyrus",txtWood:"Wood",textAdvanced:"Show advanced settings",strTransparency:"Opacity",textNoFill:"No Fill",textSelectTexture:"Select",textGradientFill:"Gradient Fill",textPatternFill:"Pattern",strBackground:"Background color",strForeground:"Foreground color",strPattern:"Pattern",textEmptyPattern:"No Pattern",textLinear:"Linear",textRadial:"Radial",textDirection:"Direction",textStyle:"Style",textGradient:"Gradient Points",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt.",strType:"Type",textRotation:"Rotation",textRotate90:"Rotate 90°",textFlip:"Flip",textHint270:"Rotate 90° Counterclockwise",textHint90:"Rotate 90° Clockwise",textHintFlipV:"Flip Vertically",textHintFlipH:"Flip Horizontally",strShadow:"Show shadow",textFromStorage:"From Storage",textSelectImage:"Select Picture",textPosition:"Position",tipAddGradientPoint:"Add gradient point",tipRemoveGradientPoint:"Remove gradient point",textAngle:"Angle",textRecentlyUsed:"Recently Used"},SSE.Views.ShapeSettings||{}))})),define("text!spreadsheeteditor/main/app/template/TextArtSettings.template",[],(function(){return'<table cols="1">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textTemplate %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="" id="textart-combo-template" style="width: 100%; height: 64px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strFill %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="textart-combo-fill-src" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div id="textart-panel-color-fill" class="padding-small" style="width: 100%;">\r\n                <div id="textart-back-color-btn" style=""></div>\r\n            </div>\r\n            <div id="textart-panel-image-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="2" style="width: 100%;">\r\n                <tr>\r\n                    <td class="padding-small" width="50%">\r\n                        <button type="button" class="btn btn-text-default" id="textart-button-from-file" style="width:90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textFromFile %></button>\r\n                    </td>\r\n                    <td class="padding-small" width="50%">\r\n                        <button type="button" class="btn btn-text-default" id="textart-button-from-url" style="width:90px;float:right;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textFromUrl %></button>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: top">\r\n                        <div id="textart-combo-fill-type" style="width: 90px;"></div>\r\n                    </td>\r\n                    <td rowspan="2">\r\n                        <div style="width: 90px; height: 80px; padding: 14px 20px; border: 1px solid #AFAFAF; border-radius: 2px; background: #ffffff;float:right;">\r\n                            <div id="textart-texture-img" style="width: 50px;height: 50px;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: bottom">\r\n                        <label class="input-label" style=""><%= scope.textTexture %></label>\r\n                        <div id="textart-combo-fill-texture" style="width: 90px;"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id="textart-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <label class="input-label" style="margin-top: 3px;"><%= scope.strPattern %></label>\r\n                <div id="textart-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\r\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strForeground %></label>\r\n                    <div id="textart-foreground-color-btn" style="display: inline-block; float:right;"></div>\r\n                </div>\r\n                <div style="width: 100%; height: 25px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strBackground %></label>\r\n                    <div id="textart-background-color-btn" style="display: inline-block; float:right;"></div>\r\n                </div>\r\n            </div>\r\n            <div id="textart-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="3" style="margin-bottom: 10px;">\r\n                    <tr valign="top">\r\n                        <td colspan="2">\r\n                            <div>\r\n                                <label class="input-label" style=""><%= scope.textStyle %></label>\r\n                                <div id="textart-combo-grad-type" style="width: 100%;"></div>\r\n                            </div>\r\n                        </td>\r\n                        <td rowspan="2" style="width: 100%;">\r\n                            <div style="float: right;">\r\n                                <label class="input-label"><%= scope.textDirection %></label>\r\n                                <div id="textart-button-direction"></div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr valign="bottom">\r\n                        <td>\r\n                            <label class="input-label" style="margin-right: 5px;margin-bottom: 3px;"><%= scope.textAngle %></label>\r\n                        </td>\r\n                        <td>\r\n                            <div id="textart-spin-gradient-angle" style="display: inline-block; width: 60px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <label class="input-label" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <div id="textart-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\r\n                </div>\r\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\r\n                    <div style="display: flex;">\r\n                    <div style="">\r\n                        <label class="input-label" style=""><%= scope.strColor %></label>\r\n                        <div id="textart-gradient-color-btn"></div>\r\n                    </div>\r\n                    <div style="margin-left: 10px;">\r\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\r\n                        <div id="textart-gradient-position"></div>\r\n                    </div>\r\n                    </div>\r\n                    <div style="display:flex;padding-top:15px;">\r\n                        <div id="textart-gradient-add-step"></div>\r\n                        <div id="textart-gradient-remove-step"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="textart-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="textart-lbl-transparency-start">0</label>\r\n                    <div id="textart-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="textart-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="textart-spin-transparency" style="display: inline-block;float: right;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strStroke %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strSize %></label>\r\n            <div id="textart-combo-border-size" style="width: 93px;"></div>\r\n        </div>\r\n        <div style="display:inline-block;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strColor %></label>\r\n            <div id="textart-border-color-btn" style=""></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strType %></label>\r\n            <div id="textart-combo-border-type" style="width: 93px;"></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="textart-transform">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="textart-transform">\r\n        <td>\r\n            <label class="header"><%= scope.textTransform %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="textart-transform">\r\n        <td class="padding-small">\r\n            <div class="" id="textart-combo-transform" style="width: 100%; height: 42px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),define("spreadsheeteditor/main/app/view/TextArtSettings",["text!spreadsheeteditor/main/app/template/TextArtSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient","common/main/lib/view/ImageFromUrlDialog"],(function(t,e,i,n){"use strict";SSE.Views.TextArtSettings=n.View.extend(i.extend({el:"#id-textart-settings",template:i.template(t),events:{},options:{alias:"TextArtSettings"},initialize:function(){this._initSettings=!0,this._noApply=!0,this.imgprops=null,this.shapeprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this._texturearray=null,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Transparency:null,FillType:Asc.c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",BlipFillType:Asc.c_oAscFillBlipType.STRETCH,StrokeType:Asc.c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",StrokeBorderType:Asc.c_oDashType.solid,FGColor:"000000",BGColor:"ffffff",GradColor:"000000",GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,FormId:null,DisabledControls:!1,applicationPixelRatio:Common.Utils.applicationPixelRatio(),isFromSmartArtInternal:!1,HideTransformSettings:!1},this.lockedControls=[],this._locked=!1,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.BlipFillType=Asc.c_oAscFillBlipType.STRETCH,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.PatternFillType=0,this.FGColor={Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.BorderType=Asc.c_oDashType.solid,this.textureNames=[this.txtCanvas,this.txtCarton,this.txtDarkFabric,this.txtGrain,this.txtGranite,this.txtGreyPaper,this.txtKnit,this.txtLeather,this.txtBrownPaper,this.txtPapyrus,this.txtWood],this.render(),this.FillColorContainer=e("#textart-panel-color-fill"),this.FillImageContainer=e("#textart-panel-image-fill"),this.FillPatternContainer=e("#textart-panel-pattern-fill"),this.FillGradientContainer=e("#textart-panel-gradient-fill"),this.TransparencyContainer=e("#textart-panel-transparent-fill"),this.TransformSettings=e(".textart-transform"),this.gradientColorsStr="#000, #fff",this.typeGradient=90,SSE.getCollection("Common.Collections.TextArt").bind({reset:this.fillTextArt.bind(this)})},render:function(){e(this.el).html(this.template({scope:this})),e(window).on("resize",i.bind(this.onWindowResize,this))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_setInterfaceDrawImagePlaceTextArt("textart-texture-img"),this.api.asc_registerCallback("asc_onInitStandartTextures",i.bind(this.onInitStandartTextures,this))),this},onFillSrcSelect:function(t,e){switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,!this._noApply){var i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),a.asc_putFill(new Asc.asc_CFillSolid),a.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor("transparent"==this.ShapeColor.Color?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){i=new Asc.asc_TextArtProperties;if((a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(a.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),a.asc_getFill().asc_putLinearScale(!0)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){this.GradColor.values=[0,100],this.GradColor.colors=[this.GradColor.colors[0],this.GradColor.colors[this.GradColor.colors.length-1]],this.GradColor.currentIdx=0;var n=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();n="ffffff"===n&&"ffffff"===o?{color:"4f81bd",effectId:24}:this.GradColor.colors[0],a.asc_getFill().asc_putPositions([1e3*this.GradColor.values[0],1e3*this.GradColor.values[1]]),a.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(n),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])}i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_BLIP:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_BLIP;break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),a.asc_putFill(new Asc.asc_CFillHatch),a.asc_getFill().asc_putPatternType(this.PatternFillType);var s=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();s="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===s?{color:"4f81bd",effectId:24}:this.FGColor.Color,a.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(s)),a.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,!this._noApply){var a;i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),a.asc_putFill(null),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBackSelect:function(t,e){if(this.ShapeColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;"transparent"==this.ShapeColor.Color?(n.asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),n.asc_putFill(null)):(n.asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),n.asc_putFill(new Asc.asc_CFillSolid),n.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onPatternSelect:function(t,e){if(this.api&&!this._noApply){this.PatternFillType=e.get("type");var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),n.asc_putFill(new Asc.asc_CFillHatch),n.asc_getFill().asc_putPatternType(this.PatternFillType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),n.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(t,e){if(this.FGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),n.asc_putFill(new Asc.asc_CFillHatch),n.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.asc_getFill().asc_putPatternType(this.PatternFillType),n.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(t,e){if(this.BGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),n.asc_putFill(new Asc.asc_CFillHatch),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(n.asc_getFill().asc_putPatternType(this.PatternFillType),n.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color))),n.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onFillTypeSelect:function(t,e){if(this.BlipFillType=e.value,this.api&&!0!==this._fromTextureCmb&&this.OriginalFillType==Asc.c_oAscFill.FILL_TYPE_BLIP){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),n.asc_putFill(new Asc.asc_CFillBlip),n.asc_getFill().asc_putType(this.BlipFillType),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumTransparencyChange:function(t,e,i,n){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var o=t.getNumberValue(),s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putTransparent(2.55*o),s.asc_putFill(a),this.shapeprops.put_TextArtProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops)}},onTransparencyChange:function(t,e,n){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CShapeFill;e.asc_putTransparent(2.55*this._sliderChanged),t.asc_putFill(e),this.shapeprops.put_TextArtProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=void 0}},onGradTypeSelect:function(t,e){if(this.GradFillType=e.value,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;e=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(e,!0),this.typeGradient=e?this.GradLinearDirectionType+90:-1,this.numGradientAngle.setValue(this.GradLinearDirectionType,!0),this.numGradientAngle.setDisabled(this._locked)}else this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.typeGradient=this._viewDataRadial[this.GradRadialDirectionIdx].type:this.typeGradient=-1,this.numGradientAngle.setValue(0,!0),this.numGradientAngle.setDisabled(!0));if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),n.asc_putFill(new Asc.asc_CFillGrad),n.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),n.asc_getFill().asc_putLinearScale(!0)),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectGradient:function(t,e,n,o){if(!this._noApply){var s={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;s=o.toJSON()}else s=o;if(this.GradFillType===Asc.c_oAscFillGradType.GRAD_LINEAR?(this.GradLinearDirectionType=s.type,this.typeGradient=s.type+90):(this.GradRadialDirectionIdx=0,this.typeGradient=s.type),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?this.GradLinearDirectionType=s.type:this.GradRadialDirectionIdx=0,this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.numGradientAngle.setValue(s.type,!0);var a=new Asc.asc_TextArtProperties,l=new Asc.asc_CShapeFill;l.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),l.asc_putFill(new Asc.asc_CFillGrad),l.asc_getFill().asc_putGradType(this.GradFillType),l.asc_getFill().asc_putLinearAngle(6e4*s.type),l.asc_getFill().asc_putLinearScale(!0),a.asc_putFill(l),this.shapeprops.put_TextArtProperties(a),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)}},onColorsGradientSelect:function(t,e){if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof e?e.color:e)),this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CShapeFill;n.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),n.asc_putFill(new Asc.asc_CFillGrad),n.asc_getFill().asc_putGradType(this.GradFillType);var o=[];this.GradColor.colors.forEach((function(t){o.push(Common.Utils.ThemeColor.getRgbColor(t))})),n.asc_getFill().asc_putColors(o),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(n.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),n.asc_getFill().asc_putLinearScale(!0)),o=[],this.GradColor.values.forEach((function(t){o.push(1e3*t)})),n.asc_getFill().asc_putPositions(o)),i.asc_putFill(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientChange:function(t,e,n){this.GradColor.values=t.getValues(),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx],!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CShapeFill;e.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),e.asc_putFill(new Asc.asc_CFillGrad),e.asc_getFill().asc_putGradType(this.GradFillType);var i=[];this.GradColor.values.forEach((function(t){i.push(1e3*t)})),e.asc_getFill().asc_putPositions(i),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(e.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),e.asc_getFill().asc_putLinearScale(!0)),i=[],this.GradColor.colors.forEach((function(t){i.push(Common.Utils.ThemeColor.getRgbColor(t))})),e.asc_getFill().asc_putColors(i)),t.asc_putFill(e),this.shapeprops.put_TextArtProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?0:Math.max(0,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply){var e=new Asc.asc_TextArtProperties,i=new Asc.asc_CStroke;this.BorderSize<1e-5?(i.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(i.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),"transparent"==this.BorderColor.Color||"transparent"==this.BorderColor.Color.color?i.asc_putColor(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):this._state.StrokeType!=Asc.c_oAscStrokeType.STROKE_NONE&&null!==this._state.StrokeType||i.asc_putColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),i.asc_putPrstDash(this.BorderType),i.asc_putWidth(this._pt2mm(this.BorderSize))),e.asc_putLine(i),this.shapeprops.put_TextArtProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this)},onBorderSizeChanged:function(t,e,n,o){var s=this;if(t){var a=parseFloat(n.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(n.value)||a<0||a>1584)&&(this._state.StrokeType=this._state.StrokeWidth=-1,setTimeout((function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}})}),10))}else this.applyBorderSize(n.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onBorderTypeSelect:function(t,e){if(this.BorderType=e.value,this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(n.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),n.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.put_width(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.asc_putLine(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBorderSelect:function(t,e){if(this.BorderColor={Value:1,Color:e},this.api&&this.BorderSize>0&&!this._noApply){var i=new Asc.asc_TextArtProperties,n=new Asc.asc_CStroke;this.BorderSize<1e-5?n.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE):(n.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),n.asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),n.asc_putWidth(this._pt2mm(this.BorderSize)),n.asc_putPrstDash(this.BorderType)),i.asc_putLine(n),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},insertFromUrl:function(){var t=this;new Common.Views.ImageFromUrlDialog({handler:function(e,n){if("ok"==e&&t.api){var o=n.replace(/ /g,"");if(!i.isEmpty(o)&&null!==t.BlipFillType){var s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),a.asc_putFill(new Asc.asc_CFillBlip),a.asc_getFill().asc_putType(t.BlipFillType),a.asc_getFill().asc_putUrl(o),s.asc_putFill(a),t.shapeprops.put_TextArtProperties(s),t.api.asc_setGraphicObjectProps(t.imgprops)}}Common.NotificationCenter.trigger("edit:complete",t)}}).show()},ChangeSettings:function(t){if(null==this.imgprops&&(this.imgprops=new Asc.asc_CImgProperty,this.imgprops.asc_putShapeProperties(new Asc.asc_CShapeProperty),this.shapeprops=this.imgprops.asc_getShapeProperties()),this._initSettings&&this.createDelayedElements(),this._state.isFromSmartArtInternal=t.asc_getShapeProperties()&&t.asc_getShapeProperties().asc_getFromSmartArtInternal(),this.hideTransformSettings(this._state.isFromSmartArtInternal),t&&t.asc_getShapeProperties()&&t.asc_getShapeProperties().get_TextArtProperties()){var n=t.asc_getShapeProperties().get_TextArtProperties();this._noApply=!0,this.disableControls(this._locked);var o=null,s=n.asc_getFill(),a=s?s.asc_getType():null,l=null;if(s){var r=s.asc_getTransparent();(Math.abs(this._state.Transparency-r)>.001||Math.abs(this.numTransparency.getNumberValue()-r)>.001||(null===this._state.Transparency||null===r)&&(this._state.Transparency!==r||this.numTransparency.getNumberValue()!==r))&&(void 0!==r&&(this.sldrTransparency.setValue(null===r?100:r/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=r)}if(null==s||null===a)this.OriginalFillType=null;else if(a==Asc.c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(a==Asc.c_oAscFill.FILL_TYPE_SOLID)(l=(s=s.asc_getFill()).asc_getColor())?l.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB()),effectValue:l.asc_getValue()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.FGColor="transparent"!==this.ShapeColor.Color?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color)}:{Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.GradColor.colors[0]="transparent"!==this.ShapeColor.Color?Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color):"000000",this.GradColor.colors[this.GradColor.colors.length-1]="ffffff";else if(a==Asc.c_oAscFill.FILL_TYPE_BLIP)s=s.asc_getFill(),this.BlipFillType=s.asc_getType(),this._state.BlipFillType!==this.BlipFillType&&(this.BlipFillType==Asc.c_oAscFillBlipType.STRETCH||this.BlipFillType==Asc.c_oAscFillBlipType.TILE?this.cmbFillType.setValue(this.BlipFillType):this.cmbFillType.setValue(""),this._state.BlipFillType=this.BlipFillType),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_BLIP;else if(a==Asc.c_oAscFill.FILL_TYPE_PATT){if(s=s.asc_getFill(),this.PatternFillType=s.asc_getPatternType(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();o=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(o),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}(l=s.asc_getColorFg())?l.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB()),effectValue:l.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB())}:this.FGColor={Value:1,Color:"000000"},(l=s.asc_getColorBg())?l.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB()),effectValue:l.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT,this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[this.GradColor.colors.length-1]="ffffff"}else if(a==Asc.c_oAscFill.FILL_TYPE_GRAD){var c=(s=s.asc_getFill()).asc_getGradType();if(this._state.GradFillType===c&&this.GradFillType===c||(this.GradFillType=c,o=void 0,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),o=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,o.attributes)):(this.cmbGradType.setValue(""),this.typeGradient=-1),this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){var d=Math.floor(s.asc_getLinearAngle()/6e4);if(Math.abs(this.GradLinearDirectionType-d)>.001){this.GradLinearDirectionType=d;var h=this.mnuDirectionPicker.store.findWhere({type:d});this.mnuDirectionPicker.selectRecord(h,!0),this.typeGradient=h?d+90:-1,this.numGradientAngle.setValue(d,!0)}}else this.numGradientAngle.setValue(0,!0);var p=this,m=s.asc_getColors(),u=s.asc_getPositions(),g=m?m.length:this.GradColor.colors.length;this.sldrGradient.setThumbs(g),this.GradColor.colors.length>g&&(this.GradColor.colors.splice(g,this.GradColor.colors.length-g),this.GradColor.values.splice(g,this.GradColor.colors.length-g),this.GradColor.currentIdx=0),m&&m.forEach((function(t,e){t?t.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?(p.GradColor.colors[e]={color:Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()),effectValue:t.asc_getValue()},Common.Utils.ThemeColor.colorValue2EffectId(p.GradColor.colors[e])):p.GradColor.colors[e]=Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()):p.GradColor.colors[e]="000000";var i=u[e];null!==i&&(i/=1e3,p.GradColor.values[e]=i)}));for(var f=[],b=this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?1:.7,C=0;C<g;C++)p.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof p.GradColor.colors[C]?p.GradColor.colors[C].color:p.GradColor.colors[C]),C),p.sldrGradient.setValue(C,p.GradColor.values[C]),f.push(p.sldrGradient.getColorValue(C)+" "+p.sldrGradient.getValue(C)*b+"%");this.btnDirectionRedraw(p.sldrGradient,f.join(", ")),(i.isUndefined(p.GradColor.currentIdx)||p.GradColor.currentIdx>=this.GradColor.colors.length)&&(p.GradColor.currentIdx=0),p.sldrGradient.setActiveThumb(p.GradColor.currentIdx),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx]),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:this.GradColor.colors[0]},this.BGColor={Value:1,Color:"ffffff"},this.ShapeColor={Value:1,Color:this.GradColor.colors[0]}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType)),e(this.btnTexture.el).find(".form-control").prop("innerHTML",this.textSelectTexture);var v=typeof this.ShapeColor.Color,_=typeof this._state.ShapeColor;if(v!==_||"object"==v&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||"object"!=v&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0){if(this.btnBackColor.setColor(this.ShapeColor.Color),"object"==typeof this.ShapeColor.Color){for(var x=!1,y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.ShapeColor.Color.effectValue){this.colorsBack.select(this.ShapeColor.Color,!0),x=!0;break}x||this.colorsBack.clearSelection()}else this.colorsBack.select(this.ShapeColor.Color,!0);this._state.ShapeColor=this.ShapeColor.Color}var w,S=n.asc_getLine(),A=S?S.asc_getType():null,k="transparent"==this._state.StrokeColor&&"transparent"!==this.BorderColor.Color;if(S?(A==Asc.c_oAscStrokeType.STROKE_COLOR&&(l=S.asc_getColor())?l.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB()),effectValue:l.asc_getValue()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(l.asc_getR(),l.asc_getG(),l.asc_getB())}:this.BorderColor={Value:1,Color:"transparent"},w=S.asc_getPrstDash()):this.BorderColor={Value:0,Color:"transparent"},v=typeof this.BorderColor.Color,_=typeof this._state.StrokeColor,k||v!==_||"object"==v&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||"object"!=v&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||"object"==typeof this.btnBorderColor.color)){if(this.btnBorderColor.setColor(this.BorderColor.Color),"object"==typeof this.BorderColor.Color){for(x=!1,y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.BorderColor.Color.effectValue){this.colorsBorder.select(this.BorderColor.Color,!0),x=!0;break}x||this.colorsBorder.clearSelection()}else this.colorsBorder.select(this.BorderColor.Color,!0);this._state.StrokeColor=this.BorderColor.Color}if(this._state.StrokeType!==A||A==Asc.c_oAscStrokeType.STROKE_COLOR){if(A==Asc.c_oAscStrokeType.STROKE_COLOR){var T=S.asc_getWidth(),I=Math.abs(this._state.StrokeWidth-T)<1e-5&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-T)>1e-5||I||(null===this._state.StrokeWidth||null===T)&&this._state.StrokeWidth!==T){this._state.StrokeWidth=T,null!==T&&(T=this._mm2pt(T));var E=null===T?T:i.find(this.cmbBorderSize.store.models,(function(t){if(T<t.attributes.value+1e-5&&T>t.attributes.value-1e-5)return!0}));E?this.cmbBorderSize.selectRecord(E):this.cmbBorderSize.setValue(null!==T?parseFloat(T.toFixed(2))+" "+this.txtPt:""),this.BorderSize=T}}else A==Asc.c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=A}if(this._state.StrokeBorderType!==w&&(this.BorderType=this._state.StrokeBorderType=w,this.cmbBorderType.setValue(w)),(v=typeof this.FGColor.Color)!==(_=typeof this._state.FGColor)||"object"==v&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=v&&this._state.FGColor.indexOf(this.FGColor.Color)<0){if(this.btnFGColor.setColor(this.FGColor.Color),"object"==typeof this.FGColor.Color){for(x=!1,y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.FGColor.Color.effectValue){this.colorsFG.select(this.FGColor.Color,!0),x=!0;break}x||this.colorsFG.clearSelection()}else this.colorsFG.select(this.FGColor.Color,!0);this._state.FGColor=this.FGColor.Color}if((v=typeof this.BGColor.Color)!==(_=typeof this._state.BGColor)||"object"==v&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=v&&this._state.BGColor.indexOf(this.BGColor.Color)<0){if(this.btnBGColor.setColor(this.BGColor.Color),"object"==typeof this.BGColor.Color){for(x=!1,y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.BGColor.Color.effectValue){this.colorsBG.select(this.BGColor.Color,!0),x=!0;break}x||this.colorsBG.clearSelection()}else this.colorsBG.select(this.BGColor.Color,!0);this._state.BGColor=this.BGColor.Color}if((v=typeof(l=this.GradColor.colors[this.GradColor.currentIdx]))!==(_=typeof this._state.GradColor)||"object"==v&&(l.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(l.color)<0)||"object"!=v&&this._state.GradColor.indexOf(l)<0){if(this.btnGradColor.setColor(l),"object"==typeof l){for(x=!1,y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==l.effectValue){this.colorsGrad.select(l,!0),x=!0;break}x||this.colorsGrad.clearSelection()}else this.colorsGrad.select(l,!0);this._state.GradColor=l}var D=n.asc_getForm();if(this._state.FormId!==D){this.cmbTransform.suspendEvents();o=this.cmbTransform.menuPicker.store.findWhere({type:D});this.cmbTransform.menuPicker.selectRecord(o),this.cmbTransform.resumeEvents(),this._state.FormId=D}this._noApply=!1}},btnDirectionRedraw:function(t,e){this.gradientColorsStr=e,i.each(this._viewDataLinear,(function(t){t.gradientColorsStr=e})),this._viewDataRadial.gradientColorsStr=this.gradientColorsStr,this.mnuDirectionPicker.store.each((function(t){t.set("gradientColorsStr",e)}),this),-1==this.typeGradient?this.btnDirection.$icon.css({background:"none"}):2==this.typeGradient?this.btnDirection.$icon.css({background:"radial-gradient("+e+")"}):this.btnDirection.$icon.css({background:"linear-gradient("+this.typeGradient+"deg, "+e+")"})},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textImageTexture,value:Asc.c_oAscFill.FILL_TYPE_BLIP},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#textart-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.lockedControls.push(this.cmbFillSrc);this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",itemTemplate:i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="28" height="28" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join(""))}),this.cmbPattern.render(e("#textart-combo-pattern")),this.cmbPattern.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",(function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbPattern),this.btnInsertFromFile=new Common.UI.Button({el:e("#textart-button-from-file")}),this.lockedControls.push(this.btnInsertFromFile),this.btnInsertFromUrl=new Common.UI.Button({el:e("#textart-button-from-url")}),this.lockedControls.push(this.btnInsertFromUrl),this.btnInsertFromFile.on("click",i.bind((function(t){this.api&&this.api.asc_changeArtImageFromFile(this.BlipFillType),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.btnInsertFromUrl.on("click",i.bind(this.insertFromUrl,this)),this._arrFillType=[{displayValue:this.textStretch,value:Asc.c_oAscFillBlipType.STRETCH},{displayValue:this.textTile,value:Asc.c_oAscFillBlipType.TILE}],this.cmbFillType=new Common.UI.ComboBox({el:e("#textart-combo-fill-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrFillType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbFillType.setValue(this._arrFillType[0].value),this.cmbFillType.on("selected",i.bind(this.onFillTypeSelect,this)),this.lockedControls.push(this.cmbFillType),this.numTransparency=new Common.UI.MetricSpinner({el:e("#textart-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.lockedControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#textart-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.lockedControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#textart-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#textart-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:Asc.c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:Asc.c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:e("#textart-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrGradType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",i.bind(this.onGradTypeSelect,this)),this.lockedControls.push(this.cmbGradType),this._viewDataLinear=[{type:45,subtype:-1},{type:90,subtype:4},{type:135,subtype:5},{type:0,subtype:6,cls:"item-gradient-separator",selected:!0},{type:180,subtype:1},{type:315,subtype:2},{type:270,subtype:3},{type:225,subtype:7}],i.each(this._viewDataLinear,(function(e){e.gradientColorsStr=t.gradientColorsStr})),this._viewDataRadial=[{type:2,subtype:5,gradientColorsStr:this.gradientColorsStr}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-textart-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnDirection.on("render:after",(function(n){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-textart-menu-direction"),parentMenu:n.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background: <% if(type!=2) {%>linear-gradient(<%= type + 90 %>deg,<%= gradientColorsStr %>) <%} else {%> radial-gradient(<%= gradientColorsStr %>) <%}%>;"></div>')})})),this.btnDirection.render(e("#textart-button-direction")),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.lockedControls.push(this.btnDirection),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#textart-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",(function(e,i){t.GradColor.currentIdx=i;var n=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(n),t.colorsGrad.select(n,!1);var o=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(o,!0)})),this.sldrGradient.on("thumbdblclick",(function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")})),this.sldrGradient.on("sortthumbs",(function(e,n){var o,s=[];i.each(n,(function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(o=i)})),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=o})),this.sldrGradient.on("addthumb",(function(e,i,n){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var o=t.sldrGradient.addNewThumb(i,n);t.GradColor.colors[t.GradColor.currentIdx]=o})),this.sldrGradient.on("removethumb",(function(e,n){if(t.sldrGradient.removeThumb(n),t.GradColor.values.splice(n,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var o=n>0?n-1:n;o=0===o&&t.GradColor.values.length>2?t.GradColor.values.length-2:o,t.GradColor.currentIdx=o}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)})),this.lockedControls.push(this.sldrGradient),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#textart-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#textart-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.lockedControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#textart-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.lockedControls.push(this.btnRemoveGradientStep),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#textart-spin-gradient-angle"),step:10,width:60,defaultUnit:"°",value:"0 °",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#textart-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#textart-combo-border-type"),style:"width: 93px;",menuStyle:"min-width: 93px;",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",i.bind(this.onBorderTypeSelect,this)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderType=Asc.c_oDashType.solid,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.cmbTransform=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-textart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbTransform.render(e("#textart-combo-transform")),this.cmbTransform.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbTransform.on("click",i.bind(this.onTransformSelect,this)),this.cmbTransform.openButton.menu.on("show:after",(function(){t.cmbTransform.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbTransform)},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls();var t=[0,1,3,2,4,53,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,49,50,51,52];this.patternViewData=[];for(var e=0;e<13;e++)for(var i=0;i<4;i++){var n=4*e+i;this.patternViewData[n]={offsetx:28*i,offsety:28*e,type:t[n]}}this.patternViewData.splice(this.patternViewData.length-2,2);for(e=0;e<this.patternViewData.length;e++)this.patternViewData[e].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type),this.UpdateThemeColors(),this.onInitStandartTextures(),this.fillTextArt(),this.fillTransform(this.api.asc_getPropertyEditorTextArts())},onInitStandartTextures:function(t){var n=this;if(t&&t.length>0&&(n._texturearray=[],i.each(t,(function(t){n._texturearray.push({imageUrl:t.get_image(),name:n.textureNames[t.get_id()],type:t.get_id(),selected:!1})}))),n._texturearray&&!(n._texturearray.length<1)&&!this._initSettings&&!this.btnTexture){this.btnTexture=new Common.UI.ComboBox({el:e("#textart-combo-fill-texture"),template:i.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle" tabindex="0" data-toggle="dropdown">','<div class="form-control text" style="width: 90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big">'+this.textSelectTexture+"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret" />',"</button>","</div>"].join(""))}),this.textureMenu=new Common.UI.Menu({items:[{template:i.template('<div id="id-textart-menu-texture" style="width: 233px; margin: 0 5px;"></div>')}]}),this.textureMenu.render(e("#textart-combo-fill-texture")),this.lockedControls.push(this.btnTexture);var o=function(t){new Common.UI.DataView({el:e("#id-textart-menu-texture"),restoreHeight:174,parentMenu:t,showLast:!1,store:new Common.UI.DataViewStore(n._texturearray||[]),itemTemplate:i.template('<div><img src="<%= imageUrl %>" id="<%= id %>"></div>')}).on("item:click",i.bind(n.onSelectTexture,n)),t.off("show:before",o)};this.textureMenu.on("show:before",o)}},onSelectTexture:function(t,i,n){if(this._fromTextureCmb=!0,this.cmbFillType.setValue(this._arrFillType[1].value),this._fromTextureCmb=!1,this.api){var o=new Asc.asc_TextArtProperties,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),s.asc_putFill(new Asc.asc_CFillBlip),s.asc_getFill().asc_putType(Asc.c_oAscFillBlipType.TILE),s.asc_getFill().asc_putTextureId(n.get("type")),o.asc_putFill(s),this.shapeprops.put_TextArtProperties(o),this.api.asc_setGraphicObjectProps(this.imgprops)}e(this.btnTexture.el).find(".form-control").prop("innerHTML",n.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},fillTextArt:function(){if(!this._initSettings){var t=this;this.cmbTextArt||(this.cmbTextArt=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,showLast:!1,cls:"combo-textart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbTextArt.render(e("#textart-combo-template")),this.cmbTextArt.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbTextArt.on("click",i.bind(this.onTextArtSelect,this)),this.cmbTextArt.openButton.menu.on("show:after",(function(){t.cmbTextArt.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbTextArt));var n=this.application.getCollection("Common.Collections.TextArt").models,o=this.cmbTextArt.menuPicker.store.length;if(n.length<1)SSE.getController("Main").fillTextArt(this.api.asc_getTextArtPreviews());else if(o>0&&o==n.length){var s=this.cmbTextArt.menuPicker.store.models;i.each(n,(function(t,e){s[e].set("imageUrl",t.get("imageUrl"))}))}else this.cmbTextArt.menuPicker.store.reset(n),this.cmbTextArt.menuPicker.store.length>0&&this.cmbTextArt.fillComboView(this.cmbTextArt.menuPicker.store.at(0))}},onTextArtSelect:function(t,e){if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties;i.asc_putStyle(e.get("data")),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},fillTransform:function(t){if(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push({imageUrl:n.Image,type:n.Type,selected:!1})}this.cmbTransform.menuPicker.store.reset(e),this.cmbTransform.menuPicker.store.length>0&&this.cmbTransform.fillComboView(this.cmbTransform.menuPicker.store.at(0),!0)}},onTransformSelect:function(t,e){if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties;i.asc_putForm(e.get("type")),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#textart-border-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnBorderColor),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",i.bind(this.onColorsBorderSelect,this)),this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#textart-back-color-btn"),transparent:!0,color:"transparent",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.lockedControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#textart-foreground-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#textart-background-color-btn"),color:"ffffff",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this)),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#textart-gradient-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this))),this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()))},_pt2mm:function(t){return 25.4*t/72},_mm2pt:function(t){return 72*t/25.4},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillImageContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_BLIP),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",t===Asc.c_oAscFill.FILL_TYPE_NOFILL||null===t)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.numGradientAngle.setDisabled(t||this.GradFillType!==Asc.c_oAscFillGradType.GRAD_LINEAR))},onPositionChange:function(t){var e=t.getNumberValue(),i=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],n=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,o=e<i||e>n;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=e;var s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType);var l=[];this.GradColor.values.forEach((function(t){l.push(1e3*t)})),a.asc_getFill().asc_putPositions(l),s.asc_putFill(a),this.shapeprops.put_TextArtProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops),o&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onGradientAngleChange:function(t,e,i,n){if(this.api&&!this._noApply){var o=new Asc.asc_TextArtProperties,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),s.asc_putFill(new Asc.asc_CFillGrad),s.asc_getFill().asc_putGradType(this.GradFillType),s.asc_getFill().asc_putLinearAngle(6e4*t.getNumberValue()),s.asc_getFill().asc_putLinearScale(!0),o.asc_putFill(s),this.shapeprops.put_TextArtProperties(o),this.api.asc_setGraphicObjectProps(this.imgprops)}},onWindowResize:function(){this._initSettings||this._state.applicationPixelRatio===Common.Utils.applicationPixelRatio()||this.fillTransform(this.api.asc_getPropertyEditorTextArts()),this._state.applicationPixelRatio=Common.Utils.applicationPixelRatio()},hideTransformSettings:function(t){this._state.HideTransformSettings!==t&&(this._state.HideTransformSettings=t,this.TransformSettings.toggleClass("hidden",!0===t))},txtNoBorders:"No Line",strStroke:"Stroke",strColor:"Color",strSize:"Size",strFill:"Fill",textColor:"Color Fill",textImageTexture:"Picture or Texture",textTexture:"From Texture",textFromUrl:"From URL",textFromFile:"From File",textStretch:"Stretch",textTile:"Tile",txtCanvas:"Canvas",txtCarton:"Carton",txtDarkFabric:"Dark Fabric",txtGrain:"Grain",txtGranite:"Granite",txtGreyPaper:"Grey Paper",txtKnit:"Knit",txtLeather:"Leather",txtBrownPaper:"Brown Paper",txtPapyrus:"Papyrus",txtWood:"Wood",strTransparency:"Opacity",textNoFill:"No Fill",textSelectTexture:"Select",textGradientFill:"Gradient Fill",textPatternFill:"Pattern",strBackground:"Background color",strForeground:"Foreground color",strPattern:"Pattern",textEmptyPattern:"No Pattern",textLinear:"Linear",textRadial:"Radial",textDirection:"Direction",textStyle:"Style",textGradient:"Gradient Points",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt.",textTransform:"Transform",textTemplate:"Template",strType:"Type",textPosition:"Position",tipAddGradientPoint:"Add gradient point",tipRemoveGradientPoint:"Remove gradient point",textAngle:"Angle"},SSE.Views.TextArtSettings||{}))})),define("text!spreadsheeteditor/main/app/template/TableSettings.template",[],(function(){return'<table cols="2">\n    <tr>\n        <td width="50%">\n            <label class="header"><%= scope.textRows %></label>\n        </td>\n        <td width="50%">\n            <label class="header"><%= scope.textColumns %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="table-checkbox-header"></div>\n        </td>\n        <td class="padding-small">\n            <div id="table-checkbox-first"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="table-checkbox-total"></div>\n        </td>\n        <td class="padding-small">\n            <div id="table-checkbox-last"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="table-checkbox-banded"></div>\n        </td>\n        <td class="padding-small">\n            <div id="table-checkbox-col-banded"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div id="table-checkbox-filter"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textTemplate %></label>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div class="" id="table-btn-template" style="width: 100%; height: 52px;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr class="hidden">\n        <td colspan=2>\n            <label class="header"><%= scope.textTableName %></label>\n        </td>\n    </tr>\n    <tr class="hidden">\n        <td colspan=2 class="padding-small">\n            <div id="table-txt-name" class="input-row"  style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-select-data" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-edit" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n</table>\n<table cols="2">\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="header"><%= scope.textActions %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-rem-duplicates" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-convert-range" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-slicer" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="pivot-only">\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-pivot" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td align="center" colspan=2>\n            <label class="link" id="table-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("text!spreadsheeteditor/main/app/template/TableSettingsAdvanced.template",[],(function(){return'<div id="id-adv-table-alttext" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" width="100%">\n            <tr>\n                <td class="padding-large">\n                    <label class="header"><%= scope.textAltTitle %></label>\n                    <div id="table-advanced-alt-title"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label class="header"><%= scope.textAltDescription %></label>\n                    <textarea id="table-advanced-alt-description" class="form-control" style="width: 100%; height: 70px;"></textarea>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label><%= scope.textAltTip %></label>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),define("spreadsheeteditor/main/app/view/TableSettingsAdvanced",["text!spreadsheeteditor/main/app/template/TableSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/InputField"],(function(t){"use strict";SSE.Views.TableSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:300,height:342,toggleGroup:"table-adv-settings-group",properties:null,storageName:"sse-table-settings-adv-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-table-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._originalProps=this.options.tableProps,this._changedProps=null},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.inputAltTitle=new Common.UI.InputField({el:$("#table-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",(function(){t.isAltTitleChanged=!0})),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown((function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0})),this.afterRender()},getFocusedComponents:function(){return[this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){if(0===e)i.inputAltTitle.focus()}),10)},afterRender:function(){if(this._setDefaults(this._originalProps),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},_setDefaults:function(t){if(t){var e=t.asc_getTitle();this.inputAltTitle.setValue(e||""),e=t.asc_getDescription(),this.textareaAltDescription.val(e||"")}},getSettings:function(){if(this.isAltTitleChanged||this.isAltDescChanged){var t=new Asc.AdvancedTableInfoSettings;return t.asc_setTitle(this.inputAltTitle.getValue()),t.asc_setDescription(this.textareaAltDescription.val()),t}},textTitle:"Table - Advanced Settings",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table."},SSE.Views.TableSettingsAdvanced||{}))})),define("spreadsheeteditor/main/app/view/TableSettings",["text!spreadsheeteditor/main/app/template/TableSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/CheckBox","common/main/lib/component/ComboDataView","spreadsheeteditor/main/app/view/TableOptionsDialog","spreadsheeteditor/main/app/view/TableSettingsAdvanced","spreadsheeteditor/main/app/view/SlicerAddDialog"],(function(t,e,i,n){"use strict";SSE.Views.TableSettings=n.View.extend(i.extend({el:"#id-table-settings",template:i.template(t),events:{},options:{alias:"TableSettings"},initialize:function(){this._initSettings=!0,this._state={TableName:"",TemplateName:"",Range:"",CheckHeader:!1,CheckTotal:!1,CheckBanded:!1,CheckFirst:!1,CheckLast:!1,CheckColBanded:!1,CheckFilter:!1,DisabledControls:!1,TableNameError:!1},this.lockedControls=[],this._locked=!1,this.wsLock=!1,this.wsProps=[],this.isEditCell=!1,this._originalProps=null,this._noApply=!1,this.render()},onCheckTemplateChange:function(t,e,i,n,o,s){this._state[e]=void 0,this.api&&this.api.asc_changeFormatTableInfo(this._state.TableName,t,"checked"==n),Common.NotificationCenter.trigger("edit:complete",this)},onTableTemplateSelect:function(t,e,i,n){this.api&&!this._noApply&&this.api.asc_changeAutoFilter(this._state.TableName,Asc.c_oAscChangeFilterOptions.style,n.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},onEditClick:function(t,e,i){this.api&&(e.options.idx>=0&&e.options.idx<4?this.api.asc_changeSelectionFormatTable(this._state.TableName,e.value):e.options.idx>=4&&e.options.idx<8?this.api.asc_insertCellsInTable(this._state.TableName,e.value):this.api.asc_deleteCellsInTable(this._state.TableName,e.value)),Common.NotificationCenter.trigger("edit:complete",this)},onTableNameChanged:function(t,e,i){var n=this._state.TableName;if(this._state.TableName="",n.toLowerCase()!=e.toLowerCase()){var o=this,s=this.api.asc_checkDefinedName(e,null);if(!0===s.asc_getStatus())s=!0;else switch(s.asc_getReason()){case Asc.c_oAscDefinedNameReason.IsLocked:s=this.textIsLocked;break;case Asc.c_oAscDefinedNameReason.Existed:s=this.textExistName;break;case Asc.c_oAscDefinedNameReason.NameReserved:s=this.textReservedName;break;default:s=this.textInvalidName}!0===s?(this.api.asc_changeDisplayNameTable(n,e),Common.NotificationCenter.trigger("edit:complete",this)):this._state.TableNameError||(this._state.TableNameError=!0,Common.UI.alert({msg:s,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:function(t){Common.NotificationCenter.trigger("edit:complete",this),o._state.TableNameError=!1}}))}else Common.NotificationCenter.trigger("edit:complete",this)},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#table-advanced-link")},setApi:function(t){return this.api=t,t&&(this.api.asc_registerCallback("asc_onSendThemeColors",i.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onEditCell",this.onApiEditCell.bind(this))),this},setMode:function(t){this.mode=t},createDelayedControls:function(){this.chHeader=new Common.UI.CheckBox({el:e("#table-checkbox-header"),labelText:this.textHeader,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chHeader),this.chTotal=new Common.UI.CheckBox({el:e("#table-checkbox-total"),labelText:this.textTotal,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chTotal),this.chBanded=new Common.UI.CheckBox({el:e("#table-checkbox-banded"),labelText:this.textBanded,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chBanded),this.chFirst=new Common.UI.CheckBox({el:e("#table-checkbox-first"),labelText:this.textFirst,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chFirst),this.chLast=new Common.UI.CheckBox({el:e("#table-checkbox-last"),labelText:this.textLast,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLast),this.chColBanded=new Common.UI.CheckBox({el:e("#table-checkbox-col-banded"),labelText:this.textBanded,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chColBanded),this.chFilter=new Common.UI.CheckBox({el:e("#table-checkbox-filter"),labelText:this.textFilter,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chFilter),this.chHeader.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.rowHeader,"CheckHeader")),this.chTotal.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.rowTotal,"CheckTotal")),this.chBanded.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.rowBanded,"CheckBanded")),this.chFirst.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.columnFirst,"CheckFirst")),this.chLast.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.columnLast,"CheckLast")),this.chColBanded.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.columnBanded,"CheckColBanded")),this.chFilter.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.filterButton,"CheckFilter")),this.txtTableName=new Common.UI.InputField({el:e("#table-txt-name"),name:"tablename",style:"width: 100%;",validateOnBlur:!1}),this.txtTableName.on("changed:after",i.bind(this.onTableNameChanged,this)),this.lockedControls.push(this.txtTableName),this.btnSelectData=new Common.UI.Button({parentEl:e("#table-btn-select-data"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon resize-table",caption:this.textResize,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSelectData.on("click",i.bind(this.onSelectData,this)),this.lockedControls.push(this.btnSelectData),this.btnEdit=new Common.UI.Button({parentEl:e("#table-btn-edit"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon rows-and-columns",caption:this.textEdit,style:"width: 100%;",menu:new Common.UI.Menu({menuAlign:"tr-br",items:[{caption:this.selectRowText,value:Asc.c_oAscChangeSelectionFormatTable.row,idx:0},{caption:this.selectColumnText,value:Asc.c_oAscChangeSelectionFormatTable.column,idx:1},{caption:this.selectDataText,value:Asc.c_oAscChangeSelectionFormatTable.data,idx:2},{caption:this.selectTableText,value:Asc.c_oAscChangeSelectionFormatTable.all,idx:3},{caption:"--"},{caption:this.insertRowAboveText,value:Asc.c_oAscInsertOptions.InsertTableRowAbove,idx:4},{caption:this.insertRowBelowText,value:Asc.c_oAscInsertOptions.InsertTableRowBelow,idx:5},{caption:this.insertColumnLeftText,value:Asc.c_oAscInsertOptions.InsertTableColLeft,idx:6},{caption:this.insertColumnRightText,value:Asc.c_oAscInsertOptions.InsertTableColRight,idx:7},{caption:"--"},{caption:this.deleteRowText,value:Asc.c_oAscDeleteOptions.DeleteRows,idx:8},{caption:this.deleteColumnText,value:Asc.c_oAscDeleteOptions.DeleteColumns,idx:9},{caption:this.deleteTableText,value:Asc.c_oAscDeleteOptions.DeleteTable,idx:10}]}),dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnEdit.menu.on("show:after",i.bind((function(t){this.api&&(t.items[5].setDisabled(!this._originalProps.asc_getIsInsertRowAbove()),t.items[6].setDisabled(!this._originalProps.asc_getIsInsertRowBelow()),t.items[7].setDisabled(!this._originalProps.asc_getIsInsertColumnLeft()),t.items[8].setDisabled(!this._originalProps.asc_getIsInsertColumnRight()),t.items[10].setDisabled(!this._originalProps.asc_getIsDeleteRow()),t.items[11].setDisabled(!this._originalProps.asc_getIsDeleteColumn()),t.items[12].setDisabled(!this._originalProps.asc_getIsDeleteTable()))}),this)),this.btnEdit.menu.on("item:click",i.bind(this.onEditClick,this)),this.lockedControls.push(this.btnEdit),this.btnConvertRange=new Common.UI.Button({parentEl:e("#table-btn-convert-range"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-convert-to-range",caption:this.textConvertRange,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnConvertRange.on("click",i.bind((function(t){this.api&&this.api.asc_convertTableToRange(this._state.TableName),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.btnConvertRange),this.btnRemDuplicates=new Common.UI.Button({parentEl:e("#table-btn-rem-duplicates"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-remove-duplicates",caption:this.textRemDuplicates,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnRemDuplicates.on("click",i.bind((function(t){Common.NotificationCenter.trigger("data:remduplicates",this)}),this)),this.lockedControls.push(this.btnRemDuplicates),this.btnSlicer=new Common.UI.Button({parentEl:e("#table-btn-slicer"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-slicer",caption:this.textSlicer,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSlicer.on("click",i.bind(this.onInsertSlicerClick,this)),this.lockedControls.push(this.btnSlicer),this.btnPivot=new Common.UI.Button({parentEl:e("#table-btn-pivot"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-pivot-sum",caption:this.textPivot,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnPivot.on("click",i.bind(this.onInsertPivotClick,this)),this.lockedControls.push(this.btnPivot),this.$el.find(".pivot-only").toggleClass("hidden",!this.mode.canFeaturePivot),e(this.el).on("click","#table-advanced-link",i.bind(this.openAdvancedSettings,this)),this._initSettings=!1},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;e.api&&!this._locked&&new SSE.Views.TableSettingsAdvanced({tableProps:e._originalProps,api:e.api,handler:function(t,i){"ok"==t&&e.api&&i&&e.api.asc_changeFormatTableInfo(e._state.TableName,Asc.c_oAscChangeTableStyleInfo.advancedSettings,i),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},ChangeSettings:function(t,e,i){if(this._initSettings&&this.createDelayedControls(),this.wsLock=e,this.wsProps=i,this.disableControls(this._locked),t){this._originalProps=t;var n=t.asc_getTableName();this._state.TableName!==n&&(this.txtTableName.setValue(n),this._state.TableName=n),this._state.Range=t.asc_getTableRange();var o=!1;if(n=t.asc_getFirstRow(),this._state.CheckHeader!==n&&(this.chHeader.setValue(n,!0),this._state.CheckHeader=n,o=!0),n=t.asc_getLastRow(),this._state.CheckTotal!==n&&(this.chTotal.setValue(n,!0),this._state.CheckTotal=n,o=!0),n=t.asc_getBandHor(),this._state.CheckBanded!==n&&(this.chBanded.setValue(n,!0),this._state.CheckBanded=n,o=!0),n=t.asc_getFirstCol(),this._state.CheckFirst!==n&&(this.chFirst.setValue(n,!0),this._state.CheckFirst=n,o=!0),n=t.asc_getLastCol(),this._state.CheckLast!==n&&(this.chLast.setValue(n,!0),this._state.CheckLast=n,o=!0),n=t.asc_getBandVer(),this._state.CheckColBanded!==n&&(this.chColBanded.setValue(n,!0),this._state.CheckColBanded=n,o=!0),n=t.asc_getFilterButton(),this._state.CheckFilter!==n&&(this.chFilter.setValue(n,!0),this._state.CheckFilter=n),this.chFilter.isDisabled()!==(!this._state.CheckHeader||this._locked||null===n)&&this.chFilter.setDisabled(!this._state.CheckHeader||this._locked||null===n||this.wsLock),!o&&this.mnuTableTemplatePicker||this.onApiInitTableTemplates(this.api.asc_getTablePictures(t)),n=t.asc_getTableStyleName(),this._state.TemplateName!==n||this._isTemplatesChanged){var s=this.mnuTableTemplatePicker.store.findWhere({name:n});s||(s=this.mnuTableTemplatePicker.store.at(0)),this.btnTableTemplate.suspendEvents(),this.mnuTableTemplatePicker.selectRecord(s,!0),this.btnTableTemplate.resumeEvents(),this.$el.find(".icon-template-table").css({"background-image":"url("+s.get("imageUrl")+")",height:"44px",width:"60px","background-position":"center","background-size":"cover"}),this._state.TemplateName=n}this._isTemplatesChanged=!1}},onSendThemeColors:function(){this.btnTableTemplate&&this.onApiInitTableTemplates(this.api.asc_getTablePictures(this._originalProps))},onApiInitTableTemplates:function(t){var n=this;this._isTemplatesChanged=!0,this.btnTableTemplate||(this.btnTableTemplate=new Common.UI.Button({cls:"btn-large-dataview sheet-template-table",iconCls:"icon-template-table",menu:new Common.UI.Menu({style:"width: 505px;",items:[{template:i.template('<div id="id-table-menu-template" class="menu-table-template"  style="margin: 5px 5px 5px 10px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnTableTemplate.on("render:after",(function(t){n.mnuTableTemplatePicker=new Common.UI.DataView({el:e("#id-table-menu-template"),parentMenu:t.menu,restoreHeight:325,groups:new Common.UI.DataViewGroupStore,store:new Common.UI.DataViewStore,itemTemplate:i.template('<div id="<%= id %>" class="item"><img src="<%= imageUrl %>" height="44" width="60"></div>'),style:"max-height: 325px;",delayRenderTips:!0})})),this.btnTableTemplate.render(e("#table-btn-template")),this.lockedControls.push(this.btnTableTemplate),this.mnuTableTemplatePicker.on("item:click",i.bind(this.onTableTemplateSelect,this,this.btnTableTemplate)),this._locked&&this.btnTableTemplate.setDisabled(this._locked||this.wsProps.FormatCells));var o=n.mnuTableTemplatePicker.store.length;if(o>0&&o==t.length){var s=n.mnuTableTemplatePicker.dataViewItems;s&&i.each(t,(function(t,i){var n=t.asc_getImage();s[i].model.set("imageUrl",n,{silent:!0}),e(s[i].el).find("img").attr("src",n)}))}else{var a=[];i.each(t,(function(t){a.push({id:Common.UI.getId(),name:t.asc_getName(),caption:t.asc_getDisplayName(),type:t.asc_getType(),imageUrl:t.asc_getImage(),allowSelected:!0,selected:!1,tip:t.asc_getDisplayName()})})),n.mnuTableTemplatePicker.store.reset(a)}},onSelectData:function(){var t=this;if(t.api){var e=new SSE.Views.TableOptionsDialog({handler:function(e,i){if("ok"==i){t.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None);var n=e.getSettings();n.selectionType==Asc.c_oAscSelectionType.RangeMax||n.selectionType==Asc.c_oAscSelectionType.RangeRow||n.selectionType==Asc.c_oAscSelectionType.RangeCol?Common.UI.warning({title:t.textLongOperation,msg:t.warnLongOperation,buttons:["ok","cancel"],callback:function(e){"ok"==e&&setTimeout((function(){t.api.asc_changeTableRange(t._state.TableName,n.range)}),1),Common.NotificationCenter.trigger("edit:complete",t)}}):t.api.asc_changeTableRange(t._state.TableName,n.range)}Common.NotificationCenter.trigger("edit:complete",t)}});e.show(),e.setSettings({api:t.api,range:t._state.Range,title:t.textResize})}},onInsertSlicerClick:function(){var t=this,e=t.api.asc_beforeInsertSlicer();e&&new SSE.Views.SlicerAddDialog({props:e,handler:function(e,i){t&&t.api&&"ok"==e&&t.api.asc_insertSlicer(i),Common.NotificationCenter.trigger("edit:complete",t)}}).show()},onInsertPivotClick:function(){this.fireEvent("pivottable:create")},onApiEditCell:function(t){this.isEditCell=t!=Asc.c_oAscCellEditorState.editEnd,t!=Asc.c_oAscCellEditorState.editStart&&t!=Asc.c_oAscCellEditorState.editEnd||this.disableControls(this._locked)},setLocked:function(t){this._locked=t},disableControls:function(t){if(!this._initSettings){t=t||this.isEditCell;var e=this;i.each(this.lockedControls,(function(i){i.setDisabled(t||e.wsLock)})),this.linkAdvanced.toggleClass("disabled",t||this.wsLock),this.btnTableTemplate&&this.btnTableTemplate.setDisabled(t||this.wsProps.FormatCells),this.chBanded.setDisabled(t||this.wsProps.FormatCells),this.chFirst.setDisabled(t||this.wsProps.FormatCells),this.chLast.setDisabled(t||this.wsProps.FormatCells),this.chColBanded.setDisabled(t||this.wsProps.FormatCells)}},textEdit:"Rows & Columns",selectRowText:"Select Row",selectColumnText:"Select Entire Column",selectDataText:"Select Column Data",selectTableText:"Select Table",insertRowAboveText:"Insert Row Above",insertRowBelowText:"Insert Row Below",insertColumnLeftText:"Insert Column Left",insertColumnRightText:"Insert Column Right",deleteRowText:"Delete Row",deleteColumnText:"Delete Column",deleteTableText:"Delete Table",textTemplate:"Select From Template",textRows:"Rows",textColumns:"Columns",textHeader:"Header",textTotal:"Total",textBanded:"Banded",textFirst:"First",textLast:"Last",textEmptyTemplate:"No templates",textFilter:"Filter button",textTableName:"Table Name",textResize:"Resize table",textSelectData:"Select Data",textInvalidName:"ERROR! Invalid table name",textExistName:"ERROR! Range with such a name already exists",textIsLocked:"This element is being edited by another user.",notcriticalErrorTitle:"Warning",textReservedName:"The name you are trying to use is already referenced in cell formulas. Please use some other name.",textAdvanced:"Show advanced settings",textConvertRange:"Convert to range",textLongOperation:"Long operation",warnLongOperation:"The operation you are about to perform might take rather much time to complete.<br>Are you sure you want to continue?",textRemDuplicates:"Remove duplicates",textSlicer:"Insert slicer",textPivot:"Insert pivot table",textActions:"Table actions"},SSE.Views.TableSettings||{}))})),define("text!spreadsheeteditor/main/app/template/PivotSettings.template",[],(function(){return'<table cols="2">\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textFields %></label>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-large">\n            <div id="pivot-list-fields" class="pivot-check-listview"></div>\n        </td>\n    </tr>\n    <tr>\n        <td width="50%">\n            <label class="header"><%= scope.textFilters %></label>\n        </td>\n        <td width="50%">\n            <label class="header"><%= scope.textColumns %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="pivot-list-filters" class="pivot-listview"></div>\n        </td>\n        <td class="padding-small">\n            <div id="pivot-list-columns" class="pivot-listview" style="margin-left: 3px;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td width="50%">\n            <label class="header"><%= scope.textRows %></label>\n        </td>\n        <td width="50%">\n            <label class="header"><%= scope.textValues %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large">\n            <div id="pivot-list-rows" class="pivot-listview"></div>\n        </td>\n        <td class="padding-large">\n            <div id="pivot-list-values" class="pivot-listview" style="margin-left: 3px;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td align="center" colspan=2>\n            <label class="link" id="pivot-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("text!spreadsheeteditor/main/app/template/FieldSettingsDialog.template",[],(function(){return'<div id="id-pivot-field-settings-layout" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small" style="white-space: nowrap;">\n                    <label class="header" style="vertical-align: middle; margin-right: 4px;"><%= scope.txtSourceName %></label>\n                    <label id="field-settings-source" style="vertical-align: middle; max-width: 220px; overflow: hidden; text-overflow: ellipsis;"></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <label class="header"><%= scope.txtCustomName %></label>\n                    <div id="field-settings-custom" style="width:264px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="header"><%= scope.textReport %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-radio-tab"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-radio-outline"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <div id="field-settings-chk-compact" style="margin-left: 20px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-repeat"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-blank"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-subtotals"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-radio-top" style="margin-left: 20px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <div id="field-settings-radio-bottom" style="margin-left: 20px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-empty"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-pivot-field-settings-subtotals" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small">\n                    <label class="header"><%= scope.txtSummarize %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-sum"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-count"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-ave"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-max"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-min"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-product"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-num"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-dev"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-devp"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-var"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="field-settings-chk-varp"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n'})),define("spreadsheeteditor/main/app/view/FieldSettingsDialog",["text!spreadsheeteditor/main/app/template/FieldSettingsDialog.template","common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/ComboBox","common/main/lib/component/CheckBox","common/main/lib/view/AdvancedSettingsWindow"],(function(t){"use strict";SSE.Views.FieldSettingsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:284,height:440,toggleGroup:"pivot-field-settings-group",storageName:"sse-pivot-field-settings-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-pivot-field-settings-layout",panelCaption:this.strLayout},{panelId:"id-pivot-field-settings-subtotals",panelCaption:this.strSubtotals}],contentTemplate:_.template(t)({scope:this})},e),this.api=e.api,this.handler=e.handler,this.props=e.props,this.fieldIndex=e.fieldIndex||0,this.names=e.names||[],this.type=e.type||0,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.inputCustomName=new Common.UI.InputField({el:$("#field-settings-custom"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}),this.lblSourceName=this.$window.find("#field-settings-source"),this.radioTabular=new Common.UI.RadioBox({el:$("#field-settings-radio-tab"),labelText:this.txtTabular,name:"asc-radio-report-form"}),this.radioOutline=new Common.UI.RadioBox({el:$("#field-settings-radio-outline"),labelText:this.txtOutline,name:"asc-radio-report-form",checked:!0}),this.chCompact=new Common.UI.CheckBox({el:$("#field-settings-chk-compact"),labelText:this.txtCompact}),this.chRepeat=new Common.UI.CheckBox({el:$("#field-settings-chk-repeat"),labelText:this.txtRepeat}),this.chBlank=new Common.UI.CheckBox({el:$("#field-settings-chk-blank"),labelText:this.txtBlank}),this.chSubtotals=new Common.UI.CheckBox({el:$("#field-settings-chk-subtotals"),labelText:this.txtShowSubtotals}),this.radioTop=new Common.UI.RadioBox({el:$("#field-settings-radio-top"),labelText:this.txtTop,name:"asc-radio-show-subtotals"}),this.radioBottom=new Common.UI.RadioBox({el:$("#field-settings-radio-bottom"),labelText:this.txtBottom,name:"asc-radio-show-subtotals",checked:!0}),this.chEmpty=new Common.UI.CheckBox({el:$("#field-settings-chk-empty"),labelText:this.txtEmpty}),this.chSum=new Common.UI.CheckBox({el:$("#field-settings-chk-sum"),labelText:this.txtSum}),this.chCount=new Common.UI.CheckBox({el:$("#field-settings-chk-count"),labelText:this.txtCount}),this.chAve=new Common.UI.CheckBox({el:$("#field-settings-chk-ave"),labelText:this.txtAverage}),this.chMax=new Common.UI.CheckBox({el:$("#field-settings-chk-max"),labelText:this.txtMax}),this.chMin=new Common.UI.CheckBox({el:$("#field-settings-chk-min"),labelText:this.txtMin}),this.chProduct=new Common.UI.CheckBox({el:$("#field-settings-chk-product"),labelText:this.txtProduct}),this.chNum=new Common.UI.CheckBox({el:$("#field-settings-chk-num"),labelText:this.txtCountNums}),this.chDev=new Common.UI.CheckBox({el:$("#field-settings-chk-dev"),labelText:this.txtStdDev}),this.chDevp=new Common.UI.CheckBox({el:$("#field-settings-chk-devp"),labelText:this.txtStdDevp}),this.chVar=new Common.UI.CheckBox({el:$("#field-settings-chk-var"),labelText:this.txtVar}),this.chVarp=new Common.UI.CheckBox({el:$("#field-settings-chk-varp"),labelText:this.txtVarp}),this.afterRender()},getFocusedComponents:function(){return[this.inputCustomName,this.radioTabular,this.radioOutline,this.chCompact,this.chRepeat,this.chBlank,this.chSubtotals,this.radioTop,this.radioBottom,this.chEmpty,this.chSum,this.chCount,this.chAve,this.chMax,this.chMin,this.chProduct,this.chNum,this.chDev,this.chDevp,this.chVar,this.chVarp]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 0:i.inputCustomName.focus();break;case 1:i.chSum.focus()}}),10)},afterRender:function(){if(this._setDefaults(this.props),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){if(t){var e=this,i=t.asc_getPivotFields()[this.fieldIndex];if(this.lblSourceName.html(Common.Utils.String.htmlEncode(t.getCacheFieldName(this.fieldIndex))),this.inputCustomName.setValue(Common.Utils.String.htmlEncode(t.getPivotFieldName(this.fieldIndex))),i.asc_getOutline()?this.radioOutline.setValue(!0):this.radioTabular.setValue(!0),this.chCompact.setValue(i.asc_getOutline()&&i.asc_getCompact()),this.chRepeat.setValue(i.asc_getFillDownLabelsDefault()),this.chBlank.setValue(i.asc_getInsertBlankRow()),this.chSubtotals.setValue(i.asc_getDefaultSubtotal()),i.asc_getSubtotalTop()?this.radioTop.setValue(!0):this.radioBottom.setValue(!0),this.chEmpty.setValue(i.asc_getShowAll()),i.asc_getDefaultSubtotal()){var n=i.asc_getSubtotals();n&&_.each(n,(function(t){switch(t){case Asc.c_oAscItemType.Sum:e.chSum.setValue(!0);break;case Asc.c_oAscItemType.Count:e.chNum.setValue(!0);break;case Asc.c_oAscItemType.Avg:e.chAve.setValue(!0);break;case Asc.c_oAscItemType.Max:e.chMax.setValue(!0);break;case Asc.c_oAscItemType.Min:e.chMin.setValue(!0);break;case Asc.c_oAscItemType.Product:e.chProduct.setValue(!0);break;case Asc.c_oAscItemType.CountA:e.chCount.setValue(!0);break;case Asc.c_oAscItemType.StdDev:e.chDev.setValue(!0);break;case Asc.c_oAscItemType.StdDevP:e.chDevp.setValue(!0);break;case Asc.c_oAscItemType.Var:e.chVar.setValue(!0);break;case Asc.c_oAscItemType.VarP:e.chVarp.setValue(!0)}}))}}},getSettings:function(){var t=new Asc.CT_PivotField;if(t.asc_setName(this.inputCustomName.getValue()),t.asc_setOutline(this.radioOutline.getValue()),t.asc_setCompact(this.radioOutline.getValue()&&"checked"==this.chCompact.getValue()),t.asc_setFillDownLabelsDefault("checked"==this.chRepeat.getValue()),t.asc_setInsertBlankRow("checked"==this.chBlank.getValue()),t.asc_setDefaultSubtotal("checked"==this.chSubtotals.getValue()),t.asc_setSubtotalTop(this.radioTop.getValue()),t.asc_setShowAll("checked"==this.chEmpty.getValue()),t.asc_getDefaultSubtotal()){var e=[];"checked"==this.chSum.getValue()&&e.push(Asc.c_oAscItemType.Sum),"checked"==this.chNum.getValue()&&e.push(Asc.c_oAscItemType.Count),"checked"==this.chAve.getValue()&&e.push(Asc.c_oAscItemType.Avg),"checked"==this.chMax.getValue()&&e.push(Asc.c_oAscItemType.Max),"checked"==this.chMin.getValue()&&e.push(Asc.c_oAscItemType.Min),"checked"==this.chProduct.getValue()&&e.push(Asc.c_oAscItemType.Product),"checked"==this.chCount.getValue()&&e.push(Asc.c_oAscItemType.CountA),"checked"==this.chDev.getValue()&&e.push(Asc.c_oAscItemType.StdDev),"checked"==this.chDevp.getValue()&&e.push(Asc.c_oAscItemType.StdDevP),"checked"==this.chVar.getValue()&&e.push(Asc.c_oAscItemType.Var),"checked"==this.chVarp.getValue()&&e.push(Asc.c_oAscItemType.VarP),t.asc_setSubtotals(e)}return t},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;"ok"==e&&this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},textTitle:"Field Settings",strSubtotals:"Subtotals",strLayout:"Layout",txtSourceName:"Source name:",txtCustomName:"Custom name",textReport:"Report Form",txtTabular:"Tabular",txtOutline:"Outline",txtCompact:"Compact",txtRepeat:"Repeat items labels at each row",txtBlank:"Insert blank rows after each item",txtShowSubtotals:"Show subtotals",txtTop:"Show at top of group",txtBottom:"Show at bottom of group",txtEmpty:"Show items with no data",txtSummarize:"Functions for Subtotals",txtAverage:"Average",txtCount:"Count",txtCountNums:"Count Numbers",txtMax:"Max",txtMin:"Min",txtProduct:"Product",txtStdDev:"StdDev",txtStdDevp:"StdDevp",txtSum:"Sum",txtVar:"Var",txtVarp:"Varp"},SSE.Views.FieldSettingsDialog||{}))})),define("spreadsheeteditor/main/app/view/ValueFieldSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/ComboBox","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.ValueFieldSettingsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:284,height:220},initialize:function(t){var e=this;_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(e.options.height-85)+'px;">','<div class="content-panel" style="padding: 0 10px;"><div class="inner-content">','<div class="settings-panel active">','<table cols="2" style="width: 100%;">',"<tr>",'<td colspan="2" class="padding-small" style="white-space: nowrap;">','<label class="header" style="vertical-align: middle; margin-right: 4px;">'+e.txtSourceName+"</label>",'<label id="value-field-settings-source" style="vertical-align: middle; max-width: 220px; overflow: hidden; text-overflow: ellipsis;"></label>',"</td>","</tr>","<tr>",'<td colspan="2" class="padding-large">','<label class="header">',e.txtCustomName,"</label>",'<div id="value-field-settings-custom" style="width:264px;"></div>',"</td>","</tr>","<tr>",'<td colspan="2" class="padding-large">','<label class="header">',e.txtSummarize,"</label>",'<div id="value-field-settings-summarize" class="input-group-nr" style="width:264px;"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.api=t.api,this.handler=t.handler,this.props=t.props,this.field=t.field||0,this.names=t.names||[],Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.inputCustomName=new Common.UI.InputField({el:$("#value-field-settings-custom"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}),this.cmbSummarize=new Common.UI.ComboBox({el:$("#value-field-settings-summarize"),cls:"input-group-nr",menuStyle:"min-width: 264px;max-height:160px;",scrollAlwaysVisible:!0,editable:!1,takeFocusOnClose:!0,data:[{value:Asc.c_oAscDataConsolidateFunction.Sum,displayValue:this.txtSum},{value:Asc.c_oAscDataConsolidateFunction.Count,displayValue:this.txtCount},{value:Asc.c_oAscDataConsolidateFunction.Average,displayValue:this.txtAverage},{value:Asc.c_oAscDataConsolidateFunction.Max,displayValue:this.txtMax},{value:Asc.c_oAscDataConsolidateFunction.Min,displayValue:this.txtMin},{value:Asc.c_oAscDataConsolidateFunction.Product,displayValue:this.txtProduct},{value:Asc.c_oAscDataConsolidateFunction.CountNums,displayValue:this.txtCountNums},{value:Asc.c_oAscDataConsolidateFunction.StdDev,displayValue:this.txtStdDev},{value:Asc.c_oAscDataConsolidateFunction.StdDevp,displayValue:this.txtStdDevp},{value:Asc.c_oAscDataConsolidateFunction.Var,displayValue:this.txtVar},{value:Asc.c_oAscDataConsolidateFunction.Varp,displayValue:this.txtVarp}]}),this.cmbSummarize.setValue(Asc.c_oAscDataConsolidateFunction.Sum),this.cmbSummarize.on("selected",_.bind(this.onSummarizeSelect,this)),this.lblSourceName=this.$window.find("#value-field-settings-source"),this.afterRender()},getFocusedComponents:function(){return[this.inputCustomName,this.cmbSummarize]},getDefaultFocusableComponent:function(){return this.inputCustomName},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){if(t){var e=this.field,i=t.asc_getCacheFields();this.lblSourceName.html(Common.Utils.String.htmlEncode(i[e.asc_getIndex()].asc_getName())),this.inputCustomName.setValue(Common.Utils.String.htmlEncode(e.asc_getName())),this.cmbSummarize.setValue(e.asc_getSubtotal())}},getSettings:function(){var t=new Asc.CT_DataField;return t.asc_setName(this.inputCustomName.getValue()),t.asc_setSubtotal(this.cmbSummarize.getValue()),t},onDlgBtnClick:function(t){var e="object"==typeof t?t.currentTarget.attributes.result.value:t;"ok"==e&&this.handler&&this.handler.call(this,e,"ok"==e?this.getSettings():void 0),this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},onSummarizeSelect:function(t,e){this.inputCustomName.setValue(this.txtByField.replace("%1",e.displayValue).replace("%2",this.lblSourceName.text()))},onShowAsSelect:function(t,e){},onBaseFieldSelect:function(t,e){},onBaseItemSelect:function(t,e){},textTitle:"Value Field Settings",txtSourceName:"Source name:",txtCustomName:"Custom name",txtSummarize:"Summarize value field by",txtShowAs:"Show values as",txtBaseField:"Base field",txtBaseItem:"Base item",txtAverage:"Average",txtCount:"Count",txtCountNums:"Count Numbers",txtMax:"Max",txtMin:"Min",txtProduct:"Product",txtStdDev:"StdDev",txtStdDevp:"StdDevp",txtSum:"Sum",txtVar:"Var",txtVarp:"Varp",txtNormal:"No Calculation",txtDifference:"The Difference From",txtPercent:"Percent of",txtPercentDiff:"Percent Difference From",txtRunTotal:"Running Total In",txtPercentOfRow:"Percent of Total",txtPercentOfCol:"Percent of Column",txtPercentOfTotal:"Percent of Row",txtIndex:"Index",txtByField:"%1 of %2"},SSE.Views.ValueFieldSettingsDialog||{}))})),define("text!spreadsheeteditor/main/app/template/PivotSettingsAdvanced.template",[],(function(){return'<div id="id-adv-pivot-layout" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="2" style="width: 100%;">\n            <tr>\n                <td colspan="2" class="padding-large">\n                    <label class="header"><%= scope.txtName %></label>\n                    <div id="pivot-adv-name"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <label class="header"><%= scope.textGrandTotals %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <div id="pivot-adv-chk-show-rows"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-large">\n                    <div id="pivot-adv-chk-show-columns"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <label class="header"><%= scope.textDisplayFields %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <div id="pivot-adv-radio-down"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <div id="pivot-adv-radio-over"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <label id="pivot-adv-label-wrap" class="input-label"></label>\n                </td>\n                <td class="padding-large">\n                    <div id="pivot-adv-spin-wrap" style="float: right; width: 85px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <div id="pivot-adv-chk-show-headers"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="2" class="padding-small">\n                    <div id="pivot-adv-chk-autofit-col-width"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-pivot-data" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td>\n                    <label class="header"><%= scope.textDataRange %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" width="220">\n                    <div id="pivot-adv-txt-range" class="input-row"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-adv-pivot-alttext" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" width="100%">\n            <tr>\n                <td class="padding-large">\n                    <label class="header"><%= scope.textAltTitle %></label>\n                    <div id="pivot-advanced-alt-title"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label class="header"><%= scope.textAltDescription %></label>\n                    <textarea id="pivot-advanced-alt-description" class="form-control" style="width: 100%; height: 70px;"></textarea>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label><%= scope.textAltTip %></label>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),define("spreadsheeteditor/main/app/view/PivotSettingsAdvanced",["text!spreadsheeteditor/main/app/template/PivotSettingsAdvanced.template","common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/ComboBox","common/main/lib/component/CheckBox","common/main/lib/component/MetricSpinner","common/main/lib/view/AdvancedSettingsWindow"],(function(t){"use strict";SSE.Views.PivotSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:310,height:440,toggleGroup:"pivot-adv-settings-group",storageName:"sse-pivot-adv-settings-category"},initialize:function(e){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-pivot-layout",panelCaption:this.strLayout},{panelId:"id-adv-pivot-data",panelCaption:this.textDataSource},{panelId:"id-adv-pivot-alttext",panelCaption:this.textAlt}],contentTemplate:_.template(t)({scope:this})},e),this.api=e.api,this.props=e.props,this.options.handler=function(t,i){if("ok"==t&&!this.isRangeValid())return!0;e.handler&&e.handler.call(this,t,i)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this;this.inputName=new Common.UI.InputField({el:$("#pivot-adv-name"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}),this.radioDown=new Common.UI.RadioBox({el:$("#pivot-adv-radio-down"),labelText:this.textDown,name:"asc-radio-display-field",checked:!0}),this.radioDown.on("change",_.bind((function(t,e,i){e&&this.lblPageWrap.html(this.textWrapCol)}),this)),this.radioOver=new Common.UI.RadioBox({el:$("#pivot-adv-radio-over"),labelText:this.textOver,name:"asc-radio-display-field"}),this.radioOver.on("change",_.bind((function(t,e,i){e&&this.lblPageWrap.html(this.textWrapRow)}),this)),this.chRows=new Common.UI.CheckBox({el:$("#pivot-adv-chk-show-rows"),labelText:this.textShowRows}),this.chCols=new Common.UI.CheckBox({el:$("#pivot-adv-chk-show-columns"),labelText:this.textShowCols}),this.numWrap=new Common.UI.MetricSpinner({el:$("#pivot-adv-spin-wrap"),step:1,width:60,allowDecimal:!1,defaultUnit:"",value:"0",maxValue:255,minValue:0}),this.lblPageWrap=this.$window.find("#pivot-adv-label-wrap"),this.chHeaders=new Common.UI.CheckBox({el:$("#pivot-adv-chk-show-headers"),labelText:this.textShowHeaders}),this.chAutofitColWidth=new Common.UI.CheckBox({el:$("#pivot-adv-chk-autofit-col-width"),labelText:this.textAutofitColWidth}),this.txtDataRange=new Common.UI.InputFieldBtn({el:$("#pivot-adv-txt-range"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,blankError:this.txtEmpty,validateOnChange:!0}),this.txtDataRange.on("button:click",_.bind(this.onSelectData,this)),this.inputAltTitle=new Common.UI.InputField({el:$("#pivot-advanced-alt-title"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}).on("changed:after",(function(){t.isAltTitleChanged=!0})),this.textareaAltDescription=this.$window.find("textarea"),this.textareaAltDescription.keydown((function(e){e.keyCode==Common.UI.Keys.RETURN&&e.stopPropagation(),t.isAltDescChanged=!0})),this.afterRender()},getFocusedComponents:function(){return[this.inputName,this.chRows,this.chCols,this.radioDown,this.radioOver,this.numWrap,this.chHeaders,this.chAutofitColWidth,this.txtDataRange,this.inputAltTitle,this.textareaAltDescription]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 0:i.inputName.focus();break;case 1:i.txtDataRange.focus();break;case 2:i.inputAltTitle.focus()}}),10)},afterRender:function(){if(this._setDefaults(this.props),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},_setDefaults:function(t){if(t){var e=this;this.inputName.setValue(Common.Utils.String.htmlEncode(t.asc_getName())),this.chCols.setValue(t.asc_getRowGrandTotals(),!0),this.chRows.setValue(t.asc_getColGrandTotals(),!0),t.asc_getPageOverThenDown()?this.radioOver.setValue(!0):this.radioDown.setValue(!0),this.lblPageWrap.html(t.asc_getPageOverThenDown()?this.textWrapRow:this.textWrapCol),this.numWrap.setValue(t.asc_getPageWrap()),this.chHeaders.setValue(t.asc_getShowHeaders(),!0),this.chAutofitColWidth.setValue(t.asc_getUseAutoFormatting(),!0);var i=t.asc_getDataRef();this.txtDataRange.setValue(i||""),this.dataRangeValid=i,this.txtDataRange.validation=function(t){return e.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PivotTableData,t,!1)!=Asc.c_oAscError.ID.DataRangeError||e.textInvalidRange},i=t.asc_getTitle(),this.inputAltTitle.setValue(i||""),i=t.asc_getDescription(),this.textareaAltDescription.val(i||"")}},getSettings:function(){var t=new Asc.CT_pivotTableDefinition;return t.asc_setName(this.inputName.getValue()),t.asc_setRowGrandTotals("checked"==this.chCols.getValue()),t.asc_setColGrandTotals("checked"==this.chRows.getValue()),t.asc_setPageOverThenDown(this.radioOver.getValue()),t.asc_setPageWrap(this.numWrap.getNumberValue()),t.asc_setShowHeaders("checked"==this.chHeaders.getValue()),t.asc_setUseAutoFormatting("checked"==this.chAutofitColWidth.getValue()),t.asc_setDataRef(this.txtDataRange.getValue()),this.isAltTitleChanged&&t.asc_setTitle(this.inputAltTitle.getValue()),this.isAltDescChanged&&t.asc_setDescription(this.textareaAltDescription.val()),t},isRangeValid:function(){var t=!0,e="";return _.isEmpty(this.txtDataRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PivotTableData,this.txtDataRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),t||(this.setActiveCategory(1),this.txtDataRange.showError([e]),this.txtDataRange.cmpEl.find("input").focus(),t)},onSelectData:function(){var t=this;if(t.api){var e=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.dataRangeValid=e.getSettings(),t.txtDataRange.setValue(t.dataRangeValid),t.txtDataRange.checkValidate())}}).on("close",(function(){t.show()})),i=t.$window.offset();t.hide(),e.show(i.left+160,i.top+125),e.setSettings({api:t.api,range:_.isEmpty(t.txtDataRange.getValue())||1!=t.txtDataRange.checkValidate()?t.dataRangeValid:t.txtDataRange.getValue(),type:Asc.c_oAscSelectionDialogType.PivotTableData})}},textTitle:"Pivot Table - Advanced Settings",strLayout:"Name and Layout",txtName:"Name",textGrandTotals:"Grand Totals",textShowRows:"Show for rows",textShowCols:"Show for columns",textDataSource:"Data Source",textDataRange:"Data Range",textSelectData:"Select data",textAlt:"Alternative Text",textAltTitle:"Title",textAltDescription:"Description",textAltTip:"The alternative text-based representation of the visual object information, which will be read to the people with vision or cognitive impairments to help them better understand what information there is in the image, autoshape, chart or table.",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",textDisplayFields:"Display fields in report filter area",textDown:"Down, then over",textOver:"Over, then down",textWrapCol:"Report filter fields per column",textWrapRow:"Report filter fields per row",textHeaders:"Field Headers",textShowHeaders:"Show field headers for rows and columns",textAutofitColWidth:"Autofit column widths on update"},SSE.Views.PivotSettingsAdvanced||{}))})),define("spreadsheeteditor/main/app/view/PivotSettings",["text!spreadsheeteditor/main/app/template/PivotSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/ListView","spreadsheeteditor/main/app/view/FieldSettingsDialog","spreadsheeteditor/main/app/view/ValueFieldSettingsDialog","spreadsheeteditor/main/app/view/PivotSettingsAdvanced"],(function(t,e,i,n,o){"use strict";SSE.Views.PivotSettings=n.View.extend(i.extend({el:"#id-pivot-settings",template:i.template(t),events:{},options:{alias:"PivotSettings"},initialize:function(){this._initSettings=!0,this._state={names:[],DisabledControls:!1,field:{}},this.lockedControls=[],this._locked=!1,this._originalProps=null,this._noApply=!1,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#pivot-advanced-link")},setApi:function(t){return this.api=t,this},createDelayedControls:function(){this.fieldsList=new Common.UI.ListView({el:e("#pivot-list-fields"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:i.template(["<div>",'<label class="checkbox-indeterminate" style="position:absolute;">','<input id="pvcheckbox-<%= id %>" type="checkbox" class="button__checkbox">','<label for="pvcheckbox-<%= id %>" class="checkbox__shape"></label>',"</label>",'<div id="<%= id %>" class="list-item" style="pointer-events:none;"><span style="background-color: transparent;"><%= Common.Utils.String.htmlEncode(value) %></span></div>','<div class="listitem-icon img-commonctrl"></div>',"</div>"].join(""))}),this.fieldsList.on({"item:change":this.onItemChanged.bind(this),"item:add":this.onItemChanged.bind(this),"item:click":this.onFieldsCheck.bind(this)}),this.fieldsList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.fieldsList.$el.on("dragover",i.bind(this.onDragOver,this,this.fieldsList)),this.fieldsList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.fieldsList)),this.fieldsList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.fieldsList);var t=i.template(['<div id="<%= id %>" class="list-item" style="display:inline-block;">','<div style=""><span><%= Common.Utils.String.htmlEncode(value) %></span></div>','<div class="listitem-icon img-commonctrl"></div>',"</div>"].join(""));this.columnsList=new Common.UI.ListView({el:e("#pivot-list-columns"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.columnsList.on("item:click",i.bind(this.onColumnsSelect,this,0)),this.columnsList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.columnsList.$el.on("dragover",i.bind(this.onDragOver,this,this.columnsList)),this.columnsList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.columnsList)),this.columnsList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.columnsList),this.rowsList=new Common.UI.ListView({el:e("#pivot-list-rows"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.rowsList.on("item:click",i.bind(this.onColumnsSelect,this,1)),this.rowsList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.rowsList.$el.on("dragover",i.bind(this.onDragOver,this,this.rowsList)),this.rowsList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.rowsList)),this.rowsList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.rowsList),this.valuesList=new Common.UI.ListView({el:e("#pivot-list-values"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.valuesList.on("item:click",i.bind(this.onColumnsSelect,this,2)),this.valuesList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.valuesList.$el.on("dragover",i.bind(this.onDragOver,this,this.valuesList)),this.valuesList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.valuesList)),this.valuesList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.valuesList),this.filtersList=new Common.UI.ListView({el:e("#pivot-list-filters"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.filtersList.on("item:click",i.bind(this.onColumnsSelect,this,3)),this.filtersList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.filtersList.$el.on("dragover",i.bind(this.onDragOver,this,this.filtersList)),this.filtersList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.filtersList)),this.filtersList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.filtersList),e(this.el).on("click","#pivot-advanced-link",i.bind(this.openAdvancedSettings,this)),this._initSettings=!1},getDragElement:function(t){return this._dragEl=e('<div style="font-weight: bold;position: absolute;left:-10000px;">'+t+"</div>"),e(document.body).append(this._dragEl),this._dragEl[0]},onDragEnd:function(){this._dragEl&&this._dragEl.remove(),this._dragEl=null},onFieldsDragStart:function(t,e,i){this._state.field={record:t.model},i.originalEvent.dataTransfer.effectAllowed="move",!Common.Utils.isIE&&i.originalEvent.dataTransfer.setDragImage(this.getDragElement(t.model.get("value")),14,14),this.pivotIndex=e,this.fromListView=this.fieldsList.$el[0].id},onItemsDragStart:function(t,e,i,n,o){this._state.field={record:i.model,type:t},o.originalEvent.dataTransfer.effectAllowed="move",!Common.Utils.isIE&&o.originalEvent.dataTransfer.setDragImage(this.getDragElement(i.model.get("value")),14,14),this.itemIndex=n,this.pivotIndex=e.store.at(n).attributes.pivotIndex,this.fromListView=e.$el[0].id},onDragItemEnter:function(t,e,i){i.preventDefault(),t.$el.addClass("insert"),this.indexMoveTo=e},onDragItemLeave:function(t,e,i){t.$el.removeClass("insert"),this.indexMoveTo=void 0},onDragItemOver:function(t,e,i,n){if(-2!==this.pivotIndex||"pivot-list-filters"!==this.enterListView&&"pivot-list-values"!==this.enterListView){n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="move",e.$el.addClass("insert"),this.indexMoveTo=i;var o=e.$el.parent().height(),s=e.$el.position().top,a=e.$el.outerHeight(),l=e.$el.parent().scrollTop();return s<a&&l>0&&t.scrollToRecord(t.store.at(0===i?0:i-1)),s>o-a&&i<t.store.length&&t.scrollToRecord(t.store.at(i===t.store.length-1?i:i+1)),!1}n.originalEvent.dataTransfer.dropEffect="none"},onDragEnter:function(t){this.enterListView=t.currentTarget.id},onDragOver:function(t,e){if("onlyoffice"!==e.originalEvent.dataTransfer.types[0]&&(-2!==this.pivotIndex||"pivot-list-filters"!==this.enterListView&&"pivot-list-values"!==this.enterListView)&&("pivot-list-fields"!==this.fromListView||"pivot-list-fields"!==this.enterListView))return e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",t.$el.find(".item").last().addClass("insert last"),!1;e.originalEvent.dataTransfer.dropEffect="none"},onDragLeave:function(t,e){t.$el.find(".item").removeClass("insert last")},onDrop:function(t){if(t.stopPropagation(),this.onDragEnd(),"pivot-list-fields"===this.fromListView&&"pivot-list-fields"!==this.enterListView){if(i.isNumber(this.pivotIndex)){switch(this.enterListView){case"pivot-list-columns":this.onAddColumn(this.pivotIndex,this.indexMoveTo);break;case"pivot-list-rows":this.onAddRow(this.pivotIndex,this.indexMoveTo);break;case"pivot-list-filters":this.onAddFilter(this.pivotIndex,this.indexMoveTo);break;case"pivot-list-values":this.onAddValues(this.pivotIndex,this.indexMoveTo)}this.pivotIndex=void 0,this.indexMoveTo=void 0}}else if("pivot-list-fields"===this.enterListView)i.isNumber(this.pivotIndex)&&("pivot-list-values"===this.fromListView&&i.isNumber(this.itemIndex)?this.onRemove(this.pivotIndex,this.itemIndex):this.onRemove(this.pivotIndex),this.pivotIndex=void 0);else if(this.fromListView!==this.enterListView){if(i.isNumber(this.itemIndex)&&this.enterListView){switch(this.enterListView){case"pivot-list-columns":this.onMoveTo(0,this.pivotIndex,this.indexMoveTo);break;case"pivot-list-rows":this.onMoveTo(1,this.pivotIndex,this.indexMoveTo);break;case"pivot-list-filters":this.onMoveTo(3,this.pivotIndex,this.indexMoveTo);break;case"pivot-list-values":this.onMoveTo(2,this.pivotIndex,this.indexMoveTo)}this.itemIndex=void 0,this.indexMoveTo=void 0}}else if(this.fromListView===this.enterListView&&i.isNumber(this.itemIndex)&&this.enterListView){if(this.itemIndex!==this.indexMoveTo)switch(this.enterListView){case"pivot-list-columns":this.onMove(0,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.columnsList.store.length-1);break;case"pivot-list-rows":this.onMove(1,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.rowsList.store.length-1);break;case"pivot-list-filters":this.onMove(3,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.filtersList.store.length-1);break;case"pivot-list-values":this.onMove(2,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.valuesList.store.length-1)}else e(this.el).find(".item").removeClass("insert last");this.itemIndex=void 0,this.indexMoveTo=void 0}},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;e.api&&!this._locked&&new SSE.Views.PivotSettingsAdvanced({props:e._originalProps,api:e.api,handler:function(t,i){"ok"==t&&e.api&&i&&(e._originalProps.asc_set(e.api,i),Common.NotificationCenter.trigger("edit:complete",e)),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedControls(),this.disableControls(this._locked),t){this._originalProps=t,this._state.TableName=t.asc_getName();var e=this,n=[],o=t.asc_getCacheFields(),s=t.asc_getPivotFields();this._state.names=[],s.forEach((function(t,i){e._state.names[i]=t.asc_getName()||o[i].asc_getName()}));var a=function(t,o,s,a){var l=[],r=o.store.models,c=o.store.length===(t?t.length:0);t&&t.forEach((function(t,i){var o=t.asc_getIndex(),s=a?a(o):t.asc_getName();c?r[i].set({pivotIndex:o,index:i,value:s||"",tip:s&&s.length>10?s:""}):l.push(new Common.UI.DataViewModel({selected:!1,allowSelected:!1,pivotIndex:o,index:i,value:s||"",tip:s&&s.length>10?s:""})),n[a?s:e._state.names[o]]=!0})),c||(o.store.reset(l),o.scroller.update({minScrollbarLength:o.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}),o.dataViewItems.forEach((function(t,n){t.$el.attr("draggable",!0),t.$el.on("dragstart",i.bind(e.onItemsDragStart,e,s,o,t,n)),t.$el.on("dragenter",i.bind(e.onDragItemEnter,e,t,n)),t.$el.on("dragleave",i.bind(e.onDragItemLeave,e,t,n)),t.$el.on("dragover",i.bind(e.onDragItemOver,e,o,t,n)),t.$el.on("drop",i.bind(e.onDrop,e)),t.$el.on("dragend",i.bind(e.onDragEnd,e))})),o.$el.find(".item").last().css({"margin-bottom":"10px"}))},l=t.asc_getColumnFields();l&&(l=i.filter(l,(function(t){var e=t.asc_getIndex();return e>-1||-2==e}))),a(l,this.columnsList,0,(function(t){return t>-1?e._state.names[t]:e.textValues})),(l=t.asc_getRowFields())&&(l=i.filter(l,(function(t){var e=t.asc_getIndex();return e>-1||-2==e}))),a(l,this.rowsList,1,(function(t){return t>-1?e._state.names[t]:e.textValues})),(l=t.asc_getDataFields())&&(l=i.filter(l,(function(t){return t.asc_getIndex()>-1}))),a(l,this.valuesList,2),(l=t.asc_getPageFields())&&(l=i.filter(l,(function(t){return t.asc_getIndex()>-1}))),a(l,this.filtersList,3,(function(t){return e._state.names[t]}));var r=[],c=this.fieldsList.store.models,d=this.fieldsList.store.length===e._state.names.length;e._state.names.forEach((function(t,e){d?c[e].set({value:t,index:e,tip:t.length>25?t:"",check:n[t]}):r.push(new Common.UI.DataViewModel({selected:!1,allowSelected:!1,value:t,index:e,tip:t.length>25?t:"",check:n[t]}))})),d||(this.fieldsList.store.reset(r),this.fieldsList.scroller.update({minScrollbarLength:this.fieldsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}),this.fieldsList.dataViewItems.forEach((function(t,n){t.$el.attr("draggable",!0),t.$el.on("dragstart",i.bind(e.onFieldsDragStart,e,t,n)),t.$el.on("dragend",i.bind(e.onDragEnd,e))})))}},onFieldsCheck:function(t,n,o){var s="",a=!1,l=null,r=window.event?window.event:window._event;if(r){var c=e(r.target);if(c&&c.hasClass("listitem-icon")){if(this._state.field={record:o},this.pivotFieldsMenu){if(this.pivotFieldsMenu.isVisible())return void this.pivotFieldsMenu.hide()}else this.miAddFilter=new Common.UI.MenuItem({caption:this.txtAddFilter,checkable:!1}),this.miAddFilter.on("click",i.bind(this.onAddFilter,this)),this.miAddRow=new Common.UI.MenuItem({caption:this.txtAddRow,checkable:!1}),this.miAddRow.on("click",i.bind(this.onAddRow,this)),this.miAddColumn=new Common.UI.MenuItem({caption:this.txtAddColumn,checkable:!1}),this.miAddColumn.on("click",i.bind(this.onAddColumn,this)),this.miAddValues=new Common.UI.MenuItem({caption:this.txtAddValues,checkable:!1}),this.miAddValues.on("click",i.bind(this.onAddValues,this)),this.pivotFieldsMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[this.miAddFilter,this.miAddRow,this.miAddColumn,this.miAddValues]});null!=o&&o.get("index");var d=this.pivotFieldsMenu,h=e(r.currentTarget),p=e(this.el),m=h.offset(),u=p.offset();[m.left-u.left+h.width(),m.top-u.top+h.height()/2];var g=p.find("#menu-pivot-fields-container");return d.rendered||(g.length<1&&(g=e('<div id="menu-pivot-fields-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',d.id),p.append(g)),d.render(g),d.cmpEl.attr({tabindex:"-1"}),d.on("show:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)})).on("hide:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}))),d.menuAlignEl=h,d.setOffset(-20,-h.height()/2-3),d.show(),i.delay((function(){d.cmpEl.focus()}),10),r.stopPropagation(),void r.preventDefault()}if((s=e(r.currentTarget).find(".list-item")).length){l=s.get(0).getBoundingClientRect();var f=r.clientX*Common.Utils.zoom(),b=r.clientY*Common.Utils.zoom();l.left<f&&f<l.right&&l.top<b&&b<l.bottom&&(a=!0)}(a||r.target.className.match("checkbox")&&"input"!==r.target.localName)&&this.updateFieldCheck(t,o)}},updateFieldCheck:function(t,e){e&&t&&(e.set("check",!e.get("check")),this.api&&!this._locked&&(e.get("check")?this._originalProps.asc_addField(this.api,e.get("index")):this._originalProps.asc_removeField(this.api,e.get("index")),Common.NotificationCenter.trigger("edit:complete",this)),t.scroller.update({minScrollbarLength:t.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}))},onColumnsSelect:function(t,n,o,s,a){if(this._state.field={record:s,type:t,length:n.store.length},this.fieldsMenu){if(this.fieldsMenu.isVisible())return void this.fieldsMenu.hide()}else this.miMoveUp=new Common.UI.MenuItem({caption:this.txtMoveUp,checkable:!1}),this.miMoveUp.on("click",i.bind(this.onMoveUp,this)),this.miMoveDown=new Common.UI.MenuItem({caption:this.txtMoveDown,checkable:!1}),this.miMoveDown.on("click",i.bind(this.onMoveDown,this)),this.miMoveBegin=new Common.UI.MenuItem({caption:this.txtMoveBegin,checkable:!1}),this.miMoveBegin.on("click",i.bind(this.onMoveBegin,this)),this.miMoveEnd=new Common.UI.MenuItem({caption:this.txtMoveEnd,checkable:!1}),this.miMoveEnd.on("click",i.bind(this.onMoveEnd,this)),this.miMoveFilter=new Common.UI.MenuItem({caption:this.txtMoveFilter,checkable:!1}),this.miMoveFilter.on("click",i.bind(this.onMoveTo,this,3)),this.miMoveRow=new Common.UI.MenuItem({caption:this.txtMoveRow,checkable:!1}),this.miMoveRow.on("click",i.bind(this.onMoveTo,this,1)),this.miMoveColumn=new Common.UI.MenuItem({caption:this.txtMoveColumn,checkable:!1}),this.miMoveColumn.on("click",i.bind(this.onMoveTo,this,0)),this.miMoveValues=new Common.UI.MenuItem({caption:this.txtMoveValues,checkable:!1}),this.miMoveValues.on("click",i.bind(this.onMoveTo,this,2)),this.miRemove=new Common.UI.MenuItem({caption:this.txtRemove,checkable:!1}),this.miRemove.on("click",i.bind(this.onRemove,this)),this.miFieldSettings=new Common.UI.MenuItem({caption:this.txtFieldSettings,checkable:!1}),this.miFieldSettings.on("click",i.bind(this.onFieldSettings,this)),this.fieldsMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[this.miMoveUp,this.miMoveDown,this.miMoveBegin,this.miMoveEnd,{caption:"--"},this.miMoveFilter,this.miMoveRow,this.miMoveColumn,this.miMoveValues,{caption:"--"},this.miRemove,{caption:"--"},this.miFieldSettings]});var l=null!=s?s.get("index"):-1,r=n.store.length,c=s.get("pivotIndex");this.miMoveUp.setDisabled(l<1),this.miMoveDown.setDisabled(l>r-2||l<0),this.miMoveBegin.setDisabled(l<1),this.miMoveEnd.setDisabled(l>r-2||l<0),this.miMoveFilter.setDisabled(3==t||-2==c),this.miMoveRow.setDisabled(1==t),this.miMoveColumn.setDisabled(0==t),this.miMoveValues.setDisabled(2==t||-2==c),this.miFieldSettings.setDisabled(-2==c);var d=this.fieldsMenu,h=e(a.currentTarget),p=e(this.el),m=h.offset(),u=p.offset();m.left,u.left,h.width(),m.top,u.top,h.height();var g=p.find("#menu-pivot-container");d.rendered||(g.length<1&&(g=e('<div id="menu-pivot-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',d.id),p.append(g)),d.render(g),d.cmpEl.attr({tabindex:"-1"}),d.on("show:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)})).on("hide:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}))),d.menuAlignEl=h,d.setOffset(-20,-h.height()/2-3),d.show(),i.delay((function(){d.cmpEl.focus()}),10),a.stopPropagation(),a.preventDefault()},setLocked:function(t){this._locked=t},onFieldSettings:function(t,e,i){var n=this;if(n.api&&!this._locked&&n._state.field)if(2==n._state.field.type){var o=n._state.field.record.get("index"),s=n._originalProps.asc_getDataFields()[o];new SSE.Views.ValueFieldSettingsDialog({props:n._originalProps,field:s,names:n._state.names,api:n.api,handler:function(t,e){"ok"==t&&n.api&&e&&(s.asc_set(n.api,n._originalProps,o,e),Common.NotificationCenter.trigger("edit:complete",n)),Common.NotificationCenter.trigger("edit:complete",n)}}).show()}else{var a=n._state.field.record.get("pivotIndex"),l=n._originalProps.asc_getPivotFields()[a];new SSE.Views.FieldSettingsDialog({props:n._originalProps,fieldIndex:a,names:n._state.names,api:n.api,type:n._state.field.type,handler:function(t,e){"ok"==t&&n.api&&e&&(l.asc_set(n.api,n._originalProps,a,e),Common.NotificationCenter.trigger("edit:complete",n)),Common.NotificationCenter.trigger("edit:complete",n)}}).show()}},onAddFilter:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addPageField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onAddRow:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addRowField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onAddColumn:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addColField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onAddValues:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addDataField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onRemove:function(t,e){this.api&&!this._locked&&this._state.field&&(2==this._state.field.type||i.isNumber(e)?this._originalProps.asc_removeDataField(this.api,i.isNumber(t)?t:this._state.field.record.get("pivotIndex"),i.isNumber(e)?e:this._state.field.record.get("index")):this._originalProps.asc_removeNoDataField(this.api,i.isNumber(t)?t:this._state.field.record.get("pivotIndex")),Common.NotificationCenter.trigger("edit:complete",this))},onMoveUp:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,t-1)}},onMoveDown:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,t+1)}},onMoveBegin:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,0)}},onMoveEnd:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,this._state.field.length-1)}},onMove:function(t,e,i){switch(t){case 0:this._originalProps.asc_moveColField(this.api,e,i);break;case 1:this._originalProps.asc_moveRowField(this.api,e,i);break;case 2:this._originalProps.asc_moveDataField(this.api,e,i);break;case 3:this._originalProps.asc_movePageField(this.api,e,i)}Common.NotificationCenter.trigger("edit:complete",this)},onMoveTo:function(t,e,n){if(this.api&&!this._locked&&this._state.field){var o=i.isNumber(e)?e:this._state.field.record.get("pivotIndex"),s=i.isNumber(n)?n:2==this._state.field.type?this._state.field.record.get("index"):void 0;switch(t){case 0:this._originalProps.asc_moveToColField(this.api,o,s);break;case 1:this._originalProps.asc_moveToRowField(this.api,o,s);break;case 2:this._originalProps.asc_moveToDataField(this.api,o,s);break;case 3:this._originalProps.asc_moveToPageField(this.api,o,s)}Common.NotificationCenter.trigger("edit:complete",this)}},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t))},onItemChanged:function(t,i){var n=i.model.get("check");"indeterminate"==n?e("input[type=checkbox]",i.$el).prop("indeterminate",!0):e("input[type=checkbox]",i.$el).prop({checked:n,indeterminate:!1})},textFields:"Select Fields",textValues:"Values",textRows:"Rows",textColumns:"Columns",textFilters:"Filters",textAdvanced:"Show advanced settings",txtMoveUp:"Move Up",txtMoveDown:"Move Down",txtMoveBegin:"Move to Beginning",txtMoveEnd:"Move to End",txtMoveFilter:"Move to Filters",txtMoveRow:"Move to Rows",txtMoveColumn:"Move to Columns",txtMoveValues:"Move to Values",txtRemove:"Remove Field",txtFieldSettings:"Field Settings",txtAddFilter:"Add to Filters",txtAddRow:"Add to Rows",txtAddColumn:"Add to Columns",txtAddValues:"Add to Values"},SSE.Views.PivotSettings||{}))})),define("text!spreadsheeteditor/main/app/template/SignatureSettings.template",[],(function(){return'<table cols="2">\n    <tr>\n        <td class="padding-large">\n            <label style="font-size: 18px;"><%= scope.strSignature %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large">\n            <div id="signature-invisible-sign" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="requested">\n        <td class="padding-small">\n            <label class="header"><%= scope.strRequested %></label>\n        </td>\n    </tr>\n    <tr class="requested">\n        <td class="padding-large">\n            <div id="signature-requested-sign"></div>\n        </td>\n    </tr>\n    <tr class="valid">\n        <td class="padding-small">\n            <label class="header"><%= scope.strValid %></label>\n        </td>\n    </tr>\n    <tr class="valid">\n        <td class="padding-large">\n            <div id="signature-valid-sign"></div>\n        </td>\n    </tr>\n    <tr class="invalid">\n        <td class="padding-small">\n            <label class="header" style="color:#bb3d3d;"><%= scope.strInvalid %></label>\n        </td>\n    </tr>\n    <tr class="invalid">\n        <td><div id="signature-invalid-sign"></div></td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/SignatureSettings",["text!spreadsheeteditor/main/app/template/SignatureSettings.template","jquery","underscore","backbone","common/main/lib/component/Button"],(function(t,e,i,n){"use strict";SSE.Views.SignatureSettings=n.View.extend(i.extend({el:"#id-signature-settings",template:i.template(t),events:{},options:{alias:"SignatureSettings"},initialize:function(){this._state={DisabledEditing:!1,ready:!1,hasValid:!1,hasInvalid:!1,hasRequested:!1,tip:void 0},this._locked=!1,this.render()},render:function(){this.$el.html(this.template({scope:this}));var t=SSE.getController("Common.Controllers.Protection").getView();this.btnAddInvisibleSign=t.getButton("signature"),this.btnAddInvisibleSign.render(this.$el.find("#signature-invisible-sign")),this.viewRequestedList=new Common.UI.DataView({el:e("#signature-requested-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item requested">','<div class="caret img-commonctrl nomargin"></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"</div>"].join(""))}),this.viewValidList=new Common.UI.DataView({el:e("#signature-valid-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item">','<div class="caret img-commonctrl img-colored <% if (name == "" || date == "") { %>nomargin<% } %>"></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>','<div class="date"><%= Common.Utils.String.htmlEncode(date) %></div>',"</div>"].join(""))}),this.viewInvalidList=new Common.UI.DataView({el:e("#signature-invalid-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item">','<div class="caret img-commonctrl <% if (name == "" || date == "") { %>nomargin<% } %>"></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>','<div class="date"><%= Common.Utils.String.htmlEncode(date) %></div>',"</div>"].join(""))}),this.viewRequestedList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewValidList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewInvalidList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewRequestedList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.viewValidList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.viewInvalidList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.signatureMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[{caption:this.strSign,value:0},{caption:this.strDetails,value:1},{caption:this.strSetup,value:2},{caption:this.strDelete,value:3}]}),this.signatureMenu.on("item:click",i.bind(this.onMenuSignatureClick,this))},setApi:function(t){return this.api=t,this.api&&this.api.asc_registerCallback("asc_onUpdateSignatures",i.bind(this.onApiUpdateSignatures,this)),Common.NotificationCenter.on("document:ready",i.bind(this.onDocumentReady,this)),this},ChangeSettings:function(t){this._state.hasRequested||this._state.hasValid||this._state.hasInvalid||this.updateSignatures(this.api.asc_getSignatures(),this.api.asc_getRequestSignatures())},setLocked:function(t){this._locked=t},setMode:function(t){this.mode=t},onApiUpdateSignatures:function(t,e){this._state.ready&&(this.updateSignatures(t,e),this.showSignatureTooltip(this._state.hasValid,this._state.hasInvalid))},updateSignatures:function(t,e){var n=this,o=[],s=[],a=[],l=1;i.each(e,(function(t,e){var i=t.asc_getSigner1();o.push({name:""!==i?i:n.strSigner+" "+l++,guid:t.asc_getGuid(),requested:!0})})),i.each(t,(function(t,e){var n=t.asc_getDate(),o={name:t.asc_getSigner1(),certificateId:t.asc_getId(),guid:t.asc_getGuid(),date:i.isEmpty(n)?"":new Date(n).toLocaleString(),invisible:!t.asc_getVisible()};0==t.asc_getValid()?s.push(o):a.push(o)})),n._state.hasValid=s.length>0,n._state.hasInvalid=a.length>0,n._state.hasRequested=o.length>0,this.viewRequestedList.store.reset(o),this.viewValidList.store.reset(s),this.viewInvalidList.store.reset(a),this.$el.find(".requested").toggleClass("hidden",!n._state.hasRequested),this.$el.find(".valid").toggleClass("hidden",!n._state.hasValid),this.$el.find(".invalid").toggleClass("hidden",!n._state.hasInvalid),n.disableEditing(n._state.hasValid||n._state.hasInvalid)},onItemContextMenu:function(t,n,o,s){var a=this.signatureMenu;a.isVisible()&&a.hide();var l=e(this.el).offset(),r=[s.clientX*Common.Utils.zoom()-l.left+5,s.clientY*Common.Utils.zoom()-l.top+5];this.showSignatureMenu(o,r),a.menuAlign="tl-bl",a.menuAlignEl=null,a.setOffset(15,5),a.show(),i.delay((function(){a.cmpEl.focus()}),10)},onSelectSignature:function(t,n,o,s){if(o){var a=e(s.target);if(a&&a.hasClass("caret")){var l=this.signatureMenu;if(l.isVisible())return void l.hide();var r=e(s.currentTarget),c=r.offset(),d=e(this.el).offset(),h=[c.left-d.left+r.width(),c.top-d.top+r.height()/2];this.showSignatureMenu(o,h),l.menuAlign="tr-br",l.menuAlignEl=r,l.setOffset(-20,-r.height()/2+3),l.show(),i.delay((function(){l.cmpEl.focus()}),10),s.stopPropagation(),s.preventDefault()}else this.api.asc_gotoSignature(o.get("guid"))}},showSignatureMenu:function(t,i){this.api.asc_gotoSignature(t.get("guid"));var n=this.signatureMenu,o=e(this.el),s=o.find("#menu-signature-container");n.rendered||(s.length<1&&(s=e('<div id="menu-signature-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',n.id),o.append(s)),n.render(s),n.cmpEl.attr({tabindex:"-1"}),n.on({"show:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)},"hide:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}}));var a=t.get("requested"),l=this._state.hasValid||this._state.hasInvalid;n.items[0].setVisible(a),n.items[1].setVisible(!a),n.items[2].setVisible(a||!t.get("invisible")),n.items[3].setVisible(!a),n.items[0].setDisabled(this._locked),n.items[3].setDisabled(this._locked),n.items[1].cmpEl.attr("data-value",t.get("certificateId")),n.items[2].cmpEl.attr("data-value",l?1:0),n.cmpEl.attr("data-value",t.get("guid")),s.css({left:i[0],top:i[1]})},onMenuSignatureClick:function(t,e){var i=t.cmpEl.attr("data-value");switch(e.value){case 0:Common.NotificationCenter.trigger("protect:sign",i);break;case 1:this.api.asc_ViewCertificate(e.cmpEl.attr("data-value"));break;case 2:Common.NotificationCenter.trigger("protect:signature","visible",!!parseInt(e.cmpEl.attr("data-value")),i);break;case 3:var n=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtRemoveWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&n.api.asc_RemoveSignature(i)}})}},onDocumentReady:function(){this._state.ready=!0,this.updateSignatures(this.api.asc_getSignatures(),this.api.asc_getRequestSignatures()),this.showSignatureTooltip(this._state.hasValid,this._state.hasInvalid,this._state.hasRequested)},showSignatureTooltip:function(t,e,i){var n=this,o=n._state.tip;if(t||e||i){var s=t||e,a=e?n.txtSignedInvalid:t?n.txtSigned:"";i&&(a=n.txtRequestedSignatures+"<br><br>"+a),o&&o.isVisible()&&(a!==o.text||s!==o.showLink)&&(o.close(),n._state.tip=void 0),n._state.tip||((o=new Common.UI.SynchronizeTip({target:SSE.getController("RightMenu").getView("RightMenu").btnSignature.btnEl,text:a,showLink:s,textLink:this.txtContinueEditing,placement:"left-bottom"})).on({dontshowclick:function(){Common.UI.warning({title:n.notcriticalErrorTitle,msg:n.txtEditWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&(o.close(),n._state.tip=void 0,n.api.asc_RemoveAllSignatures())}})},closeclick:function(){o.close(),n._state.tip=void 0}}),n._state.tip=o,o.show())}else o&&o.isVisible()&&(o.close(),n._state.tip=void 0)},disableEditing:function(t){this._state.DisabledEditing!=t&&(this._state.DisabledEditing=t,Common.NotificationCenter.trigger("editing:disable",t,{viewMode:t,allowSignature:!0,allowProtect:!0,rightMenu:{clear:!1,disable:!0},statusBar:!0,leftMenu:{disable:!1,previewMode:!0},fileMenu:!1,comments:{disable:!1,previewMode:!0},chat:!1,review:!0,viewport:!0,documentHolder:!0,toolbar:!0,celleditor:{previewMode:!0}},"signature"))},strSignature:"Signature",strRequested:"Requested signatures",strValid:"Valid signatures",strInvalid:"Invalid signatures",strSign:"Sign",strDetails:"Signature Details",strSetup:"Signature Setup",txtSigned:"Valid signatures has been added to the workbook. The workbook is protected from editing.",txtSignedInvalid:"Some of the digital signatures in workbook are invalid or could not be verified. The workbook is protected from editing.",txtRequestedSignatures:"This workbook needs to be signed.",txtContinueEditing:"Edit anyway",notcriticalErrorTitle:"Warning",txtEditWarning:"Editing will remove the signatures from the workbook.<br>Are you sure you want to continue?",strDelete:"Remove Signature",strSigner:"Signer",txtRemoveWarning:"Are you sure you want to remove this signature?<br>This action cannot be undone."},SSE.Views.SignatureSettings||{}))})),define("text!spreadsheeteditor/main/app/template/CellSettings.template",[],(function(){return'<table cols="2">\n    <tr>\n        <td>\n            <label class="header"><%= scope.textFill %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="cell-combo-fill-src" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div id="cell-panel-color-fill" class="settings-hidden padding-small" style="width: 100%;">\n                <div id="cell-back-color-btn" style=""></div>\n            </div>\n            <div id="cell-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\n                <label class="input-label" style="margin-top: 3px;"><%= scope.textPattern %></label>\n                <div id="cell-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.textForeground %></label>\n                    <div id="cell-foreground-color-btn" style="display: inline-block; float:right;"></div>\n                </div>\n                <div style="width: 100%; height: 25px;">\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.textBackground %></label>\n                    <div id="cell-background-color-btn" style="display: inline-block; float:right;"></div>\n                </div>\n            </div>\n            <div id="cell-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\n                <div style="height:80px;">\n                    <div style="display: inline-block;">\n                        <label class="input-label" style=""><%= scope.textAngle %></label>\n                        <div id="cell-spin-gradient-angle" style="width: 90px;"></div>\n                    </div>\n                    <div style="display: inline-block;float: right;">\n                        <label class="input-label" style=""><%= scope.textDirection %></label>\n                        <div id="cell-button-direction" style=""></div>\n                    </div>\n                </div>\n                <label class="header" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\n                <div style="display: inline-block; margin-top: 3px;">\n                    <div id="cell-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\n                </div>\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\n                    <div style="display: flex;">\n                    <div style="">\n                        <label class="input-label" style=""><%= scope.textGradientColor %></label>\n                        <div id="cell-gradient-color-btn"></div>\n                    </div>\n                    <div style="margin-left: 10px;">\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\n                        <div id="cell-gradient-position"></div>\n                    </div>\n                    </div>\n                    <div style="display:flex;padding-top:15px;">\n                        <div id="cell-gradient-add-step"></div>\n                        <div id="cell-gradient-remove-step"></div>\n                    </div>\n                </div>\n            </div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <label class="header"><%= scope.textBorders %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-combo-border-type" style="display: inline-block; vertical-align: middle; width: 93px;"></div>\n            <div style="display: inline-block; float:right;vertical-align: middle;">\n                <label class="input-label" style="margin-right: 5px;"><%= scope.textBorderColor %></label>\n                <div id="cell-border-color-btn" style="display: inline-block;"></div>\n            </div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="input-label"><%= scope.textSelectBorders %></label>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div id="cell-button-border-all" style="display: inline-block;"></div>\n            <div id="cell-button-border-none" style="display: inline-block;"></div>\n            <div id="cell-button-border-inner" style="display: inline-block;"></div>\n            <div id="cell-button-border-outer" style="display: inline-block;"></div>\n            <div id="cell-button-border-diagu" style="display: inline-block;"></div>\n            <div id="cell-button-border-diagd" style="display: inline-block;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div id="cell-button-border-left" style="display: inline-block;"></div>\n            <div id="cell-button-border-inner-vert" style="display: inline-block;"></div>\n            <div id="cell-button-border-right" style="display: inline-block;"></div>\n            <div id="cell-button-border-top" style="display: inline-block;"></div>\n            <div id="cell-button-border-inner-hor" style="display: inline-block;"></div>\n            <div id="cell-button-border-bottom" style="display: inline-block;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="">\n            <label class="header"><%= scope.textIndent %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large" colspan=2>\n            <div id="cell-spin-indent" style="display: inline-block;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <label class="header"><%= scope.textOrientation %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large" colspan=2>\n            <label class="input-label"><%= scope.textAngle %></label>\n            <div id="cell-spin-angle" style="display: inline-block;margin-left:5px;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <label class="header"><%= scope.textControl %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-checkbox-wrap"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-checkbox-shrink"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-btn-cond-format" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/CellSettings",["text!spreadsheeteditor/main/app/template/CellSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboBorderSize","common/main/lib/view/OpenDialog"],(function(t,e,i,n){"use strict";SSE.Views.CellSettings=n.View.extend(i.extend({el:"#id-cell-settings",template:i.template(t),events:{},options:{alias:"CellSettings"},initialize:function(){this._initSettings=!0,this._noApply=!0,this._sendUndoPoint=!0,this._state={DisabledControls:!0,DisabledFillPanels:!0,CellAngle:void 0,CellIndent:void 0,GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,CellColor:"transparent",FillType:Asc.c_oAscFill.FILL_TYPE_NOFILL,FGColor:"000000",BGColor:"ffffff",GradColor:"000000"},this.lockedControls=[],this._locked=!0,this.isEditCell=!1,this.BorderType=1,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradLinearDirectionType=0,this.GradRadialDirectionIdx=0,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.fillControls=[],this.gradientColorsStr="#000, #fff",this.typeGradient=90,this.render(),this.createDelayedControls(),this.FillColorContainer=e("#cell-panel-color-fill"),this.FillPatternContainer=e("#cell-panel-pattern-fill"),this.FillGradientContainer=e("#cell-panel-gradient-fill")},onColorsBackSelect:function(t,e){this.api&&this.api.asc_setCellBackgroundColor("transparent"==e?null:Common.Utils.ThemeColor.getRgbColor(e)),Common.NotificationCenter.trigger("edit:complete",this)},onBtnBordersClick:function(t,e){if(this.api){var i,n=[],o=this.BorderType;this.btnBorderColor.isAutoColor()?(i=new Asc.asc_CColor).put_auto(!0):i=Common.Utils.ThemeColor.getRgbColor(this.btnBorderColor.color),"inner"==t.options.borderId?(n[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(o,i)):"all"==t.options.borderId?(n[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(o,i)):"outer"==t.options.borderId?(n[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(o,i),n[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(o,i)):"none"!=t.options.borderId&&(n[t.options.borderId]=new Asc.asc_CBorder(o,i)),this.api.asc_setCellBorders(n)}Common.NotificationCenter.trigger("edit:complete",this)},onBorderTypeSelect:function(t,e){this.BorderType=e.value},onAngleChange:function(t,e,i,n){this.api&&e!==i&&this.api.asc_setCellAngle(t.getNumberValue())},onIndentChange:function(t,e,i,n){this.api&&e!==i&&this.api.asc_setCellIndent(t.getNumberValue())},render:function(){e(this.el).html(this.template({scope:this}))},setApi:function(t){return this.api=t,t&&this.api.asc_registerCallback("asc_onEditCell",this.onApiEditCell.bind(this)),this},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#cell-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbFillSrc.setValue(Asc.c_oAscFill.FILL_TYPE_NOFILL),this.fillControls.push(this.cmbFillSrc),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#cell-spin-gradient-angle"),step:10,width:90,defaultUnit:"°",value:"0 °",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this._viewDataLinear=[{offsetx:0,offsety:0,type:45,subtype:-1},{offsetx:50,offsety:0,type:90,subtype:4},{offsetx:100,offsety:0,type:135,subtype:5},{offsetx:0,offsety:50,type:0,subtype:6,cls:"item-gradient-separator",selected:!0},{offsetx:100,offsety:50,type:180,subtype:1},{offsetx:0,offsety:100,type:315,subtype:2},{offsetx:50,offsety:100,type:270,subtype:3},{offsetx:100,offsety:100,type:225,subtype:7}],i.each(this._viewDataLinear,(function(e){e.gradientColorsStr=t.gradientColorsStr})),this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-cell-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnDirection.on("render:after",(function(n){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-cell-menu-direction"),parentMenu:n.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background: linear-gradient(<%= type + 90 %>deg,<%= gradientColorsStr %>);"></div>')})})),this.btnDirection.render(e("#cell-button-direction")),this.fillControls.push(this.btnDirection),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#cell-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",(function(e,i){t.GradColor.currentIdx=i;var n=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(n),t.colorsGrad.select(n,!1),t.spnGradPosition.setValue(t.GradColor.values[t.GradColor.currentIdx])})),this.sldrGradient.on("thumbdblclick",(function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")})),this.sldrGradient.on("sortthumbs",(function(e,n){var o,s=[];i.each(n,(function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(o=i)})),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=o})),this.sldrGradient.on("addthumb",(function(e,i,n){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var o=t.sldrGradient.addNewThumb(i,n);t.GradColor.colors[t.GradColor.currentIdx]=o})),this.sldrGradient.on("removethumb",(function(e,n){if(t.sldrGradient.removeThumb(n),t.GradColor.values.splice(n,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var o=n>0?n-1:n;o=0===o&&t.GradColor.values.length>2?t.GradColor.values.length-2:o,t.GradColor.currentIdx=o}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)})),this.fillControls.push(this.sldrGradient);this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",itemTemplate:i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="28" height="28" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join(""))}),this.cmbPattern.render(e("#cell-combo-pattern")),this.cmbPattern.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",(function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.fillControls.push(this.cmbPattern);var n=[-1,-1,-1,-1,-1,-1,-1,-1,-1,8,9,10,11,-1,-1,-1,21,-1,-1,-1,-1,20,22,23,-1,-1,27,28,29,30,-1,-1,33,-1,35,-1,-1,-1,-1,-1,41,-1,43,-1,-1,46,-1,-1,-1,-1];this.patternViewData=[];for(var o=0,s=0;s<13;s++)for(var a=0;a<4;a++){var l=4*s+a;n[l]>-1&&(this.patternViewData[o++]={offsetx:28*a,offsety:28*s,type:n[l]})}for(s=0;s<this.patternViewData.length;s++)this.patternViewData[s].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type);var r=[[Asc.c_oAscBorderOptions.Left,"toolbar__icon btn-border-left","cell-button-border-left",this.tipLeft,"bottom"],[Asc.c_oAscBorderOptions.InnerV,"toolbar__icon btn-border-insidevert","cell-button-border-inner-vert",this.tipInnerVert,"bottom"],[Asc.c_oAscBorderOptions.Right,"toolbar__icon btn-border-right","cell-button-border-right",this.tipRight,"bottom"],[Asc.c_oAscBorderOptions.Top,"toolbar__icon btn-border-top","cell-button-border-top",this.tipTop,"bottom"],[Asc.c_oAscBorderOptions.InnerH,"toolbar__icon btn-border-insidehor","cell-button-border-inner-hor",this.tipInnerHor,"bottom"],[Asc.c_oAscBorderOptions.Bottom,"toolbar__icon btn-border-bottom","cell-button-border-bottom",this.tipBottom,"bottom"],[Asc.c_oAscBorderOptions.DiagU,"toolbar__icon btn-border-diagup","cell-button-border-diagu",this.tipDiagU,"top"],[Asc.c_oAscBorderOptions.DiagD,"toolbar__icon btn-border-diagdown","cell-button-border-diagd",this.tipDiagD,"top"],["inner","toolbar__icon btn-border-inside","cell-button-border-inner",this.tipInner,"top"],["outer","toolbar__icon btn-border-out","cell-button-border-outer",this.tipOuter,"top"],["all","toolbar__icon btn-border-all","cell-button-border-all",this.tipAll,"top"],["none","toolbar__icon btn-border-no","cell-button-border-none",this.tipNone,"top"]];i.each(r,(function(t,n,o){var s=new Common.UI.Button({parentEl:e("#"+t[2]),cls:"btn-toolbar borders--small",iconCls:t[1],borderId:t[0],hint:t[3],disabled:this._locked,dataHint:"1",dataHintDirection:t[4],dataHintOffset:"small"});s.on("click",i.bind(this.onBtnBordersClick,this)),this.lockedControls.push(s)}),this),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#cell-combo-border-type"),cls:"cell-border-type",style:"width: 93px;",menuStyle:"min-width: 93px;",disabled:this._locked,data:[{value:Asc.c_oAscBorderStyles.Thin,offsety:0},{value:Asc.c_oAscBorderStyles.Hair,offsety:20},{value:Asc.c_oAscBorderStyles.Dotted,offsety:40},{value:Asc.c_oAscBorderStyles.Dashed,offsety:60},{value:Asc.c_oAscBorderStyles.DashDot,offsety:80},{value:Asc.c_oAscBorderStyles.DashDotDot,offsety:100},{value:Asc.c_oAscBorderStyles.Medium,offsety:120},{value:Asc.c_oAscBorderStyles.MediumDashed,offsety:140},{value:Asc.c_oAscBorderStyles.MediumDashDot,offsety:160},{value:Asc.c_oAscBorderStyles.MediumDashDotDot,offsety:180},{value:Asc.c_oAscBorderStyles.Thick,offsety:200}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",i.bind(this.onBorderTypeSelect,this)),this.BorderType=Asc.c_oAscBorderStyles.Thin,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#cell-border-color-btn"),disabled:this._locked,menu:!0,color:"auto",auto:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.lockedControls.push(this.btnBorderColor),this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#cell-back-color-btn"),disabled:this._locked,menu:!0,transparent:!0,color:"transparent",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.lockedControls.push(this.btnBackColor),this.spnIndent=new Common.UI.MetricSpinner({el:e("#cell-spin-indent"),step:1,width:60,defaultUnit:"",value:"0",allowDecimal:!1,maxValue:250,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.spnIndent),this.spnIndent.on("change",i.bind(this.onIndentChange,this)),this.spnIndent.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnAngle=new Common.UI.MetricSpinner({el:e("#cell-spin-angle"),step:1,width:60,defaultUnit:"°",value:"0 °",allowDecimal:!1,maxValue:90,minValue:-90,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.spnAngle),this.spnAngle.on("change",i.bind(this.onAngleChange,this)),this.spnAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#cell-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#cell-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.lockedControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#cell-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.lockedControls.push(this.btnRemoveGradientStep),this.chWrap=new Common.UI.CheckBox({el:e("#cell-checkbox-wrap"),labelText:this.strWrap,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chWrap),this.chWrap.on("change",this.onWrapChange.bind(this)),this.chShrink=new Common.UI.CheckBox({el:e("#cell-checkbox-shrink"),labelText:this.strShrink,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chShrink),this.chShrink.on("change",this.onShrinkChange.bind(this)),this.btnCondFormat=new Common.UI.Button({parentEl:e("#cell-btn-cond-format"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-cond-format",caption:this.textCondFormat,style:"width: 100%;",menu:!0,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.btnCondFormat)},createDelayedElements:function(){this.UpdateThemeColors(),this.btnCondFormat.setMenu(new Common.UI.Menu({items:[{caption:Common.define.conditionalData.textValue,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textGreater,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThan},{caption:Common.define.conditionalData.textGreaterEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThanOrEqual},{caption:Common.define.conditionalData.textLess,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThan},{caption:Common.define.conditionalData.textLessEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThanOrEqual},{caption:Common.define.conditionalData.textEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.equal},{caption:Common.define.conditionalData.textNotEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notEqual},{caption:Common.define.conditionalData.textBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.between},{caption:Common.define.conditionalData.textNotBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notBetween}]})},{caption:Common.define.conditionalData.textTop+"/"+Common.define.conditionalData.textBottom,type:Asc.c_oAscCFType.top10,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textTop+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:0,percent:!1},{caption:Common.define.conditionalData.textTop+" 10%",type:Asc.c_oAscCFType.top10,value:0,percent:!0},{caption:Common.define.conditionalData.textBottom+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:1,percent:!1},{caption:Common.define.conditionalData.textBottom+" 10%",type:Asc.c_oAscCFType.top10,value:1,percent:!0}]})},{caption:Common.define.conditionalData.textAverage,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textAbove,type:Asc.c_oAscCFType.aboveAverage,value:0},{caption:Common.define.conditionalData.textBelow,type:Asc.c_oAscCFType.aboveAverage,value:1},{caption:Common.define.conditionalData.textEqAbove,type:Asc.c_oAscCFType.aboveAverage,value:2},{caption:Common.define.conditionalData.textEqBelow,type:Asc.c_oAscCFType.aboveAverage,value:3},{caption:Common.define.conditionalData.text1Above,type:Asc.c_oAscCFType.aboveAverage,value:4},{caption:Common.define.conditionalData.text1Below,type:Asc.c_oAscCFType.aboveAverage,value:5},{caption:Common.define.conditionalData.text2Above,type:Asc.c_oAscCFType.aboveAverage,value:6},{caption:Common.define.conditionalData.text2Below,type:Asc.c_oAscCFType.aboveAverage,value:7},{caption:Common.define.conditionalData.text3Above,type:Asc.c_oAscCFType.aboveAverage,value:8},{caption:Common.define.conditionalData.text3Below,type:Asc.c_oAscCFType.aboveAverage,value:9}]})},{caption:Common.define.conditionalData.textText,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textContains,type:Asc.c_oAscCFType.containsText},{caption:Common.define.conditionalData.textNotContains,type:Asc.c_oAscCFType.notContainsText},{caption:Common.define.conditionalData.textBegins,type:Asc.c_oAscCFType.beginsWith},{caption:Common.define.conditionalData.textEnds,type:Asc.c_oAscCFType.endsWith}]})},{caption:Common.define.conditionalData.textDate,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textYesterday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.yesterday},{caption:Common.define.conditionalData.textToday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.today},{caption:Common.define.conditionalData.textTomorrow,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.tomorrow},{caption:Common.define.conditionalData.textLast7days,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.last7Days},{caption:Common.define.conditionalData.textLastWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastWeek},{caption:Common.define.conditionalData.textThisWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisWeek},{caption:Common.define.conditionalData.textNextWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextWeek},{caption:Common.define.conditionalData.textLastMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastMonth},{caption:Common.define.conditionalData.textThisMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisMonth},{caption:Common.define.conditionalData.textNextMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextMonth}]})},{caption:Common.define.conditionalData.textBlank+"/"+Common.define.conditionalData.textError,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textBlanks,type:Asc.c_oAscCFType.containsBlanks},{caption:Common.define.conditionalData.textNotBlanks,type:Asc.c_oAscCFType.notContainsBlanks},{caption:Common.define.conditionalData.textErrors,type:Asc.c_oAscCFType.containsErrors},{caption:Common.define.conditionalData.textNotErrors,type:Asc.c_oAscCFType.notContainsErrors}]})},{caption:Common.define.conditionalData.textDuplicate+"/"+Common.define.conditionalData.textUnique,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textDuplicate,type:Asc.c_oAscCFType.duplicateValues},{caption:Common.define.conditionalData.textUnique,type:Asc.c_oAscCFType.uniqueValues}]})},{caption:"--"},this.mnuDataBars=new Common.UI.MenuItem({caption:this.textDataBars,type:Asc.c_oAscCFType.dataBar,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuColorScales=new Common.UI.MenuItem({caption:this.textColorScales,type:Asc.c_oAscCFType.colorScale,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuIconSets=new Common.UI.MenuItem({caption:Common.define.conditionalData.textIconSets,type:Asc.c_oAscCFType.iconSet,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),{caption:"--"},{caption:Common.define.conditionalData.textFormula,type:Asc.c_oAscCFType.expression},{caption:"--"},{caption:this.textNewRule,value:"new"},{caption:this.textClearRule,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:"clear",type:Asc.c_oAscSelectionForCFType.selection,caption:this.textSelection},{value:"clear",type:Asc.c_oAscSelectionForCFType.worksheet,caption:this.textThisSheet},{value:"clear",type:Asc.c_oAscSelectionForCFType.table,caption:this.textThisTable},{value:"clear",type:Asc.c_oAscSelectionForCFType.pivot,caption:this.textThisPivot}]})},{caption:this.textManageRule,value:"manage"}]})),this.btnCondFormat.menu.on("show:before",i.bind((function(){this.fireEvent("cf:init",[this,"cell"])}),this)),this._initSettings=!1},ChangeSettings:function(t){var e=this;if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){this._noApply=!0;var n=t.asc_getXfs(),o=n.asc_getAngle();if((Math.abs(this._state.CellAngle-o)>.1||void 0===this._state.CellAngle&&this._state.CellAngle!==o)&&(this.spnAngle.setValue(null!==o?255==o?0:o:"",!0),this._state.CellAngle=o),o=n.asc_getIndent(),(Math.abs(this._state.CellIndent-o)>.1||void 0===this._state.CellIndent&&this._state.CellIndent!==o)&&(this.spnIndent.setValue(null!==o?o:"",!0),this._state.CellIndent=o),o=n.asc_getWrapText(),this._state.Wrap!==o&&(this.chWrap.setValue(null!=o?o:"indeterminate",!0),this._state.Wrap=o),this.chWrap.setDisabled(n.asc_getHorAlign()==AscCommon.align_Justify||this._locked),o=n.asc_getShrinkToFit(),this._state.Shrink!==o&&(this.chShrink.setValue(null!=o?o:"indeterminate",!0),this._state.Shrink=o),this.chShrink.setDisabled("checked"==this.chWrap.getValue()||this._locked),this.fill=n.asc_getFill(),this.fill){if(this.pattern=this.fill.asc_getPatternFill(),this.gradient=this.fill.asc_getGradientFill(),null===this.pattern&&null===this.gradient)this.CellColor={Value:0,Color:"transparent"},this.FGColor={Value:1,Color:{color:"4f81bd",effectId:24}},this.BGColor={Value:1,Color:"ffffff"},this.sldrGradient.setThumbs(2),this.GradColor.colors.length=0,this.GradColor.values.length=0,this.GradColor.colors[0]={color:"4f81bd",effectId:24},this.GradColor.colors[1]="ffffff",this.GradColor.values=[0,100],this.GradColor.currentIdx=0,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(null!==this.pattern)if(-1===this.pattern.asc_getType()){(a=this.pattern.asc_getFgColor())?(a.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.CellColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB()),effectValue:a.asc_getValue()}}:this.CellColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB())},this.FGColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.CellColor.Color)}):this.FGColor=this.CellColor={Value:1,Color:"ffffff"},this.BGColor={Value:1,Color:"ffffff"},this.sldrGradient.setThumbs(2),this.GradColor.colors.length=0,this.GradColor.values.length=0,this.GradColor.values=[0,100],this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.CellColor.Color),this.GradColor.colors[1]="ffffff",this.GradColor.currentIdx=0,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID}else{if(this.PatternFillType=this.pattern.asc_getType(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();var s=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(s),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}var a;(a=this.pattern.asc_getFgColor())?a.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB()),effectValue:a.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB())}:this.FGColor={Value:1,Color:{color:"000000",effectId:24}},(a=this.pattern.asc_getBgColor())?a.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB()),effectValue:a.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.CellColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.sldrGradient.setThumbs(2),this.GradColor.colors.length=0,this.GradColor.values.length=0,this.GradColor.values=[0,100],this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[1]="ffffff",this.GradColor.currentIdx=0,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT}else if(null!==this.gradient){var l=this.gradient.asc_getType();if(this._state.GradFillType===l&&this.GradFillType===l||(this.GradFillType=l,this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){o=this.gradient.asc_getDegree();if(Math.abs(this.GradLinearDirectionType-o)>.001){this.GradLinearDirectionType=o;var r=this.mnuDirectionPicker.store.findWhere({type:o});this.mnuDirectionPicker.selectRecord(r,!0),this.typeGradient=r?o+90:-1,this.numGradientAngle.setValue(o,!0)}}e=this;var c,d=(c=this.gradient.asc_getGradientStops()).length;this.sldrGradient.setThumbs(d),this.GradColor.colors.length=0,this.GradColor.values.length=0,c.forEach((function(t){var i=t.asc_getColor(),n=t.asc_getPosition();e.GradColor.colors.push(i.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(i.asc_getR(),i.asc_getG(),i.asc_getB()),effectValue:i.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(i.asc_getR(),i.asc_getG(),i.asc_getB())),e.GradColor.values.push(100*n)}));for(var h=[],p=0;p<d;p++)e.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof e.GradColor.colors[p]?e.GradColor.colors[p].color:e.GradColor.colors[p]),p),e.sldrGradient.setValue(p,e.GradColor.values[p]),h.push(e.sldrGradient.getColorValue(p)+" "+e.sldrGradient.getValue(p)+"%");this.btnDirectionRedraw(e.sldrGradient,h.join(", ")),(i.isUndefined(e.GradColor.currentIdx)||e.GradColor.currentIdx>=e.GradColor.colors.length)&&(e.GradColor.currentIdx=0),e.sldrGradient.setActiveThumb(e.GradColor.currentIdx),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx]),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.GradColor.colors[0])},this.BGColor={Value:1,Color:"ffffff"},this.CellColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.GradColor.colors[0])}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType));var m=typeof this.CellColor.Color,u=typeof this._state.CellColor;if(m!==u||"object"==m&&(this.CellColor.Color.effectValue!==this._state.CellColor.effectValue||this._state.CellColor.color.indexOf(this.CellColor.Color)<0)||"object"!=m&&void 0!==this._state.CellColor&&this._state.CellColor.indexOf(this.CellColor.Color)<0){if(this.btnBackColor.setColor(this.CellColor.Color),i.isObject(this.CellColor.Color)){for(var g=!1,f=0;f<10;f++)if(Common.Utils.ThemeColor.ThemeValues[f]==this.CellColor.Color.effectValue){this.colorsBack.select(this.CellColor.Color,!0),g=!0;break}g||this.colorsBack.clearSelection()}else this.colorsBack.select(this.CellColor.Color,!0);this._state.CellColor=this.CellColor.Color}if((m=typeof this.FGColor.Color)!==(u=typeof this._state.FGColor)||"object"==m&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=m&&this._state.FGColor.indexOf(this.FGColor.Color)<0){if(this.btnFGColor.setColor(this.FGColor.Color),"object"==typeof this.FGColor.Color){for(g=!1,f=0;f<10;f++)if(Common.Utils.ThemeColor.ThemeValues[f]==this.FGColor.Color.effectValue){this.colorsFG.select(this.FGColor.Color,!0),g=!0;break}g||this.colorsFG.clearSelection()}else this.colorsFG.select(this.FGColor.Color,!0);this._state.FGColor=this.FGColor.Color}if((m=typeof this.BGColor.Color)!==(u=typeof this._state.BGColor)||"object"==m&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=m&&this._state.BGColor.indexOf(this.BGColor.Color)<0){if(this.btnBGColor.setColor(this.BGColor.Color),"object"==typeof this.BGColor.Color){for(g=!1,f=0;f<10;f++)if(Common.Utils.ThemeColor.ThemeValues[f]==this.BGColor.Color.effectValue){this.colorsBG.select(this.BGColor.Color,!0),g=!0;break}g||this.colorsBG.clearSelection()}else this.colorsBG.select(this.BGColor.Color,!0);this._state.BGColor=this.BGColor.Color}var b=this.GradColor.colors[this.GradColor.currentIdx];if((m=typeof b)!==(u=typeof this._state.GradColor)||"object"==m&&(b.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(b.color)<0)||"object"!=m&&this._state.GradColor.indexOf(b)<0){if(this.btnGradColor.setColor(b),"object"==typeof b){for(g=!1,f=0;f<10;f++)if(Common.Utils.ThemeColor.ThemeValues[f]==b.effectValue){this.colorsGrad.select(b,!0),g=!0;break}g||this.colorsGrad.clearSelection()}else this.colorsGrad.select(b,!0);this._state.GradColor=b}this._noApply=!1}}},btnDirectionRedraw:function(t,e){this.gradientColorsStr=e,i.each(this._viewDataLinear,(function(t){t.gradientColorsStr=e})),this.mnuDirectionPicker.store.each((function(t){t.set("gradientColorsStr",e)}),this),-1==this.typeGradient?this.btnDirection.$icon.css({background:"none"}):2==this.typeGradient?this.btnDirection.$icon.css({background:"radial-gradient("+e+")"}):this.btnDirection.$icon.css({background:"linear-gradient("+this.typeGradient+"deg, "+e+")"})},UpdateThemeColors:function(){this.borderColor||(this.btnBorderColor.setMenu(),this.borderColor=this.btnBorderColor.getPicker(),this.btnBackColor.setMenu(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.colorsBack=this.btnBackColor.getPicker(),this.fillControls.push(this.btnBackColor),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#cell-gradient-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.fillControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#cell-foreground-color-btn"),color:"000000",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.fillControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#cell-background-color-btn"),color:"ffffff",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.fillControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this))),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.borderColor.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),!this.btnBorderColor.isAutoColor()&&this.btnBorderColor.setColor(this.borderColor.getColor()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},onApiEditCell:function(t){this.isEditCell=t!=Asc.c_oAscCellEditorState.editEnd,t!=Asc.c_oAscCellEditorState.editStart&&t!=Asc.c_oAscCellEditorState.editEnd||this.disableControls(this._locked)},setLocked:function(t){this._locked=t},disableFillPanels:function(t){this._state.DisabledFillPanels!==t&&(this._state.DisabledFillPanels=t,i.each(this.fillControls,(function(e){e.setDisabled(t)})))},disableControls:function(t){this._initSettings||(t=t||this.isEditCell,this.disableFillPanels(t),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)}))))},onFillSrcSelect:function(t,e){var i=this;switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this._noApply||(null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill),this.pattern.asc_setType(-1),this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor("transparent"==this.CellColor.Color?{color:"4f81bd",effectId:24}:this.CellColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill));break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){if(null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill),this.gradient.asc_setType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&this.gradient.asc_setDegree(this.GradLinearDirectionType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){if(this.GradColor.currentIdx=0,2===this.GradColor.colors.length){var n=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();"ffffff"===n&&"ffffff"===o&&(this.GradColor.colors[0]={color:"4f81bd",effectId:24})}var s=[];this.GradColor.colors.forEach((function(t,e){var n=new Asc.asc_CGradientStop;n.asc_setColor(Common.Utils.ThemeColor.getRgbColor(i.GradColor.colors[e])),n.asc_setPosition(i.GradColor.values[e]/100),s.push(n)})),this.gradient.asc_putGradientStops(s)}this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill)}break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){var a=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();a="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===a?{color:"4f81bd",effectId:24}:this.FGColor.Color,null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill),this.pattern.asc_setType(this.PatternFillType),this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(a)),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,this._noApply||(this.fill.asc_setPatternFill(null),this.fill.asc_setGradientFill(null),this.api.asc_setCellFill(this.fill))}Common.NotificationCenter.trigger("edit:complete",this)},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD)},onSelectGradient:function(t,e,n,o){var s=this;if(!this._noApply){var a={};if(i.isFunction(o.toJSON)){if(!o.get("selected"))return;a=o.toJSON()}else a=o;if(this.typeGradient=a.type+90,this.GradLinearDirectionType=a.type,this.numGradientAngle.setValue(a.type,!0),this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){if(null==this.gradient){this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType);var l=[];this.GradColor.values.forEach((function(t,e){var i=new Asc.asc_CGradientStop;i.asc_setColor(Common.Utils.ThemeColor.getRgbColor(s.GradColor.colors[e])),i.asc_setPosition(s.GradColor.values[e]/100),l.push(i)})),this.gradient.asc_putGradientStops(l)}this.gradient.asc_setDegree(a.type),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill)}Common.NotificationCenter.trigger("edit:complete",this)}},onColorsGradientSelect:function(t,e){var i=this;if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==typeof e?e.color:e)),this.api&&!this._noApply){null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&this.gradient.asc_setDegree(this.GradLinearDirectionType));var n=[];this.GradColor.values.forEach((function(t,e){var o=new Asc.asc_CGradientStop;o.asc_setColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(i.GradColor.colors[e]))),o.asc_setPosition(i.GradColor.values[e]/100),n.push(o)})),this.gradient.asc_putGradientStops(n),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientAngleChange:function(t,e,i,n){this.api&&!this._noApply&&(null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType)),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&this.gradient.asc_setDegree(t.getNumberValue()),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill))},onGradientChange:function(t,e,n){this.GradColor.values=t.getValues(),this.spnGradPosition.setValue(this.GradColor.values[this.GradColor.currentIdx],!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=this;null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill);var e=[];this.GradColor.colors.forEach((function(i,n){var o=new Asc.asc_CGradientStop;o.asc_setColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(t.GradColor.colors[n]))),o.asc_setPosition(t.GradColor.values[n]/100),e.push(o)})),this.gradient.asc_putGradientStops(e),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill),this._sliderChanged=!1}},onPatternSelect:function(t,e){this.api&&!this._noApply&&(this.PatternFillType=e.get("type"),null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill,this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),this.pattern.asc_setType(this.PatternFillType),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)),Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(t,e){this.FGColor={Value:1,Color:e},this.api&&!this._noApply&&(null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill,this.pattern.asc_setType(this.PatternFillType),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)),Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(t,e){this.BGColor={Value:1,Color:e},this.api&&!this._noApply&&(null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill,this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.pattern.asc_setType(this.PatternFillType)),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)),Common.NotificationCenter.trigger("edit:complete",this)},onWrapChange:function(t,e,i,n){this.api&&!this._noApply&&this.api.asc_setCellTextWrap("checked"==t.getValue()),this.chShrink.setDisabled("checked"==t.getValue()||this._locked),Common.NotificationCenter.trigger("edit:complete",this)},onShrinkChange:function(t,e,i,n){this.api&&!this._noApply&&this.api.asc_setCellTextShrink("checked"==t.getValue()),Common.NotificationCenter.trigger("edit:complete",this)},onPositionChange:function(t){var e=this,i=t.getNumberValue(),n=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],o=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,s=i<n||i>o;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=i,null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType));var a=[];this.GradColor.values.forEach((function(t,i){var n=new Asc.asc_CGradientStop;n.asc_setColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(e.GradColor.colors[i]))),n.asc_setPosition(e.GradColor.values[i]/100),a.push(n)})),this.gradient.asc_putGradientStops(a),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill),s&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx)}},textBorders:"Border's Style",textBorderColor:"Color",textBackColor:"Background color",textSelectBorders:"Select borders that you want to change",tipTop:"Set Outer Top Border Only",tipLeft:"Set Outer Left Border Only",tipBottom:"Set Outer Bottom Border Only",tipRight:"Set Outer Right Border Only",tipAll:"Set Outer Border and All Inner Lines",tipNone:"Set No Borders",tipInner:"Set Inner Lines Only",tipInnerVert:"Set Vertical Inner Lines Only",tipInnerHor:"Set Horizontal Inner Lines Only",tipOuter:"Set Outer Border Only",tipDiagU:"Set Diagonal Up Border",tipDiagD:"Set Diagonal Down Border",textOrientation:"Text Orientation",textAngle:"Angle",textFill:"Fill",textNoFill:"No Fill",textGradientFill:"Gradient Fill",textPatternFill:"Pattern",textColor:"Color Fill",textDirection:"Direction",textLinear:"Linear",textRadial:"Radial",textPattern:"Pattern",textForeground:"Foreground color",textBackground:"Background color",textGradient:"Gradient",textControl:"Text Control",strWrap:"Wrap text",strShrink:"Shrink to fit",textGradientColor:"Color",textPosition:"Position",tipAddGradientPoint:"Add gradient point",tipRemoveGradientPoint:"Remove gradient point",textIndent:"Indent",textCondFormat:"Conditional formatting",textDataBars:"Data Bars",textColorScales:"Color Scales",textNewRule:"New Rule",textClearRule:"Clear Rules",textSelection:"From current selection",textThisSheet:"From this worksheet",textThisTable:"From this table",textThisPivot:"From this pivot",textManageRule:"Manage Rules",textItems:"Items"},SSE.Views.CellSettings||{}))})),define("text!spreadsheeteditor/main/app/template/SlicerSettings.template",[],(function(){return'<table cols="3">\n    <tr>\n        <td class="padding-large" width="88px">\n            <label class="input-label"><%= scope.textWidth %></label>\n            <div id="slicer-spin-width"></div>\n        </td>\n        <td class="padding-large" width="28px" style="vertical-align: bottom;">\n            <div id="slicer-button-ratio"></div>\n        </td>\n        <td class="padding-large" width="88px">\n            <label class="input-label"><%= scope.textHeight %></label>\n            <div id="slicer-spin-height"></div>\n        </td>\n    </tr>\n</table>\n<table cols="2">\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="header"><%= scope.textPosition %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textHor %></label>\n            <div id="slicer-spin-hor"></div>\n        </td>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textVert %></label>\n            <div id="slicer-spin-vert"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-checkbox-disable-resize"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textButtons %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="input-label"><%= scope.textColumns %></label>\n            <div id="slicer-spin-cols" style="display: inline-block;margin-left:5px;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textWidth %></label>\n            <div id="slicer-spin-col-width"></div>\n        </td>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textHeight %></label>\n            <div id="slicer-spin-col-height"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textStyle %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-btn-style" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="header"><%= scope.strSorting %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-radio-asc"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large" colspan=2>\n            <div id="slicer-radio-desc"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-check-hide-nodata"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-check-indicate-nodata"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-check-show-nodata-last"></div>\n        </td>\n    </tr>\n    \x3c!--<tr>--\x3e\n        \x3c!--<td class="padding-small" colspan=2>--\x3e\n            \x3c!--<div id="slicer-check-show-deleted"></div>--\x3e\n        \x3c!--</td>--\x3e\n    \x3c!--</tr>--\x3e\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td align="center" colspan=2>\n            <label class="link" id="slicer-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/SlicerSettings",["text!spreadsheeteditor/main/app/template/SlicerSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","spreadsheeteditor/main/app/view/SlicerSettingsAdvanced"],(function(t,e,i,n){"use strict";SSE.Views.SlicerSettings=n.View.extend(i.extend({el:"#id-slicer-settings",template:i.template(t),events:{},options:{alias:"SlicerSettings"},initialize:function(){this._initSettings=!0,this._nRatio=1,this._state={Width:0,Height:0,DisabledControls:!1,keepRatio:!1,ColCount:0,ColWidth:0,ColHeight:0,PosVert:0,PosHor:0,PosLocked:!1,SortOrder:void 0,IndNoData:!1,ShowNoData:!1,HideNoData:!1,DisabledSizeControls:!1},this.spinners=[],this.lockedControls=[],this.sizeControls=[],this._locked=!1,this._noApply=!1,this._originalProps=null,this.styles=null,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#slicer-advanced-link")},setApi:function(t){if(null!=t)return this.api=t,this.api.asc_registerCallback("asc_onSendThemeColors",i.bind(this.onSendThemeColors,this)),this},setMode:function(t){this.mode=t},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this.spnWidth&&this.spnWidth.setValue(null!==this._state.Width?Common.Utils.Metric.fnRecalcFromMM(this._state.Width):"",!0),this.spnHeight&&this.spnHeight.setValue(null!==this._state.Height?Common.Utils.Metric.fnRecalcFromMM(this._state.Height):"",!0),this.spnColWidth&&this.spnColWidth.setValue(null!==this._state.ColWidth?Common.Utils.Metric.fnRecalcFromMM(this._state.ColWidth):"",!0),this.spnColHeight&&this.spnColHeight.setValue(null!==this._state.ColHeight?Common.Utils.Metric.fnRecalcFromMM(this._state.ColHeight):"",!0);var i=this._state.PosHor;this.spnHor&&this.spnHor.setValue(null!=i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=this._state.PosVert,this.spnVert&&this.spnVert.setValue(null!=i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0)}},createDelayedControls:function(){var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:e("#slicer-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnWidth),this.sizeControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:e("#slicer-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnHeight),this.sizeControls.push(this.spnHeight),this.btnRatio=new Common.UI.Button({parentEl:e("#slicer-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.sizeControls.push(this.btnRatio),this.btnRatio.on("click",i.bind((function(t,e){t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this.api&&this._originalProps&&(this._originalProps.asc_putLockAspect(t.pressed),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.spnWidth.on("change",i.bind(this.onWidthChange,this)),this.spnHeight.on("change",i.bind(this.onHeightChange,this)),this.spnWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHor=new Common.UI.MetricSpinner({el:e("#slicer-spin-hor"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnHor),this.sizeControls.push(this.spnHor),this.spnVert=new Common.UI.MetricSpinner({el:e("#slicer-spin-vert"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnVert),this.sizeControls.push(this.spnVert),this.spnHor.on("change",i.bind(this.onHorChange,this)),this.spnVert.on("change",i.bind(this.onVertChange,this)),this.spnHor.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnVert.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.chLock=new Common.UI.CheckBox({el:e("#slicer-checkbox-disable-resize"),labelText:this.textLock,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLock),this.chLock.on("change",this.onLockSlicerChange.bind(this)),this.spnColWidth=new Common.UI.MetricSpinner({el:e("#slicer-spin-col-width"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnColWidth),this.sizeControls.push(this.spnColWidth),this.spnColHeight=new Common.UI.MetricSpinner({el:e("#slicer-spin-col-height"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnColHeight),this.sizeControls.push(this.spnColHeight),this.numCols=new Common.UI.MetricSpinner({el:e("#slicer-spin-cols"),step:1,width:55,defaultUnit:"",defaultValue:1,value:"1",allowDecimal:!1,maxValue:2e4,minValue:1,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.sizeControls.push(this.numCols),this.spnColWidth.on("change",i.bind(this.onColWidthChange,this)),this.spnColHeight.on("change",i.bind(this.onColHeightChange,this)),this.numCols.on("change",i.bind(this.onColChange,this)),this.spnColWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnColHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.numCols.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.radioAsc=new Common.UI.RadioBox({el:e("#slicer-radio-asc"),name:"asc-radio-slicer-sort",labelText:this.textAsc+" ("+this.textAZ+")",checked:!0,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.radioAsc.on("change",i.bind((function(t,e,i){e&&this.api&&(this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setSortOrder(Asc.ST_tabularSlicerCacheSortOrder.Ascending),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this))}),this)),this.lockedControls.push(this.radioAsc),this.radioDesc=new Common.UI.RadioBox({el:e("#slicer-radio-desc"),name:"asc-radio-slicer-sort",labelText:this.textDesc+" ("+this.textZA+")",checked:!1,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.radioDesc.on("change",i.bind((function(t,e,i){e&&this.api&&(this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setSortOrder(Asc.ST_tabularSlicerCacheSortOrder.Descending),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this))}),this)),this.lockedControls.push(this.radioDesc),this.chHideNoData=new Common.UI.CheckBox({el:e("#slicer-check-hide-nodata"),labelText:this.strHideNoData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chHideNoData.on("change",i.bind((function(t,e,i,n){var o="checked"==t.getValue();this._originalProps&&this.api&&(this._originalProps.asc_getSlicerProperties().asc_setHideItemsWithNoData(o),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.chHideNoData),this.chIndNoData=new Common.UI.CheckBox({el:e("#slicer-check-indicate-nodata"),labelText:this.strIndNoData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chIndNoData.on("change",i.bind((function(t,e,i,n){var o="checked"==t.getValue();this._originalProps&&this.api&&(this._originalProps.asc_getSlicerProperties().asc_setIndicateItemsWithNoData(o),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.chIndNoData),this.chShowNoData=new Common.UI.CheckBox({el:e("#slicer-check-show-nodata-last"),disabled:!0,labelText:this.strShowNoData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chShowNoData.on("change",i.bind((function(t,e,i,n){this._originalProps&&this.api&&(this._originalProps.asc_getSlicerProperties().asc_setShowItemsWithNoDataLast("checked"==t.getValue()),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.chShowNoData),this.chShowDel=new Common.UI.CheckBox({el:e("#slicer-check-show-deleted"),labelText:this.strShowDel,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chShowDel.on("change",i.bind((function(t,e,i,n){}),this)),this.lockedControls.push(this.chShowDel),e(this.el).on("click","#slicer-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},onSendThemeColors:function(){this.btnSlicerStyle&&this._originalProps&&this.onInitStyles(this._originalProps.asc_getSlicerProperties().asc_getStylesPictures())},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var n,o,s=i.length-1;s>=0;s--)if(n=i[s].asc_getObjectType(),o=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Image==n){new SSE.Views.SlicerSettingsAdvanced({imageProps:o,api:e.api,styles:e.styles||e._originalProps.asc_getSlicerProperties().asc_getStylesPictures(),handler:function(t,i){"ok"==t&&e.api&&e.api.asc_setGraphicObjectProps(i.imageProps),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),t){this._originalProps=new Asc.asc_CImgProperty(t);var e=t.asc_getWidth();if((Math.abs(this._state.Width-e)>.001||(null===this._state.Width||null===e)&&this._state.Width!==e)&&(this.spnWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Width=e),e=t.asc_getHeight(),(Math.abs(this._state.Height-e)>.001||(null===this._state.Height||null===e)&&this._state.Height!==e)&&(this.spnHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Height=e),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),e=t.asc_getLockAspect(),this._state.keepRatio!==e&&(this.btnRatio.toggle(e),this._state.keepRatio=e),e=t.get_Position()){var i={X:e.get_X(),Y:e.get_Y()};this.spnHor.setValue(null!=i.X?Common.Utils.Metric.fnRecalcFromMM(i.X):"",!0),this.spnVert.setValue(null!=i.Y?Common.Utils.Metric.fnRecalcFromMM(i.Y):"",!0),this._state.PosHor=i.X,this._state.PosVert=i.Y}else this.spnHor.setValue("",!0),this.spnVert.setValue("",!0),this._state.PosHor=this._state.PosVert=null;var n=t.asc_getSlicerProperties();if(this.disableControls(this._locked,!!n&&n.asc_getLockedPosition()),n){if(e=n.asc_getColumnCount(),(Math.abs(this._state.ColCount-e)>.1||(null===this._state.ColCount||null===e)&&this._state.ColCount!==e)&&(this.numCols.setValue(null!==e?e:"",!0),this._state.ColCount=e),e=n.asc_getButtonWidth()/36e3,(Math.abs(this._state.ColWidth-e)>.001||(null===this._state.ColWidth||null===e)&&this._state.ColWidth!==e)&&(this.spnColWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.ColWidth=e),e=n.asc_getRowHeight()/36e3,(Math.abs(this._state.ColHeight-e)>.001||(null===this._state.ColHeight||null===e)&&this._state.ColHeight!==e)&&(this.spnColHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.ColHeight=e),this.btnSlicerStyle||this.onInitStyles(n.asc_getStylesPictures()),e=n.asc_getStyle(),this._state.StyleType!==e||this._isTemplatesChanged){this.btnSlicerStyle.suspendEvents();var o=this.btnSlicerStyle.menuPicker.store.findWhere({type:e});this.btnSlicerStyle.menuPicker.selectRecord(o),this.btnSlicerStyle.resumeEvents(),o?this.btnSlicerStyle.fillComboView(this.btnSlicerStyle.menuPicker.getSelectedRec(),!0):this.btnSlicerStyle.fillComboView(this.btnSlicerStyle.menuPicker.store.at(0),!0),this._state.StyleType=e}this._isTemplatesChanged=!1,e=n.asc_getLockedPosition(),this.chLock.setValue(null!=e?!!e:"indeterminate",!0),(e=n.asc_getSortOrder())==Asc.ST_tabularSlicerCacheSortOrder.Ascending?this.radioAsc.setValue(!0,!0):this.radioDesc.setValue(!0,!0),e=n.asc_getIndicateItemsWithNoData(),this._state.IndNoData!==e&&(this.chIndNoData.setValue(null!=e?!!e:"indeterminate",!0),this._state.IndNoData=e),e=n.asc_getShowItemsWithNoDataLast(),this._state.ShowNoData!==e&&(this.chShowNoData.setValue(null!=e?!!e:"indeterminate",!0),this._state.ShowNoData=e),e=n.asc_getHideItemsWithNoData(),this._state.HideNoData!==e&&(this.chHideNoData.setValue(null!=e?!!e:"indeterminate",!0),this._state.HideNoData=e),this.chIndNoData.setDisabled(e||this._locked),this.chShowNoData.setDisabled(e||"checked"!=this.chIndNoData.getValue()||this._locked),this.chShowDel.setDisabled(e||this._locked)}}},onWidthChange:function(t,e,i,n){var o=t.getNumberValue(),s=this.spnHeight.getNumberValue();this.btnRatio.pressed&&((s=o/this._nRatio)>this.spnHeight.options.maxValue&&(o=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(o,!0)),this.spnHeight.setValue(s,!0)),this.api&&this._originalProps&&(this._originalProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(o)),this._originalProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onHeightChange:function(t,e,i,n){var o=t.getNumberValue(),s=this.spnWidth.getNumberValue();this.btnRatio.pressed&&((s=o*this._nRatio)>this.spnWidth.options.maxValue&&(o=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(o,!0)),this.spnWidth.setValue(s,!0)),this.api&&this._originalProps&&(this._originalProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),this._originalProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(o)),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onHorChange:function(t,e,i,n){var o=new Asc.CPosition;""!==t.getValue()&&o.put_X(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),""!==this.spnVert.getValue()&&o.put_Y(Common.Utils.Metric.fnRecalcToMM(this.spnVert.getNumberValue())),this.api&&this._originalProps&&(this._originalProps.put_Position(o),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onVertChange:function(t,e,i,n){var o=new Asc.CPosition;""!==this.spnHor.getValue()&&o.put_X(Common.Utils.Metric.fnRecalcToMM(this.spnHor.getNumberValue())),""!==t.getValue()&&o.put_Y(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api&&this._originalProps&&(this._originalProps.put_Position(o),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onColWidthChange:function(t,e,i,n){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setButtonWidth(36e3*Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onColHeightChange:function(t,e,i,n){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setRowHeight(36e3*Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onColChange:function(t,e,i,n){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setColumnCount(t.getNumberValue()),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onInitStyles:function(t){var n=this;if(this._isTemplatesChanged=!0,this.styles=t,this.btnSlicerStyle||(this.btnSlicerStyle=new Common.UI.ComboDataView({itemWidth:36,itemHeight:48,menuMaxHeight:235,enableKeyEvents:!0,cls:"combo-slicer-style",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnSlicerStyle.render(e("#slicer-btn-style")),this.btnSlicerStyle.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.btnSlicerStyle.on("click",i.bind(this.onSelectSlicerStyle,this)),this.btnSlicerStyle.openButton.menu.on("show:after",(function(){n.btnSlicerStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.btnSlicerStyle),this._locked&&this.btnSlicerStyle.setDisabled(this._locked)),t&&t.length>0){var o=this.btnSlicerStyle.menuPicker.store;if(o){var s=o.length;if(s>0&&s==this.styles.length){var a=o.models;i.each(t,(function(t,e){a[e].set("imageUrl",t.asc_getImage())}))}else{var l=[];i.each(t,(function(t,e){l.push({type:t.asc_getName(),imageUrl:t.asc_getImage()})})),o.reset(l,{silent:!1})}}}else this.btnSlicerStyle.menuPicker.store.reset(),this.btnSlicerStyle.clearComboView();this.btnSlicerStyle.setDisabled(this.btnSlicerStyle.menuPicker.store.length<1||this._locked)},onSelectSlicerStyle:function(t,e){this._noApply||(this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setStyle(e.get("type")),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this))},onLockSlicerChange:function(t,e,i,n){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setLockedPosition("checked"==t.getValue()),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},setLocked:function(t){this._locked=t},disableControls:function(t,e){this._initSettings||(this.disableSizeControls(t||e),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t)))},disableSizeControls:function(t){this._state.DisabledSizeControls!==t&&(this._state.DisabledSizeControls=t,i.each(this.sizeControls,(function(e){e.setDisabled(t)})))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textAdvanced:"Show advanced settings",textPosition:"Position",textHor:"Horizontal",textVert:"Vertical",textButtons:"Buttons",textColumns:"Columns",textStyle:"Style",textLock:"Disable resizing or moving",strSorting:"Sorting and filtering",textAsc:"Ascending",textDesc:"Descending",textAZ:"A to Z",textZA:"Z to A",textOldNew:"oldest to newest",textNewOld:"newest to oldest",textSmallLarge:"smallest to largest",textLargeSmall:"largest to smallest",strHideNoData:"Hide items with no data",strIndNoData:"Visually indicate items with no data",strShowNoData:"Show items with no data last",strShowDel:"Show items deleted from the data source"},SSE.Views.SlicerSettings||{}))}));var SCALE_MIN=40,MENU_SCALE_PART=260,reqerr;if(define("spreadsheeteditor/main/app/view/RightMenu",["text!spreadsheeteditor/main/app/template/RightMenu.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","spreadsheeteditor/main/app/view/ParagraphSettings","spreadsheeteditor/main/app/view/ImageSettings","spreadsheeteditor/main/app/view/ChartSettings","spreadsheeteditor/main/app/view/ShapeSettings","spreadsheeteditor/main/app/view/TextArtSettings","spreadsheeteditor/main/app/view/TableSettings","spreadsheeteditor/main/app/view/PivotSettings","spreadsheeteditor/main/app/view/SignatureSettings","spreadsheeteditor/main/app/view/CellSettings","spreadsheeteditor/main/app/view/SlicerSettings","common/main/lib/component/Scroller"],(function(t,e,i,n){"use strict";SSE.Views.RightMenu=n.View.extend(i.extend({el:"#right-menu",template:i.template(t),events:{},initialize:function(){return this.minimizedMode=!0,this.btnText=new Common.UI.Button({hint:this.txtParagraphSettings,asctype:Common.Utils.documentSettingsType.Paragraph,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnImage=new Common.UI.Button({hint:this.txtImageSettings,asctype:Common.Utils.documentSettingsType.Image,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnChart=new Common.UI.Button({hint:this.txtChartSettings,asctype:Common.Utils.documentSettingsType.Chart,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnShape=new Common.UI.Button({hint:this.txtShapeSettings,asctype:Common.Utils.documentSettingsType.Shape,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnTextArt=new Common.UI.Button({hint:this.txtTextArtSettings,asctype:Common.Utils.documentSettingsType.TextArt,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnTable=new Common.UI.Button({hint:this.txtTableSettings,asctype:Common.Utils.documentSettingsType.Table,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnPivot=new Common.UI.Button({hint:this.txtPivotSettings,asctype:Common.Utils.documentSettingsType.Pivot,enableToggle:!0,disabled:!0,visible:!1,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnCell=new Common.UI.Button({hint:this.txtCellSettings,asctype:Common.Utils.documentSettingsType.Cell,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnSlicer=new Common.UI.Button({hint:this.txtSlicerSettings,asctype:Common.Utils.documentSettingsType.Slicer,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings=[],this._settings[Common.Utils.documentSettingsType.Paragraph]={panel:"id-paragraph-settings",btn:this.btnText},this._settings[Common.Utils.documentSettingsType.Image]={panel:"id-image-settings",btn:this.btnImage},this._settings[Common.Utils.documentSettingsType.Shape]={panel:"id-shape-settings",btn:this.btnShape},this._settings[Common.Utils.documentSettingsType.Chart]={panel:"id-chart-settings",btn:this.btnChart},this._settings[Common.Utils.documentSettingsType.TextArt]={panel:"id-textart-settings",btn:this.btnTextArt},this._settings[Common.Utils.documentSettingsType.Table]={panel:"id-table-settings",btn:this.btnTable},this._settings[Common.Utils.documentSettingsType.Pivot]={panel:"id-pivot-settings",btn:this.btnPivot},this._settings[Common.Utils.documentSettingsType.Cell]={panel:"id-cell-settings",btn:this.btnCell},this._settings[Common.Utils.documentSettingsType.Slicer]={panel:"id-slicer-settings",btn:this.btnSlicer},this},render:function(t){var n=e(this.el);this.trigger("render:before",this),this.defaultHideRightMenu=t.customization&&!!t.customization.hideRightMenu;var o=!Common.localStorage.getBool("sse-hide-right-settings",this.defaultHideRightMenu);return n.css("width",(o?MENU_SCALE_PART:SCALE_MIN)+"px"),n.css("z-index",101),n.show(),n.html(this.template({})),this.btnText.setElement(e("#id-right-menu-text"),!1),this.btnText.render(),this.btnImage.setElement(e("#id-right-menu-image"),!1),this.btnImage.render(),this.btnChart.setElement(e("#id-right-menu-chart"),!1),this.btnChart.render(),this.btnShape.setElement(e("#id-right-menu-shape"),!1),this.btnShape.render(),this.btnTextArt.setElement(e("#id-right-menu-textart"),!1),this.btnTextArt.render(),this.btnTable.setElement(e("#id-right-menu-table"),!1),this.btnTable.render(),this.btnPivot.setElement(e("#id-right-menu-pivot"),!1),this.btnPivot.render(),this.btnCell.setElement(e("#id-right-menu-cell"),!1),this.btnCell.render(),this.btnSlicer.setElement(e("#id-right-menu-slicer"),!1),this.btnSlicer.render(),this.btnText.on("click",i.bind(this.onBtnMenuClick,this)),this.btnImage.on("click",i.bind(this.onBtnMenuClick,this)),this.btnChart.on("click",i.bind(this.onBtnMenuClick,this)),this.btnShape.on("click",i.bind(this.onBtnMenuClick,this)),this.btnTextArt.on("click",i.bind(this.onBtnMenuClick,this)),this.btnTable.on("click",i.bind(this.onBtnMenuClick,this)),this.btnPivot.on("click",i.bind(this.onBtnMenuClick,this)),this.btnCell.on("click",i.bind(this.onBtnMenuClick,this)),this.btnSlicer.on("click",i.bind(this.onBtnMenuClick,this)),this.paragraphSettings=new SSE.Views.ParagraphSettings,this.imageSettings=new SSE.Views.ImageSettings,this.chartSettings=new SSE.Views.ChartSettings,this.shapeSettings=new SSE.Views.ShapeSettings,this.textartSettings=new SSE.Views.TextArtSettings,this.tableSettings=new SSE.Views.TableSettings,this.pivotSettings=new SSE.Views.PivotSettings,this.cellSettings=new SSE.Views.CellSettings,this.slicerSettings=new SSE.Views.SlicerSettings,t&&t.isSignatureSupport&&(this.btnSignature=new Common.UI.Button({hint:this.txtSignatureSettings,asctype:Common.Utils.documentSettingsType.Signature,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings[Common.Utils.documentSettingsType.Signature]={panel:"id-signature-settings",btn:this.btnSignature},this.btnSignature.setElement(e("#id-right-menu-signature"),!1),this.btnSignature.render().setVisible(!0),this.btnSignature.on("click",i.bind(this.onBtnMenuClick,this)),this.signatureSettings=new SSE.Views.SignatureSettings),t&&t.canFeaturePivot&&this.btnPivot.setVisible(!0),i.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:e(this.el).find(".right-panel"),suppressScrollX:!0,useKeyboard:!1})),o&&(e("#id-cell-settings").parent().css("display","inline-block"),e("#id-cell-settings").addClass("active")),this.trigger("render:after",this),this},setApi:function(t){return this.api=t,this.paragraphSettings.setApi(t),this.imageSettings.setApi(t),this.chartSettings.setApi(t),this.shapeSettings.setApi(t),this.textartSettings.setApi(t),this.tableSettings.setApi(t),this.pivotSettings.setApi(t),this.cellSettings.setApi(t),this.slicerSettings.setApi(t),this.signatureSettings&&this.signatureSettings.setApi(t),this},setMode:function(t){return this.mode=t,this.imageSettings&&this.imageSettings.setMode(t),this.shapeSettings&&this.shapeSettings.setMode(t),this.tableSettings&&this.tableSettings.setMode(t),this},onBtnMenuClick:function(t,i){var n=e("#"+this._settings[t.options.asctype].panel),o=n.parent();t.pressed?(this.minimizedMode&&(e(this.el).width(MENU_SCALE_PART),o.css("display","inline-block"),this.minimizedMode=!1,Common.localStorage.setItem("sse-hide-right-settings",0)),o.find("> .active").removeClass("active"),n.addClass("active"),this.scroller&&this.scroller.scrollTop(0)):(o.css("display","none"),e(this.el).width(SCALE_MIN),this.minimizedMode=!0,Common.localStorage.setItem("sse-hide-right-settings",1)),this.fireEvent("rightmenuclick",[this,t.options.asctype,this.minimizedMode,i])},SetActivePane:function(t,i){if(!(this.minimizedMode&&!0!==i||void 0===this._settings[t]))if(this.minimizedMode)this._settings[t].btn.toggle(!0,!1),this._settings[t].btn.trigger("click",this._settings[t].btn);else{var n=e("#"+this._settings[t].panel);n.hasClass("active")||(n.parent().find("> .active").removeClass("active"),n.addClass("active"),this.scroller&&(this.scroller.update(),this.scroller.scrollTop(0))),this._settings[t].btn.isActive()||this._settings[t].btn.toggle(!0,!1)}},GetActivePane:function(){return this.minimizedMode?null:this.$el.find(".settings-panel.active")[0].id},clearSelection:function(){var t=e(".right-panel");t.find("> .active").removeClass("active"),this._settings.forEach((function(t){t.btn.isActive()&&t.btn.toggle(!1,!0)})),t.css("display","none"),e(this.el).width(SCALE_MIN),this.minimizedMode=!0,Common.NotificationCenter.trigger("layout:changed","rightmenu")},txtParagraphSettings:"Paragraph Settings",txtImageSettings:"Image Settings",txtShapeSettings:"Shape Settings",txtTextArtSettings:"Text Art Settings",txtChartSettings:"Chart Settings",txtSparklineSettings:"Sparkline Settings",txtTableSettings:"Table Settings",txtPivotSettings:"Pivot Table Settings",txtSignatureSettings:"Signature Settings",txtCellSettings:"Cell Settings",txtSlicerSettings:"Slicer Settings"},SSE.Views.RightMenu||{}))})),define("spreadsheeteditor/main/app/controller/RightMenu",["core","spreadsheeteditor/main/app/view/RightMenu"],(function(){"use strict";SSE.Controllers.RightMenu=Backbone.Controller.extend({models:[],collections:[],views:["RightMenu"],initialize:function(){this.editMode=!0,this._state={wsLock:!1,wsProps:[]},this.addListeners({Toolbar:{insertimage:this.onInsertImage.bind(this),insertshape:this.onInsertShape.bind(this),insertchart:this.onInsertChart.bind(this),inserttextart:this.onInsertTextArt.bind(this),inserttable:this.onInsertTable.bind(this)},RightMenu:{rightmenuclick:this.onRightMenuClick},PivotTable:{insertpivot:this.onInsertPivot}}),Common.Utils.InternalSettings.set("sse-rightpanel-active-table",1),Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",1),Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",1)},onLaunch:function(){this.rightmenu=this.createView("RightMenu"),this.rightmenu.on("render:after",_.bind(this.onRightMenuAfterRender,this))},onRightMenuAfterRender:function(t){t.imageSettings.application=t.shapeSettings.application=t.textartSettings.application=this.getApplication(),this._settings=[],this._settings[Common.Utils.documentSettingsType.Paragraph]={panelId:"id-paragraph-settings",panel:t.paragraphSettings,btn:t.btnText,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Image]={panelId:"id-image-settings",panel:t.imageSettings,btn:t.btnImage,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Shape]={panelId:"id-shape-settings",panel:t.shapeSettings,btn:t.btnShape,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.TextArt]={panelId:"id-textart-settings",panel:t.textartSettings,btn:t.btnTextArt,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Chart]={panelId:"id-chart-settings",panel:t.chartSettings,btn:t.btnChart,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Table]={panelId:"id-table-settings",panel:t.tableSettings,btn:t.btnTable,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Pivot]={panelId:"id-pivot-settings",panel:t.pivotSettings,btn:t.btnPivot,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Signature]={panelId:"id-signature-settings",panel:t.signatureSettings,btn:t.btnSignature,hidden:1,props:{},locked:!1},this._settings[Common.Utils.documentSettingsType.Cell]={panelId:"id-cell-settings",panel:t.cellSettings,btn:t.btnCell,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Slicer]={panelId:"id-slicer-settings",panel:t.slicerSettings,btn:t.btnSlicer,hidden:1,locked:!1}},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onUpdateSignatures",_.bind(this.onApiUpdateSignatures,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this))},setMode:function(t){this.editMode=t.isEdit},onRightMenuClick:function(t,e,i,n){if(!i&&this.editMode){n&&(e==Common.Utils.documentSettingsType.Table?(Common.Utils.InternalSettings.set("sse-rightpanel-active-table",2),this._settings[Common.Utils.documentSettingsType.Chart].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",Math.min(Common.Utils.InternalSettings.get("sse-rightpanel-active-spark"),1))):e==Common.Utils.documentSettingsType.Pivot?Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",1):e!=Common.Utils.documentSettingsType.Chart||this._settings[Common.Utils.documentSettingsType.Cell].hidden?Common.Utils.documentSettingsType.Cell&&(this._settings[Common.Utils.documentSettingsType.Table].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-table",0),this._settings[Common.Utils.documentSettingsType.Pivot].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",0),this._settings[Common.Utils.documentSettingsType.Chart].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",0)):(Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",2),this._settings[Common.Utils.documentSettingsType.Table].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-table",Math.min(Common.Utils.InternalSettings.get("sse-rightpanel-active-table"),1))));var o=this._settings[e].panel,s=this._settings[e].props;s&&o&&o.ChangeSettings.call(o,e==Common.Utils.documentSettingsType.Signature?void 0:s,this._state.wsLock,this._state.wsProps)}Common.NotificationCenter.trigger("layout:changed","rightmenu")},onSelectionChanged:function(t){if(!this.rangeSelectionMode){var e=[],i=t.asc_getSelectionType(),n=t.asc_getFormatTableInfo(),o=t.asc_getSparklineInfo(),s=t,a=t.asc_getPivotTableInfo();i!=Asc.c_oAscSelectionType.RangeImage&&i!=Asc.c_oAscSelectionType.RangeShape&&i!=Asc.c_oAscSelectionType.RangeSlicer&&i!=Asc.c_oAscSelectionType.RangeChart&&i!=Asc.c_oAscSelectionType.RangeChartText&&i!=Asc.c_oAscSelectionType.RangeShapeText||(e=this.api.asc_getGraphicObjectProps()),!(e.length<=0)||s||n||o||a||this.rightmenu.minimizedMode||"id-signature-settings"===this.rightmenu.GetActivePane()||(this.rightmenu.clearSelection(),this._openRightMenu=!0),this.onFocusObject(e,s,n,o,a)}},onFocusObject:function(t,e,i,n,o,s){if(this.editMode||s){for(var a=e&&e.asc_getLocked()||this._state.wsProps.FormatCells,l=e&&!0===e.asc_getLockedTable()||!this.rightmenu.mode.canModifyFilter||this._state.wsProps.FormatCells,r=e&&!0===e.asc_getLockedSparkline()||this._state.wsLock,c=e&&!0===e.asc_getLockedPivotTable()||this._state.wsProps.PivotTables,d=0;d<this._settings.length;++d)d!=Common.Utils.documentSettingsType.Signature&&this._settings[d]&&(this._settings[d].hidden=1,this._settings[d].locked=!1);this._settings[Common.Utils.documentSettingsType.Signature].locked=!1;var h=!1;for(d=0;d<t.length;++d){var p=t[d].asc_getObjectType(),m=this.getDocumentSettingsType(p);if(!(void 0===m||m>=this._settings.length||void 0===this._settings[m])){var u=t[d].asc_getObjectValue();m==Common.Utils.documentSettingsType.Image?(h=h||u.asc_getProtectionLockText(),null!==u.asc_getChartProperties()?(m=Common.Utils.documentSettingsType.Chart,this._settings[m].btn.updateHint(this.rightmenu.txtChartSettings)):null!==u.asc_getShapeProperties()?(m=Common.Utils.documentSettingsType.Shape,u.asc_getShapeProperties().asc_getTextArtProperties()&&(this._settings[Common.Utils.documentSettingsType.TextArt].props=u,this._settings[Common.Utils.documentSettingsType.TextArt].hidden=0,this._settings[Common.Utils.documentSettingsType.TextArt].locked=u.asc_getLocked()||this._state.wsProps.Objects&&u.asc_getProtectionLockText())):null!==u.asc_getSlicerProperties()&&(m=Common.Utils.documentSettingsType.Slicer),this._settings[m].locked=u.asc_getLocked()||this._state.wsProps.Objects&&u.asc_getProtectionLocked()):this._settings[m].locked=u.asc_getLocked(),this._settings[m].props=u,this._settings[m].hidden=0,this._settings[Common.Utils.documentSettingsType.Signature].locked||(this._settings[Common.Utils.documentSettingsType.Signature].locked=u.asc_getLocked()),this._settings[Common.Utils.documentSettingsType.Paragraph].locked||(this._settings[Common.Utils.documentSettingsType.Paragraph].locked=this._state.wsProps.Objects&&h)}}i&&(m=Common.Utils.documentSettingsType.Table,this._settings[m].props=i,this._settings[m].locked=l,this._settings[m].hidden=0),n&&(m=Common.Utils.documentSettingsType.Chart,this._settings[m].props=n,this._settings[m].locked=r,this._settings[m].hidden=0,this._settings[m].btn.updateHint(this.rightmenu.txtSparklineSettings)),o&&this.rightmenu.mode.canFeaturePivot&&(m=Common.Utils.documentSettingsType.Pivot,this._settings[m].props=o,this._settings[m].locked=c,this._settings[m].hidden=0),t.length<=0&&e&&(m=Common.Utils.documentSettingsType.Cell,this._settings[m].props=e,this._settings[m].locked=a,this._settings[m].hidden=0);var g,f=-1,b=-1,C=this.rightmenu.GetActivePane();for(d=0;d<this._settings.length;++d){var v=this._settings[d];void 0!==v&&void 0!==v.btn&&void 0!==v.panel&&(v.hidden?(v.btn.isDisabled()||v.btn.setDisabled(!0),C==v.panelId&&(g=-1)):(v.btn.isDisabled()&&v.btn.setDisabled(!1),d!=Common.Utils.documentSettingsType.Signature&&(f=d),v.needShow?(v.needShow=!1,b=d):C==v.panelId&&(g=d),v.panel.setLocked(v.locked)))}if(!this.rightmenu.minimizedMode||this._openRightMenu){var _;if(b<0&&!this._settings[Common.Utils.documentSettingsType.Cell].hidden&&(!this._settings[Common.Utils.documentSettingsType.Table].hidden||!this._settings[Common.Utils.documentSettingsType.Pivot].hidden||!this._settings[Common.Utils.documentSettingsType.Chart].hidden)){var x=Common.Utils.InternalSettings.get("sse-rightpanel-active-table"),y=Common.Utils.InternalSettings.get("sse-rightpanel-active-pivot"),w=Common.Utils.InternalSettings.get("sse-rightpanel-active-spark");this._settings[Common.Utils.documentSettingsType.Table].hidden||this._settings[Common.Utils.documentSettingsType.Chart].hidden?this._settings[Common.Utils.documentSettingsType.Table].hidden?this._settings[Common.Utils.documentSettingsType.Chart].hidden||(b=0===w?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Chart):b=0===x?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Table:b=x==w?0===x?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Chart:x>w?Common.Utils.documentSettingsType.Table:Common.Utils.documentSettingsType.Chart,this._settings[Common.Utils.documentSettingsType.Pivot].hidden||(b=0===y?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Pivot)}b>-1?_=b:f>=0&&g<0?_=f:g>=0?_=g:s&&!this._settings[Common.Utils.documentSettingsType.Signature].hidden&&(_=Common.Utils.documentSettingsType.Signature),null==_&&this._openRightMenu&&f>=0&&(_=f),void 0!==_&&(this.rightmenu.SetActivePane(_,this._openRightMenu),_!=Common.Utils.documentSettingsType.Signature?this._settings[_].panel.ChangeSettings.call(this._settings[_].panel,this._settings[_].props,this._state.wsLock,this._state.wsProps):this._settings[_].panel.ChangeSettings.call(this._settings[_].panel),this._openRightMenu=!1)}this._settings[Common.Utils.documentSettingsType.Image].needShow=!1,this._settings[Common.Utils.documentSettingsType.Chart].needShow=!1,this._settings[Common.Utils.documentSettingsType.Table].needShow=!1,this._settings[Common.Utils.documentSettingsType.Pivot].needShow=!1}},onCoAuthoringDisconnect:function(){this.SetDisabled(!0),this.setMode({isEdit:!1})},onInsertImage:function(){this._settings[Common.Utils.documentSettingsType.Image].needShow=!0},onInsertChart:function(){this._settings[Common.Utils.documentSettingsType.Chart].needShow=!0},onInsertShape:function(){this._settings[Common.Utils.documentSettingsType.Shape].needShow=!0},onInsertTextArt:function(){this._settings[Common.Utils.documentSettingsType.TextArt].needShow=!0},onInsertTable:function(){},onInsertPivot:function(){},UpdateThemeColors:function(){this.rightmenu.shapeSettings.UpdateThemeColors(),this.rightmenu.textartSettings.UpdateThemeColors(),this.rightmenu.chartSettings.UpdateThemeColors(),this.rightmenu.cellSettings.UpdateThemeColors()},updateMetricUnit:function(){this.rightmenu.paragraphSettings.updateMetricUnit(),this.rightmenu.chartSettings.updateMetricUnit(),this.rightmenu.imageSettings.updateMetricUnit(),this.rightmenu.slicerSettings.updateMetricUnit()},createDelayedElements:function(){this.api&&(this._openRightMenu=!Common.localStorage.getBool("sse-hide-right-settings",this.rightmenu.defaultHideRightMenu),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_doubleClickOnObject",_.bind(this.onDoubleClickOnObject,this)),this.onChangeProtectSheet())},onDoubleClickOnObject:function(t){if(this.editMode){var e=t.asc_getObjectType(),i=this.getDocumentSettingsType(e);if(!(void 0===i||i>=this._settings.length||void 0===this._settings[i])){var n=t.asc_getObjectValue();i==Common.Utils.documentSettingsType.Image&&(null!==n.asc_getChartProperties()?i=Common.Utils.documentSettingsType.Chart:null!==n.asc_getShapeProperties()&&(i=Common.Utils.documentSettingsType.Shape)),i!==Common.Utils.documentSettingsType.Paragraph&&(this.rightmenu.SetActivePane(i,!0),this._settings[i].panel.ChangeSettings.call(this._settings[i].panel,this._settings[i].props,this._state.wsLock,this._state.wsProps))}}},getDocumentSettingsType:function(t){switch(t){case Asc.c_oAscTypeSelectElement.Paragraph:return Common.Utils.documentSettingsType.Paragraph;case Asc.c_oAscTypeSelectElement.Image:return Common.Utils.documentSettingsType.Image}},onApiUpdateSignatures:function(t,e){if(this.rightmenu.signatureSettings){var i=(!t||t.length<1)&&(!e||e.length<1),n=Common.Utils.documentSettingsType.Signature;this._settings[n].hidden=i?1:0,this._settings[n].btn.setDisabled(i),this._settings[n].panel.setLocked(this._settings[n].locked)}},SetDisabled:function(t,e){this.setMode({isEdit:!t}),this.rightmenu&&this.rightmenu.paragraphSettings&&(this.rightmenu.paragraphSettings.disableControls(t),this.rightmenu.shapeSettings.disableControls(t),this.rightmenu.imageSettings.disableControls(t),this.rightmenu.chartSettings.disableControls(t),this.rightmenu.tableSettings.disableControls(t),this.rightmenu.pivotSettings.disableControls(t),this.rightmenu.cellSettings.disableControls(t),this.rightmenu.slicerSettings.disableControls(t),this.rightmenu.signatureSettings&&(!e&&this.rightmenu.btnSignature.setDisabled(t),e&&t&&this.onFocusObject([],void 0,void 0,void 0,void 0,!0)),t?(this.rightmenu.btnText.setDisabled(t),this.rightmenu.btnTable.setDisabled(t),this.rightmenu.btnImage.setDisabled(t),this.rightmenu.btnShape.setDisabled(t),this.rightmenu.btnTextArt.setDisabled(t),this.rightmenu.btnChart.setDisabled(t),this.rightmenu.btnPivot.setDisabled(t),this.rightmenu.btnCell.setDisabled(t),this.rightmenu.btnSlicer.setDisabled(t)):this.onSelectionChanged(this.api.asc_getCellInfo()))},onCellsRange:function(t){this.rangeSelectionMode=t!=Asc.c_oAscSelectionDialogType.None},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&(this._state.wsProps=t.wsProps,this._state.wsLock=t.wsLock),this.onSelectionChanged(this.api.asc_getCellInfo())}})})),define("common/main/lib/view/SaveAsDlg",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],(function(){"use strict";Common.Views.SaveAsDlg=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:420,height:681,header:!0},t),this.template=['<div id="id-saveas-folder-placeholder"></div>'].join(""),e.tpl=_.template(this.template)(e),this.saveFolderUrl=t.saveFolderUrl||"",this.saveFileUrl=t.saveFileUrl||"",this.defFileName=t.defFileName||"",this.saveFolderUrl=this.saveFolderUrl.replace("{title}",encodeURIComponent(this.defFileName)).replace("{fileuri}",encodeURIComponent(this.saveFileUrl)),Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var t=document.createElement("iframe");t.width="100%",t.height=645,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=_.bind(this._onLoad,this),$("#id-saveas-folder-placeholder").append(t),this.loadMask=new Common.UI.LoadMask({owner:$("#id-saveas-folder-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),t.src=this.saveFolderUrl;var e=this;this._eventfunc=function(t){e._onWindowMessage(t)},this._bindWindowEvents.call(this),this.on("close",(function(t){e._unbindWindowEvents()}))},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){t&&"onlyoffice"==t.Referer&&(_.isEmpty(t.error)?_.isEmpty(t.message)||Common.NotificationCenter.trigger("showmessage",{msg:t.message}):this.trigger("saveaserror",this,t.error),Common.NotificationCenter.trigger("window:close",this))},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Folder for save",textLoading:"Loading"},Common.Views.SaveAsDlg||{}))})),define("text!spreadsheeteditor/main/app/template/LeftMenu.template",[],(function(){return'<div id="view-left-menu" class="tool-menu left">\r\n    <div class="tool-menu-btns">\r\n        <button id="left-btn-searchbar" class="btn btn-category" data-hint="0" data-hint-direction="right" data-hint-offset="big" content-target="left-panel-search"><i class="icon toolbar__icon btn-menu-search">&nbsp;</i></button>\r\n        \x3c!-- /** coauthoring begin **/ --\x3e\r\n        <button id="left-btn-comments" class="btn btn-category" content-target="left-panel-comments" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-comments">&nbsp;</i></button>\r\n        <button id="left-btn-chat" class="btn btn-category" content-target="left-panel-chat" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-chat">&nbsp;</i></button>\r\n        \x3c!-- /** coauthoring end **/ --\x3e\r\n        <button id="left-btn-plugins" class="btn btn-category" content-target="" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-plugin">&nbsp;</i></button>\r\n        <button id="left-btn-spellcheck" class="btn btn-category" content-target="left-panel-spellcheck" data-hint="0" data-hint-direction="right" data-hint-offset="big" data-layout-name="leftMenu-spellcheck"><i class="icon toolbar__icon btn-ic-docspell">&nbsp;</i></button>\r\n        <button id="left-btn-support" class="btn btn-category" content-target="" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-support">&nbsp;</i></button>\r\n        <button id="left-btn-about" class="btn btn-category" content-target="" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-about">&nbsp;</i></button>\r\n    </div>\r\n    <div class="left-panel" style="">\r\n        <div id="left-panel-search" class="" style="display: none;"></div>\r\n        \x3c!-- /** coauthoring begin **/ --\x3e\r\n        <div id="left-panel-comments" class="" style="display: none;"></div>\r\n        <div id="left-panel-chat" class="" style="display: none;"></div>\r\n        <div id="left-panel-spellcheck" class="" style="display: none; height: 100%;"></div>\r\n        \x3c!-- /** coauthoring end **/ --\x3e\r\n        <div id="left-panel-plugins" class="" style="display: none; height: 100%; position: relative;"></div>\r\n    </div>\r\n</div>'})),define("common/main/lib/view/About",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],(function(){"use strict";Common.Views.About=Common.UI.BaseView.extend(_.extend({menu:void 0,rendered:!1,options:{alias:"Common.Views.About"},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.txtVersionNum="7.2.1.34",!/\s$/.test(this.txtAddress)&&(this.txtAddress+=" "),!/\s$/.test(this.txtMail)&&(this.txtMail+=" "),!/\s$/.test(this.txtTel)&&(this.txtTel+=" "),this.template=_.template(['<table id="id-about-licensor-logo" cols="1" style="width: 100%; margin-top: 20px;">',"<tr>",'<td align="center"><div class="asc-about-office"></div></td>',"</tr>","<tr>",'<td align="center"><label class="asc-about-version">'+t.appName.toUpperCase()+"</label></td>","</tr>","<tr>",'<td align="center"><label class="asc-about-version" id="id-about-licensor-version-name">'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","</table>",'<table id="id-about-licensor-info" cols="3" style="width: 100%;" class="margin-bottom">',"<tr>",'<td colspan="3" align="center" style="padding: 20px 0 10px 0;"><label class="asc-about-companyname"><%= publishername %></label></td>',"</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtAddress+"</label>",'<label class="asc-about-desc"><%= publisheraddr %></label>',"</td>","</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtMail+"</label>",'<a href="mailto:<%= supportemail %>"><%= supportemail %></a>',"</td>","</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtTel+"</label>",'<label class="asc-about-desc"><%= phonenum %></label>',"</td>","</tr>","<tr>",'<td colspan="3" align="center">','<a href="<%= publisherurl %>" target="_blank"><% print(publisherurl.replace(/https?:\\/{2}/, "").replace(/\\/$/,"")) %></a>',"</td>","</tr>","</table>",'<table id="id-about-licensee-info" cols="1" style="width: 100%; margin-top: 20px;" class="hidden margin-bottom"><tbody>',"<tr>",'<td align="center" class="padding-small"><div id="id-about-company-logo"></div></td>',"</tr>","<tr>",'<td align="center"><label class="asc-about-version">'+t.appName.toUpperCase()+"</label></td>","</tr>","<tr>",'<td align="center"><label style="padding-bottom: 29px;" class="asc-about-version" id="id-about-licensee-version-name">'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-companyname" id="id-about-company-name"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtAddress+"</label>",'<label class="asc-about-desc" id="id-about-company-address"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtMail+"</label>",'<a href="mailto:" id="id-about-company-mail"></a>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtTel+"</label>",'<label class="asc-about-desc" id="id-about-company-tel"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<a href="" target="_blank" id="id-about-company-url"></a>',"</td>","</tr>","<tr>",'<td align="center">','<label class="asc-about-lic" id="id-about-company-lic"></label>',"</td>","</tr>","</table>",'<table id="id-about-licensor-short" cols="1" style="width: 100%; margin-top: 31px;" class="hidden"><tbody>',"<tr>",'<td style="width:50%;"><div class="separator horizontal short left"></div></td>','<td align="center"><label class="asc-about-header">'+this.txtPoweredBy+"</label></td>",'<td style="width:50%;"><div class="separator horizontal short"></div></td>',"</tr>","<tr>",'<td colspan="3" align="center" style="padding: 9px 0 10px;"><label class="asc-about-companyname"><%= publishername %></label></td>',"</tr>","<tr>",'<td colspan="3" align="center">','<a href="<%= publisherurl %>" target="_blank"><% print(publisherurl.replace(/https?:\\/{2}/, "").replace(/\\/$/,"")) %></a>',"</td>","</tr>","</table>"].join("")),this.menu=t.menu},render:function(){if(!this.rendered){this.rendered=!0;var t=$(this.template({publishername:"Ascensio System SIA",publisheraddr:"20A-12 Ernesta Birznieka-Upisha street, Riga, Latvia, EU, LV-1050",publisherurl:"https://www.onlyoffice.com",supportemail:"support@onlyoffice.com",phonenum:"+371 633-99867",scope:this}));this.cntLicenseeInfo=t.findById("#id-about-licensee-info"),this.cntLicensorInfo=t.findById("#id-about-licensor-info"),this.divCompanyLogo=t.findById("#id-about-company-logo"),this.lblCompanyName=t.findById("#id-about-company-name"),this.lblCompanyAddress=t.findById("#id-about-company-address"),this.lblCompanyMail=t.findById("#id-about-company-mail"),this.lblCompanyUrl=t.findById("#id-about-company-url"),this.lblCompanyLic=t.findById("#id-about-company-lic"),this.lblCompanyTel=t.findById("#id-about-company-tel"),this.$el.html(t),this.$el.addClass("about-dlg"),this.licData&&this.setLicInfo(this.licData),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0}))}return this},setLicInfo:function(t){if(this.rendered)if(t&&"object"==typeof t&&t.customer&&"object"==typeof t.customer){this.licData=t;var e=t.customer;$("#id-about-licensor-logo").addClass("hidden"),$("#id-about-licensor-short").removeClass("hidden"),this.cntLicensorInfo.addClass("hidden"),this.cntLicenseeInfo.removeClass("hidden"),this.cntLicensorInfo.removeClass("margin-bottom");var i=e.name;if(i&&i.length?this.lblCompanyName.text(i):this.lblCompanyName.parents("tr").addClass("hidden"),(i=e.address)&&i.length?this.lblCompanyAddress.text(i):this.lblCompanyAddress.parents("tr").addClass("hidden"),(i=e.mail)&&i.length?this.lblCompanyMail.attr("href","mailto:"+i).text(i):this.lblCompanyMail.parents("tr").addClass("hidden"),(i=e.phone)&&i.length?this.lblCompanyTel.text(i):this.lblCompanyTel.parents("tr").addClass("hidden"),(i=e.www)&&i.length){var n=/^https?:\/{2}/i.test(i)?"":"http://";this.lblCompanyUrl.attr("href",n+i).text(i)}else this.lblCompanyUrl.parents("tr").addClass("hidden");(i=e.info)&&i.length?this.lblCompanyLic.text(i):this.lblCompanyLic.parents("tr").addClass("hidden"),(i=Common.UI.Themes.isDarkTheme()?e.logoDark||e.logo:e.logo||e.logoDark)&&i.length?this.divCompanyLogo.html('<img src="'+i+'" style="max-width:216px; max-height: 35px;" />'):this.divCompanyLogo.parents("tr").addClass("hidden"),i&&i.length&&Common.NotificationCenter.on("uitheme:changed",this.changeLogo.bind(this))}else this.cntLicenseeInfo.addClass("hidden"),this.cntLicensorInfo.addClass("margin-bottom");else this.licData=t||!0},changeLogo:function(){if(this.licData){var t=this.licData.customer;t.logo&&t.logoDark&&t.logo!==t.logoDark&&this.divCompanyLogo.find("img").attr("src",Common.UI.Themes.isDarkTheme()?t.logoDark||t.logo:t.logo||t.logoDark)}},show:function(){this.rendered||this.render(),Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},setMode:function(t){t.isLightVersion&&($("#id-about-licensor-version-name").text(this.txtEdition+this.txtVersion+this.txtVersionNum),$("#id-about-licensee-version-name").text(this.txtEdition+this.txtVersion+this.txtVersionNum))},txtPoweredBy:"Powered by",txtVersion:"Version ",txtLicensor:"LICENSOR",txtLicensee:"LICENSEE",txtAddress:"address: ",txtMail:"email: ",txtTel:"tel.: ",txtEdition:"Integration Edition "},Common.Views.About||{}))})),define("text!common/main/lib/template/Comments.template",[],(function(){return'<% if (!hide && !filtered) { %>\r\n    <div id="<%= id %>" class="user-comment-item">\r\n\r\n        \x3c!-- comment block --\x3e\r\n\r\n        <div class="user-name">\r\n            <div class="color" style="display: inline-block; background-color: <% if (usercolor!==null) { %><%=usercolor%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getEncodedName(parsedName) %>\r\n        </div>\r\n        <div class="user-date"><%=date%></div>\r\n        <% if (quote!==null && quote!==\'\') { %>\r\n        <div class="user-quote"><%=scope.getFixedQuote(quote)%></div>\r\n        <% } %>\r\n        <% if (!editText || scope.viewmode) { %>\r\n            <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(comment)%></div>\r\n        <% } else { %>\r\n            <div class="inner-edit-ct">\r\n                <textarea class="msg-reply user-select textarea-control" maxlength="maxCommLength"><%=comment%></textarea>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change">textEdit</button>\r\n                <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\r\n            </div>\r\n        <% } %>\r\n\r\n        \x3c!-- replys elements --\x3e\r\n\r\n        <% var add_arrow = true; %>\r\n        <% if (replys.length) { %>\r\n            <% _.each(replys, function (item, index) { %>\r\n                <% if (!item.get("hide")) { %>\r\n                <% if (add_arrow) { add_arrow = false; %>\r\n                    <div class="reply-arrow img-commonctrl"></div>\r\n                <% } %>\r\n                <div class="reply-item-ct" <% if (scope.viewmode && index==replys.length-1) { %>style="padding-bottom: 0;" <% } %>;>\r\n                    <div class="user-name">\r\n                        <div class="color" style="display: inline-block; background-color: <% if (item.get("usercolor")!==null) { %><%=item.get("usercolor")%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getEncodedName(item.get("parsedName")) %>\r\n                    </div>\r\n                    <div class="user-date"><%=item.get("date")%></div>\r\n                    <% if (!item.get("editText")) { %>\r\n                        <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(item.get("reply"))%></div>\r\n                        <% if (!scope.viewmode) { %>\r\n                            <div class="btns-reply-ct">\r\n                            <% if (item.get("editable")) { %>\r\n                                <div class="btn-edit img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <% } %>\r\n                            <% if (item.get("removable")) { %>\r\n                                <div class="btn-delete img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <% } %>\r\n                            </div>\r\n                        <%}%>\r\n                    <% } else { %>\r\n                        <div class="inner-edit-ct">\r\n                            <textarea class="msg-reply textarea-fix user-select textarea-control" maxlength="maxCommLength"><%=item.get("reply")%></textarea>\r\n                            <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change">textEdit</button>\r\n                            <button class="btn normal dlg-btn btn-inner-close">textClose</button>\r\n                        </div>\r\n                    <% } %>\r\n                </div>\r\n                <% } %>\r\n            <% }); %>\r\n        <% } %>\r\n\r\n        \x3c!-- add reply button --\x3e\r\n\r\n        <% if (!showReply && !scope.viewmode) { %>\r\n            <% if (replys.length && !add_arrow) { %>\r\n                <label class="user-reply" style="margin-left: 20px; margin-top: 5px;" role="presentation" tabindex="-1">textAddReply</label>\r\n            <% } else { %>\r\n                <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n            <% } %>\r\n        <% } %>\r\n\r\n        \x3c!-- edit buttons --\x3e\r\n\r\n        <% if (!editText && !lock) { %>\r\n            <div class="edit-ct">\r\n                <% if (!scope.viewmode) { %>\r\n                    <% if (editable) { %>\r\n                        <div class="btn-edit img-commonctrl"></div>\r\n                    <% } %>\r\n                    <% if (removable) { %>\r\n                        <div class="btn-delete img-commonctrl"></div>\r\n                    <% } %>\r\n                <% } %>\r\n                <% if (editable && !scope.viewmode) { %>\r\n                    <div class="btn-resolve <% if (resolved) print(\'comment-resolved\') %>" data-toggle="tooltip"></div>\r\n                <% } else if ((!editable || scope.viewmode) && resolved) { %>\r\n                    <div class="icon-resolve i-comment-resolved" data-toggle="tooltip"></div>\r\n                <% } %>\r\n            </div>\r\n        <% } %>\r\n\r\n        \x3c!-- reply --\x3e\r\n\r\n        <% if (showReply) { %>\r\n            <div class="reply-ct">\r\n                <textarea class="msg-reply user-select textarea-control" placeholder="textAddReply" maxlength="maxCommLength"></textarea>\r\n                <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change">textReply</button>\r\n                <button class="btn normal dlg-btn btn-close">textClose</button>\r\n            </div>\r\n        <% } %>\r\n        <% if (lock) { %>\r\n            <div class="lock-area"></div>\r\n            <div class="lock-author"><%=lockuserid%></div>\r\n        <% } %>\r\n        <% if (!last) { %>\r\n            <div class="separator-cmt"></div>\r\n        <% } %>\r\n    </div>\r\n<% } %>\r\n'})),define("text!common/main/lib/template/CommentsPanel.template",[],(function(){return'<div id="comments-box" class="layout-ct vbox">\r\n    <div class="layout-item messages-ct"></div>\r\n    <div class="layout-item add-link-ct">\r\n        <label id="add-comment-doc" class="btn new" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%=textAddCommentToDoc%></label>\r\n    </div>\r\n    <div style="display: none;" class="layout-item new-comment-ct">\r\n        <div class="inner-ct">\r\n            <textarea id="comment-msg-new" class="user-select textarea-control" placeholder="<%=textEnterCommentHint%>" maxlength="<%=maxCommLength%>" data-hint="1" data-hint-direction="left-top"></textarea>\r\n        </div>\r\n        <button class="btn add normal dlg-btn primary" data-hint="1" data-hint-direction="bottom" data-hint-offset="big" style="width: auto;min-width: 86px;"><%=textAddComment%></button>\r\n        <button class="btn cancel normal dlg-btn" data-hint="1" data-hint-direction="bottom" data-hint-offset="big" style="width: auto;min-width: 86px;"><%=textCancel%></button>\r\n    </div>\r\n    <div id="comments-header" class="">\r\n        <label><%=textComments%></label>\r\n        <div id="comments-btn-close" style="float:right;margin-left: 4px;"></div>\r\n        <div id="comments-btn-sort" style="float:right;"></div>\r\n    </div>\r\n</div>\r\n'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Comments",["text!common/main/lib/template/Comments.template","text!common/main/lib/template/CommentsPanel.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t,e){"use strict";function i(t,e){var i,n,o=t;for(i in e)void 0!==i&&(n=e[i],o=o.replace(new RegExp(i,"g"),n));return o}var n=Common.UI.DataView.extend({options:{handleSelect:!1,scrollable:!0,listenStoreEvents:!1,template:_.template('<div class="dataview-ct inner"></div>')},getTextBox:function(){var t=$(this.el).find("textarea");return t&&t.length?t:void 0},setFocusToTextBox:function(){var t=$(this.el).find("textarea");if(t&&t.length){var e=t.val();t.focus(),t.val(""),t.val(e)}},getActiveTextBoxVal:function(){var t=$(this.el).find("textarea");return t&&t.length?t.val().trim():""},autoHeightTextBox:function(){var t=this,e=$(this.el).find("textarea"),i=null,n=0,o=0;function s(){i.scrollHeight>i.clientHeight?e.css({height:i.scrollHeight+n+"px"}):i.clientHeight>=55&&(e.css({height:"55px"}),i.scrollHeight>i.clientHeight&&(o=Math.max(i.scrollHeight+n,55),e.css({height:o+"px"}))),t.autoScrollToEditButtons()}e&&e.length&&(i=e.get(0))&&(n=.25*parseInt(e.css("lineHeight"),10),s(),e.bind("input propertychange",s)),this.textBox=e},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=void 0)},autoScrollToEditButtons:function(){var t=$("#id-comments-change"),e=null,i=this.el.getBoundingClientRect(),n=0;t.length&&(e=t.get(0).getBoundingClientRect())&&i&&(n=i.bottom-(e.bottom+7))<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-n)}});Common.Views.Comments=Common.UI.BaseView.extend(_.extend({el:"#left-panel-comments",template:_.template(e),addCommentHeight:45,newCommentHeight:110,textBoxAutoSizeLocked:void 0,viewmode:!1,_commentsViewOnItemClick:function(t,e,i,n){var o,s,a,l,r,c=this;function d(){c.update()}if(o=$(n.target))if(s=i.get("editText"),a=i.get("showReply"),l=i.get("uid"),r=o.attr("data-value"),o.hasClass("btn-edit"))_.isUndefined(r)?s||(c.fireEvent("comment:closeEditing"),i.set("editText",!0),t.autoHeightTextBox(),d(),t.setFocusToTextBox(),c.hookTextBox()):(c.fireEvent("comment:closeEditing",[l]),c.fireEvent("comment:editReply",[l,r]),c.commentsView.reply=r,t.autoHeightTextBox(),d(),c.hookTextBox(),t.autoScrollToEditButtons(),t.setFocusToTextBox());else if(o.hasClass("btn-delete"))_.isUndefined(r)?(c.fireEvent("comment:remove",[l]),Common.NotificationCenter.trigger("edit:complete",c)):c.fireEvent("comment:removeReply",[l,r]),c.fireEvent("comment:closeEditing"),d();else if(o.hasClass("user-reply"))c.fireEvent("comment:closeEditing"),i.set("showReply",!0),d(),t.autoHeightTextBox(),c.hookTextBox(),t.autoScrollToEditButtons(),t.setFocusToTextBox();else if(o.hasClass("btn-reply",!1))a&&(c.fireEvent("comment:addReply",[l,t.getActiveTextBoxVal()]),c.fireEvent("comment:closeEditing"),d());else if(o.hasClass("btn-close",!1))c.fireEvent("comment:closeEditing",[l]);else if(o.hasClass("btn-inner-edit",!1))_.isUndefined(c.commentsView.reply)?s&&c.fireEvent("comment:change",[l,t.getActiveTextBoxVal()]):(c.fireEvent("comment:changeReply",[l,c.commentsView.reply,t.getActiveTextBoxVal()]),c.commentsView.reply=void 0),c.fireEvent("comment:closeEditing"),d();else if(o.hasClass("btn-inner-close",!1))c.fireEvent("comment:closeEditing"),c.commentsView.reply=void 0,d();else if(o.hasClass("btn-resolve",!1)){var h=o.data("bs.tooltip");h&&(h.dontShow=!0),c.fireEvent("comment:resolve",[l]),d()}else if(!o.hasClass("msg-reply")&&!o.hasClass("btn-resolve")){var p=!1;if(o.hasClass("user-message"))if(window.getSelection)p=""!==window.getSelection().toString();else document.selection&&(p=document.selection);c.fireEvent("comment:show",[l,!1,p])}},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.store=this.options.store;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:""},render:function(){var e=this;if(this.rendered||(this.$el.html(this.template({textAddCommentToDoc:e.textAddCommentToDoc,textAddComment:e.textAddComment,textCancel:e.textCancel,textEnterCommentHint:e.textEnterCommentHint,maxCommLength:Asc.c_oAscMaxCellOrCommentLength,textComments:e.textComments})),this.buttonAddCommentToDoc=new Common.UI.Button({el:$(".btn.new",this.$el),enableToggle:!1}),this.buttonAdd=new Common.UI.Button({action:"add",el:$(".btn.add",this.$el),enableToggle:!1}),this.buttonCancel=new Common.UI.Button({el:$(".btn.cancel",this.$el),enableToggle:!1}),this.buttonSort=new Common.UI.Button({parentEl:$("#comments-btn-sort",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-sorting",hint:this.textSort,menu:new Common.UI.Menu({menuAlign:"tr-br",style:"min-width: auto;",items:[{caption:this.mniDateDesc,value:"date-desc",checkable:!0,checked:"date-desc"===(Common.localStorage.getItem(this.appPrefix+"comments-sort")||"date-desc"),toggleGroup:"sortcomments"},{caption:this.mniDateAsc,value:"date-asc",checkable:!0,checked:"date-asc"===(Common.localStorage.getItem(this.appPrefix+"comments-sort")||"date-desc"),toggleGroup:"sortcomments"},{caption:this.mniAuthorAsc,value:"author-asc",checkable:!0,checked:"author-asc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:this.mniAuthorDesc,value:"author-desc",checkable:!0,checked:"author-desc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:this.mniPositionAsc,value:"position-asc",checkable:!0,visible:"de-"===this.appPrefix,checked:"position-asc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:this.mniPositionDesc,value:"position-desc",checkable:!0,visible:"de-"===this.appPrefix,checked:"position-desc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:"--",visible:!1},this.menuFilterGroups=new Common.UI.MenuItem({caption:this.mniFilterGroups,checkable:!1,visible:!1,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})})]})}),this.buttonClose=new Common.UI.Button({parentEl:$("#comments-btn-close",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textClosePanel}),this.buttonAddCommentToDoc.on("click",_.bind(this.onClickShowBoxDocumentComment,this)),this.buttonAdd.on("click",_.bind(this.onClickAddDocumentComment,this)),this.buttonCancel.on("click",_.bind(this.onClickCancelDocumentComment,this)),this.buttonClose.on("click",_.bind(this.onClickClosePanel,this)),this.buttonSort.menu.on("item:toggle",_.bind(this.onSortClick,this)),this.menuFilterGroups.menu.on("item:toggle",_.bind(this.onFilterGroupsClick,this)),this.txtComment=$("#comment-msg-new",this.el),this.txtComment.keydown((function(t){if(!t.ctrlKey&&!t.metaKey||t.altKey||t.keyCode!=Common.UI.Keys.RETURN){if(t.keyCode===Common.UI.Keys.TAB){var i,n,o;o=this.selectionStart,n=this.selectionEnd,(i=$(this)).val(i.val().substring(0,o)+"\t"+i.val().substring(n)),this.selectionStart=this.selectionEnd=o+1,t.stopImmediatePropagation(),t.preventDefault()}}else e.onClickAddDocumentComment(),t.stopImmediatePropagation()}))),this.commentsView)this.commentsView.onResetItems();else{this.commentsView=new n({el:$(".messages-ct",e.el),store:e.store,itemTemplate:_.template(i(t,{textAddReply:e.textAddReply,textAdd:e.textAdd,textCancel:e.textCancel,textEdit:e.textEdit,textReply:e.textReply,textClose:e.textClose,maxCommLength:Asc.c_oAscMaxCellOrCommentLength})),emptyText:e.txtEmpty});var o=function(t,i,n){i.tipsArray&&i.tipsArray.forEach((function(t){t.remove()}));var o=[],s=$(i.el).find(".btn-resolve:not(.comment-resolved)");s.tooltip({title:e.textResolve,placement:"cursor"}),s.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(s=$(i.el).find(".comment-resolved")).tooltip({title:e.textOpenAgain,placement:"cursor"}),s.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(s=$(i.el).find(".i-comment-resolved")).tooltip({title:e.textViewResolved,placement:"cursor"}),s.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),i.tipsArray=o};this.commentsView.on({"item:add":o,"item:remove":o,"item:change":o,"item:click":this._commentsViewOnItemClick.bind(this)})}return this.rendered||this.setupLayout(),this.update(),this.rendered=!0,this},update:function(){this.updateLayout(),this.updateScrolls()},updateScrolls:function(){this.commentsView&&this.commentsView.scroller&&this.commentsView.scroller.update({minScrollbarLength:this.commentsView.minScrollbarLength,alwaysVisibleY:!0})},showEditContainer:function(t){var e=$(".add-link-ct",this.el),i=$(".new-comment-ct",this.el);$(".messages-ct",this.el),$("#comments-box",this.el);this.layout.freezePanels(!t),t?(e.css({display:"none"}),i.css({display:"table-row"}),this.txtComment.val(""),this.txtComment.focus(),this.textBoxAutoSizeLocked=void 0):(e.css({display:"table-row"}),i.css({display:"none"})),this.updateLayout(),this.updateScrolls()},onClickShowBoxDocumentComment:function(){this.fireEvent("comment:closeEditing"),this.showEditContainer(!0)},onClickAddDocumentComment:function(){this.fireEvent("comment:add",[this,this.txtComment.val().trim(),void 0,!1,!0]),this.txtComment.val("")},onClickCancelDocumentComment:function(){this.showEditContainer(!1)},saveText:function(t){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textVal=void 0,t?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},loadText:function(){if(this.textVal&&this.commentsView){var t=this.commentsView.getTextBox();t&&t.val(this.textVal)}},hookTextBox:function(){var t=this.commentsView.getTextBox();t&&t.keydown((function(t){if(!t.ctrlKey&&!t.metaKey||t.altKey||t.keyCode!=Common.UI.Keys.RETURN){if(t.keyCode===Common.UI.Keys.TAB){var e,i,n;n=this.selectionStart,i=this.selectionEnd,(e=$(this)).val(e.val().substring(0,n)+"\t"+e.val().substring(i)),this.selectionStart=this.selectionEnd=n+1,t.stopImmediatePropagation(),t.preventDefault()}}else{var o=$("#id-comments-change");o&&o.length&&o.click(),t.stopImmediatePropagation()}}))},setupLayout:function(){var t=this,e=t.$el,i=$(".new-comment-ct",t.el),n=($(".add-link-ct",t.el),$("#comments-box",t.el)),o=n.find(" > .layout-item");t.layout=new Common.UI.VBoxLayout({box:n,freeze:!0,items:[{el:o[0],rely:!0,resize:{hidden:!1,autohide:!1,fmin:function(){var e=n.height();return"none"!==i.css("display")&&.5*e<t.newCommentHeight?e-t.newCommentHeight:.5*e},fmax:function(){return"none"!==i.css("display")?n.height()-t.newCommentHeight:n.height()-t.addCommentHeight}}},{el:o[1],stretch:!0},{el:o[2],stretch:!0}]}),t.layout.on("layout:resizedrag",(function(){t.updateScrolls(),t.textBoxAutoSizeLocked=!0}),this),$(window).on("resize",(function(){if("none"!==e.css("display")){var i=$("#comments-box",t.el).height(),n=$(".new-comment-ct",t.el),o=$(".add-link-ct",t.el);"none"!==n.css("display")?t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,Math.min(i-(n.height()+4),i-t.newCommentHeight))):t.layout.setResizeValue(0,Math.max(-t.addCommentHeight,Math.min(i-o.height(),i-t.addCommentHeight))),t.updateScrolls()}})),this.autoHeightTextBox()},changeLayout:function(t){var e=this,i=$(".new-comment-ct",this.el),n=$(".add-link-ct",this.el),o=$(".messages-ct",this.el);if(o.toggleClass("stretch",!t.canComments||t.compatibleFeatures),!t.canComments||t.compatibleFeatures)t.compatibleFeatures?(i.remove(),n.remove()):(i.hide(),n.hide()),this.layout.changeLayout([{el:o[0],rely:!1,stretch:!0}]);else{var s=$("#comments-box",this.el),a=s.find(" > .layout-item");n.show(),this.layout.changeLayout([{el:a[0],rely:!0,resize:{hidden:!1,autohide:!1,fmin:function(){var t=s.height();return"none"!==i.css("display")&&.5*t<e.newCommentHeight?t-e.newCommentHeight:.5*t},fmax:function(){return"none"!==i.css("display")?s.height()-e.newCommentHeight:s.height()-e.addCommentHeight}}},{el:a[1],stretch:!0},{el:a[2],stretch:!0}])}},updateLayout:function(){var t=$("#comments-box",this.el);"none"!==$(".new-comment-ct",this.el).css("display")?this.layout.setResizeValue(0,t.height()-this.newCommentHeight):this.layout.setResizeValue(0,t.height()-this.addCommentHeight)},autoHeightTextBox:function(){var t=this,e=0,i=$("#comment-msg-new",this.el);function n(){var i,n,o;if(i=$("#comment-msg-new",t.el),o=$("#comments-box",t.el).height(),0==i.val().length)return t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,o-t.newCommentHeight)),void(t.textBoxAutoSizeLocked=void 0);_.isUndefined(t.textBoxAutoSizeLocked)&&(i.height(),i.get(0).scrollHeight,i.css({height:"44px"}),i.height(),n=Math.max(i.get(0).scrollHeight+e,48),i.css({height:"100%"}),o=$("#comments-box",t.el).height(),t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,Math.min(o-n-48,o-t.newCommentHeight))))}i.length<1||(e=.25*parseInt(i.css("lineHeight"),10),n(),i.bind("input propertychange",n),this.textBox=i)},getFixedQuote:function(t){return Common.Utils.String.ellipsis(Common.Utils.String.htmlEncode(t),120,!0)},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},getEncodedName:function(t){return Common.Utils.String.htmlEncode(t)},pickLink:function(t){var e,i,n=[];t.replace(Common.Utils.ipStrongRe,(function(t){var i=/[\.,\?\+;:=!\(\)]+$/.exec(t);return i&&(t=t.substring(0,i.index)),e=arguments[arguments.length-2],n.push({start:e,end:t.length+e,str:'<a href="'+t+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),(t.length<1e3||t.search(/\S{255,}/)<0)&&t.replace(Common.Utils.hostnameStrongRe,(function(t){var o=/[\.,\?\+;:=!\(\)]+$/.exec(t);o&&(t=t.substring(0,o.index));var s=/(((^https?)|(^ftp)):\/\/)/i.test(t)?t:"http://"+t;e=arguments[arguments.length-2],i=t.length;var a=_.find(n,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}));return a||n.push({start:e,end:i+e,str:'<a href="'+s+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),t.replace(Common.Utils.emailStrongRe,(function(t){var o=/((^mailto:)\/\/)/i.test(t)?t:"mailto:"+t;e=arguments[arguments.length-2],i=t.length;var s=_.find(n,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}));return s||n.push({start:e,end:i+e,str:'<a href="'+o+'">'+t+"</a>"}),""}));for(var o=(n=_.sortBy(n,(function(t){return t.start}))).length>0?Common.Utils.String.htmlEncode(t.substring(0,n[0].start))+n[0].str:Common.Utils.String.htmlEncode(t),s=1;s<n.length;s++)o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,n[s].start))+n[s].str;return n.length>0&&(o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,t.length))),o},pickEMail:function(t,e){var i=Common.Utils.String.htmlEncode(e).match(/\B[@+][A-Z0-9._%+-]+@[A-Z0-9._-]+\.[A-Z]+\b/gi);(i=_.map(i,(function(t){return t.slice(1,t.length)}))).length>0&&Common.Gateway.requestSendNotify({emails:i,actionId:t,actionLink:{action:{type:"comment",data:t}},message:e})},onSortClick:function(t,e,i){i&&this.fireEvent("comment:sort",[e.value])},onFilterGroupsClick:function(t,e,i){i&&this.fireEvent("comment:filtergroups",[e.value])},onClickClosePanel:function(){Common.NotificationCenter.trigger("leftmenu:change","hide")},textComments:"Comments",textAnonym:"Guest",textAddCommentToDoc:"Add Comment to Document",textAddComment:"Add Comment",textCancel:"Cancel",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close",textResolved:"Resolved",textResolve:"Resolve",textEnterCommentHint:"Enter your comment here",textEdit:"Edit",textAdd:"Add",textOpenAgain:"Open Again",textHintAddComment:"Add Comment",textSort:"Sort comments",mniPositionAsc:"From top",mniPositionDesc:"From bottom",mniAuthorAsc:"Author A to Z",mniAuthorDesc:"Author Z to A",mniDateDesc:"Newest",mniDateAsc:"Oldest",textClosePanel:"Close comments",textViewResolved:"You have not permission for reopen comment",mniFilterGroups:"Filter by Group",textAll:"All",txtEmpty:"There are no comments in the document."},Common.Views.Comments||{}))})),define("text!common/main/lib/template/Chat.template",[],(function(){return'<div id="chat-box" class="layout-ct vbox">\r\n    <div id="chat-users" class="layout-item area">\r\n        <div id="chat-user-ct"></div>\r\n    </div>\r\n    <div id="chat-messages" class="layout-item area">\r\n        <div id="chat-message-ct"></div>\r\n    </div>\r\n    <div id="chat-options" class="layout-item">\r\n        <div id="chat-options-ct">\r\n            <textarea id="chat-msg-text" class="user-select textarea-control" maxlength="<%=maxMsgLength%>" data-hint="1" data-hint-direction="left-top"></textarea>\r\n            <button id="chat-msg-btn-add" class="btn normal dlg-btn primary" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%=scope.textSend%></button>\r\n        </div>\r\n    </div>\r\n</div>'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Chat",["text!common/main/lib/template/Chat.template","common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t){"use strict";Common.Views.Chat=Common.UI.BaseView.extend(_.extend({el:"#left-panel-chat",template:_.template(t),storeUsers:void 0,storeMessages:void 0,tplUser:['<li id="<%= user.get("iid") %>"<% if (!user.get("online")) { %> class="offline"<% } %>>','<div class="name"><div class="color" style="background-color: <%= user.get("color") %>;" ></div><%= scope.getUserName(user.get("username")) %>',"</div>","</li>"].join(""),templateUserList:_.template("<ul><% for (originalId in users) { %><%= _.template(usertpl)({user: users[originalId][0], scope: scope}) %><% } %></ul>"),tplMsg:["<li>",'<% if (msg.get("type")==1) { %>','<div class="message service" data-can-copy="true"><%= msg.get("message") %></div>',"<% } else { %>",'<div class="user-name" data-can-copy="true">','<div class="color" style="display: inline-block; background-color: <% if (msg.get("usercolor")!==null) { %><%=msg.get("usercolor")%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(msg.get("username")) %>',"</div>",'<label class="message user-select" data-can-copy="true" tabindex="-1" oo_editor_input="true"><%= msg.get("message") %></label>',"<% } %>","</li>"].join(""),templateMsgList:_.template("<ul><% _.each(messages, function(item) { %><%= _.template(msgtpl)({msg: item, scope: scope}) %><% }); %></ul>"),events:{},usersBoxHeight:72,messageBoxHeight:70,addMessageBoxHeight:110,initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments),this.storeUsers.bind({add:_.bind(this._onResetUsers,this),change:_.bind(this._onResetUsers,this),reset:_.bind(this._onResetUsers,this)}),this.storeMessages.bind({add:_.bind(this._onAddMessage,this),reset:_.bind(this._onResetMessages,this)})},render:function(t){return t=t||this.el,$(t).html(this.template({scope:this,maxMsgLength:Asc.c_oAscMaxCellOrCommentLength})),this.panelBox=$("#chat-box",this.el),this.panelUsers=$("#chat-users",this.el),this.panelMessages=$("#chat-messages",this.el),this.txtMessage=$("#chat-msg-text",this.el),this.panelOptions=$("#chat-options",this.el),this.panelUsers.scroller=new Common.UI.Scroller({el:$("#chat-users"),useKeyboard:!0,minScrollbarLength:25}),this.panelMessages.scroller=new Common.UI.Scroller({el:$("#chat-messages"),includePadding:!0,useKeyboard:!0,minScrollbarLength:40}),$("#chat-msg-btn-add",this.el).on("click",_.bind(this._onBtnAddMessage,this)),this.txtMessage.on("keydown",_.bind(this._onKeyDown,this)),this.setupLayout(),this.trigger("render:after",this),this},focus:function(){var t=this;_.defer((function(){t.txtMessage.focus()}),100),this.updateLayout(!0),this.setupAutoSizingTextBox()},_onKeyDown:function(t){t.keyCode==Common.UI.Keys.RETURN?!t.ctrlKey&&!t.metaKey||t.altKey||this._onBtnAddMessage(t):t.keyCode!=Common.UI.Keys.ESC||Common.UI.HintManager.isHintVisible()||this.hide()},_onResetUsers:function(t,e){this.panelUsers&&(this.panelUsers.html(this.templateUserList({users:this.storeUsers.chain().filter((function(t){return t.get("online")})).groupBy((function(t){return t.get("idOriginal")})).value(),usertpl:this.tplUser,scope:this})),this.panelUsers.scroller.update({minScrollbarLength:25,alwaysVisibleY:!0}))},_onAddMessage:function(t,e,i){if(this.panelMessages){var n=this.panelMessages.find("ul");n&&n.length&&(this._prepareMessage(t),n.append(_.template(this.tplMsg)({msg:t,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}),this.panelMessages.scroller.scrollTop(n.get(0).getBoundingClientRect().height))}},_onResetMessages:function(t,e){this.panelMessages&&(t.each((function(t){this._prepareMessage(t)}),this),this.panelMessages.html(this.templateMsgList({messages:t.models,msgtpl:this.tplMsg,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}))},_onBtnAddMessage:function(t){this.txtMessage&&(this.fireEvent("message:add",[this,this.txtMessage.val().trim()]),this.txtMessage.val(""),this.focus())},_prepareMessage:function(t){var e=this.storeUsers.findOriginalUser(t.get("userid"));t.set({usercolor:e?e.get("color"):null,message:this._pickLink(t.get("message"))},{silent:!0})},_pickLink:function(t){var e,i,n=[];t.replace(Common.Utils.ipStrongRe,(function(t){var i=/[\.,\?\+;:=!\(\)]+$/.exec(t);return i&&(t=t.substring(0,i.index)),e=arguments[arguments.length-2],n.push({start:e,end:t.length+e,str:'<a href="'+t+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),(t.length<1e3||t.search(/\S{255,}/)<0)&&t.replace(Common.Utils.hostnameStrongRe,(function(t){var o=/[\.,\?\+;:=!\(\)]+$/.exec(t);o&&(t=t.substring(0,o.index));var s=/(((^https?)|(^ftp)):\/\/)/i.test(t)?t:"http://"+t;e=arguments[arguments.length-2],i=t.length;var a=_.find(n,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}));return a||n.push({start:e,end:i+e,str:'<a href="'+s+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),t.replace(Common.Utils.emailStrongRe,(function(t){var o=/((^mailto:)\/\/)/i.test(t)?t:"mailto:"+t;e=arguments[arguments.length-2],i=t.length;var s=_.find(n,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}));return s||n.push({start:e,end:i+e,str:'<a href="'+o+'">'+t+"</a>"}),""}));for(var o=(n=_.sortBy(n,(function(t){return t.start}))).length>0?Common.Utils.String.htmlEncode(t.substring(0,n[0].start))+n[0].str:Common.Utils.String.htmlEncode(t),s=1;s<n.length;s++)o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,n[s].start))+n[s].str;return n.length>0&&(o+=Common.Utils.String.htmlEncode(t.substring(n[s-1].end,t.length))),o},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this),this.textBoxAutoSizeLocked=void 0},setupLayout:function(){var t=this,e=$(t.el),i=this.panelBox.find(" > .layout-item");t.layout=new Common.UI.VBoxLayout({box:this.panelBox,items:[{el:i[0],rely:!0,behaviour:"splitter",resize:{hidden:!1,autohide:!1,fmin:function(){return t.usersBoxHeight},fmax:function(){return.5*t.panelBox.height()-t.messageBoxHeight}}},{el:i[1],rely:!0,behaviour:"splitter",resize:{hidden:!1,autohide:!1,fmin:function(){return Math.max(t.messageBoxHeight+t.usersBoxHeight,.5*t.panelBox.height())},fmax:function(){return t.panelBox.height()-t.addMessageBoxHeight}}},{el:i[2],stretch:!0}]}),t.layout.on("layout:resizedrag",(function(e){t.updateScrolls(),t.usersCachedHeigt=t.panelUsers.height()+8+1,e.index||(t.textBoxAutoSizeLocked=!0)}),this),$(window).on("resize",(function(){"none"!==e.css("display")&&t.updateLayout()})),this.updateLayout();var n=this.panelBox.height();this.layout.setResizeValue(0,this.usersBoxHeight),this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,Math.max(.5*n,n-t.panelOptions.height()-4))),this.setupAutoSizingTextBox(),this.txtMessage.bind("input propertychange",_.bind(this.updateHeightTextBox,this))},updateLayout:function(t){var e=this,i=this.panelBox.height();if(e.layout.setResizeValue(1,Math.max(e.addMessageBoxHeight,Math.max(.5*i,i-e.panelOptions.height()-4))),t){this.panelUsers.css("height");this.panelUsers.css("height","1px");var n=this.panelUsers.get(0).scrollHeight;e.layout.setResizeValue(0,Math.max(e.usersBoxHeight,Math.min(n+2,Math.floor(.5*i)-e.messageBoxHeight)))}else e.layout.setResizeValue(0,Math.max(e.usersBoxHeight,Math.min(e.usersCachedHeigt+2,Math.floor(.5*i)-e.messageBoxHeight)));e.updateScrolls(),e.updateHeightTextBox(null)},setupAutoSizingTextBox:function(){this.lineHeight=0,this.minHeight=44,this.lineHeight=1.25*parseInt(this.txtMessage.css("lineHeight"),10),this.updateHeightTextBox(!0)},updateHeightTextBox:function(t){var e,i,n=this.txtMessage;if(i=this.panelBox.height(),t&&0==n.val().length)return this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,i-this.addMessageBoxHeight)),this.textBoxAutoSizeLocked=void 0,void this.updateScrolls();_.isUndefined(this.textBoxAutoSizeLocked)&&(n.height(),n.get(0).scrollHeight,n.css({height:this.minHeight+"px"}),n.height(),e=Math.max(n.get(0).scrollHeight+this.lineHeight,1),n.css({height:"100%"}),i=this.panelBox.height(),this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,Math.min(i-e-40,i-this.addMessageBoxHeight)))&&this.updateScrolls())},updateScrolls:function(){this.panelUsers&&this.panelUsers.scroller&&this.panelMessages&&this.panelMessages.scroller&&(this.panelUsers.scroller.update({minScrollbarLength:25,alwaysVisibleY:!0}),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}))},textSend:"Send"},Common.Views.Chat||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/History",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t){"use strict";Common.Views.History=Common.UI.BaseView.extend(_.extend({el:"#left-panel-history",storeHistory:void 0,template:_.template(['<div id="history-box" class="layout-ct vbox">','<div id="history-header" class="">','<div id="history-btn-back"><%=scope.textCloseHistory%></div>',"</div>",'<div id="history-list" class="">',"</div>",'<div id="history-expand-changes" class="">','<div id="history-btn-expand"><%=scope.textHideAll%></div>',"</div>","</div>"].join("")),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments);var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:""},render:function(t){t=t||this.el,$(t).html(this.template({scope:this})).width((parseInt(Common.localStorage.getItem(this.appPrefix+"mainmenu-width"))||MENU_SCALE_PART)-SCALE_MIN),this.viewHistoryList=new Common.UI.DataView({el:$("#history-list"),store:this.storeHistory,enableKeyEvents:!1,itemTemplate:_.template(['<div id="<%= id %>" class="history-item-wrap <% if (!isVisible) { %>hidden<% } %>" ','style="display: block; <% if (!isRevision) { %>padding-left: 40px;<% } %><% if (canRestore && selected) { %>padding-bottom: 6px;<% } %>">','<div class="user-date"><%= created %></div>',"<% if (markedAsVersion) { %>",'<div class="user-version">'+this.textVer+"<%=version%></div>","<% } %>","<% if (isRevision && hasChanges) { %>",'<div class="revision-expand  <% if (isExpanded) { %>up<% } %>"></div>',"<% } %>",'<div class="user-name">','<div class="color" style="display: inline-block; background-color:<%=usercolor%>;" >',"</div><%= Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(username)) %>","</div>","<% if (canRestore && selected) { %>",'<label class="revision-restore" role="presentation" tabindex="-1">'+this.textRestore+"</label>","<% } %>","</div>"].join(""))});var e=this;this.viewHistoryList.onClickItem=function(t,i,n){var o=$(n.target);if(o&&o.hasClass("revision-expand")){var s=!i.get("isExpanded");i.set("isExpanded",s);var a=e.storeHistory.findRevisions(i.get("revision"));if(a&&a.length>1)for(var l=1;l<a.length;l++)a[l].set("isVisible",s);this.scroller.update({minScrollbarLength:this.minScrollbarLength})}else Common.UI.DataView.prototype.onClickItem.call(this,t,i,n);e.btnExpand.cmpEl.text(e.storeHistory.hasCollapsed()?e.textShowAll:e.textHideAll)};var i=function(t,i,n){if(n.get("isRevision")){i.btnTip&&(i.btnTip.dontShow=!0,i.btnTip.tip().remove(),i.btnTip=null);var o=$(i.el).find(".revision-expand").tooltip({title:n.get("isExpanded")?e.textHide:e.textShow,placement:"cursor"});o.length>0&&(i.btnTip=o.data("bs.tooltip"))}};return this.viewHistoryList.on("item:add",i),this.viewHistoryList.on("item:change",i),this.btnBackToDocument=new Common.UI.Button({el:$("#history-btn-back"),enableToggle:!1}),this.btnExpand=new Common.UI.Button({el:$("#history-btn-expand"),enableToggle:!1}),this.trigger("render:after",this),this},textRestore:"Restore",textShow:"Expand",textHide:"Collapse",textCloseHistory:"Close History",textHideAll:"Hide detailed changes",textShowAll:"Show detailed changes",textVer:"ver."},Common.Views.History||{}))})),define("common/main/lib/view/SearchDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.UI.SearchDialog=Common.UI.Window.extend(_.extend({options:{width:550,title:"Search & Replace",modal:!1,cls:"search",toolclose:"hide",alias:"SearchDialog"},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">','<span class="btn-placeholder" id="search-placeholder-btn-options"></span>','<input type="text" id="sd-text-search" class="input-field form-control" maxlength="255" placeholder="'+this.textSearchStart+'" autocomplete="off">',"</div>",'<div class="input-row">','<input type="text" id="sd-text-replace" class="input-field form-control" maxlength="255" placeholder="'+this.textReplaceDef+'" autocomplete="off">',"</div>",'<div class="input-row">','<label class="link" id="search-label-replace" result="replaceshow">'+this.txtBtnReplace+"</label>","</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer right">','<button class="btn normal dlg-btn" result="replace">'+this.txtBtnReplace+"</button>",'<button class="btn normal dlg-btn" result="replaceall" style="margin-left: 6px;width: auto;min-width: 100px;">'+this.txtBtnReplaceAll+"</button>",'<button class="btn normal dlg-btn iconic" result="back"><span class="icon img-commonctrl back"></span></button>','<button class="btn normal dlg-btn iconic" result="next" style="margin-left: 6px;"><span class="icon img-commonctrl next"></span></button>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){return Common.UI.Window.prototype.render.call(this),this.miMatchCase=new Common.UI.MenuItem({caption:this.textMatchCase,checkable:!0}),this.miMatchWord=new Common.UI.MenuItem({caption:this.options.matchwordstr||this.textWholeWords,checkable:!0}),this.miHighlight=new Common.UI.MenuItem({caption:this.textHighlight,checkable:!0}),this.btnOptions=new Common.UI.Button({id:"search-btn-options",cls:"btn-toolbar",iconCls:"toolbar__icon btn-settings",menu:new Common.UI.Menu({items:[this.miMatchCase,this.miMatchWord,this.miHighlight]})}),this.options.extraoptions&&(this.btnOptions.menu.addItem({caption:"--"}),this.options.extraoptions.forEach((function(t){this.btnOptions.menu.addItem(t)}),this)),this.btnOptions.render(this.$window.find("#search-placeholder-btn-options")),this.options.matchcase||this.miMatchCase.hide(),this.options.matchword||this.miMatchWord.hide(),this.options.markresult?this.options.markresult.applied&&this.miHighlight.setChecked(!0,!0):this.miHighlight.hide(),"search"===this.options.mode&&$(this.$window.find(".input-row").get(2)).hide(),this.txtSearch=this.$window.find("#sd-text-search"),this.txtReplace=this.$window.find("#sd-text-replace"),this.lblReplace=this.$window.find("#search-label-replace"),this.miHighlight.on("toggle",_.bind(this.onHighlight,this)),this.$window.find(".btn[result=back]").on("click",_.bind(this.onBtnClick,this,"back")),this.$window.find(".btn[result=next]").on("click",_.bind(this.onBtnClick,this,"next")),this.$window.find(".btn[result=replace]").on("click",_.bind(this.onBtnClick,this,"replace")),this.$window.find(".btn[result=replaceall]").on("click",_.bind(this.onBtnClick,this,"replaceall")),this.$window.find("label[result=replaceshow]").on("click",_.bind(this.onShowReplace,this)),this.txtSearch.on("keydown",null,"search",_.bind(this.onKeyPress,this)),this.txtReplace.on("keydown",null,"replace",_.bind(this.onKeyPress,this)),this.on("animate:before",_.bind(this.onAnimateBefore,this)),this},show:function(t,e){Common.UI.Window.prototype.show.call(this),!this.mode&&!t&&(t="search"),t&&this.mode!=t&&this.setMode(t),e&&this.setSearchText(e),this.options.markresult&&this.miHighlight.checked&&this.fireEvent("search:highlight",[this,!0]),this.focus()},focus:function(t){var e="replace"===t?this.txtReplace:this.txtSearch;setTimeout((function(){e.focus(),e.select()}),10)},onAnimateBefore:function(){this.focus()},onKeyPress:function(t){this.isLocked()||(t.keyCode==Common.UI.Keys.RETURN?("search"==t.data?this.onBtnClick("next",t):"replace"==t.data&&"replace"==this.mode&&this.onBtnClick("replace",t),t.preventDefault(),t.stopPropagation()):t.keyCode==Common.UI.Keys.ESC&&$(".asc-loadmask").length<1&&(this.hide(),t.preventDefault(),t.stopPropagation()))},onBtnClick:function(t,e){if(!$(".asc-loadmask").length){var i={textsearch:this.txtSearch.val(),textreplace:this.txtReplace.val(),matchcase:this.miMatchCase.checked,matchword:this.miMatchWord.checked,highlight:this.miHighlight.checked};this.fireEvent("search:"+t,[this,i])}},setMode:function(t){this.mode=t;var e=this.$window.find(".input-row");"no-replace"===t?(this.setTitle(this.textTitle2),e.eq(1).hide(),e.eq(2).hide(),this.$window.find(".btn[result=replace]").hide(),this.$window.find(".btn[result=replaceall]").hide(),this.options.matchcase||this.options.matchword||this.options.markresult||(this.txtSearch.addClass("clear"),this.btnOptions.hide()),this.menuLookin&&this.menuLookin.menu.items[1].setDisabled(!1),this.setHeight(170)):(this.txtSearch.removeClass("clear"),this.setTitle(this.textTitle),"search"===t?(e.eq(2).show(),this.lblReplace.text(this.txtBtnReplace),e.eq(1).hide(),this.$window.find(".btn[result=replace]").hide(),this.$window.find(".btn[result=replaceall]").hide(),this.menuLookin&&this.menuLookin.menu.items[1].setDisabled(!1),this.setHeight(200)):(e.eq(2).show(),this.lblReplace.text(this.txtBtnHideReplace),e.eq(1).show(),this.$window.find(".btn[result=replace]").show(),this.$window.find(".btn[result=replaceall]").show(),this.menuLookin&&(this.menuLookin.menu.items[0].setChecked(!0),this.menuLookin.menu.items[1].setDisabled(!0)),this.setHeight(230)))},setSearchText:function(t){this.txtSearch&&this.txtSearch.val(t)},onShowReplace:function(t){this.setMode("replace"==this.mode?"search":"replace");var e=this;_.defer((function(){"replace"==e.mode?e.txtReplace.focus():e.txtSearch.focus()}),300)},onHighlight:function(t,e){this.fireEvent("search:highlight",[this,e])},getSettings:function(){return{textsearch:this.txtSearch.val(),matchcase:this.miMatchCase.checked,matchword:this.miMatchWord.checked}},textTitle:"Search & Replace",textTitle2:"Search",txtBtnReplace:"Replace",txtBtnReplaceAll:"Replace All",textMatchCase:"Case sensitive",textWholeWords:"Whole words only",textHighlight:"Highlight results",textReplaceDef:"Enter the replacement text",textSearchStart:"Enter text for search",txtBtnHideReplace:"Hide Replace"},Common.UI.SearchDialog||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Plugins",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t){"use strict";Common.Views.Plugins=Common.UI.BaseView.extend(_.extend({el:"#left-panel-plugins",storePlugins:void 0,template:_.template(['<div id="plugins-box" class="layout-ct vbox">','<label id="plugins-header"><%= scope.strPlugins %></label>','<div id="plugins-list" class="">',"</div>","</div>",'<div id="current-plugin-box" class="layout-ct vbox hidden">','<div id="current-plugin-frame" class="">',"</div>",'<div id="current-plugin-header">',"<label></label>",'<div id="id-plugin-close" class="close"></div>',"</div>","</div>",'<div id="plugins-mask" style="display: none;">'].join("")),initialize:function(t){_.extend(this,t),this._locked=!1,this._state={DisabledControls:!1},this.lockedControls=[],Common.UI.BaseView.prototype.initialize.call(this,arguments),Common.NotificationCenter.on("app:ready",function(t){Common.Utils.asyncCall(this._onAppReady,this,t)}.bind(this))},render:function(t){return t&&(this.$el=$(t)),this.$el.html(this.template({scope:this})),this.pluginName=$("#current-plugin-header label"),this.pluginsPanel=$("#plugins-box"),this.pluginsMask=$("#plugins-mask",this.$el),this.currentPluginPanel=$("#current-plugin-box"),this.currentPluginFrame=$("#current-plugin-frame"),this.pluginClose=new Common.UI.Button({parentEl:$("#id-plugin-close"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textClosePanel}),this.pluginMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[]}),this.trigger("render:after",this),this},getPanel:function(){var t=$('<section id="plugins-panel" class="panel" data-tab="plugins"></section>'),e=$('<div class="group"></div>');return this.storePlugins.isEmpty()||this.storePlugins.each((function(t){})),e.appendTo(t),t},renderTo:function(t){if(!this.storePlugins.isEmpty()){var e=this,i=$('<div class="group"></div>');this.storePlugins.each((function(t){if(t.get("visible")){var n=t.get("variations"),o=t.get("guid"),s=n[t.get("currentVariation")].get("icons"),a=t.get("baseUrl")+e.parseIcons(s),l=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconImg:a,caption:t.get("name"),menu:n&&n.length>1,split:n&&n.length>1,value:o,hint:t.get("name"),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),r=$('<span class="btn-slot text x-huge"></span>').appendTo(i);l.render(r),t.set("button",l),e.lockedControls.push(l)}})),t.html(i),$('<div class="separator long"></div>').prependTo(t)}},setLocked:function(t){this._locked=t},ChangeSettings:function(t){this.disableControls(this._locked)},disableControls:function(t){this._state.DisabledControls!==t&&(this._state.DisabledControls=t,_.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.pluginsMask&&this.pluginsMask.css("display",t?"block":"none"))},openInsideMode:function(t,e,i){return!!this.pluginsPanel&&(this.pluginsPanel.toggleClass("hidden",!0),this.currentPluginPanel.toggleClass("hidden",!1),this.pluginName.text(t),this.iframePlugin||(this.iframePlugin=document.createElement("iframe"),this.iframePlugin.id=void 0===i?"plugin_iframe":i,this.iframePlugin.name="pluginFrameEditor",this.iframePlugin.width="100%",this.iframePlugin.height="100%",this.iframePlugin.align="top",this.iframePlugin.frameBorder=0,this.iframePlugin.scrolling="no",this.iframePlugin.allow="camera; microphone; display-capture",this.iframePlugin.onload=_.bind(this._onLoad,this),this.currentPluginFrame.append(this.iframePlugin),this.loadMask||(this.loadMask=new Common.UI.LoadMask({owner:this.currentPluginFrame})),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),this.iframePlugin.src=e),this.fireEvent("plugin:open",[this,"onboard","open"]),!0)},closeInsideMode:function(){this.pluginsPanel&&(this.iframePlugin&&(this.currentPluginFrame.empty(),this.iframePlugin=null),this.currentPluginPanel.toggleClass("hidden",!0),this.fireEvent("plugin:open",[this,"onboard","close"]))},openedPluginMode:function(t){var e=this.storePlugins.findWhere({guid:t});if(e){var i=e.get("button");i&&(i.toggle(!0),this.updatePluginButton(e),i.menu&&i.menu.items.length>0&&i.menu.items[0].setCaption(this.textStop))}},closedPluginMode:function(t){var e=this.storePlugins.findWhere({guid:t});if(e){var i=e.get("button");i&&(i.toggle(!1),this.updatePluginButton(e),i.menu&&i.menu.items.length>0&&i.menu.items[0].setCaption(this.textStart))}},_onLoad:function(){this.loadMask&&this.loadMask.hide()},_onAppReady:function(t){},parseIcons:function(t){if(t.length&&"string"!=typeof t[0]){for(var e=Common.UI.Themes.currentThemeId().toLowerCase(),i=Common.UI.Themes.isDarkTheme()?"dark":"light",n=-1,o=0;o<t.length;o++)if(t[o].theme&&t[o].theme.toLowerCase()==e){n=o;break}if(n<0)for(o=0;o<t.length;o++)if(t[o].style&&t[o].style.toLowerCase()==i){n=o;break}n<0&&(n=0);var s,a,l=100*Common.Utils.applicationPixelRatio(),r=t[n],c=1e4,d=0;for(var h in r)r.hasOwnProperty(h)&&("default"==h?s=r[h]:isNaN(parseInt(h))||(d=Math.abs(l-parseInt(h)))<c-.01&&(c=d,a=r[h]));return c>.01&&s&&(a=s),{normal:a.normal,hover:a.hover||a.normal,active:a.active||a.normal}}var p=t[(Common.Utils.applicationPixelRatio()>1?1:0)+(t.length>2?2:0)];return{normal:p,hover:p,active:p}},updatePluginIcons:function(t){if(!t.get("visible"))return null;var e=t.get("variations")[t.get("currentVariation")].get("icons");t.set("parsedIcons",this.parseIcons(e)),this.updatePluginButton(t)},updatePluginButton:function(t){if(!t.get("visible"))return null;var e=t.get("button");e&&e.cmpEl&&e.cmpEl.find(".inner-box-icon img").attr("src",t.get("baseUrl")+t.get("parsedIcons")[e.isActive()?"active":"normal"])},createPluginButton:function(t){if(!t.get("visible"))return null;var e=this,i=t.get("variations"),n=t.get("guid"),o=i[t.get("currentVariation")].get("icons"),s=this.parseIcons(o),a=t.get("baseUrl")+s.normal;t.set("parsedIcons",s);var l=[];_.each(t.get("variations"),(function(t,i){t.get("visible")&&l.push({caption:i>0?t.get("description"):e.textStart,value:parseInt(t.get("index"))})}));var r=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconImg:a,caption:t.get("name"),menu:l.length>1,split:l.length>1,value:n,hint:t.get("name"),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});return r.split&&(r.setMenu(new Common.UI.Menu({items:l,pluginGuid:t.get("guid")})),r.menu.on("item:click",(function(t,i,n){e.fireEvent("plugin:select",[t.options.pluginGuid,i.value])}))),r.on("click",(function(t,i){e.fireEvent("plugin:select",[t.options.value,0])})),t.set("button",r),e.lockedControls.push(r),r},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},strPlugins:"Plugins",textLoading:"Loading",textStart:"Start",textStop:"Stop",groupCaption:"Plugins",textClosePanel:"Close plugin"},Common.Views.Plugins||{}))})),define("text!spreadsheeteditor/main/app/template/FileMenu.template",[],(function(){return'<div class="panel-menu">\r\n    <li class="fm-first-item"></li>\r\n    <li id="fm-btn-return" class="fm-btn" data-layout-name="toolbar-file-close"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-save" class="fm-btn" data-layout-name="toolbar-file-save"></li>\r\n    <li id="fm-btn-edit" class="fm-btn"></li>\r\n    <li id="fm-btn-download" class="fm-btn"></li>\r\n    <li id="fm-btn-save-copy" class="fm-btn"></li>\r\n    <li id="fm-btn-save-desktop" class="fm-btn"></li>\r\n    <li id="fm-btn-print-with-preview" class="fm-btn"></li>\r\n    <li id="fm-btn-rename" class="fm-btn"></li>\r\n    <li id="fm-btn-protect" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-recent" class="fm-btn"></li>\r\n    <li id="fm-btn-create" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-info" class="fm-btn" data-layout-name="toolbar-file-info"></li>\r\n    <li id="fm-btn-rights" class="fm-btn"></li>\r\n    <li id="fm-btn-history" class="fm-btn"></li>\r\n    <li class="devider" class="fm-btn"></li>\r\n    <li id="fm-btn-settings" class="fm-btn" data-layout-name="toolbar-file-settings"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-help" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-back" class="fm-btn"></li>\r\n</div>\r\n<div class="panel-context">\r\n    <div id="panel-saveas" class="content-box"></div>\r\n    <div id="panel-savecopy" class="content-box"></div>\r\n    <div id="panel-recentfiles" class="content-box"></div>\r\n    <div id="panel-createnew" class="content-box"></div>\r\n    <div id="panel-info" class="content-box"></div>\r\n    <div id="panel-rights" class="content-box"></div>\r\n    <div id="panel-settings" class="content-box"></div>\r\n    <div id="panel-help" class="content-box"></div>\r\n    <div id="panel-protect" class="content-box"></div>\r\n    <div id="panel-print" class="content-box"></div>\r\n</div>'})),define("spreadsheeteditor/main/app/view/FileMenu",["text!spreadsheeteditor/main/app/template/FileMenu.template","underscore","common/main/lib/component/BaseView"],(function(t,e){"use strict";SSE.Views.FileMenu=Common.UI.BaseView.extend(e.extend({el:"#file-menu-panel",rendered:!1,options:{alias:"FileMenu"},template:e.template(t),events:function(){return{"click .fm-btn":e.bind((function(t){var i=$(t.currentTarget);i.hasClass("active")||($(".fm-btn",this.el).removeClass("active"),i.addClass("active"));var n=e.findWhere(this.items,{el:t.currentTarget});if(n){var o=this.panels[n.options.action];if("help"===n.options.action&&!0===o.noHelpContents&&navigator.onLine)return this.fireEvent("item:click",[this,"external-help",!0]),void window.open(o.urlHelpCenter,"_blank");this.fireEvent("item:click",[this,n.options.action,!!o]),o&&(this.$el.find(".content-box:visible").hide(),this.active=n.options.action,o.show())}}),this)}},initialize:function(){},render:function(){var t=$(this.template());if(this.miClose=new Common.UI.MenuItem({el:t.elementById("#fm-btn-return"),action:"back",caption:this.btnCloseMenuCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miSave=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save"),action:"save",caption:this.btnSaveCaption,canFocused:!1,disabled:!0,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14],dataHintTitle:"S"}),this.options.miSave&&(this.miSave.setDisabled(this.options.miSave.isDisabled()),delete this.options.miSave),this.miEdit=new Common.UI.MenuItem({el:t.elementById("#fm-btn-edit"),action:"edit",caption:this.btnToEditCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miDownload=new Common.UI.MenuItem({el:t.elementById("#fm-btn-download"),action:"saveas",caption:this.btnDownloadCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miSaveCopyAs=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save-copy"),action:"save-copy",caption:this.btnSaveCopyAsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miSaveAs=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save-desktop"),action:"save-desktop",caption:this.btnSaveAsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miPrintWithPreview=new Common.UI.MenuItem({el:t.elementById("#fm-btn-print-with-preview"),action:"printpreview",caption:this.btnPrintCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14],dataHintTitle:"P"}),this.miRename=new Common.UI.MenuItem({el:t.elementById("#fm-btn-rename"),action:"rename",caption:this.btnRenameCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.options.miRename&&(this.miRename.setDisabled(this.options.miRename.isDisabled()),delete this.options.miRename),this.miProtect=new Common.UI.MenuItem({el:t.elementById("#fm-btn-protect"),action:"protect",caption:this.btnProtectCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.options.miProtect&&(this.miProtect.setDisabled(this.options.miProtect.isDisabled()),delete this.options.miProtect),this.miRecent=new Common.UI.MenuItem({el:t.elementById("#fm-btn-recent"),action:"recent",caption:this.btnRecentFilesCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miNew=new Common.UI.MenuItem({el:t.elementById("#fm-btn-create"),action:"new",caption:this.btnCreateNewCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miInfo=new Common.UI.MenuItem({el:t.elementById("#fm-btn-info"),action:"info",caption:this.btnInfoCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miAccess=new Common.UI.MenuItem({el:t.elementById("#fm-btn-rights"),action:"rights",caption:this.btnRightsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miSettings=new Common.UI.MenuItem({el:t.elementById("#fm-btn-settings"),action:"opts",caption:this.btnSettingsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miHelp=new Common.UI.MenuItem({el:t.elementById("#fm-btn-help"),action:"help",caption:this.btnHelpCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miHistory=new Common.UI.MenuItem({el:t.elementById("#fm-btn-history"),action:"history",caption:this.btnHistoryCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miBack=new Common.UI.MenuItem({el:t.elementById("#fm-btn-back"),action:"exit",caption:this.btnBackCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.items=[],this.items.push(this.miClose,this.miSave,this.miEdit,this.miDownload,this.miSaveCopyAs,this.miSaveAs,this.miPrintWithPreview,this.miRename,this.miProtect,this.miRecent,this.miNew,this.miInfo,this.miAccess,this.miHistory,this.miSettings,this.miHelp,this.miBack),this.rendered=!0,this.$el.html(t),this.$el.find(".content-box").hide(),e.isUndefined(this.scroller)){var i=this;this.scroller=new Common.UI.Scroller({el:this.$el.find(".panel-menu"),suppressScrollX:!0,alwaysVisibleY:!0}),Common.NotificationCenter.on("window:resize",(function(){i.scroller.update()}))}return this.applyMode(),this.api&&(this.panels.info.setApi(this.api),this.panels.protect&&this.panels.protect.setApi(this.api),this.panels.opts&&this.panels.opts.setApi(this.api)),this},show:function(t,e){if((!this.isVisible()||void 0!==t)&&this.mode){this.rendered||this.render();var i=!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline?"info":"saveas";t||(t=this.active||i),this.$el.show(),this.scroller.update(),this.selectMenu(t,e,i),this.api.asc_enableKeyEvents(!1),this.fireEvent("menu:show",[this])}},hide:function(){this.$el.hide(),this.api&&this.api.asc_enableKeyEvents(!0),this.fireEvent("menu:hide",[this])},applyMode:function(){if(this.rendered&&(this.panels||(this.panels={opts:new SSE.Views.FileMenuPanels.MainSettingsGeneral({menu:this}).render(this.$el.find("#panel-settings")),info:new SSE.Views.FileMenuPanels.DocumentInfo({menu:this}).render(this.$el.find("#panel-info")),rights:new SSE.Views.FileMenuPanels.DocumentRights({menu:this}).render(this.$el.find("#panel-rights"))}),this.mode)){var t,e=!1,i=Common.UI.LayoutManager.isElementVisible("toolbar-file-close");this.miClose[i?"show":"hide"](),this.miClose.$el.find("+.devider")[i?"show":"hide"](),i&&(t=this.miClose.$el.find("+.devider")),this.miDownload[!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline?"hide":"show"]();var n=!!window.AscDesktopEditor&&window.AscDesktopEditor.isBlockchainSupport();if(this.miSaveCopyAs[!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline||!this.mode.canRequestSaveAs&&!this.mode.saveAsUrl||n?"hide":"show"](),this.miSaveAs[this.mode.canDownload&&this.mode.isDesktopApp&&this.mode.isOffline?"show":"hide"](),this.miSave[this.mode.isEdit&&Common.UI.LayoutManager.isElementVisible("toolbar-file-save")?"show":"hide"](),this.miEdit[!this.mode.isEdit&&this.mode.canEdit&&this.mode.canRequestEditRights?"show":"hide"](),this.miPrintWithPreview[this.mode.canPrint?"show":"hide"](),this.miRename[this.mode.canRename&&!this.mode.isDesktopApp?"show":"hide"](),this.miProtect[this.mode.canProtect?"show":"hide"](),e=(this.mode.canDownload||this.mode.isEdit&&Common.UI.LayoutManager.isElementVisible("toolbar-file-save")||this.mode.canPrint||this.mode.canProtect||!this.mode.isEdit&&this.mode.canEdit&&this.mode.canRequestEditRights||this.mode.canRename&&!this.mode.isDesktopApp)&&!this.mode.isDisconnected,this.miProtect.$el.find("+.devider")[e?"show":"hide"](),e&&(t=this.miProtect.$el.find("+.devider")),this.miRecent[this.mode.canOpenRecent?"show":"hide"](),this.miNew[this.mode.canCreateNew?"show":"hide"](),e=this.mode.canCreateNew,this.miNew.$el.find("+.devider")[e?"show":"hide"](),e&&(t=this.miNew.$el.find("+.devider")),e=i=Common.UI.LayoutManager.isElementVisible("toolbar-file-info"),this.miInfo[i?"show":"hide"](),i=!this.mode.isOffline&&this.document&&this.document.info&&(this.document.info.sharingSettings&&this.document.info.sharingSettings.length>0||this.mode.sharingSettingsUrl&&this.mode.sharingSettingsUrl.length||this.mode.canRequestSharingSettings),e=e||i,this.miAccess[i?"show":"hide"](),i=this.mode.canUseHistory&&!this.mode.isDisconnected,e=e||i,this.miHistory[i?"show":"hide"](),this.miHistory.$el.find("+.devider")[e?"show":"hide"](),e&&(t=this.miHistory.$el.find("+.devider")),i=Common.UI.LayoutManager.isElementVisible("toolbar-file-settings"),this.miSettings[i?"show":"hide"](),this.miSettings.$el.find("+.devider")[i?"show":"hide"](),i&&(t=this.miSettings.$el.find("+.devider")),i=this.mode.canHelp,this.miHelp[i?"show":"hide"](),this.miHelp.$el.find("+.devider")[i?"show":"hide"](),i&&(t=this.miHelp.$el.find("+.devider")),i=this.mode.canBack,this.miBack[i?"show":"hide"](),t&&!i&&t.hide(),this.customizationDone||(this.customizationDone=!0,Common.Utils.applyCustomization(this.mode.customization,{goback:"#fm-btn-back > a"})),this.panels.opts.setMode(this.mode),this.panels.info.setMode(this.mode),!this.mode.isDisconnected&&this.panels.info.updateInfo(this.document),this.panels.rights.setMode(this.mode),!this.mode.isDisconnected&&this.panels.rights.updateInfo(this.document),this.mode.canCreateNew&&this.mode.templates&&this.mode.templates.length&&!this.panels.new&&(this.panels.new=new SSE.Views.FileMenuPanels.CreateNew({menu:this,docs:this.mode.templates,blank:this.mode.canRequestCreateNew||!!this.mode.createUrl}).render()),this.mode.canOpenRecent&&this.mode.recent&&!this.panels.recent&&(this.panels.recent=new SSE.Views.FileMenuPanels.RecentFiles({menu:this,recent:this.mode.recent}).render()),this.mode.canProtect&&(!this.panels.protect&&(this.panels.protect=new SSE.Views.FileMenuPanels.ProtectDoc({menu:this}).render()),this.panels.protect.setMode(this.mode)),this.mode.canDownload&&!this.panels.saveas&&(this.panels.saveas=new SSE.Views.FileMenuPanels.ViewSaveAs({menu:this,fileType:this.document.fileType}).render()),this.mode.canDownload&&(this.mode.canRequestSaveAs||this.mode.saveAsUrl)&&!this.panels["save-copy"]&&(this.panels["save-copy"]=new SSE.Views.FileMenuPanels.ViewSaveCopy({menu:this,fileType:this.document.fileType}).render()),this.mode.canHelp&&!this.panels.help&&(this.panels.help=new SSE.Views.FileMenuPanels.Help({menu:this}).render(),this.panels.help.setLangConfig(this.mode.lang)),null!=this.mode.disableEditing&&(this.panels.opts.SetDisabled(this.mode.disableEditing),delete this.mode.disableEditing),this.mode.canPrint){var o=SSE.getController("Print").getView("PrintWithPreview");o.menu=this,!this.panels.printpreview&&(this.panels.printpreview=o.render(this.$el.find("#panel-print")))}Common.Controllers.Desktop.isActive()&&($('<li id="fm-btn-local-open" class="fm-btn"/>').insertAfter($("#fm-btn-recent",this.$el)),this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-local-open",this.$el),action:"file:open",caption:this.btnFileOpenCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]})),$('<li class="devider" /><li id="fm-btn-exit" class="fm-btn"/>').insertAfter($("#fm-btn-back",this.$el)),this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-exit",this.$el),action:"file:exit",caption:this.btnExitCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]})))}},setMode:function(t,e){t.isDisconnected?(this.mode.canEdit=this.mode.isEdit=!1,this.mode.canOpenRecent=this.mode.canCreateNew=!1,this.mode.isDisconnected=t.isDisconnected,this.mode.canRename=!1,t.enableDownload||(this.mode.canPrint=this.mode.canDownload=!1)):this.mode=t,e||this.applyMode()},setApi:function(t){this.api=t,this.rendered&&(this.panels.info.setApi(t),this.panels.opts&&this.panels.opts.setApi(t),this.panels.protect&&this.panels.protect.setApi(t)),this.api.asc_registerCallback("asc_onDocumentName",e.bind(this.onDocumentName,this))},loadDocument:function(t){this.document=t.doc},selectMenu:function(t,e,i){if(t){var n=this._getMenuItem(t),o=this.panels[t];if(!n.isDisabled()&&n.isVisible()||(n=this._getMenuItem(i),o=this.panels[i]),n&&o){if($(".fm-btn",this.el).removeClass("active"),n.$el.addClass("active"),this.$el.find(".content-box:visible").hide(),o.show(e),this.scroller){var s=n.$el.position().top,a=n.$el.outerHeight(),l=this.$el.outerHeight();if(s<0||s+a>l){var r=this.scroller.$el.scrollTop()+s+(a-l)/2;r=Math.floor(r/a)*a,this.scroller.scrollTop(r)}}this.active=t}}},_getMenuItem:function(t){return e.find(this.items,(function(e){return e.options.action==t}))},onDocumentName:function(t){this.document.title=t,this.rendered&&this.panels.info.updateInfo(this.document)},isVisible:function(){return!this.$el.is(":hidden")},getButton:function(t){if(this.rendered){if("save"==t)return this.miSave;if("rename"==t)return this.miRename;if("protect"==t)return this.miProtect}else{if("save"==t)return this.options.miSave?this.options.miSave:this.options.miSave=new Common.UI.MenuItem({});if("rename"==t)return this.options.miRename?this.options.miRename:this.options.miRename=new Common.UI.MenuItem({});if("protect"==t)return this.options.miProtect?this.options.miProtect:this.options.miProtect=new Common.UI.MenuItem({})}},SetDisabled:function(t,e){this.panels?this.panels.opts.SetDisabled(t):this.mode.disableEditing=t;var i=this.getButton("protect");e&&e.protect&&i.setDisabled(t||!this.mode.isEdit)},btnSaveCaption:"Save",btnDownloadCaption:"Download as...",btnInfoCaption:"Document Info...",btnRightsCaption:"Access Rights...",btnCreateNewCaption:"Create New",btnRecentFilesCaption:"Open Recent...",btnPrintCaption:"Print",btnHelpCaption:"Help...",btnReturnCaption:"Back to Document",btnToEditCaption:"Edit Document",btnBackCaption:"Go to Documents",btnSettingsCaption:"Advanced Settings...",btnSaveAsCaption:"Save as",btnRenameCaption:"Rename...",btnCloseMenuCaption:"Close Menu",btnProtectCaption:"Protect",btnSaveCopyAsCaption:"Save Copy as...",btnHistoryCaption:"Versions History",btnExitCaption:"Exit",btnFileOpenCaption:"Open..."},SSE.Views.FileMenu||{}))})),define("spreadsheeteditor/main/app/view/LeftMenu",["text!spreadsheeteditor/main/app/template/LeftMenu.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/view/About","common/main/lib/view/Comments","common/main/lib/view/Chat","common/main/lib/view/History","common/main/lib/view/SearchDialog","common/main/lib/view/Plugins","spreadsheeteditor/main/app/view/FileMenu"],(function(t,e,i,n){"use strict";SSE.Views.LeftMenu=n.View.extend(i.extend({el:"#left-menu",template:i.template(t),events:function(){return{"click #left-btn-support":function(){var t=this.mode.customization;t&&t.feedback&&t.feedback.url?window.open(t.feedback.url):window.open("https://support.onlyoffice.com")}}},initialize:function(){this.minimizedMode=!0,this._state={disabled:!1}},render:function(){var t=e(this.template({}));return this.btnSearchBar=new Common.UI.Button({action:"advancedsearch",el:t.elementById("#left-btn-searchbar"),hint:this.tipSearch,disabled:!0,enableToggle:!0,toggleGroup:"leftMenuGroup"}),this.btnSearchBar.on("click",i.bind(this.onBtnMenuClick,this)),this.btnAbout=new Common.UI.Button({action:"about",el:t.elementById("#left-btn-about"),hint:this.tipAbout,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnAbout.on("toggle",i.bind(this.onBtnMenuToggle,this)),this.btnSupport=new Common.UI.Button({action:"support",el:t.elementById("#left-btn-support"),hint:this.tipSupport,disabled:!0}),this.btnComments=new Common.UI.Button({el:t.elementById("#left-btn-comments"),hint:this.tipComments+Common.Utils.String.platformKey("Ctrl+Shift+H"),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnComments.on("toggle",this.onBtnCommentsToggle.bind(this)),this.btnComments.on("click",this.onBtnMenuClick.bind(this)),this.btnChat=new Common.UI.Button({el:t.elementById("#left-btn-chat"),hint:this.tipChat+Common.Utils.String.platformKey("Alt+Q"),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnChat.on("click",this.onBtnMenuClick.bind(this)),this.btnComments.hide(),this.btnChat.hide(),this.btnPlugins=new Common.UI.Button({el:t.elementById("#left-btn-plugins"),hint:this.tipPlugins,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnPlugins.hide(),this.btnPlugins.on("click",i.bind(this.onBtnMenuClick,this)),this.btnSpellcheck=new Common.UI.Button({el:t.elementById("#left-btn-spellcheck"),hint:this.tipSpellcheck,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnSpellcheck.hide(),this.btnSpellcheck.on("click",i.bind(this.onBtnMenuClick,this)),this.menuFile=new SSE.Views.FileMenu({}),this.btnAbout.panel=new Common.Views.About({el:"#about-menu-panel",appName:this.txtEditor}),this.$el.html(t),this},onBtnMenuToggle:function(t,e){e?(t.panel.show(),this._state.pluginIsRunning||this.$el.width(40)):t.panel.hide(),SSE.getController("Toolbar").DisableToolbar(1==e),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onBtnCommentsToggle:function(t,e){e||this.fireEvent("comments:hide",this)},onBtnMenuClick:function(t,e){this.btnAbout.toggle(!1),t.pressed?this.$el.width()>40||this.$el.width(Common.localStorage.getItem("sse-mainmenu-width")||300):this._state.pluginIsRunning||(this.isVisible()&&Common.localStorage.setItem("sse-mainmenu-width",this.$el.width()),this.$el.width(40)),this.onCoauthOptions(),t.pressed&&"advancedsearch"==t.options.action&&this.fireEvent("search:aftershow",this),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onCoauthOptions:function(t){this.mode.canCoAuthoring&&(this.mode.canViewComments&&(this.btnComments.pressed&&this.btnComments.$el.hasClass("notify")&&this.btnComments.$el.removeClass("notify"),this.panelComments[this.btnComments.pressed?"show":"hide"](),this.fireEvent(this.btnComments.pressed?"comments:show":"comments:hide",this)),this.mode.canChat&&(this.btnChat.pressed?(this.btnChat.$el.hasClass("notify")&&this.btnChat.$el.removeClass("notify"),this.panelChat.show(),this.panelChat.focus()):this.panelChat.hide())),this.panelSpellcheck&&(this.btnSpellcheck.pressed?this.panelSpellcheck.show():this.panelSpellcheck.hide()),this.panelSearch&&(this.btnSearchBar.pressed?(this.panelSearch.show(),this.panelSearch.focus()):this.panelSearch.hide())},setOptionsPanel:function(t,e){"chat"==t?this.panelChat=e.render("#left-panel-chat"):"comment"==t?this.panelComments=e:"plugins"!=t||this.panelPlugins?"spellcheck"!=t||this.panelSpellcheck?"history"==t?this.panelHistory=e.render("#left-panel-history"):"advancedsearch"==t&&(this.panelSearch=e.render("#left-panel-search")):this.panelSpellcheck=e.render("#left-panel-spellcheck"):this.panelPlugins=e.render("#left-panel-plugins")},markCoauthOptions:function(t,e){"chat"!=t||!this.btnChat.isVisible()||this.btnChat.isDisabled()||this.btnChat.pressed||this.btnChat.$el.addClass("notify"),"comments"!=t||!this.btnComments.isVisible()||this.btnComments.pressed||this.btnComments.isDisabled()&&!e||this.btnComments.$el.addClass("notify")},close:function(t){this.btnAbout.toggle(!1),this._state.pluginIsRunning||this.$el.width(40),this.mode.canCoAuthoring&&(this.mode.canViewComments&&(this.panelComments.hide(),this.btnComments.pressed&&this.fireEvent("comments:hide",this),this.btnComments.toggle(!1,!0)),this.mode.canChat&&(this.panelChat.hide(),this.btnChat.toggle(!1))),this.mode.canPlugins&&this.panelPlugins&&!this._state.pluginIsRunning&&(this.panelPlugins.hide(),this.btnPlugins.toggle(!1,!0)),this.panelSpellcheck&&(this.panelSpellcheck.hide(),this.btnSpellcheck.toggle(!1,!0)),this.panelSearch&&(this.panelSearch.hide(),this.btnSearchBar.toggle(!1,!0))},isOpened:function(){var t=this.btnSearchBar.pressed;return!t&&(t=this.btnComments.pressed||this.btnChat.pressed),t},disableMenu:function(t,e){this.btnAbout.setDisabled(!1),this.btnSupport.setDisabled(!1),this.btnSearchBar.setDisabled(!1),this.btnComments.setDisabled(!1),this.btnChat.setDisabled(!1),this.btnPlugins.setDisabled(!1),this.btnSpellcheck.setDisabled(!1)},showMenu:function(t,e){var i=/^(\w+):?(\w*)$/.exec(t);"file"==i[1]?this.menuFile.show(i[2].length?i[2]:void 0,e):"chat"==t?!this.btnChat.isVisible()||this.btnChat.isDisabled()||this.btnChat.pressed||(this.btnChat.toggle(!0),this.onBtnMenuClick(this.btnChat),this.panelChat.focus()):"comments"==t?!this.btnComments.isVisible()||this.btnComments.isDisabled()||this.btnComments.pressed||(this.btnComments.toggle(!0),this.onBtnMenuClick(this.btnComments),this.btnComments.$el.focus()):"advancedsearch"==t&&(!this.btnSearchBar.isVisible()||this.btnSearchBar.isDisabled()||this.btnSearchBar.pressed||(this.btnSearchBar.toggle(!0),this.onBtnMenuClick(this.btnSearchBar)))},getMenu:function(t){switch(t){case"file":return this.menuFile;case"about":return this.btnAbout.panel;default:return null}},setMode:function(t){return this.mode=t,this.btnAbout.panel.setMode(t),this},setDeveloperMode:function(t,n,o){if(this.$el.is(":visible")){if((t&Asc.c_oLicenseMode.Trial||t&Asc.c_oLicenseMode.Developer)&&!this.developerHint){var s="";t&Asc.c_oLicenseMode.Trial&&t&Asc.c_oLicenseMode.Developer?s=this.txtTrialDev:0!=(t&Asc.c_oLicenseMode.Trial)?s=this.txtTrial:0!=(t&Asc.c_oLicenseMode.Developer)&&(s=this.txtDeveloper),s=s.toUpperCase(),this.developerHint=e('<div id="developer-hint">'+s+"</div>").appendTo(this.$el),this.devHeight=this.developerHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}if(this.developerHint&&this.developerHint.toggleClass("hidden",!(t&Asc.c_oLicenseMode.Trial||t&Asc.c_oLicenseMode.Developer)),n&&!this.betaHint){var a=t?'style="margin-top: 4px;"':"",l=(o||"").split("."),r="";l.length>0&&(r+="v. "+l[0]),l.length>1&&(r+="."+l[1]),this.betaHint=e('<div id="beta-hint"'+a+">"+r+" (beta)</div>").appendTo(this.$el),this.betaHeight=this.betaHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}this.betaHint&&this.betaHint.toggleClass("hidden",!n);var c=this.$el.find("button.btn-category:visible"),d=c.length>0?e(c[c.length-1]):null;this.minDevPosition=d?d.offset().top-d.offsetParent().offset().top+d.height()+20:20,this.onWindowResize()}},setLimitMode:function(){if(this.$el.is(":visible")){if(!this.limitHint){var t=this.txtLimit.toUpperCase();this.limitHint=e('<div id="limit-hint" style="margin-top: 4px;">'+t+"</div>").appendTo(this.$el),this.limitHeight=this.limitHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}this.limitHint&&this.limitHint.toggleClass("hidden",!1);var n=this.$el.find("button.btn-category:visible"),o=n.length>0?e(n[n.length-1]):null;this.minDevPosition=o?o.offset().top-o.offsetParent().offset().top+o.height()+20:20,this.onWindowResize()}},onWindowResize:function(){var t=(this.devHeight||0)+(this.betaHeight||0)+(this.limitHeight||0),e=Math.max((this.$el.height()-t)/2,this.minDevPosition);this.developerHint&&(this.developerHint.css("top",e),e+=this.devHeight),this.betaHint&&(this.betaHint.css("top",e),e+=this.betaHeight+4),this.limitHint&&this.limitHint.css("top",e)},showHistory:function(){this._state.pluginIsRunning=!1,this._state.historyIsRunning=!0,this.panelHistory.show(),this.panelHistory.$el.width((parseInt(Common.localStorage.getItem("sse-mainmenu-width"))||300)-40),Common.NotificationCenter.trigger("layout:changed","history")},isVisible:function(){return this.$el&&this.$el.is(":visible")},tipComments:"Comments",tipChat:"Chat",tipAbout:"About",tipSupport:"Feedback & Support",tipFile:"File",tipSearch:"Search",tipPlugins:"Plugins",txtDeveloper:"DEVELOPER MODE",txtTrial:"TRIAL MODE",tipSpellcheck:"Spell checking",txtTrialDev:"Trial Developer Mode",txtLimit:"Limit Access",txtEditor:"Spreadsheet Editor"},SSE.Views.LeftMenu||{}))})),define("spreadsheeteditor/main/app/controller/LeftMenu",["core","common/main/lib/util/Shortcuts","common/main/lib/view/SaveAsDlg","spreadsheeteditor/main/app/view/LeftMenu","spreadsheeteditor/main/app/view/FileMenu"],(function(){"use strict";SSE.Controllers.LeftMenu=Backbone.Controller.extend(_.extend({views:["LeftMenu","FileMenu"],initialize:function(){this.addListeners({"Common.Views.Chat":{hide:_.bind(this.onHideChat,this)},"Common.Views.Plugins":{"plugin:open":_.bind(this.onPluginOpen,this),hide:_.bind(this.onHidePlugins,this)},"Common.Views.Header":{"history:show":function(){this.leftMenu.panelHistory.isVisible()||this.clickMenuFileItem("header","history")}.bind(this)},LeftMenu:{"file:show":_.bind(this.fileShowHide,this,!0),"file:hide":_.bind(this.fileShowHide,this,!1),"comments:show":_.bind(this.commentsShowHide,this,!0),"comments:hide":_.bind(this.commentsShowHide,this,!1)},"Common.Views.About":{show:_.bind(this.aboutShowHide,this,!0),hide:_.bind(this.aboutShowHide,this,!1)},FileMenu:{"menu:hide":_.bind(this.menuFilesShowHide,this,"hide"),"menu:show":_.bind(this.menuFilesShowHide,this,"show"),"item:click":_.bind(this.clickMenuFileItem,this),"saveas:format":_.bind(this.clickSaveAsFormat,this),"savecopy:format":_.bind(this.clickSaveCopyAsFormat,this),"settings:apply":_.bind(this.applySettings,this),"spellcheck:apply":_.bind(this.applySpellcheckSettings,this),"create:new":_.bind(this.onCreateNew,this),"recent:open":_.bind(this.onOpenRecent,this)},Toolbar:{"file:settings":_.bind(this.clickToolbarSettings,this),"file:open":this.clickToolbarTab.bind(this,"file"),"file:close":this.clickToolbarTab.bind(this,"other"),"save:disabled":this.changeToolbarSaveState.bind(this)},"Common.Views.ReviewChanges":{"collaboration:chat":_.bind(this.onShowHideChat,this)},SearchBar:{"search:show":_.bind(this.onShowHideSearch,this)}}),Common.NotificationCenter.on("app:comment:add",_.bind(this.onAppAddComment,this)),Common.NotificationCenter.on("leftmenu:change",_.bind(this.onMenuChange,this)),Common.NotificationCenter.on("collaboration:history",_.bind((function(){this.leftMenu.panelHistory.isVisible()||this.clickMenuFileItem(null,"history")}),this)),Common.NotificationCenter.on("file:print",_.bind(this.clickToolbarPrint,this))},onLaunch:function(){this.leftMenu=this.createView("LeftMenu").render(),this.leftMenu.btnSearchBar.on("toggle",_.bind(this.onMenuSearchBar,this)),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+shift+s,ctrl+shift+s":_.bind(this.onShortcut,this,"save"),"command+f,ctrl+f":_.bind(this.onShortcut,this,"search"),"ctrl+h":_.bind(this.onShortcut,this,"replace"),"alt+f":_.bind(this.onShortcut,this,"file"),esc:_.bind(this.onShortcut,this,"escape"),"alt+q":_.bind(this.onShortcut,this,"chat"),"command+shift+h,ctrl+shift+h":_.bind(this.onShortcut,this,"comments"),f1:_.bind(this.onShortcut,this,"help")}}),Common.util.Shortcuts.suspendEvents();var t=this;this.leftMenu.$el.find("button").each((function(){$(this).on("keydown",(function(e){Common.UI.Keys.RETURN!==e.keyCode&&Common.UI.Keys.SPACE!==e.keyCode||(t.leftMenu.btnAbout.toggle(!1),this.blur(),e.preventDefault(),t.api.asc_enableKeyEvents(!0))}))}))},setApi:function(t){if(this.api=t,this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiServerDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiServerDisconnect,this)),this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),Common.NotificationCenter.on("download:cancel",_.bind(this.onDownloadCancel,this)),this.mode.canCoAuthoring&&(this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onApiChatMessage,this)),this.mode.canComments)){this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this));var e=this.getApplication().getController("Common.Controllers.Comments").groupCollection;for(var i in e)for(var n=e[i],o=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment"),s=0;s<n.length;++s){var a=n.at(s);if(!a.get("hide")&&a.get("userid")!==this.mode.user.id&&(o||!a.get("resolved"))){this.leftMenu.markCoauthOptions("comments",!0);break}}}return this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.leftMenu.getMenu("file").setApi(t),this.mode.canUseHistory&&this.getApplication().getController("Common.Controllers.History").setApi(this.api).setMode(this.mode),this.getApplication().getController("Search").setApi(this.api).setMode(this.mode),this.leftMenu.setOptionsPanel("advancedsearch",this.getApplication().getController("Search").getView("Common.Views.SearchPanel")),this},setMode:function(t){return this.mode=t,this.leftMenu.setMode(t),this.leftMenu.getMenu("file").setMode(t),t.isEdit||Common.util.Shortcuts.removeShortcuts({shortcuts:{"command+shift+s,ctrl+shift+s":_.bind(this.onShortcut,this,"save"),"alt+f":_.bind(this.onShortcut,this,"file")}}),this},SetDisabled:function(t,e){this.leftMenu._state.disabled!==t&&(this.leftMenu._state.disabled=t,t?(this.previsEdit=this.mode.isEdit,this.prevcanEdit=this.mode.canEdit,this.mode.isEdit=this.mode.canEdit=!t):(this.mode.isEdit=this.previsEdit,this.mode.canEdit=this.prevcanEdit)),t&&this.leftMenu.close(),(!e||e.comments&&e.comments.disable)&&this.leftMenu.btnComments.setDisabled(t),e&&!e.chat||this.leftMenu.btnChat.setDisabled(t),this.leftMenu.btnPlugins.setDisabled(t),this.leftMenu.btnSpellcheck.setDisabled(t)},createDelayedElements:function(){return this.mode.canCoAuthoring?(this.leftMenu.btnComments[this.mode.canViewComments&&!this.mode.isLightVersion?"show":"hide"](),this.mode.canViewComments&&this.leftMenu.setOptionsPanel("comment",this.getApplication().getController("Common.Controllers.Comments").getView("Common.Views.Comments")),this.leftMenu.btnChat[this.mode.canChat&&!this.mode.isLightVersion?"show":"hide"](),this.mode.canChat&&this.leftMenu.setOptionsPanel("chat",this.getApplication().getController("Common.Controllers.Chat").getView("Common.Views.Chat"))):(this.leftMenu.btnChat.hide(),this.leftMenu.btnComments.hide()),this.mode.isEdit&&Common.UI.FeaturesManager.canChange("spellcheck")&&(Common.UI.LayoutManager.isElementVisible("leftMenu-spellcheck")&&this.leftMenu.btnSpellcheck.show(),this.leftMenu.setOptionsPanel("spellcheck",this.getApplication().getController("Spellcheck").getView("Spellcheck"))),this.mode.canUseHistory&&this.leftMenu.setOptionsPanel("history",this.getApplication().getController("Common.Controllers.History").getView("Common.Views.History")),(this.mode.trialMode||this.mode.isBeta)&&this.leftMenu.setDeveloperMode(this.mode.trialMode,this.mode.isBeta,this.mode.buildVersion),Common.util.Shortcuts.resumeEvents(),this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),this},enablePlugins:function(){this.mode.canPlugins?this.leftMenu.setOptionsPanel("plugins",this.getApplication().getController("Common.Controllers.Plugins").getView("Common.Views.Plugins")):this.leftMenu.btnPlugins.hide(),(this.mode.trialMode||this.mode.isBeta)&&this.leftMenu.setDeveloperMode(this.mode.trialMode,this.mode.isBeta,this.mode.buildVersion)},clickMenuFileItem:function(t,e,i){var n=!0;switch(e){case"back":break;case"save":this.api.asc_Save();break;case"save-desktop":this.api.asc_DownloadAs();break;case"print":Common.NotificationCenter.trigger("print",this.leftMenu);break;case"exit":Common.NotificationCenter.trigger("goback");break;case"edit":this.getApplication().getController("Statusbar").setStatusCaption(this.requestEditRightsText),Common.Gateway.requestEditRights();break;case"new":i?n=!1:this.onCreateNew(void 0,"blank");break;case"rename":var o=(s=this).api.asc_getDocumentName();new Common.Views.RenameDialog({filename:o,maxLength:this.mode.wopi?this.mode.wopi.FileNameMaxLength:void 0,handler:function(t,e){"ok"!=t||_.isEmpty(e.trim())||o===e.trim()||(s.mode.wopi?s.api.asc_wopi_renameFile(e):Common.Gateway.requestRename(e)),Common.NotificationCenter.trigger("edit:complete",s)}}).show();break;case"history":if(!this.leftMenu.panelHistory.isVisible())if(this.api.asc_isDocumentModified()){var s=this;this.api.asc_stopSaving(),Common.UI.warning({closable:!1,width:500,title:this.notcriticalErrorTitle,msg:this.leavePageText,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t?(s.api.asc_undoAllChanges(),s.api.asc_continueSaving(),s.showHistory()):s.api.asc_continueSaving()}})}else this.showHistory();break;case"external-help":n=!0;break;default:n=!1}n&&t&&t.hide()},clickSaveAsFormat:function(t,e){e==Asc.c_oAscFileType.CSV?Common.UI.warning({title:this.textWarning,msg:this.warnDownloadAs,buttons:["ok","cancel"],callback:_.bind((function(i){"ok"==i&&(Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.CSV,this.api.asc_getAdvancedOptions(),2,new Asc.asc_CDownloadOptions(e)),t.hide())}),this)}):e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA?(t.hide(),Common.NotificationCenter.trigger("download:settings",this.leftMenu,e)):(this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e)),t.hide())},clickSaveCopyAsFormat:function(t,e,i){e==Asc.c_oAscFileType.CSV?Common.UI.warning({title:this.textWarning,msg:this.warnDownloadAs,buttons:["ok","cancel"],callback:_.bind((function(n){"ok"==n&&(this.isFromFileDownloadAs=i,Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.CSV,this.api.asc_getAdvancedOptions(),2,new Asc.asc_CDownloadOptions(e,!0)),t.hide())}),this)}):e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA?(this.isFromFileDownloadAs=i,t.hide(),Common.NotificationCenter.trigger("download:settings",this.leftMenu,e,!0)):(this.isFromFileDownloadAs=i,this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e,!0)),t.hide())},onDownloadUrl:function(t,e){if(this.isFromFileDownloadAs){var i=this,n=this.getApplication().getController("Viewport").getView("Common.Views.Header").getDocumentCaption();if(!n&&(n=i.txtUntitled),"string"==typeof this.isFromFileDownloadAs){var o=n.lastIndexOf(".");o>0&&(n=n.substring(0,o)+this.isFromFileDownloadAs)}i.mode.canRequestSaveAs?Common.Gateway.requestSaveAs(t,n,e):(i._saveCopyDlg=new Common.Views.SaveAsDlg({saveFolderUrl:i.mode.saveAsUrl,saveFileUrl:t,defFileName:n}),i._saveCopyDlg.on("saveaserror",(function(t,e){var n={closable:!1,title:i.textWarning,msg:e,iconCls:"warn",buttons:["ok"],callback:function(t){Common.NotificationCenter.trigger("edit:complete",i)}};Common.UI.alert(n)})).on("close",(function(t){i._saveCopyDlg=void 0})),i._saveCopyDlg.show())}this.isFromFileDownloadAs=!1},onDownloadCancel:function(){this.isFromFileDownloadAs=!1},applySettings:function(t){var e=Common.localStorage.getBool("sse-settings-cachemode",!0);Common.Utils.InternalSettings.set("sse-settings-cachemode",e),this.api.asc_setDefaultBlitMode(e),e=Common.localStorage.getItem("sse-settings-fontrender"),Common.Utils.InternalSettings.set("sse-settings-fontrender",e),this.api.asc_setFontRenderingMode(parseInt(e)),e=Common.localStorage.getBool("sse-settings-livecomment",!0),Common.Utils.InternalSettings.set("sse-settings-livecomment",e);var i=Common.localStorage.getBool("sse-settings-resolvedcomment");Common.Utils.InternalSettings.set("sse-settings-resolvedcomment",i),this.mode.canViewComments&&this.leftMenu.panelComments.isVisible()&&(e=i=!0),e?this.api.asc_showComments(i):this.api.asc_hideComments(),this.getApplication().getController("Common.Controllers.ReviewChanges").commentsShowHide(e?"show":"hide"),e=Common.localStorage.getBool("sse-settings-r1c1"),Common.Utils.InternalSettings.set("sse-settings-r1c1",e),this.api.asc_setR1C1Mode(e);var n=Common.Utils.InternalSettings.get("sse-settings-coauthmode");this.mode.isEdit&&!this.mode.isOffline&&this.mode.canCoAuthoring?this.mode.canChangeCoAuthoring&&(n=Common.localStorage.getBool("sse-settings-coauthmode",!0),Common.Utils.InternalSettings.set("sse-settings-coauthmode",n),this.api.asc_SetFastCollaborative(n)):this.mode.canLiveView&&!this.mode.isOffline&&this.mode.canChangeCoAuthoring&&(n=Common.localStorage.getBool("sse-settings-view-coauthmode",!1),Common.Utils.InternalSettings.set("sse-settings-coauthmode",n),this.api.asc_SetFastCollaborative(n)),this.mode.isEdit&&(!this.mode.canChangeCoAuthoring&&n||(e=parseInt(Common.localStorage.getItem("sse-settings-autosave")),Common.Utils.InternalSettings.set("sse-settings-autosave",e),this.api.asc_setAutoSaveGap(e)),e=parseInt(Common.localStorage.getItem("sse-settings-paste-button")),Common.Utils.InternalSettings.set("sse-settings-paste-button",e),this.api.asc_setVisiblePasteButton(!!e));var o=Common.localStorage.getItem("sse-settings-reg-settings"),s=Common.Utils.InternalSettings.get("sse-settings-use-base-separator");null===o&&(o=this.api.asc_getLocale()),s?this.api.asc_setLocale(parseInt(o),void 0,void 0):this.api.asc_setLocale(parseInt(o),Common.localStorage.getItem("sse-settings-decimal-separator"),Common.localStorage.getItem("sse-settings-group-separator")),t.hide(),this.leftMenu.fireEvent("settings:apply")},applySpellcheckSettings:function(t){if(this.mode.isEdit&&this.api&&Common.UI.FeaturesManager.canChange("spellcheck")){var e=Common.localStorage.getBool("sse-spellcheck-ignore-uppercase-words");this.api.asc_ignoreUppercase(e),e=Common.localStorage.getBool("sse-spellcheck-ignore-numbers-words"),this.api.asc_ignoreNumbers(e),(e=Common.localStorage.getItem("sse-spellcheck-locale"))&&this.api.asc_setDefaultLanguage(parseInt(e))}t.hide(),this.leftMenu.fireEvent("spellcheck:update")},onCreateNew:function(t,e){if(!Common.Controllers.Desktop.process("create:new"))if("blank"==e&&this.mode.canRequestCreateNew)Common.Gateway.requestCreateNew();else{var i=window.open("blank"==e?this.mode.createUrl:e,"_blank");i&&i.focus()}t&&t.hide()},onOpenRecent:function(t,e){t&&t.hide();var i=window.open(e);i&&i.focus(),Common.component.Analytics.trackEvent("Open Recent")},clickToolbarSettings:function(t){this.leftMenu.showMenu("file:opts")},clickToolbarTab:function(t,e){"file"==t?this.leftMenu.showMenu("file"):this.leftMenu.menuFile.hide()},clickToolbarPrint:function(){this.leftMenu.showMenu("file:printpreview")},changeToolbarSaveState:function(t){var e=this.leftMenu.menuFile.getButton("save");e&&e.setDisabled(t)},onHideChat:function(){$(this.leftMenu.btnChat.el).blur(),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onHidePlugins:function(){Common.NotificationCenter.trigger("layout:changed","leftmenu")},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,this.leftMenu.panelSearch&&this.leftMenu.panelSearch.setSearchMode(this.viewmode?"no-replace":"search"))},onApiServerDisconnect:function(t){this.mode.isEdit=!1,this.leftMenu.close(),this.leftMenu.btnComments.setDisabled(!0),this.leftMenu.btnChat.setDisabled(!0),this.leftMenu.btnPlugins.setDisabled(!0),this.leftMenu.btnSpellcheck.setDisabled(!0),this.leftMenu.getMenu("file").setMode({isDisconnected:!0,enableDownload:!!t})},onApiChatMessage:function(){this.leftMenu.markCoauthOptions("chat")},onApiAddComment:function(t,e){var i=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment");e&&e.asc_getUserId()!==this.mode.user.id&&(i||!e.asc_getSolved())&&AscCommon.UserInfoParser.canViewComment(e.asc_getUserName())&&this.leftMenu.markCoauthOptions("comments")},onApiAddComments:function(t){for(var e=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment"),i=0;i<t.length;++i)if(t[i].asc_getUserId()!==this.mode.user.id&&(e||!t[i].asc_getSolved())&&AscCommon.UserInfoParser.canViewComment(t[i].asc_getUserName())){this.leftMenu.markCoauthOptions("comments");break}},onAppAddComment:function(t,e){if(e){var i=this;new Promise((function(t,e){t()})).then((function(){Common.UI.Menu.Manager.hideAll(),i.leftMenu.showMenu("comments");var t=SSE.getController("Common.Controllers.Comments");t.getView().showEditContainer(!0),t.onAfterShow()}))}},commentsShowHide:function(t){if(this.api){var e=Common.Utils.InternalSettings.get("sse-settings-livecomment"),i=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment");e&&i||(t?this.api.asc_showComments(!0):e?this.api.asc_showComments(i):this.api.asc_hideComments()),t&&this.getApplication().getController("Common.Controllers.Comments").onAfterShow(),t||$(this.leftMenu.btnComments.el).blur()}},fileShowHide:function(t){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!t))},aboutShowHide:function(t){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!t),t||$(this.leftMenu.btnAbout.el).blur(),!t&&this.leftMenu._state.pluginIsRunning&&(this.leftMenu.panelPlugins.show(),this.mode.canCoAuthoring&&(this.mode.canViewComments&&this.leftMenu.panelComments.hide(),this.mode.canChat&&this.leftMenu.panelChat.hide())))},menuFilesShowHide:function(t){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!("show"==t))),this.dlgSearch&&("show"==t?this.dlgSearch.suspendKeyEvents():Common.Utils.asyncCall(this.dlgSearch.resumeKeyEvents,this.dlgSearch))},onShortcut:function(t,e){if(this.mode){if(this.mode.isEditDiagram&&"escape"!=t)return!1;if(this.mode.isEditMailMerge&&"escape"!=t&&"search"!=t)return!1;if(this.mode.isEditOle&&"escape"!=t&&"search"!=t)return!1;switch(t){case"replace":case"search":if(this.mode.isEditMailMerge||this.mode.isEditOle)return this.leftMenu.fireEvent("search:show"),!1;if(!this.leftMenu.btnSearchBar.isDisabled()){Common.UI.Menu.Manager.hideAll(),this.leftMenu.btnAbout.toggle(!1),this.leftMenu.menuFile.isVisible()&&this.leftMenu.menuFile.hide();var i=this.api.asc_GetSelectedText();if(this.isSearchPanelVisible())return i&&this.leftMenu.panelSearch.setFindText(i),this.leftMenu.panelSearch.focus(""!==i?t:"search"),this.leftMenu.fireEvent("search:aftershow",[i||void 0]),!1;if(this.getApplication().getController("Viewport").isSearchBarVisible()){var n=this.getApplication().getController("Viewport");if("replace"!==t)return i&&n.searchBar.setText(i),n.searchBar.focus(),!1;n.header.btnSearch.toggle(!1),this.onShowHideSearch(!0,n.searchBar.inputSearch.val())}else{if("search"===t)return Common.NotificationCenter.trigger("search:show"),!1;this.onShowHideSearch(!0,i||void 0)}this.leftMenu.btnSearchBar.toggle(!0,!0),this.leftMenu.panelSearch.focus(i?t:"search")}return!1;case"save":return this.mode.canDownload&&(this.mode.isDesktopApp&&this.mode.isOffline?this.api.asc_DownloadAs():(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file:saveas"))),!1;case"help":return this.mode.isEdit&&this.mode.canHelp&&(Common.UI.Menu.Manager.hideAll(),this.api.asc_closeCellEditor(),this.leftMenu.showMenu("file:help")),!1;case"file":return Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file"),!1;case"escape":var o=this.getApplication().getController("Viewport").header.btnSearch;if(o.pressed&&o.toggle(!1),this.leftMenu.menuFile.isVisible())return Common.UI.HintManager.needCloseFileMenu()&&this.leftMenu.menuFile.hide(),!1;var s=SSE.getController("Statusbar").statusbar.$el.find('.open > [data-toggle="dropdown"]');if(s.length)return $.fn.dropdown.Constructor.prototype.keydown.call(s[0],e),!1;if(this.mode.canPlugins&&this.leftMenu.panelPlugins&&!0!==this.api.isCellEdited&&(s=this.leftMenu.panelPlugins.$el.find('#menu-plugin-container.open > [data-toggle="dropdown"]')).length)return $.fn.dropdown.Constructor.prototype.keydown.call(s[0],e),!1;if(this.leftMenu.btnAbout.pressed||($(e.target).parents("#left-menu").length||this.leftMenu.btnPlugins.pressed||this.leftMenu.btnComments.pressed)&&!0!==this.api.isCellEdited)return Common.UI.HintManager.isHintVisible()||(this.leftMenu.close(),Common.NotificationCenter.trigger("layout:changed","leftmenu")),!1;if(this.mode.isEditDiagram||this.mode.isEditMailMerge||this.mode.isEditOle){var a=(this.mode.isEditMailMerge||this.mode.isEditOle)&&this.getApplication().getController("Toolbar").toolbar.btnSearch,l=a&&a.pressed;if(s=$(document.body).find(".open > .dropdown-menu"),!this.api.isCellEdited&&!s.length&&!l)return this.mode.isEditOle&&Common.NotificationCenter.trigger("oleedit:close"),Common.Gateway.internalMessage("shortcut",{key:"escape"}),!1;l&&a.toggle(!1)}break;case"chat":return this.mode.canCoAuthoring&&this.mode.canChat&&!this.mode.isLightVersion&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("chat")),!1;case"comments":return this.mode.canCoAuthoring&&this.mode.canViewComments&&!this.mode.isLightVersion&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("comments"),this.getApplication().getController("Common.Controllers.Comments").onAfterShow()),!1}}},onCellsRange:function(t){var e=t!=Asc.c_oAscSelectionDialogType.None;this.leftMenu.btnAbout.setDisabled(e),this.leftMenu.btnSearchBar.setDisabled(e),this.leftMenu.btnSpellcheck.setDisabled(e),this.mode.canPlugins&&this.leftMenu.panelPlugins&&(this.leftMenu.panelPlugins.setLocked(e),this.leftMenu.panelPlugins.disableControls(e))},onApiEditCell:function(t){var e=t==Asc.c_oAscCellEditorState.editFormula;this.leftMenu.btnAbout.setDisabled(e),this.leftMenu.btnSearchBar.setDisabled(e),this.leftMenu.btnSpellcheck.setDisabled(e),this.mode.canPlugins&&this.leftMenu.panelPlugins&&(this.leftMenu.panelPlugins.setLocked(e),this.leftMenu.panelPlugins.disableControls(e))},onPluginOpen:function(t,e,i){"onboard"==e&&("open"==i?(this.leftMenu.close(),this.leftMenu.panelPlugins.show(),this.leftMenu.onBtnMenuClick({pressed:!0,options:{action:"plugins"}}),this.leftMenu._state.pluginIsRunning=!0):(this.leftMenu._state.pluginIsRunning=!1,this.leftMenu.close()))},onShowHideChat:function(t){this.mode.canCoAuthoring&&this.mode.canChat&&!this.mode.isLightVersion&&(t?(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("chat")):(this.leftMenu.btnChat.toggle(!1,!0),this.leftMenu.onBtnMenuClick(this.leftMenu.btnChat)))},onShowHideSearch:function(t,e){t?(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("advancedsearch"),this.leftMenu.fireEvent("search:aftershow",[e])):(this.leftMenu.btnSearchBar.toggle(!1,!0),this.leftMenu.onBtnMenuClick(this.leftMenu.btnSearchBar))},onMenuSearchBar:function(t,e){if(e){var i=this.mode.isEdit&&!this.viewmode?void 0:"no-replace";this.leftMenu.panelSearch.setSearchMode(i)}},isSearchPanelVisible:function(){return this.leftMenu&&this.leftMenu.panelSearch&&this.leftMenu.panelSearch.isVisible()},onMenuChange:function(t){"hide"===t&&(this.leftMenu.btnComments.isActive()&&this.api?(this.leftMenu.btnComments.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnComments),this.api.asc_enableKeyEvents(!0)):this.leftMenu.btnSearchBar.isActive()&&this.api?(this.leftMenu.btnSearchBar.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnSearchBar)):this.leftMenu.btnSpellcheck.isActive()&&this.api&&(this.leftMenu.btnSpellcheck.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnSpellcheck)))},showHistory:function(){if(!this.mode.wopi){var t=this.getApplication().getController("Main");t.loadMask||(t.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),t.loadMask.setTitle(this.textLoadHistory),t.loadMask.show()}Common.Gateway.requestHistory()},isCommentsVisible:function(){return this.leftMenu&&this.leftMenu.panelComments&&this.leftMenu.panelComments.isVisible()},textNoTextFound:"Text not found",newDocumentTitle:"Unnamed document",textItemEntireCell:"Entire cell contents",requestEditRightsText:"Requesting editing rights...",warnDownloadAs:"If you continue saving in this format all features except the text will be lost.<br>Are you sure you want to continue?",textWarning:"Warning",textSheet:"Sheet",textWorkbook:"Workbook",textByColumns:"By columns",textByRows:"By rows",textFormulas:"Formulas",textValues:"Values",textWithin:"Within",textSearch:"Search",textLookin:"Look in",txtUntitled:"Untitled",textLoadHistory:"Loading version history...",leavePageText:"All unsaved changes in this document will be lost.<br> Click 'Cancel' then 'Save' to save them. Click 'OK' to discard all the unsaved changes."},SSE.Controllers.LeftMenu||{}))})),define("spreadsheeteditor/main/app/view/Spellcheck",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Button","common/main/lib/component/ListView","common/main/lib/component/InputField","common/main/lib/component/ComboBox","common/main/lib/component/ComboDataView"],(function(t){"use strict";SSE.Views.Spellcheck=Common.UI.BaseView.extend(_.extend({el:"#left-panel-spellcheck",template:_.template(['<div id="spellcheck-box" class="layout-ct active">','<div class="spellcheck-settings">','<div class="spellcheck-settings-inner">','<div style="display: flex; width: 100%; padding-bottom: 8px; padding-top: 16px;">','<div id="spellcheck-current-word"></div>','<div id="spellcheck-next" style=""></div>',"</div>",'<div id="spellcheck-suggestions-list"></div>','<div id="spellcheck-change" style=""></div>','<div id="spellcheck-ignore" class="padding-large"></div>','<button class="btn btn-text-default auto" id="spellcheck-add-to-dictionary" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.txtAddToDictionary %></button>','<label class="header" style="display: block;"><%= scope.txtDictionaryLanguage %></label>','<div id="spellcheck-dictionary-language"></div>','<div id="spellcheck-complete" class="hidden">','<i class="btn-resolve" style="display: inline-block;margin-right: 10px;"></i>',"<%= scope.txtComplete %>","</div>","</div>","</div>",'<div id="spellcheck-header">',"<label><%= scope.txtSpelling %></label>",'<div id="spellcheck-btn-close" style="float:right; margin-left: 4px;"></div>',"</div>","</div>"].join("")),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments)},render:function(t){return t=t||this.el,this.$el=$(t),this.$el.html(this.template({scope:this})),this.buttonClose=new Common.UI.Button({parentEl:$("#spellcheck-btn-close",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.txtClosePanel,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.buttonClose.on("click",_.bind(this.onClickClosePanel,this)),this.currentWord=new Common.UI.InputField({el:$("#spellcheck-current-word"),allowBlank:!0,validateOnBlur:!1,disabled:!0,dataHint:"1",dataHintDirection:"left",dataHintOffset:"big"}),this.buttonNext=new Common.UI.Button({parentEl:$("#spellcheck-next"),style:"margin-left: 5px;",cls:"btn-toolbar bg-white",iconCls:"toolbar__icon btn-nextitem",hint:this.txtNextTip,dataHint:"1",dataHintDirection:"bottom"}),this.suggestionList=new Common.UI.ListView({el:$("#spellcheck-suggestions-list"),emptyText:this.noSuggestions,store:new Common.UI.DataViewStore,scrollAlwaysVisible:!0,dataHint:"1",dataHintDirection:"left",dataHintOffset:"big"}),this.btnChange=new Common.UI.Button({parentEl:$("#spellcheck-change"),cls:"btn-text-split-default",caption:this.textChange,split:!0,width:110,disabled:!0,menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:this.textChange,value:0},{caption:this.textChangeAll,value:1}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnIgnore=new Common.UI.Button({parentEl:$("#spellcheck-ignore"),cls:"btn-text-split-default",caption:this.textIgnore,split:!0,width:110,disabled:!0,menu:new Common.UI.Menu({style:"min-width: 110px;",items:[{caption:this.textIgnore,value:0},{caption:this.textIgnoreAll,value:1}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbDictionaryLanguage=new Common.UI.ComboBox({el:$("#spellcheck-dictionary-language"),style:"width: 100%",menuStyle:"width: 100%;max-height: 163px;",editable:!1,cls:"input-group-nr",scroller:{suppressScrollX:!0},search:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.btnToDictionary=new Common.UI.Button({el:$("#spellcheck-add-to-dictionary"),disabled:!0}),this.lblComplete=this.$el.find("#spellcheck-complete"),this.trigger("render:after",this),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".spellcheck-settings-inner"),suppressScrollX:!0,alwaysVisibleY:!0})),$(window).on("resize",_.bind((function(){this.scroller.update({alwaysVisibleY:!0})}),this)),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},ChangeSettings:function(t){},onClickClosePanel:function(){Common.NotificationCenter.trigger("leftmenu:change","hide")},txtSpelling:"Spelling",noSuggestions:"No spelling suggestions",textChange:"Change",textChangeAll:"Change All",textIgnore:"Ignore",textIgnoreAll:"Ignore All",txtAddToDictionary:"Add To Dictionary",txtDictionaryLanguage:"Dictionary Language",txtComplete:"Spellcheck has been complete",txtNextTip:"Go to the next word",txtClosePanel:"Close spelling"},SSE.Views.Spellcheck||{}))})),define("spreadsheeteditor/main/app/controller/Spellcheck",["core","spreadsheeteditor/main/app/view/Spellcheck"],(function(){"use strict";SSE.Controllers.Spellcheck=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Spellcheck"],initialize:function(){var t=this;this.addListeners({Spellcheck:{show:function(){t._initSettings&&t.loadLanguages(),t.updateLanguages(),t.onClickNext()},hide:function(){t.api&&t.api.asc_cancelSpellCheck()}},LeftMenu:{"spellcheck:update":function(){t.updateLanguages()}}})},events:function(){},onLaunch:function(){this.panelSpellcheck=this.createView("Spellcheck",{}),this.panelSpellcheck.on("render:after",_.bind(this.onAfterRender,this)),this._isDisabled=!1,this._initSettings=!0},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onSpellCheckVariantsFound",_.bind(this.onSpellCheckVariantsFound,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this},setMode:function(t){return this.mode=t,this.panelSpellcheck&&this.panelSpellcheck.btnToDictionary.setVisible(t.isDesktopApp),this},onAfterRender:function(t){t.buttonNext.on("click",_.bind(this.onClickNext,this)),t.btnToDictionary.on("click",_.bind(this.onDictionary,this)),t.cmbDictionaryLanguage.on("selected",_.bind(this.onSelectLanguage,this)),t.btnChange.on("click",_.bind(this.onClickChange,this)),t.btnIgnore.on("click",_.bind(this.onClickIgnore,this)),t.btnChange.menu.on("item:click",_.bind(this.onClickChangeMenu,this)),t.btnIgnore.menu.on("item:click",_.bind(this.onClickIgnoreMenu,this))},onClickNext:function(){this.api&&this.api.asc_nextWord(),Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onDictionary:function(){if(this.api){var t=this.panelSpellcheck.currentWord.getValue();t&&this.api.asc_spellCheckAddToDictionary(t)}},SetDisabled:function(t){this._isDisabled=t},setLanguages:function(t){this.languages=t,this._initSettings=!0,this.panelSpellcheck.cmbDictionaryLanguage&&this.panelSpellcheck.cmbDictionaryLanguage.store.length>0&&this.panelSpellcheck.cmbDictionaryLanguage.store.reset()},loadLanguages:function(){var t=this;if(this._initSettings&&Common.Utils.InternalSettings.set("sse-spellcheck-locale",Common.localStorage.getItem("sse-spellcheck-locale")),this.languages&&this.languages.length>0){var e,i=[];this.allLangs=Common.util.LanguageInfo.getLanguages(),this.languages.forEach((function(n){n=parseInt(n),t.allLangs.hasOwnProperty(n)&&(e=t.allLangs[n],i.push({displayValue:e[1],shortName:e[0],value:n}))})),i.sort((function(t,e){return t.shortName<e.shortName?-1:t.shortName>e.shortName?1:0})),this.langs=i}else this.langs=void 0;this._initSettings=!1;var n=0===this.panelSpellcheck.cmbDictionaryLanguage.store.length;return[this.allLangs,this.langs,n]},updateLanguages:function(){var t,e=Common.Utils.InternalSettings.get("sse-spellcheck-locale"),i=!1;t=e?parseInt(e):this.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.mode.lang)):1033;var n=this.panelSpellcheck.cmbDictionaryLanguage;if(this.langs&&this.langs.length>0){0===n.store.length&&(n.setData(this.langs),i=!0);var o=n.store.findWhere({value:t});!o&&this.allLangs[t]&&(t=this.allLangs[t][0].split(/[\-\_]/)[0],o=n.store.find((function(e){return 0==e.get("shortName").indexOf(t)}))),n.setValue(o?o.get("value"):this.langs[0].value),t=n.getValue()}else n.setValue(Common.util.LanguageInfo.getLocalLanguageName(t)[1]),n.setDisabled(!0);i&&this.api&&(this.api.asc_setDefaultLanguage(t),t!==parseInt(e)&&Common.Utils.InternalSettings.set("sse-spellcheck-locale",t),i=!1)},onSelectLanguage:function(t,e){var i=e.value;if(this.api&&i){this.api.asc_setDefaultLanguage(i);var n=this.panelSpellcheck.cmbDictionaryLanguage.getValue();Common.localStorage.setItem("sse-spellcheck-locale",n),Common.Utils.InternalSettings.set("sse-spellcheck-locale",n)}Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickChange:function(t,e){if(this.api){var i=this.panelSpellcheck.suggestionList.getSelectedRec();i&&this.api.asc_replaceMisspelledWord(i.get("value"),this._currentSpellObj)}Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickChangeMenu:function(t,e){if(this.api){var i=this.panelSpellcheck.suggestionList.getSelectedRec();0==e.value?i&&this.api.asc_replaceMisspelledWord(i.get("value"),this._currentSpellObj):1==e.value&&i&&this.api.asc_replaceMisspelledWord(i.get("value"),this._currentSpellObj,!0)}Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickIgnore:function(){this.api&&this.api.asc_ignoreMisspelledWord(this._currentSpellObj,!1),Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickIgnoreMenu:function(t,e){this.api&&(0==e.value?this.api.asc_ignoreMisspelledWord(this._currentSpellObj,!1):1==e.value&&this.api.asc_ignoreMisspelledWord(this._currentSpellObj,!0)),Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onSpellCheckVariantsFound:function(t){if(null!==t||this._currentSpellObj!==t||this.panelSpellcheck&&this.panelSpellcheck.isVisible()){this._currentSpellObj=t;var e,i=[];if(t){e=t.get_Word();var n=t.get_Variants();n&&n.forEach((function(t){var e=new Common.UI.DataViewModel;e.set({value:t}),i.push(e)}))}var o=this.api.isCellEdited;this.panelSpellcheck.currentWord.setValue(e||""),this.panelSpellcheck.suggestionList.store.reset(i),i.length>0&&this.panelSpellcheck.suggestionList.selectByIndex(0),this.panelSpellcheck.currentWord.setDisabled(!e||o),this.panelSpellcheck.btnChange.setDisabled(i.length<1||o),this.panelSpellcheck.btnIgnore.setDisabled(!e||o),this.panelSpellcheck.btnToDictionary.setDisabled(!e||o),this.panelSpellcheck.lblComplete.toggleClass("hidden",!t||!!e),this.panelSpellcheck.buttonNext.setDisabled(!this.panelSpellcheck.lblComplete.hasClass("hidden"))}},onApiEditCell:function(t){t==Asc.c_oAscCellEditorState.editEnd?(this.panelSpellcheck.buttonNext.setDisabled(!this.panelSpellcheck.lblComplete.hasClass("hidden")),this.panelSpellcheck.cmbDictionaryLanguage.setDisabled(!(this.languages&&this.languages.length>0))):(this.panelSpellcheck.buttonNext.setDisabled(!0),this.panelSpellcheck.currentWord.setDisabled(!0),this.panelSpellcheck.btnChange.setDisabled(!0),this.panelSpellcheck.btnIgnore.setDisabled(!0),this.panelSpellcheck.btnToDictionary.setDisabled(!0),this.panelSpellcheck.cmbDictionaryLanguage.setDisabled(!0))}},SSE.Controllers.Spellcheck||{}))})),void 0===Common)var Common={};if(Common.IrregularStack=function(t){var e=[],i=function(t,e){return"object"==typeof t&&"object"==typeof e&&window.JSON?window.JSON.stringify(t)===window.JSON.stringify(e):t===e},n=(t=t||{}).strongCompare||i,o=t.weakCompare||i,s=function(t,i){for(var n=e.length-1;n>=0;n--)if(i(e[n],t))return n;return-1};return{push:function(t){e.push(t)},pop:function(t){var i=s(t,n);if(-1!=i)return e.splice(i,1)[0]},get:function(t){var i="object"==typeof t?s(t,o):t;if(-1!=i)return e[i]},exist:function(t){return!(s(t,n)<0)},length:function(){return e.length}}},define("irregularstack",(function(){})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Fonts",["core","common/main/lib/collection/Fonts"],(function(){"use strict";Common.Controllers.Fonts=Backbone.Controller.extend(function(){function t(t,e){t.showlastused&&function(t,e){for(var i,n=4==e.get("type"),o=-1,s=t.length,a=e.get("name");!n&&++o<s&&4==(i=t.at(o)).get("type");)n=i.get("name")==a}(t.store,e)}function e(t){Common.NotificationCenter.trigger("fonts:change",t)}function i(t,e){var i=[];_.each(t,(function(t){var e=t.asc_getFontId();i.push({id:_.isEmpty(e)?Common.UI.getId():e,name:t.asc_getFontName(),imgidx:t.asc_getFontThumbnail(),type:t.asc_getFontType()})}));var n=this.getCollection("Common.Collections.Fonts");n&&n.add(i),Common.NotificationCenter.trigger("fonts:load",n,e)}return{models:["Common.Models.Fonts"],collections:["Common.Collections.Fonts"],views:[],initialize:function(){Common.NotificationCenter.on("fonts:select",_.bind(t,this))},onLaunch:function(){},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onInitEditorFonts",_.bind(i,this)),this.api.asc_registerCallback("asc_onFontFamily",_.bind(e,this))}}}())})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/TextArt",["backbone"],(function(t){"use strict";Common.Collections.TextArt=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}})})})),define("common/main/lib/view/UserNameDialog",["common/main/lib/component/Window","common/main/lib/component/InputField"],(function(){"use strict";Common.Views.UserNameDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,modal:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div style="margin-bottom: 2px;">'+(this.options.label?this.options.label:this.textLabel)+"</div>",'<div id="id-dlg-username-caption" class="input-row"></div>','<div id="id-dlg-username-chk-use" class="" style="margin-top: 10px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputLabel=new Common.UI.InputField({el:$("#id-dlg-username-caption"),allowBlank:!0,style:"width: 100%;",maxLength:128,validateOnBlur:!1,validation:t.options.validation||function(t){return!!t||""}}),t.inputLabel.setValue(this.options.value||""),t.chDontShow=new Common.UI.CheckBox({el:$("#id-dlg-username-chk-use"),labelText:this.textDontShow,value:this.options.check}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay((function(){t.getChild("input").focus()}),50)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputLabel.checkValidate())return void this.inputLabel.cmpEl.find("input").focus();this.options.handler.call(this,t,{input:this.inputLabel.getValue(),checkbox:"checked"==this.chDontShow.getValue()})}this.close()},textLabel:"Label:",textLabelError:"Label must not be empty.",textDontShow:"Don't ask me again"},Common.Views.UserNameDialog||{}))})),void 0===window.Common&&(window.Common={}),Common.util=Common.util||{},Common.util.LanguageInfo=new function(){var t={54:["af","Afrikaans"],1078:["af-ZA","Afrikaans (Suid Afrika)","Afrikaans (South Africa)"],28:["sq","Shqipe"],1052:["sq-AL","Shqipe (Shqipëria)","Albanian (Albania)"],132:["gsw","Elsässisch"],1156:["gsw-FR","Elsässisch (Frànkrisch)","Alsatian (France)"],94:["am","አማርኛ"],1118:["am-ET","አማርኛ (ኢትዮጵያ)","Amharic (Ethiopia)"],1:["ar","العربية‏"],5121:["ar-DZ","العربية (الجزائر)‏","Arabic (Algeria)"],15361:["ar-BH","العربية (البحرين)‏","Arabic (Bahrain)"],3073:["ar-EG","العربية (مصر)‏","Arabic (Egypt)"],2049:["ar-IQ","العربية (العراق)‏","Arabic (Iraq)"],11265:["ar-JO","العربية (الأردن)‏","Arabic (Jordan)"],13313:["ar-KW","العربية (الكويت)‏","Arabic (Kuwait)"],12289:["ar-LB","العربية (لبنان)‏","Arabic (Lebanon)"],4097:["ar-LY","العربية (ليبيا)‏","Arabic (Libya)"],6145:["ar-MA","العربية (المملكة المغربية)‏","Arabic (Morocco)"],8193:["ar-OM","العربية (عمان)‏","Arabic (Oman)"],16385:["ar-QA","العربية (قطر)‏","Arabic (Qatar)"],1025:["ar-SA","العربية (المملكة العربية السعودية)‏","Arabic (Saudi Arabia)"],10241:["ar-SY","العربية (سوريا)‏","Arabic (Syria)"],7169:["ar-TN","العربية (تونس)‏","Arabic (Tunisia)"],14337:["ar-AE","العربية (الإمارات العربية المتحدة)‏","Arabic (U.A.E.)"],9217:["ar-YE","العربية (اليمن)‏","Arabic (Yemen)"],43:["hy","Հայերեն"],1067:["hy-AM","Հայերեն (Հայաստան)","Armenian (Armenia)"],77:["as","অসমীয়া"],1101:["as-IN","অসমীয়া (ভাৰত)","Assamese (India)"],44:["az","Azərbaycan­ılı"],29740:["az-Cyrl","Азәрбајҹан дили"],2092:["az-Cyrl-AZ","Азәрбајҹан (Азәрбајҹан)","Azeri (Cyrillic, Azerbaijan)"],30764:["az-Latn","Azərbaycan­ılı"],1068:["az-Latn-AZ","Azərbaycan­ılı (Azərbaycan)","Azeri (Latin, Azerbaijan)"],109:["ba","Башҡорт"],1133:["ba-RU","Башҡорт (Россия)","Bashkir (Russia)"],45:["eu","Euskara"],1069:["eu-ES","Euskara (Euskara)","Basque (Basque)"],35:["be","Беларускі"],1059:["be-BY","Беларускі (Беларусь)","Belarusian (Belarus)"],69:["bn","বাংলা"],2117:["bn-BD","বাংলা (বাংলাদেশ)","Bengali (Bangladesh)"],1093:["bn-IN","বাংলা (ভারত)","Bengali (India)"],30746:["bs","bosanski"],25626:["bs-Cyrl","Босански (Ћирилица)"],8218:["bs-Cyrl-BA","Босански (Босна и Херцеговина)","Bosnian (Cyrillic) (Bosnia and Herzegovina)"],26650:["bs-Latn","Bosanski (Latinica)"],5146:["bs-Latn-BA","Bosanski (Bosna i Hercegovina)","Bosnian (Latin) (Bosnia and Herzegovina)"],126:["br","Brezhoneg"],1150:["br-FR","Brezhoneg (Frañs)","Breton (France)"],2:["bg","Български"],1026:["bg-BG","Български (България)","Bulgarian (Bulgaria)"],3:["ca","Català"],1027:["ca-ES","Català (Català)","Catalan (Catalan)"],2051:["ca-ES-valencia","Català (Valencià)","Catalan (Valencia)"],30724:["zh","中文"],4:["zh-Hans","中文(简体)","Chinese (Simplified)"],2052:["zh-CN","中文(中华人民共和国)","Chinese (People's Republic of China)"],4100:["zh-SG","中文(新加坡)","Chinese (Simplified, Singapore)"],31748:["zh-Hant","中文(繁體)","Chinese (Traditional)"],3076:["zh-HK","中文(香港特別行政區)","Chinese (Traditional, Hong Kong S.A.R.)"],5124:["zh-MO","中文(澳門特別行政區)","Chinese (Traditional, Macao S.A.R.)"],1028:["zh-TW","中文(台灣)","Chinese (Traditional, Taiwan)"],131:["co","Corsu"],1155:["co-FR","Corsu (France)","Corsican (France)"],26:["hr","Hrvatski"],1050:["hr-HR","Hrvatski (Hrvatska)","Croatian (Croatia)"],4122:["hr-BA","Hrvatski (Bosna i Hercegovina)","Croatian (Bosnia and Herzegovina)"],5:["cs","Čeština"],1029:["cs-CZ","Čeština (Česká republika)","Czech (Czech Republic)"],6:["da","Dansk"],1030:["da-DK","Dansk (Danmark)","Danish (Denmark)"],140:["prs","درى‏"],1164:["prs-AF","درى (افغانستان)‏","Dari (Afghanistan)"],101:["dv","ދިވެހިބަސް‏"],1125:["dv-MV","ދިވެހިބަސް (ދިވެހި ރާއްޖެ)‏","Divehi (Maldives)"],19:["nl","Nederlands"],2067:["nl-BE","Nederlands (België)","Dutch (Belgium)"],1043:["nl-NL","Nederlands (Nederland)","Dutch (Netherlands)"],9:["en","English"],3081:["en-AU","English (Australia)","English (Australia)"],10249:["en-BZ","English (Belize)","English (Belize)"],4105:["en-CA","English (Canada)","English (Canada)"],9225:["en-029","English (Caribbean)","English (Caribbean)"],16393:["en-IN","English (India)","English (India)"],6153:["en-IE","English (Ireland)","English (Ireland)"],8201:["en-JM","English (Jamaica)","English (Jamaica)"],17417:["en-MY","English (Malaysia)","English (Malaysia)"],5129:["en-NZ","English (New Zealand)","English (New Zealand)"],13321:["en-PH","English (Philippines)","English (Philippines)"],18441:["en-SG","English (Singapore)","English (Singapore)"],7177:["en-ZA","English (South Africa)","English (South Africa)"],11273:["en-TT","English (Trinidad y Tobago)","English (Trinidad y Tobago)"],2057:["en-GB","English (United Kingdom)","English (United Kingdom)"],1033:["en-US","English (United States)","English (United States)"],12297:["en-ZW","English (Zimbabwe)","English (Zimbabwe)"],15369:["en-HK","English (Hong Kong)","English (Hong Kong)"],14345:["en-ID","English (Indonesia)","English (Indonesia)"],37:["et","Eesti"],1061:["et-EE","Eesti (Eesti)","Estonian (Estonia)"],56:["fo","Føroyskt"],1080:["fo-FO","Føroyskt (Føroyar)","Faroese (Faroe Islands)"],100:["fil","Filipino"],1124:["fil-PH","Filipino (Pilipinas)","Filipino (Philippines)"],11:["fi","Suomi"],1035:["fi-FI","Suomi (Suomi)","Finnish (Finland)"],12:["fr","Français"],2060:["fr-BE","Français (Belgique)","French (Belgium)"],3084:["fr-CA","Français (Canada)","French (Canada)"],1036:["fr-FR","Français (France)","French (France)"],5132:["fr-LU","Français (Luxembourg)","French (Luxembourg)"],6156:["fr-MC","Français (Principauté de Monaco)","French (Principality of Monaco)"],4108:["fr-CH","Français (Suisse)","French (Switzerland)"],15372:["fr-HT","Français (Haïti)","French (Haiti)"],9228:["fr-CG","Français (Congo-Brazzaville)","French (Congo)"],12300:["fr-CI","Français (Côte d’Ivoire)","French (Cote d'Ivoire)"],11276:["fr-CM","Français (Cameroun)","French (Cameroon)"],14348:["fr-MA","Français (Maroc)","French (Morocco)"],13324:["fr-ML","Français (Mali)","French (Mali)"],8204:["fr-RE","Français (La Réunion)","French (Reunion)"],10252:["fr-SN","Français (Sénégal)","French (Senegal)"],7180:["fr-West","French"],98:["fy","Frysk"],1122:["fy-NL","Frysk (Nederlân)","Frisian (Netherlands)"],86:["gl","Galego"],1110:["gl-ES","Galego (Galego)","Galician (Galician)"],55:["ka","ქართული"],1079:["ka-GE","ქართული (საქართველო)","Georgian (Georgia)"],7:["de","Deutsch"],3079:["de-AT","Deutsch (Österreich)","German (Austria)"],1031:["de-DE","Deutsch (Deutschland)","German (Germany)"],5127:["de-LI","Deutsch (Liechtenstein)","German (Liechtenstein)"],4103:["de-LU","Deutsch (Luxemburg)","German (Luxembourg)"],2055:["de-CH","Deutsch (Schweiz)","German (Switzerland)"],8:["el","Ελληνικά"],1032:["el-GR","Ελληνικά (Ελλάδα)","Greek (Greece)"],111:["kl","Kalaallisut"],1135:["kl-GL","Kalaallisut (Kalaallit Nunaat)","Greenlandic (Greenland)"],71:["gu","ગુજરાતી"],1095:["gu-IN","ગુજરાતી (ભારત)","Gujarati (India)"],104:["ha","Hausa"],31848:["ha-Latn","Hausa (Latin)"],1128:["ha-Latn-NG","Hausa (Nigeria)","Hausa (Latin) (Nigeria)"],13:["he","עברית‏"],1037:["he-IL","עברית (ישראל)‏","Hebrew (Israel)"],57:["hi","हिंदी"],1081:["hi-IN","हिंदी (भारत)","Hindi (India)"],14:["hu","Magyar"],1038:["hu-HU","Magyar (Magyarország)","Hungarian (Hungary)"],15:["is","Íslenska"],1039:["is-IS","Íslenska (Ísland)","Icelandic (Iceland)"],112:["ig","Igbo"],1136:["ig-NG","Igbo (Nigeria)","Igbo (Nigeria)"],33:["id","Bahasa Indonesia"],1057:["id-ID","Bahasa Indonesia (Indonesia)","Indonesian (Indonesia)"],93:["iu","Inuktitut"],31837:["iu-Latn","Inuktitut (Qaliujaaqpait)"],2141:["iu-Latn-CA","Inuktitut (Kanatami) (kanata)","Inuktitut (Latin) (Canada)"],30813:["iu-Cans","ᐃᓄᒃᑎᑐᑦ (ᖃᓂᐅᔮᖅᐸᐃᑦ)"],1117:["iu-Cans-CA","ᐃᓄᒃᑎᑐᑦ (ᑲᓇᑕᒥ)","Inuktitut (Canada)"],60:["ga","Gaeilge"],2108:["ga-IE","Gaeilge (Éire)","Irish (Ireland)"],52:["xh","isiXhosa"],1076:["xh-ZA","isiXhosa (uMzantsi Afrika)","isiXhosa (South Africa)"],53:["zu","isiZulu"],1077:["zu-ZA","isiZulu (iNingizimu Afrika)","isiZulu (South Africa)"],16:["it","Italiano"],1040:["it-IT","Italiano (Italia)","Italian (Italy)"],2064:["it-CH","Italiano (Svizzera)","Italian (Switzerland)"],17:["ja","日本語"],1041:["ja-JP","日本語 (日本)","Japanese (Japan)"],75:["kn","ಕನ್ನಡ"],1099:["kn-IN","ಕನ್ನಡ (ಭಾರತ)","Kannada (India)"],63:["kk","Қазақ"],1087:["kk-KZ","Қазақ (Қазақстан)","Kazakh (Kazakhstan)"],83:["km","ខ្មែរ"],1107:["km-KH","ខ្មែរ (កម្ពុជា)","Khmer (Cambodia)"],134:["qut","K'iche"],1158:["qut-GT","K'iche (Guatemala)","K'iche (Guatemala)"],135:["rw","Kinyarwanda"],1159:["rw-RW","Kinyarwanda (Rwanda)","Kinyarwanda (Rwanda)"],65:["sw","Kiswahili"],1089:["sw-KE","Kiswahili (Kenya)","Kiswahili (Kenya)"],87:["kok","कोंकणी"],1111:["kok-IN","कोंकणी (भारत)","Konkani (India)"],18:["ko","한국어"],1042:["ko-KR","한국어 (대한민국)","Korean (Korea)"],64:["ky","Кыргыз"],1088:["ky-KG","Кыргыз (Кыргызстан)","Kyrgyz (Kyrgyzstan)"],84:["lo","ລາວ"],1108:["lo-LA","ລາວ (ສ.ປ.ປ. ລາວ)","Lao (Lao P.D.R.)"],38:["lv","Latviešu"],1062:["lv-LV","Latviešu (Latvija)","Latvian (Latvia)"],39:["lt","Lietuvių"],1063:["lt-LT","Lietuvių (Lietuva)","Lithuanian (Lithuania)"],31790:["dsb","Dolnoserbšćina"],2094:["dsb-DE","Dolnoserbšćina (Nimska)","Lower Sorbian (Germany)"],110:["lb","Lëtzebuergesch"],1134:["lb-LU","Lëtzebuergesch (Luxembourg)","Luxembourgish (Luxembourg)"],1071:["mk-MK","Македонски јазик (Македонија)","Macedonian (Former Yugoslav Republic of Macedonia)"],47:["mk","Македонски јазик"],62:["ms","Bahasa Melayu"],2110:["ms-BN","Bahasa Melayu (Brunei Darussalam)","Malay (Brunei Darussalam)"],1086:["ms-MY","Bahasa Melayu (Malaysia)","Malay (Malaysia)"],76:["ml","മലയാളം"],1100:["ml-IN","മലയാളം (ഭാരതം)","Malayalam (India)"],58:["mt","Malti"],1082:["mt-MT","Malti (Malta)","Maltese (Malta)"],129:["mi","Reo Māori"],1153:["mi-NZ","Reo Māori (Aotearoa)","Maori (New Zealand)"],122:["arn","Mapudungun"],1146:["arn-CL","Mapudungun (Chile)","Mapudungun (Chile)"],78:["mr","मराठी"],1102:["mr-IN","मराठी (भारत)","Marathi (India)"],124:["moh","Kanien'kéha"],1148:["moh-CA","Kanien'kéha (Canada)","Mohawk (Canada)"],80:["mn","Монгол хэл"],30800:["mn-Cyrl","Монгол хэл"],1104:["mn-MN","Монгол хэл (Монгол улс)","Mongolian (Cyrillic, Mongolia)"],31824:["mn-Mong","ᠮᠤᠨᠭᠭᠤᠯ ᠬᠡᠯᠡ"],2128:["mn-Mong-CN","ᠮᠤᠨᠭᠭᠤᠯ ᠬᠡᠯᠡ (ᠪᠦᠭᠦᠳᠡ ᠨᠠᠢᠷᠠᠮᠳᠠᠬᠤ ᠳᠤᠮᠳᠠᠳᠤ ᠠᠷᠠᠳ ᠣᠯᠣᠰ)","Mongolian (Traditional Mongolian) (People's Republic of China)"],97:["ne","नेपाली"],1121:["ne-NP","नेपाली (नेपाल)","Nepali (Nepal)"],2145:["ne-IN","नेपाली (भारत)","Nepali (India)"],20:["no","Norsk"],31764:["nb","Norsk (bokmål)"],1044:["nb-NO","Norsk, bokmål (Norge)","Norwegian, Bokmål (Norway)"],30740:["nn","Norsk (Nynorsk)"],2068:["nn-NO","Norsk, nynorsk (Noreg)","Norwegian, Nynorsk (Norway)"],130:["oc","Occitan"],1154:["oc-FR","Occitan (França)","Occitan (France)"],72:["or","ଓଡ଼ିଆ"],1096:["or-IN","ଓଡ଼ିଆ (ଭାରତ)","Oriya (India)"],99:["ps","پښتو‏"],1123:["ps-AF","پښتو (افغانستان)‏","Pashto (Afghanistan)"],41:["fa","فارسى‏"],1065:["fa-IR","فارسى (ایران)‏","Persian (Iran)"],21:["pl","Polski"],1045:["pl-PL","Polski (Polska)","Polish (Poland)"],22:["pt","Português"],1046:["pt-BR","Português (Brasil)","Portuguese (Brazil)"],2070:["pt-PT","Português (Portugal)","Portuguese (Portugal)"],70:["pa","ਪੰਜਾਬੀ"],1094:["pa-IN","ਪੰਜਾਬੀ (ਭਾਰਤ)","Punjabi (India)"],107:["quz","Runasimi"],1131:["quz-BO","Runasimi (Qullasuyu)","Quechua (Bolivia)"],2155:["quz-EC","Runasimi (Ecuador)","Quechua (Ecuador)"],3179:["quz-PE","Runasimi (Piruw)","Quechua (Peru)"],24:["ro","Română"],1048:["ro-RO","Română (România)","Romanian (Romania)"],2072:["ro-MD","Română (Moldova)","Romanian (Republic of Moldova)"],23:["rm","Rumantsch"],1047:["rm-CH","Rumantsch (Svizra)","Romansh (Switzerland)"],25:["ru","Русский"],1049:["ru-RU","Русский (Россия)","Russian (Russia)"],2073:["ru-MD","Русский (Молдавия)","Russian (Republic of Moldova)"],28731:["smn","Sämikielâ"],9275:["smn-FI","Sämikielâ (Suomâ)","Sami (Inari) (Finland)"],31803:["smj","Julevusámegiella"],4155:["smj-NO","Julevusámegiella (Vuodna)","Sami (Lule) (Norway)"],5179:["smj-SE","Julevusámegiella (Svierik)","Sami (Lule) (Sweden)"],59:["se","Davvisámegiella"],3131:["se-FI","Davvisámegiella (Suopma)","Sami (Northern) (Finland)"],1083:["se-NO","Davvisámegiella (Norga)","Sami (Northern) (Norway)"],2107:["se-SE","Davvisámegiella (Ruoŧŧa)","Sami (Northern) (Sweden)"],29755:["sms","Sääm´ǩiõll"],8251:["sms-FI","Sääm´ǩiõll (Lää´ddjânnam)","Sami (Skolt) (Finland)"],30779:["sma","åarjelsaemiengiele"],6203:["sma-NO","åarjelsaemiengiele (Nöörje)","Sami (Southern) (Norway)"],7227:["sma-SE","åarjelsaemiengiele (Sveerje)","Sami (Southern) (Sweden)"],79:["sa","संस्कृत"],1103:["sa-IN","संस्कृत (भारतम्)","Sanskrit (India)"],145:["gd","Gàidhlig"],1169:["gd-GB","Gàidhlig (An Rìoghachd Aonaichte)","Scottish Gaelic (United Kingdom)"],31770:["sr","Srpski"],27674:["sr-Cyrl","Српски (Ћирилица)"],7194:["sr-Cyrl-BA","Српски (Босна и Херцеговина)","Serbian (Cyrillic) (Bosnia and Herzegovina)"],12314:["sr-Cyrl-ME","Српски (Црна Гора)","Serbian (Cyrillic, Montenegro)"],3098:["sr-Cyrl-CS","Српски (Србија и Црна Гора (Претходно))","Serbian (Cyrillic, Serbia and Montenegro (Former))"],10266:["sr-Cyrl-RS","Српски (Србија)","Serbian (Cyrillic, Serbia)"],28698:["sr-Latn","Srpski (Latinica)"],6170:["sr-Latn-BA","Srpski (Bosna i Hercegovina)","Serbian (Latin, Bosnia and Herzegovina)"],11290:["sr-Latn-ME","Srpski (Crna Gora)","Serbian (Latin, Montenegro)"],2074:["sr-Latn-CS","Srpski (Srbija i Crna Gora (Prethodno))","Serbian (Latin, Serbia and Montenegro (Former))"],9242:["sr-Latn-RS","Srpski (Srbija, Latinica)","Serbian (Latin, Serbia)"],108:["nso","Sesotho sa Leboa"],1132:["nso-ZA","Sesotho sa Leboa (Afrika Borwa)","Sesotho sa Leboa (South Africa)"],50:["tn","Setswana"],1074:["tn-ZA","Setswana (Aforika Borwa)","Setswana (South Africa)"],91:["si","සිංහ"],1115:["si-LK","සිංහ (ශ්‍රී ලංකා)","Sinhala (Sri Lanka)"],27:["sk","Slovenčina"],1051:["sk-SK","Slovenčina (Slovenská republika)","Slovak (Slovakia)"],36:["sl","Slovenski"],1060:["sl-SI","Slovenski (Slovenija)","Slovenian (Slovenia)"],10:["es","Español"],11274:["es-AR","Español (Argentina)","Spanish (Argentina)"],16394:["es-BO","Español (Bolivia)","Spanish (Bolivia)"],13322:["es-CL","Español (Chile)","Spanish (Chile)"],9226:["es-CO","Español (Colombia)","Spanish (Colombia)"],5130:["es-CR","Español (Costa Rica)","Spanish (Costa Rica)"],7178:["es-DO","Español (República Dominicana)","Spanish (Dominican Republic)"],12298:["es-EC","Español (Ecuador)","Spanish (Ecuador)"],17418:["es-SV","Español (El Salvador)","Spanish (El Salvador)"],4106:["es-GT","Español (Guatemala)","Spanish (Guatemala)"],18442:["es-HN","Español (Honduras)","Spanish (Honduras)"],2058:["es-MX","Español (México)","Spanish (Mexico)"],19466:["es-NI","Español (Nicaragua)","Spanish (Nicaragua)"],6154:["es-PA","Español (Panamá)","Spanish (Panama)"],15370:["es-PY","Español (Paraguay)","Spanish (Paraguay)"],10250:["es-PE","Español (Perú)","Spanish (Peru)"],20490:["es-PR","Español (Puerto Rico)","Spanish (Puerto Rico)"],3082:["es-ES","Español (España, alfabetización internacional)","Spanish (Spain)"],21514:["es-US","Español (Estados Unidos)","Spanish (United States)"],14346:["es-UY","Español (Uruguay)","Spanish (Uruguay)"],8202:["es-VE","Español (Republica Bolivariana de Venezuela)","Spanish (Venezuela)"],1034:["es-ES_tradnl","Spanish"],22538:["es-419","Español (América Latina y el Caribe)","Spanish (Latin America and the Caribbean)"],23562:["es-CU","Español (Cuba)","Spanish (Cuba)"],29:["sv","Svenska"],2077:["sv-FI","Svenska (Finland)","Swedish (Finland)"],1053:["sv-SE","Svenska (Sverige)","Swedish (Sweden)"],90:["syr","ܣܘܪܝܝܐ‏"],1114:["syr-SY","ܣܘܪܝܝܐ (سوريا)‏","Syriac (Syria)"],40:["tg","Тоҷикӣ"],31784:["tg-Cyrl","Тоҷикӣ"],1064:["tg-Cyrl-TJ","Тоҷикӣ (Тоҷикистон)","Tajik (Cyrillic) (Tajikistan)"],95:["tzm","Tamazight"],31839:["tzm-Latn","Tamazight (Latin)"],2143:["tzm-Latn-DZ","Tamazight (Djazaïr)","Tamazight (Latin) (Algeria)"],73:["ta","தமிழ்"],1097:["ta-IN","தமிழ் (இந்தியா)","Tamil (India)"],68:["tt","Татар"],1092:["tt-RU","Татар (Россия)","Tatar (Russia)"],74:["te","తెలుగు"],1098:["te-IN","తెలుగు (భారత దేశం)","Telugu (India)"],30:["th","ไทย"],1054:["th-TH","ไทย (ไทย)","Thai (Thailand)"],81:["bo","བོད་ཡིག"],1105:["bo-CN","བོད་ཡིག (ཀྲུང་ཧྭ་མི་དམངས་སྤྱི་མཐུན་རྒྱལ་ཁབ།)","Tibetan (People's Republic of China)"],2129:["bo-BT","Tibetan (Bhutan)","Tibetan (Bhutan)"],31:["tr","Türkçe"],1055:["tr-TR","Türkçe (Türkiye)","Turkish (Turkey)"],66:["tk","Türkmençe"],1090:["tk-TM","Türkmençe (Türkmenistan)","Turkmen (Turkmenistan)"],34:["uk","Українська"],1058:["uk-UA","Українська (Україна)","Ukrainian (Ukraine)"],46:["hsb","Hornjoserbšćina"],1070:["hsb-DE","Hornjoserbšćina (Němska)","Upper Sorbian (Germany)"],32:["ur","اُردو‏"],1056:["ur-PK","اُردو (پاکستان)‏","Urdu (Islamic Republic of Pakistan)"],2080:["ur-IN","اُردو (بھارت)‏","Urdu (India)"],128:["ug","ئۇيغۇر يېزىقى‏"],1152:["ug-CN","(ئۇيغۇر يېزىقى (جۇڭخۇا خەلق جۇمھۇرىيىتى‏","Uighur (People's Republic of China)"],30787:["uz-Cyrl","Ўзбек"],2115:["uz-Cyrl-UZ","Ўзбек (Ўзбекистон)","Uzbek (Cyrillic, Uzbekistan)"],67:["uz","U'zbek"],31811:["uz-Latn","U'zbek"],1091:["uz-Latn-UZ","U'zbek (U'zbekiston Respublikasi)","Uzbek (Latin, Uzbekistan)"],42:["vi","Tiếng Việt"],1066:["vi-VN","Tiếng Việt (Việt Nam)","Vietnamese (Vietnam)"],82:["cy","Cymraeg"],1106:["cy-GB","Cymraeg (y Deyrnas Unedig)","Welsh (United Kingdom)"],136:["wo","Wolof"],1160:["wo-SN","Wolof (Sénégal)","Wolof (Senegal)"],133:["sah","Саха"],1157:["sah-RU","Саха (Россия)","Yakut (Russia)"],120:["ii","ꆈꌠꁱꂷ"],1144:["ii-CN","ꆈꌠꁱꂷ (ꍏꉸꏓꂱꇭꉼꇩ)","Yi (People's Republic of China)"],106:["yo","Yoruba"],1130:["yo-NG","Yoruba (Nigeria)","Yoruba (Nigeria)"],1126:["bin-NG","Bini (Nigeria)","Bini (Nigeria)"],1116:["chr-US","ᏣᎳᎩ (ᏌᏊ ᎢᏳᎾᎵᏍᏔᏅ ᏍᎦᏚᎩ)","Cherokee (United States)"],1127:["fuv-NG","Nigerian Fulfulde (Nigeria)","Nigerian Fulfulde (Nigeria)"],1138:["gaz-ET","West Central Oromo (Ethiopia)","West Central Oromo (Ethiopia)"],1140:["gn-PY","Guarani (Paraguay)","Guarani (Paraguay)"],1141:["haw-US","ʻŌlelo Hawaiʻi (ʻAmelika Hui Pū ʻIa)","Hawaiian (United States)"],1129:["ibb-NG","Ibibio (Nigeria)","Ibibio (Nigeria)"],1137:["kr-NG","Kanuri (Nigeria)","Kanuri (Nigeria)"],1112:["mni","Manipuri","Manipuri"],1109:["my-MM","Burmese (Myanmar)","Burmese (Myanmar)"],1145:["pap-AN","Papiamento, Netherlands Antilles","Papiamento, Netherlands Antilles"],2118:["pa-PK","Panjabi (Pakistan)","Panjabi (Pakistan)"],1165:["plt-MG","Plateau Malagasy (Madagascar)","Plateau Malagasy (Madagascar)"],1113:["sd-IN","Sindhi (India)","Sindhi (India)"],2137:["sd-PK","Sindhi (Pakistan)","Sindhi (Pakistan)"],1143:["so-SO","Soomaali (Soomaaliya)","Somali (Somalia)"],1072:["st-ZA","Southern Sotho (South Africa)","Southern Sotho (South Africa)"],1139:["ti-ER","ትግርኛ (ኤርትራ)","Tigrinya (Eritrea)"],2163:["ti-ET","ትግርኛ (ኢትዮጵያ)","Tigrinya (Ethiopia)"],1119:["tmz","Tamanaku"],3167:["tmz-MA","Tamaziɣt n laṭlaṣ (Meṛṛuk)","Tamanaku (Morocco)"],1073:["ts-ZA","Tsonga (South Africa)","Tsonga (South Africa)"],1075:["ven-ZA","South Africa","South Africa"]};return{getLocalLanguageName:function(e){return t[e]||["",e]},getLocalLanguageCode:function(e){if(e)for(var i in t)if(t[i][0].toLowerCase()===e.toLowerCase())return i;return null},getLanguages:function(){return t}}},define("common/main/lib/util/LanguageInfo",(function(){})),define("spreadsheeteditor/main/app/model/ShapeGroup",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.ShapeModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}}),SSE.Models.ShapeGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})})),define("spreadsheeteditor/main/app/collection/ShapeGroups",["backbone","spreadsheeteditor/main/app/model/ShapeGroup"],(function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},SSE.Collections.ShapeGroups=t.Collection.extend({model:SSE.Models.ShapeGroup})})),define("spreadsheeteditor/main/app/model/EquationGroup",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.EquationModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),data:null,width:0,height:0,posX:0,posY:0}}}),SSE.Models.EquationGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})})),define("spreadsheeteditor/main/app/collection/EquationGroups",["backbone","spreadsheeteditor/main/app/model/EquationGroup"],(function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},SSE.Collections.EquationGroups=t.Collection.extend({model:SSE.Models.EquationGroup})})),define("spreadsheeteditor/main/app/collection/ConditionalFormatIcons",["backbone"],(function(t){"use strict";SSE.Collections.ConditionalFormatIcons=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,icon:null}}})}),SSE.Collections.ConditionalFormatIconsPresets=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),data:0,icons:null}}})})})),define("spreadsheeteditor/main/app/model/Formula",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.FormulaModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,group:null,name:null,origin:null,args:null}}}),SSE.Models.FormulaGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,name:null,store:null,functions:[]}}})})),define("spreadsheeteditor/main/app/collection/FormulaGroups",["backbone","spreadsheeteditor/main/app/model/Formula"],(function(t){"use strict";SSE.Collections=SSE.Collections||{},SSE.Collections.FormulaGroups=t.Collection.extend({model:SSE.Models.FormulaGroup})})),define("spreadsheeteditor/main/app/view/FormulaDialog",["common/main/lib/component/Window","spreadsheeteditor/main/app/collection/FormulaGroups"],(function(){"use strict";SSE.Views=SSE.Views||{},SSE.Views.FormulaDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e=this,i={};_.extend(i,{width:375,height:490,header:!0,cls:"formula-dlg",contentTemplate:"",title:e.txtTitle,items:[],buttons:null},t),this.template=t.template||['<div class="box" style="height:'+(i.height-85)+'px;">','<div class="content-panel" >','<div id="formula-dlg-search" style="height:22px; margin-bottom:10px;"></div>','<label class="header">'+e.textGroupDescription+"</label>",'<div id="formula-dlg-combo-group" class="input-group-nr" style=""></div>','<label class="header" style="margin-top: 10px">'+e.textListDescription+"</label>",'<div id="formula-dlg-combo-functions" class="combo-functions"></div>','<label id="formula-dlg-args" style="margin-top: 7px"></label>','<label id="formula-dlg-desc" style="margin-top: 4px; display: block;"></label>',"</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer center">','<button id="formula-dlg-btn-ok" class="btn normal dlg-btn primary" result="ok" style="width: 86px;">'+this.okButtonText+"</button>",'<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+this.cancelButtonText+"</button>","</div>"].join(""),this.api=t.api,this.formulasGroups=t.formulasGroups,this.handler=t.handler,i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this));var t=this;this.inputSearch=new Common.UI.InputField({el:$("#formula-dlg-search",this.$window),allowBlank:!0,placeHolder:this.txtSearch,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(e,i){i.length?(i=i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),t.filter=i.toLowerCase()):t.filter=void 0,t.filterFormulas()})),this.btnOk=new Common.UI.Button({el:$("#formula-dlg-btn-ok")}),this.syntaxLabel=$("#formula-dlg-args"),this.descLabel=$("#formula-dlg-desc"),this.fillFormulasGroups()},getFocusedComponents:function(){return[this.inputSearch,this.cmbFuncGroup,this.cmbListFunctions]},getDefaultFocusableComponent:function(){return this.inputSearch},show:function(t){if(this.$window){var e,i,n,o,s=this.initConfig.height;void 0===window.innerHeight?(e=document.documentElement.offsetWidth,i=document.documentElement.offsetHeight):(e=Common.Utils.innerWidth(),i=Common.Utils.innerHeight()),n=(parseInt(i,10)-parseInt(s,10))/2,o=(parseInt(e,10)-parseInt(this.initConfig.width,10))/2,this.$window.css("left",Math.floor(o)),this.$window.css("top",Math.floor(n))}Common.UI.Window.prototype.show.call(this),t&&this.cmbFuncGroup.setValue(t),(t||"Last10"==this.cmbFuncGroup.getValue())&&this.fillFunctions(this.cmbFuncGroup.getValue()),this.inputSearch.setValue(""),this._preventCloseCellEditor=!1},hide:function(){var t=this.cmbFuncGroup.getValue();"Recommended"==t&&(t="Last10"),this.cmbFuncGroup.store.length>0&&"Recommended"==this.cmbFuncGroup.store.at(0).get("value")&&(this.cmbFuncGroup.store.shift(),this.cmbFuncGroup.onResetItems()),this.cmbFuncGroup.setValue(t),this.recommended=this.filter=void 0,Common.UI.Window.prototype.hide.call(this),!this._preventCloseCellEditor&&this.api.asc_closeCellEditor(!0)},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onDblClickFunction:function(){this._handleInput("ok")},onSelectGroup:function(t,e){_.isUndefined(e)||_.isUndefined(e.value)||e.value&&this.fillFunctions(e.value),this.onUpdateFocus()},onSelectFunction:function(t,e,i){this.formulasGroups&&i&&(this.applyFunction={name:i.get("value"),origin:i.get("origin")},this.syntaxLabel.text(this.applyFunction.name+i.get("args")),this.descLabel.text(i.get("desc")))},onPrimary:function(t,e,i){this._handleInput("ok")},_handleInput:function(t){if(this.handler&&"ok"==t){if(this.btnOk.isDisabled())return;this._preventCloseCellEditor=!0,this.handler.call(this,this.applyFunction)}this.hide()},onUpdateFocus:function(){this.cmbListFunctions&&_.delay((function(t){t.cmbListFunctions.focus()}),100,this)},fillFormulasGroups:function(){if(this.formulasGroups){var t=Common.Utils.InternalSettings.get("sse-settings-func-locale");_.isEmpty(t)&&(t="en");var e,i=[],n=this.formulasGroups.length;for(e=0;e<n;++e){var o;(o=this.formulasGroups.at(e)).get("functions").length&&i.push({value:o.get("name"),displayValue:o.get("caption")})}this.cmbFuncGroup?this.cmbFuncGroup.setData(i):(this.cmbFuncGroup=new Common.UI.ComboBox({el:$("#formula-dlg-combo-group"),menuStyle:"min-width: 100%;",cls:"input-group-nr",data:i,editable:!1,takeFocusOnClose:!0}),this.cmbFuncGroup.on("selected",_.bind(this.onSelectGroup,this))),this.cmbFuncGroup.setValue("Last10"),this.fillFunctions("Last10"),this.allFunctions=new Common.UI.DataViewStore,(o=this.formulasGroups.findWhere({name:"All"}))&&this.allFunctions.reset(o.get("functions"))}},fillFunctions:function(t){if(this.formulasGroups&&(this.cmbListFunctions||this.functions||(this.functions=new Common.UI.DataViewStore,this.cmbListFunctions=new Common.UI.ListView({el:$("#formula-dlg-combo-functions"),store:this.functions,tabindex:1,cls:"dbl-clickable"}),this.cmbListFunctions.on("item:select",_.bind(this.onSelectFunction,this)),this.cmbListFunctions.on("item:dblclick",_.bind(this.onDblClickFunction,this)),this.cmbListFunctions.on("entervalue",_.bind(this.onPrimary,this)),this.cmbListFunctions.onKeyDown=_.bind(this.onKeyDown,this),this.onUpdateFocus()),this.functions)){this.functions.reset();var e=null;if("Recommended"==t)e=this.recommended;else{var i=this.formulasGroups.findWhere({name:t});i&&(e=i.get("functions"))}for(var n=e?e.length:0,o=0;o<n;++o)this.functions.push(new Common.UI.DataViewModel({id:e[o].get("index"),selected:o<1,allowSelected:!0,value:e[o].get("name"),args:e[o].get("args"),desc:e[o].get("desc"),origin:e[o].get("origin")}));this.applyFunction=n?{name:e[0].get("name"),origin:e[0].get("origin")}:void 0,this.syntaxLabel.text(n?this.applyFunction.name+e[0].get("args"):""),this.descLabel.text(n?e[0].get("desc"):""),this.cmbListFunctions.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}),this.btnOk.setDisabled(!n)}},filterFormulas:function(){if(!this.filter)return this.cmbFuncGroup.setValue("Last10"),void this.fillFunctions("Last10");var t=this,e=new RegExp(t.filter,"ig"),i=this.allFunctions.filter((function(t){return!!t.get("name").match(e)}));if(i.length>0){"Recommended"!=this.cmbFuncGroup.store.at(0).get("value")&&(this.cmbFuncGroup.store.unshift({value:"Recommended",displayValue:this.txtRecommended}),this.cmbFuncGroup.onResetItems());var n=_.findIndex(i,(function(e){return e.get("name").toLowerCase()===t.filter}));if(n>0){var o=i.splice(n,1);i.unshift(o[0])}}else 0==i.length&&this.cmbFuncGroup.store.length>0&&"Recommended"==this.cmbFuncGroup.store.at(0).get("value")&&(this.cmbFuncGroup.store.shift(),this.cmbFuncGroup.onResetItems());this.cmbFuncGroup.setValue("Recommended"),this.recommended=i,this.fillFunctions("Recommended")},onKeyDown:function(t,e){var i=0,n=null,o=this,s=this.cmbListFunctions,a="",l="",r=null,c=null,d=!1,h=null;if(!s.disabled){if(_.isUndefined(void 0)&&(e=t),a=t.key,t.keyCode>64&&t.keyCode<91&&a&&a.length){for(a=a.toLocaleLowerCase(),(h=s.store.findWhere({selected:!0}))&&(d=(l=h.get("value"))&&l.length&&l[0].toLocaleLowerCase()===a),i=0;i<s.store.length;++i)if((l=(n=s.store.at(i)).get("value"))[0].toLocaleLowerCase()===a){if(null===r&&(r=n),d){h===n&&(d=!1);continue}if(n.get("selected"))continue;return void p(n)}if(r)return void p(r)}Common.UI.DataView.prototype.onKeyDown.call(s,t,e)}function p(t){s.selectRecord(t),o.onScrollToRecordCustom.call(s,t),c=$(s.el).find(".inner"),s.scroller.scrollTop(c.scrollTop(),0),e.preventDefault(),e.stopPropagation()}},onScrollToRecordCustom:function(t){var e=$(this.el).find(".inner"),i=e.offset().top,n=e.find("#"+t.get("id")).parent(),o=n.offset().top;(o<i||o+n.height()>i+e.height())&&(this.scroller?this.scroller.scrollTop(e.scrollTop()+o-i,0):e.scrollTop(e.scrollTop()+o-i))},textGroupDescription:"Select Function Group",textListDescription:"Select Function",sDescription:"Description",txtTitle:"Insert Function",txtSearch:"Search",txtRecommended:"Recommended"},SSE.Views.FormulaDialog||{}))})),define("spreadsheeteditor/main/app/view/FormulaTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(){"use strict";SSE.Views.FormulaTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.btnAutosum.on("click",(function(){t.fireEvent("function:apply",[{name:t.api.asc_getFormulaLocaleName("SUM"),origin:"SUM"},!0])})),t.btnAutosum.menu.on("item:click",(function(e,i,n){t.fireEvent("function:apply",[{name:i.caption,origin:i.value},!0])})),t.btnFormula.on("click",(function(){t.fireEvent("function:apply",[{name:"more",origin:"more"}])})),t.btnCalculate.on("click",(function(){t.fireEvent("function:calculate",[{type:Asc.c_oAscCalculateType.All}])})),t.btnCalculate.menu.on("item:click",(function(e,i,n){t.fireEvent("function:calculate",[{type:i.value}])})),t.btnNamedRange.menu.on("show:after",(function(e){t.fireEvent("function:namedrange-open",[e])})),t.btnNamedRange.menu.on("item:click",(function(e,i,n){t.fireEvent("function:namedrange",[e,i,n])}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.formulasGroups=t.formulasGroups,this.lockedControls=[],this.formulaControls=[];var e=this,i=e.toolbar.$el,n=Common.enumLock,o=SSE.getController("FormulaDialog");this.btnFinancial=new Common.UI.Button({parentEl:i.find("#slot-btn-financial"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-finance",caption:o.sCategoryFinancial,hint:o.sCategoryFinancial,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnFinancial),this.formulaControls.push(this.btnFinancial),this.btnLogical=new Common.UI.Button({parentEl:i.find("#slot-btn-logical"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-logic",caption:o.sCategoryLogical,hint:o.sCategoryLogical,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnLogical),this.formulaControls.push(this.btnLogical),this.btnTextData=new Common.UI.Button({parentEl:i.find("#slot-btn-text"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-func-text",caption:o.sCategoryTextAndData,hint:o.sCategoryTextAndData,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnTextData),this.formulaControls.push(this.btnTextData),this.btnDateTime=new Common.UI.Button({parentEl:i.find("#slot-btn-datetime"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-datetime",caption:o.sCategoryDateAndTime,hint:o.sCategoryDateAndTime,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnDateTime),this.formulaControls.push(this.btnDateTime),this.btnReference=new Common.UI.Button({parentEl:i.find("#slot-btn-lookup"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-lookup",caption:o.sCategoryLookupAndReference,hint:o.sCategoryLookupAndReference,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnReference),this.formulaControls.push(this.btnReference),this.btnMath=new Common.UI.Button({parentEl:i.find("#slot-btn-math"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-func-math",caption:o.sCategoryMathematic,hint:o.sCategoryMathematic,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnMath),this.formulaControls.push(this.btnMath),this.btnRecent=new Common.UI.Button({parentEl:i.find("#slot-btn-recent"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-recent",caption:this.txtRecent,hint:this.txtRecent,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnRecent),this.formulaControls.push(this.btnRecent),this.btnAutosum=new Common.UI.Button({parentEl:i.find("#slot-btn-autosum"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-autosum",caption:this.txtAutosum,hint:[this.txtAutosumTip+Common.Utils.String.platformKey("Alt+="),this.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")],split:!0,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth],menu:new Common.UI.Menu({items:[{caption:"SUM",value:"SUM"},{caption:"AVERAGE",value:"AVERAGE"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:e.txtAdditional,value:"more",hint:e.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnAutosum),this.formulaControls.push(this.btnAutosum),this.btnFormula=new Common.UI.Button({parentEl:i.find("#slot-btn-additional-formula"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ins-formula",caption:this.txtFormula,hint:this.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3"),disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnFormula),this.formulaControls.push(this.btnFormula),this.btnMore=new Common.UI.Button({parentEl:i.find("#slot-btn-more"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-more",caption:this.txtMore,hint:this.txtMore,menu:!0,split:!1,disabled:!0,lock:[n.editText,n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.selSlicer,n.selRangeEdit,n.lostConnect,n.coAuth,n.noSubitems],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnMore),this.formulaControls.push(this.btnMore),this.btnCalculate=new Common.UI.Button({parentEl:i.find("#slot-btn-calculate"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-calculation",caption:this.txtCalculation,split:!0,menu:!0,disabled:!0,lock:[n.editCell,n.selRangeEdit,n.lostConnect,n.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCalculate),this.formulaControls.push(this.btnCalculate),this.btnNamedRange=new Common.UI.Button({parentEl:i.find("#slot-btn-named-range-huge"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-named-range",caption:this.toolbar.txtNamedRange,hint:this.toolbar.txtNamedRange,split:!1,disabled:!0,lock:[n.selChart,n.selChartText,n.selShape,n.selShapeText,n.selImage,n.lostConnect,n.coAuth,n.selRangeEdit,n.wsLock],menu:new Common.UI.Menu({items:[{caption:e.toolbar.txtManageRange,lock:[n.editCell],value:"manage"},{caption:e.toolbar.txtNewRange,lock:[n.editCell],value:"new"},{caption:e.toolbar.txtPasteRange,value:"paste"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnNamedRange),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnCalculate.updateHint([i.tipCalculateTheEntireWorkbook+Common.Utils.String.platformKey("F9"),i.tipCalculate]);var e=new Common.UI.Menu({items:[{caption:i.textCalculateWorkbook,value:Asc.c_oAscCalculateType.All},{caption:i.textCalculateCurrentSheet,value:Asc.c_oAscCalculateType.ActiveSheet}]});i.btnCalculate.setMenu(e),t.call(i)}))},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return"formula"==t?this.formulaControls:"range"==t?this.btnNamedRange:this.lockedControls},SetDisabled:function(t){this.lockedControls&&this.lockedControls.forEach((function(e){e&&e.setDisabled(t)}),this)},setButtonMenu:function(t,e){var i,n=this,o=[],s=n.formulasGroups.findWhere({name:e});if(s){var a=s.get("functions");a&&a.forEach((function(t){o.push(new Common.UI.MenuItem({caption:t.get("name"),value:t.get("origin")}))}))}o.length&&(t.menu&&t.menu.rendered?(i=t.menu._innerMenu)&&(i.removeAll(),o.forEach((function(t){i.addItem(t)}))):(t.setMenu(new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-formula-menu-'+e+'" style="display: flex;" class="open"></div>')},{caption:"--"},{caption:n.txtAdditional,value:"more",hint:n.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")}]})),t.menu.items[2].on("click",(function(t,i){n.fireEvent("function:apply",[{name:t.caption,origin:t.value},!1,e])})),t.menu.on("show:after",(function(t,e){t._innerMenu.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t._innerMenu&&t._innerMenu.cmpEl.focus()}),10)})),(i=new Common.UI.Menu({maxHeight:300,cls:"internal-menu",items:o,outerMenu:{menu:t.menu,index:0}})).render(t.menu.items[0].cmpEl.children(":first")),i.cmpEl.css({display:"block",position:"relative",left:0,top:0}),i.cmpEl.attr({tabindex:"-1"}),i.on("item:click",(function(t,i,o){n.fireEvent("function:apply",[{name:i.caption,origin:i.value},!1,e])})),t.menu._innerMenu=i,t.menu.setInnerMenu([{menu:i,index:0}])));Common.Utils.lockControls(Common.enumLock.noSubitems,o.length<1,{array:[t]})},setMenuItemMenu:function(t){var e=this,i=[],n=SSE.getController("FormulaDialog"),o=e.formulasGroups.findWhere({name:t});if(o){var s=o.get("functions");if(s&&s.forEach((function(t){i.push(new Common.UI.MenuItem({caption:t.get("name"),value:t.get("origin")}))})),i.length){var a=new Common.UI.MenuItem({caption:n["sCategory"+t]||t,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="id-toolbar-formula-menu-'+t+'" style="display: flex;" class="open"></div>')},{caption:"--"},{caption:e.txtAdditional,value:"more",hint:e.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")}]})});a.menu.items[2].on("click",(function(i,n){e.fireEvent("function:apply",[{name:i.caption,origin:i.value},!1,t])})),a.menu.on("show:after",(function(t,e){t._innerMenu.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t._innerMenu&&t._innerMenu.items[0].cmpEl.find("> a").focus()}),10)})).on("keydown:before",(function(t,e){if(e.keyCode==Common.UI.Keys.LEFT||e.keyCode==Common.UI.Keys.ESC){var i=t.cmpEl.parent();i.hasClass("dropdown-submenu")&&i.hasClass("over")&&(i.removeClass("over"),i.find("> a").focus())}}));var l=new Common.UI.Menu({maxHeight:300,cls:"internal-menu",items:i,outerMenu:{menu:a.menu,index:0}});return l.on("item:click",(function(i,n,o){e.fireEvent("function:apply",[{name:n.caption,origin:n.value},!1,t])})),a.menu._innerMenu=l,a.menu.setInnerMenu([{menu:l,index:0}]),a}}},fillFunctions:function(){if(this.formulasGroups){this.setButtonMenu(this.btnFinancial,"Financial"),this.setButtonMenu(this.btnLogical,"Logical"),this.setButtonMenu(this.btnTextData,"TextAndData"),this.setButtonMenu(this.btnDateTime,"DateAndTime"),this.setButtonMenu(this.btnReference,"LookupAndReference"),this.setButtonMenu(this.btnMath,"Mathematic"),this.setButtonMenu(this.btnRecent,"Last10");for(var t=this.btnAutosum.menu.items,e=0;e<Math.min(4,t.length);e++)this.api&&t[e].setCaption(this.api.asc_getFormulaLocaleName(t[e].value));var i=this,n=[];["Cube","Database","Engineering","Information","Statistical"].forEach((function(t){var e=i.setMenuItemMenu(t);e&&n.push(e)}));var o=this.btnMore;n.length&&(o.menu&&o.menu.rendered?(o.menu.removeAll(),n.forEach((function(t){o.menu.addItem(t)}))):o.setMenu(new Common.UI.Menu({items:n})),o.menu.items.forEach((function(t){var e=t.menu.items[0].cmpEl.children(":first"),i=t.menu._innerMenu;i.render(e),i.cmpEl.css({display:"block",position:"relative",left:0,top:0}),i.cmpEl.attr({tabindex:"-1"})}))),Common.Utils.lockControls(Common.enumLock.noSubitems,n.length<1,{array:[o]})}},updateRecent:function(){this.formulasGroups&&this.setButtonMenu(this.btnRecent,"Last10")},setApi:function(t){this.api=t},txtRecent:"Recently used",txtAutosum:"Autosum",txtAutosumTip:"Summation",txtAdditional:"Insert Function",txtFormula:"Function",txtFormulaTip:"Insert function",txtMore:"More functions",txtCalculation:"Calculation",tipCalculate:"Calculate",textCalculateWorkbook:"Calculate workbook",textCalculateCurrentSheet:"Calculate current sheet",textAutomatic:"Automatic",textManual:"Manual",tipCalculateTheEntireWorkbook:"Calculate the entire workbook"}}(),SSE.Views.FormulaTab||{}))})),define("spreadsheeteditor/main/app/view/FormulaWizard",["common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner"],(function(){"use strict";SSE.Views.FormulaWizard=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:580,height:397},initialize:function(t){_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;"><div class="inner-content">','<div class="settings-panel active">','<table style="height:'+(this.options.height-85-7)+'px;">',"<tr><td>",'<label id="formula-wizard-name" style="display: block;margin-bottom: 8px;"></label>','<div id="formula-wizard-panel-args" style="">','<div style="overflow: hidden;position: relative;">','<table cols="3" id="formula-wizard-tbl-args" style="width: 100%;">',"</table>","</div>",'<div style="margin-top: 4px;">','<label id="formula-wizard-lbl-func-res">'+this.textFunctionRes+"</label>",'<div id="formula-wizard-lbl-val-func" class="input-label" style="float: right; width: 200px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"></div>',"</div>","</div>","</td></tr>",'<tr><td style="height:100%;padding-bottom: 12px;"></td></tr>',"<tr><td>",'<div id="formula-wizard-panel-desc" style="word-break: break-word;">','<label id="formula-wizard-args" style="display: block;margin-bottom: 0px;"></label>','<label id="formula-wizard-desc" style="display: block;margin-bottom: 8px;"></label>','<label id="formula-wizard-value" style="display: block;margin-bottom: 8px;"><b>Formula result:</b></label>','<label style="display: block; margin-bottom: 8px;"><a id="formula-wizard-help" style="cursor: pointer;">'+this.textHelp+"</a></label>","</div>","</td></tr>","</table>","</div></div>","</div>","</div>",'<div class="separator horizontal"></div>'].join("")},t),this.props=this.options.props,this.funcprops=this.options.funcprops,this.api=this.options.api,this.lang=this.options.lang,this._noApply=!1,this.args=[],this.argsNames=[],this.repeatedIdx=1,this.repeatedArg=void 0,this.helpUrl=void 0,this.minArgCount=1,this.maxArgCount=1,this.minArgWidth=50,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this.getChild();t.find("input").on("keypress",_.bind(this.onKeyPress,this)),this.contentPanel=t.find(".content-panel"),this.innerPanel=t.find(".inner-content"),this.panelArgs=t.find("#formula-wizard-panel-args"),this.tableArgs=t.find("#formula-wizard-tbl-args"),this.panelDesc=t.find("#formula-wizard-panel-desc"),this.lblArgDesc=t.find("#formula-wizard-arg-desc"),this.lblFormulaResult=t.find("#formula-wizard-value"),this.lblFunctionResult=t.find("#formula-wizard-lbl-val-func"),this._preventCloseCellEditor=!1,this.afterRender()},afterRender:function(){this._setDefaults()},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,"ok"==t?this.getSettings():void 0),this._preventCloseCellEditor="ok"==t,this.close()},onDlgBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onKeyPress:function(t){t.keyCode==Common.UI.Keys.RETURN&&this._handleInput("ok")},onPrimary:function(){return this._handleInput("ok"),!1},_setDefaults:function(){var t=this;this.funcprops&&((e=this.funcprops).args?$("#formula-wizard-args").html("<b>"+e.name+"</b>"+e.args):$("#formula-wizard-args").addClass("hidden"),e.desc?$("#formula-wizard-desc").text(e.desc):$("#formula-wizard-desc").addClass("hidden"),e.name?$("#formula-wizard-name").html(this.textFunction+": "+e.name):$("#formula-wizard-name").addClass("hidden"),this.parseArgsDesc(e.args),this.$window.find("#formula-wizard-help").on("click",(function(e){t.showHelp()})));if(this.recalcArgTableSize(),this.minArgWidth=this.$window.find("#formula-wizard-lbl-func-res").width(),this.props){var e=this.props;this.minArgCount=e.asc_getArgumentMin(),this.maxArgCount=e.asc_getArgumentMax();var i=e.asc_getFunctionResult();this.lblFunctionResult.html("= "+(null!=i?i:"")),i=e.asc_getFormulaResult(),this.lblFormulaResult.html("<b>"+this.textValue+": </b>"+(null!=i?i:""));var n=e.asc_getArgumentsResult(),o=e.asc_getArgumentsType(),s=e.asc_getArgumentsValue();if(o){for(var a=0;a<o.length;a++){var l=o[a],r=[];"object"==typeof l?(this.repeatedArg=l,this.fillRepeatedNames(),r=l):r.push(l),this.fillArgs(r,s,n)}if(s&&this.args.length<s.length&&this.repeatedArg)for(;this.args.length<s.length;)this.fillArgs(this.repeatedArg,s,n);this.scrollerY.update(),this.scrollerY.scrollTop(0)}}this.args.length<1?(this.panelArgs.text(this.textNoArgs),this.lblArgDesc.addClass("hidden")):(1==this.args.length&&this.repeatedArg&&this.repeatedArg.length<this.maxArgCount&&(this.fillArgs(this.repeatedArg),this.scrollerY.update()),_.delay((function(){t._noApply=!0,t.args[0].argInput.focus(),t._noApply=!1}),100))},recalcArgTableSize:function(){var t=this.panelDesc.outerHeight();t=this.$window.find(".box").height()-7-t-54,t=30*parseInt(t/30),this.tableArgs.parent().css("max-height",t),this.scrollerY?this.scrollerY.update():this.scrollerY=new Common.UI.Scroller({el:this.tableArgs.parent(),minScrollbarLength:20,alwaysVisibleY:!0})},checkDescriptionSize:function(){this.contentPanel.height()<this.innerPanel.height()&&this.recalcArgTableSize()},parseArgsDesc:function(t){"("==t.charAt(0)&&(t=t.substring(1)),")"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1));var e=t.split(this.api.asc_getFunctionArgumentSeparator());e.forEach((function(t,i){var n=t.trim();"["==n.charAt(0)&&(n=n.substring(1)),"]"==n.charAt(n.length-1)&&(n=n.substring(0,n.length-1)),n=n.trim(),e[i]=n.charAt(0).toUpperCase().concat(n.substring(1))})),this.argsNames=e},fillRepeatedNames:function(){if(!(this.argsNames.length<1)&&this.repeatedArg&&this.repeatedArg.length>0&&"..."===this.argsNames[this.argsNames.length-1]){this.argsNames.length,this.repeatedArg.length;for(var t=0;t<this.repeatedArg.length;t++){var e=this.argsNames[this.argsNames.length-2-t],i=e.charAt(e.length-1);"123456789".indexOf(i)>-1&&(this.repeatedIdx=parseInt(i),this.argsNames[this.argsNames.length-2-t]=e.substring(0,e.length-1))}}},getArgumentName:function(t){var e="",i=this.argsNames.length;if((!this.repeatedArg||this.repeatedArg.length<1)&&t<i&&"..."!==this.argsNames[t])e=this.argsNames[t];else if(this.repeatedArg&&this.repeatedArg.length>0&&"..."===this.argsNames[i-1]){var n=this.repeatedArg.length,o=i-1-n;if(t<o)e=this.argsNames[t];else{var s=n-(t-o)%n,a=Math.floor((t-o)/n)+this.repeatedIdx;e=this.argsNames[i-1-s]+a}}else e=this.textArgument+(this.maxArgCount>1?" "+(t+1):"");return e},fillArgs:function(t,e,i){for(var n=this.args.length,o=0;o<t.length;o++)this.setControls(n,t[o],e?e[n]:void 0,i?i[n]:void 0),n++},setControls:function(t,e,i,n){var o=this,s='<tr><td style="padding-right: 10px;padding-bottom: 8px;vertical-align: middle;"><div id="formula-wizard-lbl-name-arg{0}" style="min-width:'+this.minArgWidth+'px;white-space: nowrap;margin-top: 1px;"></div></td><td style="padding-right: 5px;padding-bottom: 8px;width: 100%;vertical-align: middle;"><div id="formula-wizard-txt-arg{0}"></div></td><td style="padding-bottom: 8px;vertical-align: middle;"><div id="formula-wizard-lbl-val-arg{0}" class="input-label" style="margin-top: 1px;width: 200px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"></div></td></tr>',a=$(Common.Utils.String.format(s,t));this.tableArgs.append(a);var l=new Common.UI.InputFieldBtn({el:a.find("#formula-wizard-txt-arg"+t),index:t,validateOnChange:!0,validateOnBlur:!1}).on("changed:after",(function(t,e,i,n){})).on("changing",(function(t,e,i,n){e!=i&&o.onInputChanging(t,e,i)})).on("button:click",_.bind(this.onSelectData,this));l.setValue(null!=i?i:""),l._input.on("focus",_.bind(this.onSelectArgument,this,l)),o.args.push({index:t,lblName:a.find("#formula-wizard-lbl-name-arg"+t),lblValue:a.find("#formula-wizard-lbl-val-arg"+t),argInput:l,argName:o.getArgumentName(t),argType:e,argTypeName:o.getArgType(e)}),t<o.minArgCount?o.args[t].lblName.html("<b>"+o.args[t].argName+"</b>"):o.args[t].lblName.html(o.args[t].argName),o.args[t].lblValue.html("= "+(null!=n?n:'<span style="opacity: 0.6; font-weight: bold;">'+o.args[t].argTypeName+"</span>")),Common.UI.FocusManager.add(this,l)},onInputChanging:function(t,e,i,n){var o=this,s=t.options.index,a=o.args[s],l=o.api.asc_insertArgumentsInFormula(o.getArgumentsValue(),s,a.argType,this.funcprops?this.funcprops.origin:void 0),r=l?l.asc_getArgumentsResult():void 0;r=r?r[s]:void 0,a.lblValue.html("= "+(null!=r?r:'<span style="opacity: 0.6; font-weight: bold;">'+a.argTypeName+"</span>"));var c=l?l.asc_getFunctionResult():void 0;o.lblFunctionResult.html("= "+(null!=c?c:"")),c=l?l.asc_getFormulaResult():void 0,o.lblFormulaResult.html("<b>"+o.textValue+": </b>"+(null!=c?c:""))},getArgumentsValue:function(){for(var t=[],e=!0,i=this.args.length-1;i>=0;i--){var n=this.args[i].argInput.getValue();e&&(e=!n),!e&&(t[i]=n)}return t},getArgType:function(t){var e="";switch(t){case Asc.c_oAscFormulaArgumentType.number:e=this.textNumber;break;case Asc.c_oAscFormulaArgumentType.text:e=this.textText;break;case Asc.c_oAscFormulaArgumentType.reference:e=this.textRef;break;case Asc.c_oAscFormulaArgumentType.any:e=this.textAny;break;case Asc.c_oAscFormulaArgumentType.logical:e=this.textLogical}return e},onSelectArgument:function(t){var e=t.options.index,i=this.args[e];i.argDesc?this.lblArgDesc.html("<b>"+i.argName+": </b>"+i.argDesc):this.lblArgDesc.addClass("hidden"),!this._noApply&&e==this.args.length-1&&this.repeatedArg&&e+this.repeatedArg.length<this.maxArgCount&&(this.fillArgs(this.repeatedArg),this.scrollerY.update()),this.checkDescriptionSize()},onSelectData:function(t){this.onSelectArgument(t);var e=this;if(e.api){var i=t.getValue(),n=new SSE.Views.CellRangeDialog({allowBlank:!0,handler:function(t,e){"ok"==e&&(i=t.getSettings())}}).on("close",(function(){t.setValue(i),e.onInputChanging(t),e.show(),_.delay((function(){e._noApply=!0,t.focus(),e._noApply=!1}),1)})),o=e.$window.offset();e.hide(),n.show(o.left+65,o.top+77),n.setSettings({api:e.api,range:_.isEmpty(t.getValue())?"":t.getValue(),type:Asc.c_oAscSelectionDialogType.Function,selection:{start:t._input[0].selectionStart,end:t._input[0].selectionEnd},argvalues:e.getArgumentsValue(),argindex:t.options.index})}},showHelp:function(){if(null==this.helpUrl){if(!this.funcprops||!this.funcprops.origin)return void(this.helpUrl=null);var t=Common.Utils.InternalSettings.get("sse-settings-func-help");t||(t=this.lang?this.lang.split(/[\-\_]/)[0]:"en");var e=this,i="/Functions/"+this.funcprops.origin.toLocaleLowerCase().replace(/\./g,"-")+".htm",n="resources/help/"+t+i;fetch(n).then((function(o){o.ok?(Common.Utils.InternalSettings.set("sse-settings-func-help",t),e.helpUrl=n,e.showHelp()):(n="resources/help/"+(t="en")+i,fetch(n).then((function(i){i.ok?(Common.Utils.InternalSettings.set("sse-settings-func-help",t),e.helpUrl=n,e.showHelp()):e.helpUrl=null})))}))}else this.helpUrl&&window.open(this.helpUrl)},getSettings:function(){return{}},close:function(){Common.Views.AdvancedSettingsWindow.prototype.close.call(this),this.api.asc_closeCellEditor(!this._preventCloseCellEditor)},textTitle:"Function Argumens",textValue:"Formula result",textFunctionRes:"Function result",textFunction:"Function",textHelp:"Help on this function",textNoArgs:"This function has no arguments",textArgument:"Argument",textNumber:"number",textText:"text",textRef:"reference",textAny:"any",textLogical:"logical"},SSE.Views.FormulaWizard||{}))})),define("spreadsheeteditor/main/app/controller/FormulaDialog",["core","spreadsheeteditor/main/app/collection/FormulaGroups","spreadsheeteditor/main/app/view/FormulaDialog","spreadsheeteditor/main/app/view/FormulaTab","spreadsheeteditor/main/app/view/FormulaWizard"],(function(){"use strict";SSE.Controllers=SSE.Controllers||{},SSE.Controllers.FormulaDialog=Backbone.Controller.extend(_.extend({models:[],views:["FormulaDialog","FormulaTab"],collections:["FormulaGroups"],initialize:function(){var t=this;t.langJson={},t.langDescJson={},this.addListeners({FileMenu:{"settings:apply":function(){t.needUpdateFormula=!0;var e=Common.localStorage.getItem("sse-settings-func-locale");Common.Utils.InternalSettings.set("sse-settings-func-locale",e),t.formulasGroups.reset(),t.reloadTranslations(e)}},FormulaTab:{"function:apply":this.applyFunction,"function:calculate":this.onCalculate},Toolbar:{"function:apply":this.applyFunction,"tab:active":this.onTabActive}})},applyFunction:function(t,e,i){t&&("more"===t.origin?this.showDialog(i):(e?this.api.asc_insertInCell(t.name,Asc.c_oAscPopUpSelectorType.Func,!!e):this.api.asc_startWizard(t.name,this._cleanCell),!e&&this.updateLast10Formulas(t.origin)))},setConfig:function(t){return this.toolbar=t.toolbar,this.formulaTab=this.createView("FormulaTab",{toolbar:this.toolbar.toolbar,formulasGroups:this.formulasGroups}),this},setApi:function(t){if(this.api=t,this.formulasGroups){if(Common.Utils.InternalSettings.set("sse-settings-func-last",Common.localStorage.getItem("sse-settings-func-last")),this.reloadTranslations(Common.localStorage.getItem("sse-settings-func-locale")||this.appOptions.lang,!0),!this.mode.isEdit)return;var e=this;this.formulas=new SSE.Views.FormulaDialog({api:this.api,toolclose:"hide",formulasGroups:this.formulasGroups,handler:_.bind(this.applyFunction,this)}),this.formulas.on({hide:function(){e._cleanCell=void 0,e.api.asc_enableKeyEvents(!0)}})}return this.formulaTab&&this.formulaTab.setApi(this.api),this.api.asc_registerCallback("asc_onSendFunctionWizardInfo",_.bind(this.onSendFunctionWizardInfo,this)),this},setMode:function(t){return this.mode=t,this},onLaunch:function(){this.formulasGroups=this.getApplication().getCollection("FormulaGroups"),SSE.Collections.formulasLangs=["en","be","bg","ca","zh","cs","da","nl","fi","fr","de","el","hu","id","it","ja","ko","lv","lo","nb","pl","pt-br","pt","ro","ru","sk","sl","sv","es","tr","uk","vi"];Common.Gateway.on("init",this.loadConfig.bind(this))},loadConfig:function(t){this.appOptions={},this.appOptions.lang=t.config.lang},reloadTranslations:function(t,e){t=(t||"en").toLowerCase();var i=_.indexOf(SSE.Collections.formulasLangs,t);i<0&&(t=t.split(/[\-_]/)[0],i=_.indexOf(SSE.Collections.formulasLangs,t)),t=i>=0?SSE.Collections.formulasLangs[i]:"en";var n=this;Common.Utils.InternalSettings.set("sse-settings-func-locale",t),n.langJson[t]?(n.api.asc_setLocalization(n.langJson[t]),Common.NotificationCenter.trigger("formula:settings",this)):"en"==t?(n.api.asc_setLocalization(void 0),Common.NotificationCenter.trigger("formula:settings",this)):Common.Utils.loadConfig("resources/formula-lang/"+t+".json",(function(e){"error"!=e&&(n.langJson[t]=e,n.api.asc_setLocalization(e),Common.NotificationCenter.trigger("formula:settings",this))})),this.mode.isEdit&&(n.langDescJson[t]?n.loadingFormulas(n.langDescJson[t],e):Common.Utils.loadConfig("resources/formula-lang/"+t+"_desc.json",(function(i){"error"!=i?(n.langDescJson[t]=i,n.loadingFormulas(i,e)):Common.Utils.loadConfig("resources/formula-lang/en_desc.json",(function(i){n.langDescJson[t]="error"!=i?i:null,n.loadingFormulas(n.langDescJson[t],e)}))})))},getDescription:function(t){return t?(t=t.toLowerCase(),this.langDescJson[t]?this.langDescJson[t]:null):""},showDialog:function(t,e){this.formulas&&(this.needUpdateFormula&&(this.needUpdateFormula=!1,this.formulas.$window&&this.formulas.fillFormulasGroups()),this._formulagroup=t,this._cleanCell=e,this.api.asc_startWizard())},onSendFunctionWizardInfo:function(t){if(t){var e=t.asc_getName(),i=this.api.asc_getFormulaNameByLocale(e),n=this.getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")),o={name:e,origin:i,args:(n&&n[i]?n[i].a:"").replace(/[,;]/g,this.api.asc_getFunctionArgumentSeparator()),desc:n&&n[i]?n[i].d:""};new SSE.Views.FormulaWizard({api:this.api,lang:this.appOptions.lang,funcprops:o,props:t,handler:function(t,e,i){}}).show(),this._cleanCell=void 0}else this.formulas.show(this._formulagroup);this._formulagroup=void 0},hideDialog:function(){this.formulas&&this.formulas.isVisible()&&this.formulas.hide()},updateLast10Formulas:function(t){var e=Common.Utils.InternalSettings.get("sse-settings-func-last")||"SUM;AVERAGE;IF;HYPERLINK;COUNT;MAX;SIN;SUMIF;PMT;STDEV";e=e.split(";");var i=_.indexOf(e,t);e.splice(i<0?e.length-1:i,1),e.unshift(t);var n=e.join(";");if(Common.localStorage.setItem("sse-settings-func-last",n),Common.Utils.InternalSettings.set("sse-settings-func-last",n),this.formulasGroups){var o=this.formulasGroups.findWhere({name:"Last10"});o&&o.set("functions",this.loadingLast10Formulas(this.getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")))),this.formulaTab&&this.formulaTab.updateRecent()}},loadingLast10Formulas:function(t){for(var e=(Common.Utils.InternalSettings.get("sse-settings-func-last")||"SUM;AVERAGE;IF;HYPERLINK;COUNT;MAX;SIN;SUMIF;PMT;STDEV").split(";"),i=this.api.asc_getFunctionArgumentSeparator(),n=[],o=0;o<e.length;o++){var s=e[o];n.push(new SSE.Models.FormulaModel({index:o,group:"Last10",name:this.api.asc_getFormulaLocaleName(s),origin:s,args:(t&&t[s]?t[s].a:"").replace(/[,;]/g,i),desc:t&&t[s]?t[s].d:""}))}return n},loadingFormulas:function(t,e){var i,n,o,s=0,a=0,l=this.formulasGroups,r=null,c=0,d=0,h=null,p=[],m=null,u=null,g=this.api.asc_getFunctionArgumentSeparator();if(l&&(i="Last10",(u=new SSE.Models.FormulaGroup({name:i,index:c,store:l,caption:this["sCategory"+i]||i}))&&(u.set("functions",this.loadingLast10Formulas(t)),l.push(u),c+=1),i="All",(m=new SSE.Models.FormulaGroup({name:i,index:c,store:l,caption:this["sCategory"+i]||i}))&&(l.push(m),c+=1),m)){for(h=this.api.asc_getFormulasInfo(),s=0;s<h.length;s+=1){for(i=h[s].asc_getGroupName(),n=h[s].asc_getFormulasArray(),r=new SSE.Models.FormulaGroup({name:i,index:c,store:l,caption:this["sCategory"+i]||i}),c+=1,o=[],a=0;a<n.length;a+=1){var f=n[a].asc_getName(),b=new SSE.Models.FormulaModel({index:d,group:i,name:n[a].asc_getLocaleName(),origin:f,args:(t&&t[f]?t[f].a:"").replace(/[,;]/g,g),desc:t&&t[f]?t[f].d:""});d+=1,o.push(b),p.push(b)}r.set("functions",_.sortBy(o,(function(t){return t.get("name")}))),l.push(r)}m.set("functions",_.sortBy(p,(function(t){return t.get("name")})))}(!e||this._formulasInited)&&this.formulaTab&&this.formulaTab.fillFunctions()},onTabActive:function(t){"formula"==t&&!this._formulasInited&&this.formulaTab&&(this.formulaTab.fillFunctions(),this._formulasInited=!0)},onCalculate:function(t){var e=t.type;e!==Asc.c_oAscCalculateType.All&&e!==Asc.c_oAscCalculateType.ActiveSheet||this.api&&this.api.asc_calculate(e)},sCategoryAll:"All",sCategoryLast10:"10 last used",sCategoryLogical:"Logical",sCategoryCube:"Cube",sCategoryDatabase:"Database",sCategoryDateAndTime:"Date and time",sCategoryEngineering:"Engineering",sCategoryFinancial:"Financial",sCategoryInformation:"Information",sCategoryLookupAndReference:"Lookup and reference",sCategoryMathematic:"Math and trigonometry",sCategoryStatistical:"Statistical",sCategoryTextAndData:"Text and data"},SSE.Controllers.FormulaDialog||{}))})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.HintManager=new function(){var t,e,i,n="en",o=[],s=[],a=[],l=[],r=!1,c=!1,d=0,h=document,p=[],m=[],u="",g=!1,f=!1,b=!1,C=!1,v=[],x={btnhome:"K"},y=function(t,e){e?h=e:"esc"!==t?h=C?[$(window.parent.document).find(".advanced-settings-dlg:visible")[0],window.document]:$("#file-menu-panel").is(":visible")?$("#file-menu-panel"):t&&t.closest(".hint-section")||document:0===d&&(h=document)},w=function(t){i&&(f=t,i.asc_enableKeyEvents(!t))},S=function(){u="",0===d&&Common.NotificationCenter.trigger("toolbar:collapse"),(0===m.length||$("#file-menu-panel").is(":visible")&&1===d)&&D(),m.length>0?(!f&&w(!0),c=!0,m.forEach((function(t){t.show()})),t=setInterval((function(){u.length>0&&(u="")}),5e3)):c=!1,Common.NotificationCenter.trigger("hints:show",c,d)},A=function(){c=!1,m&&m.forEach((function(t){t.remove()})),clearInterval(t),Common.NotificationCenter.trigger("hints:show",!1)},k=function(t){P(),m.length=0,p.length=0,void 0!==t?d=t:d++},T=function(t){var e=t;if(-1===o.indexOf(e)){var i=s.indexOf(e);e=o[i]}return e},I=function(t){return t.hasClass("disabled")||t.parent().hasClass("disabled")||t.attr("disabled")},E=function(){p=[],v=[];var t=[],e=[];_.isArray(h)?h.forEach((function(i){t=t.concat($(i).find("[data-hint="+d+"]").toArray()),e=e.concat($(i).find("[data-hint-title][data-hint="+d+"]").toArray())})):(t=$(h).find("[data-hint="+d+"]").toArray(),e=$(h).find("[data-hint-title][data-hint="+d+"]").toArray());var i=t.filter((function(t){return $(t).is(":visible")})),a=e.filter((function(t){return $(t).is(":visible")}));if(i.length!==a.length){var l=[],r=[];if(0===d)for(var c in x){var m=x[c].toLowerCase();v.push(m),r.push(o.indexOf(m))}i.length>o.length?(a.forEach((function(t){var e=$(t).data("hint-title").toLowerCase();e=T(e),v.push(e)})),l=function(t){for(var e,i,n=o.slice(),s=0;o.length,!e;s++)-1===v.indexOf(o[s])&&(e=o[s],i=s);for(n[i]=e+o[0],s=0;n.length<t;s++)e+o[s]!==n[i]&&n.push(e+o[s]);return n}(i.length+(0===d?_.size(x):0))):l=o.slice(),e.length>0&&i.forEach((function(t){var e=$(t),i=e.attr("data-hint-title");if(i){var a=s.indexOf(i.toLowerCase());-1===a?r.push(o.indexOf(i.toLowerCase())):(r.push(a),"en"!==n&&e.attr("data-hint-title",l[a].toUpperCase()))}}));var u=0;i.forEach((function(t){for(var e=$(t);-1!==r.indexOf(u);)u++;e.attr("data-hint-title")||(e.attr("data-hint-title",l[u].toUpperCase()),u++),p.push(e)}))}else i.forEach((function(t){var e=$(t);if("en"!==n){var i=e.attr("data-hint-title").toLowerCase(),a=i.substr(0,1);if(-1===o.indexOf(a)){for(var l="",r=0;r<i.length;r++){var c=i.substr(r,1),d=s.indexOf(c);l+=o[d].toUpperCase()}e.attr("data-hint-title",l)}}p.push(e)}))},D=function(){var t=C?window.parent.innerHeight*Common.Utils.zoom():Common.Utils.innerHeight()-20,e=C?window.parent.innerWidth*Common.Utils.zoom():Common.Utils.innerWidth(),i=C?h[0]:h,n=0!==d&&$(i).length>0&&!C?$(i).offset().top:0,o=0!==d&&$(i).length>0&&!C?n+$(i).height():t;"toolbar"===$(i).prop("id")&&$(i).outerHeight()<$(i).find(".box-controls").outerHeight()&&(o+=$(i).find(".box-controls").outerHeight()),0===p.length&&E(),p.forEach((function(i,s){if(!I(i)){var a=0,l=e;if(!C&&"toolbar"===$(h).prop("id")&&$(h).find(".toolbar-mask").length>0||$("#about-menu-panel").is(":visible")&&"right-menu"===i.closest(".hint-section").prop("id"))return;if(window.SSE&&"statusbar_bottom"===i.parent().prop("id")){var r=i.parent();if(i.offset().left>r.offset().left+r.width())return}if(0===d&&i.closest(".tabs.short").length>0){var c=i.closest(".tabs.short");l=(a=c.offset().left)+c.width(),i.hasClass("scroll")||(a+=20,l-=20)}var p=$('<div style="" class="hint-div">'+i.attr("data-hint-title")+"</div>"),u=i.attr("data-hint-direction");window.SSE&&!C&&9!==h.nodeType&&"toolbar"===h.prop("id")&&"data"===i.closest(".panel").attr("data-tab")&&(i.parent().hasClass("slot-sortdesc")||i.parent().hasClass("slot-btn-setfilter")?(u="top",i.attr("data-hint-direction","top")):(i.parent().hasClass("slot-btn-clear-filter")||i.parent().hasClass("slot-sortasc"))&&(u="bottom",i.attr("data-hint-direction","bottom")));var g=t;$("#file-menu-panel").is(":visible")&&d>1&&($(".fms-flex-apply").is(":visible")||$("#fms-flex-apply").is(":visible"))&&i.closest(".fms-flex-apply").length<1&&i.closest("#fms-flex-apply").length<1&&(g=t-$(".fms-flex-apply").height());var f=i.attr("data-hint-offset"),b="big"===f?6:"medium"===f?4:"small"===f?2:0;if(b)switch(u){case"bottom":f=[-b,0];break;case"top":f=[b,0];break;case"right":f=[0,-b];break;case"left":f=[0,b]}else f=f?i.attr("data-hint-offset").split(",").map((function(t){return parseInt(t)})):[0,0];var v,_,x=i.offset();"left-top"===u?(v=x.top-10+f[0],_=x.left-10+f[1]):"top"===u?(v=x.top-18+f[0],_=x.left+(i.outerWidth()-18)/2+f[1]):"right"===u?(v=x.top+(i.outerHeight()-18)/2+f[0],_=x.left+i.outerWidth()+f[1]):"left"===u?(v=x.top+(i.outerHeight()-18)/2+f[0],_=x.left-18+f[1]):(v=x.top+i.outerHeight()+f[0],_=x.left+(i.outerWidth()-18)/2+f[1]),v<g&&_<e&&v>n&&v<o&&_>a&&_+18<l&&(p.css({top:v,left:_}),C&&s<2?(p.css("z-index","1060"),$(window.parent.document.body).append(p)):$(document.body).append(p)),m.push(p)}}))},P=function(){m&&m.forEach((function(t){t.remove()}))},F=function(){d=$("#file-menu-panel").is(":visible")||C?1:0,y(),m.length=0,p.length=0},R=function(t){Common.Utils.loadConfig("../../common/main/resources/alphabetletters/alphabetletters.json",(function(e){s=e.en;var i=function(t){return n=t,o=e[t]},a=!!i(t)||(!!i(t.split(/[\-_]/)[0])||i("en"));if(a&&"en"!==n)for(var l in x){var r=T(x[l].toLowerCase());r&&(x[l]=r.toUpperCase())}return a})),Common.Utils.loadConfig("../../common/main/resources/alphabetletters/qwertyletters.json",(function(t){a=t[n],"en"!==n&&(l=t.en)}))},V=function(t){if(c&&A(),m.length>0&&F(),f&&w(!1),t&&(g=!0),$(".hint-div").length>0&&$(".hint-div").remove(),$("iframe").length>0)try{$("iframe").contents().find(".hint-div").remove()}catch(t){}};return{init:function(t){i=t;var s=Common.localStorage.getKeysFilter();e=s&&s.length?s.split(",")[0]:"",Common.NotificationCenter.on({"app:ready":function(t){var e=t.lang?t.lang.toLowerCase():"en";R(e),b=!0},"hints:clear":V,"window:resize":V}),$("#editor_sdk").on("click",(function(){V()})),$(document).on("mousedown",(function(){V()})),$(document).on("keyup",(function(t){t.keyCode!=Common.UI.Keys.ALT||!r||window.SSE&&window.SSE.getController("Statusbar").getIsDragDrop()?c&&t.preventDefault():(t.preventDefault(),c?(A(),F(),f&&(f=!1,i.asc_enableKeyEvents(!0))):($("input:focus").blur(),d=$("#file-menu-panel").is(":visible")||C?1:0,y(),S())),r=!1})),$(document).on("keydown",(function(t){if(c)if(t.preventDefault(),t.keyCode==Common.UI.Keys.ESC)setTimeout((function(){0===d?(A(),F(),w(!1)):(P(),m.length=0,p.length=0,d--,y("esc"),S())}),10);else{var i=null,s=!1,f=t.keyCode;if(16!==f&&17!==f&&18!==f&&91!==f&&(i="en"===n?f>47&&f<58||f>64&&f<91?String.fromCharCode(t.keyCode):null:/[.*+?^${}()|[\]\\]/g.test(t.key)?null:t.key),i){var v;if("en"!==n&&-1===o.indexOf(i.toLowerCase())){var _=l.indexOf(i.toLowerCase());-1!==_&&(i=a[_])}u+=i.toUpperCase();for(var x=0;x<p.length;x++){var T=p[x];if(!I(T)){var E=T.attr("data-hint-title");if(new RegExp("^"+u).test(E)&&(s=!0),E===u){v=T;break}}}if(v){var D=v.prop("tagName").toLowerCase();if(window.SSE&&"statusbar_bottom"===v.parent().prop("id"))A(),v.contextmenu(),F();else if("input"===D||"textarea"===D)A(),v.trigger(jQuery.Event("click",{which:1})),v.focus(),F();else if(v.hasClass("listview"))A(),v.focus(),F();else{if(g=!1,A(),!C&&"toolbar"===$(h).prop("id")&&$(h).find(".toolbar-mask").length>0)return void F();var R=v.attr("content-target")&&!$("#"+v.attr("content-target")).is(":visible")||"slot-btn-chat"===v.parent().prop("id")&&!$("#left-panel-chat").is(":visible")||v.parent().hasClass("ribtab")&&!$("#toolbar").children(".toolbar").hasClass("expanded");if((!v.attr("content-target")&&"slot-btn-chat"!==v.parent().prop("id")||R)&&($("#file-menu-panel").is(":visible")&&("fm-btn-info"===v.parent().prop("id")&&$("#panel-info").is(":visible")||"fm-btn-settings"===v.parent().prop("id")&&$("#panel-settings").is(":visible"))||(v.attr("for")?$("#"+v.attr("for")).trigger(jQuery.Event("click",{which:1})):(v.trigger(jQuery.Event("click",{which:1})),R&&(g=!1)))),"btn-goback"===v.prop("id")||"slot-btn-options"===v.closest(".btn-slot").prop("id")||"slot-btn-mode"===v.closest(".btn-slot").prop("id")||"btn-favorite"===v.prop("id")||"tlb-box-users"===v.parent().prop("id")||"left-btn-thumbs"===v.prop("id")||v.hasClass("scroll")||"left-btn-about"===v.prop("id")||"left-btn-support"===v.prop("id")||"slot-btn-search"===v.closest(".btn-slot").prop("id"))return void F();if("add-comment-doc"===v.prop("id"))return P(),m.length=0,p.length=0,void S();g||("slot-btn-chat"===v.parent().prop("id")?(k(1),y(void 0,$("#left-menu.hint-section"))):"id-right-menu-signature"===v.prop("id")?(k(2),y(v)):(k(),y(v)),S(),m.length<1&&F())}}else s||(u="")}}r=Common.Utils.InternalSettings.get(e+"settings-show-alt-hints")&&!t.shiftKey&&t.keyCode==Common.UI.Keys.ALT&&!Common.Utils.ModalWindow.isVisible()&&b&&o.length>0&&!(window.PE&&$("#pe-preview").is(":visible")),Common.Utils.InternalSettings.get(e+"settings-show-alt-hints")&&t.altKey&&115!==t.keyCode&&t.preventDefault()}))},setMode:function(t){C=t.isEditDiagram||t.isEditMailMerge||t.isEditOle},clearHints:V,needCloseFileMenu:function(){return!(c&&d>1)},isHintVisible:function(){return c},getStaticHint:function(t){return x[t]}}},define("common/main/lib/controller/HintManager",(function(){})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.LayoutManager=new function(){var t,e=function(i,n,o){if(!i&&(i=t),i)for(var s in i)if(i.hasOwnProperty(s))if("object"==typeof i[s])e(i[s],n,(o||"")+s+"-");else if(!1===i[s]){var a="[data-layout-name="+(o||"")+s+"]",l=n?n.find(a):$(a);l&&l.hide&&l.hide()}},i=function(e,n,o){if(!n&&(n=t),!n)return!0;var s=!0;for(var a in n)if(n.hasOwnProperty(a)&&("object"==typeof n[a]?s=i(e,n[a],(o||"")+a+"-"):e===(o||"")+a&&(s=n[a]),!1===s))return s;return s};return{init:function(e){t=e},applyCustomization:e,isElementVisible:i}},Common.UI.FeaturesManager=new function(){var t,e;return{init:function(i,n){t=i,e=n},canChange:function(i,n){return!((e||n)&&t&&"object"==typeof t[i]&&t[i]&&!1===t[i].change)},getInitValue:function(i,n){if((e||n)&&t&&void 0!==t[i]){if("object"!=typeof t[i]||!t[i])return t[i];if(void 0!==t[i].mode)return t[i].mode}}}},define("common/main/lib/controller/LayoutManager",(function(){})),define("spreadsheeteditor/main/app/controller/Main",["core","irregularstack","common/main/lib/component/Window","common/main/lib/component/LoadMask","common/main/lib/component/Tooltip","common/main/lib/controller/Fonts","common/main/lib/collection/TextArt","common/main/lib/view/OpenDialog","common/main/lib/view/UserNameDialog","common/main/lib/util/LanguageInfo","common/main/lib/util/LocalStorage","spreadsheeteditor/main/app/collection/ShapeGroups","spreadsheeteditor/main/app/collection/TableTemplates","spreadsheeteditor/main/app/collection/EquationGroups","spreadsheeteditor/main/app/collection/ConditionalFormatIcons","spreadsheeteditor/main/app/controller/FormulaDialog","common/main/lib/controller/FocusManager","common/main/lib/controller/HintManager","common/main/lib/controller/LayoutManager"],(function(){"use strict";var t,e,i,n;SSE.Controllers.Main=Backbone.Controller.extend(_.extend((t=-255,e=-256,i={about:"button#left-btn-about",feedback:"button#left-btn-support",goback:"#fm-btn-back > a, #header-back > div"},n={toolbar:"#viewport #toolbar",leftMenu:"#viewport #left-menu, #viewport #id-toolbar-full-placeholder-btn-settings, #viewport #id-toolbar-short-placeholder-btn-settings",rightMenu:"#viewport #right-menu",statusBar:"#statusbar"},Common.localStorage.setId("table"),Common.localStorage.setKeysFilter("sse-,asc.table"),Common.localStorage.sync(),{models:[],collections:["ShapeGroups","EquationGroups","TableTemplates","ConditionalFormatIcons","ConditionalFormatIconsPresets","Common.Collections.TextArt","Common.Collections.HistoryUsers"],views:[],initialize:function(){this.addListeners({FileMenu:{"settings:apply":_.bind(this.applySettings,this)},"Common.Views.ReviewChanges":{"settings:apply":_.bind(this.applySettings,this)}});var t=this,e={Series:this.txtSeries,"Diagram Title":this.txtDiagramTitle,"X Axis":this.txtXAxis,"Y Axis":this.txtYAxis,"Your text here":this.txtArt,Table:this.txtTable,Print_Area:this.txtPrintArea,Confidential:this.txtConfidential,"Prepared by ":this.txtPreparedBy+" ",Page:this.txtPage,"Page %1 of %2":this.txtPageOf,Pages:this.txtPages,Date:this.txtDate,Time:this.txtTime,Tab:this.txtTab,File:this.txtFile,Column:this.txtColumn,Row:this.txtRow,"%1 of %2":this.txtByField,"(All)":this.txtAll,Values:this.txtValues,"Grand Total":this.txtGrandTotal,"Row Labels":this.txtRowLbls,"Column Labels":this.txtColLbls,"Multi-Select (Alt+S)":this.txtMultiSelect,"Clear Filter (Alt+C)":this.txtClearFilter,"(blank)":this.txtBlank,Group:this.txtGroup,Seconds:this.txtSeconds,Minutes:this.txtMinutes,Hours:this.txtHours,Days:this.txtDays,Months:this.txtMonths,Quarters:this.txtQuarters,Years:this.txtYears,"%1 or %2":this.txtOr,Qtr:this.txtQuarter};["Normal","Neutral","Bad","Good","Input","Output","Calculation","Check Cell","Explanatory Text","Note","Linked Cell","Warning Text","Heading 1","Heading 2","Heading 3","Heading 4","Title","Total","Currency","Percent","Comma"].forEach((function(i){e[i]=t["txtStyle_"+i.replace(/ /g,"_")]||i})),e["Currency [0]"]=t.txtStyle_Currency+" [0]",e["Comma [0]"]=t.txtStyle_Comma+" [0]";for(var i=1;i<7;i++)e["Accent"+i]=t.txtAccent+i,e["20% - Accent"+i]="20% - "+t.txtAccent+i,e["40% - Accent"+i]="40% - "+t.txtAccent+i,e["60% - Accent"+i]="60% - "+t.txtAccent+i;t.translationTable=e},onLaunch:function(){var t=this;if(this._state={isDisconnected:!1,usersCount:1,fastCoauth:!0,lostEditingRights:!1,licenseType:!1,isDocModified:!1},!Common.Utils.isBrowserSupported())return Common.Utils.showBrowserRestriction(),void Common.Gateway.reportError(void 0,this.unsupportedBrowserErrorText);this.api=this.getApplication().getController("Viewport").getApi(),Common.UI.FocusManager.init(),Common.UI.HintManager.init(this.api),Common.UI.Themes.init(this.api);var e=Common.localStorage.getBool("sse-settings-cachemode",!0);Common.Utils.InternalSettings.set("sse-settings-cachemode",e),this.api.asc_setDefaultBlitMode(!!e),null===(e=Common.localStorage.getItem("sse-settings-fontrender"))&&(e="3"),Common.Utils.InternalSettings.set("sse-settings-fontrender",e),this.api.asc_setFontRenderingMode(parseInt(e)),this.api.asc_registerCallback("asc_onOpenDocumentProgress",_.bind(this.onOpenDocument,this)),this.api.asc_registerCallback("asc_onEndAction",_.bind(this.onLongActionEnd,this)),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onAdvancedOptions",_.bind(this.onAdvancedOptions,this)),this.api.asc_registerCallback("asc_onDocumentUpdateVersion",_.bind(this.onUpdateVersion,this)),this.api.asc_registerCallback("asc_onServerVersion",_.bind(this.onServerVersion,this)),this.api.asc_registerCallback("asc_onDocumentName",_.bind(this.onDocumentName,this)),this.api.asc_registerCallback("asc_onPrintUrl",_.bind(this.onPrintUrl,this)),this.api.asc_registerCallback("asc_onMeta",_.bind(this.onMeta,this)),this.api.asc_registerCallback("asc_onSpellCheckInit",_.bind(this.loadLanguages,this)),this.api.asc_registerCallback("asc_onOleEditorReady",_.bind(this.onOleEditorReady,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("goback",_.bind(this.goBack,this)),Common.NotificationCenter.on("namedrange:locked",_.bind(this.onNamedRangeLocked,this)),Common.NotificationCenter.on("download:cancel",_.bind(this.onDownloadCancel,this)),Common.NotificationCenter.on("download:advanced",_.bind(this.onAdvancedOptions,this)),Common.NotificationCenter.on("showmessage",_.bind(this.onExternalMessage,this)),Common.NotificationCenter.on("markfavorite",_.bind(this.markFavorite,this)),Common.NotificationCenter.on("protect:check",_.bind(this.checkProtectedRange,this)),Common.NotificationCenter.on("editing:disable",_.bind(this.onEditingDisable,this)),Common.NotificationCenter.on("showerror",_.bind(this.onError,this)),this.stackLongActions=new Common.IrregularStack({strongCompare:this._compareActionStrong,weakCompare:this._compareActionWeak}),this.stackLongActions.push({id:-254,type:Asc.c_oAscAsyncActionType.BlockInteraction}),this.stackDisableActions=new Common.IrregularStack({strongCompare:this._compareActionWeak,weakCompare:this._compareActionWeak}),this.stackMacrosRequests=[],this.isShowOpenDialog=!1,this.editorConfig={},Common.Gateway.on("init",_.bind(this.loadConfig,this)),Common.Gateway.on("showmessage",_.bind(this.onExternalMessage,this)),Common.Gateway.on("opendocument",_.bind(this.loadDocument,this)),Common.Gateway.on("internalcommand",_.bind(this.onInternalCommand,this)),Common.Gateway.on("grabfocus",_.bind(this.onGrabFocus,this)),Common.Gateway.appReady(),this.getApplication().getController("Viewport").setApi(this.api),$(document.body).on("focus","input, textarea:not(#ce-cell-content)",(function(e){!0!==t.isAppDisabled&&e&&e.target&&!/area_id/.test(e.target.id)&&(/msg-reply/.test(e.target.className)?t.dontCloseDummyComment=!0:/textarea-control/.test(e.target.className)?t.inTextareaControl=!0:!Common.Utils.ModalWindow.isVisible()&&/form-control/.test(e.target.className)&&(t.inFormControl=!0))})),$(document.body).on("blur","input, textarea",(function(e){if(!0!==t.isAppDisabled&&!t.isFrameClosed&&!(Common.Utils.ModalWindow.isVisible()&&!($(".asc-window.enable-key-events:visible").length>0)||t.loadMask&&t.loadMask.isVisible())){if(/form-control/.test(e.target.className)&&(t.inFormControl=!1),t.getApplication().getController("LeftMenu").getView("LeftMenu").getMenu("file").isVisible()&&0===$(".asc-window.enable-key-events:visible").length)return;if(!e.relatedTarget||!/area_id/.test(e.target.id)&&!("input"==e.target.localName&&$(e.target).parent().find(e.relatedTarget).length>0)&&!("textarea"==e.target.localName&&$(e.target).closest(".asc-window").find(".dropdown-menu").find(e.relatedTarget).length>0)&&("input"!=e.relatedTarget.localName||!/form-control/.test(e.relatedTarget.className))&&("textarea"!=e.relatedTarget.localName||/area_id/.test(e.relatedTarget.id))){if(Common.Utils.isIE&&e.originalEvent&&e.originalEvent.target&&/area_id/.test(e.originalEvent.target.id)&&e.originalEvent.target===e.originalEvent.srcElement)return;t.api.asc_enableKeyEvents(!0),/msg-reply/.test(e.target.className)?t.dontCloseDummyComment=!1:/textarea-control/.test(e.target.className)&&(t.inTextareaControl=!1)}}})).on("dragover",(function(t){var e=t.originalEvent;if(e.target&&$(e.target).closest("#editor_sdk").length<1&&!$(e.target).is("#statusbar_bottom")&&!$.contains($("#statusbar_bottom"),$(e.target)))return e.preventDefault(),e.dataTransfer.dropEffect="none",!1})).on("dragstart",(function(t){var e=t.originalEvent;if(e.target){var i=$(e.target);(i.closest(".combobox").length>0||i.closest(".dropdown-menu").length>0||i.closest(".ribtab").length>0||i.closest(".combo-dataview").length>0)&&e.preventDefault()}})),Common.Utils.isChrome&&$(document.body).on("keydown","textarea",(function(t){t.keyCode!==Common.UI.Keys.PAGEUP&&t.keyCode!==Common.UI.Keys.PAGEDOWN||setTimeout((function(){$("#viewport").scrollLeft(0),$("#viewport").scrollTop(0)}),0)})),Common.NotificationCenter.on({"modal:show":function(e){Common.Utils.ModalWindow.show(),t.api.asc_enableKeyEvents(!1)},"modal:close":function(e){Common.Utils.ModalWindow.close(),Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"modal:hide":function(e){Common.Utils.ModalWindow.close(),Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"dataview:focus":function(t){},"dataview:blur":function(e){Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"menu:show":function(t){},"menu:hide":function(e,i){Common.Utils.ModalWindow.isVisible()||e&&e.cmpEl.hasClass("from-cell-edit")||i||(t.api.asc_InputClearKeyboardElement(),t.api.asc_enableKeyEvents(!0))},"edit:complete":_.bind(this.onEditComplete,this),"settings:unitschanged":_.bind(this.unitsChanged,this)}),this.initNames(),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+s,ctrl+s,command+p,ctrl+p,command+k,ctrl+k,command+d,ctrl+d":_.bind((function(t){t.preventDefault(),t.stopPropagation()}),this)}}),t.defaultTitleText="ONLYOFFICE",t.warnNoLicense=t.warnNoLicense.replace(/%1/g,"ONLYOFFICE"),t.warnNoLicenseUsers=t.warnNoLicenseUsers.replace(/%1/g,"ONLYOFFICE"),t.textNoLicenseTitle=t.textNoLicenseTitle.replace(/%1/g,"ONLYOFFICE"),t.warnLicenseExceeded=t.warnLicenseExceeded.replace(/%1/g,"ONLYOFFICE"),t.warnLicenseUsersExceeded=t.warnLicenseUsersExceeded.replace(/%1/g,"ONLYOFFICE")},loadConfig:function(t){this.editorConfig=$.extend(this.editorConfig,t.config),this.appOptions={},this.appOptions.customization=this.editorConfig.customization,this.appOptions.canRenameAnonymous=!("object"==typeof this.appOptions.customization&&"object"==typeof this.appOptions.customization.anonymous&&!1===this.appOptions.customization.anonymous.request),this.appOptions.guestName="object"==typeof this.appOptions.customization&&"object"==typeof this.appOptions.customization.anonymous&&"string"==typeof this.appOptions.customization.anonymous.label&&""!==this.appOptions.customization.anonymous.label.trim()?Common.Utils.String.htmlEncode(this.appOptions.customization.anonymous.label):this.textGuest,this.appOptions.canRenameAnonymous&&(e=Common.localStorage.getItem("guest-username"),Common.Utils.InternalSettings.set("guest-username",e),Common.Utils.InternalSettings.set("save-guest-username",!!e)),this.editorConfig.user=this.appOptions.user=Common.Utils.fillUserInfo(this.editorConfig.user,this.editorConfig.lang,e?e+" ("+this.appOptions.guestName+")":this.textAnonymous,Common.localStorage.getItem("guest-id")||"uid-"+Date.now()),this.appOptions.user.anonymous&&Common.localStorage.setItem("guest-id",this.appOptions.user.id),this.appOptions.isDesktopApp="desktop"==this.editorConfig.targetApp||Common.Controllers.Desktop.isActive(),this.appOptions.canCreateNew=this.editorConfig.canRequestCreateNew||!_.isEmpty(this.editorConfig.createUrl)||this.editorConfig.templates&&this.editorConfig.templates.length,this.appOptions.canOpenRecent=void 0!==this.editorConfig.recent&&!this.appOptions.isDesktopApp,this.appOptions.templates=this.editorConfig.templates,this.appOptions.recent=this.editorConfig.recent,this.appOptions.createUrl=this.editorConfig.createUrl,this.appOptions.canRequestCreateNew=this.editorConfig.canRequestCreateNew,this.appOptions.lang=this.editorConfig.lang,this.appOptions.location="string"==typeof this.editorConfig.location?this.editorConfig.location.toLowerCase():"",this.appOptions.region="string"==typeof this.editorConfig.region?this.editorConfig.region.toLowerCase():this.editorConfig.region,this.appOptions.canAutosave=!1,this.appOptions.canAnalytics=!1,this.appOptions.sharingSettingsUrl=this.editorConfig.sharingSettingsUrl,this.appOptions.saveAsUrl=this.editorConfig.saveAsUrl,this.appOptions.fileChoiceUrl=this.editorConfig.fileChoiceUrl,this.appOptions.isEditDiagram="editdiagram"==this.editorConfig.mode,this.appOptions.isEditMailMerge="editmerge"==this.editorConfig.mode,this.appOptions.isEditOle="editole"==this.editorConfig.mode,this.appOptions.canRequestClose=this.editorConfig.canRequestClose,this.appOptions.canBackToFolder=!1!==this.editorConfig.canBackToFolder&&"object"==typeof this.editorConfig.customization&&"object"==typeof this.editorConfig.customization.goback&&(!_.isEmpty(this.editorConfig.customization.goback.url)||this.editorConfig.customization.goback.requestClose&&this.appOptions.canRequestClose),this.appOptions.canBack=!0===this.appOptions.canBackToFolder,this.appOptions.canPlugins=!1,this.appOptions.canRequestUsers=this.editorConfig.canRequestUsers,this.appOptions.canRequestSendNotify=this.editorConfig.canRequestSendNotify,this.appOptions.canRequestSaveAs=this.editorConfig.canRequestSaveAs,this.appOptions.canRequestInsertImage=this.editorConfig.canRequestInsertImage,this.appOptions.compatibleFeatures="object"==typeof this.appOptions.customization&&!!this.appOptions.customization.compatibleFeatures,this.appOptions.canRequestSharingSettings=this.editorConfig.canRequestSharingSettings,this.appOptions.mentionShare=!("object"==typeof this.appOptions.customization&&0==this.appOptions.customization.mentionShare),this.appOptions.canMakeActionLink=this.editorConfig.canMakeActionLink,this.appOptions.canFeaturePivot=!0,this.appOptions.canFeatureViews=!0,!this.appOptions.user.guest||!this.appOptions.canRenameAnonymous||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||Common.NotificationCenter.on("user:rename",_.bind(this.showRenameUserDialog,this)),this.headerView=this.getApplication().getController("Viewport").getView("Common.Views.Header"),this.headerView.setCanBack(!0===this.appOptions.canBackToFolder,this.appOptions.canBackToFolder?this.editorConfig.customization.goback.text:"");var e,i=Common.localStorage.getItem("sse-settings-reg-settings"),n=Common.localStorage.getBool("sse-settings-use-base-separator",!0),o=void 0,s=void 0;Common.Utils.InternalSettings.set("sse-settings-use-base-separator",n),n||(o=Common.localStorage.getItem("sse-settings-decimal-separator"),s=Common.localStorage.getItem("sse-settings-group-separator")),null!==i?this.api.asc_setLocale(parseInt(i),o,s):(i=this.appOptions.region,i=null!==(i=Common.util.LanguageInfo.getLanguages().hasOwnProperty(i)?i:Common.util.LanguageInfo.getLocalLanguageCode(i))?parseInt(i):this.editorConfig.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.editorConfig.lang)):1033,this.api.asc_setLocale(i,o,s)),Common.Utils.InternalSettings.set("sse-config-lang",this.editorConfig.lang),e=Common.localStorage.getBool("sse-settings-r1c1"),Common.Utils.InternalSettings.set("sse-settings-r1c1",e),this.api.asc_setR1C1Mode(e),"us"!=this.appOptions.location&&"ca"!=this.appOptions.location||Common.Utils.Metric.setDefaultMetric(Common.Utils.Metric.c_MetricUnits.inch),this.editorConfig.customization&&(this.editorConfig.customization.toolbarNoTabs||"desktop"!==this.editorConfig.targetApp&&(this.editorConfig.customization.loaderName||this.editorConfig.customization.loaderLogo))||$("#editor_sdk").append('<div class="doc-placeholder">'+'<div class="columns"></div>'.repeat(2)+"</div>"),e=null===(e=Common.localStorage.getItem("sse-macros-mode"))?"enable"==(e=this.editorConfig.customization?this.editorConfig.customization.macrosMode:"warn")?1:"disable"==e?2:0:parseInt(e),Common.Utils.InternalSettings.set("sse-macros-mode",e),e=Common.localStorage.getItem("sse-allow-macros-request"),Common.Utils.InternalSettings.set("sse-allow-macros-request",null!==e?parseInt(e):0),this.appOptions.wopi=this.editorConfig.wopi,this.isFrameClosed=this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle,Common.Controllers.Desktop.init(this.appOptions),(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&Common.UI.HintManager.setMode(this.appOptions)},loadDocument:function(t){this.appOptions.spreadsheet=t.doc,this.permissions={};var e={};if(t.doc){this.permissions=_.extend(this.permissions,t.doc.permissions);var i=$.extend({},t.doc.options,this.editorConfig.actionLink||{}),n=new Asc.asc_CUserInfo;n.put_Id(this.appOptions.user.id),n.put_FullName(this.appOptions.user.fullname),n.put_IsAnonymousUser(!!this.appOptions.user.anonymous),(e=new Asc.asc_CDocInfo).put_Id(t.doc.key),e.put_Url(t.doc.url),e.put_DirectUrl(t.doc.directUrl),e.put_Title(t.doc.title),e.put_Format(t.doc.fileType),e.put_VKey(t.doc.vkey),e.put_Options(i),e.put_UserInfo(n),e.put_CallbackUrl(this.editorConfig.callbackUrl),e.put_Token(t.doc.token),e.put_Permissions(t.doc.permissions),e.put_EncryptedInfo(this.editorConfig.encryptionKeys),e.put_Lang(this.editorConfig.lang),e.put_Mode(this.editorConfig.mode);var o=this.editorConfig.coEditing&&"object"==typeof this.editorConfig.coEditing?"view"===this.editorConfig.mode&&!1!==this.editorConfig.coEditing.change?"fast":this.editorConfig.coEditing.mode||"fast":"fast";e.put_CoEditingMode(o);var s=!this.editorConfig.customization||!1!==this.editorConfig.customization.macros;e.asc_putIsEnabledMacroses(!!s),s=!this.editorConfig.customization||!1!==this.editorConfig.customization.plugins,e.asc_putIsEnabledPlugins(!!s),this.headerView&&this.headerView.setDocumentCaption(t.doc.title),Common.Utils.InternalSettings.set("sse-doc-info-key",t.doc.key)}this.api.asc_registerCallback("asc_onGetEditorPermissions",_.bind(this.onEditorPermissions,this)),this.api.asc_registerCallback("asc_onLicenseChanged",_.bind(this.onLicenseChanged,this)),this.api.asc_registerCallback("asc_onMacrosPermissionRequest",_.bind(this.onMacrosPermissionRequest,this)),this.api.asc_registerCallback("asc_onRunAutostartMacroses",_.bind(this.onRunAutostartMacroses,this)),this.api.asc_setDocInfo(e),this.api.asc_getEditorPermissions(this.editorConfig.licenseUrl,this.editorConfig.customerId)},onProcessSaveResult:function(t){this.api.asc_OnSaveEnd(t.result),t&&!1===t.result&&Common.UI.error({title:this.criticalErrorTitle,msg:_.isEmpty(t.message)?this.errorProcessSaveResult:t.message})},onProcessRightsChange:function(t){if(t&&!1===t.enabled){var e=this,i=this._state.lostEditingRights;this._state.lostEditingRights=!this._state.lostEditingRights,this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("collaboration:sharingdeny"),Common.NotificationCenter.trigger("api:disconnect"),i||Common.UI.warning({title:this.notcriticalErrorTitle,maxwidth:600,msg:_.isEmpty(t.message)?this.warnProcessRightsChange:t.message,callback:function(){e._state.lostEditingRights=!1,e.onEditComplete()}})}},onDownloadAs:function(t){if(this.appOptions.canDownload){this._state.isFromGatewayDownloadAs=!0;var e=t&&"string"==typeof t?Asc.c_oAscFileType[t.toUpperCase()]:null,i=[Asc.c_oAscFileType.XLSX,Asc.c_oAscFileType.ODS,Asc.c_oAscFileType.CSV,Asc.c_oAscFileType.PDF,Asc.c_oAscFileType.PDFA,Asc.c_oAscFileType.XLTX,Asc.c_oAscFileType.OTS,Asc.c_oAscFileType.XLSM];(!e||i.indexOf(e)<0)&&(e=Asc.c_oAscFileType.XLSX),e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA?Common.NotificationCenter.trigger("download:settings",this,e,!0):this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e,!0))}else Common.Gateway.reportError(Asc.c_oAscError.ID.AccessDeny,this.errorAccessDeny)},onProcessMouse:function(t){if("mouseup"==t.type){var e=document.getElementById("editor_sdk");if(e){var i=e.getBoundingClientRect(),n=t.event||{};this.api.asc_onMouseUp(n,t.x-i.left,t.y-i.top)}}},onRequestClose:function(){var t=this;this.api.asc_isDocumentModified()?(this.api.asc_stopSaving(),Common.UI.warning({closable:!1,width:500,title:this.notcriticalErrorTitle,msg:this.leavePageTextOnClose,buttons:["ok","cancel"],primary:"ok",callback:function(e){"ok"==e?(t.api.asc_undoAllChanges(),t.api.asc_continueSaving(),Common.Gateway.requestClose()):t.api.asc_continueSaving()}})):Common.Gateway.requestClose()},goBack:function(t){var e=this;if(!Common.Controllers.Desktop.process("goback"))if(e.appOptions.customization.goback.requestClose&&e.appOptions.canRequestClose)e.onRequestClose();else{var i=e.appOptions.customization.goback.url;t||!1===e.appOptions.customization.goback.blank?parent.location.href=i:window.open(i,"_blank")}},markFavorite:function(t){Common.Controllers.Desktop.process("markfavorite")||Common.Gateway.metaChange({favorite:t})},onSetFavorite:function(t){this.appOptions.canFavorite&&this.headerView&&this.headerView.setFavorite(!!t)},onEditComplete:function(t,e){e&&e.restorefocus&&this.api.isCEditorFocused?(this.formulaInput.blur(),this.formulaInput.focus()):(this.getApplication().getController("DocumentHolder").getView("DocumentHolder").focus(),this.api.isCEditorFocused=!1),Common.UI.HintManager.clearHints(!0)},onSelectionChanged:function(t){this._isChartDataReady||t.asc_getSelectionType()!=Asc.c_oAscSelectionType.RangeChart||(this._isChartDataReady=!0,Common.Gateway.internalMessage("chartDataReady"))},onLongActionBegin:function(t,e){var i={id:e,type:t};this.stackLongActions.push(i),this.setLongActionView(i)},onLongActionEnd:function(t,e){var i={id:e,type:t};if(this.stackLongActions.pop(i),this.headerView&&this.headerView.setDocumentCaption(this.api.asc_getDocumentName()),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0),t===Asc.c_oAscAsyncActionType.BlockInteraction&&e==Asc.c_oAscAsyncAction.Open&&(Common.Gateway.internalMessage("documentReady",{}),this.onDocumentContentReady()),i=this.stackLongActions.get({type:Asc.c_oAscAsyncActionType.Information}))this.setLongActionView(i);else{var n=this;e!=Asc.c_oAscAsyncAction.Save&&e!=Asc.c_oAscAsyncAction.ForceSaveButton||this.appOptions.isOffline?this.getApplication().getController("Statusbar").setStatusCaption(""):this._state.fastCoauth&&this._state.usersCount>1?n._state.timerSave=setTimeout((function(){n.getApplication().getController("Statusbar").setStatusCaption(n.textChangesSaved,!1,3e3)}),500):n.getApplication().getController("Statusbar").setStatusCaption(n.textChangesSaved,!1,3e3)}e==Asc.c_oAscAsyncAction.Save&&this.synchronizeChanges(),(i=this.stackLongActions.get({type:Asc.c_oAscAsyncActionType.BlockInteraction}))?this.setLongActionView(i):(this.loadMask&&(!this.loadMask.isVisible()||this.dontCloseDummyComment||this.inTextareaControl||Common.Utils.ModalWindow.isVisible()||this.inFormControl||this.api.asc_enableKeyEvents(!0),this.loadMask.hide()),t!=Asc.c_oAscAsyncActionType.BlockInteraction||(e==Asc.c_oAscAsyncAction.LoadDocumentFonts||e==Asc.c_oAscAsyncAction.ApplyChanges)&&(this.dontCloseDummyComment||this.inTextareaControl||Common.Utils.ModalWindow.isVisible()||this.inFormControl)||this.onEditComplete(this.loadMask,{restorefocus:!0})),e==Asc.c_oAscAsyncAction.Disconnect&&(this._state.timerDisconnect&&clearTimeout(this._state.timerDisconnect),this.disableEditing(!1,!0),this.getApplication().getController("Statusbar").hideDisconnectTip(),this.getApplication().getController("Statusbar").setStatusCaption(this.textReconnect))},setLongActionView:function(i){var n="",o="",s=!1,a=null;switch(i.id){case Asc.c_oAscAsyncAction.Open:n=this.openTitleText,o=this.openTextText;break;case Asc.c_oAscAsyncAction.Save:case Asc.c_oAscAsyncAction.ForceSaveButton:case Asc.c_oAscAsyncAction.ForceSaveTimeout:clearTimeout(this._state.timerSave),s=!0,n=this.saveTitleText,o=this.appOptions.isOffline?"":this.saveTextText;break;case Asc.c_oAscAsyncAction.LoadDocumentFonts:n=this.loadFontsTitleText,o=this.loadFontsTextText;break;case Asc.c_oAscAsyncAction.LoadDocumentImages:n=this.loadImagesTitleText,o=this.loadImagesTextText;break;case Asc.c_oAscAsyncAction.LoadFont:n=this.loadFontTitleText,o=this.loadFontTextText;break;case Asc.c_oAscAsyncAction.LoadImage:n=this.loadImageTitleText,o=this.loadImageTextText;break;case Asc.c_oAscAsyncAction.DownloadAs:n=this.downloadTitleText,o=this.downloadTextText;break;case Asc.c_oAscAsyncAction.Print:n=this.printTitleText,o=this.printTextText;break;case Asc.c_oAscAsyncAction.UploadImage:n=this.uploadImageTitleText,o=this.uploadImageTextText;break;case Asc.c_oAscAsyncAction.SlowOperation:n=this.textPleaseWait,o=this.textPleaseWait;break;case Asc.c_oAscAsyncAction.Waiting:n=this.waitText,o=this.waitText;break;case t:n=this.txtEditingMode,o=this.waitText;break;case e:n=this.loadingDocumentTitleText+"           ",o=this.loadingDocumentTitleText;break;case Asc.c_oAscAsyncAction.Disconnect:n=this.textDisconnect,o=this.textDisconnect,this.disableEditing(!0,!0);var l=this;a=function(){l._state.timerDisconnect=setTimeout((function(){l.getApplication().getController("Statusbar").showDisconnectTip()}),l._state.unloadTimer||0)};break;default:"string"==typeof i.id&&(n=i.id,o=i.id)}i.type==Asc.c_oAscAsyncActionType.BlockInteraction?(!this.loadMask&&(this.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),this.loadMask.setTitle(n),this.isShowOpenDialog||(this.api.asc_enableKeyEvents(!1),this.loadMask.show())):this.getApplication().getController("Statusbar").setStatusCaption(o,s,0,a)},onApplyEditRights:function(t){this.getApplication().getController("Statusbar").setStatusCaption(""),t&&!t.allowed&&Common.UI.info({title:this.requestEditFailedTitleText,msg:t.message||this.requestEditFailedMessageText})},onDocumentContentReady:function(){if(!this._isDocReady){this._state.openDlg&&this._state.openDlg.close();var t,i=this;i._isDocReady=!0,Common.NotificationCenter.trigger("app:ready",this.appOptions),i.hidePreloader(),i.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e),t=this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle?100:Common.localStorage.getItem("sse-settings-zoom"),Common.Utils.InternalSettings.set("sse-settings-zoom",t);var n=null!==t?parseInt(t)/100:this.appOptions.customization&&this.appOptions.customization.zoom?parseInt(this.appOptions.customization.zoom)/100:1;if(this.api.asc_setZoom(n>0?n:1),t=Common.localStorage.getBool("sse-settings-show-alt-hints",!Common.Utils.isMac),Common.Utils.InternalSettings.set("sse-settings-show-alt-hints",t),this.isLiveCommenting=Common.localStorage.getBool("sse-settings-livecomment",!0),Common.Utils.InternalSettings.set("sse-settings-livecomment",this.isLiveCommenting),t=Common.localStorage.getBool("sse-settings-resolvedcomment"),Common.Utils.InternalSettings.set("sse-settings-resolvedcomment",t),this.isLiveCommenting?this.api.asc_showComments(t):this.api.asc_hideComments(),this._state.fastCoauth=Common.Utils.InternalSettings.get("sse-settings-coauthmode"),this.api.asc_SetFastCollaborative(i._state.fastCoauth),this.api.asc_setAutoSaveGap(Common.Utils.InternalSettings.get("sse-settings-autosave")),Common.UI.FeaturesManager.canChange("spellcheck")){var o=Common.localStorage.getBool("sse-spellcheck-ignore-uppercase-words",!0);Common.Utils.InternalSettings.set("sse-spellcheck-ignore-uppercase-words",o),this.api.asc_ignoreUppercase(o);var s=Common.localStorage.getBool("sse-spellcheck-ignore-numbers-words",!0);Common.Utils.InternalSettings.set("sse-spellcheck-ignore-numbers-words",s),this.api.asc_ignoreNumbers(s)}i.api.asc_registerCallback("asc_onStartAction",_.bind(i.onLongActionBegin,i)),i.api.asc_registerCallback("asc_onConfirmAction",_.bind(i.onConfirmAction,i)),i.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(i.onActiveSheetChanged,i)),i.api.asc_registerCallback("asc_onPrint",_.bind(i.onPrint,i));var a=i.getApplication();i.headerView.setDocumentCaption(i.api.asc_getDocumentName()),i.updateWindowTitle(i.api.asc_isDocumentModified(),!0);var l=a.getController("Toolbar"),r=a.getController("Statusbar"),c=a.getController("DocumentHolder"),d=a.getController("RightMenu"),h=a.getController("LeftMenu"),p=a.getController("CellEditor"),m=r.getView("Statusbar"),u=h.getView("LeftMenu"),g=c.getView("DocumentHolder"),f=a.getController("Common.Controllers.Chat"),b=a.getController("Common.Controllers.Plugins"),C=a.getController("Spellcheck");if(u.getMenu("file").loadDocument({doc:i.appOptions.spreadsheet}),h.setMode(i.appOptions).createDelayedElements().setApi(i.api),i.appOptions.isEditMailMerge||i.appOptions.isEditDiagram||i.appOptions.isEditOle||(b.setApi(i.api),this.api&&this.api.asc_setFrozenPaneBorderType(Common.localStorage.getBool("sse-freeze-shadow",!0)?Asc.c_oAscFrozenPaneBorderType.shadow:Asc.c_oAscFrozenPaneBorderType.line),a.getController("Common.Controllers.ExternalOleEditor").setApi(this.api).loadConfig({config:this.editorConfig,customization:this.editorConfig.customization})),u.disableMenu("all",!1),i.appOptions.isEditMailMerge||i.appOptions.isEditDiagram||i.appOptions.isEditOle||!i.appOptions.canBranding||i.getApplication().getController("LeftMenu").leftMenu.getMenu("about").setLicInfo(i.editorConfig.customization),c.setApi(i.api).loadConfig({config:i.editorConfig}),f.setApi(this.api).setMode(this.appOptions),r.createDelayedElements(),r.setApi(i.api),g.setApi(i.api),m.update(),this.formulaInput=p.getView("CellEditor").$el.find("textarea"),i.appOptions.isEdit){Common.UI.FeaturesManager.canChange("spellcheck")&&C.setApi(i.api).setMode(i.appOptions),i.appOptions.canForcesave&&(i.appOptions.forcesave=Common.localStorage.getBool("sse-settings-forcesave",i.appOptions.canForcesave),Common.Utils.InternalSettings.set("sse-settings-forcesave",i.appOptions.forcesave),i.api.asc_setIsForceSaveOnUserSave(i.appOptions.forcesave)),null===(t=Common.localStorage.getItem("sse-settings-paste-button"))&&(t="1"),Common.Utils.InternalSettings.set("sse-settings-paste-button",parseInt(t)),i.api.asc_setVisiblePasteButton(!!parseInt(t)),i.loadAutoCorrectSettings(),i.needToUpdateVersion&&(Common.NotificationCenter.trigger("api:disconnect"),l.onApiCoAuthoringDisconnect());var v=setInterval((function(){if(window.styles_loaded||i.appOptions.isEditDiagram||i.appOptions.isEditMailMerge||i.appOptions.isEditOle){if(clearInterval(v),Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+i.api.asc_getActiveWorksheetId()]),g.createDelayedElements(),l.createDelayedElements(),i.setLanguages(),i.appOptions.isEditMailMerge||i.appOptions.isEditDiagram||i.appOptions.isEditOle)i.appOptions.isEditOle&&i.updateThemeColors();else{var t=i.api.asc_getPropertyEditorShapes();t&&i.fillAutoShapes(t[0],t[1]),i.updateThemeColors(),l.activateControls()}d.createDelayedElements(),i.api.asc_registerCallback("asc_onDocumentCanSaveChanged",_.bind(i.onDocumentCanSaveChanged,i)),i.api.asc_registerCallback("asc_OnTryUndoInFastCollaborative",_.bind(i.onTryUndoInFastCollaborative,i)),i.onDocumentModifiedChanged(i.api.asc_isDocumentModified());var e=a.getController("FormulaDialog");e&&e.setMode(i.appOptions).setApi(i.api),i.needToUpdateVersion&&l.onApiCoAuthoringDisconnect(),Common.NotificationCenter.trigger("document:ready","main"),i.applyLicense()}}),50)}else{var x=a.getController("FormulaDialog");x&&x.setMode(i.appOptions).setApi(i.api),g.createDelayedElementsViewer(),Common.NotificationCenter.trigger("document:ready","main"),i.applyLicense()}if(!i.appOptions.isEditMailMerge&&!i.appOptions.isEditDiagram&&!i.appOptions.isEditOle){var y=~~(1e6*Math.random());$(".toolbar").prepend(Common.Utils.String.format('<div class="lazy-{0} x-huge"><div class="toolbar__icon" style="position: absolute; width: 1px; height: 1px;"></div>',y)),setTimeout((function(){$(Common.Utils.String.format(".toolbar .lazy-{0}",y)).remove()}),10)}i.appOptions.canAnalytics,Common.Gateway.on("applyeditrights",_.bind(i.onApplyEditRights,i)),Common.Gateway.on("processsaveresult",_.bind(i.onProcessSaveResult,i)),Common.Gateway.on("processrightschange",_.bind(i.onProcessRightsChange,i)),Common.Gateway.on("processmouse",_.bind(i.onProcessMouse,i)),Common.Gateway.on("downloadas",_.bind(i.onDownloadAs,i)),Common.Gateway.on("setfavorite",_.bind(i.onSetFavorite,i)),Common.Gateway.on("requestclose",_.bind(i.onRequestClose,i)),Common.Gateway.on("refreshhistory",_.bind(i.onRefreshHistory,i)),Common.Gateway.sendInfo({mode:i.appOptions.isEdit?"edit":"view"}),$(document).on("contextmenu",_.bind(i.onContextMenu,i)),void 0!==document.hidden&&document.hidden?document.addEventListener("visibilitychange",w):w(),Common.Gateway.documentReady(),!this.appOptions.user.guest||!this.appOptions.canRenameAnonymous||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||null!==Common.Utils.InternalSettings.get("guest-username")||this.showRenameUserDialog()}function w(){if(!window.AscDesktopEditor){var t=[];Common.Utils.isIE9m&&t.push(i.warnBrowserIE9),t.length&&i.showTips(t)}document.removeEventListener("visibilitychange",w)}},onLicenseChanged:function(t){if(!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)){var e=t.asc_getLicenseType();void 0!==e&&(this.appOptions.canEdit||this.appOptions.isRestrictedEdit)&&"view"!==this.editorConfig.mode&&(e===Asc.c_oLicenseResult.Connections||e===Asc.c_oLicenseResult.UsersCount||e===Asc.c_oLicenseResult.ConnectionsOS||e===Asc.c_oLicenseResult.UsersCountOS||e===Asc.c_oLicenseResult.SuccessLimit&&0!=(this.appOptions.trialMode&Asc.c_oLicenseMode.Limited))&&(this._state.licenseType=e),void 0===e||!this.appOptions.canLiveView||e!==Asc.c_oLicenseResult.ConnectionsLive&&e!==Asc.c_oLicenseResult.ConnectionsLiveOS&&e!==Asc.c_oLicenseResult.UsersViewCount&&e!==Asc.c_oLicenseResult.UsersViewCountOS||(this._state.licenseType=e),this._isDocReady&&this.applyLicense()}},applyLicense:function(){if("view"===this.editorConfig.mode)!this.appOptions.canLiveView||this._state.licenseType!==Asc.c_oLicenseResult.ConnectionsLive&&this._state.licenseType!==Asc.c_oLicenseResult.ConnectionsLiveOS&&this._state.licenseType!==Asc.c_oLicenseResult.UsersViewCount&&this._state.licenseType!==Asc.c_oLicenseResult.UsersViewCountOS||this.disableLiveViewing(!0);else if(this._state.licenseType){var t=this._state.licenseType,e=["ok"],i="ok";0==(this.appOptions.trialMode&Asc.c_oLicenseMode.Limited)||t!==Asc.c_oLicenseResult.SuccessLimit&&t!==Asc.c_oLicenseResult.ExpiredLimited&&this.appOptions.permissionsLicense!==Asc.c_oLicenseResult.SuccessLimit?t===Asc.c_oLicenseResult.Connections||t===Asc.c_oLicenseResult.UsersCount?t=t===Asc.c_oLicenseResult.Connections?this.warnLicenseExceeded:this.warnLicenseUsersExceeded:(t=t===Asc.c_oLicenseResult.ConnectionsOS?this.warnNoLicense:this.warnNoLicenseUsers,e=[{value:"buynow",caption:this.textBuyNow},{value:"contact",caption:this.textContactUs}],i="buynow"):(t===Asc.c_oLicenseResult.ExpiredLimited&&this.getApplication().getController("LeftMenu").leftMenu.setLimitMode(),t=t===Asc.c_oLicenseResult.ExpiredLimited?this.warnLicenseLimitedNoAccess:this.warnLicenseLimitedRenewed),this._state.licenseType!==Asc.c_oLicenseResult.SuccessLimit&&(this.appOptions.isEdit||this.appOptions.isRestrictedEdit)&&(this.disableEditing(!0),Common.NotificationCenter.trigger("api:disconnect"));var n=Common.localStorage.getItem("sse-license-warning");n=null!==n?parseInt(n):0;var o=(new Date).getTime();o-n>864e5&&Common.UI.info({maxwidth:500,title:this.textNoLicenseTitle,msg:t,buttons:e,primary:i,callback:function(t){Common.localStorage.setItem("sse-license-warning",o),"buynow"==t?window.open("https://www.onlyoffice.com","_blank"):"contact"==t&&window.open("mailto:sales@onlyoffice.com","_blank")}})}else this.appOptions.isDesktopApp||this.appOptions.canBrandingExt||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||!this.editorConfig||!this.editorConfig.customization||!this.editorConfig.customization.loaderName&&!this.editorConfig.customization.loaderLogo||Common.UI.warning({title:this.textPaidFeature,msg:this.textCustomLoader,buttons:[{value:"contact",caption:this.textContactUs},{value:"close",caption:this.textClose}],primary:"contact",callback:function(t){"contact"==t&&window.open("mailto:sales@onlyoffice.com","_blank")}})},disableEditing:function(t,e){Common.NotificationCenter.trigger("editing:disable",t,{viewMode:t,allowSignature:!1,allowProtect:!1,rightMenu:{clear:!e,disable:!0},statusBar:!0,leftMenu:{disable:!0,previewMode:!0},fileMenu:{protect:!0,history:e},comments:{disable:!e,previewMode:!0},chat:!0,review:!0,viewport:!0,documentHolder:!0,toolbar:!0,celleditor:{previewMode:!0}},e?"reconnect":"disconnect")},onEditingDisable:function(t,e,i){var n=this.getApplication(),o={type:i,disable:t,options:e};t&&!this.stackDisableActions.get({type:i})&&this.stackDisableActions.push(o),!t&&this.stackDisableActions.pop({type:i});var s=!t&&this.stackDisableActions.length()>0?this.stackDisableActions.get(this.stackDisableActions.length()-1):null;if(e.rightMenu&&n.getController("RightMenu")&&(e.rightMenu.clear&&n.getController("RightMenu").getView("RightMenu").clearSelection(),e.rightMenu.disable&&n.getController("RightMenu").SetDisabled(t,e.allowSignature)),e.statusBar&&n.getController("Statusbar").SetDisabled(t),e.review&&n.getController("Common.Controllers.ReviewChanges").SetDisabled(t),e.viewport&&n.getController("Viewport").SetDisabled(t),e.toolbar&&n.getController("Toolbar").DisableToolbar(t,e.viewMode),e.documentHolder&&n.getController("DocumentHolder").SetDisabled(t,e.allowProtect),e.leftMenu&&(e.leftMenu.disable&&n.getController("LeftMenu").SetDisabled(t,e),e.leftMenu.previewMode&&n.getController("LeftMenu").setPreviewMode(t)),e.fileMenu&&(n.getController("LeftMenu").leftMenu.getMenu("file").SetDisabled(t,e.fileMenu),e.leftMenu.disable&&n.getController("LeftMenu").leftMenu.getMenu("file").applyMode()),e.comments){var a=this.getApplication().getController("Common.Controllers.Comments");a&&e.comments.previewMode&&a.setPreviewMode(t)}e.celleditor&&e.celleditor.previewMode&&n.getController("CellEditor").setPreviewMode(t),s&&this.onEditingDisable(s.disable,s.options,s.type)},disableLiveViewing:function(t){this.appOptions.canLiveView=!t,this.api.asc_SetFastCollaborative(!t),Common.Utils.InternalSettings.set("sse-settings-coauthmode",!t)},onOpenDocument:function(t){var e=document.getElementById("loadmask-text"),i=(t.asc_getCurrentFont()+t.asc_getCurrentImage())/(t.asc_getFontsCount()+t.asc_getImagesCount());i=this.textLoadingDocument+": "+Common.Utils.String.fixedDigits(Math.min(Math.round(100*i),100),3,"  ")+"%",e?e.innerHTML=i:this.loadMask&&this.loadMask.setTitle(i)},onEditorPermissions:function(t){var i=t?t.asc_getLicenseType():Asc.c_oLicenseResult.Error;if(t&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)){if(Asc.c_oLicenseResult.Expired===i||Asc.c_oLicenseResult.Error===i||Asc.c_oLicenseResult.ExpiredTrial===i)return void Common.UI.warning({title:this.titleLicenseExp,msg:this.warnLicenseExp,buttons:[],closable:!1});if(Asc.c_oLicenseResult.ExpiredLimited===i&&(this._state.licenseType=i),this.onServerVersion(t.asc_getBuildVersion())||!this.onLanguageLoaded())return;t.asc_getRights()!==Asc.c_oRights.Edit&&(this.permissions.edit=!1),this.appOptions.permissionsLicense=i,this.appOptions.canAutosave=!0,this.appOptions.canAnalytics=t.asc_getIsAnalyticsEnable(),this.appOptions.isOffline=this.api.asc_isOffline(),this.appOptions.isCrypted=this.api.asc_isCrypto(),this.appOptions.canLicense=i===Asc.c_oLicenseResult.Success||i===Asc.c_oLicenseResult.SuccessLimit,this.appOptions.isLightVersion=t.asc_getIsLight(),this.appOptions.canCoAuthoring=!this.appOptions.isLightVersion,this.appOptions.canComments=this.appOptions.canLicense&&(void 0===this.permissions.comment?!1!==this.permissions.edit:this.permissions.comment)&&"view"!==this.editorConfig.mode,this.appOptions.canComments=this.appOptions.canComments&&!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.comments),this.appOptions.canViewComments=this.appOptions.canComments||!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.comments),this.appOptions.canChat=this.appOptions.canLicense&&!this.appOptions.isOffline&&!(!1===this.permissions.chat||void 0===this.permissions.chat&&"object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.chat),"object"==typeof this.editorConfig.customization&&void 0!==this.editorConfig.customization.chat&&console.log("Obsolete: The 'chat' parameter of the 'customization' section is deprecated. Please use 'chat' parameter in the permissions instead."),this.appOptions.canRename=this.editorConfig.canRename,this.appOptions.buildVersion=t.asc_getBuildVersion(),this.appOptions.trialMode=t.asc_getLicenseMode(),this.appOptions.isBeta=t.asc_getIsBeta(),this.appOptions.canModifyFilter=!1!==this.permissions.modifyFilter,this.appOptions.canBranding=t.asc_getCustomization(),this.appOptions.canBranding&&this.headerView.setBranding(this.editorConfig.customization),this.appOptions.canFavorite=this.appOptions.spreadsheet.info&&void 0!==this.appOptions.spreadsheet.info.favorite&&null!==this.appOptions.spreadsheet.info.favorite,this.appOptions.canFavorite&&this.headerView&&this.headerView.setFavorite(this.appOptions.spreadsheet.info.favorite),this.appOptions.canRename&&this.headerView.setCanRename(!0),this.appOptions.canUseReviewPermissions=this.appOptions.canLicense&&(!!this.permissions.reviewGroups||this.appOptions.canLicense&&this.editorConfig.customization&&this.editorConfig.customization.reviewPermissions&&"object"==typeof this.editorConfig.customization.reviewPermissions),this.appOptions.canUseCommentPermissions=this.appOptions.canLicense&&!!this.permissions.commentGroups,this.appOptions.canUseUserInfoPermissions=this.appOptions.canLicense&&!!this.permissions.userInfoGroups,AscCommon.UserInfoParser.setParser(!0),AscCommon.UserInfoParser.setCurrentName(this.appOptions.user.fullname),this.appOptions.canUseReviewPermissions&&AscCommon.UserInfoParser.setReviewPermissions(this.permissions.reviewGroups,this.editorConfig.customization.reviewPermissions),this.appOptions.canUseCommentPermissions&&AscCommon.UserInfoParser.setCommentPermissions(this.permissions.commentGroups),this.appOptions.canUseUserInfoPermissions&&AscCommon.UserInfoParser.setUserInfoPermissions(this.permissions.userInfoGroups),this.headerView.setUserName(AscCommon.UserInfoParser.getParsedName(AscCommon.UserInfoParser.getCurrentName()))}else this.appOptions.canModifyFilter=!0;this.appOptions.canRequestEditRights=this.editorConfig.canRequestEditRights,this.appOptions.canEdit=!1!==this.permissions.edit&&(this.editorConfig.canRequestEditRights||"view"!==this.editorConfig.mode),this.appOptions.isEdit=(this.appOptions.canLicense||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&!1!==this.permissions.edit&&"view"!==this.editorConfig.mode,this.appOptions.canDownload=!1!==this.permissions.download,this.appOptions.canPrint=!1!==this.permissions.print,this.appOptions.canForcesave=this.appOptions.isEdit&&!this.appOptions.isOffline&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&"object"==typeof this.editorConfig.customization&&!!this.editorConfig.customization.forcesave,this.appOptions.forcesave=this.appOptions.canForcesave,this.appOptions.canEditComments=this.appOptions.isOffline||!this.permissions.editCommentAuthorOnly,this.appOptions.canDeleteComments=this.appOptions.isOffline||!this.permissions.deleteCommentAuthorOnly,"object"==typeof this.editorConfig.customization&&!0===this.editorConfig.customization.commentAuthorOnly&&(console.log("Obsolete: The 'commentAuthorOnly' parameter of the 'customization' section is deprecated. Please use 'editCommentAuthorOnly' and 'deleteCommentAuthorOnly' parameters in the permissions instead."),void 0===this.permissions.editCommentAuthorOnly&&void 0===this.permissions.deleteCommentAuthorOnly&&(this.appOptions.canEditComments=this.appOptions.canDeleteComments=this.appOptions.isOffline)),this.appOptions.isSignatureSupport=this.appOptions.isEdit&&this.appOptions.isDesktopApp&&this.appOptions.isOffline&&this.api.asc_isSignaturesSupport()&&!1!==this.permissions.protect&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle),this.appOptions.isPasswordSupport=this.appOptions.isEdit&&this.api.asc_isProtectionSupport()&&!1!==this.permissions.protect&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle),this.appOptions.canProtect=this.appOptions.isSignatureSupport||this.appOptions.isPasswordSupport,this.appOptions.canHelp=!("object"==typeof this.editorConfig.customization&&!1===this.editorConfig.customization.help),this.appOptions.isRestrictedEdit=!this.appOptions.isEdit&&this.appOptions.canComments,this.appOptions.canLiveView=!!t.asc_getLiveViewerSupport()&&"view"===this.editorConfig.mode,this.appOptions.canChangeCoAuthoring=this.appOptions.isEdit&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&this.appOptions.canCoAuthoring&&!(this.editorConfig.coEditing&&"object"==typeof this.editorConfig.coEditing&&!1===this.editorConfig.coEditing.change)||this.appOptions.canLiveView&&!(this.editorConfig.coEditing&&"object"==typeof this.editorConfig.coEditing&&!1===this.editorConfig.coEditing.change),this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||(this.appOptions.canBrandingExt=t.asc_getCanBranding()&&("object"==typeof this.editorConfig.customization||this.editorConfig.plugins),this.getApplication().getController("Common.Controllers.Plugins").setMode(this.appOptions),this.appOptions.canBrandingExt&&this.editorConfig.customization&&Common.UI.LayoutManager.init(this.editorConfig.customization.layout),this.editorConfig.customization&&Common.UI.FeaturesManager.init(this.editorConfig.customization.features,this.appOptions.canBrandingExt)),this.appOptions.canUseHistory=this.appOptions.canLicense&&this.editorConfig.canUseHistory&&this.appOptions.canCoAuthoring&&!this.appOptions.isOffline,this.appOptions.canHistoryClose=this.editorConfig.canHistoryClose,this.appOptions.canHistoryRestore=this.editorConfig.canHistoryRestore,this.appOptions.isLightVersion&&(this.appOptions.canUseHistory=!1),this.loadCoAuthSettings(),this.applyModeCommonElements(),this.applyModeEditorElements(),this.appOptions.isEdit||(Common.NotificationCenter.trigger("app:face",this.appOptions),this.hidePreloader(),this.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,e)),this.api.asc_setViewMode(!this.appOptions.isEdit&&!this.appOptions.isRestrictedEdit),this.appOptions.isRestrictedEdit&&this.appOptions.canComments&&this.api.asc_setRestriction(Asc.c_oAscRestrictionType.OnlyComments),this.api.asc_LoadDocument()},loadCoAuthSettings:function(){var t,e=!0,i=1;this.appOptions.isEdit&&!this.appOptions.isOffline&&this.appOptions.canCoAuthoring?(this.appOptions.canChangeCoAuthoring?null===(t=Common.localStorage.getItem("sse-settings-coauthmode"))&&null===(t=this.editorConfig.coEditing&&void 0!==this.editorConfig.coEditing.mode?"strict"===this.editorConfig.coEditing.mode?0:1:null)&&!Common.localStorage.itemExists("sse-settings-autosave")&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0):null===(t=this.editorConfig.coEditing&&void 0!==this.editorConfig.coEditing.mode?"strict"===this.editorConfig.coEditing.mode?0:1:null)&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0),e=null===t||1==parseInt(t)):!this.appOptions.isEdit&&this.appOptions.isRestrictedEdit?e=!0:this.appOptions.canLiveView&&!this.appOptions.isOffline?(t=Common.localStorage.getItem("sse-settings-view-coauthmode"),this.appOptions.canChangeCoAuthoring&&null!==t||(t=this.editorConfig.coEditing&&"strict"===this.editorConfig.coEditing.mode?0:1),e=1==parseInt(t)):(e=!1,i=0),this.appOptions.isEdit&&this.appOptions.canAutosave&&(null===(t=Common.localStorage.getItem("sse-settings-autosave"))&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0),i=e||null===t?this.appOptions.canCoAuthoring?1:0:parseInt(t)),Common.Utils.InternalSettings.set("sse-settings-coauthmode",e),Common.Utils.InternalSettings.set("sse-settings-autosave",i)},applyModeCommonElements:function(){window.editor_elements_prepared=!0;var t=this.getApplication(),e=t.getController("Viewport").getView("Viewport"),i=t.getController("Statusbar").getView("Statusbar");if(this.headerView&&this.headerView.setVisible(!(this.appOptions.isEditMailMerge||this.appOptions.isDesktopApp||this.appOptions.isEditDiagram||this.appOptions.isEditOle)),e&&e.setMode(this.appOptions,!0),i&&i.setMode(this.appOptions),t.getController("Toolbar").setMode(this.appOptions),t.getController("DocumentHolder").setMode(this.appOptions),(this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram)&&i.hide(),(this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle)&&(t.getController("LeftMenu").getView("LeftMenu").hide(),$(window).mouseup((function(t){Common.Gateway.internalMessage("processMouse",{event:"mouse:up"})})).mousemove($.proxy((function(t){this.isDiagramDrag&&Common.Gateway.internalMessage("processMouse",{event:"mouse:move",pagex:t.pageX*Common.Utils.zoom(),pagey:t.pageY*Common.Utils.zoom()})}),this))),this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle)this.api.asc_registerCallback("asc_sendFromFrameToGeneralEditor",_.bind(this.onSendFromFrameToGeneralEditor,this)),this.appOptions.isEditOle&&this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this));else{this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.api.asc_registerCallback("asc_onDocumentModifiedChanged",_.bind(this.onDocumentModifiedChanged,this));var n=t.getController("Print");n&&this.api&&n.setApi(this.api).setMode(this.appOptions)}var o=this.getApplication().getController("CellEditor");o&&o.setApi(this.api).setMode(this.appOptions)},applyModeEditorElements:function(i){var n=this.getApplication().getController("Common.Controllers.Comments");n&&(n.setMode(this.appOptions),n.setConfig({config:this.editorConfig,sdkviewname:"#ws-canvas-outer",hintmode:!0},this.api));var o=this,s=this.getApplication();s.getController("Common.Controllers.ReviewChanges").setMode(o.appOptions).setConfig({config:o.editorConfig},o.api).loadDocument({doc:o.appOptions.spreadsheet});var a=Common.localStorage.getItem("sse-settings-unit");void 0===(a=null!==a?parseInt(a):o.appOptions.customization&&o.appOptions.customization.unit?Common.Utils.Metric.c_MetricUnits[o.appOptions.customization.unit.toLocaleLowerCase()]:Common.Utils.Metric.getDefaultMetric())&&(a=Common.Utils.Metric.getDefaultMetric()),Common.Utils.Metric.setCurrentMetric(a),Common.Utils.InternalSettings.set("sse-settings-unit",a);var l=s.getController("Toolbar");if(l&&l.setApi(o.api),this.appOptions.isRestrictedEdit)s.getController("WBProtection").setMode(o.appOptions).setConfig({config:o.editorConfig},o.api);else if(this.appOptions.isEdit){var r=s.getController("Statusbar"),c=s.getController("RightMenu"),d=s.getController("Common.Controllers.Fonts");if(d&&d.setApi(o.api),c&&c.setApi(o.api),s.getController("Common.Controllers.Protection").setMode(o.appOptions).setConfig({config:o.editorConfig},o.api),s.getController("WBProtection").setMode(o.appOptions).setConfig({config:o.editorConfig},o.api),r&&(r.getView("Statusbar").changeViewMode(o.appOptions),o.appOptions.isEditOle&&r.onChangeViewMode(null,!0,!0)),o.appOptions.isEditMailMerge||o.appOptions.isEditDiagram||o.appOptions.isEditOle||!o.appOptions.canFeaturePivot||s.getController("PivotTable").setMode(o.appOptions),this.getApplication().getController("Viewport").getView("Viewport").applyEditorMode(),c.getView("RightMenu").setMode(o.appOptions).setApi(o.api),this.toolbarView=l.getView("Toolbar"),o.appOptions.isEditMailMerge||o.appOptions.isEditDiagram||o.appOptions.isEditOle)c.getView("RightMenu").hide();else{var h={};JSON.parse(Common.localStorage.getItem("sse-hidden-formula"))&&(h.formula=!0),s.getController("Toolbar").hideElements(h)}o.api.asc_registerCallback("asc_onCollaborativeChanges",_.bind(o.onCollaborativeChanges,o)),o.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(o.onAuthParticipantsChanged,o)),o.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(o.onAuthParticipantsChanged,o)),o.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(o.onUserConnection,o)),o.api.asc_registerCallback("asc_onConvertEquationToMath",_.bind(o.onConvertEquationToMath,o)),o.appOptions.isEditDiagram&&o.api.asc_registerCallback("asc_onSelectionChanged",_.bind(o.onSelectionChanged,o)),o.api.asc_setFilteringMode&&o.api.asc_setFilteringMode(o.appOptions.canModifyFilter),o.stackLongActions.exist({id:t,type:Asc.c_oAscAsyncActionType.BlockInteraction})?o.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,t):this._isDocReady||(Common.NotificationCenter.trigger("app:face",this.appOptions),o.hidePreloader(),o.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,e)),window.onbeforeunload=_.bind(o.onBeforeUnload,o),window.onunload=_.bind(o.onUnload,o)}},onExternalMessage:function(t,e){t&&t.msg&&(t.msg=t.msg.toString(),this.showTips([t.msg.charAt(0).toUpperCase()+t.msg.substring(1)],e),Common.component.Analytics.trackEvent("External Error"))},onError:function(t,i,n,o){if(this.isFrameClosed)this.lastFrameError={id:t,level:i,errData:n,callback:o};else{if(t==Asc.c_oAscError.ID.LoadingScriptError)return this.showTips([this.scriptLoadError]),void(this.tooltip&&this.tooltip.getBSTip().$tip.css("z-index",1e4));this.hidePreloader(),this.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e);var s={closable:!0};switch(t){case Asc.c_oAscError.ID.Unknown:s.msg=this.unknownErrorText;break;case Asc.c_oAscError.ID.ConvertationTimeout:s.msg=this.convertationTimeoutText;break;case Asc.c_oAscError.ID.ConvertationOpenError:s.msg=this.openErrorText;break;case Asc.c_oAscError.ID.ConvertationSaveError:s.msg=this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.saveErrorTextDesktop:this.saveErrorText;break;case Asc.c_oAscError.ID.DownloadError:s.msg=this.downloadErrorText;break;case Asc.c_oAscError.ID.UplImageSize:s.msg=this.uploadImageSizeMessage;break;case Asc.c_oAscError.ID.UplImageExt:s.msg=this.uploadImageExtMessage;break;case Asc.c_oAscError.ID.UplImageFileCount:s.msg=this.uploadImageFileCountMessage;break;case Asc.c_oAscError.ID.PastInMergeAreaError:s.msg=this.pastInMergeAreaError;break;case Asc.c_oAscError.ID.FrmlWrongCountParentheses:s.msg=this.errorWrongBracketsCount;break;case Asc.c_oAscError.ID.FrmlWrongOperator:s.msg=this.errorWrongOperator;break;case Asc.c_oAscError.ID.FrmlWrongMaxArgument:s.msg=this.errorCountArgExceed;break;case Asc.c_oAscError.ID.FrmlWrongCountArgument:s.msg=this.errorCountArg;break;case Asc.c_oAscError.ID.FrmlWrongFunctionName:s.msg=this.errorFormulaName;break;case Asc.c_oAscError.ID.FrmlAnotherParsingError:s.msg=this.errorFormulaParsing;break;case Asc.c_oAscError.ID.FrmlWrongArgumentRange:s.msg=this.errorArgsRange;break;case Asc.c_oAscError.ID.FrmlOperandExpected:s.msg=this.errorOperandExpected;break;case Asc.c_oAscError.ID.FrmlWrongReferences:s.msg=this.errorFrmlWrongReferences;break;case Asc.c_oAscError.ID.UnexpectedGuid:s.msg=this.errorUnexpectedGuid;break;case Asc.c_oAscError.ID.Database:s.msg=this.errorDatabaseConnection;break;case Asc.c_oAscError.ID.FileRequest:s.msg=this.errorFileRequest;break;case Asc.c_oAscError.ID.FileVKey:s.msg=this.errorFileVKey;break;case Asc.c_oAscError.ID.StockChartError:s.msg=this.errorStockChart;break;case Asc.c_oAscError.ID.MaxDataSeriesError:s.msg=this.getApplication().getController("Toolbar").errorMaxRows;break;case Asc.c_oAscError.ID.ComboSeriesError:s.msg=this.getApplication().getController("Toolbar").errorComboSeries;break;case Asc.c_oAscError.ID.DataRangeError:s.msg=this.errorDataRange;break;case Asc.c_oAscError.ID.MaxDataPointsError:s.msg=this.errorMaxPoints;break;case Asc.c_oAscError.ID.VKeyEncrypt:s.msg=this.errorToken;break;case Asc.c_oAscError.ID.KeyExpire:s.msg=this.errorTokenExpire;break;case Asc.c_oAscError.ID.UserCountExceed:s.msg=this.errorUsersExceed;break;case Asc.c_oAscError.ID.CannotMoveRange:s.msg=this.errorMoveRange;break;case Asc.c_oAscError.ID.UplImageUrl:s.msg=this.errorBadImageUrl;break;case Asc.c_oAscError.ID.CoAuthoringDisconnect:s.msg=this.errorViewerDisconnect;break;case Asc.c_oAscError.ID.ConvertationPassword:s.msg=this.errorFilePassProtect;break;case Asc.c_oAscError.ID.AutoFilterDataRangeError:s.msg=this.errorAutoFilterDataRange;break;case Asc.c_oAscError.ID.AutoFilterChangeFormatTableError:s.msg=this.errorAutoFilterChangeFormatTable;break;case Asc.c_oAscError.ID.AutoFilterChangeError:s.msg=this.errorAutoFilterChange;break;case Asc.c_oAscError.ID.AutoFilterMoveToHiddenRangeError:s.msg=this.errorAutoFilterHiddenRange;break;case Asc.c_oAscError.ID.CannotFillRange:s.msg=this.errorFillRange;break;case Asc.c_oAscError.ID.UserDrop:if(this._state.lostEditingRights)return void(this._state.lostEditingRights=!1);this._state.lostEditingRights=!0,s.msg=this.errorUserDrop,Common.NotificationCenter.trigger("collaboration:sharingdeny");break;case Asc.c_oAscError.ID.InvalidReferenceOrName:s.msg=this.errorInvalidRef;break;case Asc.c_oAscError.ID.LockCreateDefName:s.msg=this.errorCreateDefName;break;case Asc.c_oAscError.ID.PasteMaxRangeError:s.msg=this.errorPasteMaxRange;break;case Asc.c_oAscError.ID.LockedAllError:s.msg=this.errorLockedAll;break;case Asc.c_oAscError.ID.Warning:s.msg=this.errorConnectToServer,s.closable=!1;break;case Asc.c_oAscError.ID.LockedWorksheetRename:s.msg=this.errorLockedWorksheetRename;break;case Asc.c_oAscError.ID.OpenWarning:s.msg=this.errorOpenWarning;break;case Asc.c_oAscError.ID.CopyMultiselectAreaError:s.msg=this.errorCopyMultiselectArea;break;case Asc.c_oAscError.ID.PrintMaxPagesCount:s.msg=this.errorPrintMaxPagesCount;break;case Asc.c_oAscError.ID.SessionAbsolute:s.msg=this.errorSessionAbsolute;break;case Asc.c_oAscError.ID.SessionIdle:s.msg=this.errorSessionIdle;break;case Asc.c_oAscError.ID.SessionToken:s.msg=this.errorSessionToken;break;case Asc.c_oAscError.ID.AccessDeny:s.msg=this.errorAccessDeny;break;case Asc.c_oAscError.ID.LockedCellPivot:s.msg=this.errorLockedCellPivot;break;case Asc.c_oAscError.ID.PivotLabledColumns:s.msg=this.errorLabledColumnsPivot;break;case Asc.c_oAscError.ID.PivotOverlap:s.msg=this.errorPivotOverlap;break;case Asc.c_oAscError.ID.ForceSaveButton:case Asc.c_oAscError.ID.ForceSaveTimeout:s.msg=this.errorForceSave,s.maxwidth=600;break;case Asc.c_oAscError.ID.DataEncrypted:s.msg=this.errorDataEncrypted;break;case Asc.c_oAscError.ID.EditingError:s.msg=this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.errorEditingSaveas:this.errorEditingDownloadas;break;case Asc.c_oAscError.ID.CannotChangeFormulaArray:s.msg=this.errorChangeArray;break;case Asc.c_oAscError.ID.MultiCellsInTablesFormulaArray:s.msg=this.errorMultiCellFormula;break;case Asc.c_oAscError.ID.MailToClientMissing:s.msg=this.errorEmailClient;break;case Asc.c_oAscError.ID.NoDataToParse:s.msg=this.errorNoDataToParse;break;case Asc.c_oAscError.ID.CannotUngroupError:s.msg=this.errorCannotUngroup;break;case Asc.c_oAscError.ID.FrmlMaxTextLength:s.msg=this.errorFrmlMaxTextLength;break;case Asc.c_oAscError.ID.FrmlMaxReference:s.msg=this.errorFrmlMaxReference;break;case Asc.c_oAscError.ID.DataValidate:var a=n?n.asc_getErrorStyle():void 0;void 0!==a&&(s.iconCls=a==Asc.c_oAscEDataValidationErrorStyle.Stop?"error":a==Asc.c_oAscEDataValidationErrorStyle.Information?"info":"warn"),n&&n.asc_getErrorTitle()&&(s.title=Common.Utils.String.htmlEncode(n.asc_getErrorTitle())),s.buttons=["ok","cancel"],s.msg=n&&n.asc_getError()?Common.Utils.String.htmlEncode(n.asc_getError()):this.errorDataValidate,s.maxwidth=600;break;case Asc.c_oAscError.ID.ConvertationOpenLimitError:s.msg=this.errorFileSizeExceed;break;case Asc.c_oAscError.ID.UpdateVersion:s.msg=this.errorUpdateVersionOnDisconnect,s.maxwidth=600;break;case Asc.c_oAscError.ID.FTChangeTableRangeError:s.msg=this.errorFTChangeTableRangeError;break;case Asc.c_oAscError.ID.FTRangeIncludedOtherTables:s.msg=this.errorFTRangeIncludedOtherTables;break;case Asc.c_oAscError.ID.PasteSlicerError:s.msg=this.errorPasteSlicerError;break;case Asc.c_oAscError.ID.RemoveDuplicates:s.iconCls="info",s.title=Common.UI.Window.prototype.textInformation,s.buttons=["ok"],s.msg=null!==n.asc_getDuplicateValues()&&null!==n.asc_getUniqueValues()?Common.Utils.String.format(this.errRemDuplicates,n.asc_getDuplicateValues(),n.asc_getUniqueValues()):this.errNoDuplicates,s.maxwidth=600;break;case Asc.c_oAscError.ID.FrmlMaxLength:s.msg=this.errorFrmlMaxLength,s.maxwidth=600;break;case Asc.c_oAscError.ID.MoveSlicerError:s.msg=this.errorMoveSlicerError;break;case Asc.c_oAscError.ID.LockedEditView:s.msg=this.errorEditView;break;case Asc.c_oAscError.ID.ChangeFilteredRangeError:s.msg=this.errorChangeFilteredRange;break;case Asc.c_oAscError.ID.Password:s.msg=this.errorSetPassword;break;case Asc.c_oAscError.ID.PivotGroup:s.msg=this.errorPivotGroup;break;case Asc.c_oAscError.ID.PasteMultiSelectError:s.msg=this.errorPasteMultiSelect;break;case Asc.c_oAscError.ID.PivotWithoutUnderlyingData:s.msg=this.errorPivotWithoutUnderlying;break;case Asc.c_oAscError.ID.ChangeOnProtectedSheet:s.msg=this.errorChangeOnProtectedSheet;break;case Asc.c_oAscError.ID.SingleColumnOrRowError:s.msg=this.errorSingleColumnOrRowError;break;case Asc.c_oAscError.ID.LocationOrDataRangeError:s.msg=this.errorLocationOrDataRangeError;break;case Asc.c_oAscError.ID.PasswordIsNotCorrect:s.msg=this.errorPasswordIsNotCorrect;break;case Asc.c_oAscError.ID.UplDocumentSize:s.msg=this.uploadDocSizeMessage;break;case Asc.c_oAscError.ID.DeleteColumnContainsLockedCell:s.msg=this.errorDeleteColumnContainsLockedCell;break;case Asc.c_oAscError.ID.UplDocumentExt:s.msg=this.uploadDocExtMessage;break;case Asc.c_oAscError.ID.DeleteRowContainsLockedCell:s.msg=this.errorDeleteRowContainsLockedCell;break;case Asc.c_oAscError.ID.UplDocumentFileCount:s.msg=this.uploadDocFileCountMessage;break;case Asc.c_oAscError.ID.LoadingFontError:s.msg=this.errorLoadingFont;break;case Asc.c_oAscError.ID.FillAllRowsWarning:var l,r=n[0],c=n[1],d=(this.appOptions.lang||"en").replace("_","-").toLowerCase();try{l=r.toLocaleString(d)}catch(t){d="en",l=r.toLocaleString(d)}this.appOptions.isDesktopApp&&this.appOptions.isOffline?(s.msg=r>c?Common.Utils.String.format(this.textFormulaFilledAllRowsWithEmpty,l):Common.Utils.String.format(this.textFormulaFilledAllRows,l),s.buttons=[{caption:this.textFillOtherRows,primary:!0,value:"fillOther"},"close"]):(s.msg=r>=c?Common.Utils.String.format(this.textFormulaFilledFirstRowsOtherIsEmpty,l):Common.Utils.String.format(this.textFormulaFilledFirstRowsOtherHaveData,l,(c-r).toLocaleString(d)),s.buttons=["ok"]),s.maxwidth=400;break;case Asc.c_oAscError.ID.CannotUseCommandProtectedSheet:s.msg=this.errorCannotUseCommandProtectedSheet;break;default:s.msg="string"==typeof t?t:this.errorDefaultMessage.replace("%1",t)}i==Asc.c_oAscError.Level.Critical?(Common.Gateway.reportError(t,s.msg),s.title=this.criticalErrorTitle,s.iconCls="error",s.closable=!1,this.appOptions.canBackToFolder&&!this.appOptions.isDesktopApp&&"string"!=typeof t&&(s.msg+="<br><br>"+this.criticalErrorExtText,s.callback=function(t){"ok"==t&&Common.NotificationCenter.trigger("goback",!0)}),t!=Asc.c_oAscError.ID.DataEncrypted&&t!=Asc.c_oAscError.ID.ConvertationOpenLimitError||(this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("api:disconnect"))):(Common.Gateway.reportWarning(t,s.msg),s.title=s.title||this.notcriticalErrorTitle,s.iconCls=s.iconCls||"warn",s.buttons=s.buttons||["ok"],s.callback=_.bind((function(e){t==Asc.c_oAscError.ID.Warning&&"ok"==e&&this.appOptions.canDownload?(Common.UI.Menu.Manager.hideAll(),this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.api.asc_DownloadAs():this.getApplication().getController("LeftMenu").leftMenu.showMenu("file:saveas")):t==Asc.c_oAscError.ID.EditingError?(this.disableEditing(!0),Common.NotificationCenter.trigger("api:disconnect",!0)):t==Asc.c_oAscError.ID.DataValidate&&"ok"!==e?this.api.asc_closeCellEditor(!0):t==Asc.c_oAscError.ID.FillAllRowsWarning&&"fillOther"===e&&_.isFunction(o)&&o(),this._state.lostEditingRights=!1,this.onEditComplete()}),this)),(!Common.Utils.ModalWindow.isVisible()||$(".asc-window.modal.alert[data-value="+t+"]").length<1)&&setTimeout((function(){Common.UI.alert(s).$window.attr("data-value",t)}),1),void 0!==t&&Common.component.Analytics.trackEvent("Internal Error",t.toString())}},onCoAuthoringDisconnect:function(){this.getApplication().getController("Viewport").getView("Viewport").setMode({isDisconnected:!0}),this.getApplication().getController("Viewport").getView("Common.Views.Header").setCanRename(!1),this.appOptions.canRename=!1,this._state.isDisconnected=!0},showTips:function(t,e){var i=this;function n(t){i.tipTimeout&&clearTimeout(i.tipTimeout),setTimeout(o,300)}function o(){var o=t.shift();o&&(e&&e.hideCloseTip||(o+="\n"+i.textCloseTip),i.tooltip.setTitle(o),i.tooltip.show(),i.tipTimeout&&clearTimeout(i.tipTimeout),e&&e.timeout&&(i.tipTimeout=setTimeout((function(){i.tooltip.hide(),n()}),e.timeout)))}t.length&&("object"!=typeof t&&(t=[t]),this.tooltip||(this.tooltip=new Common.UI.Tooltip({owner:this.getApplication().getController("Toolbar").getView("Toolbar"),hideonclick:!0,placement:"bottom",cls:"main-info",offset:30}),this.tooltip.on("tooltip:hideonclick",n)),o())},updateWindowTitle:function(t,e){if(this._state.isDocModified!==t||e){if(this.headerView){var i=this.defaultTitleText;if(_.isEmpty(this.headerView.getDocumentCaption())||(i=this.headerView.getDocumentCaption()+" - "+i),t)clearTimeout(this._state.timerCaption),_.isUndefined(i)||(i="* "+i,this.headerView.setDocumentCaption(this.headerView.getDocumentCaption(),!0));else if(this._state.fastCoauth&&this._state.usersCount>1){var n=this;this._state.timerCaption=setTimeout((function(){n.headerView.setDocumentCaption(n.headerView.getDocumentCaption(),!1)}),500)}else this.headerView.setDocumentCaption(this.headerView.getDocumentCaption(),!1);window.document.title!=i&&(window.document.title=i)}this._isDocReady&&this._state.isDocModified!==t&&Common.Gateway.setDocumentModified(t),t&&(!this._state.fastCoauth||this._state.usersCount<2)&&this.getApplication().getController("Statusbar").setStatusCaption("",!0),this._state.isDocModified=t}},onDocumentChanged:function(){},onDocumentModifiedChanged:function(t){if(this.updateWindowTitle(t),this._state.isDocModified!==t&&this._isDocReady&&Common.Gateway.setDocumentModified(t),this.toolbarView&&this.toolbarView.btnCollabChanges&&this.api){var e=this.toolbarView.btnCollabChanges.cmpEl.hasClass("notify"),i=this.appOptions.forcesave,n=!this.api.asc_isDocumentCanSave()&&!e&&!i||this._state.isDisconnected||this._state.fastCoauth&&this._state.usersCount>1&&!i;this.toolbarView.btnSave.setDisabled(n)}},onDocumentCanSaveChanged:function(t){if(this.toolbarView&&this.toolbarView.btnCollabChanges){var e=this.toolbarView.btnCollabChanges.cmpEl.hasClass("notify"),i=this.appOptions.forcesave,n=!t&&!e&&!i||this._state.isDisconnected||this._state.fastCoauth&&this._state.usersCount>1&&!i;this.toolbarView.btnSave.setDisabled(n)}},onBeforeUnload:function(){if(Common.localStorage.save(),!1!==this.permissions.edit&&"view"!==this.editorConfig.mode&&"editdiagram"!==this.editorConfig.mode&&"editmerge"!==this.editorConfig.mode&&"editole"!==this.editorConfig.mode&&this.api.asc_isDocumentModified()){var t=this;return this.api.asc_stopSaving(),this._state.unloadTimer=1e3,this.continueSavingTimer=window.setTimeout((function(){t.api.asc_continueSaving(),t._state.unloadTimer=0}),500),this.leavePageText}this._state.unloadTimer=1e4},onUnload:function(){this.continueSavingTimer&&clearTimeout(this.continueSavingTimer)},hidePreloader:function(){var t;this._state.customizationDone||(this._state.customizationDone=!0,this.appOptions.customization&&(this.appOptions.isDesktopApp?this.appOptions.customization.about=!1:this.appOptions.canBrandingExt||(this.appOptions.customization.about=!0)),Common.Utils.applyCustomization(this.appOptions.customization,i),this.appOptions.canBrandingExt&&(Common.Utils.applyCustomization(this.appOptions.customization,n),Common.UI.LayoutManager.applyCustomization(),this.appOptions.customization&&"object"==typeof this.appOptions.customization&&(void 0!==this.appOptions.customization.leftMenu&&console.log("Obsolete: The 'leftMenu' parameter of the 'customization' section is deprecated. Please use 'leftMenu' parameter in the 'customization.layout' section instead."),void 0!==this.appOptions.customization.rightMenu&&console.log("Obsolete: The 'rightMenu' parameter of the 'customization' section is deprecated. Please use 'rightMenu' parameter in the 'customization.layout' section instead."),void 0!==this.appOptions.customization.statusBar&&console.log("Obsolete: The 'statusBar' parameter of the 'customization' section is deprecated. Please use 'statusBar' parameter in the 'customization.layout' section instead."),void 0!==this.appOptions.customization.toolbar&&console.log("Obsolete: The 'toolbar' parameter of the 'customization' section is deprecated. Please use 'toolbar' parameter in the 'customization.layout' section instead.")),t=this.getApplication().getController("Common.Controllers.Plugins").applyUICustomization())),this.stackLongActions.pop({id:-254,type:Asc.c_oAscAsyncActionType.BlockInteraction}),Common.NotificationCenter.trigger("layout:changed","main"),(t||new Promise((function(t,e){t()}))).then((function(){$("#loading-mask").hide().remove(),Common.Controllers.Desktop.process("preloader:hide")}))},onDownloadUrl:function(t,e){this._state.isFromGatewayDownloadAs&&Common.Gateway.downloadAs(t,e),this._state.isFromGatewayDownloadAs=!1},onDownloadCancel:function(){this._state.isFromGatewayDownloadAs=!1},onUpdateVersion:function(t){var i=this;i.needToUpdateVersion=!0,i.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e),Common.UI.warning({msg:this.errorUpdateVersion,callback:function(){_.defer((function(){Common.Gateway.updateVersion(),t&&t.call(i),i.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,e)}))}})},onServerVersion:function(t){return!!this.changeServerVersion||DocsAPI.DocEditor.version()!==t&&!window.compareVersions&&(this.changeServerVersion=!0,Common.UI.warning({title:this.titleServerVersion,msg:this.errorServerVersion,callback:function(){_.defer((function(){Common.Gateway.updateVersion()}))}}),!0)},onAdvancedOptions:function(t,i,n,o){if(!this._state.openDlg){var s=this;t==Asc.c_oAscAdvancedOptionsID.CSV?s._state.openDlg=new Common.Views.OpenDialog({title:Common.Views.OpenDialog.prototype.txtTitle.replace("%1","CSV"),closable:2==n,type:Common.Utils.importTextType.CSV,preview:i.asc_getData(),codepages:i.asc_getCodePages(),settings:i.asc_getRecommendedSettings(),api:s.api,handler:function(e,i){s.isShowOpenDialog=!1,"ok"==e&&s&&s.api&&(2==n?(o&&o.asc_setAdvancedOptions(i.textOptions),s.api.asc_DownloadAs(o)):s.api.asc_setAdvancedOptions(t,i.textOptions),s.loadMask&&s.loadMask.show()),s._state.openDlg=null}}):t==Asc.c_oAscAdvancedOptionsID.DRM&&(s._state.openDlg=new Common.Views.OpenDialog({title:Common.Views.OpenDialog.prototype.txtTitleProtected,closeFile:s.appOptions.canRequestClose,type:Common.Utils.importTextType.DRM,warning:!(s.appOptions.isDesktopApp&&s.appOptions.isOffline)&&"string"==typeof i,warningMsg:i,validatePwd:!!s._state.isDRM,handler:function(e,i){s.isShowOpenDialog=!1,"ok"==e?s&&s.api&&(s.api.asc_setAdvancedOptions(t,i.drmOptions),s.loadMask&&s.loadMask.show()):(Common.Gateway.requestClose(),Common.Controllers.Desktop.requestClose()),s._state.openDlg=null}}),s._state.isDRM=!0),s._state.openDlg&&(this.isShowOpenDialog=!0,this.loadMask&&this.loadMask.hide(),this.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e),s._state.openDlg.show())}},onActiveSheetChanged:function(t){this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||!window.editor_elements_prepared||(this.application.getController("Statusbar").selectTab(t),this.appOptions.isEditOle||!this.appOptions.canViewComments||this.dontCloseDummyComment||Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+this.api.asc_getWorksheetId(t)],!1))},onConfirmAction:function(t,e,i){var n=this;t==Asc.c_oAscConfirm.ConfirmReplaceRange||t==Asc.c_oAscConfirm.ConfirmReplaceFormulaInTable?Common.UI.warning({title:this.notcriticalErrorTitle,msg:t==Asc.c_oAscConfirm.ConfirmReplaceRange?this.confirmMoveCellRange:this.confirmReplaceFormulaInTable,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t){e&&e("yes"===t),"yes"==t&&n.onEditComplete(n.application.getController("DocumentHolder").getView("DocumentHolder"))}),this)}):t==Asc.c_oAscConfirm.ConfirmPutMergeRange?Common.UI.warning({closable:!1,title:this.notcriticalErrorTitle,msg:this.confirmPutMergeRange,buttons:["ok"],primary:"ok",callback:_.bind((function(t){e&&e(),n.onEditComplete(n.application.getController("DocumentHolder").getView("DocumentHolder"))}),this)}):t==Asc.c_oAscConfirm.ConfirmChangeProtectRange?new Common.Views.OpenDialog({title:this.txtUnlockRange,closable:!0,type:Common.Utils.importTextType.DRM,warning:!0,warningMsg:this.txtUnlockRangeWarning,txtOpenFile:this.txtUnlockRangeDescription,validatePwd:!1,handler:function(t,o){n.api&&e&&("ok"==t?n.api.asc_checkProtectedRangesPassword(o.drmOptions.asc_getPassword(),i,(function(t){e(t,!1)})):e(!1,!0)),n.onEditComplete(n.application.getController("DocumentHolder").getView("DocumentHolder"))}}).show():t==Asc.c_oAscConfirm.ConfirmMaxChangesSize&&Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.confirmMaxChangesSize,buttons:[{value:"ok",caption:this.textUndo,primary:!0},{value:"cancel",caption:this.textContinue}],maxwidth:600,callback:_.bind((function(t){e&&e("ok"===t),n.onEditComplete(n.application.getController("DocumentHolder").getView("DocumentHolder"))}),this)})},checkProtectedRange:function(t,e,i){var n=!(!this.api.asc_isProtectedSheet()||!this.api.asc_checkLockedCells())&&this.api.asc_checkProtectedRange();if(null!==n)if(n){var o=this,s=new Common.Views.OpenDialog({title:this.txtUnlockRange,closable:!0,type:Common.Utils.importTextType.DRM,warning:!0,warningMsg:this.txtUnlockRangeWarning,txtOpenFile:this.txtUnlockRangeDescription,validatePwd:!1,handler:function(n,s){"ok"==n&&o.api&&o.api.asc_checkActiveCellPassword(s.drmOptions.asc_getPassword(),(function(n){n?t&&setTimeout((function(){t.apply(e,i)}),1):Common.UI.warning({msg:o.errorWrongPassword,callback:function(){Common.NotificationCenter.trigger("edit:complete",o.toolbar)}})})),Common.NotificationCenter.trigger("edit:complete",o.toolbar)}});s.show()}else t&&setTimeout((function(){t.apply(e,i)}),1);else this.onError(Asc.c_oAscError.ID.ChangeOnProtectedSheet,Asc.c_oAscError.Level.NoCritical)},initNames:function(){this.shapeGroupNames=[this.txtBasicShapes,this.txtFiguredArrows,this.txtMath,this.txtCharts,this.txtStarsRibbons,this.txtCallouts,this.txtButtons,this.txtRectangles,this.txtLines]},fillAutoShapes:function(t,e){if(!_.isEmpty(e)&&!_.isEmpty(t)&&e.length==t.length){var i=this,n=[],o=this.getCollection("ShapeGroups"),s={};o.reset(),_.each(t,(function(t,o){var a=new Backbone.Collection([],{model:SSE.Models.ShapeModel}),l=[],r=e[o].length>18?7:6,c=35*Math.ceil(e[o].length/r)+3,d=30*r;_.each(e[o],(function(t,e){var n=i["txtShape_"+t.Type];l.push({data:{shapeType:t.Type},tip:n||i.textShape+" "+(e+1),allowSelected:!0,selected:!1}),n&&(s[t.Type]=n)})),a.add(l),n.push({groupName:i.shapeGroupNames[o],groupStore:a,groupWidth:d,groupHeight:c})})),o.add(n),setTimeout((function(){i.getApplication().getController("Toolbar").onApiAutoShapes()}),50),this.api.asc_setShapeNames(s)}},fillTextArt:function(t){var e=[],i=this.getCollection("Common.Collections.TextArt");!t&&i.length>0&&(t=this.api.asc_getTextArtPreviews()),_.isEmpty(t)||(_.each(t,(function(t,i){e.push({imageUrl:t,data:i,allowSelected:!0,selected:!1})})),i.reset(e))},fillCondFormatIcons:function(t){if(!_.isEmpty(t)){var e=[],i=this.getCollection("ConditionalFormatIcons");_.each(t,(function(t,i){e.push({icon:t,index:i})})),i.reset(e)}},fillCondFormatIconsPresets:function(t){if(!_.isEmpty(t)){var e=[],i=this.getCollection("ConditionalFormatIconsPresets");_.each(t,(function(t,i){e.push({icons:t,data:i})})),i.reset(e)}},updateThemeColors:function(){var t=this;!t.appOptions.isEditOle&&setTimeout((function(){t.getApplication().getController("RightMenu").UpdateThemeColors()}),50),setTimeout((function(){t.getApplication().getController("Toolbar").updateThemeColors()}),50),setTimeout((function(){t.getApplication().getController("Statusbar").updateThemeColors()}),50)},onSendThemeColors:function(t,e){if(Common.Utils.ThemeColor.setColors(t,e),window.styles_loaded&&(this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.updateThemeColors(),!this.appOptions.isEditMailMerge&&!this.appOptions.isEditDiagram&&!this.appOptions.isEditOle)){var i=this;setTimeout((function(){i.fillTextArt()}),1)}},loadLanguages:function(t){this.languages=t,window.styles_loaded&&this.setLanguages()},setLanguages:function(){this.getApplication().getController("Spellcheck").setLanguages(this.languages)},onInternalCommand:function(t){if(t)switch(t.command){case"setChartData":this.setChartData(t.data);break;case"getChartData":this.getChartData();break;case"clearChartData":this.clearChartData();break;case"setMergeData":this.setMergeData(t.data);break;case"getMergeData":this.getMergeData();break;case"setOleData":this.setOleData(t.data);break;case"getOleData":this.getOleData();break;case"setAppDisabled":void 0!==this.isAppDisabled||t.data||(Common.NotificationCenter.trigger("layout:changed","main"),this.loadMask&&this.loadMask.isVisible()&&this.loadMask.updatePosition()),this.isAppDisabled=t.data;break;case"queryClose":Common.Utils.ModalWindow.isVisible()?Common.Gateway.internalMessage("canClose",{answer:!1}):(this.isFrameClosed=!0,this.api.asc_closeCellEditor(),this.appOptions.isEditOle&&Common.NotificationCenter.trigger("oleedit:close"),Common.UI.Menu.Manager.hideAll(),Common.Gateway.internalMessage("canClose",{mr:t.data.mr,answer:!0}));break;case"window:drag":this.isDiagramDrag=t.data;break;case"processmouse":this.onProcessMouse(t.data);break;case"theme:change":document.documentElement.className=document.documentElement.className.replace(/theme-\w+\s?/,t.data),this.api.asc_setSkin("theme-dark"==t.data?"flatDark":"flat");break;case"generalToFrameData":this.api.asc_getInformationBetweenFrameAndGeneralEditor(t.data)}},setChartData:function(t){"object"==typeof t&&this.api&&(this.api.asc_addChartDrawingObject(t),this.isFrameClosed=!1,this.lastFrameError&&(this.onError(this.lastFrameError.id,this.lastFrameError.level,this.lastFrameError.errData,this.lastFrameError.callback),this.lastFrameError=void 0))},getChartData:function(){if(this.api){var t=this.api.asc_getWordChartObject();"object"==typeof t&&Common.Gateway.internalMessage("chartData",{data:t})}},clearChartData:function(){this.api&&this.api.asc_closeCellEditor()},setOleData:function(t){"object"!=typeof t&&"empty"!==t||!this.api||(this.api.asc_addTableOleObjectInOleEditor("object"==typeof t?t:void 0),this.isFrameClosed=!1,this.lastFrameError&&(this.onError(this.lastFrameError.id,this.lastFrameError.level,this.lastFrameError.errData,this.lastFrameError.callback),this.lastFrameError=void 0))},getOleData:function(){if(this.api){var t=this.api.asc_getBinaryInfoOleObject();"object"==typeof t&&Common.Gateway.internalMessage("oleData",{data:t})}},onOleEditorReady:function(){Common.Gateway.internalMessage("oleEditorReady",{})},setMergeData:function(t){"object"==typeof t&&this.api&&(this.api.asc_setData(t),this.isFrameClosed=!1,this.lastFrameError&&(this.onError(this.lastFrameError.id,this.lastFrameError.level,this.lastFrameError.errData,this.lastFrameError.callback),this.lastFrameError=void 0))},getMergeData:function(){if(this.api){var t=this.api.asc_getData();"object"==typeof t&&Common.Gateway.internalMessage("mergeData",{data:t})}},onSendFromFrameToGeneralEditor:function(t){Common.Gateway.internalMessage("frameToGeneralData",t)},unitsChanged:function(t){var e=Common.localStorage.getItem("sse-settings-unit");e=null!==e?parseInt(e):Common.Utils.Metric.getDefaultMetric(),Common.Utils.Metric.setCurrentMetric(e),Common.Utils.InternalSettings.set("sse-settings-unit",e),this.appOptions.isEdit&&(this.getApplication().getController("RightMenu").updateMetricUnit(),this.getApplication().getController("Toolbar").getView("Toolbar").updateMetricUnit()),this.getApplication().getController("Print").getView("PrintWithPreview").updateMetricUnit()},_compareActionStrong:function(t,e){return t.id===e.id&&t.type===e.type},_compareActionWeak:function(t,e){return t.type===e.type},onContextMenu:function(t){var e=t.target.getAttribute("data-can-copy"),i=t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement;if(i&&"false"===e||!i&&"true"!==e)return t.stopPropagation(),t.preventDefault(),!1},onNamedRangeLocked:function(){$(".asc-window.modal.alert:visible").length<1&&Common.UI.alert({msg:this.errorCreateDefName,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.onEditComplete()}),this)})},onTryUndoInFastCollaborative:function(){var t=window.localStorage.getItem("sse-hide-try-undoredo");t&&1==parseInt(t)||Common.UI.info({width:500,msg:this.appOptions.canChangeCoAuthoring?this.textTryUndoRedo:this.textTryUndoRedoWarn,iconCls:"info",buttons:this.appOptions.canChangeCoAuthoring?["custom","cancel"]:["ok"],primary:this.appOptions.canChangeCoAuthoring?"custom":"ok",customButtonText:this.textStrict,dontshow:!0,callback:_.bind((function(t,e){e&&window.localStorage.setItem("sse-hide-try-undoredo",1),"custom"==t&&(Common.localStorage.setItem("sse-settings-coauthmode",0),this.api.asc_SetFastCollaborative(!1),Common.Utils.InternalSettings.set("sse-settings-coauthmode",!1),this.getApplication().getController("Common.Controllers.ReviewChanges").applySettings(),this._state.fastCoauth=!1),this.onEditComplete()}),this)})},onAuthParticipantsChanged:function(t){var e=0;_.each(t,(function(t){t.asc_getView()||e++})),this._state.usersCount=e},onUserConnection:function(t){if(t&&this.appOptions.user.guest&&this.appOptions.canRenameAnonymous&&t.asc_getIdOriginal()==this.appOptions.user.id){var e=t.asc_getUserName();if(e&&e!==AscCommon.UserInfoParser.getCurrentName()){this._renameDialog&&this._renameDialog.close(),AscCommon.UserInfoParser.setCurrentName(e),this.headerView.setUserName(AscCommon.UserInfoParser.getParsedName(e));var i=e.lastIndexOf("("),n=e.lastIndexOf(")"),o=i>0&&i<n?e.substring(0,i-1):"";null!==Common.localStorage.getItem("guest-username")&&Common.localStorage.setItem("guest-username",o),Common.Utils.InternalSettings.set("guest-username",o)}}},applySettings:function(){if(this.appOptions.isEdit&&!this.appOptions.isOffline&&this.appOptions.canCoAuthoring){var t=Common.localStorage.getItem("sse-settings-coauthmode"),e=this._state.fastCoauth;this._state.fastCoauth=null===t||1==parseInt(t),this._state.fastCoauth&&!e&&this.synchronizeChanges()}this.appOptions.canForcesave&&(this.appOptions.forcesave=Common.localStorage.getBool("sse-settings-forcesave",this.appOptions.canForcesave),Common.Utils.InternalSettings.set("sse-settings-forcesave",this.appOptions.forcesave),this.api.asc_setIsForceSaveOnUserSave(this.appOptions.forcesave))},onDocumentName:function(t){this.headerView.setDocumentCaption(t),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0)},onMeta:function(t){var e=this.getApplication(),i=e.getController("LeftMenu").getView("LeftMenu").getMenu("file");if(e.getController("Viewport").getView("Common.Views.Header").setDocumentCaption(t.title),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0),this.appOptions.spreadsheet.title=t.title,i.loadDocument({doc:this.appOptions.spreadsheet}),i.panels&&i.panels.info&&i.panels.info.updateInfo(this.appOptions.spreadsheet),e.getController("Common.Controllers.ReviewChanges").loadDocument({doc:this.appOptions.spreadsheet}),Common.Gateway.metaChange(t),this.appOptions.wopi){var n=t.title.lastIndexOf(".");Common.Gateway.requestRename(n>0?t.title.substring(0,n):t.title)}},onPrint:function(){this.appOptions.canPrint&&!Common.Utils.ModalWindow.isVisible()&&Common.NotificationCenter.trigger("file:print",this)},onPrintUrl:function(t){if(this.iframePrint&&(this.iframePrint.parentNode.removeChild(this.iframePrint),this.iframePrint=null),!this.iframePrint){var e=this;this.iframePrint=document.createElement("iframe"),this.iframePrint.id="id-print-frame",this.iframePrint.style.display="none",this.iframePrint.style.visibility="hidden",this.iframePrint.style.position="fixed",this.iframePrint.style.right="0",this.iframePrint.style.bottom="0",document.body.appendChild(this.iframePrint),this.iframePrint.onload=function(){try{e.iframePrint.contentWindow.focus(),e.iframePrint.contentWindow.print(),e.iframePrint.contentWindow.blur(),window.focus()}catch(i){var t=new Asc.asc_CDownloadOptions(Asc.c_oAscFileType.PDF);t.asc_setAdvancedOptions(e.getApplication().getController("Print").getPrintParams()),e.api.asc_DownloadAs(t)}}}t&&(this.iframePrint.src=t)},warningDocumentIsLocked:function(){var t=this;Common.Utils.warningDocumentIsLocked({disablefunc:function(e){t.disableEditing(e,!0)}})},onRunAutostartMacroses:function(){var t=this;if(!this.editorConfig.customization||!1!==this.editorConfig.customization.macros){var e=Common.Utils.InternalSettings.get("sse-macros-mode");1==e?this.api.asc_runAutostartMacroses():0===e&&Common.UI.warning({msg:this.textHasMacros+"<br>",buttons:["yes","no"],primary:"yes",dontshow:!0,textDontShow:this.textRemember,callback:function(e,i){i&&(Common.Utils.InternalSettings.set("sse-macros-mode","yes"==e?1:2),Common.localStorage.setItem("sse-macros-mode","yes"==e?1:2)),"yes"==e&&setTimeout((function(){t.api.asc_runAutostartMacroses()}),1)}})}},onMacrosPermissionRequest:function(t,e){if(t&&e){if(this.stackMacrosRequests.push({url:t,callback:e}),this.stackMacrosRequests.length>1)return}else{if(!(this.stackMacrosRequests.length>0))return;t=this.stackMacrosRequests[0].url,e=this.stackMacrosRequests[0].callback}var i=this,n=Common.Utils.InternalSettings.get("sse-allow-macros-request");n>0?(e&&e(1===n),this.stackMacrosRequests.shift(),this.onMacrosPermissionRequest()):Common.UI.warning({msg:this.textRequestMacros.replace("%1",t),buttons:["yes","no"],primary:"yes",dontshow:!0,textDontShow:this.textRememberMacros,maxwidth:600,callback:function(t,n){n&&(Common.Utils.InternalSettings.set("sse-allow-macros-request","yes"==t?1:2),Common.localStorage.setItem("sse-allow-macros-request","yes"==t?1:2)),setTimeout((function(){e&&e("yes"==t),i.stackMacrosRequests.shift(),i.onMacrosPermissionRequest()}),1)}})},loadAutoCorrectSettings:function(){var t=this,e=Common.localStorage.getItem("sse-settings-math-correct-add");Common.Utils.InternalSettings.set("sse-settings-math-correct-add",e);var i=e?JSON.parse(e):[];e=Common.localStorage.getItem("sse-settings-math-correct-rem"),Common.Utils.InternalSettings.set("sse-settings-math-correct-rem",e);var n=e?JSON.parse(e):[];e=Common.localStorage.getBool("sse-settings-math-correct-replace-type",!0),Common.Utils.InternalSettings.set("sse-settings-math-correct-replace-type",e),t.api.asc_refreshOnStartAutoCorrectMathSymbols(n,i,e),e=Common.localStorage.getItem("sse-settings-rec-functions-add"),Common.Utils.InternalSettings.set("sse-settings-rec-functions-add",e),i=e?JSON.parse(e):[],e=Common.localStorage.getItem("sse-settings-rec-functions-rem"),Common.Utils.InternalSettings.set("sse-settings-rec-functions-rem",e),n=e?JSON.parse(e):[],t.api.asc_refreshOnStartAutoCorrectMathFunctions(n,i),e=Common.localStorage.getBool("sse-settings-autoformat-new-rows",!0),Common.Utils.InternalSettings.set("sse-settings-autoformat-new-rows",e),t.api.asc_setIncludeNewRowColTable(e),e=Common.localStorage.getBool("sse-settings-autoformat-hyperlink",!0),Common.Utils.InternalSettings.set("sse-settings-autoformat-hyperlink",e),t.api.asc_SetAutoCorrectHyperlinks(e)},showRenameUserDialog:function(){if(!this._renameDialog){var t=this;this._renameDialog=new Common.Views.UserNameDialog({label:this.textRenameLabel,error:this.textRenameError,value:Common.Utils.InternalSettings.get("guest-username")||"",check:Common.Utils.InternalSettings.get("save-guest-username")||!1,validation:function(e){return e.length<128||t.textLongName},handler:function(e,i){if("ok"==e){var n=i.input?i.input+" ("+t.textGuest+")":t.textAnonymous,o=new Asc.asc_CUserInfo;o.put_FullName(n);var s=new Asc.asc_CDocInfo;s.put_UserInfo(o),t.api.asc_changeDocInfo(s),i.checkbox?Common.localStorage.setItem("guest-username",i.input):Common.localStorage.removeItem("guest-username"),Common.Utils.InternalSettings.set("guest-username",i.input),Common.Utils.InternalSettings.set("save-guest-username",i.checkbox)}}}),this._renameDialog.on("close",(function(){t._renameDialog=void 0})),this._renameDialog.show(Common.Utils.innerWidth()-this._renameDialog.options.width-15,30)}},onRefreshHistory:function(t){if(this.appOptions.canUseHistory)if(this.loadMask&&this.loadMask.hide(),t.data.error||!t.data.history)(e=this.getApplication().getCollection("Common.Collections.HistoryVersions"))&&e.size()>0&&e.each((function(t){t.set("canRestore",!1)})),Common.UI.alert({title:this.notcriticalErrorTitle,msg:t.data.error?t.data.error:this.txtErrorLoadHistory,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.onEditComplete()}),this)});else{this.api.asc_coAuthoringDisconnect(),this.headerView.setCanRename(!1),this.headerView.getButton("users")&&this.headerView.getButton("users").hide(),this.headerView.getButton("share")&&this.headerView.getButton("share").setVisible(!1),this.getApplication().getController("LeftMenu").getView("LeftMenu").showHistory(),this.disableEditing(!0),this._renameDialog&&this._renameDialog.close();var e,i=t.data.history,n=null;if(e=this.getApplication().getCollection("Common.Collections.HistoryVersions")){var o,s,a=[],l=-1,r=-1,c=[],d="",h=this.getApplication().getCollection("Common.Collections.HistoryUsers"),p=null,m=0;for(o=i.length-1;o>=0;o--)if(void 0!==(s=i[o]).versionGroup&&null!==s.versionGroup||(s.versionGroup=s.version),s){if(s.user||(s.user={}),d=o>0&&i[o-1]?i[o-1].key:s.key+"0",(p=h.findUser(s.user.id))||(p=new Common.Models.User({id:s.user.id,username:s.user.name,colorval:Asc.c_oAscArrUserColors[m],color:this.generateUserColor(Asc.c_oAscArrUserColors[m++])}),h.add(p)),a.push(new Common.Models.HistoryVersion({version:s.versionGroup,revision:s.version,userid:s.user.id,username:s.user.name,usercolor:p.get("color"),created:s.created,docId:s.key,markedAsVersion:l!==s.versionGroup,selected:t.data.currentVersion==s.version,canRestore:this.appOptions.canHistoryRestore&&o<i.length-1,isExpanded:!0,serverVersion:s.serverVersion,fileType:"xslx"})),t.data.currentVersion==s.version&&(n=a[a.length-1]),l=s.versionGroup,r!==s.version){for(r=s.version,c.reverse(),g=0;g<c.length;g++)a[a.length-g-2].set("arrColors",c);c=[]}c.push(p.get("colorval"));var u,g,f=s.changes;if(f&&f.length>0){if(a[a.length-1].set("docIdPrev",d),!_.isEmpty(s.serverVersion)&&s.serverVersion==this.appOptions.buildVersion)for(a[a.length-1].set("changeid",f.length-1),a[a.length-1].set("hasChanges",f.length>1),g=f.length-2;g>=0;g--)u=f[g],(p=h.findUser(u.user.id))||(p=new Common.Models.User({id:u.user.id,username:u.user.name,colorval:Asc.c_oAscArrUserColors[m],color:this.generateUserColor(Asc.c_oAscArrUserColors[m++])}),h.add(p)),a.push(new Common.Models.HistoryVersion({version:s.versionGroup,revision:s.version,changeid:g,userid:u.user.id,username:u.user.name,usercolor:p.get("color"),created:u.created,docId:s.key,docIdPrev:d,selected:!1,canRestore:this.appOptions.canHistoryRestore&&this.appOptions.canDownload,isRevision:!1,isVisible:!0,serverVersion:s.serverVersion,fileType:"xslx"})),c.push(p.get("colorval"))}else 0==o&&1==i.length&&a[a.length-1].set("docId",s.key+"1")}if(c.length>0){for(c.reverse(),g=0;g<c.length;g++)a[a.length-g-1].set("arrColors",c);c=[]}e.reset(a),null===n&&e.size()>0&&(n=e.at(0)).set("selected",!0)}}},DisableVersionHistory:function(){this.editorConfig.canUseHistory=!1,this.appOptions.canUseHistory=!1},generateUserColor:function(t){return"#"+("000000"+t.toString(16)).substr(-6)},onGrabFocus:function(){this.getApplication().getController("DocumentHolder").getView().focus()},onLanguageLoaded:function(){return!!Common.Locale.getCurrentLanguage()||(Common.UI.warning({msg:this.errorLang,buttons:[],closable:!1}),!1)},onCollaborativeChanges:function(){this._state.hasCollaborativeChanges||(this._state.hasCollaborativeChanges=!0,this.appOptions.isEdit&&this.getApplication().getController("Statusbar").setStatusCaption(this.textNeedSynchronize,!0))},synchronizeChanges:function(){this.toolbarView&&this.toolbarView.synchronizeChanges(),this._state.hasCollaborativeChanges=!1},onConvertEquationToMath:function(t){var e,i=this,n=this.textConvertEquation+'<br><br><a id="id-equation-convert-help" style="cursor: pointer;">'+this.textLearnMore+"</a>";(e=Common.UI.warning({width:500,msg:n,buttons:["yes","cancel"],primary:"yes",dontshow:!0,textDontShow:this.textApplyAll,callback:_.bind((function(e,i){"yes"==e&&this.api.asc_ConvertEquationToMath(t,i),this.onEditComplete()}),this)})).$window.find("#id-equation-convert-help").on("click",(function(t){e&&e.close(),i.getApplication().getController("LeftMenu").getView("LeftMenu").showMenu("file:help","UsageInstructions/InsertEquation.htm#convertequation")}))},leavePageText:"You have unsaved changes in this document. Click 'Stay on this Page' then 'Save' to save them. Click 'Leave this Page' to discard all the unsaved changes.",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:'Press "OK" to to back to document list.',openTitleText:"Opening Document",openTextText:"Opening document...",saveTitleText:"Saving Document",saveTextText:"Saving document...",loadFontsTitleText:"Loading Data",loadFontsTextText:"Loading data...",loadImagesTitleText:"Loading Images",loadImagesTextText:"Loading images...",loadFontTitleText:"Loading Data",loadFontTextText:"Loading data...",loadImageTitleText:"Loading Image",loadImageTextText:"Loading image...",downloadTitleText:"Downloading Document",downloadTextText:"Downloading document...",printTitleText:"Printing Document",printTextText:"Printing document...",uploadImageTitleText:"Uploading Image",uploadImageTextText:"Uploading image...",loadingDocumentTitleText:"Loading spreadsheet",uploadImageSizeMessage:"Maximium image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",reloadButtonText:"Reload Page",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",requestEditFailedTitleText:"Access denied",requestEditFailedMessageText:"Someone is editing this document right now. Please try again later.",warnBrowserZoom:"Your browser's current zoom setting is not fully supported. Please reset to the default zoom by pressing Ctrl+0.",warnBrowserIE9:"The application has low capabilities on IE9. Use IE10 or higher",pastInMergeAreaError:"Cannot change part of a merged cell",textPleaseWait:"It's working hard. Please wait...",errorWrongBracketsCount:"Found an error in the formula entered.<br>Wrong cout of brackets.",errorWrongOperator:"An error in the entered formula. Wrong operator is used.<br>Please correct the error or use the Esc button to cancel the formula editing.",errorCountArgExceed:"Found an error in the formula entered.<br>Count of arguments exceeded.",errorCountArg:"Found an error in the formula entered.<br>Invalid number of arguments.",errorFormulaName:"Found an error in the formula entered.<br>Incorrect formula name.",errorFormulaParsing:"Internal error while the formula parsing.",errorArgsRange:"Found an error in the formula entered.<br>Incorrect arguments range.",errorUnexpectedGuid:"External error.<br>Unexpected Guid. Please, contact support.",errorDatabaseConnection:"External error.<br>Database connection error. Please, contact support.",errorFileRequest:"External error.<br>File Request. Please, contact support.",errorFileVKey:"External error.<br>Incorrect securety key. Please, contact support.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",errorDataRange:"Incorrect data range.",errorOperandExpected:"The entered function syntax is not correct. Please check if you are missing one of the parentheses - '(' or ')'.",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",errorMoveRange:"Cann't change a part of merged cell",errorBadImageUrl:"Image url is incorrect",errorCoAuthoringDisconnect:"Server connection lost. You can't edit anymore.",errorFilePassProtect:"The file is password protected and cannot be opened.",errorLockedAll:"The operation could not be done as the sheet has been locked by another user.",txtEditingMode:"Set editing mode...",textLoadingDocument:"Loading spreadsheet",textConfirm:"Confirmation",confirmMoveCellRange:"The destination cell's range can contain data. Continue the operation?",textYes:"Yes",textNo:"No",textAnonymous:"Anonymous",txtBasicShapes:"Basic Shapes",txtFiguredArrows:"Figured Arrows",txtMath:"Math",txtCharts:"Charts",txtStarsRibbons:"Stars & Ribbons",txtCallouts:"Callouts",txtButtons:"Buttons",txtRectangles:"Rectangles",txtLines:"Lines",txtDiagramTitle:"Chart Title",txtXAxis:"X Axis",txtYAxis:"Y Axis",txtSeries:"Seria",warnProcessRightsChange:"You have been denied the right to edit the file.",errorProcessSaveResult:"Saving is failed.",errorAutoFilterDataRange:"The operation could not be done for the selected range of cells.<br>Select a uniform data range inside or outside the table and try again.",errorAutoFilterChangeFormatTable:"The operation could not be done for the selected cells as you cannot move a part of the table.<br>Select another data range so that the whole table was shifted and try again.",errorAutoFilterHiddenRange:"The operation cannot be performed because the area contains filtered cells.<br>Please unhide the filtered elements and try again.",errorAutoFilterChange:"The operation is not allowed, as it is attempting to shift cells in a table on your worksheet.",textCloseTip:"Click to close the tip.",textShape:"Shape",errorFillRange:"Could not fill the selected range of cells.<br>All the merged cells need to be the same size.",errorUpdateVersion:"The file version has been changed. The page will be reloaded.",errorUserDrop:"The file cannot be accessed right now.",txtArt:"Your text here",errorInvalidRef:"Enter a correct name for the selection or a valid reference to go to.",errorCreateDefName:"The existing named ranges cannot be edited and the new ones cannot be created<br>at the moment as some of them are being edited.",errorPasteMaxRange:"The copy and paste area does not match. Please select an area with the same size or click the first cell in a row to paste the copied cells.",errorConnectToServer:" The document could not be saved. Please check connection settings or contact your administrator.<br>When you click the 'OK' button, you will be prompted to download the document.",errorLockedWorksheetRename:"The sheet cannot be renamed at the moment as it is being renamed by another user",textTryUndoRedo:"The Undo/Redo functions are disabled for the Fast co-editing mode.<br>Click the 'Strict mode' button to switch to the Strict co-editing mode to edit the file without other users interference and send your changes only after you save them. You can switch between the co-editing modes using the editor Advanced settings.",textStrict:"Strict mode",errorOpenWarning:"The length of one of the formulas in the file exceeded<br>the allowed number of characters and it was removed.",errorFrmlWrongReferences:"The function refers to a sheet that does not exist.<br>Please check the data and try again.",textBuyNow:"Visit website",textNoLicenseTitle:"License limit reached",textContactUs:"Contact sales",confirmPutMergeRange:"The source data contains merged cells.<br>They will be unmerged before they are pasted into the table.",errorViewerDisconnect:"Connection is lost. You can still view the document,<br>but will not be able to download or print until the connection is restored and page is reloaded.",warnLicenseExp:"Your license has expired.<br>Please update your license and refresh the page.",titleLicenseExp:"License expired",openErrorText:"An error has occurred while opening the file",saveErrorText:"An error has occurred while saving the file",errorCopyMultiselectArea:"This command cannot be used with multiple selections.<br>Select a single range and try again.",errorPrintMaxPagesCount:"Unfortunately, it’s not possible to print more than 1500 pages at once in the current version of the program.<br>This restriction will be eliminated in upcoming releases.",errorToken:"The document security token is not correctly formed.<br>Please contact your Document Server administrator.",errorTokenExpire:"The document security token has expired.<br>Please contact your Document Server administrator.",errorSessionAbsolute:"The document editing session has expired. Please reload the page.",errorSessionIdle:"The document has not been edited for quite a long time. Please reload the page.",errorSessionToken:"The connection to the server has been interrupted. Please reload the page.",errorAccessDeny:"You are trying to perform an action you do not have rights for.<br>Please contact your Document Server administrator.",titleServerVersion:"Editor updated",errorServerVersion:"The editor version has been updated. The page will be reloaded to apply the changes.",errorLockedCellPivot:"You cannot change data inside a pivot table.",txtAccent:"Accent",txtStyle_Normal:"Normal",txtStyle_Heading_1:"Heading 1",txtStyle_Heading_2:"Heading 2",txtStyle_Heading_3:"Heading 3",txtStyle_Heading_4:"Heading 4",txtStyle_Title:"Title",txtStyle_Neutral:"Neutral",txtStyle_Bad:"Bad",txtStyle_Good:"Good",txtStyle_Input:"Input",txtStyle_Output:"Output",txtStyle_Calculation:"Calculation",txtStyle_Check_Cell:"Check Cell",txtStyle_Explanatory_Text:"Explanatory Text",txtStyle_Note:"Note",txtStyle_Linked_Cell:"Linked Cell",txtStyle_Warning_Text:"Warning Text",txtStyle_Total:"Total",txtStyle_Currency:"Currency",txtStyle_Percent:"Percent",txtStyle_Comma:"Comma",errorForceSave:"An error occurred while saving the file. Please use the 'Download as' option to save the file to your computer hard drive or try again later.",errorMaxPoints:"The maximum number of points in series per chart is 4096.",warnNoLicense:"You've reached the limit for simultaneous connections to %1 editors. This document will be opened for viewing only.<br>Contact %1 sales team for personal upgrade terms.",warnNoLicenseUsers:"You've reached the user limit for %1 editors. Contact %1 sales team for personal upgrade terms.",warnLicenseExceeded:"You've reached the limit for simultaneous connections to %1 editors. This document will be opened for viewing only.<br>Contact your administrator to learn more.",warnLicenseUsersExceeded:"You've reached the user limit for %1 editors. Contact your administrator to learn more.",errorDataEncrypted:"Encrypted changes have been received, they cannot be deciphered.",textClose:"Close",textPaidFeature:"Paid feature",scriptLoadError:"The connection is too slow, some of the components could not be loaded. Please reload the page.",errorEditingSaveas:"An error occurred during the work with the document.<br>Use the 'Save as...' option to save the file backup copy to your computer hard drive.",errorEditingDownloadas:"An error occurred during the work with the document.<br>Use the 'Download as...' option to save the file backup copy to your computer hard drive.",txtShape_textRect:"Text Box",txtShape_rect:"Rectangle",txtShape_ellipse:"Ellipse",txtShape_triangle:"Triangle",txtShape_rtTriangle:"Right Triangle",txtShape_parallelogram:"Parallelogram",txtShape_trapezoid:"Trapezoid",txtShape_diamond:"Diamond",txtShape_pentagon:"Pentagon",txtShape_hexagon:"Hexagon",txtShape_heptagon:"Heptagon",txtShape_octagon:"Octagon",txtShape_decagon:"Decagon",txtShape_dodecagon:"Dodecagon",txtShape_pie:"Pie",txtShape_chord:"Chord",txtShape_teardrop:"Teardrop",txtShape_frame:"Frame",txtShape_halfFrame:"Half Frame",txtShape_corner:"Corner",txtShape_diagStripe:"Diagonal Stripe",txtShape_plus:"Plus",txtShape_plaque:"Sign",txtShape_can:"Can",txtShape_cube:"Cube",txtShape_bevel:"Bevel",txtShape_donut:"Donut",txtShape_noSmoking:'"No" Symbol',txtShape_blockArc:"Block Arc",txtShape_foldedCorner:"Folded Corner",txtShape_smileyFace:"Smiley Face",txtShape_heart:"Heart",txtShape_lightningBolt:"Lightning Bolt",txtShape_sun:"Sun",txtShape_moon:"Moon",txtShape_cloud:"Cloud",txtShape_arc:"Arc",txtShape_bracePair:"Double Brace",txtShape_leftBracket:"Left Bracket",txtShape_rightBracket:"Right Bracket",txtShape_leftBrace:"Left Brace",txtShape_rightBrace:"Right Brace",txtShape_rightArrow:"Right Arrow",txtShape_leftArrow:"Left Arrow",txtShape_upArrow:"Up Arrow",txtShape_downArrow:"Down Arrow",txtShape_leftRightArrow:"Left Right Arrow",txtShape_upDownArrow:"Up Down Arrow",txtShape_quadArrow:"Quad Arrow",txtShape_leftRightUpArrow:"Left Right Up Arrow",txtShape_bentArrow:"Bent Arrow",txtShape_uturnArrow:"U-Turn Arrow",txtShape_leftUpArrow:"Left Up Arrow",txtShape_bentUpArrow:"Bent Up Arrow",txtShape_curvedRightArrow:"Curved Right Arrow",txtShape_curvedLeftArrow:"Curved Left Arrow",txtShape_curvedUpArrow:"Curved Up Arrow",txtShape_curvedDownArrow:"Curved Down Arrow",txtShape_stripedRightArrow:"Striped Right Arrow",txtShape_notchedRightArrow:"Notched Right Arrow",txtShape_homePlate:"Pentagon",txtShape_chevron:"Chevron",txtShape_rightArrowCallout:"Right Arrow Callout",txtShape_downArrowCallout:"Down Arrow Callout",txtShape_leftArrowCallout:"Left Arrow Callout",txtShape_upArrowCallout:"Up Arrow Callout",txtShape_leftRightArrowCallout:"Left Right Arrow Callout",txtShape_quadArrowCallout:"Quad Arrow Callout",txtShape_circularArrow:"Circular Arrow",txtShape_mathPlus:"Plus",txtShape_mathMinus:"Minus",txtShape_mathMultiply:"Multiply",txtShape_mathDivide:"Division",txtShape_mathEqual:"Equal",txtShape_mathNotEqual:"Not Equal",txtShape_flowChartProcess:"Flowchart: Process",txtShape_flowChartAlternateProcess:"Flowchart: Alternate Process",txtShape_flowChartDecision:"Flowchart: Decision",txtShape_flowChartInputOutput:"Flowchart: Data",txtShape_flowChartPredefinedProcess:"Flowchart: Predefined Process",txtShape_flowChartInternalStorage:"Flowchart: Internal Storage",txtShape_flowChartDocument:"Flowchart: Document",txtShape_flowChartMultidocument:"Flowchart: Multidocument ",txtShape_flowChartTerminator:"Flowchart: Terminator",txtShape_flowChartPreparation:"Flowchart: Preparation",txtShape_flowChartManualInput:"Flowchart: Manual Input",txtShape_flowChartManualOperation:"Flowchart: Manual Operation",txtShape_flowChartConnector:"Flowchart: Connector",txtShape_flowChartOffpageConnector:"Flowchart: Off-page Connector",txtShape_flowChartPunchedCard:"Flowchart: Card",txtShape_flowChartPunchedTape:"Flowchart: Punched Tape",txtShape_flowChartSummingJunction:"Flowchart: Summing Junction",txtShape_flowChartOr:"Flowchart: Or",txtShape_flowChartCollate:"Flowchart: Collate",txtShape_flowChartSort:"Flowchart: Sort",txtShape_flowChartExtract:"Flowchart: Extract",txtShape_flowChartMerge:"Flowchart: Merge",txtShape_flowChartOnlineStorage:"Flowchart: Stored Data",txtShape_flowChartDelay:"Flowchart: Delay",txtShape_flowChartMagneticTape:"Flowchart: Sequential Access Storage",txtShape_flowChartMagneticDisk:"Flowchart: Magnetic Disk",txtShape_flowChartMagneticDrum:"Flowchart: Direct Access Storage",txtShape_flowChartDisplay:"Flowchart: Display",txtShape_irregularSeal1:"Explosion 1",txtShape_irregularSeal2:"Explosion 2",txtShape_star4:"4-Point Star",txtShape_star5:"5-Point Star",txtShape_star6:"6-Point Star",txtShape_star7:"7-Point Star",txtShape_star8:"8-Point Star",txtShape_star10:"10-Point Star",txtShape_star12:"12-Point Star",txtShape_star16:"16-Point Star",txtShape_star24:"24-Point Star",txtShape_star32:"32-Point Star",txtShape_ribbon2:"Up Ribbon",txtShape_ribbon:"Down Ribbon",txtShape_ellipseRibbon2:"Curved Up Ribbon",txtShape_ellipseRibbon:"Curved Down Ribbon",txtShape_verticalScroll:"Vertical Scroll",txtShape_horizontalScroll:"Horizontal Scroll",txtShape_wave:"Wave",txtShape_doubleWave:"Double Wave",txtShape_wedgeRectCallout:"Rectangular Callout",txtShape_wedgeRoundRectCallout:"Rounded Rectangular Callout",txtShape_wedgeEllipseCallout:"Oval Callout",txtShape_cloudCallout:"Cloud Callout",txtShape_borderCallout1:"Line Callout 1",txtShape_borderCallout2:"Line Callout 2",txtShape_borderCallout3:"Line Callout 3",txtShape_accentCallout1:"Line Callout 1 (Accent Bar)",txtShape_accentCallout2:"Line Callout 2 (Accent Bar)",txtShape_accentCallout3:"Line Callout 3 (Accent Bar)",txtShape_callout1:"Line Callout 1 (No Border)",txtShape_callout2:"Line Callout 2 (No Border)",txtShape_callout3:"Line Callout 3 (No Border)",txtShape_accentBorderCallout1:"Line Callout 1 (Border and Accent Bar)",txtShape_accentBorderCallout2:"Line Callout 2 (Border and Accent Bar)",txtShape_accentBorderCallout3:"Line Callout 3 (Border and Accent Bar)",txtShape_actionButtonBackPrevious:"Back or Previous Button",txtShape_actionButtonForwardNext:"Forward or Next Button",txtShape_actionButtonBeginning:"Beginning Button",txtShape_actionButtonEnd:"End Button",txtShape_actionButtonHome:"Home Button",txtShape_actionButtonInformation:"Information Button",txtShape_actionButtonReturn:"Return Button",txtShape_actionButtonMovie:"Movie Button",txtShape_actionButtonDocument:"Document Button",txtShape_actionButtonSound:"Sound Button",txtShape_actionButtonHelp:"Help Button",txtShape_actionButtonBlank:"Blank Button",txtShape_roundRect:"Round Corner Rectangle",txtShape_snip1Rect:"Snip Single Corner Rectangle",txtShape_snip2SameRect:"Snip Same Side Corner Rectangle",txtShape_snip2DiagRect:"Snip Diagonal Corner Rectangle",txtShape_snipRoundRect:"Snip and Round Single Corner Rectangle",txtShape_round1Rect:"Round Single Corner Rectangle",txtShape_round2SameRect:"Round Same Side Corner Rectangle",txtShape_round2DiagRect:"Round Diagonal Corner Rectangle",txtShape_line:"Line",txtShape_lineWithArrow:"Arrow",txtShape_lineWithTwoArrows:"Double Arrow",txtShape_bentConnector5:"Elbow Connector",txtShape_bentConnector5WithArrow:"Elbow Arrow Connector",txtShape_bentConnector5WithTwoArrows:"Elbow Double-Arrow Connector",txtShape_curvedConnector3:"Curved Connector",txtShape_curvedConnector3WithArrow:"Curved Arrow Connector",txtShape_curvedConnector3WithTwoArrows:"Curved Double-Arrow Connector",txtShape_spline:"Curve",txtShape_polyline1:"Scribble",txtShape_polyline2:"Freeform",errorChangeArray:"You cannot change part of an array.",errorMultiCellFormula:"Multi-cell array formulas are not allowed in tables.",errorEmailClient:"No email client could be found",txtPrintArea:"Print_Area",txtTable:"Table",textCustomLoader:"Please note that according to the terms of the license you are not entitled to change the loader.<br>Please contact our Sales Department to get a quote.",errorNoDataToParse:"No data was selected to parse.",errorCannotUngroup:"Cannot ungroup. To start an outline, select the detail rows or columns and group them.",errorFrmlMaxTextLength:"Text values in formulas are limited to 255 characters.<br>Use the CONCATENATE function or concatenation operator (&)",waitText:"Please, wait...",errorDataValidate:"The value you entered is not valid.<br>A user has restricted values that can be entered into this cell.",txtConfidential:"Confidential",txtPreparedBy:"Prepared by",txtPage:"Page",txtPageOf:"Page %1 of %2",txtPages:"Pages",txtDate:"Date",txtTime:"Time",txtTab:"Tab",txtFile:"File",errorFileSizeExceed:"The file size exceeds the limitation set for your server.<br>Please contact your Document Server administrator for details.",errorLabledColumnsPivot:"To create a pivot table report, you must use data that is organized as a list with labeled columns.",errorPivotOverlap:"A pivot table report cannot overlap a table.",txtColumn:"Column",txtRow:"Row",errorUpdateVersionOnDisconnect:"Internet connection has been restored, and the file version has been changed.<br>Before you can continue working, you need to download the file or copy its content to make sure nothing is lost, and then reload this page.",errorFTChangeTableRangeError:"Operation could not be completed for the selected cell range.<br>Select a range so that the first table row was on the same row<br>and the resulting table overlapped the current one.",errorFTRangeIncludedOtherTables:"Operation could not be completed for the selected cell range.<br>Select a range which does not include other tables.",txtByField:"%1 of %2",txtAll:"(All)",txtValues:"Values",txtGrandTotal:"Grand Total",txtRowLbls:"Row Labels",txtColLbls:"Column Labels",errNoDuplicates:"No duplicate values found.",errRemDuplicates:"Duplicate values found and deleted: {0}, unique values left: {1}.",txtMultiSelect:"Multi-Select (Alt+S)",txtClearFilter:"Clear Filter (Alt+C)",txtBlank:"(blank)",textHasMacros:"The file contains automatic macros.<br>Do you want to run macros?",textRemember:"Remember my choice",errorPasteSlicerError:"Table slicers cannot be copied from one workbook to another.",errorFrmlMaxLength:"You cannot add this formula as its length exceeded the allowed number of characters.<br>Please edit it and try again.",errorFrmlMaxReference:"You cannot enter this formula because it has too many values,<br>cell references, and/or names.",errorMoveSlicerError:"Table slicers cannot be copied from one workbook to another.<br>Try again by selecting the entire table and the slicers.",errorEditView:"The existing sheet view cannot be edited and the new ones cannot be created at the moment as some of them are being edited.",errorChangeFilteredRange:"This will change a filtered range on your worksheet.<br>To complete this task, please remove AutoFilters.",warnLicenseLimitedRenewed:"License needs to be renewed.<br>You have a limited access to document editing functionality.<br>Please contact your administrator to get full access",warnLicenseLimitedNoAccess:"License expired.<br>You have no access to document editing functionality.<br>Please contact your administrator.",saveErrorTextDesktop:"This file cannot be saved or created.<br>Possible reasons are: <br>1. The file is read-only. <br>2. The file is being edited by other users. <br>3. The disk is full or corrupted.",errorSetPassword:"Password could not be set.",textRenameLabel:"Enter a name to be used for collaboration",textRenameError:"User name must not be empty.",textLongName:"Enter a name that is less than 128 characters.",textGuest:"Guest",txtGroup:"Group",txtSeconds:"Seconds",txtMinutes:"Minutes",txtHours:"Hours",txtDays:"Days",txtMonths:"Months",txtQuarters:"Quarters",txtYears:"Years",errorPivotGroup:"Cannot group that selection.",leavePageTextOnClose:"All unsaved changes in this document will be lost.<br> Click 'Cancel' then 'Save' to save them. Click 'OK' to discard all the unsaved changes.",errorPasteMultiSelect:"This action cannot be done on a multiple range selection.<br>Select a single range and try again.",textTryUndoRedoWarn:"The Undo/Redo functions are disabled for the Fast co-editing mode.",errorPivotWithoutUnderlying:"The Pivot Table report was saved without the underlying data.<br>Use the 'Refresh' button to update the report.",txtQuarter:"Qtr",txtOr:"%1 or %2",confirmReplaceFormulaInTable:"Formulas in the header row will be removed and converted to static text.<br>Do you want to continue?",errorChangeOnProtectedSheet:"The cell or chart you are trying to change is on a protected sheet.<br>To make a change, unprotect the sheet. You might be requested to enter a password.",txtUnlockRange:"Unlock Range",txtUnlockRangeWarning:"A range you are trying to change is password protected.",txtUnlockRangeDescription:"Enter the password to change this range:",txtUnlock:"Unlock",errorWrongPassword:"The password you supplied is not correct.",errorLang:"The interface language is not loaded.<br>Please contact your Document Server administrator.",textDisconnect:"Connection is lost",textConvertEquation:"This equation was created with an old version of equation editor which is no longer supported. Converting this equation to Office Math ML format will make it editable.<br>Do you want to convert this equation?",textApplyAll:"Apply to all equations",textLearnMore:"Learn More",errorSingleColumnOrRowError:"Location reference is not valid because the cells are not all in the same column or row.<br>Select cells that are all in a single column or row.",errorLocationOrDataRangeError:"The reference for the location or data range is not valid.",txtErrorLoadHistory:"Loading history failed",errorPasswordIsNotCorrect:"The password you supplied is not correct.<br>Verify that the CAPS LOCK key is off and be sure to use the correct capitalization.",errorDeleteColumnContainsLockedCell:"You are trying to delete a column that contains a locked cell. Locked cells cannot be deleted while the worksheet is protected.<br>To delete a locked cell, unprotect the sheet. You might be requested to enter a password.",errorDeleteRowContainsLockedCell:"You are trying to delete a row that contains a locked cell. Locked cells cannot be deleted while the worksheet is protected.<br>To delete a locked cell, unprotect the sheet. You might be requested to enter a password.",uploadDocSizeMessage:"Maximum document size limit exceeded.",uploadDocExtMessage:"Unknown document format.",uploadDocFileCountMessage:"No documents uploaded.",errorLoadingFont:"Fonts are not loaded.<br>Please contact your Document Server administrator.",textNeedSynchronize:"You have an updates",textChangesSaved:"All changes saved",textFillOtherRows:"Fill other rows",textFormulaFilledAllRows:"Formula filled {0} rows have data. Filling other empty rows may take a few minutes.",textFormulaFilledAllRowsWithEmpty:"Formula filled first {0} rows. Filling other empty rows may take a few minutes.",textFormulaFilledFirstRowsOtherIsEmpty:"Formula filled only first {0} rows by memory save reason. Other rows in this sheet don't have data.",textFormulaFilledFirstRowsOtherHaveData:"Formula filled only first {0} rows have data by memory save reason. There are other {1} rows have data in this sheet. You can fill them manually.",textReconnect:"Connection is restored",errorCannotUseCommandProtectedSheet:"You cannot use this command on a protected sheet. To use this command, unprotect the sheet.<br>You might be requested to enter a password.",textRequestMacros:"A macro makes a request to URL. Do you want to allow the request to the %1?",textRememberMacros:"Remember my choice for all macros",confirmMaxChangesSize:'The size of actions exceeds the limitation set for your server.<br>Press "Undo" to cancel your last action or press "Continue" to keep action locally (you need to download the file or copy its content to make sure nothing is lost).',textUndo:"Undo",textContinue:"Continue"}),SSE.Controllers.Main||{}))})),define("common/main/lib/view/DocumentAccessDialog",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],(function(){"use strict";Common.Views.DocumentAccessDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{title:this.textTitle,width:600,height:536,header:!0},t),this.template=['<div id="id-sharing-placeholder"></div>'].join(""),e.tpl=_.template(this.template)(e),this.settingsurl=t.settingsurl||"",Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var t=document.createElement("iframe");t.width="100%",t.height=500,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=_.bind(this._onLoad,this),$("#id-sharing-placeholder").append(t),this.loadMask=new Common.UI.LoadMask({owner:$("#id-sharing-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),t.src=this.settingsurl;var e=this;this._eventfunc=function(t){e._onWindowMessage(t)},this._bindWindowEvents.call(this),this.on("close",(function(t){e._unbindWindowEvents()}))},_bindWindowEvents:function(){window.addEventListener?window.addEventListener("message",this._eventfunc,!1):window.attachEvent&&window.attachEvent("onmessage",this._eventfunc)},_unbindWindowEvents:function(){window.removeEventListener?window.removeEventListener("message",this._eventfunc):window.detachEvent&&window.detachEvent("onmessage",this._eventfunc)},_onWindowMessage:function(t){if(t&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(t.data))}catch(t){}},_onMessage:function(t){t&&"onlyoffice"==t.Referer&&(t.needUpdate&&this.trigger("accessrights",this,t.sharingSettings),Common.NotificationCenter.trigger("window:close",this))},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Sharing Settings",textLoading:"Loading"},Common.Views.DocumentAccessDialog||{}))})),define("text!common/main/lib/template/AutoCorrectDialog.template",[],(function(){return'<div id="id-autocorrect-dialog-settings-math" class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n        <tr>\n            <td style="padding-bottom: 8px;">\n                <div id="auto-correct-chb-replace-type"></div>\n            </td>\n        </tr>\n        <tr>\n            <td>\n                <label style="width: 117px;"><%= scope.textReplace %>:</label>\n                <label><%= scope.textBy %>:</label>\n                </td>\n            </tr>\n        <tr>\n            <td>\n                <div id="auto-correct-replace" style="height:22px;width: 115px;margin-right: 2px;display: inline-block;"></div>\n                <div id="auto-correct-by" style="height:22px;width: 234px;display: inline-block;"></div>\n                </td>\n            </tr>\n        <tr>\n            <td style="padding-bottom: 8px;">\n                <div id="auto-correct-math-list" class="" style="width:100%; height: 208px;"></div>\n                </td>\n            </tr>\n        <tr>\n            <td style="padding-bottom: 8px;">\n                <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-reset" style="min-width: 80px;"><%= scope.textResetAll %></button>\n                <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-delete" style="min-width: 80px;float: right;"><%= scope.textDelete %></button>\n                <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-edit" style="min-width: 80px;float: right;margin-right:5px;"><%= scope.textAdd %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-recognized" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td style="padding-bottom: 8px;">\n                    <label><%= scope.textRecognizedDesc %></label>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <div id="auto-correct-rec-find" style="height:22px;width: 100%;margin-bottom: 4px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td style="padding-bottom: 8px;">\n                    <div id="auto-correct-recognized-list" class="" style="width:100%; height: 208px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td style="padding-bottom: 8px;">\n                    <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-rec-reset" style="min-width: 86px;"><%= scope.textResetAll %></button>\n                    <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-rec-delete" style="min-width: 86px;float: right;"><%= scope.textDelete %></button>\n                    <button type="button" class="btn btn-text-default auto" id="auto-correct-btn-rec-edit" style="min-width: 86px;float: right;margin-right:5px;"><%= scope.textAdd %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-de-autoformat" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-small">\n            <label class="header"><%= scope.textReplaceText %></label>\n        </div>\n        <div class="padding-small">\n            <div class="padding-small" id="id-autocorrect-dialog-chk-quotes"></div>\n            <div class="padding-small" id="id-autocorrect-dialog-chk-hyphens"></div>\n            <div class="padding-small"  id="id-autocorrect-dialog-chk-hyperlink"></div>\n            <div class="padding-small" id="id-autocorrect-dialog-chk-double-space"></div>\n        </div>\n        <div class="padding-small">\n            <label class="header"><%= scope.textApplyText %></label>\n        </div>\n        <div class="padding-small">\n            <div class="padding-small" id="id-autocorrect-dialog-chk-bulleted"></div>\n            <div class="padding-small" id="id-autocorrect-dialog-chk-numbered"></div>\n        </div>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-sse-autoformat" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-small">\n            <label class="header"><%= scope.textReplaceText %></label>\n        </div>\n        <div class="padding-small">\n            <div class="padding-small" id="id-autocorrect-dialog-chk-hyperlink"></div>\n        </div>\n        <div class="padding-small">\n            <label class="header"><%= scope.textApplyAsWork %></label>\n        </div>\n        <div class="padding-small">\n            <div class="padding-small" id="id-autocorrect-dialog-chk-new-rows"></div>\n        </div>\n    </div>\n</div>\n<div id="id-autocorrect-dialog-settings-autocorrect" class="settings-panel">\n    <div class="inner-content" style="width: 100%;">\n        <div class="padding-small">\n            <div id="id-autocorrect-dialog-chk-fl-sentence"></div>\n        </div>\n        <div class="padding-small">\n            <div id="id-autocorrect-dialog-chk-fl-cells"></div>\n        </div>\n    </div>\n</div>\n'})),void 0===Common)var Common={};if(define("common/main/lib/view/AutoCorrectDialog",["text!common/main/lib/template/AutoCorrectDialog.template","common/main/lib/component/ListView","common/main/lib/component/Window","common/main/lib/component/CheckBox"],(function(t){"use strict";var e=new Common.UI.DataViewStore,i=new Common.UI.DataViewStore;Common.Views.AutoCorrectDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:375,height:430,buttons:null,toggleGroup:"autocorrect-dialog-group"},initialize:function(e){var i=Common.localStorage.getKeysFilter();this.appPrefix=i&&i.length?i.split(",")[0]:"";var n=[{panelId:"id-autocorrect-dialog-settings-math",panelCaption:this.textMathCorrect},{panelId:"id-autocorrect-dialog-settings-recognized",panelCaption:this.textRecognized}];"de-"==this.appPrefix||"pe-"==this.appPrefix?(n.push({panelId:"id-autocorrect-dialog-settings-de-autoformat",panelCaption:this.textAutoFormat}),n.push({panelId:"id-autocorrect-dialog-settings-autocorrect",panelCaption:this.textAutoCorrect})):"sse-"==this.appPrefix&&n.push({panelId:"id-autocorrect-dialog-settings-sse-autoformat",panelCaption:this.textAutoFormat}),_.extend(this.options,{title:this.textTitle,storageName:this.appPrefix+"autocorrect-dialog-category",items:n,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="menu-panel" style="overflow: hidden;">',"<% _.each(items, function(item) { %>",'<button class="btn btn-category" content-target="<%= item.panelId %>"><span class=""><%= item.panelCaption %></span></button>',"<% }); %>","</div>",'<div class="separator"></div>','<div class="content-panel">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer center">','<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+this.closeButtonText+"</button>","</div>"].join("")},e||{}),this.api=this.options.api;var o=this.appPrefix+"settings-math-correct",s=Common.Utils.InternalSettings.get(o+"-add");this.arrAdd=s?JSON.parse(s):[],s=Common.Utils.InternalSettings.get(o+"-rem"),this.arrRem=s?JSON.parse(s):[],o=this.appPrefix+"settings-rec-functions",s=Common.Utils.InternalSettings.get(o+"-add"),this.arrAddRec=s?JSON.parse(s):[],s=Common.Utils.InternalSettings.get(o+"-rem"),this.arrRemRec=s?JSON.parse(s):[],Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this.getChild(),n=this,o=t.find("#id-autocorrect-dialog-settings-"+("pe-"==this.appPrefix?"de-":this.appPrefix)+"autoformat");this.chReplaceType=new Common.UI.CheckBox({el:t.find("#auto-correct-chb-replace-type"),labelText:this.textReplaceType,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-math-correct-replace-type")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-math-correct-replace-type",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-math-correct-replace-type",s),n.api.asc_updateFlagAutoCorrectMathSymbols(s)})),this.onInitList(),this.mathList=new Common.UI.ListView({el:t.find("#auto-correct-math-list"),store:new Common.UI.DataViewStore(e.slice(0,9)),simpleAddMode:!1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="pointer-events:none;width: 100%;display:flex;">','<div style="width:110px;padding-right: 5px;overflow: hidden;text-overflow: ellipsis;<% if (defaultDisabled) { %> font-style:italic; opacity: 0.5;<% } %>"><%= replaced %></div>','<div style="width:230px;overflow: hidden;text-overflow: ellipsis;flex-grow:1;font-family: Cambria Math;font-size:13px;<% if (defaultDisabled) { %> font-style:italic; opacity: 0.5;<% } %>"><%= by %></div>',"</div>"].join("")),scrollAlwaysVisible:!0,tabindex:1}),this.mathList.on("item:select",_.bind(this.onSelectMathItem,this)),this.inputReplace=new Common.UI.InputField({el:t.find("#auto-correct-replace"),allowBlank:!0,validateOnChange:!0,maxLength:31,validation:function(){return!0}}).on("changing",(function(t,e){var i;e.length&&((i=n.mathList.store.find((function(t){if(0==t.get("replaced").indexOf(e))return!0})))&&(n.mathList.scrollToRecord(i,!0),i.get("replaced")==e?n.mathList.selectRecord(i,!0):i=null));!i&&n.mathList.deselectAll(),n.updateControls(i)})),this.inputReplace.cmpEl.find("input").on("keydown",(function(t){if("ArrowDown"==t.key){var e=n.mathList.getSelectedRec()||n.mathList.store.at(0);e&&(n.mathList.selectRecord(e),n.mathList.scrollToRecord(e)),_.delay((function(){n.mathList.focus()}),10)}})),this.inputBy=new Common.UI.InputField({el:t.find("#auto-correct-by"),allowBlank:!0,validateOnChange:!0,maxLength:255,validation:function(){return!0}}).on("changing",(function(t,e){n.updateControls()})),this.btnReset=new Common.UI.Button({el:t.find("#auto-correct-btn-reset")}),this.btnReset.on("click",_.bind(this.onResetToDefault,this)),this.btnEdit=new Common.UI.Button({el:t.find("#auto-correct-btn-edit")}),this.btnEdit.on("click",_.bind(this.onEdit,this,!1)),this.btnDelete=new Common.UI.Button({el:t.find("#auto-correct-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDelete,this,!1)),this.onInitRecList(),this.mathRecList=new Common.UI.ListView({el:t.find("#auto-correct-recognized-list"),store:new Common.UI.DataViewStore(i.slice(0,9)),simpleAddMode:!1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 340px;text-overflow: ellipsis;overflow: hidden;<% if (defaultDisabled) { %> font-style:italic; opacity: 0.5;<% } %>"><%= value %></div>'].join("")),scrollAlwaysVisible:!0,tabindex:1}),this.mathRecList.on("item:select",_.bind(this.onSelectRecItem,this)),this.inputRecFind=new Common.UI.InputField({el:t.find("#auto-correct-rec-find"),allowBlank:!0,validateOnChange:!0,maxLength:255,validation:function(){return!0}}).on("changing",(function(t,e){var i;e.length&&((i=n.mathRecList.store.find((function(t){if(0==t.get("value").indexOf(e))return!0})))&&(n.mathRecList.scrollToRecord(i,!0),i.get("value")==e?n.mathRecList.selectRecord(i,!0):i=null));!i&&n.mathRecList.deselectAll(),n.updateRecControls(i)})),this.inputRecFind.cmpEl.find("input").on("keydown",(function(t){if("ArrowDown"==t.key){var e=n.mathRecList.getSelectedRec()||n.mathRecList.store.at(0);e&&(n.mathRecList.selectRecord(e),n.mathRecList.scrollToRecord(e)),_.delay((function(){n.mathRecList.focus()}),10)}})),this.btnResetRec=new Common.UI.Button({el:t.find("#auto-correct-btn-rec-reset")}),this.btnResetRec.on("click",_.bind(this.onResetRecToDefault,this)),this.btnAddRec=new Common.UI.Button({el:t.find("#auto-correct-btn-rec-edit")}),this.btnAddRec.on("click",_.bind(this.onAddRec,this,!1)),this.btnDeleteRec=new Common.UI.Button({el:t.find("#auto-correct-btn-rec-delete")}),this.btnDeleteRec.on("click",_.bind(this.onDeleteRec,this,!1)),"de-"==this.appPrefix||"pe-"==this.appPrefix?(this.chQuotes=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-quotes"),labelText:this.textQuotes,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-smart-quotes")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-smart-quotes",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-smart-quotes",s),n.api.asc_SetAutoCorrectSmartQuotes(s)})),this.chHyphens=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-hyphens"),labelText:this.textHyphens,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-hyphens")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-hyphens",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-hyphens",s),n.api.asc_SetAutoCorrectHyphensWithDash(s)})),this.chBulleted=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-bulleted"),labelText:this.textBulleted,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-bulleted")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-bulleted",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-bulleted",s),n.api.asc_SetAutomaticBulletedLists(s)})),this.chNumbered=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-numbered"),labelText:this.textNumbered,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-numbered")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-numbered",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-numbered",s),n.api.asc_SetAutomaticNumberedLists(s)})),this.chDoubleSpaces=new Common.UI.CheckBox({el:o.find("#id-autocorrect-dialog-chk-double-space"),labelText:this.textDoubleSpaces,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-double-space")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-double-space",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-double-space",s),n.api.asc_SetAutoCorrectDoubleSpaceWithPeriod(s)})),this.chFLSentence=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-fl-sentence"),labelText:this.textFLSentence,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-fl-sentence")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-fl-sentence",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-fl-sentence",s),n.api.asc_SetAutoCorrectFirstLetterOfSentences&&n.api.asc_SetAutoCorrectFirstLetterOfSentences(s)})),this.chFLCells=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-fl-cells"),labelText:this.textFLCells,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-fl-cells")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-fl-cells",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-fl-cells",s),n.api.asc_SetAutoCorrectFirstLetterOfCells&&n.api.asc_SetAutoCorrectFirstLetterOfCells(s)})),this.btnsCategory[3].on("click",_.bind(this.onAutocorrectCategoryClick,this,!1))):"sse-"==this.appPrefix&&(this.chNewRows=new Common.UI.CheckBox({el:t.find("#id-autocorrect-dialog-chk-new-rows"),labelText:this.textNewRowCol,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-new-rows")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-new-rows",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-new-rows",s),n.api.asc_setIncludeNewRowColTable(s)}))),this.chHyperlink=new Common.UI.CheckBox({el:o.find("#id-autocorrect-dialog-chk-hyperlink"),labelText:this.textHyperlink,value:Common.Utils.InternalSettings.get(this.appPrefix+"settings-autoformat-hyperlink")}).on("change",(function(t,e,i,o){var s="checked"===t.getValue();Common.localStorage.setBool(n.appPrefix+"settings-autoformat-hyperlink",s),Common.Utils.InternalSettings.set(n.appPrefix+"settings-autoformat-hyperlink",s),n.api.asc_SetAutoCorrectHyperlinks(s)})),this.btnsCategory[0].on("click",_.bind(this.onMathCategoryClick,this,!1)),this.btnsCategory[1].on("click",_.bind(this.onRecCategoryClick,this,!1)),this.btnsCategory[2].on("click",_.bind(this.onAutoformatCategoryClick,this,!1)),this.afterRender()},afterRender:function(){if(this.updateControls(),this.updateRecControls(),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},getFocusedComponents:function(){var t=[this.chReplaceType,this.inputReplace,this.inputBy,this.mathList,this.btnReset,this.btnEdit,this.btnDelete,this.inputRecFind,this.mathRecList,this.btnResetRec,this.btnAddRec,this.btnDeleteRec,this.chHyperlink];return t=(t=t.concat(this.chNewRows?[this.chNewRows]:[this.chQuotes,this.chHyphens,this.chBulleted,this.chNumbered])).concat(this.chFLSentence?[this.chFLSentence,this.chFLCells]:[])},getSettings:function(){},onSelectMathItem:function(t,e,i){i&&(this.inputReplace.setValue(i.get("replaced")),this.inputBy.setValue(i.get("by"))),this.updateControls(i)},updateControls:function(t){if(this.mathList){t=t||this.mathList.getSelectedRec();var e=this.inputBy.getValue(),i=this.inputReplace.getValue();if(t){var n=t.get("defaultDisabled"),o=t.get("defaultValue")&&t.get("defaultValueStr")!==t.get("by");this.btnDelete.setCaption(n?this.textRestore:this.textDelete),this.btnEdit.setDisabled(n||e===t.get("by")&&!o||!e||!i),this.btnEdit.setCaption(o&&e===t.get("by")?this.textReset:this.textReplace)}else this.btnDelete.setCaption(this.textDelete),this.btnEdit.setDisabled(!e||!i),this.btnEdit.setCaption(this.textAdd);this.btnDelete.setDisabled(!t)}},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments);var t=this.getActiveCategory();0==t?this.onMathCategoryClick(!0):1==t?this.onRecCategoryClick(!0):2==t?this.onAutoformatCategoryClick(!0):3==t&&this.onAutocorrectCategoryClick(!0)},close:function(){Common.Views.AdvancedSettingsWindow.prototype.close.apply(this,arguments),this.mathList&&this.mathList.deselectAll(),this.mathRecList&&this.mathRecList.deselectAll()},onMathCategoryClick:function(t){var i=this;_.delay((function(){$("input",i.inputReplace.cmpEl).select().focus()}),t?50:0),i.mathList.store.length<e.length&&_.delay((function(){i.mathList.setStore(e),i.mathList.onResetItems()}),t?100:10)},onAutoformatCategoryClick:function(t){var e=this;_.delay((function(){"sse-"==e.appPrefix?e.chHyperlink.focus():e.chQuotes.focus()}),t?50:0)},onAutocorrectCategoryClick:function(t){var e=this;_.delay((function(){e.chFLSentence.focus()}),t?50:0)},onDelete:function(){var t=this.mathList.getSelectedRec();if(t){if(t.get("defaultValue")){var i=this.appPrefix+"settings-math-correct-rem",n=!t.get("defaultDisabled");t.set("defaultDisabled",n),n?this.arrRem.push(t.get("replaced")):this.arrRem.splice(this.arrRem.indexOf(t.get("replaced")),1);var o=JSON.stringify(this.arrRem);Common.Utils.InternalSettings.set(i,o),Common.localStorage.setItem(i,o),this.btnDelete.setCaption(n?this.textRestore:this.textDelete),n?this.api.asc_deleteFromAutoCorrectMathSymbols(t.get("replaced")):this.api.asc_AddOrEditFromAutoCorrectMathSymbols(t.get("replaced"),t.get("defaultValue"))}else e.remove(t),this.mathList.scroller&&this.mathList.scroller.update({}),this.api.asc_deleteFromAutoCorrectMathSymbols(t.get("replaced"));this.updateControls()}},onEdit:function(){var t=this.mathList.getSelectedRec(),i="",n=this,o=function(t,e){var i=n.appPrefix+"settings-math-correct-add",o=JSON.stringify(n.arrAdd);Common.Utils.InternalSettings.set(i,o),Common.localStorage.setItem(i,o),n.api.asc_AddOrEditFromAutoCorrectMathSymbols(t.get("replaced"),e),n.mathList.selectRecord(t),n.mathList.scrollToRecord(t)};if(t||(t=e.findWhere({replaced:this.inputReplace.getValue()})),t){var s=_.findIndex(this.arrAdd,(function(e){return e[0]==t.get("replaced")})),a=t.get("defaultValue")&&t.get("defaultValueStr")!==t.get("by")&&this.inputBy.getValue()===t.get("by");Common.UI.warning({maxwidth:500,msg:a?this.warnRestore.replace("%1",t.get("replaced")):this.warnReplace.replace("%1",t.get("replaced")),buttons:["yes","no"],primary:"yes",callback:_.bind((function(e,n){"yes"==e&&(a?(i=t.get("defaultValue"),t.set("by",t.get("defaultValueStr")),s>=0&&this.arrAdd.splice(s,1)):(i=this.inputBy.getValue(),t.set("by",i),s<0?this.arrAdd.push([t.get("replaced"),i]):this.arrAdd[s][1]=i),o(t,i))}),this)})}else t=e.add({replaced:this.inputReplace.getValue(),by:this.inputBy.getValue(),defaultDisabled:!1}),i=t.get("by"),this.arrAdd.push([t.get("replaced"),i]),o(t,i)},onResetToDefault:function(){Common.UI.warning({maxwidth:500,msg:this.warnReset,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t,e){"yes"==t&&(this.api.asc_resetToDefaultAutoCorrectMathSymbols(),this.onResetList())}),this)})},onResetList:function(){var t=this.appPrefix+"settings-math-correct",i=JSON.stringify([]);Common.Utils.InternalSettings.set(t+"-add",i),Common.localStorage.setItem(t+"-add",i),Common.Utils.InternalSettings.set(t+"-rem",i),Common.localStorage.setItem(t+"-rem",i),this.arrAdd=[],this.arrRem=[],e.remove(e.where({defaultValue:void 0})),e.each((function(t,e){t.set("by",t.get("defaultValueStr")),t.set("defaultDisabled",!1)})),this.mathList.deselectAll(),this.mathList.scroller&&(this.mathList.scroller.update(),this.mathList.scroller.scrollTop(0)),this.updateControls()},onInitList:function(){if(!(e.length>0)){e.comparator=function(t,e){var i=t.get("replaced").toLowerCase(),n=e.get("replaced").toLowerCase();return i==n?0:i<n?-1:1};var t=this.arrAdd,i=this.arrRem,n=this.api?this.api.asc_getAutoCorrectMathSymbols():[],o=[];_.each(n,(function(t,e){var n={replaced:t[0],defaultValue:t[1],defaultDisabled:i.indexOf(t[0])>-1};"object"==typeof t[1]?(n.defaultValueStr="",_.each(t[1],(function(t){n.defaultValueStr+=Common.Utils.String.encodeSurrogateChar(t)})),n.by=n.defaultValueStr):n.by=n.defaultValueStr=Common.Utils.String.encodeSurrogateChar(t[1]),o.push(n)}));var s=[];_.each(t,(function(t,e){var i=_.findIndex(o,{replaced:t[0]});i<0?s.push({replaced:t[0],by:t[1],defaultDisabled:!1}):o[i].by=t[1]})),e.reset(o.concat(s)),this.updateControls()}},onInitRecList:function(){if(!(i.length>0)){i.comparator=function(t,e){var i=t.get("value").toLowerCase(),n=e.get("value").toLowerCase();return i==n?0:i<n?-1:1};var t=this.arrAddRec,e=this.arrRemRec,n=this.api?this.api.asc_getAutoCorrectMathFunctions():[],o=[];_.each(n,(function(t,i){o.push({value:t,defaultValue:!0,defaultDisabled:e.indexOf(t)>-1})}));var s=[];_.each(t,(function(t,e){_.findIndex(o,{value:t})<0&&s.push({value:t,defaultValue:!1,defaultDisabled:!1})})),i.reset(o.concat(s)),this.updateRecControls()}},onResetRecToDefault:function(){Common.UI.warning({maxwidth:500,msg:this.textWarnResetRec,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t,e){"yes"==t&&(this.api.asc_resetToDefaultAutoCorrectMathFunctions(),this.onResetRecList())}),this)})},onResetRecList:function(){var t=this.appPrefix+"settings-rec-functions",e=JSON.stringify([]);Common.Utils.InternalSettings.set(t+"-add",e),Common.localStorage.setItem(t+"-add",e),Common.Utils.InternalSettings.set(t+"-rem",e),Common.localStorage.setItem(t+"-rem",e),this.arrAddRec=[],this.arrRemRec=[],i.remove(i.where({defaultValue:!1})),i.each((function(t,e){t.set("defaultDisabled",!1)})),this.mathRecList.deselectAll(),this.mathRecList.scroller&&(this.mathRecList.scroller.update(),this.mathRecList.scroller.scrollTop(0)),this.updateRecControls()},onRecCategoryClick:function(t){var e=this;_.delay((function(){$("input",e.inputRecFind.cmpEl).select().focus()}),t?50:0),e.mathRecList.store.length<i.length&&_.delay((function(){e.mathRecList.setStore(i),e.mathRecList.onResetItems()}),t?100:10)},onDeleteRec:function(){var t=this.mathRecList.getSelectedRec();if(t){if(t.get("defaultValue")){var e=this.appPrefix+"settings-rec-functions-rem",n=!t.get("defaultDisabled");t.set("defaultDisabled",n),n?this.arrRemRec.push(t.get("value")):this.arrRemRec.splice(this.arrRemRec.indexOf(t.get("value")),1);var o=JSON.stringify(this.arrRemRec);Common.Utils.InternalSettings.set(e,o),Common.localStorage.setItem(e,o),this.btnDeleteRec.setCaption(n?this.textRestore:this.textDelete),n?this.api.asc_deleteFromAutoCorrectMathFunctions(t.get("value")):this.api.asc_AddFromAutoCorrectMathFunctions(t.get("value"))}else i.remove(t),this.mathRecList.scroller&&this.mathRecList.scroller.update({}),this.api.asc_deleteFromAutoCorrectMathFunctions(t.get("value"));this.updateRecControls()}},onAddRec:function(){var t,e,n,o=this.mathRecList.getSelectedRec(),s=this;o||(o=i.findWhere({value:this.inputRecFind.getValue()})),o?(s.mathRecList.selectRecord(o),s.mathRecList.scrollToRecord(o)):/^[A-Z]+$/i.test(this.inputRecFind.getValue())?(o=i.add({value:this.inputRecFind.getValue(),defaultValue:!1,defaultDisabled:!1}),this.arrAddRec.push(o.get("value")),t=o,e=s.appPrefix+"settings-rec-functions-add",n=JSON.stringify(s.arrAddRec),Common.Utils.InternalSettings.set(e,n),Common.localStorage.setItem(e,n),s.api.asc_AddFromAutoCorrectMathFunctions(t.get("value")),s.mathRecList.selectRecord(t),s.mathRecList.scrollToRecord(t)):Common.UI.warning({maxwidth:500,msg:this.textWarnAddRec})},onSelectRecItem:function(t,e,i){i&&this.inputRecFind.setValue(i.get("value")),this.updateRecControls(i)},updateRecControls:function(t){if(this.mathRecList){t=t||this.mathRecList.getSelectedRec();var e=this.inputRecFind.getValue();this.btnDeleteRec.setCaption(t&&t.get("defaultDisabled")?this.textRestore:this.textDelete),this.btnDeleteRec.setDisabled(!t),this.btnAddRec.setDisabled(!!t||!e)}},textTitle:"AutoCorrect",textMathCorrect:"Math AutoCorrect",textReplace:"Replace",textBy:"By",textResetAll:"Reset to default",textAdd:"Add",textDelete:"Delete",textRestore:"Restore",textReset:"Reset",textReplaceType:"Replace text as you type",warnReset:"Any autocorrect you added will be removed and the changed ones will be restored to their original values. Do you want to continue?",warnReplace:"The autocorrect entry for %1 already exists. Do you want to replace it?",warnRestore:"The autocorrect entry for %1 will be reset to its original value. Do you want to continue?",textRecognized:"Recognized Functions",textRecognizedDesc:"The following expressions are recognized math expressions. They will not be automatically italicized.",textWarnAddRec:"Recognized functions must contain only the letters A through Z, uppercase or lowercase.",textWarnResetRec:"Any expression you added will be removed and the removed ones will be restored. Do you want to continue?",textAutoFormat:"AutoFormat As You Type",textReplaceText:"Replace As You Type",textApplyText:"Apply As You Type",textQuotes:'"Straight quotes" with "smart quotes"',textHyphens:"Hyphens (--) with dash (—)",textBulleted:"Automatic bulleted lists",textNumbered:"Automatic numbered lists",textApplyAsWork:"Apply as you work",textNewRowCol:"Include new rows and columns in table",textAutoCorrect:"AutoCorrect",textFLSentence:"Capitalize first letter of sentences",textHyperlink:"Internet and network paths with hyperlinks",textFLCells:"Capitalize first letter of table cells",textDoubleSpaces:"Add period with double-space"},Common.Views.AutoCorrectDialog||{}))})),define("spreadsheeteditor/main/app/view/FileMenuPanels",["common/main/lib/view/DocumentAccessDialog","common/main/lib/view/AutoCorrectDialog"],(function(){"use strict";!SSE.Views.FileMenuPanels&&(SSE.Views.FileMenuPanels={}),SSE.Views.FileMenuPanels.ViewSaveAs=Common.UI.BaseView.extend({el:"#panel-saveas",menu:void 0,formats:[[{name:"XLSX",imgCls:"xlsx",type:Asc.c_oAscFileType.XLSX},{name:"PDF",imgCls:"pdf",type:Asc.c_oAscFileType.PDF},{name:"ODS",imgCls:"ods",type:Asc.c_oAscFileType.ODS},{name:"CSV",imgCls:"csv",type:Asc.c_oAscFileType.CSV}],[{name:"XLTX",imgCls:"xltx",type:Asc.c_oAscFileType.XLTX},{name:"PDFA",imgCls:"pdfa",type:Asc.c_oAscFileType.PDFA},{name:"OTS",imgCls:"ots",type:Asc.c_oAscFileType.OTS},{name:"XLSM",imgCls:"xlsm",type:Asc.c_oAscFileType.XLSM}]],template:_.template(["<table><tbody>","<% _.each(rows, function(row) { %>","<tr>","<% _.each(row, function(item) { %>",'<% if (item.type!==Asc.c_oAscFileType.XLSM || fileType=="xlsm") { %>','<td><div><div class="btn-doc-format" format="<%= item.type %>" data-hint="2" data-hint-direction="left-top" data-hint-offset="4, 4">','<div class ="svg-format-<%= item.imgCls %>"></div>',"</div></div></td>","<% } %>","<% }) %>","</tr>","<% }) %>","</tbody></table>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.fileType=t.fileType},render:function(){return this.$el.html(this.template({rows:this.formats,fileType:(this.fileType||"xlsx").toLowerCase()})),$(".btn-doc-format",this.el).on("click",_.bind(this.onFormatClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onFormatClick:function(t){var e=t.currentTarget.attributes.format;!_.isUndefined(e)&&this.menu&&this.menu.fireEvent("saveas:format",[this.menu,parseInt(e.value)])}}),SSE.Views.FileMenuPanels.ViewSaveCopy=Common.UI.BaseView.extend({el:"#panel-savecopy",menu:void 0,formats:[[{name:"XLSX",imgCls:"xlsx",type:Asc.c_oAscFileType.XLSX,ext:".xlsx"},{name:"PDF",imgCls:"pdf",type:Asc.c_oAscFileType.PDF,ext:".pdf"},{name:"ODS",imgCls:"ods",type:Asc.c_oAscFileType.ODS,ext:".ods"},{name:"CSV",imgCls:"csv",type:Asc.c_oAscFileType.CSV,ext:".csv"}],[{name:"XLTX",imgCls:"xltx",type:Asc.c_oAscFileType.XLTX,ext:".xltx"},{name:"PDFA",imgCls:"pdfa",type:Asc.c_oAscFileType.PDFA,ext:".pdf"},{name:"OTS",imgCls:"ots",type:Asc.c_oAscFileType.OTS,ext:".ots"},{name:"XLSM",imgCls:"xlsm",type:Asc.c_oAscFileType.XLSM,ext:".xlsm"}]],template:_.template(["<table><tbody>","<% _.each(rows, function(row) { %>","<tr>","<% _.each(row, function(item) { %>",'<% if (item.type!==Asc.c_oAscFileType.XLSM || fileType=="xlsm") { %>','<td><div><div class="btn-doc-format" format="<%= item.type %>", format-ext="<%= item.ext %>" data-hint="2" data-hint-direction="left-top" data-hint-offset="4, 4">','<div class ="svg-format-<%= item.imgCls %>"></div>',"</div></div></td>","<% } %>","<% }) %>","</tr>","<% }) %>","</tbody></table>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.fileType=t.fileType},render:function(){return this.$el.html(this.template({rows:this.formats,fileType:(this.fileType||"xlsx").toLowerCase()})),$(".btn-doc-format",this.el).on("click",_.bind(this.onFormatClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onFormatClick:function(t){var e=t.currentTarget.attributes.format,i=t.currentTarget.attributes["format-ext"];_.isUndefined(e)||_.isUndefined(i)||!this.menu||this.menu.fireEvent("savecopy:format",[this.menu,parseInt(e.value),i.value])}}),SSE.Views.FileMenuPanels.MainSettingsGeneral=Common.UI.BaseView.extend(_.extend({el:"#panel-settings",menu:void 0,template:_.template(['<div class="flex-settings">','<table class="main" style="margin: 10px 14px auto;"><tbody>','<tr class="editsave">','<td class="group-name top" colspan="2"><label><%= scope.txtEditingSaving %></label></td>',"</tr>",'<tr class="autosave">','<td colspan = "2"><span id="fms-chb-autosave"></span></td>',"</tr>",'<tr class="forcesave">','<td colspan="2"><span id="fms-chb-forcesave"></span></td>',"</tr>",'<tr class="edit">','<td colspan = "2"><div id="fms-chb-paste-settings"></div></td>',"</tr>",'<tr class ="editsave divider-group"></tr>','<tr class="collaboration" >','<td class="group-name" colspan="2"><label><%= scope.txtCollaboration %></label></td>',"</tr>",'<tr class="coauth changes">','<td class="subgroup-name" colspan="2"><label><%= scope.strCoAuthMode %></label></td>',"</tr>",'<tr class="coauth changes">','<td colspan="2"><div style="display: flex;">','<div id="fms-rb-coauth-mode-fast"></div>','<span style ="display: flex; flex-direction: column;"><label><%= scope.strFast %></label>','<label class="comment-text"><%= scope.txtFastTip %></label></span>',"</div></td>","</tr>",'<tr class="coauth changes">','<td colspan="2"><div style="display: flex; ">','<div id="fms-rb-coauth-mode-strict"></div>','<span style ="display: flex; flex-direction: column;"><label><%= scope.strStrict %></label>','<label class="comment-text"><%= scope.txtStrictTip %></label></span>',"</div></td>","</div></tr>",'<tr class ="divider coauth changes"></tr>','<tr class="live-viewer">','<td colspan="2"><div id="fms-chb-live-viewer"></div></td>',"</tr>",'<tr class="divider live-viewer"></tr>','<tr class="comments">','<td colspan="2"><div id="fms-chb-live-comment"></div></td>',"</tr>",'<tr class="comments">','<td colspan="2"><div id="fms-chb-resolved-comment"></div></td>',"</tr>",'<tr class ="collaboration divider-group"></tr>',"<tr >",'<td class="group-name" colspan="2"><label><%= scope.txtWorkspace %></label></td>',"</tr>","<tr>",'<td colspan="2"><div id="fms-chb-r1c1-style"></div></td>',"</tr>","<tr>",'<td colspan="2"><div id="fms-chb-use-alt-key"></div></td>',"</tr>",'<tr class="themes">',"<td><label><%= scope.strTheme %></label></td>",'<td><span id="fms-cmb-theme"></span></td>',"</tr>","<tr>","<td><label><%= scope.strUnit %></label></td>",'<td><span id="fms-cmb-unit"></span></td>',"</tr>","<tr>","<td><label><%= scope.strZoom %></label></td>",'<td><div id="fms-cmb-zoom" class="input-group-nr"></div></td>',"</tr>","<tr>","<td><label><%= scope.strFontRender %></label></td>",'<td><span id="fms-cmb-font-render"></span></td>',"</tr>",'<tr class="macros">',"<td><label><%= scope.strMacrosSettings %></label></td>","<td>",'<div><div id="fms-cmb-macros" style="display: inline-block; margin-right: 15px;vertical-align: middle;"></div>',"</td>","</tr>",'<tr class ="divider-group"></tr>',"<tr>",'<td class="group-name" colspan="2"><label><%= scope.strRegSettings %></label></td>',"</tr>",'<tr class="">',"<td><label><%= scope.strFuncLocale %></label></td>","<td>",'<div><div id="fms-cmb-func-locale" style="display: inline-block; margin-right: 15px;vertical-align: middle;"></div>','<label id="fms-lbl-func-locale" style="vertical-align: middle;"><%= scope.strFuncLocaleEx %></label></div></td>',"</tr>","<tr>","<td><label><%= scope.txtRegion %></label></td>","<td>",'<div><div id="fms-cmb-reg-settings" style="display: inline-block; margin-right: 15px;vertical-align: middle;"></div>','<label id="fms-lbl-reg-settings" style="vertical-align: middle;"></label></div></td>',"</tr>","<tr>",'<td colspan="2"><div id="fms-chb-separator-settings"></div></td>',"</tr>","<tr>",'<td><label class = "label-separator"><%= scope.strDecimalSeparator %></label></td>','<td><div id="fms-decimal-separator"></div></td>',"</tr>","<tr>",'<td><label class = "label-separator"><%= scope.strThousandsSeparator %></label></td>','<td><div id="fms-thousands-separator"></div></td>',"</tr>",'<tr class ="divider-group"></tr>','<tr class="edit">','<td colspan="2" class="group-name"><label><%= scope.txtProofing %></label></td>',"</tr>",'<tr class="spellcheck">',"<td><label><%= scope.strDictionaryLanguage %></label></td>",'<td><span id="fms-cmb-dictionary-language"></span></td>',"</tr>",'<tr class="spellcheck">','<td colspan="2"><span id="fms-chb-ignore-uppercase-words"></span></td>',"</tr>",'<tr class="spellcheck">','<td colspan="2"><span id="fms-chb-ignore-numbers-words"></span></td>',"</tr>",'<tr  class="edit">','<td colspan="2"><button type="button" class="btn btn-text-default" id="fms-btn-auto-correct" style="width:auto; display: inline-block;padding-right: 10px;padding-left: 10px;" data-hint="2" data-hint-direction="bottom" data-hint-offset="big"><%= scope.txtAutoCorrect %></button></div></td>',"</tr>",'<tr class ="edit divider-group"></tr>','<tr class="edit">','<td colspan="2" class="group-name"><label><%= scope.txtCalculating %></label></td>',"</tr>",'<tr class="edit">','<td colspan="2"><span id="fms-chb-date-1904"></span></td>',"</tr>",'<tr class ="edit divider-group"></tr>','<tr class="fms-btn-apply">','<td style="padding-top:15px; padding-bottom: 15px;"><button class="btn normal dlg-btn primary" data-hint="3" data-hint-direction="bottom" data-hint-offset="big"><%= scope.okButtonText %></button></td>',"<td></td>","</tr>","</tbody></table>","</div>",'<div class="fms-flex-apply hidden">','<table class="main" style="margin: 10px 18px; width: 100%"><tbody>',"<tr>",'<td><button class="btn normal dlg-btn primary" data-hint="2" data-hint-direction="bottom" data-hint-offset="big"><%= scope.okButtonText %></button></td>',"<td></td>","</tr>","</tbody></table>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu},render:function(t){var e=this,i=$(this.template({scope:this}));this.chLiveComment=new Common.UI.CheckBox({el:i.findById("#fms-chb-live-comment"),labelText:this.strShowComments,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(t,i,n,o){e.chResolvedComment.setDisabled("checked"!==t.getValue())})),this.chResolvedComment=new Common.UI.CheckBox({el:i.findById("#fms-chb-resolved-comment"),labelText:this.strShowResolvedComments,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.chR1C1Style=new Common.UI.CheckBox({el:i.findById("#fms-chb-r1c1-style"),labelText:this.strReferenceStyle,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.chUseAltKey=new Common.UI.CheckBox({el:i.findById("#fms-chb-use-alt-key"),labelText:Common.Utils.isMac?this.txtUseOptionKey:this.txtUseAltKey,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.rbCoAuthModeFast=new Common.UI.RadioBox({el:i.findById("#fms-rb-coauth-mode-fast"),name:"coauth-mode",dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(){e.chAutosave.setValue(1)})),this.rbCoAuthModeFast.$el.parent().on("click",(function(){e.rbCoAuthModeFast.setValue(!0)})),this.rbCoAuthModeStrict=new Common.UI.RadioBox({el:i.findById("#fms-rb-coauth-mode-strict"),name:"coauth-mode",dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.rbCoAuthModeStrict.$el.parent().on("click",(function(){e.rbCoAuthModeStrict.setValue(!0)})),this.chLiveViewer=new Common.UI.CheckBox({el:i.findById("#fms-chb-live-viewer"),labelText:this.strShowOthersChanges,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.cmbZoom=new Common.UI.ComboBox({el:i.findById("#fms-cmb-zoom"),style:"width: 160px;",editable:!1,menuCls:"menu-aligned",cls:"input-group-nr",menuStyle:"min-width:100%; max-height: 157px;",data:[{value:50,displayValue:"50%"},{value:60,displayValue:"60%"},{value:70,displayValue:"70%"},{value:80,displayValue:"80%"},{value:90,displayValue:"90%"},{value:100,displayValue:"100%"},{value:110,displayValue:"110%"},{value:120,displayValue:"120%"},{value:150,displayValue:"150%"},{value:175,displayValue:"175%"},{value:200,displayValue:"200%"},{value:300,displayValue:"300%"},{value:400,displayValue:"400%"},{value:500,displayValue:"500%"}],dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"});var n=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" <% if (item.value === "custom") { %> class="border-top" style="margin-top: 5px;padding-top: 5px;" <% } %> ><a tabindex="-1" type="menuitem" <% if (typeof(item.checked) !== "undefined" && item.checked) { %> class="checked" <% } %> ><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>"].join(""));this.cmbFontRender=new Common.UI.ComboBox({el:i.findById("#fms-cmb-font-render"),style:"width: 160px;",editable:!1,menuCls:"menu-aligned",cls:"input-group-nr",menuStyle:"min-width:100%;",itemsTemplate:n,data:[{value:Asc.c_oAscFontRenderingModeType.hintingAndSubpixeling,displayValue:this.txtWin},{value:Asc.c_oAscFontRenderingModeType.noHinting,displayValue:this.txtMac},{value:Asc.c_oAscFontRenderingModeType.hinting,displayValue:this.txtNative},{value:"custom",displayValue:this.txtCacheMode}],dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbFontRender.on("selected",_.bind(this.onFontRenderSelected,this)),this.chAutosave=new Common.UI.CheckBox({el:i.findById("#fms-chb-autosave"),labelText:this.textAutoSave,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(t,i,n,o){"checked"!==t.getValue()&&e.rbCoAuthModeFast.getValue()&&e.rbCoAuthModeStrict.setValue(!0)})),this.chForcesave=new Common.UI.CheckBox({el:i.findById("#fms-chb-forcesave"),labelText:this.textForceSave,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.cmbUnit=new Common.UI.ComboBox({el:i.findById("#fms-cmb-unit"),style:"width: 160px;",editable:!1,menuCls:"menu-aligned",menuStyle:"min-width:100%;",cls:"input-group-nr",data:[{value:Common.Utils.Metric.c_MetricUnits.cm,displayValue:this.txtCm},{value:Common.Utils.Metric.c_MetricUnits.pt,displayValue:this.txtPt},{value:Common.Utils.Metric.c_MetricUnits.inch,displayValue:this.txtInch}],dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"});var o=[];SSE.Collections.formulasLangs.forEach((function(t){var i=t.replace(/[\-_]/,"");i=i.charAt(0).toUpperCase()+i.substring(1,i.length),o.push({value:t,displayValue:e["txt"+i+"lang"]||e["txt"+i],exampleValue:e["txtExample"+i]||e.txtExampleEn})})),o.sort((function(t,e){return t.displayValue<e.displayValue?-1:t.displayValue>e.displayValue?1:0})),this.cmbFuncLocale=new Common.UI.ComboBox({el:i.findById("#fms-cmb-func-locale"),style:"width: 200px;",menuStyle:"min-width:100%; max-height: 185px;",editable:!1,menuCls:"menu-aligned",cls:"input-group-nr",data:o,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.updateFuncExample(i.exampleValue)}));var s=[{value:1068},{value:1026},{value:1029},{value:3079},{value:1031},{value:2055},{value:1032},{value:3081},{value:2057},{value:1033},{value:3082},{value:2058},{value:1035},{value:1036},{value:4108},{value:1040},{value:2064},{value:1041},{value:1042},{value:1062},{value:1038},{value:1043},{value:1045},{value:1046},{value:2070},{value:1049},{value:1051},{value:1060},{value:2077},{value:1053},{value:1055},{value:1058},{value:1066},{value:2052}];s.forEach((function(t){var e=Common.util.LanguageInfo.getLocalLanguageName(t.value);t.displayValue=e[1],t.langName=e[0]})),this.cmbRegSettings=new Common.UI.ComboBox({el:i.findById("#fms-cmb-reg-settings"),style:"width: 200px;",menuStyle:"min-width:100%; max-height: 185px;",menuCls:"menu-aligned",editable:!1,cls:"input-group-nr",data:s,template:_.template(['<span class="input-group combobox <%= cls %> combo-langs" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control" style="padding-left: 25px !important;" data-hint="2" data-hint-direction="bottom" data-hint-offset="big">','<span class="icon input-icon lang-flag"></span>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret" />',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding-left: 26px !important;">','<i class="icon lang-flag <%= item.langName %>" style="position: absolute;margin-left:-21px;"></i>',"<%= scope.getDisplayValue(item) %>","</a>","</li>","<% }); %>","</ul>","</span>"].join(""))}).on("selected",(function(t,i){e.updateRegionalExample(i.value),"checked"===e.chSeparator.getValue()&&(e.inputDecimalSeparator.setValue(e.api.asc_getDecimalSeparator(i.value),!0),e.inputThousandsSeparator.setValue(e.api.asc_getGroupSeparator(i.value),!0))})),this.cmbRegSettings.scroller&&this.cmbRegSettings.scroller.update({alwaysVisibleY:!0}),this.chSeparator=new Common.UI.CheckBox({el:i.findById("#fms-chb-separator-settings"),labelText:this.strUseSeparatorsBasedOnRegionalSettings,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("change",_.bind((function(t,e,i,n){var o="checked"===t.getValue();if(o){var s=this.cmbRegSettings.getValue(),a=this.api.asc_getDecimalSeparator(_.isNumber(s)?s:void 0),l=this.api.asc_getGroupSeparator(_.isNumber(s)?s:void 0);this.inputDecimalSeparator.setValue(a),this.inputThousandsSeparator.setValue(l)}this.inputDecimalSeparator.setDisabled(o),this.inputThousandsSeparator.setDisabled(o),o?this.$el.find(".label-separator").addClass("disabled"):this.$el.find(".label-separator").removeClass("disabled")}),this));var a=function(t){var e=t.key,i=t.target.value;"ArrowLeft"!==e&&"ArrowDown"!==e&&"ArrowUp"!==e&&"ArrowRight"!==e&&"Home"!==e&&"End"!==e&&"Backspace"!==e&&"Delete"!==e&&i.length>0&&t.target.selectionEnd-t.target.selectionStart==0&&t.preventDefault()};return this.inputDecimalSeparator=new Common.UI.InputField({el:i.findById("#fms-decimal-separator"),style:"width: 35px;",validateOnBlur:!1,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.inputDecimalSeparator.$el.find("input").on("keydown",a),this.inputThousandsSeparator=new Common.UI.InputField({el:i.findById("#fms-thousands-separator"),style:"width: 35px;",validateOnBlur:!1,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.inputThousandsSeparator.$el.find("input").on("keydown",a),this.cmbMacros=new Common.UI.ComboBox({el:i.findById("#fms-cmb-macros"),style:"width: 160px;",editable:!1,menuCls:"menu-aligned",menuStyle:"min-width:100%;",cls:"input-group-nr",data:[{value:2,displayValue:this.txtStopMacros,descValue:this.txtStopMacrosDesc},{value:0,displayValue:this.txtWarnMacros,descValue:this.txtWarnMacrosDesc},{value:1,displayValue:this.txtRunMacros,descValue:this.txtRunMacrosDesc}],itemsTemplate:_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%- item.value %>"><a tabindex="-1" type="menuitem" style ="display: flex; flex-direction: column;">','<label><%= scope.getDisplayValue(item) %></label><label class="comment-text"><%= item.descValue %></label></a></li>',"<% }); %>"].join("")),dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.chPaste=new Common.UI.CheckBox({el:i.findById("#fms-chb-paste-settings"),labelText:this.strPasteButton,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.cmbTheme=new Common.UI.ComboBox({el:i.findById("#fms-cmb-theme"),style:"width: 160px;",editable:!1,menuCls:"menu-aligned",menuStyle:"min-width:100%;",cls:"input-group-nr",dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbDictionaryLanguage=new Common.UI.ComboBox({el:i.findById("#fms-cmb-dictionary-language"),cls:"input-group-nr",style:"width: 200px;",editable:!1,menuCls:"menu-aligned",menuStyle:"min-width: 100%; max-height: 209px;",dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.chIgnoreUppercase=new Common.UI.CheckBox({el:i.findById("#fms-chb-ignore-uppercase-words"),labelText:this.strIgnoreWordsInUPPERCASE,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.chIgnoreNumbers=new Common.UI.CheckBox({el:i.findById("#fms-chb-ignore-numbers-words"),labelText:this.strIgnoreWordsWithNumbers,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.chDateSystem=new Common.UI.CheckBox({el:i.findById("#fms-chb-date-1904"),labelText:this.strDateFormat1904,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.btnAutoCorrect=new Common.UI.Button({el:i.findById("#fms-btn-auto-correct")}),this.btnAutoCorrect.on("click",_.bind(this.autoCorrect,this)),i.find(".btn.primary").each((function(t,i){new Common.UI.Button({el:$(i)}).on("click",_.bind(e.applySettings,e))})),this.pnlSettings=i.find(".flex-settings").addBack().filter(".flex-settings"),this.pnlApply=i.find(".fms-flex-apply").addBack().filter(".fms-flex-apply"),this.pnlTable=this.pnlSettings.find("table"),this.trApply=i.find(".fms-btn-apply"),this.$el=$(t).html(i),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.pnlSettings,suppressScrollX:!0,alwaysVisibleY:!0})),Common.NotificationCenter.on({"window:resize":function(){e.isVisible()&&e.updateScroller()}}),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateSettings(),this.updateScroller()},isVisible:function(){return(this.$el||$(this.el)).is(":visible")},updateScroller:function(){if(this.scroller){Common.UI.Menu.Manager.hideAll();var t=this.$el.height()<this.pnlTable.height()+25+this.pnlApply.height();this.pnlApply.toggleClass("hidden",!t),this.trApply.toggleClass("hidden",t),this.pnlSettings.css("overflow",t?"hidden":"visible"),this.scroller.update(),this.pnlSettings.toggleClass("bordered",this.scroller.isVisible())}},setMode:function(t){this.mode=t;var e=Common.Utils.InternalSettings.get("sse-settings-coauthmode");$("tr.editsave",this.el)[t.isEdit||t.canForcesave?"show":"hide"](),$("tr.collaboration",this.el)[t.canCoAuthoring?"show":"hide"](),$("tr.edit",this.el)[t.isEdit?"show":"hide"](),$("tr.autosave",this.el)[!t.isEdit||!t.canChangeCoAuthoring&&e?"hide":"show"](),this.mode.isDesktopApp&&this.mode.isOffline&&this.chAutosave.setCaption(this.textAutoRecover),$("tr.forcesave",this.el)[t.canForcesave?"show":"hide"](),$("tr.comments",this.el)[t.canCoAuthoring?"show":"hide"](),$("tr.coauth.changes",this.el)[t.isEdit&&!t.isOffline&&t.canCoAuthoring&&t.canChangeCoAuthoring?"show":"hide"](),$("tr.live-viewer",this.el)[t.canLiveView&&!t.isOffline&&t.canChangeCoAuthoring?"show":"hide"](),$("tr.macros",this.el)[t.customization&&!1===t.customization.macros?"hide":"show"](),Common.UI.Themes.available()||$("tr.themes, tr.themes + tr.divider",this.el).hide(),$("tr.spellcheck",this.el)[Common.UI.FeaturesManager.canChange("spellcheck")&&t.isEdit?"show":"hide"]()},setApi:function(t){this.api=t},updateSettings:function(){r=null!==(r=Common.Utils.InternalSettings.get("sse-settings-zoom"))?parseInt(r):this.mode.customization&&this.mode.customization.zoom?parseInt(this.mode.customization.zoom):100;var t=this.cmbZoom.store.findWhere({value:r});this.cmbZoom.setValue(t?parseInt(t.get("value")):r>0?r+"%":100),this.chUseAltKey.setValue(Common.Utils.InternalSettings.get("sse-settings-show-alt-hints")),this.chLiveComment.setValue(Common.Utils.InternalSettings.get("sse-settings-livecomment")),this.chResolvedComment.setValue(Common.Utils.InternalSettings.get("sse-settings-resolvedcomment")),this.chR1C1Style.setValue(Common.Utils.InternalSettings.get("sse-settings-r1c1"));var e=Common.Utils.InternalSettings.get("sse-settings-coauthmode");this.rbCoAuthModeFast.setValue(e),this.rbCoAuthModeStrict.setValue(!e),this.chLiveViewer.setValue(Common.Utils.InternalSettings.get("sse-settings-coauthmode")),r=Common.Utils.InternalSettings.get("sse-settings-fontrender"),t=this.cmbFontRender.store.findWhere({value:parseInt(r)}),this.cmbFontRender.setValue(t?t.get("value"):Asc.c_oAscFontRenderingModeType.hintingAndSubpixeling),this._fontRender=this.cmbFontRender.getValue(),r=Common.Utils.InternalSettings.get("sse-settings-cachemode"),(t=this.cmbFontRender.store.findWhere({value:"custom"}))&&r&&t.set("checked",!!r),t&&r&&this.cmbFontRender.cmpEl.find("#"+t.get("id")+" a").addClass("checked"),r=Common.Utils.InternalSettings.get("sse-settings-unit"),t=this.cmbUnit.store.findWhere({value:r}),this.cmbUnit.setValue(t?parseInt(t.get("value")):Common.Utils.Metric.getDefaultMetric()),this._oldUnits=this.cmbUnit.getValue(),r=Common.Utils.InternalSettings.get("sse-settings-autosave"),this.chAutosave.setValue(1==r),this.mode.canForcesave&&this.chForcesave.setValue(Common.Utils.InternalSettings.get("sse-settings-forcesave")),r=Common.Utils.InternalSettings.get("sse-settings-func-locale"),!(t=this.cmbFuncLocale.store.findWhere({value:r}))&&r&&(t=this.cmbFuncLocale.store.findWhere({value:r.split(/[\-\_]/)[0]})),this.cmbFuncLocale.setValue(t?t.get("value"):"en"),this.updateFuncExample(t?t.get("exampleValue"):this.txtExampleEn),(r=this.api.asc_getLocale())?(t=this.cmbRegSettings.store.findWhere({value:r}),this.cmbRegSettings.setValue(t?t.get("value"):Common.util.LanguageInfo.getLocalLanguageName(r)[1]),t&&(r=this.cmbRegSettings.getValue())):(r=this.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.mode.lang)):1033,this.cmbRegSettings.setValue(Common.util.LanguageInfo.getLocalLanguageName(r)[1])),this.updateRegionalExample(r);var i,n,o=Common.Utils.InternalSettings.get("sse-settings-use-base-separator");if(this.chSeparator.setValue(o,!0),o){var s=this.cmbRegSettings.getValue();i=this.api.asc_getDecimalSeparator(_.isNumber(s)?s:void 0),n=this.api.asc_getGroupSeparator(_.isNumber(s)?s:void 0)}else i=Common.Utils.InternalSettings.get("sse-settings-decimal-separator")||this.api.asc_getDecimalSeparator(),n=Common.Utils.InternalSettings.get("sse-settings-group-separator")||this.api.asc_getGroupSeparator();this.inputDecimalSeparator.setValue(i),this.inputThousandsSeparator.setValue(n),this.inputDecimalSeparator.setDisabled(o),this.inputThousandsSeparator.setDisabled(o),o?this.$el.find(".label-separator").addClass("disabled"):this.$el.find(".label-separator").removeClass("disabled"),t=this.cmbMacros.store.findWhere({value:Common.Utils.InternalSettings.get("sse-macros-mode")}),this.cmbMacros.setValue(t?t.get("value"):0),this.chPaste.setValue(Common.Utils.InternalSettings.get("sse-settings-paste-button"));var a=[];for(var l in Common.UI.Themes.map())a.push({value:l,displayValue:Common.UI.Themes.get(l).text});if(a.length&&(this.cmbTheme.setData(a),t=this.cmbTheme.store.findWhere({value:Common.UI.Themes.currentThemeId()}),this.cmbTheme.setValue(t?t.get("value"):Common.UI.Themes.defaultThemeId())),Common.UI.FeaturesManager.canChange("spellcheck")&&this.mode.isEdit){var r,c=SSE.getController("Spellcheck").loadLanguages(),d=c[0],h=c[1],p=c[2],m=Common.Utils.InternalSettings.get("sse-spellcheck-locale");if(r=m?parseInt(m):this.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.mode.lang)):1033,h&&h.length>0)(0===this.cmbDictionaryLanguage.store.length||p)&&this.cmbDictionaryLanguage.setData(h),!(t=this.cmbDictionaryLanguage.store.findWhere({value:r}))&&d[r]&&(r=d[r][0].split(/[\-\_]/)[0],t=this.cmbDictionaryLanguage.store.find((function(t){return 0==t.get("shortName").indexOf(r)}))),this.cmbDictionaryLanguage.setValue(t?t.get("value"):h[0].value),(r=this.cmbDictionaryLanguage.getValue())!==parseInt(m)&&Common.Utils.InternalSettings.set("sse-spellcheck-locale",r);else this.cmbDictionaryLanguage.setValue(Common.util.LanguageInfo.getLocalLanguageName(r)[1]),this.cmbDictionaryLanguage.setDisabled(!0);this.chIgnoreUppercase.setValue(Common.Utils.InternalSettings.get("sse-spellcheck-ignore-uppercase-words")),this.chIgnoreNumbers.setValue(Common.Utils.InternalSettings.get("sse-spellcheck-ignore-numbers-words")),this.chDateSystem.setValue(this.api.asc_getDate1904())}},applySettings:function(){Common.UI.Themes.setTheme(this.cmbTheme.getValue()),Common.localStorage.setItem("sse-settings-show-alt-hints",this.chUseAltKey.isChecked()?1:0),Common.Utils.InternalSettings.set("sse-settings-show-alt-hints",Common.localStorage.getBool("sse-settings-show-alt-hints")),Common.localStorage.setItem("sse-settings-zoom",this.cmbZoom.getValue()),Common.Utils.InternalSettings.set("sse-settings-zoom",Common.localStorage.getItem("sse-settings-zoom")),Common.localStorage.setItem("sse-settings-livecomment",this.chLiveComment.isChecked()?1:0),Common.localStorage.setItem("sse-settings-resolvedcomment",this.chResolvedComment.isChecked()?1:0),this.mode.isEdit&&!this.mode.isOffline&&this.mode.canCoAuthoring&&this.mode.canChangeCoAuthoring?Common.localStorage.setItem("sse-settings-coauthmode",this.rbCoAuthModeFast.getValue()?1:0):this.mode.canLiveView&&!this.mode.isOffline&&this.mode.canChangeCoAuthoring&&Common.localStorage.setItem("sse-settings-view-coauthmode",this.chLiveViewer.isChecked()?1:0),Common.localStorage.setItem("sse-settings-r1c1",this.chR1C1Style.isChecked()?1:0),Common.localStorage.setItem("sse-settings-fontrender",this.cmbFontRender.getValue());var t=this.cmbFontRender.store.findWhere({value:"custom"});Common.localStorage.setItem("sse-settings-cachemode",t&&!t.get("checked")?0:1),Common.localStorage.setItem("sse-settings-unit",this.cmbUnit.getValue()),!this.mode.isEdit||!this.mode.canChangeCoAuthoring&&Common.Utils.InternalSettings.get("sse-settings-coauthmode")||Common.localStorage.setItem("sse-settings-autosave",this.chAutosave.isChecked()?1:0),this.mode.canForcesave&&Common.localStorage.setItem("sse-settings-forcesave",this.chForcesave.isChecked()?1:0),Common.localStorage.setItem("sse-settings-func-locale",this.cmbFuncLocale.getValue()),this.cmbRegSettings.getSelectedRecord()&&Common.localStorage.setItem("sse-settings-reg-settings",this.cmbRegSettings.getValue());var e=this.chSeparator.isChecked();if(e||((i=this.inputDecimalSeparator.getValue()).length>0&&(Common.localStorage.setItem("sse-settings-decimal-separator",i),Common.Utils.InternalSettings.set("sse-settings-decimal-separator",i)),(i=this.inputThousandsSeparator.getValue()).length>0&&(Common.localStorage.setItem("sse-settings-group-separator",i),Common.Utils.InternalSettings.set("sse-settings-group-separator",i))),Common.localStorage.setBool("sse-settings-use-base-separator",e),Common.Utils.InternalSettings.set("sse-settings-use-base-separator",e),Common.localStorage.setItem("sse-macros-mode",this.cmbMacros.getValue()),Common.Utils.InternalSettings.set("sse-macros-mode",this.cmbMacros.getValue()),Common.localStorage.setItem("sse-settings-paste-button",this.chPaste.isChecked()?1:0),Common.localStorage.save(),this.menu&&(this.menu.fireEvent("settings:apply",[this.menu]),this._oldUnits!==this.cmbUnit.getValue()&&Common.NotificationCenter.trigger("settings:unitschanged",this)),Common.UI.FeaturesManager.canChange("spellcheck")&&this.mode.isEdit){var i=this.chIgnoreUppercase.isChecked();Common.localStorage.setBool("sse-spellcheck-ignore-uppercase-words",i),Common.Utils.InternalSettings.set("sse-spellcheck-ignore-uppercase-words",i),i=this.chIgnoreNumbers.isChecked(),Common.localStorage.setBool("sse-spellcheck-ignore-numbers-words",i),Common.Utils.InternalSettings.set("sse-spellcheck-ignore-numbers-words",i),this.cmbDictionaryLanguage.isDisabled()||(i=this.cmbDictionaryLanguage.getValue(),Common.localStorage.setItem("sse-spellcheck-locale",i),Common.Utils.InternalSettings.set("sse-spellcheck-locale",i)),Common.localStorage.save(),this.menu&&this.menu.fireEvent("spellcheck:apply",[this.menu])}this.mode.isEdit&&this.api.asc_setDate1904(this.chDateSystem.isChecked())},updateRegionalExample:function(t){if(this.api){var e="";if(t){var i=new Asc.asc_CFormatCellsInfo;i.asc_setType(Asc.c_oAscNumFormatType.None),i.asc_setSymbol(t);var n=this.api.asc_getFormatCells(i);e=(e=(e=this.api.asc_getLocaleExample(n[4],1000.01,t))+" "+this.api.asc_getLocaleExample(n[5],Asc.cDate().getExcelDateWithTime(),t))+" "+this.api.asc_getLocaleExample(n[6],Asc.cDate().getExcelDateWithTime(),t)}$("#fms-lbl-reg-settings").text(_.isEmpty(e)?"":this.strRegSettingsEx+e)}var o=this.cmbRegSettings.$el.find(".input-icon"),s=o.attr("lang"),a=Common.util.LanguageInfo.getLocalLanguageName(t)[0];s&&o.removeClass(s),o.addClass(a).attr("lang",a)},updateFuncExample:function(t){$("#fms-lbl-func-locale").text(_.isEmpty(t)?"":this.strRegSettingsEx+" "+t)},onFontRenderSelected:function(t,e){if("custom"==e.value){var i=t.store.findWhere({value:"custom"});i&&i.set("checked",!e.checked),t.cmpEl.find("#"+e.id+" a").toggleClass("checked",!e.checked),t.setValue(this._fontRender)}this._fontRender=t.getValue()},autoCorrect:function(){this.dlgAutoCorrect&&this.dlgAutoCorrect.isVisible()||(this.dlgAutoCorrect=new Common.Views.AutoCorrectDialog({api:this.api}),this.dlgAutoCorrect.show())},SetDisabled:function(t){t?this.$el.hide():this.mode.isEdit&&this.$el.show()},strZoom:"Default Zoom Value",okButtonText:"Apply",txtWin:"as Windows",txtMac:"as OS X",txtNative:"Native",strFontRender:"Font Hinting",strUnit:"Unit of Measurement",txtCm:"Centimeter",txtPt:"Point",textAutoSave:"Autosave",txtEn:"English",txtDe:"Deutsch",txtRu:"Russian",txtPl:"Polish",txtEs:"Spanish",txtFr:"French",txtIt:"Italian",txtExampleEn:"SUM; MIN; MAX; COUNT",txtExampleDe:"SUMME; MIN; MAX; ANZAHL",txtExampleRu:"СУММ; МИН; МАКС; СЧЁТ",txtExamplePl:"SUMA; MIN; MAX; ILE.LICZB",txtExampleEs:"SUMA; MIN; MAX; CALCULAR",txtExampleFr:"SOMME; MIN; MAX; NB",txtExampleIt:"SOMMA; MIN; MAX; CONTA.NUMERI",strFuncLocale:"Formula Language",strFuncLocaleEx:"Example: SUM; MIN; MAX; COUNT",strRegSettings:"Regional Settings",strRegSettingsEx:"Example: ",strCoAuthMode:"Co-editing mode",strFast:"Fast",strStrict:"Strict",textAutoRecover:"Autorecover",txtInch:"Inch",textForceSave:"Save to Server",textRefStyle:"Reference Style",strUseSeparatorsBasedOnRegionalSettings:"Use separators based on regional settings",strDecimalSeparator:"Decimal separator",strThousandsSeparator:"Thousands separator",txtCacheMode:"Default cache mode",strMacrosSettings:"Macros Settings",txtWarnMacros:"Show Notification",txtRunMacros:"Enable All",txtStopMacros:"Disable All",txtWarnMacrosDesc:"Disable all macros with notification",txtRunMacrosDesc:"Enable all macros without notification",txtStopMacrosDesc:"Disable all macros without notification",strTheme:"Theme",txtThemeLight:"Light",txtThemeDark:"Dark",strPasteButton:"Show Paste Options button when content is pasted",txtBe:"Belarusian",txtBg:"Bulgarian",txtCa:"Catalan",txtZh:"Chinese",txtCs:"Czech",txtDa:"Danish",txtNl:"Dutch",txtFi:"Finnish",txtEl:"Greek",txtHu:"Hungarian",txtId:"Indonesian",txtJa:"Japanese",txtKo:"Korean",txtLv:"Latvian",txtLo:"Lao",txtNb:"Norwegian",txtPtlang:"Portuguese (Portugal)",txtPtbr:"Portuguese (Brazil)",txtRo:"Romanian",txtSk:"Slovak",txtSl:"Slovenian",txtSv:"Swedish",txtTr:"Turkish",txtUk:"Ukrainian",txtVi:"Vietnamese",txtExampleBe:"СУММ; МИН; МАКС; СЧЁТ",txtExampleCa:"SUMA; MIN; MAX; COMPT",txtExampleCs:"SUMA; MIN; MAX; POČET",txtExampleDa:"SUM; MIN; MAKS; TÆL",txtExampleNl:"SOM; MIN; MAX; AANTAL",txtExampleFi:"SUMMA; MIN; MAKS; LASKE",txtExampleHu:"SZUM; MIN; MAX; DARAB",txtExampleNb:"SUMMER; MIN; STØRST; ANTALL",txtExamplePt:"SOMA; MÍNIMO; MÁXIMO; CONTAR",txtExamplePtbr:"SOMA; MÍNIMO; MÁXIMO; CONT.NÚM",txtExampleSv:"SUMMA; MIN; MAX; ANTAL",txtExampleTr:"TOPLA; MİN; MAK; BAĞ_DEĞ_SAY",txtEditingSaving:"Editing and saving",txtCollaboration:"Collaboration",strShowComments:"Show comments in sheet",strShowResolvedComments:"Show resolved comments",txtWorkspace:"Workspace",strReferenceStyle:"R1C1 reference style",txtUseAltKey:"Use Alt key to navigate the user interface using the keyboard",txtUseOptionKey:"Use Option key to navigate the user interface using the keyboard",txtRegion:"Region",txtProofing:"Proofing",strDictionaryLanguage:"Dictionary language",strIgnoreWordsInUPPERCASE:"Ignore words in UPPERCASE",strIgnoreWordsWithNumbers:"Ignore words with numbers",txtAutoCorrect:"AutoCorrect options...",txtFastTip:"Real-time co-editing. All changes are saved automatically",txtStrictTip:"Use the 'Save' button to sync the changes you and others make",strShowOthersChanges:"Show changes from other users",txtCalculating:"Calculating",strDateFormat1904:"Use 1904 date system"},SSE.Views.FileMenuPanels.MainSettingsGeneral||{})),SSE.Views.FileMenuPanels.RecentFiles=Common.UI.BaseView.extend({el:"#panel-recentfiles",menu:void 0,template:_.template(['<div id="id-recent-view" style="margin: 20px 0;"></div>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.recent=t.recent},render:function(){return this.$el.html(this.template()),this.viewRecentPicker=new Common.UI.DataView({el:$("#id-recent-view"),store:new Common.UI.DataViewStore(this.recent),itemTemplate:_.template(['<div class="recent-wrap">','<div class="recent-icon">',"<div>",'<div class="svg-file-recent"></div>',"</div>","</div>",'<div class="file-name"><% if (typeof title !== "undefined") {%><%= Common.Utils.String.htmlEncode(title || "") %><% } %></div>','<div class="file-info"><% if (typeof folder !== "undefined") {%><%= Common.Utils.String.htmlEncode(folder || "") %><% } %></div>',"</div>"].join(""))}),this.viewRecentPicker.on("item:click",_.bind(this.onRecentFileClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onRecentFileClick:function(t,e,i){this.menu&&this.menu.fireEvent("recent:open",[this.menu,i.get("url")])}}),SSE.Views.FileMenuPanels.CreateNew=Common.UI.BaseView.extend(_.extend({el:"#panel-createnew",menu:void 0,events:function(){return{"click .blank-document-btn":_.bind(this._onBlankDocument,this),"click .thumb-list .thumb-wrap":_.bind(this._onDocumentTemplate,this)}},template:_.template(['<h3 style="margin-top: 20px;"><%= scope.txtCreateNew %></h3>','<div class="thumb-list">',"<% if (blank) { %> ",'<div class="blank-document">','<div class="blank-document-btn" data-hint="2" data-hint-direction="left-top" data-hint-offset="10, 1">','<div class="btn-blank-format"><div class="svg-format-blank"></div></div>',"</div>",'<div class="title"><%= scope.txtBlank %></div>',"</div>","<% } %>","<% _.each(docs, function(item, index) { %>",'<div class="thumb-wrap" template="<%= item.url %>" data-hint="2" data-hint-direction="left-top" data-hint-offset="22, 13">','<div class="thumb" ',"<% if (!_.isEmpty(item.image)) {%> ",' style="background-image: url(<%= item.image %>);">'," <%} else {print(\"><div class='btn-blank-format'><div class='svg-file-template'></div></div>\") } %>","</div>",'<div class="title"><%= Common.Utils.String.htmlEncode(item.title || item.name || "") %></div>',"</div>","<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.docs=t.docs,this.blank=!!t.blank},render:function(){this.$el.html(this.template({scope:this,docs:this.docs,blank:this.blank}));var t=(this.blank?[{title:this.txtBlank}]:[]).concat(this.docs),e=this.$el.find(".thumb-wrap, .blank-document");return _.each(e,(function(e,i){$(e).find(".title").tooltip({title:t[i].title,placement:"cursor"})})),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},_onBlankDocument:function(){this.menu&&this.menu.fireEvent("create:new",[this.menu,"blank"])},_onDocumentTemplate:function(t){this.menu&&this.menu.fireEvent("create:new",[this.menu,t.currentTarget.attributes.template.value])},txtBlank:"Blank spreadsheet",txtCreateNew:"Create New"},SSE.Views.FileMenuPanels.CreateNew||{})),SSE.Views.FileMenuPanels.DocumentInfo=Common.UI.BaseView.extend(_.extend({el:"#panel-info",menu:void 0,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.rendered=!1,this.template=_.template(['<div class="flex-settings">','<table class="main" style="margin: 30px 0 0;">',"<tr>",'<td class="left"><label>'+this.txtPlacement+"</label></td>",'<td class="right"><label id="id-info-placement">-</label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtOwner+"</label></td>",'<td class="right"><label id="id-info-owner">-</label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtUploaded+"</label></td>",'<td class="right"><label id="id-info-uploaded">-</label></td>',"</tr>",'<tr class="divider general"></tr>','<tr class="divider general"></tr>',"<tr>",'<td class="left"><label>'+this.txtTitle+"</label></td>",'<td class="right"><div id="id-info-title"></div></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtSubject+"</label></td>",'<td class="right"><div id="id-info-subject"></div></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtComment+"</label></td>",'<td class="right"><div id="id-info-comment"></div></td>',"</tr>",'<tr class="divider"></tr>','<tr class="divider"></tr>',"<tr>",'<td class="left"><label>'+this.txtModifyDate+"</label></td>",'<td class="right"><label id="id-info-modify-date"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtModifyBy+"</label></td>",'<td class="right"><label id="id-info-modify-by"></label></td>',"</tr>",'<tr class="divider modify">','<tr class="divider modify">',"<tr>",'<td class="left"><label>'+this.txtCreated+"</label></td>",'<td class="right"><label id="id-info-date"></label></td>',"</tr>","<tr>",'<td class="left"><label>'+this.txtAppName+"</label></td>",'<td class="right"><label id="id-info-appname"></label></td>',"</tr>","<tr>",'<td class="left" style="vertical-align: top;"><label style="margin-top: 3px;">'+this.txtAuthor+"</label></td>",'<td class="right" style="vertical-align: top;"><div id="id-info-author">',"<table>","<tr>",'<td><div id="id-info-add-author"><input type="text" spellcheck="false" class="form-control" placeholder="'+this.txtAddAuthor+'"></div></td>',"</tr>","</table>","</div></td>","</tr>",'<tr style="height: 5px;"></tr>',"</table>","</div>",'<div id="fms-flex-apply">','<table class="main" style="margin: 10px 0;">',"<tr>",'<td class="left"></td>','<td class="right"><button id="fminfo-btn-apply" class="btn normal dlg-btn primary" data-hint="2" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.okButtonText %></button></td>',"</tr>","</table>","</div>"].join("")),this.menu=t.menu,this.coreProps=null,this.authors=[],this._locked=!1},render:function(t){var e=this,i=$(e.template({scope:e}));this.lblPlacement=i.findById("#id-info-placement"),this.lblOwner=i.findById("#id-info-owner"),this.lblUploaded=i.findById("#id-info-uploaded");var n=function(t,e){if(e.keyCode===Common.UI.Keys.ESC){var i=t._input.val(),n=t.getValue();i!==n&&(t.setValue(n),e.stopPropagation())}};return this.inputTitle=new Common.UI.InputField({el:i.findById("#id-info-title"),style:"width: 200px;",placeHolder:this.txtAddText,validateOnBlur:!1,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("keydown:before",n),this.inputSubject=new Common.UI.InputField({el:i.findById("#id-info-subject"),style:"width: 200px;",placeHolder:this.txtAddText,validateOnBlur:!1,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("keydown:before",n),this.inputComment=new Common.UI.InputField({el:i.findById("#id-info-comment"),style:"width: 200px;",placeHolder:this.txtAddText,validateOnBlur:!1,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("keydown:before",n),this.lblModifyDate=i.findById("#id-info-modify-date"),this.lblModifyBy=i.findById("#id-info-modify-by"),this.lblDate=i.findById("#id-info-date"),this.lblApplication=i.findById("#id-info-appname"),this.tblAuthor=i.findById("#id-info-author table"),this.trAuthor=i.findById("#id-info-add-author").closest("tr"),this.authorTpl='<tr><td><div style="display: inline-block;width: 200px;"><input type="text" spellcheck="false" class="form-control" readonly="true" value="{0}" ></div><div class="tool close img-commonctrl img-colored" data-hint="2" data-hint-direction="right" data-hint-offset="small"></div></td></tr>',this.tblAuthor.on("click",(function(t){var n=i.find(t.target);if(n.hasClass("close")&&!n.hasClass("disabled")){var o=n.closest("tr"),s=e.tblAuthor.find("tr").index(o);o.remove(),e.authors.splice(s,1),e.updateScroller(!0)}})),this.inputAuthor=new Common.UI.InputField({el:i.findById("#id-info-add-author"),style:"width: 200px;",validateOnBlur:!1,placeHolder:this.txtAddAuthor,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}).on("changed:after",(function(t,i,n,o){if(i!=n){var s=i.trim();if(s&&s!==n.trim()){var a=o&&o.relatedTarget&&"fminfo-btn-apply"==o.relatedTarget.id;s.split(/\s*[,;]\s*/).forEach((function(t){var i=t.trim();if(i&&(e.authors.push(t),!a)){var n=$(Common.Utils.String.format(e.authorTpl,Common.Utils.String.htmlEncode(i)));e.trAuthor.before(n),e.updateScroller()}})),!a&&e.inputAuthor.setValue("")}}})).on("keydown:before",n),this.btnApply=new Common.UI.Button({el:i.findById("#fminfo-btn-apply")}),this.btnApply.on("click",_.bind(this.applySettings,this)),this.pnlInfo=i.find(".flex-settings").addBack().filter(".flex-settings"),this.pnlApply=i.findById("#fms-flex-apply"),this.rendered=!0,this.updateInfo(this.doc),this.$el=$(t).html(i),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.pnlInfo,suppressScrollX:!0,alwaysVisibleY:!0})),Common.NotificationCenter.on({"window:resize":function(){e.isVisible()&&e.updateScroller()}}),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateFileInfo(),this.scroller&&this.scroller.scrollTop(0),this.updateScroller()},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments)},updateScroller:function(t){this.scroller&&(this.scroller.update(t?{}:void 0),this.pnlInfo.toggleClass("bordered",this.scroller.isVisible()))},updateInfo:function(t){if(this.doc=t,this.rendered){var e=!1;if((t=t||{}).info)t.info.folder&&this.lblPlacement.text(t.info.folder),e=this._ShowHideInfoItem(this.lblPlacement,void 0!==t.info.folder&&null!==t.info.folder)||e,(n=t.info.owner)&&this.lblOwner.text(n),e=this._ShowHideInfoItem(this.lblOwner,!!n)||e,(n=t.info.uploaded)&&this.lblUploaded.text(n),e=this._ShowHideInfoItem(this.lblUploaded,!!n)||e;else this._ShowHideDocInfo(!1);$("tr.divider.general",this.el)[e?"show":"hide"]();var i=this.api?this.api.asc_getAppProps():null;if(i&&(i=(i.asc_getApplication()||"")+(i.asc_getAppVersion()?" ":"")+(i.asc_getAppVersion()||""),this.lblApplication.text(i)),this._ShowHideInfoItem(this.lblApplication,!!i),this.coreProps=this.api?this.api.asc_getCoreProps():null,this.coreProps){var n;if(n=this.coreProps.asc_getCreated()){var o=(this.mode.lang||"en").replace("_","-").toLowerCase();try{this.lblDate.text(n.toLocaleString(o,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+n.toLocaleString(o,{timeStyle:"short"}))}catch(t){o="en",this.lblDate.text(n.toLocaleString(o,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+n.toLocaleString(o,{timeStyle:"short"}))}}this._ShowHideInfoItem(this.lblDate,!!n)}}},updateFileInfo:function(){if(this.rendered){var t,e=this,i=this.api?this.api.asc_getCoreProps():null;if(this.coreProps=i,i){var n=!1;if(t=i.asc_getModified()){var o=(this.mode.lang||"en").replace("_","-").toLowerCase();try{this.lblModifyDate.text(t.toLocaleString(o,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+t.toLocaleString(o,{timeStyle:"short"}))}catch(e){o="en",this.lblModifyDate.text(t.toLocaleString(o,{year:"numeric",month:"2-digit",day:"2-digit"})+" "+t.toLocaleString(o,{timeStyle:"short"}))}}n=this._ShowHideInfoItem(this.lblModifyDate,!!t)||n,(t=i.asc_getLastModifiedBy())&&this.lblModifyBy.text(AscCommon.UserInfoParser.getParsedName(t)),n=this._ShowHideInfoItem(this.lblModifyBy,!!t)||n,$("tr.divider.modify",this.el)[n?"show":"hide"](),t=i.asc_getTitle(),this.inputTitle.setValue(t||""),t=i.asc_getSubject(),this.inputSubject.setValue(t||""),t=i.asc_getDescription(),this.inputComment.setValue(t||""),this.inputAuthor.setValue(""),this.tblAuthor.find("tr:not(:last-of-type)").remove(),this.authors=[],(t=i.asc_getCreator())&&t.split(/\s*[,;]\s*/).forEach((function(t){var i=$(Common.Utils.String.format(e.authorTpl,Common.Utils.String.htmlEncode(t)));e.trAuthor.before(i),e.authors.push(t)})),this.tblAuthor.find(".close").toggleClass("hidden",!this.mode.isEdit),!this.mode.isEdit&&this._ShowHideInfoItem(this.tblAuthor,!!this.authors.length)}this.SetDisabled()}},_ShowHideInfoItem:function(t,e){return t.closest("tr")[e?"show":"hide"](),e},_ShowHideDocInfo:function(t){this._ShowHideInfoItem(this.lblPlacement,t),this._ShowHideInfoItem(this.lblOwner,t),this._ShowHideInfoItem(this.lblUploaded,t)},setMode:function(t){return this.mode=t,this.inputAuthor.setVisible(t.isEdit),this.pnlApply.toggleClass("hidden",!t.isEdit),this.tblAuthor.find(".close").toggleClass("hidden",!t.isEdit),t.isEdit||(this.inputTitle._input.attr("placeholder",""),this.inputSubject._input.attr("placeholder",""),this.inputComment._input.attr("placeholder",""),this.inputAuthor._input.attr("placeholder","")),this.SetDisabled(),this},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onLockCore",_.bind(this.onLockCore,this)),this.updateInfo(this.doc),this},onLockCore:function(t){this._locked=t,this.updateFileInfo()},SetDisabled:function(){var t=!this.mode.isEdit||this._locked;this.inputTitle.setDisabled(t),this.inputSubject.setDisabled(t),this.inputComment.setDisabled(t),this.inputAuthor.setDisabled(t),this.tblAuthor.find(".close").toggleClass("disabled",this._locked),this.tblAuthor.toggleClass("disabled",t),this.btnApply.setDisabled(this._locked)},applySettings:function(){this.coreProps&&this.api&&(this.coreProps.asc_putTitle(this.inputTitle.getValue()),this.coreProps.asc_putSubject(this.inputSubject.getValue()),this.coreProps.asc_putDescription(this.inputComment.getValue()),this.coreProps.asc_putCreator(this.authors.join(";")),this.api.asc_setCoreProps(this.coreProps)),this.menu.hide()},txtPlacement:"Location",txtOwner:"Owner",txtUploaded:"Uploaded",txtAppName:"Application",txtTitle:"Title",txtSubject:"Subject",txtComment:"Comment",txtModifyDate:"Last Modified",txtModifyBy:"Last Modified By",txtCreated:"Created",txtAuthor:"Author",txtAddAuthor:"Add Author",txtAddText:"Add Text",txtMinutes:"min",okButtonText:"Apply"},SSE.Views.FileMenuPanels.DocumentInfo||{})),SSE.Views.FileMenuPanels.DocumentRights=Common.UI.BaseView.extend(_.extend({el:"#panel-rights",menu:void 0,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.rendered=!1,this.template=_.template(['<table class="main" style="margin: 30px 0;">','<tr class="rights">','<td class="left" style="vertical-align: top;"><label>'+this.txtRights+"</label></td>",'<td class="right"><div id="id-info-rights"></div></td>',"</tr>",'<tr class="edit-rights">','<td class="left"></td><td class="right"><button id="id-info-btn-edit" class="btn normal dlg-btn primary custom" style="margin-right: 10px;">'+this.txtBtnAccessRights+"</button></td>","</tr>","</table>"].join("")),this.templateRights=_.template(["<table>","<% _.each(users, function(item) { %>","<tr>",'<td><span class="userLink img-commonctrl <% if (item.isLink) { %>sharedLink<% } %>"></span><span><%= Common.Utils.String.htmlEncode(item.user) %></span></td>',"<td><%= Common.Utils.String.htmlEncode(item.permissions) %></td>","</tr>","<% }); %>","</table>"].join("")),this.menu=t.menu},render:function(t){var e=$(this.template());return this.cntRights=e.findById("#id-info-rights"),this.btnEditRights=new Common.UI.Button({el:e.findById("#id-info-btn-edit")}),this.btnEditRights.on("click",_.bind(this.changeAccessRights,this)),this.rendered=!0,this.updateInfo(this.doc),this.$el=$(t).html(e),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),Common.NotificationCenter.on("collaboration:sharingupdate",this.updateSharingSettings.bind(this)),Common.NotificationCenter.on("collaboration:sharingdeny",this.onLostEditRights.bind(this)),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments)},updateInfo:function(t){this.doc=t,this.rendered&&((t=t||{}).info?(t.info.sharingSettings&&this.cntRights.html(this.templateRights({users:t.info.sharingSettings})),this._ShowHideInfoItem("rights",void 0!==t.info.sharingSettings&&null!==t.info.sharingSettings&&t.info.sharingSettings.length>0),this._ShowHideInfoItem("edit-rights",(!!this.sharingSettingsUrl&&this.sharingSettingsUrl.length||this.mode.canRequestSharingSettings)&&!0!==this._readonlyRights)):this._ShowHideDocInfo(!1))},_ShowHideInfoItem:function(t,e){$("tr."+t,this.el)[e?"show":"hide"]()},_ShowHideDocInfo:function(t){this._ShowHideInfoItem("rights",t),this._ShowHideInfoItem("edit-rights",t)},setMode:function(t){return this.mode=t,this.sharingSettingsUrl=t.sharingSettingsUrl,this},changeAccessRights:function(t,e,i){Common.NotificationCenter.trigger("collaboration:sharing")},updateSharingSettings:function(t){this._ShowHideInfoItem("rights",void 0!==this.doc.info.sharingSettings&&null!==this.doc.info.sharingSettings&&this.doc.info.sharingSettings.length>0),this.cntRights.html(this.templateRights({users:this.doc.info.sharingSettings}))},onLostEditRights:function(){this._readonlyRights=!0,this.rendered&&this._ShowHideInfoItem("edit-rights",!1)},txtRights:"Persons who have rights",txtBtnAccessRights:"Change access rights"},SSE.Views.FileMenuPanels.DocumentRights||{})),SSE.Views.FileMenuPanels.Help=Common.UI.BaseView.extend({el:"#panel-help",menu:void 0,template:_.template(['<div style="width:100%; height:100%; position: relative;">','<div id="id-help-contents" style="position: absolute; width:220px; top: 0; bottom: 0;" class="no-padding"></div>','<div id="id-help-frame" style="position: absolute; left: 220px; top: 0; right: 0; bottom: 0;" class="no-padding"></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.urlPref="resources/help/en/",this.openUrl=null,this.urlHelpCenter="https://helpcenter.onlyoffice.com/userguides/docs-se.aspx",this.en_data=[{src:"ProgramInterface/ProgramInterface.htm",name:"Introducing Spreadsheet Editor user interface",headername:"Program Interface"},{src:"ProgramInterface/FileTab.htm",name:"File tab"},{src:"ProgramInterface/HomeTab.htm",name:"Home Tab"},{src:"ProgramInterface/InsertTab.htm",name:"Insert tab"},{src:"ProgramInterface/PluginsTab.htm",name:"Plugins tab"},{src:"UsageInstructions/OpenCreateNew.htm",name:"Create a new spreadsheet or open an existing one",headername:"Basic operations"},{src:"UsageInstructions/CopyPasteData.htm",name:"Cut/copy/paste data"},{src:"UsageInstructions/UndoRedo.htm",name:"Undo/redo your actions"},{src:"UsageInstructions/ManageSheets.htm",name:"Manage sheets",headername:"Operations with sheets"},{src:"UsageInstructions/FontTypeSizeStyle.htm",name:"Set font type, size, style, and colors",headername:"Cell text formatting"},{src:"UsageInstructions/AddHyperlinks.htm",name:"Add hyperlinks"},{src:"UsageInstructions/ClearFormatting.htm",name:"Clear text, format in a cell, copy cell format"},{src:"UsageInstructions/AddBorders.htm",name:"Add borders",headername:"Editing cell properties"},{src:"UsageInstructions/AlignText.htm",name:"Align data in cells"},{src:"UsageInstructions/MergeCells.htm",name:"Merge cells"},{src:"UsageInstructions/ChangeNumberFormat.htm",name:"Change number format"},{src:"UsageInstructions/InsertDeleteCells.htm",name:"Manage cells, rows, and columns",headername:"Editing rows/columns"},{src:"UsageInstructions/SortData.htm",name:"Sort and filter data"},{src:"UsageInstructions/InsertFunction.htm",name:"Insert function",headername:"Work with functions"},{src:"UsageInstructions/UseNamedRanges.htm",name:"Use named ranges"},{src:"UsageInstructions/InsertImages.htm",name:"Insert images",headername:"Operations on objects"},{src:"UsageInstructions/InsertChart.htm",name:"Insert chart"},{src:"UsageInstructions/InsertAutoshapes.htm",name:"Insert and format autoshapes"},{src:"UsageInstructions/InsertTextObjects.htm",name:"Insert text objects"},{src:"UsageInstructions/ManipulateObjects.htm",name:"Manipulate objects"},{src:"UsageInstructions/InsertEquation.htm",name:"Insert equations",headername:"Math equations"},{src:"HelpfulHints/CollaborativeEditing.htm",name:"Collaborative spreadsheet editing",headername:"Spreadsheet co-editing"},{src:"UsageInstructions/ViewDocInfo.htm",name:"View file information",headername:"Tools and settings"},{src:"UsageInstructions/SavePrintDownload.htm",name:"Save/print/download your spreadsheet"},{src:"HelpfulHints/AdvancedSettings.htm",name:"Advanced settings of Spreadsheet Editor"},{src:"HelpfulHints/Navigation.htm",name:"View settings and navigation tools"},{src:"HelpfulHints/Search.htm",name:"Search and replace functions"},{src:"HelpfulHints/About.htm",name:"About Spreadsheet Editor",headername:"Helpful hints"},{src:"HelpfulHints/SupportedFormats.htm",name:"Supported formats of spreadsheets"},{src:"HelpfulHints/KeyboardShortcuts.htm",name:"Keyboard shortcuts"}],Common.Utils.isIE&&(window.onhelp=function(){return!1})},render:function(){var t=this;return this.$el.html(this.template()),this.viewHelpPicker=new Common.UI.DataView({el:$("#id-help-contents"),store:new Common.UI.DataViewStore([]),keyMoveDirection:"vertical",itemTemplate:_.template(['<div id="<%= id %>" class="help-item-wrap">','<div class="caption"><%= name %></div>',"</div>"].join(""))}),this.viewHelpPicker.on("item:add",(function(t,e,i){i.has("headername")&&$(e.el).before('<div class="header-name">'+i.get("headername")+"</div>")})),this.viewHelpPicker.on("item:select",(function(e,i,n){t.onSelectItem(n.get("src"))})),this.iFrame=document.createElement("iframe"),this.iFrame.src="",this.iFrame.align="top",this.iFrame.frameBorder="0",this.iFrame.width="100%",this.iFrame.height="100%",Common.Gateway.on("internalcommand",(function(e){if("help:hyperlink"==e.type){var i=e.data,n=t.viewHelpPicker.store.find((function(t){return i.indexOf(t.get("src"))>0}));n&&(t.viewHelpPicker.selectRecord(n,!0),t.viewHelpPicker.scrollToRecord(n))}})),$("#id-help-frame").append(this.iFrame),this},setLangConfig:function(t){var e=this,i=this.viewHelpPicker.store;if(t){t=t.split(/[\-\_]/)[0];var n={dataType:"json",error:function(){e.urlPref.indexOf("resources/help/en/")<0?(e.urlPref="resources/help/en/",i.url="resources/help/en/Contents.json",i.fetch(n)):Common.Controllers.Desktop.isActive()?"en"!==i.contentLang&&Common.Controllers.Desktop.helpUrl()?(i.contentLang=i.contentLang===t?"en":t,e.urlPref=Common.Controllers.Desktop.helpUrl()+"/"+i.contentLang+"/",i.url=e.urlPref+"Contents.json",i.fetch(n)):(e.noHelpContents=!0,e.iFrame.src="../../common/main/resources/help/download.html"):(e.urlPref="resources/help/en/",i.reset(e.en_data))},success:function(){var t=e.openUrl?i.find((function(t){return e.openUrl.indexOf(t.get("src"))>=0})):i.at(0);t&&(e.viewHelpPicker.selectRecord(t,!0),e.viewHelpPicker.scrollToRecord(t)),e.onSelectItem(e.openUrl?e.openUrl:t.get("src"))}};i.url="resources/help/"+t+"/Contents.json",i.fetch(n),this.urlPref="resources/help/"+t+"/"}},show:function(t){if(Common.UI.BaseView.prototype.show.call(this),this._scrollerInited||(this.viewHelpPicker.scroller.update(),this._scrollerInited=!0),t)if(this.viewHelpPicker.store.length>0){var e=this.viewHelpPicker.store.find((function(e){return t.indexOf(e.get("src"))>=0}));e&&(this.viewHelpPicker.selectRecord(e,!0),this.viewHelpPicker.scrollToRecord(e)),this.onSelectItem(t)}else this.openUrl=t},onSelectItem:function(t){this.iFrame.src=this.urlPref+t}}),SSE.Views.FileMenuPanels.ProtectDoc=Common.UI.BaseView.extend(_.extend({el:"#panel-protect",menu:void 0,template:_.template(['<label id="id-fms-lbl-protect-header" style="font-size: 18px;"><%= scope.strProtect %></label>','<div id="id-fms-password">','<label class="header"><%= scope.strEncrypt %></label>','<div id="fms-btn-add-pwd" style="width:190px;"></div>','<table id="id-fms-view-pwd" cols="2" width="300">',"<tr>",'<td colspan="2"><label style="cursor: default;"><%= scope.txtEncrypted %></label></td>',"</tr>","<tr>",'<td><div id="fms-btn-change-pwd" style="width:190px;"></div></td>','<td align="right"><div id="fms-btn-delete-pwd" style="width:190px; margin-left:20px;"></div></td>',"</tr>","</table>","</div>",'<div id="id-fms-signature">','<label class="header"><%= scope.strSignature %></label>','<div id="fms-btn-invisible-sign" style="width:190px; margin-bottom: 20px;"></div>','<div id="id-fms-signature-view"></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu;var e=this;this.templateSignature=_.template(['<table cols="2" width="300" class="<% if (!hasRequested && !hasSigned) { %>hidden<% } %>"">',"<tr>",'<td colspan="2"><label style="cursor: default;"><%= tipText %></label></td>',"</tr>","<tr>",'<td><label class="link signature-view-link" data-hint="2" data-hint-direction="bottom" data-hint-offset="medium">'+e.txtView+"</label></td>",'<td align="right"><label class="link signature-edit-link <% if (!hasSigned) { %>hidden<% } %>" data-hint="2" data-hint-direction="bottom" data-hint-offset="medium">'+e.txtEdit+"</label></td>","</tr>","</table>"].join(""))},render:function(){this.$el.html(this.template({scope:this}));var t=SSE.getController("Common.Controllers.Protection").getView();return this.btnAddPwd=t.getButton("add-password"),this.btnAddPwd.render(this.$el.find("#fms-btn-add-pwd")),this.btnAddPwd.on("click",_.bind(this.closeMenu,this)),this.btnChangePwd=t.getButton("change-password"),this.btnChangePwd.render(this.$el.find("#fms-btn-change-pwd")),this.btnChangePwd.on("click",_.bind(this.closeMenu,this)),this.btnDeletePwd=t.getButton("del-password"),this.btnDeletePwd.render(this.$el.find("#fms-btn-delete-pwd")),this.btnDeletePwd.on("click",_.bind(this.closeMenu,this)),this.cntPassword=$("#id-fms-password"),this.cntPasswordView=$("#id-fms-view-pwd"),this.btnAddInvisibleSign=t.getButton("signature"),this.btnAddInvisibleSign.render(this.$el.find("#fms-btn-invisible-sign")),this.btnAddInvisibleSign.on("click",_.bind(this.closeMenu,this)),this.cntSignature=$("#id-fms-signature"),this.cntSignatureView=$("#id-fms-signature-view"),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this.$el.on("click",".signature-edit-link",_.bind(this.onEdit,this)),this.$el.on("click",".signature-view-link",_.bind(this.onView,this)),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateSignatures(),this.updateEncrypt(),this.scroller&&this.scroller.update()},setMode:function(t){this.mode=t,this.cntSignature.toggleClass("hidden",!this.mode.isSignatureSupport),this.cntPassword.toggleClass("hidden",!this.mode.isPasswordSupport)},setApi:function(t){return this.api=t,this},closeMenu:function(){this.menu&&this.menu.hide()},onEdit:function(){this.menu&&this.menu.hide();var t=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtEditWarning,buttons:["ok","cancel"],primary:"ok",callback:function(e){"ok"==e&&t.api.asc_RemoveAllSignatures()}})},onView:function(){this.menu&&this.menu.hide(),SSE.getController("RightMenu").rightmenu.SetActivePane(Common.Utils.documentSettingsType.Signature,!0)},updateSignatures:function(){var t=this.api.asc_getRequestSignatures(),e=this.api.asc_getSignatures(),i=t&&t.length>0,n=!1,o=!1;_.each(e,(function(t,e){0==t.asc_getValid()?n=!0:o=!0}));var s=o?this.txtSignedInvalid:n?this.txtSigned:"";i&&(s=this.txtRequestedSignatures+(""!=s?"<br><br>":"")+s),this.cntSignatureView.html(this.templateSignature({tipText:s,hasSigned:n||o,hasRequested:i}))},updateEncrypt:function(){this.cntPasswordView.toggleClass("hidden",this.btnAddPwd.isVisible())},strProtect:"Protect Workbook",strSignature:"With Signature",txtView:"View signatures",txtEdit:"Edit workbook",txtSigned:"Valid signatures has been added to the workbook. The workbook is protected from editing.",txtSignedInvalid:"Some of the digital signatures in workbook are invalid or could not be verified. The workbook is protected from editing.",txtRequestedSignatures:"This workbook needs to be signed.",notcriticalErrorTitle:"Warning",txtEditWarning:"Editing will remove the signatures from the workbook.<br>Are you sure you want to continue?",strEncrypt:"With Password",txtEncrypted:"This workbook has been protected by password"},SSE.Views.FileMenuPanels.ProtectDoc||{})),SSE.Views.PrintWithPreview=Common.UI.BaseView.extend(_.extend({el:"#panel-print",menu:void 0,template:_.template(['<div style="width:100%; height:100%; position: relative;">','<div id="id-print-settings" class="no-padding">','<div class="print-settings">','<div class="flex-settings ps-container oo settings-container">','<table style="width: 100%;">',"<tbody>",'<tr><td><label class="header"><%= scope.txtPrintRange %></label></td></tr>','<tr><td class="padding-small"><div id="print-combo-range" style="width: 248px;"></div></td></tr>','<tr><td class="padding-large"><div id="print-chb-ignore" style="width: 248px;"></div></td></tr>','<tr><td><label class="header"><%= scope.txtSettingsOfSheet %></label></td></tr>','<tr><td class="padding-large"><div id="print-combo-sheets" style="width: 248px;"></div></td></tr>','<tr><td><label class="header"><%= scope.txtPageSize %></label></td></tr>','<tr><td class="padding-large"><div id="print-combo-pages" style="width: 248px;"></div></td></tr>','<tr><td><label class="header"><%= scope.txtPageOrientation %></label></td></tr>','<tr><td class="padding-large"><div id="print-combo-orient" style="width: 134px;"></div></td></tr>','<tr><td><label class="header"><%= scope.txtScaling %></label></td></tr>','<tr><td class="padding-large"><div id="print-combo-layout" style="width: 248px;"></div></td></tr>','<tr><td class="padding-small"><label class="header"><%= scope.txtPrintTitles %></label></td></tr>',"<tr><td><label><%= scope.txtRepeatRowsAtTop %></label></td></tr>",'<tr><td class="padding-small">',"<table><tbody><tr>",'<td><div id="print-txt-top" style="width: 163px; margin-right: 8px;"></div></td>','<td><div id="print-presets-top" style="width: 77px;"></div></td>',"</tr></tbody></table>","</td></tr>","<tr><td><label><%= scope.txtRepeatColumnsAtLeft %></label></td></tr>",'<tr><td class="padding-large">',"<table><tbody><tr>",'<td><div id="print-txt-left" style="width: 163px; margin-right: 8px;"></div></td>','<td><div id="print-presets-left" style="width: 77px;"></div></td>',"</tr></tbody></table>","</td></tr>",'<tr><td class="padding-small"><label class="header"><%= scope.txtMargins %></label></td></tr>',"<tr><td>","<table>","<tbody>","<tr>","<td><label><%= scope.txtTop %></label></td>","<td><label><%= scope.txtBottom %></label></td>","</tr>","<tr>",'<td class="padding-small"><div id="print-spin-margin-top" style="margin-right: 8px;"></div></td>','<td class="padding-small"><div id="print-spin-margin-bottom" style="margin-right: 8px;"></div></td>',"</tr>","<tr>","<td><label><%= scope.txtLeft %></label></td>","<td><label><%= scope.txtRight %></label></td>","</tr>","<tr>",'<td class="padding-large"><div id="print-spin-margin-left"></div></td>','<td class="padding-large"><div id="print-spin-margin-right"></div></td>',"</tr>","</tbody>","</table>","</td></tr>",'<tr><td class="padding-small"><label class="header"><%= scope.txtGridlinesAndHeadings %></label></td></tr>','<tr><td class="padding-small"><div id="print-chb-grid" style="width: 248px;"></div></td></tr>','<tr><td class="padding-large"><div id="print-chb-rows" style="width: 248px;"></div></td></tr>','<tr class="header-settings"><td class="padding-large"><label class="link" id="print-header-footer-settings" data-hint="2" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.txtHeaderFooterSettings %></label></td></tr>','<tr class="fms-btn-apply"><td>','<div class="footer justify">','<button id="print-btn-print-0" class="btn normal dlg-btn primary" result="print" style="width: 96px;" data-hint="2" data-hint-direction="bottom" data-hint-offset="big"><%= scope.txtPrint %></button>','<button id="print-btn-save-0" class="btn normal dlg-btn" result="save" style="width: 96px;" data-hint="2" data-hint-direction="bottom" data-hint-offset="big"><%= scope.txtSave %></button>',"</div>","</td></tr>","</tbody>","</table>","</div>",'<div class="fms-flex-apply hidden">','<div class="footer justify">','<button id="print-btn-print-1" class="btn normal dlg-btn primary" result="print" style="width: 96px;" data-hint="2" data-hint-direction="bottom" data-hint-offset="big"><%= scope.txtPrint %></button>','<button id="print-btn-save-1" class="btn normal dlg-btn" result="save" style="width: 96px;" data-hint="2" data-hint-direction="bottom" data-hint-offset="big"><%= scope.txtSave %></button>',"</div>","</div>","</div>","</div>",'<div id="print-preview-box" style="position: absolute; left: 280px; top: 0; right: 0; bottom: 0;" class="no-padding">','<div id="print-preview"></div>','<div id="print-navigation">','<div id="print-prev-page" style="display: inline-block; margin-right: 4px;"></div>','<div id="print-next-page" style="display: inline-block;"></div>','<div class="page-number">',"<label><%= scope.txtPage %></label>",'<div id="print-number-page"></div>','<label id="print-count-page"><%= scope.txtOf %></label>',"</div>",'<label id="print-active-sheet"><%= scope.txtSheet %></label>',"</div>","</div>",'<div id="print-preview-empty" class="hidden">',"<div><%= scope.txtEmptyTable %></div>","</div>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.spinners=[],this._initSettings=!0},render:function(t){var e=this,i=$(this.template({scope:this}));this.cmbRange=new Common.UI.ComboBox({el:i.findById("#print-combo-range"),menuStyle:"min-width: 248px;max-height: 280px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:Asc.c_oAscPrintType.ActiveSheets,displayValue:this.txtCurrentSheet},{value:Asc.c_oAscPrintType.EntireWorkbook,displayValue:this.txtAllSheets},{value:Asc.c_oAscPrintType.Selection,displayValue:this.txtSelection}],dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbRange.on("selected",_.bind(this.comboRangeChange,this)),this.chIgnorePrintArea=new Common.UI.CheckBox({el:i.findById("#print-chb-ignore"),labelText:this.txtIgnore,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.cmbSheet=new Common.UI.ComboBox({el:i.findById("#print-combo-sheets"),menuStyle:"min-width: 248px;max-height: 280px;",editable:!1,cls:"input-group-nr",data:[],takeFocusOnClose:!0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbPaperSize=new Common.UI.ComboBox({el:i.findById("#print-combo-pages"),menuStyle:"max-height: 280px; min-width: 248px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:"215.9|279.4",displayValue:"US Letter (21,59cm x 27,94cm)",caption:"US Letter"},{value:"215.9|355.6",displayValue:"US Legal (21,59cm x 35,56cm)",caption:"US Legal"},{value:"210|297",displayValue:"A4 (21cm x 29,7cm)",caption:"A4"},{value:"148|210",displayValue:"A5 (14,8cm x 21cm)",caption:"A5"},{value:"176|250",displayValue:"B5 (17,6cm x 25cm)",caption:"B5"},{value:"104.8|241.3",displayValue:"Envelope #10 (10,48cm x 24,13cm)",caption:"Envelope #10"},{value:"110|220",displayValue:"Envelope DL (11cm x 22cm)",caption:"Envelope DL"},{value:"279.4|431.8",displayValue:"Tabloid (27,94cm x 43,18cm)",caption:"Tabloid"},{value:"297|420",displayValue:"A3 (29,7cm x 42cm)",caption:"A3"},{value:"304.8|457.1",displayValue:"Tabloid Oversize (30,48cm x 45,71cm)",caption:"Tabloid Oversize"},{value:"196.8|273",displayValue:"ROC 16K (19,68cm x 27,3cm)",caption:"ROC 16K"},{value:"119.9|234.9",displayValue:"Envelope Choukei 3 (11,99cm x 23,49cm)",caption:"Envelope Choukei 3"},{value:"330.2|482.5",displayValue:"Super B/A3 (33,02cm x 48,25cm)",caption:"Super B/A3"}],dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.cmbPaperOrientation=new Common.UI.ComboBox({el:i.findById("#print-combo-orient"),menuStyle:"min-width: 134px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:Asc.c_oAscPageOrientation.PagePortrait,displayValue:this.txtPortrait},{value:Asc.c_oAscPageOrientation.PageLandscape,displayValue:this.txtLandscape}],dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"});var n=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" <% if (item.value === "customoptions") { %> class="border-top" style="margin-top: 5px;padding-top: 5px;" <% } %> ><a tabindex="-1" type="menuitem">',"<%= scope.getDisplayValue(item) %>","</a></li>","<% }); %>"].join(""));this.cmbLayout=new Common.UI.ComboBox({el:i.findById("#print-combo-layout"),menuStyle:"min-width: 248px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:0,displayValue:this.txtActualSize},{value:1,displayValue:this.txtFitPage},{value:2,displayValue:this.txtFitCols},{value:3,displayValue:this.txtFitRows},{value:"customoptions",displayValue:this.txtCustomOptions}],itemsTemplate:n,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.txtRangeTop=new Common.UI.InputField({el:i.findById("#print-txt-top"),allowBlank:!0,validateOnChange:!0,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.btnPresetsTop=new Common.UI.Button({parentEl:i.findById("#print-presets-top"),cls:"btn-text-menu-default",caption:this.txtRepeat,style:"width: 77px;",menu:!0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.txtRangeLeft=new Common.UI.InputField({el:i.findById("#print-txt-left"),allowBlank:!0,validateOnChange:!0,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.btnPresetsLeft=new Common.UI.Button({parentEl:i.findById("#print-presets-left"),cls:"btn-text-menu-default",caption:this.txtRepeat,style:"width: 77px;",menu:!0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spnMarginTop=new Common.UI.MetricSpinner({el:i.findById("#print-spin-margin-top"),step:.1,width:120,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:i.findById("#print-spin-margin-bottom"),step:.1,width:120,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:i.findById("#print-spin-margin-left"),step:.1,width:120,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:i.findById("#print-spin-margin-right"),step:.1,width:120,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"big"}),this.spinners.push(this.spnMarginRight),this.chPrintGrid=new Common.UI.CheckBox({el:i.findById("#print-chb-grid"),labelText:this.txtPrintGrid,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.chPrintRows=new Common.UI.CheckBox({el:i.findById("#print-chb-rows"),labelText:this.txtPrintHeadings,dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.pnlSettings=i.find(".flex-settings").addBack().filter(".flex-settings"),this.pnlApply=i.find(".fms-flex-apply").addBack().filter(".fms-flex-apply"),this.pnlTable=$(this.pnlSettings.find("table")[0]),this.trApply=i.find(".fms-btn-apply"),this.btnsSave=[],this.btnsPrint=[];for(var o=0;o<2;o++)this.btnsSave.push(new Common.UI.Button({el:i.findById("#print-btn-save-"+o)})),this.btnsPrint.push(new Common.UI.Button({el:i.findById("#print-btn-print-"+o)}));return this.btnPrevPage=new Common.UI.Button({parentEl:i.findById("#print-prev-page"),cls:"btn-prev-page",iconCls:"arrow",dataHint:"2",dataHintDirection:"top"}),this.btnNextPage=new Common.UI.Button({parentEl:i.findById("#print-next-page"),cls:"btn-next-page",iconCls:"arrow",dataHint:"2",dataHintDirection:"top"}),this.countOfPages=i.findById("#print-count-page"),this.txtNumberPage=new Common.UI.InputField({el:i.findById("#print-number-page"),allowBlank:!0,validateOnChange:!0,style:"width: 50px;",maskExp:/[0-9]/,validation:function(t){return!!(/(^[0-9]+$)/.test(t)&&void 0!==(t=parseInt(t))&&t>0&&t<=e.pageCount)||e.txtPageNumInvalid},dataHint:"2",dataHintDirection:"left",dataHintOffset:"small"}),this.txtActiveSheet=i.findById("#print-active-sheet"),this.$el=$(t).html(i),this.mode.isEdit?this.$el.on("click","#print-header-footer-settings",_.bind(this.openHeaderSettings,this)):i.find(".header-settings").hide(),this.$previewBox=$("#print-preview-box"),this.$previewEmpty=$("#print-preview-empty"),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.pnlSettings,suppressScrollX:!0,alwaysVisibleY:!0})),Common.NotificationCenter.on({"window:resize":function(){e.isVisible()&&e.updateScroller()}}),this.updateMetricUnit(),this.fireEvent("render:after",this),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this._initSettings&&(this.updateMetricUnit(),this._initSettings=!1),this.updateScroller(),this.fireEvent("show",this)},updateScroller:function(){if(this.scroller){Common.UI.Menu.Manager.hideAll();var t=this.$el.height()<this.pnlTable.height()+25+this.pnlApply.height();this.pnlApply.toggleClass("hidden",!t),this.trApply.toggleClass("hidden",t),this.pnlSettings.css("overflow",t?"hidden":"visible"),this.scroller.update(),this.pnlSettings.toggleClass("bordered",this.scroller.isVisible())}},setMode:function(t){this.mode=t},setApi:function(t){},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}var i=this.cmbPaperSize.store;for(t=0;t<i.length;t++){var n=i.at(t),o=n.get("value"),s=/^\d{3}\.?\d*/.exec(o),a=/\d{3}\.?\d*$/.exec(o);n.set("displayValue",n.get("caption")+" ("+parseFloat(Common.Utils.Metric.fnRecalcFromMM(s).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+" x "+parseFloat(Common.Utils.Metric.fnRecalcFromMM(a).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+")")}this.cmbPaperSize.onResetItems()},addCustomScale:function(t){t?this.cmbLayout.setData([{value:0,displayValue:this.txtActualSize},{value:1,displayValue:this.txtFitPage},{value:2,displayValue:this.txtFitCols},{value:3,displayValue:this.txtFitRows},{value:4,displayValue:this.txtCustom},{value:"customoptions",displayValue:this.txtCustomOptions}]):this.cmbLayout.setData([{value:0,displayValue:this.txtActualSize},{value:1,displayValue:this.txtFitPage},{value:2,displayValue:this.txtFitCols},{value:3,displayValue:this.txtFitRows},{value:"customoptions",displayValue:this.txtCustomOptions}])},applySettings:function(){this.menu&&this.menu.fireEvent("settings:apply",[this.menu])},isVisible:function(){return(this.$el||$(this.el)).is(":visible")},setRange:function(t){this.cmbRange.setValue(t)},getRange:function(){return this.cmbRange.getValue()},setIgnorePrintArea:function(t){this.chIgnorePrintArea.setValue(t)},getIgnorePrintArea:function(){return"checked"==this.chIgnorePrintArea.getValue()},comboRangeChange:function(t,e){this.fireEvent("changerange",this)},openHeaderSettings:function(){this.fireEvent("openheader",this)},updateCountOfPages:function(t){this.countOfPages.text(Common.Utils.String.format(this.txtOf,t)),this.pageCount=t},updateActiveSheet:function(t){this.txtActiveSheet.text(Common.Utils.String.format(this.txtSheet,t))},updateCurrentPage:function(t){this.txtNumberPage.setValue(t+1)},txtPrint:"Print",txtSave:"Save",txtPrintRange:"Print range",txtCurrentSheet:"Current sheet",txtAllSheets:"All sheets",txtSelection:"Selection",txtSettingsOfSheet:"Settings of sheet",txtPageSize:"Page size",txtPageOrientation:"Page orientation",txtPortrait:"Portrait",txtLandscape:"Landscape",txtScaling:"Scaling",txtActualSize:"Actual Size",txtFitPage:"Fit Sheet on One Page",txtFitCols:"Fit All Columns on One Page",txtFitRows:"Fit All Rows on One Pag",txtCustom:"Custom",txtCustomOptions:"Custom Options",txtPrintTitles:"Print titles",txtRepeatRowsAtTop:"Repeat rows at top",txtRepeatColumnsAtLeft:"Repeat columns at left",txtRepeat:"Repeat...",txtMargins:"Margins",txtTop:"Top",txtBottom:"Bottom",txtLeft:"Left",txtRight:"Right",txtGridlinesAndHeadings:"Gridlines and headings",txtPrintGrid:"Print gridlines",txtPrintHeadings:"Print row and columns headings",txtHeaderFooterSettings:"Header/footer settings",txtApplyToAllSheets:"Apply to all sheets",txtIgnore:"Ignore print area",txtPage:"Page",txtOf:"of {0}",txtSheet:"Sheet: {0}",txtPageNumInvalid:"Page number invalid",txtEmptyTable:"There is nothing to print because the table is empty"},SSE.Views.PrintWithPreview||{}))})),define("text!spreadsheeteditor/main/app/template/PrintSettings.template",[],(function(){return'<div class="settings-panel active">\r\n    <div class="padding-large inner-content" >\r\n        <div id="printadv-dlg-combo-range" class="input-group-nr"></div>\r\n        <div id="printadv-dlg-chb-ignore" style="margin-top: 5px;"></div>\r\n    </div>\r\n    <div class="padding-small"></div>\r\n    <div class="padding-large inner-content" >\r\n        <div id="printadv-dlg-combo-sheets" class="input-group-nr"></div>\r\n    </div>\r\n    <div class="padding-large inner-content" >\r\n        <div id="printadv-dlg-combo-pages" class="input-group-nr"></div>\r\n    </div>\r\n    <div class="padding-large inner-content" >\r\n        <span id="printadv-dlg-combo-orient"></span>\r\n    </div>\r\n    <div class="padding-large inner-content" >\r\n        <span id="printadv-dlg-combo-layout"></span>\r\n    </div>\r\n    <div id="printadv-dlg-content-to-hide">\r\n        <div class="padding-large inner-content" >\r\n            <table cols="2" class="no-padding">\r\n                <tr>\r\n                    <td colspan="2" ><label><%= scope.textRepeatTop %></label></td>\r\n                </tr>\r\n                <tr>\r\n                    <td class="padding-small"><div id="printadv-dlg-txt-top" style="margin-right: 10px;"></div></td>\r\n                    <td class="padding-small"><div id="printadv-dlg-presets-top"></div></td>\r\n                </tr>\r\n                <tr>\r\n                    <td colspan="2" ><label><%= scope.textRepeatLeft %></label></td>\r\n                </tr>\r\n                <tr>\r\n                    <td><div id="printadv-dlg-txt-left" style="margin-right: 10px;"></div></td>\r\n                    <td><div id="printadv-dlg-presets-left"></div></td>\r\n                </tr>\r\n            </table>\r\n        </div>\r\n        <div class="padding-large inner-content" >\r\n            <table cols="2" class="no-padding">\r\n            <tr>\r\n                <td><label><%= scope.strTop %></label></td>\r\n                <td><label><%= scope.strBottom %></label></td>\r\n                </tr>\r\n            <tr>\r\n                <td class="padding-small"><div id="printadv-dlg-spin-margin-top" style="margin-right: 19px;"></div></td>\r\n                <td class="padding-small"><div id="printadv-dlg-spin-margin-bottom"></div></td>\r\n            </tr>\r\n            <tr>\r\n                <td><label><%= scope.strLeft %></label></td>\r\n                <td><label><%= scope.strRight %></label></td>\r\n                </tr>\r\n            <tr>\r\n                <td><div id="printadv-dlg-spin-margin-left" style="margin-right: 15px;"></div></td>\r\n                <td><div id="printadv-dlg-spin-margin-right"></div></td>\r\n                </tr>\r\n            </table>\r\n        </div>\r\n        <div class="padding-small"></div>\r\n        <div class="inner-content">\r\n            <div id="printadv-dlg-chb-grid" style="margin-bottom: 10px;"></div>\r\n            <div id="printadv-dlg-chb-rows"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'})),define("spreadsheeteditor/main/app/view/PrintSettings",["text!spreadsheeteditor/main/app/template/PrintSettings.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/component/ListView"],(function(t){"use strict";SSE.Views.PrintSettings=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"PrintSettings",contentWidth:280,height:575,buttons:null},initialize:function(e){this.type=e.type||"print",_.extend(this.options,{title:"print"==this.type?this.textTitle:this.textTitlePDF,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="menu-panel" style="overflow: hidden;">','<div style="height: 54px; line-height: 42px;" class="div-category">'+("print"==this.type?this.textPrintRange:this.textRange)+"</div>",'<div style="height: 52px; line-height: 66px;" class="div-category">'+this.textSettings+"</div>",'<div style="height: 38px; line-height: 38px;" class="div-category">'+this.textPageSize+"</div>",'<div style="height: 38px; line-height: 38px;" class="div-category">'+this.textPageOrientation+"</div>",'<div style="height: 38px; line-height: 38px;" class="div-category">'+this.textPageScaling+"</div>",'<div style="height: 98px; line-height: 33px;" class="div-category">'+this.strPrintTitles+"</div>",'<div style="height: 108px; line-height: 33px;" class="div-category">'+this.strMargins+"</div>",'<div style="height: 58px; line-height: 40px;" class="div-category">'+("print"==this.type?this.strPrint:this.strShow)+"</div>","</div>",'<div class="content-panel">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer justify">','<button id="printadv-dlg-btn-hide" class="btn btn-text-default" style="min-width: 100px;width: auto;">'+this.textHideDetails+"</button>",'<button class="btn normal dlg-btn" result="cancel" style="width: 86px;float: right;">'+this.cancelButtonText+"</button>",'<button class="btn normal dlg-btn primary" result="ok" style="margin-left: 10px;  width: 150px;float: right;">'+("print"==this.type?this.btnPrint:this.btnDownload)+"</button>","</div>"].join("")},e),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.spinners=[]},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this),this.cmbRange=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-range"),style:"width: 132px;",menuStyle:"min-width: 132px;max-height: 280px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:Asc.c_oAscPrintType.ActiveSheets,displayValue:this.textCurrentSheet},{value:Asc.c_oAscPrintType.EntireWorkbook,displayValue:this.textAllSheets},{value:Asc.c_oAscPrintType.Selection,displayValue:this.textSelection}]}),this.cmbRange.on("selected",_.bind(this.comboRangeChange,this)),this.chIgnorePrintArea=new Common.UI.CheckBox({el:$("#printadv-dlg-chb-ignore"),labelText:this.textIgnore}),this.cmbSheet=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-sheets"),style:"width: 242px;",menuStyle:"min-width: 242px;max-height: 280px;",editable:!1,cls:"input-group-nr",data:[],takeFocusOnClose:!0}),this.cmbPaperSize=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-pages"),style:"width: 242px;",menuStyle:"max-height: 280px; min-width: 242px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:"215.9|279.4",displayValue:"US Letter (21,59cm x 27,94cm)",caption:"US Letter"},{value:"215.9|355.6",displayValue:"US Legal (21,59cm x 35,56cm)",caption:"US Legal"},{value:"210|297",displayValue:"A4 (21cm x 29,7cm)",caption:"A4"},{value:"148|210",displayValue:"A5 (14,8cm x 21cm)",caption:"A5"},{value:"176|250",displayValue:"B5 (17,6cm x 25cm)",caption:"B5"},{value:"104.8|241.3",displayValue:"Envelope #10 (10,48cm x 24,13cm)",caption:"Envelope #10"},{value:"110|220",displayValue:"Envelope DL (11cm x 22cm)",caption:"Envelope DL"},{value:"279.4|431.8",displayValue:"Tabloid (27,94cm x 43,18cm)",caption:"Tabloid"},{value:"297|420",displayValue:"A3 (29,7cm x 42cm)",caption:"A3"},{value:"304.8|457.1",displayValue:"Tabloid Oversize (30,48cm x 45,71cm)",caption:"Tabloid Oversize"},{value:"196.8|273",displayValue:"ROC 16K (19,68cm x 27,3cm)",caption:"ROC 16K"},{value:"119.9|234.9",displayValue:"Envelope Choukei 3 (11,99cm x 23,49cm)",caption:"Envelope Choukei 3"},{value:"330.2|482.5",displayValue:"Super B/A3 (33,02cm x 48,25cm)",caption:"Super B/A3"}]}),this.cmbPaperOrientation=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-orient"),style:"width: 132px;",menuStyle:"min-width: 132px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:Asc.c_oAscPageOrientation.PagePortrait,displayValue:this.strPortrait},{value:Asc.c_oAscPageOrientation.PageLandscape,displayValue:this.strLandscape}]}),this.chPrintGrid=new Common.UI.CheckBox({el:$("#printadv-dlg-chb-grid"),labelText:"print"==this.type?this.textPrintGrid:this.textShowGrid}),this.chPrintRows=new Common.UI.CheckBox({el:$("#printadv-dlg-chb-rows"),labelText:"print"==this.type?this.textPrintHeadings:this.textShowHeadings}),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-top"),step:.1,width:110,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-bottom"),step:.1,width:110,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-left"),step:.1,width:110,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-right"),step:.1,width:110,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginRight);var t=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" <% if (item.value === "customoptions") { %> class="border-top" style="margin-top: 5px;" <% } %> ><a tabindex="-1" type="menuitem">',"<%= scope.getDisplayValue(item) %>","</a></li>","<% }); %>"].join(""));this.cmbLayout=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-layout"),style:"width: 242px;",menuStyle:"min-width: 242px;",editable:!1,takeFocusOnClose:!0,cls:"input-group-nr",data:[{value:0,displayValue:this.textActualSize},{value:1,displayValue:this.textFitPage},{value:2,displayValue:this.textFitCols},{value:3,displayValue:this.textFitRows},{value:"customoptions",displayValue:this.textCustomOptions}],itemsTemplate:t}),this.txtRangeTop=new Common.UI.InputFieldBtn({el:$("#printadv-dlg-txt-top"),style:"width: 147px;",allowBlank:!0,validateOnChange:!0}),this.btnPresetsTop=new Common.UI.Button({parentEl:$("#printadv-dlg-presets-top"),cls:"btn-text-menu-default",caption:this.textRepeat,style:"width: 85px;",menu:!0}),this.txtRangeLeft=new Common.UI.InputFieldBtn({el:$("#printadv-dlg-txt-left"),style:"width: 147px;",allowBlank:!0,validateOnChange:!0}),this.btnPresetsLeft=new Common.UI.Button({parentEl:$("#printadv-dlg-presets-left"),cls:"btn-text-menu-default",caption:this.textRepeat,style:"width: 85px;",menu:!0}),this.btnHide=new Common.UI.Button({el:$("#printadv-dlg-btn-hide")}),this.btnHide.on("click",_.bind(this.handlerShowDetails,this)),this.panelDetails=$("#printadv-dlg-content-to-hide"),this.updateMetricUnit(),this.options.afterrender&&this.options.afterrender.call(this);var e=Common.localStorage.getItem("sse-hide-print-settings");this.extended=null!==e&&0==parseInt(e),this.handlerShowDetails(this.btnHide)},getFocusedComponents:function(){return[this.cmbRange,this.chIgnorePrintArea,this.cmbSheet,this.cmbPaperSize,this.cmbPaperOrientation,this.cmbLayout,this.txtRangeTop,this.txtRangeLeft,this.spnMarginTop,this.spnMarginBottom,this.spnMarginLeft,this.spnMarginRight,this.chPrintGrid,this.chPrintRows]},getDefaultFocusableComponent:function(){if(!this._alreadyRendered)return this._alreadyRendered=!0,this.cmbRange},addCustomScale:function(t){t?this.cmbLayout.setData([{value:0,displayValue:this.textActualSize},{value:1,displayValue:this.textFitPage},{value:2,displayValue:this.textFitCols},{value:3,displayValue:this.textFitRows},{value:4,displayValue:this.textCustom},{value:"customoptions",displayValue:this.textCustomOptions}]):this.cmbLayout.setData([{value:0,displayValue:this.textActualSize},{value:1,displayValue:this.textFitPage},{value:2,displayValue:this.textFitCols},{value:3,displayValue:this.textFitRows},{value:"customoptions",displayValue:this.textCustomOptions}])},setRange:function(t){this.cmbRange.setValue(t)},getRange:function(){return this.cmbRange.getValue()},setIgnorePrintArea:function(t){this.chIgnorePrintArea.setValue(t)},getIgnorePrintArea:function(){return"checked"==this.chIgnorePrintArea.getValue()},comboRangeChange:function(t,e){this.fireEvent("changerange",this)},updateMetricUnit:function(){if(this.spinners)for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}var i=this.cmbPaperSize.store;for(t=0;t<i.length;t++){var n=i.at(t),o=n.get("value"),s=/^\d{3}\.?\d*/.exec(o),a=/\d{3}\.?\d*$/.exec(o);n.set("displayValue",n.get("caption")+" ("+parseFloat(Common.Utils.Metric.fnRecalcFromMM(s).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+" x "+parseFloat(Common.Utils.Metric.fnRecalcFromMM(a).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+")")}this.cmbPaperSize.onResetItems()},handlerShowDetails:function(t){this.extended?(this.extended=!1,this.panelDetails.css({display:"block"}),this.setHeight(585),t.setCaption(this.textHideDetails),Common.localStorage.setItem("sse-hide-print-settings",0)):(this.extended=!0,this.panelDetails.css({display:"none"}),this.setHeight(314),t.setCaption(this.textShowDetails),Common.localStorage.setItem("sse-hide-print-settings",1))},textTitle:"Print Settings",strLeft:"Left",strRight:"Right",strTop:"Top",strBottom:"Bottom",strPortrait:"Portrait",strLandscape:"Landscape",textPrintGrid:"Print Gridlines",textPrintHeadings:"Print Rows and Columns Headings",textPageSize:"Page Size",textPageOrientation:"Page Orientation",strMargins:"Margins",strPrint:"Print",btnPrint:"Save & Print",textPrintRange:"Print Range",textLayout:"Layout",textCurrentSheet:"Current Sheet",textAllSheets:"All Sheets",textSelection:"Selection",textActualSize:"Actual Size",textFitPage:"Fit Sheet on One Page",textFitCols:"Fit All Columns on One Page",textFitRows:"Fit All Rows on One Page",textShowDetails:"Show Details",textHideDetails:"Hide Details",textPageScaling:"Scaling",textSettings:"Sheet Settings",textTitlePDF:"PDF Settings",textShowGrid:"Show Gridlines",textShowHeadings:"Show Rows and Columns Headings",strShow:"Show",btnDownload:"Save & Download",textRange:"Range",textIgnore:"Ignore Print Area",textCustomOptions:"Custom Options",textCustom:"Custom",strPrintTitles:"Print Titles",textRepeatTop:"Repeat rows at top",textRepeatLeft:"Repeat columns at left",textRepeat:"Repeat..."},SSE.Views.PrintSettings||{}))})),define("spreadsheeteditor/main/app/controller/Print",["core","spreadsheeteditor/main/app/view/FileMenuPanels","spreadsheeteditor/main/app/view/PrintSettings"],(function(){"use strict";SSE.Controllers.Print=Backbone.Controller.extend(_.extend({views:["MainSettingsPrint","PrintWithPreview"],initialize:function(){var t=Common.localStorage.getItem("sse-print-settings-range");t=null!==t?parseInt(t):Asc.c_oAscPrintType.ActiveSheets,this._currentPrintType=t,this.adjPrintParams=new Asc.asc_CAdjustPrint,this.adjPrintParams.asc_setPrintType(t),this._changedProps=null,this._originalPageSettings=null,this._navigationPreview={pageCount:!1,currentPage:0},this._isPreviewVisible=!1,this.addListeners({PrintWithPreview:{show:_.bind(this.onShowMainSettingsPrint,this),"render:after":_.bind(this.onAfterRender,this),changerange:_.bind(this.onChangeRange,this,!1),openheader:_.bind(this.onOpenHeaderSettings,this)},PrintSettings:{changerange:_.bind(this.onChangeRange,this,!0)}}),Common.NotificationCenter.on("print",_.bind(this.openPrintSettings,this,"print")),Common.NotificationCenter.on("download:settings",_.bind(this.openPrintSettings,this,"download"))},onLaunch:function(){this.printSettings=this.createView("PrintWithPreview")},onAfterRender:function(t){var e=this;this.printSettings.menu.on("menu:hide",_.bind(this.onHidePrintMenu,this)),this.printSettings.cmbSheet.on("selected",_.bind((function(t,e){this.comboSheetsChange(this.printSettings,t,e),this._isPreviewVisible&&(this.notUpdateSheetSettings=!0,this.api.asc_drawPrintPreview(void 0,e.value))}),this)),this.printSettings.btnsSave.forEach((function(t){t.on("click",_.bind(e.querySavePrintSettings,e,!1))})),this.printSettings.btnsPrint.forEach((function(t){t.on("click",_.bind(e.querySavePrintSettings,e,!0))})),this.printSettings.btnPrevPage.on("click",_.bind(this.onChangePreviewPage,this,!1)),this.printSettings.btnNextPage.on("click",_.bind(this.onChangePreviewPage,this,!0)),this.printSettings.txtNumberPage.on({"keypress:after":_.bind(this.onKeypressPageNumber,this),"keyup:after":_.bind(this.onKeyupPageNumber,this)}),this.printSettings.txtNumberPage.cmpEl.find("input").on("blur",_.bind(this.onBlurPageNumber,this)),this.printSettings.chIgnorePrintArea.on("change",_.bind(this.updatePreview,this,!0)),this.fillComponents(this.printSettings),this.registerControlEvents(this.printSettings),Common.NotificationCenter.on("window:resize",_.bind((function(){this._isPreviewVisible&&(this.notUpdateSheetSettings=!0,this.api.asc_drawPrintPreview(this._navigationPreview.currentPage))}),this));var i=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this.printSettings.$previewBox.on(i,_.bind(this.onPreviewWheel,this))},setMode:function(t){this.mode=t,this.printSettings&&this.printSettings.setMode(t)},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.updateSheetsInfo,this)),this.api.asc_registerCallback("asc_onPrintPreviewSheetChanged",_.bind(this.onApiChangePreviewSheet,this)),this.api.asc_registerCallback("asc_onPrintPreviewPageChanged",_.bind(this.onApiChangePreviewPage,this)),this.api.asc_registerCallback("asc_onPrintPreviewSheetDataChanged",_.bind(this.onApiPreviewSheetDataChanged,this)),this},updateSheetsInfo:function(){this.printSettings.isVisible()?(this.updateSettings(this.printSettings),this.printSettings.cmbSheet.store.each((function(t){var e=t.get("value");this._changedProps[e]||(this._changedProps[e]=this.api.asc_getPageOptions(e,!0,!0))}),this)):this.isFillSheets=!1},updateSettings:function(t){for(var e=this.api.asc_getWorksheetsCount(),i=-1,n=[];++i<e;)this.api.asc_isWorksheetHidden(i)||n.push({displayValue:this.api.asc_getWorksheetName(i),value:i});t.cmbSheet.store.reset(n);var o=t.cmbSheet.store.findWhere({value:t.cmbSheet.getValue()})||t.cmbSheet.store.findWhere({value:this.api.asc_getActiveWorksheetIndex()});o&&(t.cmbSheet.setValue(o.get("value")),t.updateActiveSheet&&t.updateActiveSheet(o.get("displayValue")))},comboSheetsChange:function(t,e,i){var n=i.value;this.fillPageOptions(t,this._changedProps[n]?this._changedProps[n]:this.api.asc_getPageOptions(n,!0),n)},fillPageOptions:function(t,e,i){var n=e.asc_getPageSetup();this._originalPageSettings=n;var o=t.cmbPaperOrientation.store.findWhere({value:n.asc_getOrientation()});o&&t.cmbPaperOrientation.setValue(o.get("value"));var s=n.asc_getWidth(),a=n.asc_getHeight(),l=t.cmbPaperSize.store;o=null;for(var r=0;r<l.length;r++){var c=l.at(r),d=c.get("value"),h=parseFloat(/^\d{3}\.?\d*/.exec(d)),p=parseFloat(/\d{3}\.?\d*$/.exec(d));if(Math.abs(h-s)<.1&&Math.abs(p-a)<.1){o=c;break}}o?t.cmbPaperSize.setValue(o.get("value")):t.cmbPaperSize.setValue(this.txtCustom+" ("+parseFloat(Common.Utils.Metric.fnRecalcFromMM(s).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+" x "+parseFloat(Common.Utils.Metric.fnRecalcFromMM(a).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+")"),this.fitWidth=n.asc_getFitToWidth(),this.fitHeight=n.asc_getFitToHeight(),this.fitScale=n.asc_getScale(),this.setScaling(t,this.fitWidth,this.fitHeight,this.fitScale),(o=t.cmbPaperOrientation.store.findWhere({value:n.asc_getOrientation()}))&&t.cmbPaperOrientation.setValue(o.get("value")),n=e.asc_getPageMargins(),t.spnMarginLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getLeft()),!0),t.spnMarginTop.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getTop()),!0),t.spnMarginRight.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getRight()),!0),t.spnMarginBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getBottom()),!0),t.chPrintGrid.setValue(e.asc_getGridLines(),!0),t.chPrintRows.setValue(e.asc_getHeadings(),!0);d=e.asc_getPrintTitlesHeight();t.txtRangeTop.setValue(d||""),this._noApply=!0,t.txtRangeTop.checkValidate(),this._noApply=!1,t.dataRangeTop=d,d=e.asc_getPrintTitlesWidth(),t.txtRangeLeft.setValue(d||""),this._noApply=!0,t.txtRangeLeft.checkValidate(),this._noApply=!1,t.dataRangeLeft=d,d=this.api.asc_getActiveWorksheetIndex()==i,"select"==t.btnPresetsTop.menu.items[0].value&&(t.btnPresetsTop.menu.items[0].setVisible(d),t.txtRangeTop.setBtnDisabled&&t.txtRangeTop.setBtnDisabled(!d)),"select"==t.btnPresetsLeft.menu.items[0].value&&(t.btnPresetsLeft.menu.items[0].setVisible(d),t.txtRangeLeft.setBtnDisabled&&t.txtRangeLeft.setBtnDisabled(!d)),t.btnPresetsTop.menu.items["frozen"==t.btnPresetsTop.menu.items[0].value?0:1].setDisabled(!this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,!1,i)),t.btnPresetsLeft.menu.items["frozen"==t.btnPresetsLeft.menu.items[0].value?0:1].setDisabled(!this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,!0,i))},fillPrintOptions:function(t,e){var i=e?this.printSettingsDlg:this.printSettings;i.setRange(t.asc_getPrintType()),i.setIgnorePrintArea(!!t.asc_getIgnorePrintArea()),this.onChangeRange(e)},onChangeRange:function(t){var e=t?this.printSettingsDlg:this.printSettings,i=e.getRange(),n=e.cmbSheet.store,o=i!==Asc.c_oAscPrintType.EntireWorkbook?n.findWhere({value:this.api.asc_getActiveWorksheetIndex()}):n.at(0);o&&(e.cmbSheet.setValue(o.get("value")),this.comboSheetsChange(e,e.cmbSheet,o.toJSON())),e.cmbSheet.setDisabled(i!==Asc.c_oAscPrintType.EntireWorkbook),e.chIgnorePrintArea.setDisabled(i==Asc.c_oAscPrintType.Selection),t||this.updatePreview(!0)},getPageOptions:function(t,e){var i=this._changedProps[e]?this._changedProps[e]:new Asc.asc_CPageOptions;i.asc_setGridLines("checked"===t.chPrintGrid.getValue()),i.asc_setHeadings("checked"===t.chPrintRows.getValue());var n=this._changedProps[e]?this._changedProps[e].asc_getPageSetup():new Asc.asc_CPageSetup;n.asc_setOrientation("-"==t.cmbPaperOrientation.getValue()?void 0:t.cmbPaperOrientation.getValue());var o=/^\d{3}\.?\d*/.exec(t.cmbPaperSize.getValue()),s=/\d{3}\.?\d*$/.exec(t.cmbPaperSize.getValue());n.asc_setWidth(o?parseFloat(o[0]):this._originalPageSettings?this._originalPageSettings.asc_getWidth():void 0),n.asc_setHeight(s?parseFloat(s[0]):this._originalPageSettings?this._originalPageSettings.asc_getHeight():void 0);var a=t.cmbLayout.getValue();if(4!==a){var l=1==a||2==a?1:0,r=1==a||3==a?1:0;n.asc_setFitToWidth(l),n.asc_setFitToHeight(r),!l&&!r&&n.asc_setScale(100),this.setScaling(t,l,r,100)}else n.asc_setFitToWidth(this.fitWidth),n.asc_setFitToHeight(this.fitHeight),n.asc_setScale(this.fitScale);this._changedProps[e]||i.asc_setPageSetup(n),(n=this._changedProps[e]?this._changedProps[e].asc_getPageMargins():new Asc.asc_CPageMargins).asc_setLeft("-"==t.spnMarginLeft.getValue()?void 0:Common.Utils.Metric.fnRecalcToMM(t.spnMarginLeft.getNumberValue())),n.asc_setTop("-"==t.spnMarginTop.getValue()?void 0:Common.Utils.Metric.fnRecalcToMM(t.spnMarginTop.getNumberValue())),n.asc_setRight("-"==t.spnMarginRight.getValue()?void 0:Common.Utils.Metric.fnRecalcToMM(t.spnMarginRight.getNumberValue())),n.asc_setBottom("-"==t.spnMarginBottom.getValue()?void 0:Common.Utils.Metric.fnRecalcToMM(t.spnMarginBottom.getNumberValue())),this._changedProps[e]||i.asc_setPageMargins(n);var c=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t.txtRangeTop.getValue(),!1)!==Asc.c_oAscError.ID.DataRangeError;return i.asc_setPrintTitlesHeight(c?t.txtRangeTop.getValue():t.dataRangeTop),c=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t.txtRangeLeft.getValue(),!1)!==Asc.c_oAscError.ID.DataRangeError,i.asc_setPrintTitlesWidth(c?t.txtRangeLeft.getValue():t.dataRangeLeft),i},savePageOptions:function(t){this.api.asc_savePagePrintOptions(this._changedProps),Common.NotificationCenter.trigger("page:settings")},onShowMainSettingsPrint:function(){var t=this;this._changedProps=[],this.printSettings.$previewBox.removeClass("hidden"),this.isFillSheets||(this.isFillSheets=!0,this.updateSettings(this.printSettings)),this.printSettings.cmbSheet.store.each((function(e){var i=e.get("value");t._changedProps[i]=t.api.asc_getPageOptions(i,!0,!0)}),this),this.adjPrintParams.asc_setPageOptionsMap(this._changedProps),this.fillPrintOptions(this.adjPrintParams,!1);var e=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86);e.asc_setAdvancedOptions(this.adjPrintParams);var i=this.api.asc_initPrintPreview("print-preview",e);this.printSettings.$previewBox.toggleClass("hidden",!i),this.printSettings.$previewEmpty.toggleClass("hidden",!!i),i&&(this.updateNavigationButtons(0,i),this.printSettings.txtNumberPage.checkValidate()),this._isPreviewVisible=!0,i&&this.updatePreview()},openPrintSettings:function(t,e,i,n){this.printSettingsDlg&&this.printSettingsDlg.isVisible()?n&&Common.NotificationCenter.trigger("download:cancel"):this.api&&(Common.UI.Menu.Manager.hideAll(),this.asUrl=n,this.downloadFormat=i,this.printSettingsDlg=new SSE.Views.PrintSettings({type:t,handler:_.bind(this.resultPrintSettings,this),afterrender:_.bind((function(){this._changedProps=[],this.updateSettings(this.printSettingsDlg),this.printSettingsDlg.cmbSheet.on("selected",_.bind(this.comboSheetsChange,this,this.printSettingsDlg)),this.fillComponents(this.printSettingsDlg,!0),this.fillPrintOptions(this.adjPrintParams,!0),this.registerControlEvents(this.printSettingsDlg)}),this)}),this.printSettingsDlg.show())},resultPrintSettings:function(t,e){var i=SSE.getController("Toolbar").getView("Toolbar");if("ok"==t){if(!this.checkMargins(this.printSettingsDlg))return!0;this.savePageOptions(this.printSettingsDlg);var n,o=this.printSettingsDlg.getRange();this.adjPrintParams.asc_setPrintType(o),this.adjPrintParams.asc_setPageOptionsMap(this._changedProps),this.adjPrintParams.asc_setIgnorePrintArea(this.printSettingsDlg.getIgnorePrintArea()),Common.localStorage.setItem("sse-print-settings-range",o),"print"==this.printSettingsDlg.type?((n=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86)).asc_setAdvancedOptions(this.adjPrintParams),this.api.asc_Print(n)):((n=new Asc.asc_CDownloadOptions(this.downloadFormat,this.asUrl)).asc_setAdvancedOptions(this.adjPrintParams),this.api.asc_DownloadAs(n)),Common.component.Analytics.trackEvent("print"==this.printSettingsDlg.type?"Print":"DownloadAs"),Common.component.Analytics.trackEvent("ToolBar","print"==this.printSettingsDlg.type?"Print":"DownloadAs"),Common.NotificationCenter.trigger("edit:complete",i)}else this.asUrl&&Common.NotificationCenter.trigger("download:cancel"),Common.NotificationCenter.trigger("edit:complete",i);this.printSettingsDlg=null},querySavePrintSettings:function(t){if(this.checkMargins(this.printSettings)&&(this.savePageOptions(this.printSettings),this._isPrint=t,this.printSettings.applySettings(),t)){var e=this.printSettings.getRange();this.adjPrintParams.asc_setPrintType(e),this.adjPrintParams.asc_setPageOptionsMap(this._changedProps),this.adjPrintParams.asc_setIgnorePrintArea(this.printSettings.getIgnorePrintArea()),Common.localStorage.setItem("sse-print-settings-range",e);var i=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86);i.asc_setAdvancedOptions(this.adjPrintParams),this.api.asc_Print(i),Common.NotificationCenter.trigger("edit:complete",view),this._isPrint=!1}},checkMargins:function(t){if(t.cmbPaperOrientation.getValue()==Asc.c_oAscPageOrientation.PagePortrait)var e=/^\d{3}\.?\d*/.exec(t.cmbPaperSize.getValue()),i=/\d{3}\.?\d*$/.exec(t.cmbPaperSize.getValue());else i=/^\d{3}\.?\d*/.exec(t.cmbPaperSize.getValue()),e=/\d{3}\.?\d*$/.exec(t.cmbPaperSize.getValue());e=e?parseFloat(e[0]):this._originalPageSettings?this._originalPageSettings.asc_getWidth():0,i=i?parseFloat(i[0]):this._originalPageSettings?this._originalPageSettings.asc_getHeight():0;var n=Common.Utils.Metric.fnRecalcToMM(t.spnMarginLeft.getNumberValue()),o=Common.Utils.Metric.fnRecalcToMM(t.spnMarginRight.getNumberValue()),s=Common.Utils.Metric.fnRecalcToMM(t.spnMarginTop.getNumberValue()),a=Common.Utils.Metric.fnRecalcToMM(t.spnMarginBottom.getNumberValue()),l=!1;return n>e?l="left":o>e-n?l="right":s>i?l="top":a>i-s&&(l="bottom"),!l||(Common.UI.warning({title:this.textWarning,msg:this.warnCheckMargings,callback:function(e,i){switch(l){case"left":return void t.spnMarginLeft.$el.focus();case"right":return void t.spnMarginRight.$el.focus();case"top":return void t.spnMarginTop.$el.focus();case"bottom":return void t.spnMarginBottom.$el.focus()}}}),!1)},registerControlEvents:function(t){t.cmbPaperSize.on("selected",_.bind(this.propertyChange,this,t)),t.cmbPaperOrientation.on("selected",_.bind(this.propertyChange,this,t)),t.cmbLayout.on("selected",_.bind(this.propertyChange,this,t,"scale")),t.spnMarginTop.on("change",_.bind(this.propertyChange,this,t)),t.spnMarginBottom.on("change",_.bind(this.propertyChange,this,t)),t.spnMarginLeft.on("change",_.bind(this.propertyChange,this,t)),t.spnMarginRight.on("change",_.bind(this.propertyChange,this,t)),t.chPrintGrid.on("change",_.bind(this.propertyChange,this,t)),t.chPrintRows.on("change",_.bind(this.propertyChange,this,t)),t.txtRangeTop.on("changed:after",_.bind(this.propertyChange,this,t)),t.txtRangeLeft.on("changed:after",_.bind(this.propertyChange,this,t)),t.txtRangeTop.on("button:click",_.bind(this.onPresetSelect,this,t,"top",t.btnPresetsTop.menu,{value:"select"})),t.txtRangeLeft.on("button:click",_.bind(this.onPresetSelect,this,t,"left",t.btnPresetsLeft.menu,{value:"select"})),t.btnPresetsTop.menu.on("item:click",_.bind(this.onPresetSelect,this,t,"top")),t.btnPresetsLeft.menu.on("item:click",_.bind(this.onPresetSelect,this,t,"left"))},propertyChange:function(t,e,i,n){if("scale"===e&&"customoptions"===n.value){var o=this,s=o._changedProps.length>0&&o._changedProps[t.cmbSheet.getValue()]?o._changedProps[t.cmbSheet.getValue()]:o.api.asc_getPageOptions(t.cmbSheet.getValue(),!0),a=new SSE.Views.ScaleDialog({api:o.api,props:s,handler:function(e,i){if("ok"==e){if(o.api&&i&&(o.fitWidth=i.width,o.fitHeight=i.height,o.fitScale=i.scale,o.setScaling(t,o.fitWidth,o.fitHeight,o.fitScale),o._changedProps)){var n=t.cmbSheet.getValue();o._changedProps[n]=o.getPageOptions(t,n),o.updatePreview()}}else{var a=s.asc_getPageSetup(),l=a.asc_getFitToWidth(),r=a.asc_getFitToHeight(),c=a.asc_getScale();o.setScaling(t,l,r,c)}Common.NotificationCenter.trigger("edit:complete")}});a.show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)}else if(this._changedProps){var l=t.cmbSheet.getValue();this._changedProps[l]=this.getPageOptions(t,l),this.updatePreview()}},getPrintParams:function(){return this.adjPrintParams},setScaling:function(t,e,i,n){var o;o=e||i||100!==n?1===e&&1===i?1:1!==e||i?e||1!==i?4:3:2:0,t.addCustomScale(4===o),t.cmbLayout.setValue(o,!0)},fillComponents:function(t,e){var i=this;t.txtRangeTop.validation=function(t){return!!_.isEmpty(t)||(i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange)},e&&t.txtRangeTop.updateBtnHint(this.textSelectRange),t.txtRangeLeft.validation=function(t){return!!_.isEmpty(t)||(i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange)},e&&t.txtRangeLeft.updateBtnHint(this.textSelectRange);var n=(e?[{caption:this.textSelectRange+"...",value:"select"}]:[]).concat([{caption:this.textFrozenRows,value:"frozen"},{caption:this.textFirstRow,value:"first"},{caption:"--"},{caption:this.textNoRepeat,value:"empty"}]);t.btnPresetsTop.setMenu(new Common.UI.Menu({style:"min-width: 100px;",maxHeight:200,additionalAlign:t.menuAddAlign,items:n})),n=(e?[{caption:this.textSelectRange+"...",value:"select"}]:[]).concat([{caption:this.textFrozenCols,value:"frozen"},{caption:this.textFirstCol,value:"first"},{caption:"--"},{caption:this.textNoRepeat,value:"empty"}]),t.btnPresetsLeft.setMenu(new Common.UI.Menu({style:"min-width: 100px;",maxHeight:200,additionalAlign:t.menuAddAlign,items:n}))},onPresetSelect:function(t,e,i,n){var o="top"==e?t.txtRangeTop:t.txtRangeLeft;if("select"==n.value){if(this.api){t.btnPresetsTop.menu.options.additionalAlign=t.menuAddAlign,t.btnPresetsLeft.menu.options.additionalAlign=t.menuAddAlign;var s=new SSE.Views.CellRangeDialog({handler:function(i,n){if("ok"==n){var s=i.getSettings();"top"==e?t.dataRangeTop=s:t.dataRangeLeft=s,o.setValue(s),o.checkValidate()}}}).on("close",(function(){t.show(),_.delay((function(){o.focus()}),1)})),a=t.$window.offset();t.hide(),s.show(a.left+160,a.top+125),s.setSettings({api:this.api,range:_.isEmpty(o.getValue())||1!=o.checkValidate()?"top"==e?t.dataRangeTop:t.dataRangeLeft:o.getValue(),type:Asc.c_oAscSelectionDialogType.PrintTitles})}}else{var l="";"frozen"==n.value?l=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,"left"==e,t.cmbSheet.getValue()):"first"==n.value&&(l=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.first,"left"==e,t.cmbSheet.getValue())),o.setValue(l),o.checkValidate(),"top"==e?t.dataRangeTop=l:t.dataRangeLeft=l,_.delay((function(){o.focus()}),1)}},onHidePrintMenu:function(){this._isPreviewVisible&&(this.api.asc_closePrintPreview(this._isPrint),this._isPreviewVisible=!1)},onChangePreviewPage:function(t){var e=this._navigationPreview.currentPage;t?(e++,e=Math.min(e,this._navigationPreview.pageCount-1)):(e--,e=Math.max(e,0)),this.api.asc_drawPrintPreview(e),this.updateNavigationButtons(e,this._navigationPreview.pageCount)},onPreviewWheel:function(t){t.ctrlKey&&(t.preventDefault(),t.stopImmediatePropagation()),this.printSettings.txtRangeTop.cmpEl.find("input:focus").blur(),this.printSettings.txtRangeLeft.cmpEl.find("input:focus").blur();var e=(t.deltaY||t.detail&&-t.detail||t.wheelDelta)<0;this.onChangePreviewPage(e)},onKeypressPageNumber:function(t,e){if(e.keyCode===Common.UI.Keys.RETURN){var i=this.printSettings.$el.find("#print-number-page"),n=i.find("input[type=text]"),o=parseInt(n.val());return!o||o>this._navigationPreview.pageCount||o<0?(n.select(),this.printSettings.txtNumberPage.setValue(this._navigationPreview.currentPage+1),this.printSettings.txtNumberPage.checkValidate(),!1):(i.focus(),this.api.asc_drawPrintPreview(o-1),this.api.asc_enableKeyEvents(!0),this.updateNavigationButtons(o-1,this._navigationPreview.pageCount),!1)}},onKeyupPageNumber:function(t,e){if(e.keyCode===Common.UI.Keys.ESC)return this.printSettings.$el.find("#print-number-page").focus(),this.api.asc_enableKeyEvents(!0),!1},onBlurPageNumber:function(){this.printSettings.txtNumberPage.getValue()!=this._navigationPreview.currentPage+1&&(this.printSettings.txtNumberPage.setValue(this._navigationPreview.currentPage+1),this.printSettings.txtNumberPage.checkValidate())},updatePreview:function(t){if(this._isPreviewVisible){this.printSettings.$previewBox.removeClass("hidden");var e=new Asc.asc_CAdjustPrint,i=this.printSettings.getRange();e.asc_setPrintType(i),e.asc_setPageOptionsMap(this._changedProps),e.asc_setIgnorePrintArea(this.printSettings.getIgnorePrintArea());var n=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86);n.asc_setAdvancedOptions(e);var o,s=this.api.asc_updatePrintPreview(n);this.printSettings.$previewBox.toggleClass("hidden",!s),this.printSettings.$previewEmpty.toggleClass("hidden",!!s),this._currentPrintType!==i?(o=0,this._currentPrintType=i):o=this._navigationPreview.currentPage>s-1?Math.max(0,s-1):this._navigationPreview.currentPage,this.notUpdateSheetSettings=!t,this.api.asc_drawPrintPreview(o),this.updateNavigationButtons(o,s)}},onApiChangePreviewSheet:function(t){var e=this.printSettings.cmbSheet.store.findWhere({value:t});this.printSettings.updateActiveSheet(e.get("displayValue")),this.notUpdateSheetSettings?this.notUpdateSheetSettings=!1:e&&(this.printSettings.cmbSheet.setValue(e.get("value")),this.comboSheetsChange(this.printSettings,this.printSettings.cmbSheet,e.toJSON()))},updateNavigationButtons:function(t,e){this._navigationPreview.currentPage=t,this.printSettings.updateCurrentPage(t),this._navigationPreview.pageCount=e,this.printSettings.updateCountOfPages(e),this.disableNavButtons()},disableNavButtons:function(t){if(t)return this.printSettings.btnPrevPage.setDisabled(!0),void this.printSettings.btnNextPage.setDisabled(!0);var e=this._navigationPreview.currentPage,i=this._navigationPreview.pageCount;this.printSettings.btnPrevPage.setDisabled(e<1),this.printSettings.btnNextPage.setDisabled(e>i-2)},onOpenHeaderSettings:function(){var t=this._changedProps[this.printSettings.cmbSheet.getValue()].asc_getPageSetup();SSE.getController("Toolbar").onEditHeaderClick(t)},onApiChangePreviewPage:function(t){this._navigationPreview.currentPage!==t&&(this._navigationPreview.currentPage=t,this.updateNavigationButtons(t,this._navigationPreview.pageCount),this.disableNavButtons())},onApiPreviewSheetDataChanged:function(t){t?this.updatePreview():(this.notUpdateSheetSettings=!0,this.api.asc_drawPrintPreview(this._navigationPreview.currentPage),this.updateNavigationButtons(this._navigationPreview.currentPage,this._navigationPreview.pageCount))},warnCheckMargings:"Margins are incorrect",strAllSheets:"All Sheets",textWarning:"Warning",txtCustom:"Custom",textInvalidRange:"ERROR! Invalid cells range",textRepeat:"Repeat...",textNoRepeat:"Not repeat",textSelectRange:"Select range",textFrozenRows:"Frozen rows",textFrozenCols:"Frozen columns",textFirstRow:"First row",textFirstCol:"First column"},SSE.Controllers.Print||{}))})),define("spreadsheeteditor/main/app/view/DataTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(){"use strict";SSE.Views.DataTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.btnUngroup.menu.on("item:click",(function(e,i,n){t.fireEvent("data:ungroup",[i.value])})),t.btnUngroup.on("click",(function(e,i){t.fireEvent("data:ungroup")})),t.btnGroup.menu.on("item:click",(function(e,i,n){t.fireEvent("data:group",[i.value,i.checked])})),t.btnGroup.on("click",(function(e,i){t.fireEvent("data:group")})),t.btnGroup.menu.on("show:before",(function(e,i){t.fireEvent("data:groupsettings",[e])})),t.btnTextToColumns.on("click",(function(e,i){t.fireEvent("data:tocolumns")})),t.btnRemoveDuplicates.on("click",(function(e,i){t.fireEvent("data:remduplicates")})),t.btnDataValidation.on("click",(function(e,i){t.fireEvent("data:datavalidation")})),t.btnsSortDown.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:sort",[Asc.c_oAscSortOptions.Ascending])}))})),t.btnsSortUp.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:sort",[Asc.c_oAscSortOptions.Descending])}))})),t.btnsSetAutofilter.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:setfilter",[Asc.c_oAscSortOptions.Descending])}))})),t.btnsClearAutofilter.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:clearfilter",[Asc.c_oAscSortOptions.Descending])}))})),t.btnCustomSort.on("click",(function(e,i){t.fireEvent("data:sortcustom")})),t.btnDataFromText.menu?t.btnDataFromText.menu.on("item:click",(function(e,i,n){t.fireEvent("data:fromtext",[i.value])})):t.btnDataFromText.on("click",(function(e,i){t.fireEvent("data:fromtext",["file"])}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.lockedControls=[];var e=this.toolbar.$el,i=Common.enumLock;this.btnDataFromText=new Common.UI.Button({parentEl:e.find("#slot-btn-data-from-text"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-import-data",caption:this.capDataFromText,menu:!this.toolbar.mode.isDesktopApp,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.sheetLock,i.wbLock,i.lostConnect,i.coAuth,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnDataFromText),this.btnGroup=new Common.UI.Button({parentEl:e.find("#slot-btn-group"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-cell-group",caption:this.capBtnGroup,split:!0,menu:!0,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.sheetLock,i.lostConnect,i.coAuth,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnGroup),this.btnUngroup=new Common.UI.Button({parentEl:e.find("#slot-btn-ungroup"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-cell-ungroup",caption:this.capBtnUngroup,split:!0,menu:!0,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.sheetLock,i.lostConnect,i.coAuth,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnUngroup),this.btnTextToColumns=new Common.UI.Button({parentEl:e.find("#slot-btn-text-column"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-to-columns",caption:this.capBtnTextToCol,split:!1,disabled:!0,lock:[i.multiselect,i.multiselectCols,i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnTextToColumns),this.btnRemoveDuplicates=new Common.UI.Button({parentEl:e.find("#slot-btn-rem-duplicates"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-remove-duplicates",caption:this.capBtnTextRemDuplicates,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.ruleFilter,i.editPivot,i.cantModifyFilter,i.sheetLock,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnRemoveDuplicates),this.btnDataValidation=new Common.UI.Button({parentEl:e.find("#slot-btn-data-validation"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-data-validation",caption:this.capBtnTextDataValidation,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.editPivot,i.cantModifyFilter,i.sheetLock,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnDataValidation),this.btnCustomSort=new Common.UI.Button({parentEl:e.find("#slot-btn-custom-sort"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-custom-sort",caption:this.capBtnTextCustomSort,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.ruleFilter,i.editPivot,i.cantModifyFilter,i.sheetLock,i.Sort],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCustomSort),this.btnsSortDown=Common.Utils.injectButtons(e.find(".slot-sortdesc"),"","toolbar__icon btn-sort-down","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.lostConnect,i.coAuth,i.ruleFilter,i.cantModifyFilter,i.sheetLock,i.cantSort,i.Sort],void 0,void 0,void 0,"1","top",void 0,"D"),this.btnsSortUp=Common.Utils.injectButtons(e.find(".slot-sortasc"),"","toolbar__icon btn-sort-up","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.lostConnect,i.coAuth,i.ruleFilter,i.cantModifyFilter,i.sheetLock,i.cantSort,i.Sort],void 0,void 0,void 0,"1","top",void 0,"U"),this.btnsSetAutofilter=Common.Utils.injectButtons(e.find(".slot-btn-setfilter"),"","toolbar__icon btn-autofilter","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.ruleFilter,i.editPivot,i.cantModifyFilter,i.tableHasSlicer,i.wsLock],!1,!1,!0,"1","bottom",void 0,"F"),this.btnsClearAutofilter=Common.Utils.injectButtons(e.find(".slot-btn-clear-filter"),"","toolbar__icon btn-clear-filter","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.lostConnect,i.coAuth,i.ruleDelFilter,i.wsLock],void 0,void 0,void 0,"1","bottom",void 0,"N"),Array.prototype.push.apply(this.lockedControls,this.btnsSortDown.concat(this.btnsSortUp,this.btnsSetAutofilter,this.btnsClearAutofilter)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnUngroup.updateHint(i.tipUngroup);var e=new Common.UI.Menu({items:[{caption:i.textRows,value:"rows"},{caption:i.textColumns,value:"columns"},{caption:i.textClear,value:"clear"}]});i.btnUngroup.setMenu(e),i.btnGroup.updateHint(i.tipGroup),e=new Common.UI.Menu({items:[{caption:i.textGroupRows,value:"rows"},{caption:i.textGroupColumns,value:"columns"},{caption:"--"},{caption:i.textBelow,value:"below",checkable:!0},{caption:i.textRightOf,value:"right",checkable:!0}]}),i.btnGroup.setMenu(e),i.btnDataFromText.updateHint(i.tipDataFromText),i.btnDataFromText.menu&&i.btnDataFromText.setMenu(new Common.UI.Menu({items:[{caption:i.mniFromFile,value:"file"},{caption:i.mniFromUrl,value:"url"}]})),i.btnTextToColumns.updateHint(i.tipToColumns),i.btnRemoveDuplicates.updateHint(i.tipRemDuplicates),i.btnDataValidation.updateHint(i.tipDataValidation),i.btnsSortDown.forEach((function(t){t.updateHint(i.toolbar.txtSortAZ)})),i.btnsSortUp.forEach((function(t){t.updateHint(i.toolbar.txtSortZA)})),i.btnsSetAutofilter.forEach((function(t){t.updateHint(i.toolbar.txtFilter+" (Ctrl+Shift+L)")})),i.btnsClearAutofilter.forEach((function(t){t.updateHint(i.toolbar.txtClearFilter)})),i.btnCustomSort.updateHint(i.tipCustomSort),t.call(i)}))},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return"sort-down"==t?this.btnsSortDown:"sort-up"==t?this.btnsSortUp:"sort-custom"==t?this.btnCustomSort:"set-filter"==t?this.btnsSetAutofilter:"clear-filter"==t?this.btnsClearAutofilter:"rem-duplicates"==t?this.btnRemoveDuplicates:"data-validation"==t?this.btnDataValidation:void 0===t?this.lockedControls:[]},SetDisabled:function(t){this.lockedControls&&this.lockedControls.forEach((function(e){e&&e.setDisabled(t)}),this)},capBtnGroup:"Group",capBtnUngroup:"Ungroup",textRows:"Ungroup rows",textColumns:"Ungroup columns",textGroupRows:"Group rows",textGroupColumns:"Group columns",textClear:"Clear outline",tipGroup:"Group range of cells",tipUngroup:"Ungroup range of cells",capBtnTextToCol:"Text to Columns",tipToColumns:"Separate cell text into columns",capBtnTextShow:"Show details",capBtnTextHide:"Hide details",textBelow:"Summary rows below detail",textRightOf:"Summary columns to right of detail",capBtnTextCustomSort:"Custom Sort",tipCustomSort:"Custom sort",capBtnTextRemDuplicates:"Remove Duplicates",tipRemDuplicates:"Remove duplicate rows from a sheet",capBtnTextDataValidation:"Data Validation",tipDataValidation:"Data validation",capDataFromText:"From Text/CSV",tipDataFromText:"Get data from Text/CSV file",mniFromFile:"Get Data from File",mniFromUrl:"Get Data from URL"}}(),SSE.Views.DataTab||{}))})),define("text!spreadsheeteditor/main/app/template/SortDialog.template",[],(function(){return'<div class="settings-panel active">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small">\n                    <button type="button" class="btn btn-text-default auto sort-dialog-btn-text" id="sort-dialog-btn-add"><%= scope.textAdd %></button>\n                    <button type="button" class="btn btn-text-default auto sort-dialog-btn-text" id="sort-dialog-btn-delete"><%= scope.textDelete %></button>\n                    <button type="button" class="btn btn-text-default auto sort-dialog-btn-text" id="sort-dialog-btn-copy"><%= scope.textCopy %></button>\n                    <div id="sort-dialog-btn-up" style="display: inline-block;"></div>\n                    <div id="sort-dialog-btn-down" style="display: inline-block;"></div>\n                    <button type="button" class="btn btn-text-default" id="sort-dialog-btn-options" style="min-width: 100px;"><%= scope.textOptions %></button>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label id="sort-dialog-label-column" class="header" style="width: 243px;"><%= scope.textColumn %></label>\n                    <label id="sort-dialog-label-sort" class="header" style="width: 141px;"><%= scope.textSort %></label>\n                    <label class="header" style=""><%= scope.textOrder %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div id="sort-dialog-list" class="" style="width:100%; height: 151px;"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),define("spreadsheeteditor/main/app/view/SortOptionsDialog",["common/main/lib/util/utils","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/view/AdvancedSettingsWindow"],(function(){"use strict";SSE.Views.SortOptionsDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:230,height:200},initialize:function(t){_.extend(this.options,{title:this.textTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel"><div class="inner-content">','<div class="settings-panel active">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-large">','<div id="sort-options-chk-headers"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<label class="input-label">'+this.textOrientation+"</label>","</td>","</tr>","<tr>",'<td class="padding-small">','<div id="sort-options-radio-row"></div>',"</td>","</tr>","<tr>",'<td class="padding-small">','<div id="sort-options-radio-col"></div>',"</td>","</tr>","</table>","</div></div>","</div>","</div>"].join("")},t),this.props=t.props,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this),this.chHeaders=new Common.UI.CheckBox({el:$("#sort-options-chk-headers"),labelText:this.textHeaders}),this.radioTop=new Common.UI.RadioBox({el:$("#sort-options-radio-row"),labelText:this.textTopBottom,name:"asc-radio-sort-orient"}).on("change",_.bind((function(t,e,i){e&&this.chHeaders.setDisabled(this.props.lockHeaders)}),this)),this.radioLeft=new Common.UI.RadioBox({el:$("#sort-options-radio-col"),labelText:this.textLeftRight,name:"asc-radio-sort-orient"}).on("change",_.bind((function(t,e,i){e&&this.chHeaders.setDisabled(!0)}),this)),this.afterRender()},getFocusedComponents:function(){return[this.chHeaders,this.radioTop,this.radioLeft]},getDefaultFocusableComponent:function(){return this.radioTop},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){t&&(this.chHeaders.setValue(t.headers),t.sortcol||t.lockOrientation?this.radioTop.setValue(!0):this.radioLeft.setValue(!0),this.radioLeft.setDisabled(t.lockOrientation))},getSettings:function(){return{headers:this.radioTop.getValue()&&"checked"==this.chHeaders.getValue(),sortcol:this.radioTop.getValue(),lockHeaders:this.props.lockHeaders,lockOrientation:this.props.lockOrientation}},textTitle:"Sort Options",textHeaders:"My data has headers",textCase:"Case sensitive",textOrientation:"Orientation",textTopBottom:"Sort top to bottom",textLeftRight:"Sort left to right"},SSE.Views.SortOptionsDialog||{}))})),define("spreadsheeteditor/main/app/view/SortDialog",["text!spreadsheeteditor/main/app/template/SortDialog.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/ListView","spreadsheeteditor/main/app/view/SortOptionsDialog"],(function(t){"use strict";SSE.Views=SSE.Views||{};var e=Common.UI.DataViewItem.extend({initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.listenTo(e.model,"change:sort",(function(){e.render(),e.trigger("change",e,e.model)})),e.listenTo(e.model,"change:selected",(function(){(e.$el||$(e.el)).toggleClass("selected",e.model.get("selected")&&e.model.get("allowSelected")),e.onSelectChange(e.model,e.model.get("selected")&&e.model.get("allowSelected"))})),e.listenTo(e.model,"remove",e.remove)}});SSE.Views.SortDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"SortDialog",contentWidth:560,height:294,buttons:["ok","cancel"]},initialize:function(e){_.extend(this.options,{title:this.txtTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">'+_.template(t)({scope:this})+"</div>","</div>"].join("")},e),this.api=e.api,this.handler=e.handler,this.props=e.props,this.levels=[],this.sortOptions={},this.options.handler=function(t,i){if(i||(i=new Asc.CSortProperties).asc_setSelection(e.props.asc_getSelection()),"ok"==t&&!this.isListValid())return!0;e.handler&&e.handler.call(this,t,i)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=$('<span style="position: absolute; visibility: hidden;"></span>');this.$window.append(t),t.text(this.textSortBy);var i=t.width();t.text(this.textThenBy),i=Math.ceil(Math.max(i,t.width()))+10,t.remove(),this.sortList=new Common.UI.ListView({el:$("#sort-dialog-list",this.$window),store:new Common.UI.DataViewStore,emptyText:"",enableKeyEvents:!1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(['<div class="list-item" style="width: 100%;display: flex;align-items:center;" id="sort-dialog-item-<%= levelIndex %>">','<label class="level-caption" style="padding-right: 5px;width: '+i+'px;flex-shrink:0;cursor: pointer;"></label>','<div style="display:inline-block;flex-grow: 1;">','<div style="width: 33%;padding: 0 5px;display: inline-block;vertical-align: top;"><div id="sort-dialog-cmb-col-<%= levelIndex %>" class="input-group-nr" style=""></div></div>','<div style="width: 33%;padding: 0 5px;display: inline-block;vertical-align: top;"><div id="sort-dialog-cmb-sort-<%= levelIndex %>" class="input-group-nr"></div></div>',"<% if (sort==Asc.c_oAscSortOptions.ByColorFill || sort==Asc.c_oAscSortOptions.ByColorFont) { %>",'<div style="width: 17%;padding: 0 5px;display: inline-block;vertical-align: top;"><div id="sort-dialog-btn-color-<%= levelIndex %>" class="input-group-nr"></div></div>','<div style="width: 17%;padding: 0 5px;display: inline-block;vertical-align: top;"><div id="sort-dialog-cmb-order-<%= levelIndex %>" class="input-group-nr" style=""></div></div>',"<% } else { %>",'<div style="width: 34%;padding: 0 5px;display: inline-block;vertical-align: top;"><div id="sort-dialog-cmb-order-<%= levelIndex %>" class="input-group-nr" style=""></div></div>',"<% } %>","</div>","</div>"].join("")),tabindex:1}),this.sortList.createNewItem=function(t){return new e({template:this.itemTemplate,model:t})},this.sortList.on("item:select",_.bind(this.onSelectLevel,this)).on("item:keydown",_.bind(this.onKeyDown,this)),this.btnAdd=new Common.UI.Button({el:$("#sort-dialog-btn-add")}),this.btnAdd.on("click",_.bind(this.onAddLevel,this,!1)),this.btnDelete=new Common.UI.Button({el:$("#sort-dialog-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDeleteLevel,this)),this.btnCopy=new Common.UI.Button({el:$("#sort-dialog-btn-copy")}),this.btnCopy.on("click",_.bind(this.onCopyLevel,this,!1)),this.btnOptions=new Common.UI.Button({el:$("#sort-dialog-btn-options")}),this.btnOptions.on("click",_.bind(this.onOptions,this,!1)),this.btnUp=new Common.UI.Button({parentEl:$("#sort-dialog-btn-up"),cls:"btn-toolbar bg-white",iconCls:"caret-up",hint:this.textUp}),this.btnUp.on("click",_.bind(this.onMoveClick,this,!0)),this.btnDown=new Common.UI.Button({parentEl:$("#sort-dialog-btn-down"),cls:"btn-toolbar bg-white",iconCls:"caret-down",hint:this.textDown}),this.btnDown.on("click",_.bind(this.onMoveClick,this,!1)),this.lblColumn=$("#sort-dialog-label-column"),this.lblSort=$("#sort-dialog-label-sort"),this.afterRender()},afterRender:function(){this._setDefaults(this.props)},getFocusedComponents:function(){return[this.btnAdd,this.btnDelete,this.btnCopy,this.btnOptions,this.btnUp,this.btnDown,this.sortList]},getDefaultFocusableComponent:function(){return this.sortList},_setDefaults:function(t){t&&(this.sortOptions={headers:t.asc_getHasHeaders(),sortcol:t.asc_getColumnSort(),lockHeaders:!!t.asc_getLockChangeHeaders(),lockOrientation:!!t.asc_getLockChangeOrientation()},this.lblColumn.text(t.asc_getColumnSort()?this.textColumn:this.textRow),this.fillSortValues(),this.sort_data=[{value:Asc.c_oAscSortOptions.ByValue,displayValue:this.textValues},{value:Asc.c_oAscSortOptions.ByColorFill,displayValue:this.textCellColor},{value:Asc.c_oAscSortOptions.ByColorFont,displayValue:this.textFontColor}],this.order_data=[{value:Asc.c_oAscSortOptions.Ascending,displayValue:this.textAZ},{value:Asc.c_oAscSortOptions.Descending,displayValue:this.textZA}],this.sortList.on("item:add",_.bind(this.addControls,this)),this.sortList.on("item:change",_.bind(this.addControls,this)),this.refreshList(t.asc_getLevels()),this.initListHeaders())},refreshList:function(t){this.levels=[];var e=[];if(t||1!=this.column_data.length||(t=[{columnIndex:this.column_data[0].value,sort:Asc.c_oAscSortOptions.ByValue,order:Asc.c_oAscSortOptions.Ascending}]),t)for(var i=0;i<t.length;i++){var n=t[i],o=n.asc_getIndex?n.asc_getIndex():n.columnIndex,s=this.props.asc_getLevelProps(o),a=n.asc_getSortBy?n.asc_getSortBy():n.sort,l=!s||s.asc_getIsTextData(),r=a!==Asc.c_oAscSortOptions.ByValue;if(e.push({columnIndex:o,levelIndex:i,sort:a,order:n.asc_getDescending?n.asc_getDescending():n.order,color:n.asc_getColor?n.asc_getColor():void 0}),r){var c=[],d=this;if(s)(a==Asc.c_oAscSortOptions.ByColorFill?s.asc_getColorsFill():s.asc_getColorsFont()).forEach((function(t,e){if(t){var i=Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()).toLocaleUpperCase();c.push({value:i,displayValue:"",color:t,styleObj:{"background-color":"#"+i},styleStr:"background-color: #"+i+";"})}else c.unshift({value:-1,displayValue:a==Asc.c_oAscSortOptions.ByColorFill?d.textNone:d.textAuto,color:null,styleObj:{"background-color":"transparent"},styleStr:"background-color:transparent;"})}))}this.levels[i]={levelProps:s,order_data:[{value:Asc.c_oAscSortOptions.Ascending,displayValue:r?this.sortOptions.sortcol?this.textTop:this.textLeft:l?this.textAZ:this.textAsc},{value:Asc.c_oAscSortOptions.Descending,displayValue:r?this.sortOptions.sortcol?this.textBelow:this.textRight:l?this.textZA:this.textDesc}],color_data:c}}else e.push({columnIndex:null,levelIndex:0,sort:Asc.c_oAscSortOptions.ByValue,order:Asc.c_oAscSortOptions.Ascending});this.sortList.store.reset(e),this.sortList.store.length>0&&this.sortList.selectByIndex(0),this.updateButtons()},initListHeaders:function(){var t=this.sortList.cmpEl.find("#sort-dialog-cmb-sort-0").position();t&&this.lblColumn.width(Math.floor(t.left)-3),!(t=this.sortList.cmpEl.find("#sort-dialog-btn-color-0").position())&&(t=this.sortList.cmpEl.find("#sort-dialog-cmb-order-0").position()),t&&this.lblSort.width(Math.floor(t.left)-5-this.lblColumn.width())},addControls:function(t,e,i){if(i){var n=this,o=i.get("levelIndex"),s=this.sortList.cmpEl.find("#sort-dialog-item-"+o);this.levels[o]||(this.levels[o]={order_data:this.order_data});var a=this.levels[o],l=new Common.UI.ComboBox({el:s.find("#sort-dialog-cmb-col-"+o),editable:!1,cls:"input-group-nr no-highlighted",menuCls:"menu-absolute",menuStyle:"max-height: 135px;",data:this.column_data}).on("selected",(function(t,e){if(-1==e.value){var s=i.get("columnIndex");t.setValue(null!==s?s:""),n.onSelectOther(t,i)}else i.set("columnIndex",e.value),a.levelProps=n.props.asc_getLevelProps(e.value),n.updateOrderList(o,i,!0)})),r=i.get("columnIndex");null!==r&&l.setValue(i.get("columnIndex")),a.cmbColumn=l,l=new Common.UI.ComboBox({el:s.find("#sort-dialog-cmb-sort-"+o),editable:!1,cls:"input-group-nr no-highlighted",menuCls:"menu-absolute",data:this.sort_data}).on("selected",(function(t,e){i.set("sort",e.value),n.updateOrderList(o,i)})),null!==(r=i.get("sort"))&&l.setValue(r),a.cmbSort=l;var c=i.get("sort");if(c==Asc.c_oAscSortOptions.ByColorFill||c==Asc.c_oAscSortOptions.ByColorFont){l=new Common.UI.ComboBoxColor({el:s.find("#sort-dialog-btn-color-"+o),editable:!1,menuCls:"menu-absolute",cls:"no-highlighted",menuStyle:"max-height: 135px;",data:a.color_data,disabled:!a.color_data||a.color_data.length<1}).on("selected",(function(t,e){i.set("color",e.color)})),r=i.get("color"),l.setValue(r?Common.Utils.ThemeColor.getHexColor(r.get_r(),r.get_g(),r.get_b()).toLocaleUpperCase():-1);var d=l.getSelectedRecord();d&&i.set("color",d.color),a.cmbColor=l}l=new Common.UI.ComboBox({el:s.find("#sort-dialog-cmb-order-"+o),editable:!1,cls:"input-group-nr no-highlighted",menuCls:"menu-absolute",data:a.order_data}).on("selected",(function(t,e){i.set("order",e.value)})),null!==(r=i.get("order"))&&l.setValue(r),a.cmbOrder=l,s.on("mousedown",".combobox",(function(){n.sortList.selectRecord(i)})),this.updateLevelCaptions(!0)}},onOptions:function(){var t=this;new SSE.Views.SortOptionsDialog({props:t.sortOptions,handler:function(e,i){if("ok"==e&&i){t.lblColumn.text(i.sortcol?t.textColumn:t.textRow),t.props.asc_setHasHeaders(i.headers),t.props.asc_setColumnSort(i.sortcol);var n=t.sortOptions.sortcol==i.sortcol;t.props.asc_updateSortList(n),t.sortOptions=i,t.updateSortValues(n)}}}).show()},fillSortValues:function(){var t=this.props.asc_getSortList(),e=t.length;this.column_data=[];for(var i=0;i<e;i++)null!=t[i]&&this.column_data.push({value:i,displayValue:t[i]});this.column_data.length>=500&&this.column_data.push({value:-1,displayValue:this.sortOptions.sortcol?this.textMoreCols:this.textMoreRows})},updateSortValues:function(t){this.fillSortValues();var e=this;this.sortList.store.each((function(i){var n=t?i.get("columnIndex"):0,o=i.get("levelIndex");t||(i.set("columnIndex",n,{silent:!0}),i.set("color",null,{silent:!0})),e.levels[o].levelProps=null!==n?e.props.asc_getLevelProps(n):void 0,e.addControls(null,null,i),e.updateOrderList(o,i,!0)}))},onAddLevel:function(){var t=this.sortList.store,e=this.sortList.getSelectedRec(),i=1==this.column_data.length?this.column_data[0].value:null,n=this.levels.length;if(null!==i){var o=this.props.asc_getLevelProps(i),s=!o||o.asc_getIsTextData();this.levels[n]={levelProps:o,order_data:[{value:Asc.c_oAscSortOptions.Ascending,displayValue:s?this.textAZ:this.textAsc},{value:Asc.c_oAscSortOptions.Descending,displayValue:s?this.textZA:this.textDesc}]}}(e=t.add({columnIndex:i,levelIndex:n,sort:Asc.c_oAscSortOptions.ByValue,order:Asc.c_oAscSortOptions.Ascending},{at:e?t.indexOf(e)+1:t.length}))&&(this.sortList.selectRecord(e),this.sortList.scrollToRecord(e)),this.updateButtons()},onCopyLevel:function(){var t=this.sortList.store,e=this.sortList.getSelectedRec(),i=this.levels.length,n=this.levels[e?e.get("levelIndex"):null];this.levels[i]={levelProps:n?n.levelProps:null,order_data:n?n.order_data:null,color_data:n?n.color_data:null},(e=t.add({levelIndex:i,columnIndex:e?e.get("columnIndex"):null,sort:e?e.get("sort"):Asc.c_oAscSortOptions.ByValue,order:e?e.get("order"):Asc.c_oAscSortOptions.Ascending,color:e?e.get("color"):null},{at:e?t.indexOf(e)+1:t.length}))&&(this.sortList.selectRecord(e),this.sortList.scrollToRecord(e)),this.updateButtons()},onDeleteLevel:function(){var t=this.sortList.store,e=this.sortList.getSelectedRec();if(e){var i=e.get("levelIndex");this.levels[i]=void 0,i=t.indexOf(e),t.remove(e),t.length>0&&this.sortList.selectByIndex(i<t.length?i:t.length-1),this.sortList.scrollToRecord(this.sortList.getSelectedRec())}this.updateButtons()},onMoveClick:function(t){var e=this.sortList.store,i=e.length,n=this.sortList.getSelectedRec();if(n){var o=e.indexOf(n);e.add(e.remove(n),{at:t?Math.max(0,o-1):Math.min(i-1,o+1)}),this.sortList.selectRecord(n),this.sortList.scrollToRecord(n)}this.updateMoveButtons(),this.updateLevelCaptions()},onSelectLevel:function(t,e,i){this.updateMoveButtons()},updateOrderList:function(t,e,i){var n=this.levels[t],o=!n.levelProps||n.levelProps.asc_getIsTextData(),s=n.cmbSort.getValue()!==Asc.c_oAscSortOptions.ByValue,a=n.cmbOrder.getValue();if(n.order_data=[{value:Asc.c_oAscSortOptions.Ascending,displayValue:s?this.sortOptions.sortcol?this.textTop:this.textLeft:o?this.textAZ:this.textAsc},{value:Asc.c_oAscSortOptions.Descending,displayValue:s?this.sortOptions.sortcol?this.textBelow:this.textRight:o?this.textZA:this.textDesc}],n.cmbOrder.setData(n.order_data),n.cmbOrder.setValue(a),s){n.color_data=[];var l,r=e?e.get("color"):null,c=r?Common.Utils.ThemeColor.getHexColor(r.get_r(),r.get_g(),r.get_b()).toLocaleUpperCase():-1;if(n.levelProps){var d=this;(n.cmbSort.getValue()==Asc.c_oAscSortOptions.ByColorFill?n.levelProps.asc_getColorsFill():n.levelProps.asc_getColorsFont()).forEach((function(t,e){var i=t?Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()).toLocaleUpperCase():-1,o={value:i,displayValue:t?"":n.cmbSort.getValue()==Asc.c_oAscSortOptions.ByColorFill?d.textNone:d.textAuto,color:t,styleObj:{"background-color":t?"#"+i:"transparent"},styleStr:t?"background-color: #"+i+";":"background-color:transparent;"};t?n.color_data.push(o):n.color_data.unshift(o),c==o.value&&(l=c)}))}n.cmbColor.setData(n.color_data),n.cmbColor.setDisabled(n.color_data.length<1),n.color_data.length>0&&n.cmbColor.setValue(l&&i?l:n.color_data[0].value);var h=n.cmbColor.getSelectedRecord();h&&e&&e.set("color",h.color)}},getSettings:function(){var t=new Asc.CSortProperties;t.asc_setHasHeaders(this.sortOptions.headers),t.asc_setColumnSort(this.sortOptions.sortcol);var e=this,i=[];return this.sortList.store.each((function(t){var n=t.get("columnIndex"),o=e.levels[t.get("levelIndex")];if(null!==n&&o){var s=new Asc.CSortPropertiesLevel;if(s.asc_setIndex(n),s.asc_setSortBy(o.cmbSort.getValue()),s.asc_setDescending(o.cmbOrder.getValue()),o.cmbSort.getValue()==Asc.c_oAscSortOptions.ByColorFill||o.cmbSort.getValue()==Asc.c_oAscSortOptions.ByColorFont){var a=o.cmbColor.getSelectedRecord();a&&s.asc_setColor(a.color)}i.push(s)}})),t.asc_setLevels(i),t.asc_setSelection(this.props.asc_getSelection()),t},isListValid:function(){var t=this.sortList.store.findWhere({columnIndex:null});if(t)Common.UI.warning({msg:this.errorEmpty});else{for(var e=this.sortList.store,i=e.length,n=0;n<i;n++){for(var o=e.at(n),s=this.levels[o.get("levelIndex")],a=s.cmbSort.getValue(),l=a==Asc.c_oAscSortOptions.ByColorFill||a==Asc.c_oAscSortOptions.ByColorFont?s.cmbColor.getSelectedRecord():null,r=n-1;r>=0;r--){var c=e.at(r),d=this.levels[c.get("levelIndex")];if(o.get("columnIndex")==c.get("columnIndex")&&a==d.cmbSort.getValue()){if(a!=Asc.c_oAscSortOptions.ByColorFill&&a!=Asc.c_oAscSortOptions.ByColorFont){t=s.cmbColumn.getSelectedRecord().displayValue,t=this.errorSameColumnValue.replace("%1",t);break}var h=d.cmbColor.getSelectedRecord();if(l&&h&&l.value==h.value){t=s.cmbColumn.getSelectedRecord().displayValue,t=this.errorSameColumnColor.replace("%1",t);break}}}if(t)break}t&&Common.UI.warning({msg:t})}return!t},close:function(){Common.Views.AdvancedSettingsWindow.prototype.close.call(this)},onKeyDown:function(t,e,i){i.keyCode!=Common.UI.Keys.DELETE||this.btnDelete.isDisabled()||this.onDeleteLevel()},updateButtons:function(){this.btnAdd.setDisabled(this.sortList.store.length>63),this.btnCopy.setDisabled(this.sortList.store.length<1),this.btnDelete.setDisabled(this.sortList.store.length<1),this.updateMoveButtons(),this.updateLevelCaptions(!0),this.sortList.scroller&&this.sortList.scroller.update()},updateMoveButtons:function(){var t=this.sortList.getSelectedRec(),e=t?this.sortList.store.indexOf(t):-1;this.btnUp.setDisabled(e<1),this.btnDown.setDisabled(e<0||e==this.sortList.store.length-1)},updateLevelCaptions:function(t){var e=this.$window.find(".level-caption");e.length<1||(t?e.text(this.textThenBy):e.length>1&&(e[1].innerText=this.textThenBy),e[0].innerText=this.textSortBy)},onSelectOther:function(t,e){var i=this;if(i.api){var n=new SSE.Views.CellRangeDialog({handler:function(n,o){if("ok"==o){var s,a=n.getSettings();if(_.isEmpty(a)||(s=i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.CustomSort,a,!0,!i.sortOptions.sortcol)),s==Asc.c_oAscError.ID.No){var l=i.props.asc_addBySortList(a);return i.fillSortValues(),t.setData(i.column_data),t.setValue(l),e.set("columnIndex",l),i.levels[e.get("levelIndex")].levelProps=i.props.asc_getLevelProps(l),i.updateOrderList(e.get("levelIndex"),e,!0),!1}return s==Asc.c_oAscError.ID.CustomSortMoreOneSelectedError?Common.UI.warning({msg:i.sortOptions.sortcol?i.errorMoreOneCol:i.errorMoreOneRow}):s==Asc.c_oAscError.ID.CustomSortNotOriginalSelectError?Common.UI.warning({msg:i.sortOptions.sortcol?i.errorNotOriginalCol:i.errorNotOriginalRow}):Common.UI.warning({msg:i.txtInvalidRange}),!0}}}).on("close",(function(){i.show()})),o=i.$window.offset();i.hide(),n.show(o.left+65,o.top+77),n.setSettings({api:i.api,range:i.props.asc_getRangeStr(),type:Asc.c_oAscSelectionDialogType.CustomSort})}},txtTitle:"Sort",textAdd:"Add level",textDelete:"Delete level",textCopy:"Copy level",textColumn:"Column",textRow:"Row",textSort:"Sort on",textOrder:"Order",textUp:"Move level up",textDown:"Move level down",textOptions:"Options",textValues:"Values",textCellColor:"Cell color",textFontColor:"Font color",textAZ:"A to Z",textZA:"Z to A",textDesc:"Descending",textAsc:"Ascending",textTop:"Top",textBelow:"Below",textLeft:"Left",textRight:"Right",errorEmpty:"All sort criteria must have a column or row specified.",textAuto:"Auto",textNone:"None",errorNotOriginalCol:"The column you selected is not in the original selected range.",errorNotOriginalRow:"The row you selected is not in the original selected range.",errorMoreOneRow:"More than one row is selected.",errorMoreOneCol:"More than one column is selected.",txtInvalidRange:"Invalid cells range.",textMoreRows:"(More rows...)",textMoreCols:"(More columns...)",errorSameColumnValue:"%1 is being sorted by values more than once.<br>Delete the duplicate sort criteria and try again.",errorSameColumnColor:"%1 is being sorted by the same color more than once.<br>Delete the duplicate sort criteria and try again.",textSortBy:"Sort by",textThenBy:"Then by"},SSE.Views.SortDialog||{}))})),define("spreadsheeteditor/main/app/view/RemoveDuplicatesDialog",["common/main/lib/component/Window","common/main/lib/component/CheckBox","common/main/lib/component/ListView"],(function(){"use strict";SSE.Views.RemoveDuplicatesDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 230px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.txtTitle},t||{}),this.template=['<div class="box" style="height: 260px;">','<div style="margin-bottom: 16px;">',"<label>"+this.textDescription+"</label>","</div>",'<div class="input-row">','<div id="rem-duplicates-dlg-headers"></div>',"</div>",'<div class="input-row">','<label style="font-weight: bold;">'+this.textColumns+"</label>","</div>",'<div id="rem-duplicates-dlg-columns" class="" style="width: 100%; height: 162px; overflow: hidden;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.api=this.options.api,this.props=this.options.props,this.handler=this.options.handler,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.chHeaders=new Common.UI.CheckBox({el:$("#rem-duplicates-dlg-headers"),labelText:this.textHeaders}),this.chHeaders.on("change",_.bind((function(t,e,i,n){this.props.asc_setHasHeaders("checked"==t.getValue()),this.props.asc_updateColumnList(),this.updateColumnsList()}),this)),this.columnsList=new Common.UI.ListView({el:$("#rem-duplicates-dlg-columns",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,scrollAlwaysVisible:!0,tabindex:1,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(["<div>",'<label class="checkbox-indeterminate" style="position:absolute;">','<input id="rdcheckbox-<%= id %>" type="checkbox" class="button__checkbox">','<label for="rdcheckbox-<%= id %>" class="checkbox__shape"></label>',"</label>",'<div id="<%= id %>" class="list-item" style="pointer-events:none; margin-left: 20px;display: flex;">','<div style="flex-grow: 1;"><%= Common.Utils.String.htmlEncode(value) %></div>',"</div>","</div>"].join(""))}),this.columnsList.on({"item:change":this.onItemChanged.bind(this),"item:add":this.onItemChanged.bind(this),"item:select":this.onCellCheck.bind(this)}),this.columnsList.onKeyDown=_.bind(this.onListKeyDown,this),this.columnsList.on("entervalue",_.bind(this.onPrimary,this)),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.afterRender()},updateColumnsList:function(){var t=!1,e=0,i=[],n=this.columnsList.store;n.length<1?(this.props.asc_getColumnList().forEach((function(t,n){var o=t.asc_getVisible();i.push(new Common.UI.DataViewModel({id:n,selected:!1,allowSelected:!0,value:t.asc_getVal(),groupid:"1",check:o})),o&&e++})),e==i.length?t=!0:e>0&&(t="indeterminate"),i.length>0&&i.unshift(new Common.UI.DataViewModel({id:i.length,selected:!1,allowSelected:!0,value:this.textSelectAll,groupid:"0",check:t,throughIndex:0})),this.columnsList.store.reset(i),this.columnsList.scroller.update({minScrollbarLength:this.columnsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0})):this.props.asc_getColumnList().forEach((function(t,e){n.at(e+1).set("value",t.asc_getVal())}))},onItemChanged:function(t,e){var i=e.model.get("check");"indeterminate"==i?$("input[type=checkbox]",e.$el).prop("indeterminate",!0):$("input[type=checkbox]",e.$el).prop({checked:i,indeterminate:!1})},onCellCheck:function(t,e,i){if(!this.checkCellTrigerBlock){var n="",o=!1,s=null,a=window.event?window.event:window._event;if(a){if((n=$(a.currentTarget).find(".list-item")).length){s=n.get(0).getBoundingClientRect();var l=a.clientX*Common.Utils.zoom(),r=a.clientY*Common.Utils.zoom();s.left<l&&l<s.right&&s.top<r&&r<s.bottom&&(o=!0)}(o||a.target.className.match("checkbox")&&"input"!==a.target.localName)&&(this.updateCellCheck(t,i),_.delay((function(){t.focus()}),100,this))}}},onListKeyDown:function(t,e){var i=this.columnsList;i.disabled||(_.isUndefined(void 0)&&(e=t),e.keyCode==Common.UI.Keys.SPACE?(e.preventDefault(),e.stopPropagation(),this.updateCellCheck(i,i.getSelectedRec())):Common.UI.DataView.prototype.onKeyDown.call(this.columnsList,t,e))},updateCellCheck:function(t,e){if(e&&t){var i=t.store,n=!e.get("check");if("0"==e.get("groupid"))i.each((function(t){t.set("check",n)}));else{e.set("check",n);for(var o=n,s=0;s<i.length;s++){var a=i.at(s);if("1"==a.get("groupid")&&a.get("check")!==n){o="indeterminate";break}}this.checkCellTrigerBlock=!0,i.at(0).set("check",o),this.checkCellTrigerBlock=void 0}t.scroller.update({minScrollbarLength:t.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0})}},getFocusedComponents:function(){return[this.chHeaders,this.columnsList]},getDefaultFocusableComponent:function(){return this.columnsList},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){t&&(this.chHeaders.setValue(!!t.asc_getHasHeaders(),!0),this.updateColumnsList())},getSettings:function(){var t=this.columnsList.store,e=this.props.asc_getColumnList();return t.each((function(t,i){"1"==t.get("groupid")&&e[i-1].asc_setVisible(t.get("check"))})),this.props},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onDblClickFormat:function(){this._handleInput("ok")},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,t,"ok"==t?this.getSettings():this.props),this.close()},txtTitle:"Remove Duplicates",textDescription:"To delete duplicate values, select one or more columns that contain duplicates.",textHeaders:"My data has headers",textColumns:"Columns",textSelectAll:"Select All"},SSE.Views.RemoveDuplicatesDialog||{}))})),define("text!spreadsheeteditor/main/app/template/DataValidationDialog.template",[],(function(){return'<div id="id-data-validation-settings" class="settings-panel active" style="height: 100%;">\n    <div class="inner-content" style="height: 100%;">\n        <table cols="2" style="width: 100%;height: 100%;">\n            <tr>\n                <td class="padding-small" style="padding-right: 5px;">\n                    <label class="input-label"><%= scope.textAllow %></label>\n                    <div id="data-validation-cmb-allow"></div>\n                </td>\n                <td class="padding-small" style="padding-left: 5px;">\n                    <label class="input-label"><%= scope.textData %></label>\n                    <div id="data-validation-cmb-data"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=2 class="padding-small">\n                    <div id="data-validation-ch-ignore"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small" style="padding-right: 5px;">\n                    <label id="data-validation-label-min" class="input-label"><%= scope.textMin %></label>\n                    <div id="data-validation-txt-min"></div>\n                </td>\n                <td class="padding-small" style="padding-left: 5px;">\n                    <label id="data-validation-label-max" class="input-label"><%= scope.textMax %></label>\n                    <div id="data-validation-txt-max"></div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=2 class="padding-small">\n                    <div id="data-validation-ch-show-dropdown"></div>\n                </td>\n            </tr>\n            <tr class="data-source">\n                <td colspan=2 class="padding-small">\n                    <label id="data-validation-label-source" class="input-label"><%= scope.textSource %></label>\n                    <div id="data-validation-txt-source"></div>\n                </td>\n            </tr>\n            <tr style="height: 100%;vertical-align: bottom;">\n                <td colspan=2 style="padding-bottom: 20px;">\n                    <div id="data-validation-ch-apply"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-data-validation-input" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small">\n                    <div id="data-validation-ch-show-input"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label><%= scope.textCellSelected %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label class="input-label"><%= scope.textTitle %></label>\n                    <div id="data-validation-input-title"></div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label class="input-label"><%= scope.textInput %></label>\n                    <div id="data-validation-input-msg"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n<div id="id-data-validation-error" class="settings-panel">\n    <div class="inner-content">\n        <table cols="1" style="width: 100%;">\n            <tr>\n                <td class="padding-small">\n                    <div id="data-validation-ch-show-error"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <label><%= scope.textUserEnters %></label>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-small">\n                    <div style="display: inline-block; margin-right: 5px;vertical-align: bottom;">\n                        <div id="data-validation-img-style" class="icon  error" style="margin-bottom: -1px;"></div>\n                    </div>\n                    <div style="display: inline-block;">\n                        <label class="input-label"><%= scope.textStyle %></label>\n                        <div id="data-validation-cmb-style"></div>\n                    </div>\n                    <div style="float: right;">\n                        <label class="input-label"><%= scope.textTitle %></label>\n                        <div id="data-validation-error-title"></div>\n                    </div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <label class="input-label"><%= scope.textError %></label>\n                    <div id="data-validation-error-msg"></div>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n'})),void 0===Common)var Common={};if(define("common/main/lib/component/TextareaField",["common/main/lib/component/BaseView","common/main/lib/component/Tooltip"],(function(){"use strict";Common.UI.TextareaField=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",value:"",maxlength:void 0,placeHolder:"",spellcheck:!1,disabled:!1},template:_.template(['<div class="textarea-field" style="<%= style %>">',"<textarea ",'spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ',"<% if (dataHint) {%>",'data-hint="<%= dataHint %>" ',"<% } %>","<% if (dataHintDirection) {%>",'data-hint-direction="<%= dataHintDirection %>" ',"<% } %>","<% if (dataHintOffset) {%>",'data-hint-offset="<%= dataHintOffset %>" ',"<% } %>","></textarea>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.value=e.options.value,this.placeHolder=e.options.placeHolder,this.template=e.options.template||e.template,this.disabled=e.options.disabled,this.spellcheck=e.options.spellcheck,this.maxLength=e.options.maxLength,e.rendered=e.options.rendered||!1,e.options.el&&e.render()},render:function(t){var e=this;return e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,placeHolder:this.placeHolder,spellcheck:this.spellcheck,dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),e.rendered||(this.cmpEl,this._input=this.cmpEl.find("textarea").addBack().filter("textarea"),this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength),this.disabled&&this.setDisabled(this.disabled)),e.rendered=!0,this},_doChange:function(t,e){if(!e||!e.synthetic){var i=$(t.target).val(),n=this.value;this.trigger("changed:before",this,i,n,t),t.isDefaultPrevented()||(this.value=i,this.trigger("changed:after",this,i,n,t))}},onInputChanged:function(t,e){this._doChange(t,e)},onKeyDown:function(t){this.trigger("keydown:before",this,t),t.isDefaultPrevented()||(t.keyCode===Common.UI.Keys.RETURN&&t.stopPropagation(),t.keyCode==Common.UI.Keys.ESC&&this.setValue(this.value),t.keyCode==Common.UI.Keys.ESC&&this.trigger("inputleave",this))},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled")},isDisabled:function(){return this.disabled},setValue:function(t){this.value=t,this.rendered&&this._input.val(t)},getValue:function(){return this.value},focus:function(){this._input.focus()}})})),define("spreadsheeteditor/main/app/view/DataValidationDialog",["text!spreadsheeteditor/main/app/template/DataValidationDialog.template","common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/ComboBox","common/main/lib/component/CheckBox","common/main/lib/component/TextareaField","common/main/lib/view/AdvancedSettingsWindow"],(function(t){"use strict";SSE.Views.DataValidationDialog=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:320,height:330,toggleGroup:"data-validation-group",storageName:"sse-data-validation-category"},initialize:function(e){_.extend(this.options,{title:this.options.title,items:[{panelId:"id-data-validation-settings",panelCaption:this.strSettings},{panelId:"id-data-validation-input",panelCaption:this.strInput},{panelId:"id-data-validation-error",panelCaption:this.strError}],contentTemplate:_.template(t)({scope:this})},e),this.api=e.api,this.handler=e.handler,this.props=e.props,this._noApply=!0,Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var t=this,e=this.getChild();this.cmbAllow=new Common.UI.ComboBox({el:e.find("#data-validation-cmb-allow"),cls:"input-group-nr",editable:!1,data:[{value:Asc.c_oAscEDataValidationType.None,displayValue:this.txtAny},{value:Asc.c_oAscEDataValidationType.Whole,displayValue:this.txtWhole},{value:Asc.c_oAscEDataValidationType.Decimal,displayValue:this.txtDecimal},{value:Asc.c_oAscEDataValidationType.List,displayValue:this.txtList},{value:Asc.c_oAscEDataValidationType.Date,displayValue:this.txtDate},{value:Asc.c_oAscEDataValidationType.Time,displayValue:this.txtTime},{value:Asc.c_oAscEDataValidationType.TextLength,displayValue:this.txtTextLength},{value:Asc.c_oAscEDataValidationType.Custom,displayValue:this.txtOther}],style:"width: 100%;",menuStyle:"min-width: 100%;",takeFocusOnClose:!0}),this.cmbAllow.setValue(Asc.c_oAscEDataValidationType.None),this.cmbAllow.on("selected",_.bind(this.onAllowSelect,this)),this.cmbData=new Common.UI.ComboBox({el:e.find("#data-validation-cmb-data"),cls:"input-group-nr",editable:!1,data:[{value:Asc.EDataValidationOperator.Between,displayValue:this.txtBetween},{value:Asc.EDataValidationOperator.NotBetween,displayValue:this.txtNotBetween},{value:Asc.EDataValidationOperator.Equal,displayValue:this.txtEqual},{value:Asc.EDataValidationOperator.NotEqual,displayValue:this.txtNotEqual},{value:Asc.EDataValidationOperator.GreaterThan,displayValue:this.txtGreaterThan},{value:Asc.EDataValidationOperator.LessThan,displayValue:this.txtLessThan},{value:Asc.EDataValidationOperator.GreaterThanOrEqual,displayValue:this.txtGreaterThanOrEqual},{value:Asc.EDataValidationOperator.LessThanOrEqual,displayValue:this.txtLessThanOrEqual}],style:"width: 100%;",menuStyle:"min-width: 100%;",takeFocusOnClose:!0}),this.cmbData.setValue(Asc.EDataValidationOperator.Between),this.cmbData.on("selected",_.bind(this.onDataSelect,this)),this.chIgnore=new Common.UI.CheckBox({el:e.find("#data-validation-ch-ignore"),labelText:this.textIgnore,value:!0}),this.chIgnore.on("change",_.bind(this.onIgnoreChange,this)),this.lblRangeMin=e.find("#data-validation-label-min"),this.inputRangeMin=new Common.UI.InputFieldBtn({el:e.find("#data-validation-txt-min"),style:"100%",btnHint:this.textSelectData,validateOnBlur:!1}).on("changed:after",_.bind(this.onRangeChange,this,1)).on("button:click",_.bind(this.onSelectData,this,1)),this.lblRangeMax=e.find("#data-validation-label-max"),this.inputRangeMax=new Common.UI.InputFieldBtn({el:e.find("#data-validation-txt-max"),style:"100%",btnHint:this.textSelectData,validateOnBlur:!1}).on("changed:after",_.bind(this.onRangeChange,this,2)).on("button:click",_.bind(this.onSelectData,this,2)),this.chShowDropDown=new Common.UI.CheckBox({el:e.find("#data-validation-ch-show-dropdown"),labelText:this.textShowDropDown,value:!0}),this.chShowDropDown.on("change",_.bind(this.onDropDownChange,this)),this.lblRangeSource=e.find("#data-validation-label-source"),this.inputRangeSource=new Common.UI.InputFieldBtn({el:e.find("#data-validation-txt-source"),style:"100%",btnHint:this.textSelectData,validateOnBlur:!1}).on("changed:after",_.bind(this.onRangeChange,this,3)).on("button:click",_.bind(this.onSelectData,this,3)),this.chApply=new Common.UI.CheckBox({el:e.find("#data-validation-ch-apply"),labelText:this.textApply,disabled:!0}),this.chApply.on("change",_.bind(this.onApplyChange,this)),this.chShowInput=new Common.UI.CheckBox({el:e.find("#data-validation-ch-show-input"),labelText:this.textShowInput,value:!0}),this.chShowInput.on("change",_.bind(this.onShowInputChange,this)),this.inputInputTitle=new Common.UI.InputField({el:e.find("#data-validation-input-title"),allowBlank:!0,validateOnBlur:!1,maxLength:32,style:"width: 100%;"}).on("changed:after",(function(){t.isInputTitleChanged=!0})),this.textareaInput=new Common.UI.TextareaField({el:e.find("#data-validation-input-msg"),style:"width: 100%; height: 70px;",maxLength:255,value:""}),this.textareaInput.on("changed:after",(function(){t.isInputChanged=!0})),this.chShowError=new Common.UI.CheckBox({el:e.find("#data-validation-ch-show-error"),labelText:this.textShowError,value:!0}),this.chShowError.on("change",_.bind(this.onShowErrorChange,this)),this.cmbStyle=new Common.UI.ComboBox({el:e.find("#data-validation-cmb-style"),cls:"input-group-nr",editable:!1,data:[{value:Asc.c_oAscEDataValidationErrorStyle.Stop,clsText:"error",displayValue:this.textStop},{value:Asc.c_oAscEDataValidationErrorStyle.Warning,clsText:"warn",displayValue:this.textAlert},{value:Asc.c_oAscEDataValidationErrorStyle.Information,clsText:"info",displayValue:this.textMessage}],style:"width: 110px;",menuStyle:"min-width: 110px;",takeFocusOnClose:!0}),this.cmbStyle.setValue(Asc.c_oAscEDataValidationErrorStyle.Stop),this.cmbStyle.on("selected",_.bind(this.onStyleSelect,this)),this.inputErrorTitle=new Common.UI.InputField({el:e.find("#data-validation-error-title"),allowBlank:!0,validateOnBlur:!1,maxLength:32,style:"width: 140px;"}).on("changed:after",(function(){t.isErrorTitleChanged=!0})),this.textareaError=new Common.UI.TextareaField({el:e.find("#data-validation-error-msg"),style:"width: 100%; height: 70px;",maxLength:255,value:""}),this.textareaError.on("changed:after",(function(){t.isErrorChanged=!0})),this.minMaxTr=e.find("#data-validation-txt-min").closest("tr"),this.sourceTr=e.find("#data-validation-txt-source").closest("tr"),this.dropdownTr=e.find("#data-validation-ch-show-dropdown").closest("tr"),this.errorIcon=e.find("#data-validation-img-style"),this.afterRender()},afterRender:function(){if(this._setDefaults(this.props),this.storageName){var t=Common.localStorage.getItem(this.storageName);this.setActiveCategory(null!==t?parseInt(t):0)}},getFocusedComponents:function(){return[this.cmbAllow,this.cmbData,this.chIgnore,this.chShowDropDown,this.inputRangeSource,this.inputRangeMin,this.inputRangeMax,this.chApply,this.chShowInput,this.inputInputTitle,this.textareaInput,this.chShowError,this.cmbStyle,this.inputErrorTitle,this.textareaError]},onCategoryClick:function(t,e){Common.Views.AdvancedSettingsWindow.prototype.onCategoryClick.call(this,t,e);var i=this;setTimeout((function(){switch(e){case 0:i.cmbAllow.focus();break;case 1:i.inputInputTitle.isDisabled()?i.chShowInput.focus():i.inputInputTitle.focus();break;case 2:i.cmbStyle.isDisabled()?i.chShowError.focus():i.cmbStyle.focus()}}),10)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments)},onSelectData:function(t,e){var i=this;if(i.api){var n=new SSE.Views.CellRangeDialog({handler:function(n,o){if("ok"==o){var s=n.getSettings();e.setValue(s),i.onRangeChange(t,e,s)}}}).on("close",(function(){i.show(),setTimeout((function(){i._noApply=!0,e.focus(),i._noApply=!1}),1)})),o=i.$window.offset();i.hide(),n.show(o.left+160,o.top+125),n.setSettings({api:i.api,range:e.getValue(),type:Asc.c_oAscSelectionDialogType.DataValidation,validation:function(){return!0}})}},onRangeChange:function(t,e,i,n,o){i!=n&&(this._noApply||(1==t||3==t?(this.props.asc_getFormula1()||this.props.asc_setFormula1(new Asc.CDataFormula),this.props.asc_getFormula1().asc_setValue(i)):2==t&&(this.props.asc_getFormula2()||this.props.asc_setFormula2(new Asc.CDataFormula),this.props.asc_getFormula2().asc_setValue(i))))},onAllowSelect:function(t,e){this.ShowHideElem(),this._noApply||this.props.asc_setType(e.value),this.inputRangeMin.setValue(this.props.asc_getFormula1()&&this.props.asc_getFormula1().asc_getValue()||""),this.inputRangeSource.setValue(this.props.asc_getFormula1()&&this.props.asc_getFormula1().asc_getValue()||""),this.inputRangeMax.setValue(this.props.asc_getFormula2()&&this.props.asc_getFormula2().asc_getValue()||"")},onDataSelect:function(t,e){this.ShowHideElem(),this._noApply||this.props.asc_setOperator(e.value),this.inputRangeMin.setValue(this.props.asc_getFormula1()&&this.props.asc_getFormula1().asc_getValue()||""),this.inputRangeSource.setValue(this.props.asc_getFormula1()&&this.props.asc_getFormula1().asc_getValue()||""),this.inputRangeMax.setValue(this.props.asc_getFormula2()&&this.props.asc_getFormula2().asc_getValue()||"")},onStyleSelect:function(t,e){this.errorIcon.removeClass("error warn info"),this.errorIcon.addClass(e.clsText),this._noApply||this.props.asc_setErrorStyle(e.value)},onIgnoreChange:function(t,e,i,n){this._noApply||this.props.asc_setAllowBlank("checked"==t.getValue())},onDropDownChange:function(t,e,i,n){this._noApply||this.props.asc_setShowDropDown("checked"!==t.getValue())},onShowInputChange:function(t,e,i,n){var o="checked"==t.getValue();this.inputInputTitle.setDisabled(!o),this.textareaInput.setDisabled(!o),this.api&&!this._noApply&&this.props.asc_setShowInputMessage("checked"==t.getValue())},onShowErrorChange:function(t,e,i,n){var o="checked"==t.getValue();this.inputErrorTitle.setDisabled(!o),this.cmbStyle.setDisabled(!o),this.textareaError.setDisabled(!o),this.api&&!this._noApply&&this.props.asc_setShowErrorMessage("checked"==t.getValue())},onApplyChange:function(t,e,i,n){this.api&&!this._noApply&&this.api.asc_setDataValidation(this.getSettings(),"checked"==t.getValue())},_setDefaults:function(t){if(this._noApply=!0,t){var e=t.asc_getAllowBlank();this.chIgnore.setValue(e,!0),e=t.asc_getShowDropDown(),this.chShowDropDown.setValue(!e,!0),e=t.asc_getType(),this.cmbAllow.setValue(null!==e?e:Asc.c_oAscEDataValidationType.None,!0),this.chApply.setDisabled(e===Asc.c_oAscEDataValidationType.None),e=t.asc_getOperator(),this.cmbData.setValue(null!==e?e:Asc.EDataValidationOperator.Between,!0),this.inputRangeMin.setValue(t.asc_getFormula1()&&t.asc_getFormula1().asc_getValue()||""),this.inputRangeSource.setValue(t.asc_getFormula1()&&t.asc_getFormula1().asc_getValue()||""),this.inputRangeMax.setValue(t.asc_getFormula2()&&t.asc_getFormula2().asc_getValue()||""),this.chShowInput.setValue(!!t.asc_getShowInputMessage()),this.inputInputTitle.setValue(t.asc_getPromptTitle()||""),this.textareaInput.setValue(t.asc_getPrompt()||""),this.chShowError.setValue(!!t.asc_getShowErrorMessage()),this.inputErrorTitle.setValue(t.asc_getErrorTitle()||""),this.textareaError.setValue(t.asc_getError()||""),e=t.asc_getErrorStyle(),this.cmbStyle.setValue(null!==e?e:Asc.EDataValidationErrorStyle.Stop);var i=this.cmbStyle.getSelectedRecord();i&&(this.errorIcon.removeClass("error warn info"),this.errorIcon.addClass(i.clsText))}this.ShowHideElem(),this._noApply=!1},getSettings:function(){return this.isInputTitleChanged&&this.props.asc_setPromptTitle(this.inputInputTitle.getValue()),this.isInputChanged&&this.props.asc_setPrompt(this.textareaInput.getValue()),this.isErrorTitleChanged&&this.props.asc_setErrorTitle(this.inputErrorTitle.getValue()),this.isErrorChanged&&this.props.asc_setError(this.textareaError.getValue()),this.props},onDlgBtnClick:function(t){var e=this,i="object"==typeof t?t.currentTarget.attributes.result.value:t;"ok"==i?this.isRangeValid((function(){e.handler&&e.handler.call(e,i,"ok"==i?e.getSettings():void 0),e.close()})):this.close()},onPrimary:function(){return this.onDlgBtnClick("ok"),!1},ShowHideElem:function(){var t=this.cmbAllow.getValue(),e=this.cmbData.getValue(),i=e==Asc.EDataValidationOperator.Between||e==Asc.EDataValidationOperator.NotBetween,n=t==Asc.c_oAscEDataValidationType.Custom||t==Asc.c_oAscEDataValidationType.List;this.minMaxTr.toggleClass("hidden",t==Asc.c_oAscEDataValidationType.None||n||!i),this._isMinMaxVisible=!(t==Asc.c_oAscEDataValidationType.None||n||!i),this.sourceTr.toggleClass("hidden",t==Asc.c_oAscEDataValidationType.None||!n&&i),this.dropdownTr.toggleClass("hidden",t!=Asc.c_oAscEDataValidationType.List),this.chIgnore.setDisabled(t===Asc.c_oAscEDataValidationType.None),this.cmbData.setDisabled(t===Asc.c_oAscEDataValidationType.None||t===Asc.c_oAscEDataValidationType.Custom||t===Asc.c_oAscEDataValidationType.List);var o=this.textSource;t==Asc.c_oAscEDataValidationType.List?o=this.textSource:t==Asc.c_oAscEDataValidationType.Custom?o=this.textFormula:e==Asc.EDataValidationOperator.Equal||e==Asc.EDataValidationOperator.NotEqual?o=t==Asc.c_oAscEDataValidationType.Date?this.txtDate:t==Asc.c_oAscEDataValidationType.TextLength?this.txtLength:t==Asc.c_oAscEDataValidationType.Time?this.txtElTime:this.textCompare:e==Asc.EDataValidationOperator.GreaterThan||e==Asc.EDataValidationOperator.GreaterThanOrEqual?o=t==Asc.c_oAscEDataValidationType.Date?this.txtStartDate:t==Asc.c_oAscEDataValidationType.Time?this.txtStartTime:this.textMin:e!=Asc.EDataValidationOperator.LessThan&&e!=Asc.EDataValidationOperator.LessThanOrEqual||(o=t==Asc.c_oAscEDataValidationType.Date?this.txtEndDate:t==Asc.c_oAscEDataValidationType.Time?this.txtEndTime:this.textMax),this.lblRangeSource.text(o);var s=this.textMin,a=this.textMax;t==Asc.c_oAscEDataValidationType.Date?(s=this.txtStartDate,a=this.txtEndDate):t==Asc.c_oAscEDataValidationType.Time&&(s=this.txtStartTime,a=this.txtEndTime),this.lblRangeMin.text(s),this.lblRangeMax.text(a)},isRangeValid:function(t){var e=this,i=Asc.c_oAscError.ID.No,n=this.cmbAllow.getValue();if(n!==Asc.c_oAscEDataValidationType.None){var o,s,a,l=this._isMinMaxVisible,r=function(i){switch(i===Asc.c_oAscError.ID.No&&(i=e.props.asc_checkValid())!==Asc.c_oAscError.ID.No&&(o=l?e.inputRangeMin:e.inputRangeSource),i){case Asc.c_oAscError.ID.DataValidateNotNumeric:a=Common.Utils.String.format(e.errorNotNumeric,s.text());break;case Asc.c_oAscError.ID.DataValidateNegativeTextLength:a=Common.Utils.String.format(e.errorNegativeTextLength,e.cmbAllow.getDisplayValue(e.cmbAllow.getSelectedRecord()));break;case Asc.c_oAscError.ID.DataValidateMustEnterValue:a=l?Common.Utils.String.format(e.errorMustEnterBothValues,e.lblRangeMin.text(),e.lblRangeMax.text()):Common.Utils.String.format(e.errorMustEnterValue,e.lblRangeSource.text());break;case Asc.c_oAscError.ID.DataValidateMinGreaterMax:a=Common.Utils.String.format(e.errorMinGreaterMax,e.lblRangeMin.text(),e.lblRangeMax.text());break;case Asc.c_oAscError.ID.DataValidateInvalid:a=Common.Utils.String.format(n==Asc.c_oAscEDataValidationType.Time?e.errorInvalidTime:n==Asc.c_oAscEDataValidationType.Date?e.errorInvalidDate:e.errorInvalid,s.text());break;case Asc.c_oAscError.ID.NamedRangeNotFound:a=e.errorNamedRange;break;case Asc.c_oAscError.ID.DataValidateInvalidList:a=e.errorInvalidList}a&&Common.UI.warning({msg:a,maxwidth:600,callback:function(t){o.focus()}}),i===Asc.c_oAscError.ID.No&&t.call(e)},c=function(t){e._isMinMaxVisible&&t===Asc.c_oAscError.ID.No?((t=e.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.DataValidation,e.props.asc_getFormula2()?e.props.asc_getFormula2().asc_getValue():null,!0,void 0,n))!==Asc.c_oAscError.ID.No&&(o=e.inputRangeMax,s=e.lblRangeMax),t===Asc.c_oAscError.ID.FormulaEvaluateError?Common.UI.warning({msg:e.errorFormula,maxwidth:600,buttons:["yes","no"],primary:"yes",callback:function(t){"yes"==t?r(Asc.c_oAscError.ID.No):o.focus()}}):r(t)):r(t)};(i=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.DataValidation,this.props.asc_getFormula1()?this.props.asc_getFormula1().asc_getValue():null,!0,void 0,n))!==Asc.c_oAscError.ID.No&&(o=l?e.inputRangeMin:e.inputRangeSource,s=l?e.lblRangeMin:e.lblRangeSource),i===Asc.c_oAscError.ID.FormulaEvaluateError?Common.UI.warning({msg:this.errorFormula,maxwidth:600,buttons:["yes","no"],primary:"yes",callback:function(t){"yes"==t?c(Asc.c_oAscError.ID.No):o.focus()}}):c(i)}else t.call(e)},strSettings:"Settings",strInput:"Input Message",strError:"Error Alert",textAllow:"Allow",textData:"Data",textMin:"Minimum",textMax:"Maximum",textCompare:"Compare to",textSource:"Source",textStartDate:"Start Date",textEndDate:"End Date",textStartTime:"Start Time",textEndTime:"End Time",textFormula:"Formula",textIgnore:"Ignore blank",textApply:"Apply these changes to all other cells with the same settings",textShowDropDown:"Show drop-down list in cell",textCellSelected:"When cell is selected, show this input message",textTitle:"Title",textInput:"Input Message",textUserEnters:"When user enters invalid data, show this error alert",textStyle:"Style",textError:"Error Message",textShowInput:"Show input message when cell is selected",textShowError:"Show error alert after invalid data is entered",txtBetween:"between",txtNotBetween:"not between",txtEqual:"equals",txtNotEqual:"does not equal",txtLessThan:"less than",txtGreaterThan:"greater than",txtLessThanOrEqual:"less than or equal to",txtGreaterThanOrEqual:"greater than or equal to",txtAny:"Any value",txtWhole:"Whole number",txtDecimal:"Decimal",txtList:"List",txtDate:"Date",txtTime:"Time",txtTextLength:"Text length",txtLength:"Length",txtOther:"Other",txtElTime:"Elapsed time",txtStartDate:"Start date",txtStartTime:"Start time",txtEndDate:"End date",txtEndTime:"End time",textStop:"Stop",textAlert:"Alert",textMessage:"Message",textSelectData:"Select data",errorMustEnterBothValues:'You must enter a value in both field "{0}" and field "{1}".',errorMustEnterValue:'You must enter a value in field "{0}".',errorInvalidDate:'The date you entered for the field "{0}" is invalid.',errorInvalidTime:'The time you entered for the field "{0}" is invalid.',errorInvalid:'The value you entered for the field "{0}" is invalid.',errorNotNumeric:'The field "{0}" must be a numeric value, numeric expression, or refer to a cell containing a numeric value.',errorNegativeTextLength:'Negative values cannot be used in conditions "{0}".',errorMinGreaterMax:'The "{1}" field must be greater than or equal to the "{0}" field.',errorFormula:"The value currently evaluates to an error. Do you want to continue?",errorNamedRange:"A named range you specified cannot be found.",errorInvalidList:"The list source must be a delimited list, or a reference to single row or column."},SSE.Views.DataValidationDialog||{}))})),define("spreadsheeteditor/main/app/controller/DataTab",["core","spreadsheeteditor/main/app/view/DataTab","spreadsheeteditor/main/app/view/SortDialog","spreadsheeteditor/main/app/view/RemoveDuplicatesDialog","spreadsheeteditor/main/app/view/DataValidationDialog","common/main/lib/view/OptionsDialog"],(function(){"use strict";SSE.Controllers.DataTab=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["DataTab"],sdkViewName:"#id_main",initialize:function(){this._state={CSVOptions:new Asc.asc_CTextOptions(0,4,"")}},onLaunch:function(){},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onChangeProtectWorkbook",_.bind(this.onChangeProtectWorkbook,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this)),Common.NotificationCenter.on("document:ready",_.bind(this.onDocumentReady,this))),this},setConfig:function(t){this.toolbar=t.toolbar,this.view=this.createView("DataTab",{toolbar:this.toolbar.toolbar}),this.addListeners({DataTab:{"data:group":this.onGroup,"data:ungroup":this.onUngroup,"data:tocolumns":this.onTextToColumn,"data:show":this.onShowClick,"data:hide":this.onHideClick,"data:groupsettings":this.onGroupSettings,"data:sortcustom":this.onCustomSort,"data:remduplicates":this.onRemoveDuplicates,"data:datavalidation":this.onDataValidation,"data:fromtext":this.onDataFromText},Statusbar:{"sheet:changed":this.onApiSheetChanged}}),Common.NotificationCenter.on("data:remduplicates",_.bind(this.onRemoveDuplicates,this)),Common.NotificationCenter.on("data:sortcustom",_.bind(this.onCustomSort,this))},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onSelectionChanged:function(t){this.toolbar.editMode&&this.view&&(Common.Utils.lockControls(Common.enumLock.multiselectCols,t.asc_getSelectedColsCount()>1,{array:[this.view.btnTextToColumns]}),Common.Utils.lockControls(Common.enumLock.multiselect,t.asc_getMultiselect(),{array:[this.view.btnTextToColumns]}))},onUngroup:function(t){var e=this;if("rows"==t)void 0!==e.api.asc_checkAddGroup(!0)&&e.api.asc_ungroup(!0);else if("columns"==t)void 0!==e.api.asc_checkAddGroup(!0)&&e.api.asc_ungroup(!1);else if("clear"==t)e.api.asc_clearOutline();else{var i=e.api.asc_checkAddGroup(!0);null===i?new Common.Views.OptionsDialog({title:e.view.capBtnUngroup,items:[{caption:this.textRows,value:!0,checked:!0},{caption:this.textColumns,value:!1,checked:!1}],handler:function(t,i){"ok"==i&&e.api.asc_ungroup(t.getSettings()),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show():void 0!==i&&e.api.asc_ungroup(i)}Common.NotificationCenter.trigger("edit:complete",e.toolbar)},onGroup:function(t,e){if("rows"==t)void 0!==this.api.asc_checkAddGroup()&&this.api.asc_group(!0);else if("columns"==t)void 0!==this.api.asc_checkAddGroup()&&this.api.asc_group(!1);else if("below"==t)this.api.asc_setGroupSummary(e,!1);else if("right"==t)this.api.asc_setGroupSummary(e,!0);else{var i=this,n=i.api.asc_checkAddGroup();null===n?new Common.Views.OptionsDialog({title:i.view.capBtnGroup,items:[{caption:this.textRows,value:!0,checked:!0},{caption:this.textColumns,value:!1,checked:!1}],handler:function(t,e){"ok"==e&&i.api.asc_group(t.getSettings()),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show():void 0!==n&&i.api.asc_group(n)}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onGroupSettings:function(t){var e=this.api.asc_getGroupSummaryBelow();t.items[3].setChecked(!!e,!0),e=this.api.asc_getGroupSummaryRight(),t.items[4].setChecked(!!e,!0)},onTextToColumn:function(){this.api.asc_TextImport(this._state.CSVOptions,_.bind(this.onTextToColumnCallback,this),!1)},onTextToColumnCallback:function(t){if(t&&t.length){var e=this;new Common.Views.OpenDialog({title:e.textWizard,closable:!0,type:Common.Utils.importTextType.Columns,preview:!0,previewData:t,settings:e._state.CSVOptions,api:e.api,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_TextToColumns(i.textOptions)}}).show()}},onDataFromText:function(t){var e=this;"file"===t?(this.api&&this.api.asc_TextFromFileOrUrl(this._state.CSVOptions,_.bind(this.onDataFromTextCallback,this)),Common.NotificationCenter.trigger("edit:complete",this.toolbar)):"url"===t&&new Common.Views.ImageFromUrlDialog({title:e.txtUrlTitle,handler:function(t,i){if("ok"==t){if(e.api){var n=i.replace(/\s/g,"");_.isEmpty(n)?Common.UI.warning({msg:e.textEmptyUrl}):e.api.asc_TextFromFileOrUrl(e._state.CSVOptions,_.bind(e.onDataFromTextCallback,e),n)}Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}}).show()},onDataFromTextCallback:function(t){var e=this;new Common.Views.OpenDialog({title:e.txtImportWizard,closable:!0,type:Common.Utils.importTextType.Data,preview:t.asc_getData(),settings:t?t.asc_getRecommendedSettings():e._state.CSVOptions,codepages:t?t.asc_getCodePages():null,api:e.api,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_TextToColumns(i.textOptions,i.data,i.range)}}).show()},onShowClick:function(){this.api.asc_changeGroupDetails(!0)},onHideClick:function(){this.api.asc_changeGroupDetails(!1)},onCustomSort:function(){Common.NotificationCenter.trigger("protect:check",this.onCustomSortCallback,this)},onCustomSortCallback:function(){var t=this;if(this.api){var e=this.api.asc_sortCellsRangeExpand();switch(e){case Asc.c_oAscSelectionSortExpand.showExpandMessage:var i={width:500,title:this.toolbar.txtSorting,msg:this.toolbar.txtExpandSort,buttons:[{caption:this.toolbar.txtExpand,primary:!0,value:"expand"},{caption:this.toolbar.txtSortSelected,primary:!0,value:"sort"},"cancel"],callback:function(e){"expand"!=e&&"sort"!=e||setTimeout((function(){t.showCustomSort("expand"==e)}),1)}};Common.UI.alert(i);break;case Asc.c_oAscSelectionSortExpand.showLockMessage:i={width:500,title:this.toolbar.txtSorting,msg:this.toolbar.txtLockSort,buttons:["yes","no"],primary:"yes",callback:function(e){"yes"==e&&setTimeout((function(){t.showCustomSort(!1)}),1)}};Common.UI.alert(i);break;case Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage:case Asc.c_oAscSelectionSortExpand.notExpandAndNotShowMessage:t.showCustomSort(e===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage)}}},showCustomSort:function(t){var e=this,i=e.api.asc_getSortProps(t);i&&new SSE.Views.SortDialog({props:i,api:e.api,handler:function(t,i){e&&e.api&&e.api.asc_setSortProps(i,"ok"!=t)}}).show()},onRemoveDuplicates:function(){var t=this;if(this.api){var e=this.api.asc_sortCellsRangeExpand();if(e===Asc.c_oAscSelectionSortExpand.showExpandMessage){var i={width:500,title:this.txtRemDuplicates,msg:this.txtExpandRemDuplicates,buttons:[{caption:this.txtExpand,primary:!0,value:"expand"},{caption:this.txtRemSelected,primary:!0,value:"remove"},"cancel"],callback:function(e){"expand"!=e&&"remove"!=e||setTimeout((function(){t.showRemDuplicates("expand"==e)}),1)}};Common.UI.alert(i)}else e!==Asc.c_oAscSelectionSortExpand.showLockMessage&&t.showRemDuplicates(e===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage)}},showRemDuplicates:function(t){var e=this,i=e.api.asc_getRemoveDuplicates(t);i&&new SSE.Views.RemoveDuplicatesDialog({props:i,api:e.api,handler:function(t,i){e&&e.api&&e.api.asc_setRemoveDuplicates(i,"ok"!=t)}}).show()},onDataValidation:function(){var t=this;if(this.api){var e=this.api.asc_getDataValidationProps();if("object"!=typeof e){var i={maxwidth:500,title:this.txtDataValidation,msg:e===Asc.c_oAscError.ID.MoreOneTypeDataValidate?this.txtRemoveDataValidation:this.txtExtendDataValidation,buttons:e===Asc.c_oAscError.ID.MoreOneTypeDataValidate?["ok","cancel"]:["yes","no","cancel"],primary:e===Asc.c_oAscError.ID.MoreOneTypeDataValidate?"ok":["yes","no"],callback:function(e){"yes"!=e&&"no"!=e&&"ok"!=e||setTimeout((function(){var i=t.api.asc_getDataValidationProps("ok"==e?null:"yes"==e);t.showDataValidation(i)}),1)}};Common.UI.alert(i)}else t.showDataValidation(e)}},showDataValidation:function(t){var e=this;t&&new SSE.Views.DataValidationDialog({title:this.txtDataValidation,props:t,api:e.api,handler:function(t,i){e&&e.api&&"ok"==t&&e.api.asc_setDataValidation(i)}}).show()},onWorksheetLocked:function(t,e){t==this.api.asc_getActiveWorksheetIndex()&&Common.Utils.lockControls(Common.enumLock.sheetLock,e,{array:this.view.btnsSortDown.concat(this.view.btnsSortUp,this.view.btnCustomSort,this.view.btnGroup,this.view.btnUngroup)})},onChangeProtectWorkbook:function(){Common.Utils.lockControls(Common.enumLock.wbLock,this.api.asc_isProtectedWorkbook(),{array:[this.view.btnDataFromText]})},onApiSheetChanged:function(){if(this.toolbar.mode&&this.toolbar.mode.isEdit&&!this.toolbar.mode.isEditDiagram&&!this.toolbar.mode.isEditMailMerge&&!this.toolbar.mode.isEditOle){var t=this.api.asc_getActiveWorksheetIndex();this.onWorksheetLocked(t,this.api.asc_isWorksheetLockedOrDeleted(t))}},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&t.wsProps&&Common.Utils.lockControls(Common.enumLock.Sort,t.wsProps.Sort,{array:this.view.btnsSortDown.concat(this.view.btnsSortUp,this.view.btnCustomSort)})},onDocumentReady:function(){this.onChangeProtectSheet()},textWizard:"Text to Columns Wizard",txtRemDuplicates:"Remove Duplicates",txtExpandRemDuplicates:"The data next to the selection will not be removed. Do you want to expand the selection to include the adjacent data or continue with the currently selected cells only?",txtExpand:"Expand",txtRemSelected:"Remove in selected",textRows:"Rows",textColumns:"Columns",txtDataValidation:"Data Validation",txtExtendDataValidation:"The selection contains some cells without Data Validation settings.<br>Do you want to extend Data Validation to these cells?",txtRemoveDataValidation:"The selection contains more than one type of validation.<br>Erase current settings and continue?",textEmptyUrl:"You need to specify URL.",txtImportWizard:"Text Import Wizard",txtUrlTitle:"Paste a data URL"},SSE.Controllers.DataTab||{}))})),define("spreadsheeteditor/main/app/view/ViewTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(){"use strict";SSE.Views.ViewTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.canFeatureViews&&t.appConfig.isEdit&&(t.btnCloseView.on("click",(function(e,i){t.fireEvent("viewtab:openview",[{name:"default",value:"default"}])})),t.btnCreateView.on("click",(function(e,i){t.fireEvent("viewtab:createview")}))),t.btnFreezePanes&&t.btnFreezePanes.menu.on("item:click",(function(e,i,n){"shadow"===i.value?t.fireEvent("viewtab:freezeshadow",[i.checked]):t.fireEvent("viewtab:freeze",[i.value])})),this.chFormula.on("change",(function(e,i){t.fireEvent("viewtab:formula",[0,"checked"==i])})),this.chHeadings&&this.chHeadings.on("change",(function(e,i){t.fireEvent("viewtab:headings",[1,"checked"==i])})),this.chGridlines&&this.chGridlines.on("change",(function(e,i){t.fireEvent("viewtab:gridlines",[2,"checked"==i])})),this.chZeros&&this.chZeros.on("change",(function(e,i){t.fireEvent("viewtab:zeros",[3,"checked"==i])})),this.chToolbar.on("change",(function(e,i){t.fireEvent("viewtab:showtoolbar",[e,"checked"!==i])})),this.chStatusbar.on("change",(function(e,i){t.fireEvent("statusbar:setcompact",[e,"checked"===i])})),this.cmbZoom.on("selected",(function(e,i){t.fireEvent("zoom:selected",[e,i])})).on("changed:before",(function(e,i){t.fireEvent("zoom:changedbefore",[!0,e,i])})).on("changed:after",(function(e,i){t.fireEvent("zoom:changedafter",[!1,e,i])})).on("combo:blur",(function(){t.fireEvent("editcomplete",t)})).on("combo:focusin",_.bind(this.onComboOpen,this,!1)).on("show:after",_.bind(this.onComboOpen,this,!0))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.appConfig=t.mode,this.lockedControls=[];var e=this,i=Common.enumLock;e.appConfig.canFeatureViews&&e.appConfig.isEdit&&(this.btnSheetView=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-sheet-view",caption:e.capBtnSheetView,lock:[i.lostConnect,i.coAuth,i.editCell],menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnSheetView),this.btnCreateView=new Common.UI.Button({id:"id-toolbar-btn-createview",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sheet-view-new",caption:this.textCreate,lock:[i.coAuth,i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"big"}),this.lockedControls.push(this.btnCreateView),this.btnCloseView=new Common.UI.Button({id:"id-toolbar-btn-closeview",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sheet-view-close",caption:this.textClose,lock:[i.sheetView,i.coAuth,i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"big"}),this.lockedControls.push(this.btnCloseView)),e.appConfig.isEdit&&(this.btnFreezePanes=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-freeze-panes",caption:this.capBtnFreeze,menu:!0,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnFreezePanes),this.chHeadings=new Common.UI.CheckBox({labelText:this.textHeadings,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chHeadings),this.chGridlines=new Common.UI.CheckBox({labelText:this.textGridlines,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chGridlines),this.chZeros=new Common.UI.CheckBox({labelText:this.textZeros,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chZeros)),this.cmbZoom=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:e.tipFontSize,editable:!0,lock:[i.lostConnect,i.editCell],data:[{displayValue:"50%",value:50},{displayValue:"75%",value:75},{displayValue:"100%",value:100},{displayValue:"125%",value:125},{displayValue:"150%",value:150},{displayValue:"175%",value:175},{displayValue:"200%",value:200},{displayValue:"300%",value:300},{displayValue:"400%",value:400},{displayValue:"500%",value:500}],dataHint:"1",dataHintDirection:"top",dataHintOffset:"small"}),this.lockedControls.push(this.cmbZoom),this.btnInterfaceTheme=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon day",caption:this.textInterfaceTheme,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnInterfaceTheme),this.chFormula=new Common.UI.CheckBox({labelText:this.textFormula,value:!Common.localStorage.getBool("sse-hidden-formula"),lock:[i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chFormula),this.chStatusbar=new Common.UI.CheckBox({labelText:this.textCombineSheetAndStatusBars,value:Common.localStorage.getBool("sse-compact-statusbar",!0),lock:[i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chStatusbar),this.chToolbar=new Common.UI.CheckBox({labelText:this.textAlwaysShowToolbar,value:!t.compactToolbar,lock:[i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chToolbar),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return t&&t.html(this.getPanel()),this},getPanel:function(){this.$el=$(_.template('<section class="panel" data-tab="view"><div class="group sheet-views"><span class="btn-slot text x-huge" id="slot-btn-sheet-view"></span></div><div class="group sheet-views small"><div class="elset"><span class="btn-slot text" id="slot-createview"></span></div><div class="elset"><span class="btn-slot text" id="slot-closeview"></span></div></div><div class="separator long sheet-views"></div><div class="group small"><div class="elset" style="display: flex;"><span class="btn-slot" id="slot-field-zoom" style="flex-grow: 1;"></span></div><div class="elset" style="text-align: center;"><span class="btn-slot text" id="slot-lbl-zoom" style="font-size: 11px;text-align: center;margin-top: 4px;"></span></div></div><div class="separator long"></div><div class="group"><span class="btn-slot text x-huge" id="slot-btn-interface-theme"></span></div><div class="separator long separator-theme"></div><div class="group sheet-freeze"><span class="btn-slot text x-huge" id="slot-btn-freeze"></span></div><div class="separator long sheet-freeze"></div><div class="group small sheet-formula"><div class="elset"><span class="btn-slot text" id="slot-chk-formula"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-heading"></span></div></div><div class="group small sheet-gridlines"><div class="elset"><span class="btn-slot text" id="slot-chk-gridlines"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-zeros"></span></div></div><div class="separator long separator-formula"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-toolbar"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-statusbar"></span></div></div></section>')({}));var t=this.$el;return this.btnSheetView&&this.btnSheetView.render(t.find("#slot-btn-sheet-view")),this.btnCreateView&&this.btnCreateView.render(t.find("#slot-createview")),this.btnCloseView&&this.btnCloseView.render(t.find("#slot-closeview")),this.btnFreezePanes&&this.btnFreezePanes.render(t.find("#slot-btn-freeze")),this.cmbZoom.render(t.find("#slot-field-zoom")),this.cmbZoom.setValue(100),t.find("#slot-lbl-zoom").text(this.textZoom),this.btnInterfaceTheme.render(t.find("#slot-btn-interface-theme")),this.chFormula.render(t.find("#slot-chk-formula")),this.chStatusbar.render(t.find("#slot-chk-statusbar")),this.chToolbar.render(t.find("#slot-chk-toolbar")),this.chHeadings&&this.chHeadings.render(t.find("#slot-chk-heading")),this.chGridlines&&this.chGridlines.render(t.find("#slot-chk-gridlines")),this.chZeros&&this.chZeros.render(t.find("#slot-chk-zeros")),this.$el},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){if(e.canFeatureViews&&i.appConfig.isEdit?(i.btnSheetView.updateHint(i.tipSheetView),i.setButtonMenu(i.btnSheetView),i.btnCreateView.updateHint(i.tipCreate),i.btnCloseView.updateHint(i.tipClose)):(i.toolbar&&i.toolbar.$el.find(".group.sheet-views").hide(),i.toolbar&&i.toolbar.$el.find(".separator.sheet-views").hide()),i.btnInterfaceTheme.updateHint(i.tipInterfaceTheme),e.isEdit?(i.btnFreezePanes.setMenu(new Common.UI.Menu({items:[{caption:i.toolbar&&i.toolbar.api&&i.toolbar.api.asc_getSheetViewSettings().asc_getIsFreezePane()?i.textUnFreeze:i.capBtnFreeze,value:void 0},{caption:i.textFreezeRow,value:Asc.c_oAscFrozenPaneAddType.firstRow},{caption:i.textFreezeCol,value:Asc.c_oAscFrozenPaneAddType.firstCol},{caption:"--"},{caption:i.textShowFrozenPanesShadow,value:"shadow",checkable:!0,checked:Common.localStorage.getBool("sse-freeze-shadow",!0)}]})),i.btnFreezePanes.updateHint(i.tipFreeze)):(i.toolbar&&i.toolbar.$el.find(".group.sheet-freeze").hide(),i.toolbar&&i.toolbar.$el.find(".separator.sheet-freeze").hide(),i.toolbar&&i.toolbar.$el.find(".group.sheet-gridlines").hide()),Common.UI.Themes.available()||(i.btnInterfaceTheme.$el.closest(".group").remove(),i.$el.find(".separator-theme").remove()),(e.canBrandingExt&&e.customization&&!1===e.customization.statusBar||!Common.UI.LayoutManager.isElementVisible("statusBar"))&&(i.chStatusbar.$el.remove(),!e.isEdit)){var n=i.chFormula.$el,o=n.closest(".group");i.chToolbar.$el.closest(".group").find(".elset")[1].append(n[0]),o.remove(),i.$el.find(".separator-formula").remove()}if(Common.UI.Themes.available()){function s(){var t=this.btnInterfaceTheme;"object"==typeof t.menu?t.menu.removeAll():t.setMenu(new Common.UI.Menu);var e=Common.UI.Themes.currentThemeId()||Common.UI.Themes.defaultThemeId();for(var i in Common.UI.Themes.map())t.menu.addItem({value:i,caption:Common.UI.Themes.get(i).text,checked:i===e,checkable:!0,toggleGroup:"interface-theme"})}Common.NotificationCenter.on("uitheme:countchanged",s.bind(i)),s.call(i),i.btnInterfaceTheme.menu.items.length&&i.btnInterfaceTheme.menu.on("item:click",_.bind((function(t,e){var i=e.value;Common.UI.Themes.setTheme(i)}),i))}t.call(i)}))},setButtonMenu:function(t){var e=this,i=[{caption:e.textDefault,value:"default",checkable:!0,allowDepress:!1}];t.setMenu(new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-sheet-view-menu-" style="display: flex;" class="open"></div>')},{caption:"--"},{caption:e.textManager,value:"manager"}]})),t.menu.items[2].on("click",(function(t,i){e.fireEvent("viewtab:manager")})),t.menu.on("show:after",(function(t,e){t._innerMenu.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t._innerMenu&&t._innerMenu.cmpEl.focus()}),10)})).on("show:before",(function(t,i){e.fireEvent("viewtab:showview")}));var n=new Common.UI.Menu({maxHeight:300,cls:"internal-menu",items:i,outerMenu:{menu:t.menu,index:0}});n.render(t.menu.items[0].cmpEl.children(":first")),n.cmpEl.css({display:"block",position:"relative",left:0,top:0}),n.cmpEl.attr({tabindex:"-1"}),n.on("item:toggle",(function(t,i,n,o){n&&e.fireEvent("viewtab:openview",[{name:i.caption,value:i.value}])})),t.menu._innerMenu=n,t.menu.setInnerMenu([{menu:n,index:0}])},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return void 0===t?this.lockedControls:[]},SetDisabled:function(t){this.lockedControls&&this.lockedControls.forEach((function(e){e&&e.setDisabled(t)}),this)},onComboOpen:function(t,e){_.delay((function(){var i=$("input",e.cmpEl).select();t?i.focus():e.isMenuOpen()||i.one("mouseup",(function(t){t.preventDefault()}))}),10)},capBtnSheetView:"Sheet View",capBtnFreeze:"Freeze Panes",textZoom:"Zoom",tipSheetView:"Sheet view",textDefault:"Default",textManager:"View manager",tipFreeze:"Freeze panes",tipCreate:"Create sheet view",tipClose:"Close sheet view",textCreate:"New",textClose:"Close",textFormula:"Formula bar",textHeadings:"Headings",textGridlines:"Gridlines",textFreezeRow:"Freeze Top Row",textFreezeCol:"Freeze First Column",textUnFreeze:"Unfreeze Panes",textZeros:"Show zeros",textCombineSheetAndStatusBars:"Combine sheet and status bars",textAlwaysShowToolbar:"Always show toolbar",textInterfaceTheme:"Interface theme",textShowFrozenPanesShadow:"Show frozen panes shadow",tipInterfaceTheme:"Interface theme"}}(),SSE.Views.ViewTab||{}))})),define("common/main/lib/view/EditNameDialog",["common/main/lib/component/Window","common/main/lib/component/InputField"],(function(){"use strict";Common.Views.EditNameDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div class="input-row">',"<label>"+(this.options.label?this.options.label:this.textLabel)+"</label>","</div>",'<div id="id-dlg-label-caption" class="input-row"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputLabel=new Common.UI.InputField({el:$("#id-dlg-label-caption"),allowBlank:!1,blankError:t.options.error?t.options.error:t.textLabelError,style:"width: 100%;",validateOnBlur:!1,validation:t.options.validation||function(t){return!!t||""}}),t.inputLabel.setValue(this.options.value||""),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay((function(){t.getChild("input").focus()}),50)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputLabel.checkValidate())return void this.inputLabel.cmpEl.find("input").focus();this.options.handler.call(this,t,this.inputLabel.getValue())}this.close()},textLabel:"Label:",textLabelError:"Label must not be empty."},Common.Views.EditNameDialog||{}))})),define("spreadsheeteditor/main/app/view/ViewManagerDlg",["common/main/lib/view/EditNameDialog","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/ListView","common/main/lib/component/InputField"],(function(){"use strict";SSE.Views=SSE.Views||{},SSE.Views.ViewManagerDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"ViewManagerDlg",contentWidth:460,height:330,buttons:null},initialize:function(t){_.extend(this.options,{title:this.txtTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">','<div class="settings-panel active">','<div class="inner-content">','<table cols="1" style="width: 100%;">',"<tr>",'<td class="padding-small">','<label class="header">'+this.textViews+"</label>",'<div id="view-manager-list" class="range-tableview" style="width:440px; height: 166px;"></div>',"</td>","</tr>","<tr>",'<td class="padding-large">','<button type="button" class="btn btn-text-default auto" id="view-manager-btn-new" style="min-width: 80px;margin-right:5px;">'+this.textNew+"</button>",'<button type="button" class="btn btn-text-default auto" id="view-manager-btn-rename" style="min-width: 80px;margin-right:5px;">'+this.textRename+"</button>",'<button type="button" class="btn btn-text-default auto" id="view-manager-btn-duplicate" style="min-width: 80px;">'+this.textDuplicate+"</button>",'<button type="button" class="btn btn-text-default auto" id="view-manager-btn-delete" style="min-width: 80px;float: right;">'+this.textDelete+"</button>","</td>","</tr>","</table>","</div>","</div>","</div>","</div>",'<div class="separator horizontal"></div>','<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok" style="min-width: 86px;width: auto;">'+this.textGoTo+"</button>",'<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">'+this.closeButtonText+"</button>","</div>"].join("")},t),this.api=t.api,this.views=t.views||[],this.userTooltip=!0,this.currentView=void 0,this.wrapEvents={onRefreshNamedSheetViewList:_.bind(this.onRefreshNamedSheetViewList,this)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.viewList=new Common.UI.ListView({el:$("#view-manager-list",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,emptyText:this.textEmpty,itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;height: 20px;display:inline-block;<% if (!lock) { %>pointer-events:none;<% } %>">','<div style="width:100%;"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% if (lock) { %>",'<div class="lock-user"><%=lockuser%></div>',"<% } %>","</div>"].join("")),tabindex:1}),this.viewList.on("item:select",_.bind(this.onSelectItem,this)).on("item:keydown",_.bind(this.onKeyDown,this)).on("item:dblclick",_.bind(this.onDblClickItem,this)).on("entervalue",_.bind(this.onDblClickItem,this)),this.btnNew=new Common.UI.Button({el:$("#view-manager-btn-new")}),this.btnNew.on("click",_.bind(this.onNew,this,!1)),this.btnRename=new Common.UI.Button({el:$("#view-manager-btn-rename")}),this.btnRename.on("click",_.bind(this.onRename,this)),this.btnDuplicate=new Common.UI.Button({el:$("#view-manager-btn-duplicate")}),this.btnDuplicate.on("click",_.bind(this.onNew,this,!0)),this.btnDelete=new Common.UI.Button({el:$("#view-manager-btn-delete")}),this.btnDelete.on("click",_.bind(this.onDelete,this)),this.btnOk=new Common.UI.Button({el:this.$window.find(".primary"),disabled:!0}),this.afterRender()},getFocusedComponents:function(){return[this.viewList,this.btnNew,this.btnRename,this.btnDuplicate,this.btnDelete]},getDefaultFocusableComponent:function(){return this.viewList},afterRender:function(){this._setDefaults()},_setDefaults:function(t){this.refreshList(this.views),this.api.asc_registerCallback("asc_onRefreshNamedSheetViewList",this.wrapEvents.onRefreshNamedSheetViewList)},onRefreshNamedSheetViewList:function(){this.refreshList(this.api.asc_getNamedSheetViews(),this.currentView)},refreshList:function(t,e){var i=0;if(t){this.views=t;for(var n=[],o=0;o<this.views.length;o++){var s=this.views[o],a=s.asc_getIsLock();n.push({name:s.asc_getName(!0),active:s.asc_getIsActive(),view:s,lock:null!=a,lockuser:a?this.isUserVisible(a)?this.getUserName(a):this.lockText:this.guestText}),s.asc_getIsActive()&&(i=o)}this.viewList.store.reset(n)}var l=this.viewList.store.length;this.btnRename.setDisabled(!l),this.btnDuplicate.setDisabled(!l),this.btnDelete.setDisabled(!l),this.btnOk.setDisabled(!l),l>0&&(null==e&&(e=i),_.isNumber(e)&&(e>l-1&&(e=l-1),this.viewList.selectByIndex(e),setTimeout((function(){r.viewList.scrollToRecord(r.viewList.store.at(e))}),50)),!0===this.userTooltip&&this.viewList.cmpEl.find(".lock-user").length>0&&this.viewList.cmpEl.on("mouseover",_.bind(this.onMouseOverLock,this)).on("mouseout",_.bind(this.onMouseOutLock,this)));var r=this;_.delay((function(){r.viewList.cmpEl.find(".listview").focus(),r.viewList.scroller.update({alwaysVisibleY:!0})}),100,this)},onMouseOverLock:function(t,e,i){if(!0===this.userTooltip&&$(t.target).hasClass("lock-user")){var n=this,o=$(t.target).tooltip({title:this.tipIsLocked,trigger:"manual"}).data("bs.tooltip");this.userTooltip=o.tip(),this.userTooltip.css("z-index",parseInt(this.$window.css("z-index"))+10),o.show(),setTimeout((function(){n.userTipHide()}),5e3)}},userTipHide:function(){"object"==typeof this.userTooltip&&(this.userTooltip.remove(),this.userTooltip=void 0,this.viewList.cmpEl.off("mouseover").off("mouseout"))},onMouseOutLock:function(t,e,i){"object"==typeof this.userTooltip&&this.userTipHide()},onNew:function(t){var e=t?this.viewList.getSelectedRec().get("view"):void 0;this.currentView=this.viewList.store.length,this.api.asc_addNamedSheetView(e)},onDelete:function(){var t=this,e=this.viewList.getSelectedRec();e&&(e.get("active")?Common.UI.warning({msg:this.warnDeleteView.replace("%1",e.get("name")),buttons:["yes","no"],primary:"yes",callback:function(i){"yes"==i&&t.api.asc_deleteNamedSheetViews([e.get("view")])}}):this.api.asc_deleteNamedSheetViews([e.get("view")]))},onRename:function(){var t=this.viewList.getSelectedRec();if(t){var e=this;new Common.Views.EditNameDialog({label:this.textRenameLabel,error:this.textRenameError,value:t.get("name"),validation:function(t){return t.length<128||e.textLongName},handler:function(e,i){"ok"==e&&t.get("view").asc_setName(i)}}).on("close",(function(){e.getDefaultFocusableComponent().focus()})).show()}},getSettings:function(){var t=this.viewList.getSelectedRec();return t?t.get("name"):null},getUserName:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return AscCommon.UserInfoParser.getParsedName(i.get("username"))}return this.guestText},isUserVisible:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return!i.get("hidden")}return!0},onSelectItem:function(t,e,i){if(i){this.userTipHide();var n={};if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;n=i.toJSON(),this.currentView=_.indexOf(this.viewList.store.models,i),this.btnRename.setDisabled(n.lock),this.btnDelete.setDisabled(n.lock)}}},close:function(){this.userTipHide(),this.api.asc_unregisterCallback("asc_onRefreshNamedSheetViewList",this.wrapEvents.onRefreshNamedSheetViewList),Common.Views.AdvancedSettingsWindow.prototype.close.call(this)},onKeyDown:function(t,e,i){i.keyCode!=Common.UI.Keys.DELETE||this.btnDelete.isDisabled()||this.onDelete()},onDblClickItem:function(t,e,i){this.onPrimary()},onPrimary:function(){return!this.btnOk.isDisabled()&&(this.handler&&this.handler.call(this,"ok",this.getSettings())?void 0:(this.close(),!1))},txtTitle:"Sheet View Manager",textViews:"Sheet views",closeButtonText:"Close",textNew:"New",textRename:"Rename",textDuplicate:"Duplicate",textDelete:"Delete",textGoTo:"Go to view",textEmpty:"No views have been created yet.",guestText:"Guest",tipIsLocked:"This element is being edited by another user.",textRenameLabel:"Rename view",textRenameError:"View name must not be empty.",warnDeleteView:"You are trying to delete the currently enabled view '%1'.<br>Close this view and delete it?",textLongName:"Enter a name that is less than 128 characters.",lockText:"Locked"},SSE.Views.ViewManagerDlg||{}))})),define("spreadsheeteditor/main/app/controller/ViewTab",["core","spreadsheeteditor/main/app/view/ViewTab","spreadsheeteditor/main/app/view/ViewManagerDlg"],(function(){"use strict";SSE.Controllers.ViewTab=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["ViewTab"],sdkViewName:"#id_main",initialize:function(){},onLaunch:function(){this._state={},Common.NotificationCenter.on("uitheme:changed",this.onThemeChanged.bind(this))},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onZoomChanged",this.onApiZoomChange.bind(this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onSheetsChanged",this.onApiSheetChanged.bind(this)),this.api.asc_registerCallback("asc_onUpdateSheetViewSettings",this.onApiSheetChanged.bind(this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))),this},setConfig:function(t){this.toolbar=t.toolbar;var e=t.mode;this.view=this.createView("ViewTab",{toolbar:this.toolbar.toolbar,mode:e,compactToolbar:this.toolbar.toolbar.isCompactView}),this.addListeners({ViewTab:{"zoom:selected":_.bind(this.onSelectedZoomValue,this),"zoom:changedbefore":_.bind(this.onZoomChanged,this),"zoom:changedafter":_.bind(this.onZoomChanged,this),"viewtab:freeze":this.onFreeze,"viewtab:freezeshadow":this.onFreezeShadow,"viewtab:formula":this.onViewSettings,"viewtab:headings":this.onViewSettings,"viewtab:gridlines":this.onViewSettings,"viewtab:zeros":this.onViewSettings,"viewtab:zoom":this.onZoom,"viewtab:showview":this.onShowView,"viewtab:openview":this.onOpenView,"viewtab:createview":this.onCreateView,"viewtab:manager":this.onOpenManager},Statusbar:{"sheet:changed":this.onApiSheetChanged.bind(this),"view:compact":_.bind((function(t,e){this.view.chStatusbar.setValue(e,!0)}),this)},Toolbar:{"view:compact":_.bind((function(t,e){this.view.chToolbar.setValue(!e,!0)}),this)}}),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this))},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onSelectionChanged:function(t){this.toolbar.editMode&&this.view&&Common.Utils.lockControls(Common.enumLock.sheetView,this.api.asc_getActiveNamedSheetView&&!this.api.asc_getActiveNamedSheetView(this.api.asc_getActiveWorksheetIndex()),{array:[this.view.btnCloseView]})},onFreeze:function(t){this.api&&this.api.asc_freezePane(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onFreezeShadow:function(t){this.api.asc_setFrozenPaneBorderType(t?Asc.c_oAscFrozenPaneBorderType.shadow:Asc.c_oAscFrozenPaneBorderType.line),Common.localStorage.setBool("sse-freeze-shadow",t),Common.NotificationCenter.trigger("edit:complete",this.view)},applyZoom:function(t){var e=Math.max(10,Math.min(500,t));this._state.zoomValue===e&&this.view.cmbZoom.setValue(this._state.zoomValue,this._state.zoomValue+"%"),this.api.asc_setZoom(e/100),Common.NotificationCenter.trigger("edit:complete",this.view)},onSelectedZoomValue:function(t,e){this.applyZoom(e.value)},onZoomChanged:function(t,e,i,n){var o=parseFloat(i.value);(void 0===this._state.zoomValue&&(this._state.zoomValue=100),t)?new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*(%)?\\s*$").exec(i.value)||(this.view.cmbZoom.setValue(this._state.zoomValue,this._state.zoomValue+"%"),Common.NotificationCenter.trigger("edit:complete",this.view)):this._state.zoomValue===o||isNaN(o)?i.value!==this._state.zoomValue+"%"&&this.view.cmbZoom.setValue(this._state.zoomValue,this._state.zoomValue+"%"):this.applyZoom(o)},onViewSettings:function(t,e){if(this.api)switch(t){case 1:this.api.asc_setDisplayHeadings(e);break;case 2:this.api.asc_setDisplayGridlines(e);break;case 3:this.api.asc_setShowZeros(e)}Common.NotificationCenter.trigger("edit:complete",this.view)},onShowView:function(){var t=this.api.asc_getNamedSheetViews(),e=this.view.btnSheetView.menu._innerMenu,i=!1;e.removeItems(1,e.items.length-1),_.each(t,(function(t,n){e.addItem(new Common.UI.MenuItem({caption:t.asc_getName(),checkable:!0,allowDepress:!1,checked:t.asc_getIsActive(),template:_.template(['<a id="<%= id %>" style="<%= style %>" tabindex="-1" type="menuitem">',"<%= Common.Utils.String.htmlEncode(caption) %>","</a>"].join(""))})),t.asc_getIsActive()&&(i=!0)})),e.items[0].setChecked(!i,!0)},onOpenView:function(t){this.api&&this.api.asc_setActiveNamedSheetView("default"==t.value?null:t.name)},onCreateView:function(t){this.api&&this.api.asc_addNamedSheetView(null,!0)},onOpenManager:function(t){var e=this;new SSE.Views.ViewManagerDlg({api:this.api,handler:function(t,i){"ok"==t&&i&&e.api&&e.api.asc_setActiveNamedSheetView(i),Common.NotificationCenter.trigger("edit:complete",e.view)},views:this.api.asc_getNamedSheetViews()}).on("close",(function(t){})).show()},onWorksheetLocked:function(t,e){t==this.api.asc_getActiveWorksheetIndex()&&Common.Utils.lockControls(Common.enumLock.sheetLock,e,{array:[this.view.chHeadings,this.view.chGridlines,this.view.btnFreezePanes,this.view.chZeros]})},onApiSheetChanged:function(){if(this.toolbar.mode&&this.toolbar.mode.isEdit&&!this.toolbar.mode.isEditDiagram&&!this.toolbar.mode.isEditMailMerge&&!this.toolbar.mode.isEditOle){var t=this.api.asc_getSheetViewSettings();this.view.chHeadings.setValue(!!t.asc_getShowRowColHeaders(),!0),this.view.chGridlines.setValue(!!t.asc_getShowGridLines(),!0),this.view.btnFreezePanes.menu.items&&this.view.btnFreezePanes.menu.items[0].setCaption(t.asc_getIsFreezePane()?this.view.textUnFreeze:this.view.capBtnFreeze),this.view.chZeros.setValue(!!t.asc_getShowZeros(),!0);var e=this.api.asc_getActiveWorksheetIndex();this.onWorksheetLocked(e,this.api.asc_isWorksheetLockedOrDeleted(e))}},onLayoutChanged:function(t){"celleditor"==t&&arguments[1]&&this.view.chFormula.setValue("showed"==arguments[1],!0)},onApiZoomChange:function(t,e){var i=Math.floor(100*(t+.005));this.view.cmbZoom.setValue(i,i+"%"),this._state.zoomValue=i},onThemeChanged:function(){if(this.view&&Common.UI.Themes.available()){var t=Common.UI.Themes.currentThemeId()||Common.UI.Themes.defaultThemeId(),e=_.findWhere(this.view.btnInterfaceTheme.menu.items,{value:t});e&&(this.view.btnInterfaceTheme.menu.clearAll(),e.setChecked(!0,!0))}}},SSE.Controllers.ViewTab||{}))})),define("text!common/main/lib/template/SearchPanel.template",[],(function(){return'<div id="search-box" class="layout-ct vbox search-panel">\n    <div id="search-header">\n        <label id="search-adv-title"></label>\n        <div id="search-btn-close"></div>\n    </div>\n    <div id="search-adv-settings">\n        <table cols="1">\n            <tbody>\n                <tr>\n                    <td class="padding-small"><div id="search-adv-text"></div></td>\n                </tr>\n                <tr class="edit-setting">\n                    <td class="padding-large"><div id="search-adv-replace-text"></div></td>\n                </tr>\n                <tr>\n                    <td class="padding-large">\n                        <label id="search-adv-results-number" style="display: inline-block;">\n                            <%= scope.textSearchResults %>\n                        </label>\n                        <div class="search-nav-btns">\n                            <div id="search-adv-back"></div>\n                            <div id="search-adv-next"></div>\n                        </div>\n                    </td>\n                </tr>\n                <tr class="edit-setting">\n                    <td class="padding-large">\n                       <button type="button" class="btn btn-text-default" id="search-adv-replace" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textReplace %></button>\n                       <button type="button" class="btn btn-text-default" id="search-adv-replace-all" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textReplaceAll %></button>\n                    </td>\n                </tr>\n                <tr class="search-options-block">\n                    <td class="padding-large">\n                        <div id="open-search-options" data-hint="1" data-hint-direction="left" data-hint-offset="0, -15">\n                            <div class="search-options-caret img-commonctrl"></div>\n                            <div class="search-options-txt"><%= scope.textSearchOptions %></div>\n                        </div>\n                        <div id="search-options">\n                            <label class="input-label"><%= scope.textWithin %></label>\n                            <div id="search-adv-cmb-within"></div>\n                            <div id="search-adv-select-range"></div>\n                            <label class="input-label"><%= scope.textSearch %></label>\n                            <div id="search-adv-cmb-search"></div>\n                            <label class="input-label"><%= scope.textLookIn %></label>\n                            <div id="search-adv-cmb-look-in"></div>\n                        </div>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="padding-small"><div id="search-adv-case-sensitive"></div></td>\n                </tr>\n                \x3c!---<tr>\n                    <td class="padding-small"><div id="search-adv-use-regexp"></div></td>\n                </tr>--\x3e\n                <tr>\n                    <td class="padding-large"><div id="search-adv-match-word"></div></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n    <div id="search-results" class="ps-container oo">\n    </div>\n</div>'})),define("common/main/lib/view/SearchPanel",["text!common/main/lib/template/SearchPanel.template","common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t){"use strict";Common.Views.SearchPanel=Common.UI.BaseView.extend(_.extend({el:"#left-panel-search",template:_.template(t),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments),this.mode=!1,window.SSE&&(this.extendedOptions=Common.localStorage.getBool("sse-search-options-extended",!0))},render:function(t){var e=this;if(!this.rendered){if(t=t||this.el,$(t).html(this.template({scope:this})),this.$el=$(t),this.inputText=new Common.UI.InputField({el:$("#search-adv-text"),placeHolder:this.textFind,allowBlank:!0,validateOnBlur:!1,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.inputText._input.on("input",_.bind((function(){this.fireEvent("search:input",[this.inputText._input.val()])}),this)).on("keydown",_.bind((function(t){this.fireEvent("search:keydown",[this.inputText._input.val(),t])}),this)),this.inputReplace=new Common.UI.InputField({el:$("#search-adv-replace-text"),placeHolder:this.textReplaceWith,allowBlank:!0,validateOnBlur:!1,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.inputReplace._input.on("keydown",_.bind((function(t){t.keyCode!==Common.UI.Keys.RETURN||this.btnReplace.isDisabled()||this.onReplaceClick("replace")}),this)),this.btnBack=new Common.UI.Button({parentEl:$("#search-adv-back"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-arrow-up",hint:this.tipPreviousResult,dataHint:"1",dataHintDirection:"bottom"}),this.btnBack.on("click",_.bind(this.onBtnNextClick,this,"back")),this.btnNext=new Common.UI.Button({parentEl:$("#search-adv-next"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-arrow-down",hint:this.tipNextResult,dataHint:"1",dataHintDirection:"bottom"}),this.btnNext.on("click",_.bind(this.onBtnNextClick,this,"next")),this.btnReplace=new Common.UI.Button({el:$("#search-adv-replace")}),this.btnReplace.on("click",_.bind(this.onReplaceClick,this,"replace")),this.btnReplaceAll=new Common.UI.Button({el:$("#search-adv-replace-all")}),this.btnReplaceAll.on("click",_.bind(this.onReplaceClick,this,"replaceall")),this.$reaultsNumber=$("#search-adv-results-number"),this.updateResultsNumber("no-results"),this.chCaseSensitive=new Common.UI.CheckBox({el:$("#search-adv-case-sensitive"),labelText:this.textCaseSensitive,value:!1,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(t){e.fireEvent("search:options",["case-sensitive","checked"===t.getValue()])})),this.chMatchWord=new Common.UI.CheckBox({el:$("#search-adv-match-word"),labelText:window.SSE?this.textItemEntireCell:this.textWholeWords,value:!1,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(t){e.fireEvent("search:options",["match-word","checked"===t.getValue()])})),this.buttonClose=new Common.UI.Button({parentEl:$("#search-btn-close",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textCloseSearch,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.buttonClose.on("click",_.bind(this.onClickClosePanel,this)),this.$resultsContainer=$("#search-results"),this.$resultsContainer.hide(),Common.NotificationCenter.on("search:updateresults",_.bind(this.disableNavButtons,this)),window.SSE){this.cmbWithin=new Common.UI.ComboBox({el:$("#search-adv-cmb-within"),menuStyle:"min-width: 100%;",style:"width: 219px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textSheet},{value:1,displayValue:this.textWorkbook},{value:2,displayValue:this.textSpecificRange}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.fireEvent("search:options",["within",i.value])})),this.inputSelectRange=new Common.UI.InputFieldBtn({el:$("#search-adv-select-range"),placeHolder:this.textSelectDataRange,allowBlank:!0,validateOnChange:!0,validateOnBlur:!0,style:"width: 219px; margin-top: 8px",disabled:!0,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}).on("keyup:after",(function(t,i){e.fireEvent("search:options",["range",t.getValue(),i.keyCode!==Common.UI.Keys.RETURN])})),this.inputSelectRange.$el.hide(),this.cmbSearch=new Common.UI.ComboBox({el:$("#search-adv-cmb-search"),menuStyle:"min-width: 100%;",style:"width: 219px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textByRows},{value:1,displayValue:this.textByColumns}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.fireEvent("search:options",["search",!i.value])})),this.cmbLookIn=new Common.UI.ComboBox({el:$("#search-adv-cmb-look-in"),menuStyle:"min-width: 100%;",style:"width: 219px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textFormulas},{value:1,displayValue:this.textValues}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.fireEvent("search:options",["lookIn",!i.value])})),this.$searchOptionsBlock=$(".search-options-block"),this.$searchOptionsBlock.show(),$("#open-search-options").on("click",_.bind(this.expandSearchOptions,this)),this.extendedOptions||this.$searchOptionsBlock.addClass("no-expand"),this.cmbWithin.setValue(0),this.cmbSearch.setValue(0),this.cmbLookIn.setValue(0);var i='<div class="search-table"><div class="header-items"><div class="header-item">'+this.textSheet+'</div><div class="header-item">'+this.textName+'</div><div class="header-item">'+this.textCell+'</div><div class="header-item">'+this.textValue+'</div><div class="header-item">'+this.textFormula+'</div></div><div class="ps-container oo search-items"></div></div>',n=$(i).appendTo(this.$resultsContainer);this.$resultsContainer.scroller=new Common.UI.Scroller({el:n.find(".search-items"),includePadding:!0,useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0})}else this.$resultsContainer.scroller=new Common.UI.Scroller({el:this.$resultsContainer,includePadding:!0,useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0});Common.NotificationCenter.on("window:resize",(function(){e.updateResultsContainerHeight()}))}return this.rendered=!0,this.trigger("render:after",this),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this),this.updateResultsContainerHeight()},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},focus:function(t){var e=this,i="replace"===t?e.inputReplace.$el:"range"===t?e.inputSelectRange.$el:e.inputText.$el;setTimeout((function(){i.find("input").focus(),i.find("input").select()}),10)},setSearchMode:function(t){this.mode!==t&&(this.$el.find(".edit-setting")["no-replace"!==t?"show":"hide"](),this.$el.find("#search-adv-title").text("no-replace"!==t?this.textFindAndReplace:this.textFind),this.mode=t)},ChangeSettings:function(t){},updateResultsContainerHeight:function(){this.$resultsContainer&&(this.$resultsContainer.outerHeight($("#search-box").outerHeight()-$("#search-header").outerHeight()-$("#search-adv-settings").outerHeight()),this.$resultsContainer.scroller.update({alwaysVisibleY:!0}))},updateResultsNumber:function(t,e){var i;if(i=e>300?this.textTooManyResults:"no-results"===t?this.textNoSearchResults:"stop"===t?this.textSearchHasStopped:"content-changed"===t?this.textContentChanged+" "+Common.Utils.String.format(this.textSearchAgain,'<a class="search-again">',"</a>"):e?Common.Utils.String.format(this.textSearchResults,t+1,e):this.textNoMatches,"content-changed"===t){var n=this;this.$reaultsNumber.html(i),this.$reaultsNumber.find(".search-again").on("click",(function(){n.fireEvent("search:next",[n.inputText.getValue(),!0])}))}else this.$reaultsNumber.text(i);this.updateResultsContainerHeight(),!window.SSE&&this.disableReplaceButtons(!e)},onClickClosePanel:function(){Common.NotificationCenter.trigger("leftmenu:change","hide"),this.fireEvent("hide",this)},onBtnNextClick:function(t){this.fireEvent("search:"+t,[this.inputText.getValue(),!0])},onReplaceClick:function(t){this.fireEvent("search:"+t,[this.inputText.getValue(),this.inputReplace.getValue()])},getSettings:function(){return{textsearch:this.inputText.getValue(),matchcase:this.chCaseSensitive.checked,matchword:this.chMatchWord.checked}},expandSearchOptions:function(){this.extendedOptions=!this.extendedOptions,this.$searchOptionsBlock[this.extendedOptions?"removeClass":"addClass"]("no-expand"),Common.localStorage.setBool("sse-search-options-extended",this.extendedOptions),this.updateResultsContainerHeight()},setFindText:function(t){this.inputText.setValue(t)},clearResultsNumber:function(){this.updateResultsNumber("no-results")},disableNavButtons:function(t,e){var i=""===this.inputText._input.val()&&!window.SSE||!e;this.btnBack.setDisabled(i),this.btnNext.setDisabled(i)},disableReplaceButtons:function(t){this.btnReplace.setDisabled(t),this.btnReplaceAll.setDisabled(t)},textFind:"Find",textFindAndReplace:"Find and replace",textCloseSearch:"Close search",textReplace:"Replace",textReplaceAll:"Replace All",textSearchResults:"Search results: {0}/{1}",textReplaceWith:"Replace with",textCaseSensitive:"Case sensitive",textMatchUsingRegExp:"Match using regular expressions",textWholeWords:"Whole words only",textWithin:"Within",textSelectDataRange:"Select Data range",textSearch:"Search",textLookIn:"Look in",textSheet:"Sheet",textWorkbook:"Workbook",textSpecificRange:"Specific range",textByRows:"By rows",textByColumns:"By columns",textFormulas:"Formulas",textValues:"Values",textSearchOptions:"Search options",textNoMatches:"No matches",textNoSearchResults:"No search results",textItemEntireCell:"Entire cell contents",textTooManyResults:"There are too many results to show here",tipPreviousResult:"Previous result",tipNextResult:"Next result",textName:"Name",textCell:"Cell",textValue:"Value",textFormula:"Formula",textSearchHasStopped:"Search has stopped",textContentChanged:"Document changed.",textSearchAgain:"{0}Perform new search{1} for accurate results."},Common.Views.SearchPanel||{}))})),define("spreadsheeteditor/main/app/controller/Search",["core","common/main/lib/view/SearchPanel"],(function(){"use strict";SSE.Controllers.Search=Backbone.Controller.extend(_.extend({sdkViewName:"#id_main",views:["Common.Views.SearchPanel"],initialize:function(){this.addListeners({SearchBar:{"search:back":_.bind(this.onSearchNext,this,"back"),"search:next":_.bind(this.onSearchNext,this,"next"),"search:input":_.bind((function(t,e){!e||t?this._state.searchText!==t?this.onInputSearchChange(t):Common.NotificationCenter.trigger("search:updateresults",this._state.currentResult,this._state.resultsNumber):this._state.isResults&&(this._state.noSearchEmptyCells=!0,this.onQuerySearch())}),this),"search:keydown":_.bind(this.onSearchNext,this,"keydown"),show:_.bind(this.onSelectSearchingResults,this,!0),hide:_.bind(this.onSelectSearchingResults,this,!1)},"Common.Views.SearchPanel":{"search:back":_.bind(this.onSearchNext,this,"back"),"search:next":_.bind(this.onSearchNext,this,"next"),"search:replace":_.bind(this.onQueryReplace,this),"search:replaceall":_.bind(this.onQueryReplaceAll,this),"search:input":_.bind(this.onInputSearchChange,this),"search:options":_.bind(this.onChangeSearchOption,this),"search:keydown":_.bind(this.onSearchNext,this,"keydown"),show:_.bind(this.onShowPanel,this),hide:_.bind(this.onHidePanel,this)},LeftMenu:{"search:aftershow":_.bind(this.onShowAfterSearch,this)}})},onLaunch:function(){this._state={searchText:void 0,matchCase:!1,matchWord:!1,useRegExp:!1,withinSheet:Asc.c_oAscSearchBy.Sheet,searchByRows:!0,lookInFormulas:!0,isValidSelectedRange:!0,lastSelectedItem:void 0,isContentChanged:!1,isResults:!1,noSearchEmptyCells:!1,isReturnPressed:!1}},setMode:function(t){this.view=this.createView("Common.Views.SearchPanel",{mode:t}),this.view.on("render:after",_.bind(this.onAfterRender,this))},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onRenameCellTextEnd",_.bind(this.onRenameText,this)),this.api.asc_registerCallback("asc_onSetSearchCurrent",_.bind(this.onUpdateSearchCurrent,this)),this.api.asc_registerCallback("asc_onStartTextAroundSearch",_.bind(this.onStartTextAroundSearch,this)),this.api.asc_registerCallback("asc_onEndTextAroundSearch",_.bind(this.onEndTextAroundSearch,this)),this.api.asc_registerCallback("asc_onGetTextAroundSearchPack",_.bind(this.onApiGetTextAroundSearch,this)),this.api.asc_registerCallback("asc_onRemoveTextAroundSearch",_.bind(this.onApiRemoveTextAroundSearch,this)),this.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(this.onActiveSheetChanged,this)),this.api.asc_registerCallback("asc_onModifiedDocument",_.bind(this.onApiModifiedDocument,this)),this.api.asc_registerCallback("asc_onUpdateSearchElem",_.bind(this.onApiUpdateSearchElem,this))),this},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAfterRender:function(){var t=this;this.view.inputSelectRange.validation=function(e){if(_.isEmpty(e))return!0;var i=t.api.asc_checkDataRange(void 0,e);return t._state.isValidSelectedRange=i!==Asc.c_oAscError.ID.DataRangeError,i!==Asc.c_oAscError.ID.DataRangeError||t.textInvalidRange},this.view.inputSelectRange.on("button:click",_.bind(this.onRangeSelect,this))},onChangeSearchOption:function(t,e,i){var n=!0;switch(t){case"case-sensitive":this._state.matchCase=e;break;case"match-word":this._state.matchWord=e;break;case"regexp":this._state.useRegExp=e;break;case"within":this._state.withinSheet=0===e?Asc.c_oAscSearchBy.Sheet:1===e?Asc.c_oAscSearchBy.Workbook:Asc.c_oAscSearchBy.Range,this.view.inputSelectRange.setDisabled(e!==Asc.c_oAscSearchBy.Range),e===Asc.c_oAscSearchBy.Range&&(n=this._state.isValidSelectedRange&&!!this._state.selectedRange),this.view.inputSelectRange.$el[e===Asc.c_oAscSearchBy.Range?"show":"hide"](),this.view.updateResultsContainerHeight();break;case"range":this._state.selectedRange=e,n=!i;break;case"search":this._state.searchByRows=e;break;case"lookIn":this._state.lookInFormulas=e}n&&this.onQuerySearch()},onRangeSelect:function(){var t=this,e=new SSE.Views.CellRangeDialog({handler:function(e,i){if("ok"==i){var n=e.getSettings();t.view.inputSelectRange.setValue(n),t.view.inputSelectRange.checkValidate(),t.onChangeSearchOption("range",n)}}}).on("close",(function(){_.delay((function(){t.view.inputSelectRange.focus()}),1)}));e.show(),e.setSettings({api:t.api,range:_.isEmpty(t.view.inputSelectRange.getValue())||1!=t.view.inputSelectRange.checkValidate()?t._state.selectedRange:t.view.inputSelectRange.getValue(),type:Asc.c_oAscSelectionDialogType.PrintTitles})},onSearchNext:function(t,e,i){var n="keydown"===t&&i.keyCode===Common.UI.Keys.RETURN;(n||"keydown"!==t)&&(this._state.searchText=e,this.onQuerySearch(t)),this._state.isReturnPressed=n},onInputSearchChange:function(t){t||this._state.isReturnPressed||(this._state.noSearchEmptyCells=!0),this._state.isReturnPressed=!1;var e=this;this._state.searchText!==t&&(this._state.newSearchText=t,this._lastInputChange=new Date,void 0===this.searchTimer&&(this.searchTimer=setInterval((function(){new Date-e._lastInputChange<400||(e._state.searchText=e._state.newSearchText,e.onQuerySearch()||""!==e._state.newSearchText||(e.view.updateResultsNumber("no-results"),e.view.disableNavButtons(),Common.NotificationCenter.trigger("search:updateresults",void 0,0)))}),10)))},onQuerySearch:function(t,e){this.searchTimer&&clearInterval(this.searchTimer),this.searchTimer=void 0;var i=this;if(this._state.withinSheet!==Asc.c_oAscSearchBy.Range||this._state.isValidSelectedRange){this.hideResults();var n=new Asc.asc_CFindOptions;return n.asc_setFindWhat(this._state.searchText),n.asc_setScanForward("back"!=t),n.asc_setIsMatchCase(this._state.matchCase),n.asc_setIsWholeCell(this._state.matchWord),n.asc_setScanOnOnlySheet(this._state.withinSheet),this._state.withinSheet===Asc.c_oAscSearchBy.Range&&n.asc_setSpecificRange(this._state.selectedRange),n.asc_setScanByRows(this._state.searchByRows),n.asc_setLookIn(this._state.lookInFormulas?Asc.c_oAscFindLookIn.Formulas:Asc.c_oAscFindLookIn.Value),n.asc_setNeedRecalc(e),this._state.isContentChanged&&(n.asc_setLastSearchElem(this._state.lastSelectedItem),this.view.disableReplaceButtons(!1),this._state.isContentChanged=!1,this.view.$el.is(":visible")||(this.resultItems=[])),n.asc_setNotSearchEmptyCells(this._state.noSearchEmptyCells),this.api.asc_findText(n)?(this._state.isResults=!0,this.view.$el.is(":visible")&&this.api.asc_StartTextAroundSearch(),!0):(this._state.isResults=!1,this._state.noSearchEmptyCells?(this.removeResultItems("no-results"),this._state.noSearchEmptyCells=!1):this.removeResultItems(),!1)}Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.textInvalidRange,buttons:["ok"],callback:function(){i.view.focus("range")}})},onQueryReplace:function(t,e){this.api.isReplaceAll=!1;var i=new Asc.asc_CFindOptions;i.asc_setFindWhat(t),i.asc_setReplaceWith(e),i.asc_setIsMatchCase(this._state.matchCase),i.asc_setIsWholeCell(this._state.matchWord),i.asc_setScanOnOnlySheet(this._state.withinSheet),this._state.withinSheet===Asc.c_oAscSearchBy.Range&&i.asc_setSpecificRange(this._state.selectedRange),i.asc_setScanByRows(this._state.searchByRows),i.asc_setLookIn(this._state.lookIn?Asc.c_oAscFindLookIn.Formulas:Asc.c_oAscFindLookIn.Value),i.asc_setIsReplaceAll(!1),this.api.asc_replaceText(i)},onQueryReplaceAll:function(t,e){this.api.isReplaceAll=!0;var i=new Asc.asc_CFindOptions;i.asc_setFindWhat(t),i.asc_setReplaceWith(e),i.asc_setIsMatchCase(this._state.matchCase),i.asc_setIsWholeCell(this._state.matchWord),i.asc_setScanOnOnlySheet(this._state.withinSheet),this._state.withinSheet===Asc.c_oAscSearchBy.Range&&i.asc_setSpecificRange(this._state.selectedRange),i.asc_setScanByRows(this._state.searchByRows),i.asc_setLookIn(this._state.lookIn?Asc.c_oAscFindLookIn.Formulas:Asc.c_oAscFindLookIn.Value),i.asc_setIsReplaceAll(!0),this.api.asc_replaceText(i)},onRenameText:function(t,e){var i=this;this.api.isReplaceAll?t?(!(t-e)&&this.removeResultItems(),Common.UI.info({msg:!(t-e)||e>t?Common.Utils.String.format(this.textReplaceSuccess,e):Common.Utils.String.format(this.textReplaceSkipped,t-e),callback:function(){i.view.focus()}})):this.removeResultItems():this.onQuerySearch()},removeResultItems:function(t){this.resultItems=[],this.hideResults(),this.view.updateResultsNumber(t,0),this._state.currentResult=0,this._state.resultsNumber=0,this.view.disableNavButtons(),Common.NotificationCenter.trigger("search:updateresults",void 0,0)},onApiRemoveTextAroundSearch:function(t){if(this.resultItems){var e=this;t.forEach((function(t){var i=_.findIndex(e.resultItems,{id:t});-1!==i&&(e.resultItems[i].$el.remove(),e.resultItems.splice(i,1))})),0===this.resultItems.length&&this.removeResultItems()}},onUpdateSearchCurrent:function(t,e){-1!==t&&(this._state.currentResult=t,this._state.resultsNumber=e,this.view&&(this.view.updateResultsNumber(t,e),this.view.disableNavButtons(t,e),this.resultItems&&this.resultItems.length>0&&(this.resultItems.forEach((function(t){t.selected=!1})),this.resultItems[t]&&(this._state.lastSelectedItem=this.resultItems[t].data,this.resultItems[t].selected=!0,$("#search-results").find(".item").removeClass("selected"),this.resultItems[t].$el.addClass("selected")))),Common.NotificationCenter.trigger("search:updateresults",t,e))},scrollToSelectedResult:function(t){var e=void 0!==t?t:_.findIndex(this.resultItems,{selected:!0});if(-1!==e){var i=this.resultItems[e].$el,n=i.outerHeight(),o=i.position().top,s=this.view.$resultsContainer.find(".search-items"),a=s.outerHeight(),l=s.scrollTop();o<0||0===l&&o>a?this.view.$resultsContainer.scroller.scrollTop(l+o-12):o+n>a&&this.view.$resultsContainer.scroller.scrollTop(l+n)}},onStartTextAroundSearch:function(){this.view&&(this._state.isStartedAddingResults=!0)},onEndTextAroundSearch:function(){this.view&&(this._state.isStartedAddingResults=!1,this.view.$resultsContainer.scroller.update({alwaysVisibleY:!0}))},onApiGetTextAroundSearch:function(t){if(this.view&&this._state.isStartedAddingResults){if(t.length>300||!t.length)return;var e,i=this,n=i.view.$resultsContainer.find(".search-items");i.resultItems=[],t.forEach((function(t,o){var s=o===i._state.currentResult,a='<div class="item" style="width: 100%;"><div class="sheet">'+(t[1]?t[1]:"")+'</div><div class="name">'+(t[2]?t[2]:"")+'</div><div class="cell">'+(t[3]?t[3]:"")+'</div><div class="value">'+(t[4]?t[4]:"")+'</div><div class="formula">'+(t[5]?t[5]:"")+"</div></div>",l=$(a).appendTo(n);s&&(l.addClass("selected"),i._state.lastSelectedItem=t,e=o);var r={id:t[0],$el:l,el:a,selected:s,data:t};i.resultItems.push(r),l.on("click",_.bind((function(e){if(i._state.isContentChanged)return i._state.lastSelectedItem=t,void i.onQuerySearch();var n=t[0];i.api.asc_SelectSearchElement(n)}),i)),i.addTooltips(l,t)})),this.view.$resultsContainer.show(),this.scrollToSelectedResult(e)}},addTooltips:function(t,e){var i=[t.find(".sheet"),t.find(".name"),t.find(".cell"),t.find(".value"),t.find(".formula")],n=[e[1],e[2],e[3],e[4],e[5]];i.forEach((function(t,e){t.data("bs.tooltip")&&t.removeData("bs.tooltip");var i=n[e];i&&(t.off("mouseenter"),t.one("mouseenter",(function(){t.attr("data-toggle","tooltip"),t.tooltip({title:i,placement:"cursor",zIndex:1e3}),t.mouseenter()})))}))},hideResults:function(){this.view&&(this.view.$resultsContainer.hide(),this.view.$resultsContainer.find(".search-items").empty())},onShowAfterSearch:function(t){var e=""===t,i=this.getApplication().getController("Viewport");i.isSearchBarVisible()&&i.searchBar.hide();var n=this.api.asc_GetSelectedText(),o="string"==typeof t?t:n&&n.trim()||this._state.searchText;if(this.resultItems&&this.resultItems.length>0||!o&&this._state.isResults){if(!o&&!this.view.inputText.getValue())return this._state.noSearchEmptyCells=!0,void this.onQuerySearch();if(!this._state.matchCase&&o&&o.toLowerCase()===this.view.inputText.getValue().toLowerCase()||this._state.matchCase&&o===this.view.inputText.getValue())return}o?this.view.setFindText(o):e&&(this.view.setFindText(""),this._state.isResults||(this._state.searchText=void 0)),this.hideResults(),void 0!==this._state.searchText&&o&&o===this._state.searchText&&this._state.isResults?this.api.asc_StartTextAroundSearch():this._state.searchText?(this._state.searchText=o,this.onQuerySearch()):(this.resultItems=[],this.view.clearResultsNumber()),this.view.disableNavButtons(this._state.currentResult,this._state.resultsNumber)},onShowPanel:function(){if(this.onSelectSearchingResults(!0),this.resultItems&&this.resultItems.length>0&&!this._state.isStartedAddingResults){var t=this,e=this.view.$resultsContainer.find(".search-items");this.view.$resultsContainer.show(),this.resultItems.forEach((function(i){var n=$(i.el).appendTo(e);i.$el=n,i.selected&&n.addClass("selected"),n.on("click",(function(e){t.api.asc_SelectSearchElement(i.id),$("#search-results").find(".item").removeClass("selected"),$(e.currentTarget).addClass("selected")})),t.addTooltips(n,i.data)})),this.scrollToSelectedResult()}},onHidePanel:function(){this.hideResults(),this.onSelectSearchingResults(!1)},onSelectSearchingResults:function(t){!t&&this.getApplication().getController("LeftMenu").isSearchPanelVisible()||this._state.isHighlightedResults!==t&&(this.api.asc_selectSearchingResults(t),this._state.isHighlightedResults=t)},onApiModifiedDocument:function(){this._state.isContentChanged=!0,this.view.updateResultsNumber("content-changed"),this.view.disableReplaceButtons(!0)},onActiveSheetChanged:function(t){this._state.isHighlightedResults&&this._state.withinSheet===Asc.c_oAscSearchBy.Sheet&&this.onQuerySearch(void 0,!0)},getSearchText:function(){return this._state.searchText},onApiUpdateSearchElem:function(t){if(this.resultItems&&this.resultItems.length>0){var e=this;t.forEach((function(t){var i=_.findWhere(e.resultItems,{id:t[0]});i&&(i.data=t,i.el='<div class="item" style="width: 100%;"><div class="sheet">'+(t[1]?t[1]:"")+'</div><div class="name">'+(t[2]?t[2]:"")+'</div><div class="cell">'+(t[3]?t[3]:"")+'</div><div class="value">'+(t[4]?t[4]:"")+'</div><div class="formula">'+(t[5]?t[5]:"")+"</div></div>",e.view.$el.is(":visible")&&(i.$el.find(".sheet").text(t[1]?t[1]:""),i.$el.find(".name").text(t[2]?t[2]:""),i.$el.find(".cell").text(t[3]?t[3]:""),i.$el.find(".value").text(t[4]?t[4]:""),i.$el.find(".formula").text(t[5]?t[5]:""),e.addTooltips(i.$el,t)))}))}},textNoTextFound:"The data you have been searching for could not be found. Please adjust your search options.",textReplaceSuccess:"Search has been done. {0} occurrences have been replaced",textReplaceSkipped:"The replacement has been made. {0} occurrences were skipped.",textInvalidRange:"ERROR! Invalid cells range"},SSE.Controllers.Search||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Protection",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t){"use strict";Common.Views.Protection=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.isPasswordSupport&&(this.btnsAddPwd.concat(this.btnsChangePwd).forEach((function(e){e.on("click",(function(e,i){t.fireEvent("protect:password",[e,"add"])}))})),this.btnsDelPwd.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("protect:password",[e,"delete"])}))})),this.btnPwd.menu.on("item:click",(function(e,i,n){t.fireEvent("protect:password",[e,i.value])}))),t.appConfig.isSignatureSupport&&(this.btnSignature.menu&&this.btnSignature.menu.on("item:click",(function(e,i,n){t.fireEvent("protect:signature",[i.value,!1])})),this.btnsInvisibleSignature.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("protect:signature",["invisible"])}))}))),t._isSetEvents=!0}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode,this.btnsInvisibleSignature=[],this.btnsAddPwd=[],this.btnsDelPwd=[],this.btnsChangePwd=[],this._state={disabled:!1,hasPassword:!1,disabledPassword:!1,invisibleSignDisabled:!1};var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",this.appConfig.isPasswordSupport&&(this.btnAddPwd=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-protect",caption:this.txtEncrypt,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnsAddPwd.push(this.btnAddPwd),this.btnPwd=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-protect",caption:this.txtEncrypt,menu:!0,visible:!1,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"})),this.appConfig.isSignatureSupport&&(this.btnSignature=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-signature",caption:this.txtSignature,menu:"pe-"!==this.appPrefix,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnSignature.menu||this.btnsInvisibleSignature.push(this.btnSignature)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){e.canProtect&&(e.isPasswordSupport&&(i.btnAddPwd.updateHint(i.hintAddPwd),i.btnPwd.updateHint(i.hintPwd),i.btnPwd.setMenu(new Common.UI.Menu({items:[{caption:i.txtChangePwd,value:"add"},{caption:i.txtDeletePwd,value:"delete"}]}))),i.btnSignature&&(i.btnSignature.updateHint(i.btnSignature.menu?i.hintSignature:i.txtInvisibleSignature),i.btnSignature.menu&&i.btnSignature.setMenu(new Common.UI.Menu({items:[{caption:i.txtInvisibleSignature,value:"invisible"},{caption:i.txtSignatureLine,value:"visible",disabled:i._state.disabled}]}))),Common.NotificationCenter.trigger("tab:visible","protect",Common.UI.LayoutManager.isElementVisible("toolbar-protect"))),t.call(i)}))},getPanel:function(){return this.$el=$(_.template('<section id="protection-panel" class="panel" data-tab="protect"><div class="group"><span id="slot-btn-add-password" class="btn-slot text x-huge"></span><span id="slot-btn-change-password" class="btn-slot text x-huge"></span><span id="slot-btn-signature" class="btn-slot text x-huge"></span></div></section>')({})),this.appConfig.canProtect&&(this.btnAddPwd&&this.btnAddPwd.render(this.$el.find("#slot-btn-add-password")),this.btnPwd&&this.btnPwd.render(this.$el.find("#slot-btn-change-password")),this.btnSignature&&this.btnSignature.render(this.$el.find("#slot-btn-signature"))),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButton:function(t,e){var i=this;if("signature"==t){var n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtInvisibleSignature,disabled:this._state.invisibleSignDisabled,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsInvisibleSignature.push(n),this._isSetEvents&&n.on("click",(function(t,e){i.fireEvent("protect:signature",["invisible"])})),n}if("add-password"==t){n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtAddPwd,disabled:this._state.disabled||this._state.disabledPassword,visible:!this._state.hasPassword,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsAddPwd.push(n),this._isSetEvents&&n.on("click",(function(t,e){i.fireEvent("protect:password",[t,"add"])})),n}if("del-password"==t){n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtDeletePwd,disabled:this._state.disabled||this._state.disabledPassword,visible:this._state.hasPassword,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsDelPwd.push(n),this._isSetEvents&&n.on("click",(function(t,e){i.fireEvent("protect:password",[t,"delete"])})),n}if("change-password"==t){n=new Common.UI.Button({cls:"btn-text-default",style:"width: 100%;",caption:this.txtChangePwd,disabled:this._state.disabled||this._state.disabledPassword,visible:this._state.hasPassword,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsChangePwd.push(n),this._isSetEvents&&n.on("click",(function(t,e){i.fireEvent("protect:password",[t,"add"])})),n}},SetDisabled:function(t,e){this._state.disabled=t,this._state.invisibleSignDisabled=t&&!e,this.btnsInvisibleSignature&&this.btnsInvisibleSignature.forEach((function(i){i&&i.setDisabled(t&&!e)}),this),this.btnSignature&&this.btnSignature.menu&&(this.btnSignature.menu.items&&this.btnSignature.menu.items[1].setDisabled(t),this.btnSignature.setDisabled(t&&!e)),this.btnsAddPwd.concat(this.btnsDelPwd,this.btnsChangePwd).forEach((function(e){e&&e.setDisabled(t||this._state.disabledPassword)}),this)},onDocumentPassword:function(t,e){this._state.hasPassword=t,this._state.disabledPassword=!!e;var i=this._state.disabledPassword||this._state.disabled;this.btnsAddPwd&&this.btnsAddPwd.forEach((function(e){e&&(e.setVisible(!t),e.setDisabled(i))}),this),this.btnsDelPwd.concat(this.btnsChangePwd).forEach((function(e){e&&(e.setVisible(t),e.setDisabled(i))}),this),this.btnPwd.setVisible(t)},txtEncrypt:"Encrypt",txtSignature:"Signature",hintAddPwd:"Encrypt with password",hintPwd:"Change or delete password",hintSignature:"Add digital signature or signature line",txtChangePwd:"Change password",txtDeletePwd:"Delete password",txtAddPwd:"Add password",txtInvisibleSignature:"Add digital signature",txtSignatureLine:"Add Signature line"}}(),Common.Views.Protection||{}))})),define("spreadsheeteditor/main/app/view/WBProtection",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t){"use strict";SSE.Views.WBProtection=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;this.btnProtectWB.on("click",(function(e,i){t.fireEvent("protect:workbook",[e.pressed])})),this.btnProtectSheet.on("click",(function(e,i){t.fireEvent("protect:sheet",[e.pressed])})),this.btnAllowRanges.on("click",(function(e,i){t.fireEvent("protect:ranges")})),this.chLockedCell.on("change",(function(e,i){t.fireEvent("protect:lock-options",[0,i])})),this.chLockedShape.on("change",(function(e,i){t.fireEvent("protect:lock-options",[1,i])})),this.chLockedText.on("change",(function(e,i){t.fireEvent("protect:lock-options",[2,i])})),this.chHiddenFormula.on("change",(function(e,i){t.fireEvent("protect:lock-options",[3,i])})),t._isSetEvents=!0}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode;var e=Common.enumLock;this.lockedControls=[],this._state={disabled:!1},this.btnProtectWB=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon protect-workbook",enableToggle:!0,caption:this.txtProtectWB,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnProtectWB),this.btnProtectSheet=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon protect-sheet",enableToggle:!0,caption:this.txtProtectSheet,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnProtectSheet),this.btnAllowRanges=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon allow-edit-ranges",caption:this.txtAllowRanges,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth,e.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnAllowRanges),this.chLockedCell=new Common.UI.CheckBox({labelText:this.txtLockedCell,lock:[e.editCell,e.selRangeEdit,e.selChart,e.selChartText,e.selShape,e.selShapeText,e.selImage,e.selSlicer,e.wsLock,e.wbLock,e.lostConnect,e.coAuth],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLockedCell),this.chLockedShape=new Common.UI.CheckBox({labelText:this.txtLockedShape,lock:[e.selRange,e.selRangeEdit,e.wbLock,e.lostConnect,e.coAuth,e.Objects,e.wsLockShape],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLockedShape),this.chLockedText=new Common.UI.CheckBox({labelText:this.txtLockedText,lock:[e.selRange,e.selRangeEdit,e.selRangeEdit,e.selImage,e.selSlicer,e.wbLock,e.lostConnect,e.coAuth,e.Objects,e.wsLockText],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLockedText),this.chHiddenFormula=new Common.UI.CheckBox({labelText:this.txtHiddenFormula,lock:[e.editCell,e.selRangeEdit,e.selChart,e.selChartText,e.selShape,e.selShapeText,e.selImage,e.selSlicer,e.wsLock,e.wbLock,e.lostConnect,e.coAuth],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chHiddenFormula),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnProtectWB.updateHint(i.hintProtectWB),i.btnProtectSheet.updateHint(i.hintProtectSheet),i.btnAllowRanges.updateHint(i.hintAllowRanges),t.call(i)}))},getPanel:function(){return this.$el=$(_.template('<div class="group"><span id="slot-btn-protect-wb" class="btn-slot text x-huge" style="margin-right: 2px;"></span><span id="slot-btn-protect-sheet" class="btn-slot text x-huge" style="margin-right: 2px;"></span><span id="slot-btn-allow-ranges" class="btn-slot text x-huge"></span></div><div class="separator long invisible"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-locked-cell"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-hidden-formula"></span></div></div><div class="separator long invisible"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-locked-shape"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-locked-text"></span></div></div>')({})),this.btnProtectWB.render(this.$el.find("#slot-btn-protect-wb")),this.btnProtectSheet.render(this.$el.find("#slot-btn-protect-sheet")),this.btnAllowRanges.render(this.$el.find("#slot-btn-allow-ranges")),this.chLockedCell.render(this.$el.find("#slot-chk-locked-cell")),this.chLockedShape.render(this.$el.find("#slot-chk-locked-shape")),this.chLockedText.render(this.$el.find("#slot-chk-locked-text")),this.chHiddenFormula.render(this.$el.find("#slot-chk-hidden-formula")),this.$el},getButtons:function(t){return void 0===t?this.lockedControls:[]},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},txtProtectWB:"Protect Workbook",txtProtectSheet:"Protect Sheet",txtAllowRanges:"Allow Edit Ranges",hintProtectWB:"Protect workbook",hintProtectSheet:"Protect sheet",hintAllowRanges:"Allow edit ranges",txtLockedCell:"Locked Cell",txtLockedShape:"Shape Locked",txtLockedText:"Lock Text",txtHiddenFormula:"Hidden Formulas",txtWBUnlockTitle:"Unprotect Workbook",txtWBUnlockDescription:"Enter a password to unprotect workbook",txtSheetUnlockTitle:"Unprotect Sheet",txtSheetUnlockDescription:"Enter a password to unprotect sheet"}}(),SSE.Views.WBProtection||{}))})),define("spreadsheeteditor/main/app/view/ProtectDialog",["common/main/lib/component/Window"],(function(){"use strict";SSE.Views.ProtectDialog=Common.UI.Window.extend(_.extend({initialize:function(t){var e=this,i={};_.extend(i,{title:t.title?t.title:"sheet"==t.type?this.txtSheetTitle:this.txtWBTitle,cls:"modal-dlg",width:350,height:"auto",buttons:t.buttons?t.buttons:[{value:"ok",caption:this.txtProtect},"cancel"]},t),this.handler=t.handler,this.txtDescription=t.txtDescription||"",this.type=t.type||"workbook",this.props=t.props,this.names=t.names,this.isEdit=t.isEdit,this.api=t.api,this.template=t.template||['<div class="box">','<% if (type=="range") { %>','<div class="input-row">',"<label>"+e.txtRangeName+"</label>","</div>",'<div id="id-range-name-txt" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+e.txtRange+"</label>","</div>",'<div id="id-range-txt" class="input-row" style="margin-bottom: 10px;"></div>',"<% } else { %>",'<div class="" style="margin-bottom: 10px;">',"<label>"+("sheet"==e.type?e.txtSheetDescription:e.txtWBDescription)+"</label>","</div>","<% } %>",'<div class="input-row">',"<label>"+e.txtPassword+" ("+e.txtOptional+")</label>","</div>",'<div id="id-password-txt" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+e.txtRepeat+"</label>","</div>",'<div id="id-repeat-txt" class="input-row" style="margin-bottom: 10px;"></div>','<% if (type=="sheet") { %>','<div class="input-row">',"<label>"+e.txtAllow+"</label>","</div>",'<div id="protect-dlg-options" class="" style="width: 100%; height: 139px; overflow: hidden;margin-bottom: 10px;"></div>',"<% } %>","<label>"+e.txtWarning+"</label>","</div>"].join(""),i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.repeatPwd=new Common.UI.InputField({el:$("#id-repeat-txt"),type:"password",allowBlank:!0,style:"width: 100%;",maxLength:255,validateOnBlur:!1,validation:function(e){return t.txtIncorrectPwd}}),this.inputPwd=new Common.UI.InputFieldBtnPassword({el:$("#id-password-txt"),type:"password",allowBlank:!0,style:"width: 100%;",maxLength:255,validateOnBlur:!1,repeatInput:this.repeatPwd,showPwdOnClick:!0}),"sheet"==this.type&&(this.optionsList=new Common.UI.ListView({el:$("#protect-dlg-options",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,scrollAlwaysVisible:!0,template:_.template(['<div class="listview inner" style=""></div>'].join("")),itemTemplate:_.template(["<div>",'<label class="checkbox-indeterminate" style="position:absolute;">','<input id="pdcheckbox-<%= id %>" type="checkbox" class="button__checkbox">','<label for="pdcheckbox-<%= id %>" class="checkbox__shape" ></label>',"</label>",'<div id="<%= id %>" class="list-item" style="pointer-events:none; margin-left: 20px;display: flex;">','<div style="flex-grow: 1;"><%= Common.Utils.String.htmlEncode(value) %></div>',"</div>","</div>"].join(""))}),this.optionsList.on({"item:change":this.onItemChanged.bind(this),"item:add":this.onItemChanged.bind(this),"item:select":this.onCellCheck.bind(this)}),this.optionsList.onKeyDown=_.bind(this.onListKeyDown,this),this.optionsList.on("entervalue",_.bind(this.onPrimary,this))),"range"==this.type&&(this.inputRangeName=new Common.UI.InputField({el:$("#id-range-name-txt"),allowBlank:!1,blankError:this.txtEmpty,style:"width: 100%;",maxLength:255,validateOnBlur:!1,validateOnChange:!1,validation:function(e){if(""==e)return!0;switch(t.api.asc_checkProtectedRangeName(e)){case Asc.c_oAscDefinedNameReason.WrongName:return t.textInvalidName;case Asc.c_oAscDefinedNameReason.Existed:return!(!t.isEdit||t.props.asc_getName().toLowerCase()!=e.toLowerCase())||t.textExistName;case Asc.c_oAscDefinedNameReason.OK:return!!(t.names.indexOf(e.toLowerCase())<0||t.isEdit&&t.props.asc_getName().toLowerCase()==e.toLowerCase())||t.textExistName;default:return t.textInvalidName}}}),this.txtDataRange=new Common.UI.InputFieldBtn({el:$("#id-range-txt"),name:"range",style:"width: 100%;",allowBlank:!1,btnHint:this.textSelectData,blankError:this.txtEmpty,validateOnChange:!0,validateOnBlur:!1,validation:function(e){return t.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.ConditionalFormattingRule,e,!0)!==Asc.c_oAscError.ID.DataRangeError||t.textInvalidRange}}),this.txtDataRange.on("button:click",_.bind(this.onSelectData,this))),this.afterRender()},getFocusedComponents:function(){var t=[];return"range"==this.type&&(t=t.concat([this.inputRangeName,this.txtDataRange])),t=t.concat([this.inputPwd,this.repeatPwd]),"sheet"==this.type&&(t=t.concat([this.optionsList])),t},getDefaultFocusableComponent:function(){return"range"==this.type?this.inputRangeName:this.inputPwd},afterRender:function(){this._setDefaults(this.props)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.handler){if("ok"==t){if(this.inputRangeName&&!0!==this.inputRangeName.checkValidate())return void this.inputRangeName.focus();if(this.txtDataRange&&!0!==this.txtDataRange.checkValidate())return void this.txtDataRange.focus();if(!0!==this.inputPwd.checkValidate())return void this.inputPwd.focus();if(this.inputPwd.getValue()!==this.repeatPwd.getValue())return this.repeatPwd.checkValidate(),void this.repeatPwd.focus()}this.handler.call(this,t,this.inputPwd.getValue(),"ok"==t?this.getSettings():void 0)}this.close()},_setDefaults:function(t){this.optionsList&&this.updateOptionsList(t),"range"==this.type&&this.updateRangeSettings(t)},onItemChanged:function(t,e){var i=e.model.get("check");"indeterminate"==i?$("input[type=checkbox]",e.$el).prop("indeterminate",!0):$("input[type=checkbox]",e.$el).prop({checked:i,indeterminate:!1})},onCellCheck:function(t,e,i){if(!this.checkCellTrigerBlock){var n="",o=!1,s=null,a=window.event?window.event:window._event;if(a){if((n=$(a.currentTarget).find(".list-item")).length){s=n.get(0).getBoundingClientRect();var l=a.clientX*Common.Utils.zoom(),r=a.clientY*Common.Utils.zoom();s.left<l&&l<s.right&&s.top<r&&r<s.bottom&&(o=!0)}(o||a.target.className.match("checkbox")&&"input"!==a.target.localName)&&(this.updateCellCheck(t,i),_.delay((function(){t.focus()}),100,this))}}},onListKeyDown:function(t,e){var i=this.optionsList;i.disabled||(_.isUndefined(void 0)&&(e=t),e.keyCode==Common.UI.Keys.SPACE?(e.preventDefault(),e.stopPropagation(),this.updateCellCheck(i,i.getSelectedRec())):Common.UI.DataView.prototype.onKeyDown.call(this.optionsList,t,e))},updateCellCheck:function(t,e){e&&t&&(e.set("check",!e.get("check")),"SelectLockedCells"==e.get("optionName")&&e.get("check")&&this.optionsList.store.findWhere({optionName:"SelectUnlockedCells"}).set("check",!0),"SelectUnlockedCells"!=e.get("optionName")||e.get("check")||this.optionsList.store.findWhere({optionName:"SelectLockedCells"}).set("check",!1))},updateRangeSettings:function(t){t&&(this.inputRangeName.setValue(t.asc_getName()),this.txtDataRange.setValue(t.asc_getSqref()))},updateOptionsList:function(t){var e=[{value:this.txtSelLocked,optionName:"SelectLockedCells"},{value:this.txtSelUnLocked,optionName:"SelectUnlockedCells"},{value:this.txtFormatCells,optionName:"FormatCells"},{value:this.txtFormatCols,optionName:"FormatColumns"},{value:this.txtFormatRows,optionName:"FormatRows"},{value:this.txtInsCols,optionName:"InsertColumns"},{value:this.txtInsRows,optionName:"InsertRows"},{value:this.txtInsHyper,optionName:"InsertHyperlinks"},{value:this.txtDelCols,optionName:"DeleteColumns"},{value:this.txtDelRows,optionName:"DeleteRows"},{value:this.txtSort,optionName:"Sort"},{value:this.txtAutofilter,optionName:"AutoFilter"},{value:this.txtPivot,optionName:"PivotTables"},{value:this.txtObjs,optionName:"Objects"},{value:this.txtScen,optionName:"Scenarios"}],i=[];e.forEach((function(e,n){i.push(new Common.UI.DataViewModel({selected:!1,allowSelected:!0,value:e.value,optionName:e.optionName,check:!(!t||!t["asc_get"+e.optionName])&&!t["asc_get"+e.optionName]()}))})),this.optionsList.store.reset(i),this.optionsList.scroller.update({minScrollbarLength:this.optionsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0})},getSettings:function(){return"sheet"==this.type?this.getSheetSettings():"range"==this.type?this.getRangeSettings():void 0},getSheetSettings:function(){var t=this.props?this.props:new Asc.CSheetProtection;return this.optionsList.store.each((function(e,i){t&&t["asc_set"+e.get("optionName")]&&t["asc_set"+e.get("optionName")](!e.get("check"))})),t},getRangeSettings:function(){var t=this.props?this.props:new Asc.CProtectedRange;return t.asc_setName(this.inputRangeName.getValue()),t.asc_setSqref(this.txtDataRange.getValue()),t},onSelectData:function(){var t=this;if(t.api){var e=new SSE.Views.CellRangeDialog({handler:function(e,i){"ok"==i&&(t.dataRangeValid=e.getSettings(),t.txtDataRange.setValue(t.dataRangeValid),t.txtDataRange.checkValidate())}}).on("close",(function(){t.show(),_.delay((function(){t.txtDataRange.focus()}),1)})),i=t.$window.offset();t.hide(),e.show(i.left+65,i.top+77),e.setSettings({api:t.api,range:_.isEmpty(t.txtDataRange.getValue())||1!=t.txtDataRange.checkValidate()?t.dataRangeValid:t.txtDataRange.getValue(),type:Asc.c_oAscSelectionDialogType.ConditionalFormattingRule,validation:function(){return!0}})}},txtPassword:"Password",txtRepeat:"Repeat password",txtIncorrectPwd:"Confirmation password is not identical",txtWarning:"Warning: If you lose or forget the password, it cannot be recovered. Please keep it in a safe place.",txtOptional:"optional",txtProtect:"Protect",txtSelLocked:"Select locked cells",txtSelUnLocked:"Select unlocked cells",txtFormatCells:"Format cells",txtFormatCols:"Format columns",txtFormatRows:"Format rows",txtInsCols:"Insert columns",txtInsRows:"Insert rows",txtInsHyper:"Insert hyperlink",txtDelCols:"Delete columns",txtDelRows:"Delete rows",txtSort:"Sort",txtAutofilter:"Use AutoFilter",txtPivot:"Use PivotTable and PivotChart",txtObjs:"Edit objects",txtScen:"Edit scenarios",txtWBDescription:"To prevent other users from viewing hidden worksheets, adding, moving, deleting, or hiding worksheets and renaming worksheets, you can protect the structure of your workbook with a password.",txtWBTitle:"Protect Workbook structure",txtSheetDescription:"Prevent unwanted changes from others by limiting their ability to edit.",txtSheetTitle:"Protect Sheet",txtAllow:"Allow all users of this sheet to",txtRangeName:"Title",txtRange:"Range",txtEmpty:"This field is required",textSelectData:"Select Data",textInvalidRange:"ERROR! Invalid cells range",textInvalidName:"The range title must begin with a letter and may only contain letters, numbers, and spaces.",textExistName:"ERROR! Range with such a title already exists"},SSE.Views.ProtectDialog||{}))})),define("text!spreadsheeteditor/main/app/template/ProtectRangesDlg.template",[],(function(){return'<div class="settings-panel active">\n    <div class="inner-content">\n        <table cols="2" style="width: 100%;">\n            <tr>\n                <td colspan=2 class="padding-small"></td>\n            </tr>\n            <tr>\n                <td colspan=2 class="padding-small">\n                    <label><%= scope.textRangesDesc %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=2>\n                    <label class="header" style="width: 188px;"><%= scope.textTitle %></label>\n                    <label class="header" style="width: 188px;"><%= scope.textRange %></label>\n                    <label class="header" style=""><%= scope.textPwd %></label>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=2 class="padding-small">\n                    <div id="protect-ranges-list" class="range-tableview" style="width:100%; height: 155px;"></div>\n                </td>\n            </tr>\n            <tr>\n                <td class="padding-large">\n                    <button type="button" class="btn btn-text-default" id="protect-ranges-btn-new" style="min-width: 100px;margin-right:5px;"><%= scope.textNew %></button>\n                    <button type="button" class="btn btn-text-default" id="protect-ranges-btn-edit" style="min-width: 100px;"><%= scope.textEdit %></button>\n                </td>\n                <td class="padding-large" style="text-align: right;width:90px;">\n                    <button type="button" class="btn btn-text-default" id="protect-ranges-btn-delete" style="min-width: 100px;"><%= scope.textDelete %></button>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>'})),define("spreadsheeteditor/main/app/view/ProtectRangesDlg",["text!spreadsheeteditor/main/app/template/ProtectRangesDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ListView"],(function(t){"use strict";SSE.Views=SSE.Views||{},SSE.Views.ProtectRangesDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"ProtectRangesDlg",contentWidth:480,height:353},initialize:function(e){_.extend(this.options,{title:this.txtTitle,template:['<div class="box" style="height:'+(this.options.height-85)+'px;">','<div class="content-panel" style="padding: 0;">'+_.template(t)({scope:this})+"</div>","</div>",'<div class="separator horizontal"></div>'].join(""),buttons:[{value:"protect-sheet",caption:this.textProtect},"ok","cancel"],primary:"protect-sheet"},e),this.api=e.api,this.handler=e.handler,this.props=e.props,this.locked=e.locked||!1,this.userTooltip=!0,this.currentRange=void 0,this.deletedArr=[],this.wrapEvents={onLockProtectedRangeManager:_.bind(this.onLockProtectedRangeManager,this),onUnLockProtectedRangeManager:_.bind(this.onUnLockProtectedRangeManager,this),onLockProtectedRange:_.bind(this.onLockProtectedRange,this),onUnLockProtectedRange:_.bind(this.onUnLockProtectedRange,this)},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);this.rangeList=new Common.UI.ListView({el:$("#protect-ranges-list",this.$window),store:new Common.UI.DataViewStore,simpleAddMode:!0,emptyText:this.textEmpty,itemTemplate:_.template(['<div id="<%= id %>" class="list-item" style="width: 100%;display:inline-block;<% if (!lock) { %>pointer-events:none;<% } %>">','<div style="width:184px;padding-right: 5px;"><%= Common.Utils.String.htmlEncode(name) %></div>','<div style="width:191px;padding-right: 5px;"><%= range %></div>','<div style="width:70px;"><% if (pwd) { %>',this.txtYes,"<% } else { %>",this.txtNo,"<% } %></div>","<% if (lock) { %>",'<div class="lock-user"><%=lockuser%></div>',"<% } %>","</div>"].join("")),tabindex:1}),this.rangeList.store.comparator=function(t,e){var i=t.get("name").toLowerCase(),n=e.get("name").toLowerCase();return i==n?0:i<n?-1:1},this.rangeList.on("item:select",_.bind(this.onSelectRangeItem,this)).on("item:keydown",_.bind(this.onKeyDown,this)).on("item:dblclick",_.bind(this.onDblClickItem,this)).on("entervalue",_.bind(this.onDblClickItem,this)),this.btnNewRange=new Common.UI.Button({el:$("#protect-ranges-btn-new")}),this.btnNewRange.on("click",_.bind(this.onEditRange,this,!1)),this.btnEditRange=new Common.UI.Button({el:$("#protect-ranges-btn-edit")}),this.btnEditRange.on("click",_.bind(this.onEditRange,this,!0)),this.btnDeleteRange=new Common.UI.Button({el:$("#protect-ranges-btn-delete")}),this.btnDeleteRange.on("click",_.bind(this.onDeleteRange,this)),this.afterRender()},getFocusedComponents:function(){return[this.rangeList,this.btnNewRange,this.btnEditRange,this.btnDeleteRange]},getDefaultFocusableComponent:function(){return this.rangeList},afterRender:function(){this._setDefaults(this.props)},_setDefaults:function(t){this.refreshRangeList(t,0),this.currentSheet=this.api.asc_getActiveWorksheetIndex(),this.api.asc_registerCallback("asc_onLockProtectedRangeManager",this.wrapEvents.onLockProtectedRangeManager),this.api.asc_registerCallback("asc_onUnLockProtectedRangeManager",this.wrapEvents.onUnLockProtectedRangeManager),this.api.asc_registerCallback("asc_onLockProtectedRange",this.wrapEvents.onLockProtectedRange),this.api.asc_registerCallback("asc_onUnLockProtectedRange",this.wrapEvents.onUnLockProtectedRange)},refreshRangeList:function(t,e){if(t){for(var i=[],n=0;n<t.length;n++){var o=t[n].asc_getIsLock();i.push({name:t[n].asc_getName()||"",pwd:t[n].asc_isPassword(),range:t[n].asc_getSqref()||"",rangeId:t[n].asc_getId(),props:t[n],lock:null!=o,lockuser:o?this.isUserVisible(o)?this.getUserName(o):this.lockText:this.guestText})}this.rangeList.store.reset(i)}var s=this,a=this.rangeList.store,l=a.length;if(l>0){if(null==e&&(e=0),_.isNumber(e))e>l-1&&(e=l-1),this.rangeList.selectByIndex(e),setTimeout((function(){s.rangeList.scrollToRecord(a.at(e))}),50);else if(e){var r=a.findWhere({name:e.asc_getName(!0)});r&&(this.rangeList.selectRecord(r),setTimeout((function(){s.rangeList.scrollToRecord(r)}),50))}!0===this.userTooltip&&this.rangeList.cmpEl.find(".lock-user").length>0&&this.rangeList.cmpEl.on("mouseover",_.bind(s.onMouseOverLock,s)).on("mouseout",_.bind(s.onMouseOutLock,s))}this.updateButtons(),_.delay((function(){s.rangeList.scroller.update({alwaysVisibleY:!0})}),100,this)},onMouseOverLock:function(t,e,i){if(!0===this.userTooltip&&$(t.target).hasClass("lock-user")){var n=this,o=$(t.target).tooltip({title:this.tipIsLocked,trigger:"manual"}).data("bs.tooltip");this.userTooltip=o.tip(),this.userTooltip.css("z-index",parseInt(this.$window.css("z-index"))+10),o.show(),setTimeout((function(){n.userTipHide()}),5e3)}},userTipHide:function(){"object"==typeof this.userTooltip&&(this.userTooltip.remove(),this.userTooltip=void 0,this.rangeList.cmpEl.off("mouseover").off("mouseout"))},onMouseOutLock:function(t,e,i){"object"==typeof this.userTooltip&&this.userTipHide()},onEditRange:function(t){if(!this._isWarningVisible)if(this.locked)Common.NotificationCenter.trigger("namedrange:locked");else{var e,i=this,n=i.$window.offset(),o=this.rangeList.getSelectedRec();t?e=o.get("props"):(e=new Asc.CProtectedRange).asc_setSqref(i.api.asc_getActiveRangeStr(Asc.referenceType.A));var s=[];this.rangeList.store.each((function(t){s.push(t.get("name").toLowerCase())}));var a=new SSE.Views.ProtectDialog({title:t?i.txtEditRange:i.txtNewRange,type:"range",props:e,names:s,isEdit:t,api:i.api,buttons:["ok","cancel"],handler:function(e,n,s){"ok"==e&&(n&&s.asc_setPassword(n),t?(o.set("props",s),o.set("name",s.asc_getName()),o.set("range",s.asc_getSqref()),o.set("pwd",s.asc_isPassword())):(o=i.rangeList.store.add({name:s.asc_getName(),pwd:s.asc_isPassword(),range:s.asc_getSqref(),props:s,isNew:!0,lock:!1,lockuser:this.guestText}),i.rangeList.selectRecord(o),i.rangeList.scrollToRecord(i.rangeList.getSelectedRec()),i.updateButtons()))}}).on("close",(function(){i.show(),setTimeout((function(){i.getDefaultFocusableComponent().focus()}),100)}));i.hide(),a.show(n.left+65,n.top+77)}},onDeleteRange:function(){var t=this.rangeList.store,e=this.rangeList.getSelectedRec();if(e){!e.get("isNew")&&this.deletedArr.push(e.get("props"));var i=t.indexOf(e);t.remove(e),t.length>0&&this.rangeList.selectByIndex(i),this.rangeList.scrollToRecord(this.rangeList.getSelectedRec())}this.updateButtons()},getSettings:function(){var t=[];return this.rangeList.store.each((function(e){t.push(e.get("props"))})),{arr:t,deletedArr:this.deletedArr}},onPrimary:function(){return!0},onDlgBtnClick:function(t){this.handler&&this.handler.call(this,t.currentTarget.attributes.result.value,this.getSettings()),this.close()},getUserName:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return AscCommon.UserInfoParser.getParsedName(i.get("username"))}return this.guestText},isUserVisible:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return!i.get("hidden")}return!0},onSelectRangeItem:function(t,e,i){if(i){this.userTipHide();if(_.isFunction(i.toJSON)){if(!i.get("selected"))return;i.toJSON(),this.currentNamedRange=_.indexOf(this.rangeList.store.models,i)}this.updateButtons()}},hide:function(){this.userTipHide(),Common.UI.Window.prototype.hide.call(this)},close:function(){this.userTipHide(),this.api.asc_unregisterCallback("asc_onLockProtectedRangeManager",this.wrapEvents.onLockProtectedRangeManager),this.api.asc_unregisterCallback("asc_onUnLockProtectedRangeManager",this.wrapEvents.onUnLockProtectedRangeManager),this.api.asc_unregisterCallback("asc_onLockProtectedRange",this.wrapEvents.onLockProtectedRange),this.api.asc_unregisterCallback("asc_onUnLockProtectedRange",this.wrapEvents.onUnLockProtectedRange),Common.UI.Window.prototype.close.call(this)},onKeyDown:function(t,e,i){i.keyCode!=Common.UI.Keys.DELETE||this.btnDeleteRange.isDisabled()||this.onDeleteRange()},onDblClickItem:function(t,e,i){this.btnEditRange.isDisabled()||this.onEditRange(!0)},onLockProtectedRangeManager:function(t){this.currentSheet===t&&(this.locked=!0,this.updateButtons(),!0===this.userTooltip&&this.rangeList.cmpEl.find(".lock-user").length>0&&this.rangeList.cmpEl.on("mouseover",_.bind(this.onMouseOverLock,this)).on("mouseout",_.bind(this.onMouseOutLock,this)))},onUnLockProtectedRangeManager:function(t){this.currentSheet===t&&(this.locked=!1,this.updateButtons())},onLockProtectedRange:function(t,e,i){if(this.currentSheet===t){var n=this.rangeList.store.findWhere({rangeId:e});n&&(n.set("lockuser",i?this.isUserVisible(i)?this.getUserName(i):this.lockText:this.guestText),n.set("lock",!0),this.updateButtons()),!0===this.userTooltip&&this.rangeList.cmpEl.find(".lock-user").length>0&&this.rangeList.cmpEl.on("mouseover",_.bind(this.onMouseOverLock,this)).on("mouseout",_.bind(this.onMouseOutLock,this))}},onUnLockProtectedRange:function(t,e){if(this.currentSheet===t){var i=this.rangeList.store.findWhere({rangeId:e});i&&(i.set("lockuser",""),i.set("lock",!1),this.updateButtons())}},updateButtons:function(){var t=this.rangeList.getSelectedRec(),e=!!t&&t.get("lock"),i=this.rangeList.store.length;this.btnDeleteRange.setDisabled(i<1||e),this.btnEditRange.setDisabled(i<1||e)},txtTitle:"Allow Users to Edit Ranges",textRangesDesc:"Ranges unlocked by a password when sheet is protected (this works only for locked cells)",textTitle:"Title",textRange:"Range",textPwd:"Password",textNew:"New",textEdit:"Edit",textDelete:"Delete",textEmpty:"No ranges allowed for edit.",guestText:"Guest",tipIsLocked:"This element is being edited by another user.",warnDelete:"Are you sure you want to delete the name {0}?",textProtect:"Protect Sheet",txtYes:"Yes",txtNo:"No",txtEditRange:"Edit Range",txtNewRange:"New Range",lockText:"Locked"},SSE.Views.ProtectRangesDlg||{}))})),define("spreadsheeteditor/main/app/controller/WBProtection",["core","common/main/lib/view/Protection","spreadsheeteditor/main/app/view/WBProtection","spreadsheeteditor/main/app/view/ProtectDialog","spreadsheeteditor/main/app/view/ProtectRangesDlg"],(function(){"use strict";SSE.Controllers.WBProtection=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["WBProtection"],sdkViewName:"#id_main",initialize:function(){this.addListeners({WBProtection:{"protect:workbook":_.bind(this.onWorkbookClick,this),"protect:sheet":_.bind(this.onSheetClick,this),"protect:ranges":_.bind(this.onRangesClick,this),"protect:lock-options":_.bind(this.onLockOptionClick,this)}})},onLaunch:function(){this._state={},this.wsLockOptions=["SelectLockedCells","SelectUnlockedCells","FormatCells","FormatColumns","FormatRows","InsertColumns","InsertRows","InsertHyperlinks","DeleteColumns","DeleteRows","Sort","AutoFilter","PivotTables","Objects","Scenarios"],Common.enumLock&&this.wsLockOptions.forEach((function(t){Common.enumLock[t]=t})),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("protect:sheet",_.bind(this.onSheetClick,this))},setConfig:function(t,e){this.setApi(e),t&&(this.sdkViewName=t.sdkviewname||this.sdkViewName)},setApi:function(t){t&&(this.api=t,this.api.asc_registerCallback("asc_onChangeProtectWorkbook",_.bind(this.onChangeProtectWorkbook,this)),this.api.asc_registerCallback("asc_onChangeProtectWorksheet",_.bind(this.onChangeProtectSheet,this)),this.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(this.onActiveSheetChanged,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChanged,this)))},setMode:function(t){return this.appConfig=t,this.appConfig.isEdit&&(this.view=this.createView("WBProtection",{mode:t})),this},createToolbarPanel:function(){if(this.view)return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onWorkbookClick:function(t){if(this.view.btnProtectWB.toggle(!t,!0),t){var e=this,i=new SSE.Views.ProtectDialog({type:"workbook",handler:function(t,i){if(n=t,"ok"==t){var o=e.api.asc_getProtectedWorkbook();o.asc_setLockStructure(i),e.api.asc_setProtectedWorkbook(o)}Common.NotificationCenter.trigger("edit:complete")}}).on("close",(function(){"ok"!==n&&e.view.btnProtectWB.toggle(!1,!0)}));i.show()}else{var n,o=(e=this).api.asc_getProtectedWorkbook();if(o.asc_isPassword())(i=new Common.Views.OpenDialog({title:e.view.txtWBUnlockTitle,closable:!0,type:Common.Utils.importTextType.DRM,txtOpenFile:e.view.txtWBUnlockDescription,validatePwd:!1,handler:function(t,i){n=t,"ok"==t&&(e.api&&(o.asc_setLockStructure(i&&i.drmOptions?i.drmOptions.asc_getPassword():void 0),e.api.asc_setProtectedWorkbook(o)),Common.NotificationCenter.trigger("edit:complete"))}}).on("close",(function(){"ok"!==n&&e.view.btnProtectWB.toggle(!0,!0)}))).show();else o.asc_setLockStructure(),e.api.asc_setProtectedWorkbook(o)}},onSheetClick:function(t){if(this.view.btnProtectSheet.toggle(!t,!0),t){var e=(n=this).api.asc_getProtectedSheet(),i=new SSE.Views.ProtectDialog({type:"sheet",props:e,handler:function(t,e,i){o=t,"ok"==t&&(i.asc_setSheet(e),n.api.asc_setProtectedSheet(i)),Common.NotificationCenter.trigger("edit:complete")}}).on("close",(function(){"ok"!==o&&n.view.btnProtectSheet.toggle(!1,!0)}));i.show()}else{var n,o;if((e=(n=this).api.asc_getProtectedSheet()).asc_isPassword())(i=new Common.Views.OpenDialog({title:n.view.txtSheetUnlockTitle,closable:!0,type:Common.Utils.importTextType.DRM,txtOpenFile:n.view.txtSheetUnlockDescription,validatePwd:!1,handler:function(t,i){o=t,"ok"==t&&(n.api&&(e.asc_setSheet(i&&i.drmOptions?i.drmOptions.asc_getPassword():void 0),n.api.asc_setProtectedSheet(e)),Common.NotificationCenter.trigger("edit:complete"))}}).on("close",(function(){"ok"!==o&&n.view.btnProtectSheet.toggle(!0,!0)}))).show();else e.asc_setSheet(),n.api.asc_setProtectedSheet(e)}},onRangesClick:function(){var t=this,e=t.api.asc_getProtectedRanges();new SSE.Views.ProtectRangesDlg({api:t.api,props:e,handler:function(e,i){"protect-sheet"==e?(t.api.asc_setProtectedRanges(i.arr,i.deletedArr),t.onSheetClick(!0)):"ok"==e&&t.api.asc_setProtectedRanges(i.arr,i.deletedArr),Common.NotificationCenter.trigger("edit:complete")}}).show()},onLockOptionClick:function(t,e){switch(t){case 0:this.api.asc_setCellLocked("checked"==e);break;case 1:(i=new Asc.asc_CImgProperty).asc_putProtectionLocked("checked"==e),this.api.asc_setGraphicObjectProps(i);break;case 2:var i;(i=new Asc.asc_CImgProperty).asc_putProtectionLockText("checked"==e),this.api.asc_setGraphicObjectProps(i);break;case 3:this.api.asc_setCellHiddenFormulas("checked"==e)}Common.NotificationCenter.trigger("edit:complete",this)},onAppReady:function(t){if(this.view){var e=this;new Promise((function(t){t()})).then((function(){e.view.btnProtectWB.toggle(e.api.asc_isProtectedWorkbook(),!0);var t=e.getWSProps();e.view.btnProtectSheet.toggle(t.wsLock,!0),Common.Utils.lockControls(Common.enumLock.Objects,t.wsProps.Objects,{array:[e.view.chLockedText,e.view.chLockedShape]}),Common.Utils.lockControls(Common.enumLock.wsLock,t.wsLock,{array:[e.view.btnAllowRanges]})}))}},onChangeProtectWorkbook:function(){this.view&&this.view.btnProtectWB.toggle(this.api.asc_isProtectedWorkbook(),!0)},onChangeProtectSheet:function(){var t=this.getWSProps(!0);this.view&&t&&(this.view.btnProtectSheet.toggle(t.wsLock,!0),Common.Utils.lockControls(Common.enumLock.Objects,t.wsProps.Objects,{array:[this.view.chLockedText,this.view.chLockedShape]}),Common.Utils.lockControls(Common.enumLock.wsLock,t.wsLock,{array:[this.view.btnAllowRanges]})),Common.NotificationCenter.trigger("protect:wslock",t)},onActiveSheetChanged:function(){this.onChangeProtectSheet()},getWSProps:function(t){if(this.appConfig&&(this.appConfig.isEdit||this.appConfig.isRestrictedEdit)){if(t||!this._state.protection){var e=!!this.api.asc_isProtectedSheet(),i=[];if(e){i=[];var n=this.api.asc_getProtectedSheet();n&&this.wsLockOptions.forEach((function(t){i[t]=!!n["asc_get"+t]&&n["asc_get"+t]()}))}else this.wsLockOptions.forEach((function(t){i[t]=!1}));this._state.protection={wsLock:e,wsProps:i}}return this._state.protection}},onApiSelectionChanged:function(t){if(this.view&&!($(".asc-window.enable-key-events:visible").length>0)){var e=t.asc_getSelectionType(),i=e===Asc.c_oAscSelectionType.RangeCells||e===Asc.c_oAscSelectionType.RangeCol||e===Asc.c_oAscSelectionType.RangeRow||e===Asc.c_oAscSelectionType.RangeMax;Common.Utils.lockControls(Common.enumLock.selRange,i,{array:[this.view.chLockedText,this.view.chLockedShape]});var n=t.asc_getXfs();if(this.view.chLockedCell.setValue(!!n.asc_getLocked(),!0),this.view.chHiddenFormula.setValue(!!n.asc_getHidden(),!0),e===Asc.c_oAscSelectionType.RangeSlicer||e===Asc.c_oAscSelectionType.RangeImage||e===Asc.c_oAscSelectionType.RangeShape||e===Asc.c_oAscSelectionType.RangeShapeText||e===Asc.c_oAscSelectionType.RangeChart||e===Asc.c_oAscSelectionType.RangeChartText)for(var o=this.api.asc_getGraphicObjectProps(),s=0;s<o.length;s++)if(o[s].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var a=o[s].asc_getObjectValue(),l=a.asc_getProtectionLockText(),r=a.asc_getProtectionLocked();this.view.chLockedText.setValue(void 0!==l?!!l:"indeterminate",!0),this.view.chLockedShape.setValue(void 0!==r?!!r:"indeterminate",!0),Common.Utils.lockControls(Common.enumLock.wsLockText,null===l,{array:[this.view.chLockedText]}),Common.Utils.lockControls(Common.enumLock.wsLockShape,null===r,{array:[this.view.chLockedShape]});break}}}},SSE.Controllers.WBProtection||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/HistoryVersion",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.HistoryVersion=e.Model.extend({defaults:function(){return{version:0,revision:0,changeid:void 0,userid:void 0,username:"Guest",usercolor:"#ff0000",created:void 0,id:Common.UI.getId(),url:"",urlDiff:"",urlGetTime:"",docId:"",docIdPrev:"",token:"",arrColors:[],markedAsVersion:!1,canRestore:!1,isRevision:!0,hasChanges:!1,isExpanded:!0,isVisible:!0,allowSelected:!0,selected:!1,serverVersion:0,fileType:"docx"}}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/HistoryVersions",["underscore","backbone","common/main/lib/model/HistoryVersion"],(function(t,e){"use strict";Common.Collections.HistoryVersions=e.Collection.extend({model:Common.Models.HistoryVersion,findRevision:function(t){return this.findWhere({revision:t})},findRevisions:function(t){return this.where({revision:t})},hasChanges:function(){return!!this.findWhere({isRevision:!1})},hasCollapsed:function(){return!!this.findWhere({isRevision:!0,hasChanges:!0,isExpanded:!1})}})})),define("common/main/lib/controller/History",["core","common/main/lib/collection/HistoryVersions","common/main/lib/view/History"],(function(){"use strict";Common.Controllers.History=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.HistoryVersions"],views:["Common.Views.History"],initialize:function(){this.currentChangeId=-1,this.currentArrColors=[],this.currentDocId="",this.currentDocIdPrev="",this.currentRev=0,this.currentServerVersion=0},events:{},onLaunch:function(){this.panelHistory=this.createView("Common.Views.History",{storeHistory:this.getApplication().getCollection("Common.Collections.HistoryVersions")}),this.panelHistory.storeHistory.on("reset",_.bind(this.onResetStore,this)),this.panelHistory.on("render:after",_.bind(this.onAfterRender,this)),Common.Gateway.on("sethistorydata",_.bind(this.onSetHistoryData,this))},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.api.asc_registerCallback("asc_onExpiredToken",_.bind(this.onExpiredToken,this)),this},setMode:function(t){this.mode=t,t.canHistoryClose||(this.panelHistory.$el.find("#history-header").hide(),this.panelHistory.$el.find("#history-list").css("padding-top",0))},onAfterRender:function(t){t.viewHistoryList.on("item:click",_.bind(this.onSelectRevision,this)),t.btnBackToDocument.on("click",_.bind(this.onClickBackToDocument,this)),t.btnExpand.on("click",_.bind(this.onClickExpand,this))},onResetStore:function(){var t=this.panelHistory.storeHistory.hasChanges();this.panelHistory.$el.find("#history-expand-changes")[t?"show":"hide"](),this.panelHistory.$el.find("#history-list").css("padding-bottom",t?"45px":0)},onDownloadUrl:function(t,e){void 0!==this.isFromSelectRevision&&Common.Gateway.requestRestore(this.isFromSelectRevision,t,e),this.isFromSelectRevision=void 0},onSelectRevision:function(t,e,i,n){if(n){var o=$(n.target);if(o&&o.hasClass("revision-restore")){if(i.get("isRevision"))Common.Gateway.requestRestore(i.get("revision"),void 0,i.get("fileType"));else{this.isFromSelectRevision=i.get("revision");var s=Asc.c_oAscFileType[(i.get("fileType")||"").toUpperCase()]||Asc.c_oAscFileType.DOCX;this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(s,!0))}return}}!t&&i&&this.panelHistory.viewHistoryList.scrollToRecord(i);var a=i.get("url"),l=i.get("revision"),r=new Date;if(this.currentChangeId=i.get("changeid"),this.currentArrColors=i.get("arrColors"),this.currentDocId=i.get("docId"),this.currentDocIdPrev=i.get("docIdPrev"),this.currentRev=l,this.currentServerVersion=i.get("serverVersion"),_.isEmpty(a)||r-i.get("urlGetTime")>3e5){var c=this;c.timerId||(c.timerId=setTimeout((function(){c.timerId=0}),3e4),_.delay((function(){Common.Gateway.requestHistoryData(l)}),10))}else{var d=this.getApplication().getController("Common.Controllers.Comments");d&&(d.onApiHideComment(),d.clearCollections());var h=i.get("urlDiff"),p=i.get("token"),m=new Asc.asc_CVersionHistory;m.asc_setDocId(_.isEmpty(h)?this.currentDocId:this.currentDocIdPrev),m.asc_setUrl(a),m.asc_setUrlChanges(h),m.asc_setCurrentChangeId(this.currentChangeId),m.asc_setArrColors(this.currentArrColors),m.asc_setToken(p),m.asc_setIsRequested(!1),m.asc_setServerVersion(this.currentServerVersion),this.api.asc_showRevision(m);var u=this.getApplication().getController("Common.Controllers.ReviewChanges");u&&u.onApiShowChange()}},onSetHistoryData:function(t){if(this.mode.canUseHistory)if(this.timerId&&(clearTimeout(this.timerId),this.timerId=0),t.data.error){var e={title:this.notcriticalErrorTitle,msg:t.data.error,iconCls:"warn",buttons:["ok"]};Common.UI.alert(e)}else{var i=this.getApplication().getController("Common.Controllers.Comments");i&&(i.onApiHideComment(),i.clearCollections());var n=t.data,o=this.getApplication().getCollection("Common.Collections.HistoryVersions");if(o&&null!==n){var s,a=o.findRevisions(n.version),l=new Date,r=t.data.previous&&void 0!==this.currentChangeId?t.data.changesUrl:null,c=!_.isEmpty(r)&&t.data.previous?t.data.previous.url:t.data.url,d=!_.isEmpty(r)&&t.data.previous?t.data.previous.fileType:t.data.fileType,h=t.data.key?t.data.key:this.currentDocId,p=t.data.previous&&t.data.previous.key?t.data.previous.key:this.currentDocIdPrev,m=t.data.token;if(a&&a.length>0)for(var u=0;u<a.length;u++)(s=a[u]).set("url",c,{silent:!0}),s.set("urlDiff",r,{silent:!0}),s.set("urlGetTime",l,{silent:!0}),t.data.key&&(s.set("docId",h,{silent:!0}),s.set("docIdPrev",p,{silent:!0})),s.set("token",m,{silent:!0}),d&&s.set("fileType",d,{silent:!0});var g=new Asc.asc_CVersionHistory;g.asc_setUrl(c),g.asc_setUrlChanges(r),g.asc_setDocId(_.isEmpty(r)?h:p),g.asc_setCurrentChangeId(this.currentChangeId),g.asc_setArrColors(this.currentArrColors),g.asc_setToken(m),g.asc_setIsRequested(!0),g.asc_setServerVersion(this.currentServerVersion),this.api.asc_showRevision(g),this.currentRev=n.version;var f=this.getApplication().getController("Common.Controllers.ReviewChanges");f&&f.onApiShowChange()}}},onExpiredToken:function(){var t=this;_.delay((function(){Common.Gateway.requestHistoryData(t.currentRev)}),10)},onClickBackToDocument:function(){Common.Gateway.requestHistoryClose()},onClickExpand:function(){var t=this.panelHistory.storeHistory,e=t.hasCollapsed();t.where({isRevision:!0,hasChanges:!0,isExpanded:!e}).forEach((function(t){t.set("isExpanded",e)})),t.where({isRevision:!1}).forEach((function(t){t.set("isVisible",e)})),this.panelHistory.viewHistoryList.scroller.update({minScrollbarLength:this.panelHistory.viewHistoryList.minScrollbarLength}),this.panelHistory.btnExpand.cmpEl.text(e?this.panelHistory.textHideAll:this.panelHistory.textShowAll)},notcriticalErrorTitle:"Warning"},Common.Controllers.History||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Comment",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.Comment=e.Model.extend({defaults:{uid:0,guid:"",userid:0,username:"Guest",parsedName:"Guest",parsedGroups:void 0,usercolor:null,date:void 0,quote:"",comment:"",resolved:!1,lock:!1,lockuserid:"",unattached:!1,userdata:"",position:-1,id:Common.UI.getId(),time:0,showReply:!1,showReplyInPopover:!1,editText:!1,editTextInPopover:!1,last:void 0,replys:[],hideAddReply:!1,scope:null,hide:!1,filtered:!1,hint:!1,dummy:void 0,editable:!0,removable:!0}}),Common.Models.Reply=e.Model.extend({defaults:{time:0,userid:0,username:"Guest",parsedName:"Guest",usercolor:null,reply:"",date:void 0,userdata:"",id:Common.UI.getId(),editText:!1,editTextInPopover:!1,scope:null,editable:!0,removable:!0,hide:!1}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Comments",["underscore","backbone","common/main/lib/model/Comment"],(function(t,e){"use strict";Common.Collections.Comments=e.Collection.extend({model:Common.Models.Comment,groups:null,clearEditing:function(){this.each((function(t){t.set("editText",!1),t.set("editTextInPopover",!1),t.set("showReply",!1),t.set("showReplyInPopover",!1),t.set("hideAddReply",!1)}))},getCommentsReplysCount:function(t){var e=0;return this.each((function(i){i.get("userid")==t&&e++;var n=i.get("replys");n&&n.length>0&&n.forEach((function(i){i.get("userid")==t&&e++}))})),e}})})),define("text!common/main/lib/template/CommentsPopover.template",[],(function(){return'<% if (!hide) { %>\r\n<div id="<%=id%>" class="user-comment-item">\r\n\r\n    \x3c!-- comment block --\x3e\r\n\r\n    <div class="user-name">\r\n        <div class="color" style="display: inline-block; background-color: <% if (usercolor!==null) { %><%=usercolor%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getEncodedName(parsedName) %>\r\n    </div>\r\n    <div class="user-date"><%=date%></div>\r\n    <% if (!editTextInPopover || hint || scope.viewmode) { %>\r\n        <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(comment)%></div>\r\n    <% } else { %>\r\n        <div class="inner-edit-ct">\r\n            <textarea class="msg-reply user-select" maxlength="maxCommLength" spellcheck="false" <% if (!!dummy) { %> placeholder="textMention"<% } %>><%=comment%></textarea>\r\n            <% if (hideAddReply) { %>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textAdd</button>\r\n            <% } else { %>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textEdit</button>\r\n            <% } %>\r\n            <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- replys elements --\x3e\r\n\r\n    <% var add_arrow = true; %>\r\n    <% if (replys.length) { %>\r\n        <% _.each(replys, function (item) { %>\r\n            <% if (!item.get("hide")) { %>\r\n            <% if (add_arrow) { add_arrow = false; %>\r\n                <div class="reply-arrow img-commonctrl"></div>\r\n            <% } %>\r\n            <div class="reply-item-ct">\r\n                <div class="user-name">\r\n                    <div class="color" style="display: inline-block; background-color: <% if (item.get("usercolor")!==null) { %><%=item.get("usercolor")%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getEncodedName(item.get("parsedName")) %>\r\n                </div>\r\n                <div class="user-date"><%=item.get("date")%></div>\r\n                <% if (!item.get("editTextInPopover")) { %>\r\n                    <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(item.get("reply"))%></div>\r\n                    <% if (!hint && !scope.viewmode) { %>\r\n                        <div class="btns-reply-ct">\r\n                            <% if (item.get("editable")) { %>\r\n                                <div class="btn-edit img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <%}%>\r\n                            <% if (item.get("removable")) { %>\r\n                               <div class="btn-delete img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <%}%>\r\n                        </div>\r\n                    <%}%>\r\n                <% } else { %>\r\n                    <div class="inner-edit-ct">\r\n                        <textarea class="msg-reply textarea-fix user-select" maxlength="maxCommLength" spellcheck="false"><%=item.get("reply")%></textarea>\r\n                        <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change-popover">textEdit</button>\r\n                        <button class="btn normal dlg-btn btn-inner-close">textClose</button>\r\n                    </div>\r\n                <% } %>\r\n            </div>\r\n            <% } %>\r\n        <% }); %>\r\n    <% } %>\r\n\r\n    \x3c!-- add reply button --\x3e\r\n\r\n    <% if (!showReplyInPopover && !hideAddReply && !hint && !scope.viewmode) { %>\r\n        <% if (replys.length && !add_arrow) { %>\r\n            <label class="user-reply" style="margin-left: 20px; margin-top: 5px;" role="presentation" tabindex="-1">textAddReply</label>\r\n        <% } else { %>\r\n            <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n        <% } %>\r\n    <% } %>\r\n\r\n    \x3c!-- edit buttons --\x3e\r\n\r\n    <% if (!editTextInPopover && !lock) { %>\r\n        <div class="edit-ct">\r\n            <% if (!hint && !scope.viewmode) { %>\r\n                <% if (editable) { %>\r\n                    <div class="btn-edit img-commonctrl"></div>\r\n                <% } %>\r\n                <% if (removable) { %>\r\n                    <div class="btn-delete img-commonctrl"></div>\r\n                <% } %>\r\n            <% } %>\r\n            <% if (editable && !hint && !scope.viewmode) { %>\r\n                <div class="btn-resolve <% if (resolved) print(\'comment-resolved\') %>" data-toggle="tooltip"></div>\r\n            <% } else if (!hint && (!editable || scope.viewmode) && resolved) { %>\r\n                <div class="icon-resolve i-comment-resolved" data-toggle="tooltip"></div>\r\n            <% } %>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- reply --\x3e\r\n\r\n    <% if (showReplyInPopover) { %>\r\n        <div class="reply-ct">\r\n            <textarea class="msg-reply user-select" placeholder="textAddReply" maxlength="maxCommLength" spellcheck="false"></textarea>\r\n            <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change-popover">textReply</button>\r\n            <button class="btn normal dlg-btn btn-close">textClose</button>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- locked user --\x3e\r\n\r\n    <% if (lock) { %>\r\n        <div class="lock-area" style="cursor: default;"></div>\r\n        <div class="lock-author" style="cursor: default;"><%=lockuserid%></div>\r\n    <% } %>\r\n\r\n</div>\r\n<% } %>'})),define("text!common/main/lib/template/ReviewChangesPopover.template",[],(function(){return'<div id="<%=id%>" class="user-comment-item">\r\n    <div class="user-name">\r\n        <div class="color" style="display: inline-block; background-color: <% if (usercolor!==null) { %><%=usercolor%><% } else { %> #cfcfcf <% } %>; " ></div><%= scope.getUserName(username) %>\r\n    </div>\r\n    <div class="user-date"><%=date%></div>\r\n    <div class="user-message limit-height"><%=changetext%></div>\r\n    <div class="edit-ct">\r\n        <% if (goto) { %>\r\n        <div class="btn-goto img-commonctrl"></div>\r\n        <% } %>\r\n        <% if (!hint) { %>\r\n            <% if (scope.appConfig.isReviewOnly) { %>\r\n                <% if (editable) { %>\r\n                <div class="btn-delete img-commonctrl"></div>\r\n                <% } %>\r\n            <% } else if (editable) { %>\r\n            <div class="btn-accept"></div>\r\n            <div class="btn-reject tool "></div>\r\n            <% } %>\r\n        <% } %>\r\n    </div>\r\n    <% if (!hint && lock) { %>\r\n    <div class="lock-area" style="cursor: default;"></div>\r\n    <div class="lock-author" style="cursor: default;"><%=lockuser%></div>\r\n    <% } %>\r\n</div>'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/ReviewPopover",["text!common/main/lib/template/CommentsPopover.template","text!common/main/lib/template/ReviewChangesPopover.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t,e){"use strict";function i(t,e){var i,n,o=t;for(i in e)void 0!==i&&(n=e[i],o=o.replace(new RegExp(i,"g"),n));return o}Common.Views.ReviewPopover=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};return _.extend(e,{closable:!1,width:265,height:120,header:!1,modal:!1,alias:"Common.Views.ReviewPopover"},t),this.template=t.template||['<div class="box">','<div id="id-popover" class="comments-popover" style="overflow-y: hidden;position: relative;">','<div id="id-review-popover"></div>','<div id="id-comments-popover"></div>',"</div>",'<div id="id-comments-arrow" class="comments-arrow"></div>',"</div>"].join(""),this.commentsStore=t.commentsStore,this.reviewStore=t.reviewStore,this.canRequestUsers=t.canRequestUsers,this.canRequestSendNotify=t.canRequestSendNotify,this.mentionShare=t.mentionShare,this.api=t.api,this.externalUsers=[],this._state={commentsVisible:!1,reviewVisible:!1},e.tpl=_.template(this.template)(e),this.arrow={margin:20,width:10,height:30},this.sdkBounds={width:0,height:0,padding:10,paddingTop:20},Common.UI.Window.prototype.initialize.call(this,e),this.canRequestUsers&&(Common.Gateway.on("setusers",_.bind(this.setUsers,this)),Common.NotificationCenter.on("mentions:clearusers",_.bind(this.clearUsers,this))),this},render:function(n,o){Common.UI.Window.prototype.render.call(this);var s=this,a=this.$window;a.css({height:"",minHeight:"",overflow:"hidden",position:"absolute",zIndex:"990"});var l=a.find(".body");l&&l.css("position","relative");var r,c=Common.UI.DataView.extend((r=s,{options:{handleSelect:!1,allowScrollbar:!1,template:_.template('<div class="dataview-ct inner" style="overflow-y: visible;"></div>')},getTextBox:function(){var t=$(this.el).find("textarea");return t&&t.length?t:void 0},setFocusToTextBox:function(t){var e=$(this.el).find("textarea");if(t)e.blur();else if(e&&e.length){var i=e.val();e.focus(),e.val(""),e.val(i)}},getActiveTextBoxVal:function(){var t=$(this.el).find("textarea");return t&&t.length?t.val().trim():""},autoHeightTextBox:function(){var t=this.$el.find("textarea"),e=null,i=0,n=0,o=0;function a(){n=r.scroller.getScrollTop(),e.scrollHeight>e.clientHeight?e.clientHeight+2<parseInt($(e).css("max-height"))&&(t.css({height:e.scrollHeight+i+"px"}),r.calculateSizeOfContent()):e.clientHeight>=55&&(t.css({height:"55px"}),e.scrollHeight>e.clientHeight&&(o=Math.max(e.scrollHeight+i,55),t.css({height:o+"px"})),r.calculateSizeOfContent(),r.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),r.calculateSizeOfContent()),r.scroller.scrollTop(n),r.autoScrollToEditButtons()}t&&t.length&&r.scroller&&(e=t.get(0))&&(i=.25*parseInt(t.css("lineHeight"),10),a(),t.bind("input propertychange",a)),this.textBox=t},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=void 0)}}));if(c)if(this.commentsView)this.commentsView.render($("#id-comments-popover")),this.commentsView.onResetItems();else{this.commentsView=new c({el:$("#id-comments-popover"),itemTemplate:_.template(i(t,{textAddReply:s.textAddReply,textAdd:s.textAdd,textCancel:s.textCancel,textEdit:s.textEdit,textReply:s.textReply,textClose:s.textClose,maxCommLength:Asc.c_oAscMaxCellOrCommentLength,textMention:s.canRequestSendNotify?s.mentionShare?s.textMention:s.textMentionNotify:""}))});var d=function(t,e,i){e.tipsArray&&e.tipsArray.forEach((function(t){t.remove()}));var n=[],o=$(e.el).find(".btn-resolve:not(.comment-resolved)");o.tooltip({title:s.textResolve,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(o=$(e.el).find(".comment-resolved")).tooltip({title:s.textOpenAgain,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(o=$(e.el).find(".i-comment-resolved")).tooltip({title:s.textViewResolved,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(o=$(e.el).find(".btn-edit")).tooltip({title:s.txtEditTip,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(o=$(e.el).find(".btn-delete")).tooltip({title:s.txtDeleteTip,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),e.tipsArray=n,this.autoHeightTextBox()};this.commentsView.on("item:add",d),this.commentsView.on("item:remove",d),this.commentsView.on("item:change",d),this.commentsView.cmpEl.on("mouseover",(function(){s._isMouseOver=!0})).on("mouseout",(function(){s._isMouseOver=!1})),this.commentsView.setStore(s.commentsStore),this.commentsView.onResetItems(),this.commentsView.on("item:click",(function(t,e,i,n){var o,a,l,r,c,d;function h(){s.update()}if(o=$(n.target)){if(a=i.get("editTextInPopover"),l=i.get("showReplyInPopover"),d=i.get("hideAddReply"),r=i.get("uid"),c=o.attr("data-value"),i.get("hint"))return void s.fireEvent("comment:disableHint",[i]);if(o.hasClass("btn-edit"))(u=o.data("bs.tooltip"))&&(u.dontShow=!0),_.isUndefined(c)?a||(s.fireEvent("comment:closeEditing"),i.set("editTextInPopover",!0),s.fireEvent("comment:show",[r]),this.autoHeightTextBox(),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),h(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox()):(s.fireEvent("comment:closeEditing",[r]),s.fireEvent("comment:editReply",[r,c,!0]),this.replyId=c,this.autoHeightTextBox(),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),h(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox());else if(o.hasClass("btn-delete")){(u=o.data("bs.tooltip"))&&(u.dontShow=!0),_.isUndefined(c)?s.fireEvent("comment:remove",[r]):(s.fireEvent("comment:removeReply",[r,c]),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent()),s.fireEvent("comment:closeEditing"),h()}else if(o.hasClass("user-reply"))s.fireEvent("comment:closeEditing"),i.set("showReplyInPopover",!0),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),h(),this.autoHeightTextBox(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox();else if(o.hasClass("btn-reply",!1))l&&(this.clearTextBoxBind(),s.fireEvent("comment:addReply",[r,this.getActiveTextBoxVal()]),s.fireEvent("comment:closeEditing"),s.calculateSizeOfContent(),h());else if(o.hasClass("btn-close",!1))s.fireEvent("comment:closeEditing",[r]),s.calculateSizeOfContent(),s.fireEvent("comment:show",[r]),h();else if(o.hasClass("btn-inner-edit",!1)){if(i.get("dummy")){var p=this.getActiveTextBoxVal();if(s.clearDummyText(),p.length>0)s.fireEvent("comment:addDummyComment",[p]);else{var m=s.$window.find("textarea:not(.user-message)");m&&m.length&&setTimeout((function(){m.focus()}),10)}return}this.clearTextBoxBind(),_.isUndefined(this.replyId)?a&&(s.fireEvent("comment:change",[r,this.getActiveTextBoxVal()]),s.fireEvent("comment:closeEditing"),s.calculateSizeOfContent()):(s.fireEvent("comment:changeReply",[r,this.replyId,this.getActiveTextBoxVal()]),this.replyId=void 0,s.fireEvent("comment:closeEditing")),h()}else if(o.hasClass("btn-inner-close",!1)){if(i.get("dummy"))return s.clearDummyText(),void s.hide();d&&this.getActiveTextBoxVal().length>0?(s.saveText(),i.set("hideAddReply",!1),this.getTextBox().val(s.textVal),this.autoHeightTextBox()):(this.clearTextBoxBind(),s.fireEvent("comment:closeEditing",[r])),this.replyId=void 0,s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),h()}else if(o.hasClass("btn-resolve")){var u;(u=o.data("bs.tooltip"))&&(u.dontShow=!0),s.fireEvent("comment:resolve",[r]),h()}}})),this.emailMenu=new Common.UI.Menu({maxHeight:200,cyclic:!1,items:[]}).on("render:after",(function(t){this.scroller=new Common.UI.Scroller({el:$(this.el).find(".dropdown-menu "),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,alwaysVisibleY:!0})})).on("show:after",(function(){this.scroller.update({alwaysVisibleY:!0}),s.$window.css({zIndex:"1001"})})).on("hide:after",(function(){s.$window.css({zIndex:"990"})})),s.on({show:function(){s.commentsView.autoHeightTextBox(),s.$window.find("textarea").keydown((function(t){t.keyCode==Common.UI.Keys.ESC&&s.hide(!0)}))},"animate:before":function(){var t=s.$window.find("textarea");t&&t.length&&t.focus()}})}var h=Common.UI.DataView.extend({options:{handleSelect:!1,scrollable:!0,template:_.template('<div class="dataview-ct inner" style="overflow-y: visible;"></div>')}});if(h)if(this.reviewChangesView)this.reviewChangesView.render($("#id-review-popover")),this.reviewChangesView.onResetItems();else{this.reviewChangesView=new h({el:$("#id-review-popover"),itemTemplate:_.template(e)});d=function(t,e,i){e.tipsArray&&e.tipsArray.forEach((function(t){t.remove()}));var n=[],o=$(e.el).find(".btn-goto");o.tooltip({title:s.textFollowMove,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(o=$(e.el).find(".btn-accept")).tooltip({title:s.txtAccept,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(o=$(e.el).find(".btn-reject")).tooltip({title:s.txtReject,placement:"cursor"}),o.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),e.tipsArray=n};this.reviewChangesView.on("item:add",d),this.reviewChangesView.on("item:remove",d),this.reviewChangesView.on("item:change",d),this.reviewChangesView.on("item:click",(function(t,e,i,n){var o=$(n.target);if(o)if(o.hasClass("btn-accept"))(a=o.data("bs.tooltip"))&&(a.dontShow=!0),s.fireEvent("reviewchange:accept",[i.get("changedata")]);else if(o.hasClass("btn-reject")){(a=o.data("bs.tooltip"))&&(a.dontShow=!0),s.fireEvent("reviewchange:reject",[i.get("changedata")])}else if(o.hasClass("btn-delete"))s.fireEvent("reviewchange:delete",[i.get("changedata")]);else if(o.hasClass("btn-goto")){var a;(a=o.data("bs.tooltip"))&&(a.dontShow=!0),s.fireEvent("reviewchange:goto",[i.get("changedata")])}})),this.reviewChangesView.setStore(s.reviewStore),this.reviewChangesView.onResetItems()}_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:a.find("#id-popover"),minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:!0}))},showComments:function(t,e,i,n){this.options.animate=t;var o=this.commentsView.getTextBox();e&&this.textVal&&o&&o.val(this.textVal),n&&n.length&&o&&o.val(n),this.show(t),this.hookTextBox(),this._state.commentsVisible=!0},showReview:function(t,e,i){this.show(t),this._state.reviewVisible=!0},show:function(t,e,i,n){this.options.animate=t,Common.UI.Window.prototype.show.call(this),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},hideComments:function(){this.handlerHide&&this.handlerHide(),this.hideTips(),this._state.commentsVisible=!1,this._state.reviewVisible?this.calculateSizeOfContent():this.hide()},hideReview:function(){this.handlerHide&&this.handlerHide(),this.hideTips(),this._state.reviewVisible=!1,this._state.commentsVisible?this.calculateSizeOfContent():this.hide()},hide:function(){this.handlerHide&&this.handlerHide.apply(this,arguments),this.hideTips(),Common.UI.Window.prototype.hide.call(this),_.isUndefined(this.e)||this.e.keyCode!=Common.UI.Keys.ESC||(this.e.preventDefault(),this.e.stopImmediatePropagation(),this.e=void 0)},update:function(t){this.commentsView&&t&&this.commentsView.onResetItems(),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},isVisible:function(){return this.$window&&this.$window.is(":visible")},setLeftTop:function(t,e,i,n,o){if(this.$window||this.render(),n&&(t=this.arrowPosX,e=this.arrowPosY,i=this.leftX),!_.isUndefined(t)||!_.isUndefined(e)){this.arrowPosX=t,this.arrowPosY=e,this.leftX=i;var s=$("#id-popover"),a=$("#id-comments-arrow"),l=$("#editor_sdk"),r=null,c=0,d="",h=0,p="",m=0,u="",g=0,f="",b=0,C=0,v=0,x=0,y=0,w=0;s&&a&&l&&l.get(0)&&(r=l.get(0).getBoundingClientRect())&&(c=r.height-2*this.sdkBounds.padding,this.$window.css({maxHeight:c+"px"}),this.sdkBounds.width=r.width,this.sdkBounds.height=r.height,_.isUndefined(t)||(((d=$("#id_vertical_scroll")).length||(d=$("#ws-v-scrollbar")).length)&&(h="none"!==d.css("display")?d.width():0),this.sdkBounds.width-=h,(p=$("#id_panel_left")).length&&(m="none"!==p.css("display")?p.width():0),(u=$("#id_panel_thumbnails")).length&&(g="none"!==u.css("display")?u.width():0,this.sdkBounds.width-=g),C=Math.min(0+t+this.arrow.width,0+this.sdkBounds.width-this.$window.outerWidth()-25),C=Math.max(0+m+this.arrow.width,C),a.removeClass("right top bottom").addClass("left"),a.css({left:""}),_.isUndefined(i)||(v=this.$window.outerWidth())&&(t+v>this.sdkBounds.width-this.arrow.width+5&&this.leftX>v?(C=this.leftX-v+0-this.arrow.width,a.removeClass("left").addClass("right")):C=0+t+this.arrow.width),this.$window.css("left",C+"px")),_.isUndefined(e)||(w=0,(f=$("#id_panel_top")).length?(b="none"!==f.css("display")?f.height():0,w+=this.sdkBounds.paddingTop):(f=$("#ws-h-scrollbar")).length&&(b="none"!==f.css("display")?f.height():0),this.sdkBounds.height-=b,x=this.$window.outerHeight(),y=Math.min(0+c-x,this.arrowPosY+0-this.arrow.height),y=Math.max(y,w),parseInt(a.css("top"))+this.arrow.height>x&&a.css({top:x-this.arrow.height+"px"}),this.$window.css("top",y+"px"))),o&&!this.isOverCursor()||this.calculateSizeOfContent()}},calculateSizeOfContent:function(t){if(!t||this.$window.is(":visible")){this.$window.css({overflow:"hidden"});var e=$("#id-comments-arrow"),i=$("#id-popover"),n=null,o=null,s=null,a=0,l="",r=0,c=0,d=0,h=0,p=0,m=0,u=0;if(i&&e&&i.get(0)){var g=this.scroller.getScrollTop();if(i.css({height:"100%"}),(n=i.get(0).getBoundingClientRect())&&(o=$("#editor_sdk"))&&o.get(0)&&(s=o.get(0).getBoundingClientRect())){a=s.height-2*this.sdkBounds.padding,u=0,h=this.$window.outerHeight(),(l=$("#id_panel_top")).length?(r="none"!==l.css("display")?l.height():0,u+=this.sdkBounds.paddingTop):(l=$("#ws-h-scrollbar")).length&&(r="none"!==l.css("display")?l.height():0),p=Math.max(i.outerHeight(),this.$window.outerHeight());var f=this.isOverCursor();if(f){var b=parseInt(this.$window.css("left"))-this.arrow.width,C=f[1][1]+r+this.arrow.width,v=f[0][1]+r-this.arrow.width,_=!1;if(C+p>0+a){var x=0+a-C;if(v-p<0){var y=v-0;x<.9*y?(this.$window.css({maxHeight:y+"px",top:"0px"}),i.css({height:y-3+"px"})):(this.$window.css({maxHeight:x+"px",top:C+"px"}),_=!0,i.css({height:x-3+"px"}))}else this.$window.css("top",v-p+"px")}else _=!0,this.$window.css("top",C+"px");b-=this.arrow.height,this.$window.css("left",b+"px"),d=f[_?1:0][0],d=Math.max(0,d-b-this.arrow.height/2),d=Math.min(d,this.$window.outerWidth()-this.arrow.height),e.css({top:"",left:d+"px"}),e.toggleClass("top",_),e.toggleClass("bottom",!_),e.removeClass("left right")}else a<=p?(this.$window.css({maxHeight:a-r+"px",top:0+r+"px"}),i.css({height:a-r-3+"px"}),c=Math.min(c,a-(r+this.arrow.margin+this.arrow.height)),e.css({top:c+"px",left:""}),e.removeClass("top bottom right"),e.addClass("left"),this.scroller.scrollTop(g)):((p=h)>0&&(n.top+p>a+0||0===n.height)&&(m=Math.min(0+a-p,this.arrowPosY+0-this.arrow.height),m=Math.max(m,u),this.$window.css({top:m+"px"})),c=Math.max(this.arrow.margin,this.arrowPosY-(a-p)-this.arrow.height),c=Math.min(c,p-this.arrow.margin-this.arrow.height),e.css({top:c+"px",left:""}),e.removeClass("top bottom right"),e.addClass("left"))}}this.$window.css({overflow:""}),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}},isOverCursor:function(){if(this.api.asc_GetSelectionBounds){var t=this.api.asc_GetSelectionBounds(),e=Math.abs(t[0][0]-t[1][0])<.1&&Math.abs(t[0][1]-t[1][1])<.1&&Math.abs(t[2][0]-t[3][0])<.1&&Math.abs(t[2][1]-t[3][1])<.1,i=$("#id_panel_left"),n=0;i.length&&(n="none"!==i.css("display")?i.width():0);var o=t[0][0]+n,s=t[0][1],a=t[e?2:1][0]+n,l=t[e?2:1][1],r=parseInt(this.$window.css("left"))-this.arrow.width,c=this.$window.outerWidth()+this.arrow.width,d=parseInt(this.$window.css("top")),h=this.$window.outerHeight();if(o>r&&o<r+c&&s>d&&s<d+h||a>r&&a<r+c&&l>d&&l<d+h)return[s<l?[o,s]:[a,l],s>l?[o,s]:[a,l]]}},saveText:function(t){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textVal=void 0,t?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},loadText:function(){if(this.textVal&&this.commentsView){var t=this.commentsView.getTextBox();t&&t.val(this.textVal)}},getEditText:function(){if(this.commentsView)return this.commentsView.getActiveTextBoxVal()},saveDummyText:function(){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textDummyVal=this.commentsView.getActiveTextBoxVal())},clearDummyText:function(){if(this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1){this.textDummyVal=void 0;var t=this.commentsView.getTextBox();t&&t.val(""),this.commentsView.clearTextBoxBind()}},getDummyText:function(){return this.textDummyVal||""},hookTextBox:function(){var t=this,e=this.commentsView.getTextBox();e&&e.keydown((function(e){if(!e.ctrlKey&&!e.metaKey||e.altKey||e.keyCode!==Common.UI.Keys.RETURN){if(e.keyCode===Common.UI.Keys.TAB){var i,n,o;o=this.selectionStart,n=this.selectionEnd,(i=$(this)).val(i.val().substring(0,o)+"\t"+i.val().substring(n)),this.selectionStart=this.selectionEnd=o+1,e.preventDefault()}}else{var s=$("#id-comments-change-popover");s&&s.length&&s.click(),e.stopImmediatePropagation()}t.e=e})),this.canRequestUsers&&(e&&e.keydown((function(e){e.keyCode==Common.UI.Keys.SPACE||e.keyCode===Common.UI.Keys.TAB||e.keyCode==Common.UI.Keys.HOME||e.keyCode==Common.UI.Keys.END||e.keyCode==Common.UI.Keys.RIGHT||e.keyCode==Common.UI.Keys.LEFT||e.keyCode==Common.UI.Keys.UP?t.onEmailListMenu():e.keyCode==Common.UI.Keys.DOWN&&t.emailMenu&&t.emailMenu.rendered&&t.emailMenu.isVisible()&&(_.delay((function(){var e=t.emailMenu.cmpEl.find("li:not(.divider):first");(e=e.find("a")).focus()}),10),e.preventDefault()),t.e=e})),e&&e.on("input",(function(e){for(var i=$(this),n=this.selectionStart,o=i.val(),s=0,a=o.length-1,l=n-1;l>=0;l--)if(32==o.charCodeAt(l)||13==o.charCodeAt(l)||10==o.charCodeAt(l)||9==o.charCodeAt(l)){s=l+1;break}for(l=n;l<=a;l++)if(32==o.charCodeAt(l)||13==o.charCodeAt(l)||10==o.charCodeAt(l)||9==o.charCodeAt(l)){a=l-1;break}var r=o.substring(s,a+1),c=r.match(/^(?:[@]|[+](?!1))(\S*)/);c&&c.length>1?(r=c[1],t.onEmailListMenu(r,s,a)):t.onEmailListMenu()})))},hideTips:function(){this.commentsView&&_.each(this.commentsView.dataViewItems,(function(t){t.tipsArray&&t.tipsArray.forEach((function(t){t.hide()}))}),this),this.reviewChangesView&&_.each(this.reviewChangesView.dataViewItems,(function(t){t.tipsArray&&t.tipsArray.forEach((function(t){t.hide()}))}),this),this.emailMenu&&this.emailMenu.rendered&&this.emailMenu.cmpEl.css("display","none")},isCommentsViewMouseOver:function(){return this._isMouseOver},setReviewStore:function(t){this.reviewStore=t,this.reviewChangesView&&this.reviewChangesView.setStore(this.reviewStore)},setCommentsStore:function(t){this.commentsStore=t,this.commentsView&&this.commentsView.setStore(this.commentsStore)},setUsers:function(t){this.externalUsers=t.users||[],this.isUsersLoading=!1,this._state.emailSearch&&this.onEmailListMenu(this._state.emailSearch.str,this._state.emailSearch.left,this._state.emailSearch.right),this._state.emailSearch=null},clearUsers:function(){this.externalUsers=[]},getPopover:function(t){return this.popover||(this.popover=new Common.Views.ReviewPopover(t)),this.popover},autoScrollToEditButtons:function(){var t=$("#id-comments-change-popover"),e=null,i=this.$window[0].getBoundingClientRect(),n=0;t.length&&(e=t.get(0).getBoundingClientRect())&&i&&(n=i.bottom-(e.bottom+7))<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-n)},onEmailListMenu:function(t,e,i,n){var o=this,s=o.externalUsers,a=o.emailMenu;if(s.length<1){if(this._state.emailSearch={str:t,left:e,right:i},this.isUsersLoading)return;return this.isUsersLoading=!0,void Common.Gateway.requestUsers()}if("string"==typeof t){var l=o.$window.find(Common.Utils.String.format("#menu-container-{0}",a.id)),r=this.commentsView.getTextBox(),c=r?r[0]:null,d=c?[c.offsetLeft,c.offsetTop+c.clientHeight+3]:[0,0];a.rendered||(l.length<1&&(l=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',a.id)),o.$window.append(l)),a.render(l),a.cmpEl.css("min-width",c?c.clientWidth:220),a.cmpEl.attr({tabindex:"-1"}),a.on("hide:after",(function(){setTimeout((function(){var t=o.commentsView.getTextBox();t&&t.focus()}),10)})));for(var h=0;h<a.items.length;h++)a.removeItem(a.items[h]),h--;if(s.length>0){(t=t.toLowerCase()).length>0&&(s=_.filter(s,(function(e){return e.email&&0===e.email.toLowerCase().indexOf(t)||e.name&&0===e.name.toLowerCase().indexOf(t)})));var p=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem" style="font-size: 12px;"><div style="overflow: hidden; text-overflow: ellipsis; max-width: 195px;"><%= Common.Utils.String.htmlEncode(caption) %></div><div style="overflow: hidden; text-overflow: ellipsis; max-width: 195px; color: #909090;"><%= Common.Utils.String.htmlEncode(options.value) %></div></a>'),m=!1;_.each(s,(function(t,n){if(m&&!t.hasAccess&&(m=!1,a.addItem(new Common.UI.MenuItem({caption:"--"}))),t.email&&t.name){var s=new Common.UI.MenuItem({caption:t.name,value:t.email,template:p}).on("click",(function(t,n){o.insertEmailToTextbox(t.options.value,e,i)}));a.addItem(s),t.hasAccess&&(m=!0)}}))}a.items.length>0?(l.css({left:d[0],top:d[1]}),a.menuAlignEl=r,a.show(),a.cmpEl.css("display",""),a.alignPosition("bl-tl",-5),a.scroller.update({alwaysVisibleY:!0})):a.rendered&&a.cmpEl.css("display","none")}else a.rendered&&a.cmpEl.css("display","none")},insertEmailToTextbox:function(t,e,i){var n=this.commentsView.getTextBox();if(n){var o=n.val();n.val(o.substring(0,e)+"+"+t+" "+o.substring(i+1,o.length)),setTimeout((function(){n[0].selectionStart=n[0].selectionEnd=e+t.length+2}),10)}},textAddReply:"Add Reply",textAdd:"Add",textCancel:"Cancel",textEdit:"Edit",textReply:"Reply",textClose:"Close",textResolve:"Resolve",textOpenAgain:"Open Again",textFollowMove:"Follow Move",textMention:"+mention will provide access to the document and send an email",textMentionNotify:"+mention will notify the user via email",textViewResolved:"You have not permission for reopen comment",txtAccept:"Accept",txtReject:"Reject",txtEditTip:"Edit",txtDeleteTip:"Delete"},Common.Views.ReviewPopover||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Comments",["core","common/main/lib/model/Comment","common/main/lib/collection/Comments","common/main/lib/view/Comments","common/main/lib/view/ReviewPopover"],(function(){"use strict";function t(){return void 0!==Asc.asc_CCommentDataWord?new Asc.asc_CCommentDataWord(null):new Asc.asc_CCommentData(null)}Common.Controllers.Comments=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Comments"],views:["Common.Views.Comments","Common.Views.ReviewPopover"],sdkViewName:"#id_main",subEditStrings:{},filter:void 0,hintmode:!1,viewmode:!1,isSelectedComment:!1,uids:[],oldUids:[],isDummyComment:!1,initialize:function(){this.addListeners({"Common.Views.Comments":{"comment:add":_.bind(this.onCreateComment,this),"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this),"comment:sort":_.bind(this.setComparator,this),"comment:filtergroups":_.bind(this.setFilterGroups,this)},"Common.Views.ReviewPopover":{"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this),"comment:disableHint":_.bind(this.disableHint,this),"comment:addDummyComment":_.bind(this.onAddDummyComment,this)},"Common.Views.ReviewChanges":{"comment:removeComments":_.bind(this.onRemoveComments,this),"comment:resolveComments":_.bind(this.onResolveComments,this)}}),Common.NotificationCenter.on("comments:updatefilter",_.bind(this.onUpdateFilter,this)),Common.NotificationCenter.on("app:comment:add",_.bind(this.onAppAddComment,this)),Common.NotificationCenter.on("layout:changed",function(t){Common.Utils.asyncCall((function(t){"toolbar"!=t&&"status"!=t||!this.view.$el.is(":visible")||this.onAfterShow()}),this,t)}.bind(this))},onLaunch:function(){var t=Common.localStorage.getKeysFilter();this.appPrefix=t&&t.length?t.split(",")[0]:"",this.collection=this.getApplication().getCollection("Common.Collections.Comments"),this.setComparator(),this.popoverComments=new Common.Collections.Comments,this.popoverComments&&(this.popoverComments.comparator=function(t){return t.get("time")}),this.groupCollection=[],this.userGroups=[],this.view=this.createView("Common.Views.Comments",{store:this.collection}),this.view.render(),this.userCollection=this.getApplication().getCollection("Common.Collections.Users"),this.userCollection.on("reset",_.bind(this.onUpdateUsers,this)),this.userCollection.on("add",_.bind(this.onUpdateUsers,this)),this.bindViewEvents(this.view,this.events)},setConfig:function(t,e){this.setApi(e),t&&(this.currentUserId=t.config.user.id,this.sdkViewName=t.sdkviewname||this.sdkViewName,this.hintmode=t.hintmode||!1,this.viewmode=t.viewmode||!1)},setApi:function(t){t&&(this.api=t,this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this)),this.api.asc_registerCallback("asc_onRemoveComment",_.bind(this.onApiRemoveComment,this)),this.api.asc_registerCallback("asc_onChangeComments",_.bind(this.onChangeComments,this)),this.api.asc_registerCallback("asc_onRemoveComments",_.bind(this.onApiRemoveComments,this)),this.api.asc_registerCallback("asc_onChangeCommentData",_.bind(this.onApiChangeCommentData,this)),this.api.asc_registerCallback("asc_onLockComment",_.bind(this.onApiLockComment,this)),this.api.asc_registerCallback("asc_onUnLockComment",_.bind(this.onApiUnLockComment,this)),this.api.asc_registerCallback("asc_onShowComment",_.bind(this.onApiShowComment,this)),this.api.asc_registerCallback("asc_onHideComment",_.bind(this.onApiHideComment,this)),this.api.asc_registerCallback("asc_onUpdateCommentPosition",_.bind(this.onApiUpdateCommentPosition,this)),this.api.asc_registerCallback("asc_onDocumentPlaceChanged",_.bind(this.onDocumentPlaceChanged,this)),this.api.asc_registerCallback("asc_onDeleteComment",_.bind(this.onDeleteComment,this)),this.api.asc_registerCallback("asc_onChangeCommentLogicalPosition",_.bind(this.onApiChangeCommentLogicalPosition,this)))},setMode:function(t){return this.mode=t,this.isModeChanged=!0,this.view.viewmode=!this.mode.canComments,this.view.changeLayout(t),this},setComparator:function(t){if(this.collection){var e=void 0!==t;if(void 0===t&&(t=Common.localStorage.getItem(this.appPrefix+"comments-sort")||"date-desc"),Common.localStorage.setItem(this.appPrefix+"comments-sort",t),Common.Utils.InternalSettings.set(this.appPrefix+"comments-sort",t),"position-asc"==t||"position-desc"==t){var i="position-asc"==t?1:-1;this.collection.comparator=function(t){return i*t.get("position")}}else if("author-asc"==t||"author-desc"==t){i="author-asc"==t?1:-1;this.collection.comparator=function(t,e){var n=t.get("parsedName").toLowerCase(),o=e.get("parsedName").toLowerCase();return n==o?0:n<o?-i:i}}else{i="date-asc"==t?1:-1;this.collection.comparator=function(t){return i*t.get("time")}}e&&this.updateComments(!0)}},getComparator:function(){return Common.Utils.InternalSettings.get(this.appPrefix+"comments-sort")||"date"},onCreateComment:function(e,i,n,o,s){if(this.api&&i&&i.length>0){var a=t();a&&(this.showPopover=!0,this.editPopover=!!n,this.hidereply=o,this.isSelectedComment=!1,this.uids=[],a.asc_putText(i),a.asc_putTime(this.utcDateToString(new Date)),a.asc_putOnlyOfficeTime(this.ooDateToString(new Date)),a.asc_putUserId(this.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),a.asc_putSolved(!1),_.isUndefined(a.asc_putDocumentFlag)||a.asc_putDocumentFlag(s),this.api.asc_addComment(a),this.view.showEditContainer(!1))}this.view.txtComment.focus()},onRemoveComment:function(t){this.api&&t&&this.api.asc_removeComment(t)},onRemoveComments:function(t){this.api&&this.api.asc_RemoveAllComments("my"==t||!this.mode.canDeleteComments,"current"==t)},onResolveComments:function(t){this.api&&this.api.asc_ResolveAllComments("my"==t||!this.mode.canEditComments,"current"==t)},onResolveComment:function(e){var i=this,n=null,o=null,s=t(),a=i.findComment(e);return _.isUndefined(e)&&(e=a.get("uid")),!(!s||!a)&&(s.asc_putText(a.get("comment")),s.asc_putQuoteText(a.get("quote")),s.asc_putTime(i.utcDateToString(new Date(a.get("time")))),s.asc_putOnlyOfficeTime(i.ooDateToString(new Date(a.get("time")))),s.asc_putUserId(a.get("userid")),s.asc_putUserName(a.get("username")),s.asc_putSolved(!a.get("resolved")),s.asc_putGuid(a.get("guid")),s.asc_putUserData(a.get("userdata")),_.isUndefined(s.asc_putDocumentFlag)||s.asc_putDocumentFlag(a.get("unattached")),(n=a.get("replys"))&&n.length&&n.forEach((function(e){(o=t())&&(o.asc_putText(e.get("reply")),o.asc_putTime(i.utcDateToString(new Date(e.get("time")))),o.asc_putOnlyOfficeTime(i.ooDateToString(new Date(e.get("time")))),o.asc_putUserId(e.get("userid")),o.asc_putUserName(e.get("username")),o.asc_putUserData(e.get("userdata")),s.asc_addReply(o))})),i.api.asc_changeComment(e,s),!0)},onShowComment:function(t,e,i){var n=this.findComment(t);if(n)if(null!==n.get("quote")){if(this.api){if(this.hintmode){if(this.animate=!0,n.get("unattached")&&this.getPopover())return void this.getPopover().hideComments()}else if(this.popoverComments.findWhere({uid:t})&&!this.getPopover().isVisible())return this.getPopover().showComments(!0),void this.api.asc_selectComment(t);!_.isUndefined(e)&&this.hintmode&&(this.isSelectedComment=e),i&&0===_.difference(this.uids,[t]).length&&0===_.difference([t],this.uids).length||(this.api.asc_selectComment(t),this._dontScrollToComment=!0,this.api.asc_showComment(t,!1))}}else this.hintmode&&this.api.asc_selectComment(t),this.getPopover()&&this.getPopover().hideComments(),this.isSelectedComment=!1,this.uids=[]},onChangeComment:function(e,i){if(i&&i.length>0){var n=this,o=null,s=null,a=null,l=t(),r=n.findComment(e);if(r&&l)return l.asc_putText(i),l.asc_putQuoteText(r.get("quote")),l.asc_putTime(n.utcDateToString(new Date(r.get("time")))),l.asc_putOnlyOfficeTime(n.ooDateToString(new Date(r.get("time")))),l.asc_putUserId(n.currentUserId),l.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),l.asc_putSolved(r.get("resolved")),l.asc_putGuid(r.get("guid")),l.asc_putUserData(r.get("userdata")),_.isUndefined(l.asc_putDocumentFlag)||l.asc_putDocumentFlag(r.get("unattached")),r.set("editTextInPopover",!1),(o=n.findPopupComment(e))&&o.set("editTextInPopover",!1),n.subEditStrings[e]&&delete n.subEditStrings[e],n.subEditStrings[e+"-R"]&&delete n.subEditStrings[e+"-R"],(s=r.get("replys"))&&s.length&&s.forEach((function(e){(a=t())&&(a.asc_putText(e.get("reply")),a.asc_putTime(n.utcDateToString(new Date(e.get("time")))),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date(e.get("time")))),a.asc_putUserId(e.get("userid")),a.asc_putUserName(e.get("username")),a.asc_putUserData(e.get("userdata")),l.asc_addReply(a))})),n.api.asc_changeComment(e,l),!0}return!1},onChangeReplyComment:function(e,i,n){if(n&&n.length>0){var o=this,s=null,a=null,l=t(),r=o.findComment(e);if(l&&r)return l.asc_putText(r.get("comment")),l.asc_putQuoteText(r.get("quote")),l.asc_putTime(o.utcDateToString(new Date(r.get("time")))),l.asc_putOnlyOfficeTime(o.ooDateToString(new Date(r.get("time")))),l.asc_putUserId(r.get("userid")),l.asc_putUserName(r.get("username")),l.asc_putSolved(r.get("resolved")),l.asc_putGuid(r.get("guid")),l.asc_putUserData(r.get("userdata")),_.isUndefined(l.asc_putDocumentFlag)||l.asc_putDocumentFlag(r.get("unattached")),(s=r.get("replys"))&&s.length&&s.forEach((function(e){(a=t())&&(e.get("id")!==i||_.isUndefined(n)?(a.asc_putText(e.get("reply")),a.asc_putUserId(e.get("userid")),a.asc_putUserName(e.get("username"))):(a.asc_putText(n),a.asc_putUserId(o.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName())),a.asc_putTime(o.utcDateToString(new Date(e.get("time")))),a.asc_putOnlyOfficeTime(o.ooDateToString(new Date(e.get("time")))),a.asc_putUserData(e.get("userdata")),l.asc_addReply(a))})),o.api.asc_changeComment(e,l),!0}return!1},onAddReplyComment:function(e,i){if(i.length>0){var n=this,o=null,s=null,a=null,l=t(),r=n.findComment(e);if(l&&r&&((o=r.get("uid"))&&(n.subEditStrings[o]&&delete n.subEditStrings[o],n.subEditStrings[o+"-R"]&&delete n.subEditStrings[o+"-R"],r.set("showReplyInPopover",!1)),l.asc_putText(r.get("comment")),l.asc_putQuoteText(r.get("quote")),l.asc_putTime(n.utcDateToString(new Date(r.get("time")))),l.asc_putOnlyOfficeTime(n.ooDateToString(new Date(r.get("time")))),l.asc_putUserId(r.get("userid")),l.asc_putUserName(r.get("username")),l.asc_putSolved(r.get("resolved")),l.asc_putGuid(r.get("guid")),l.asc_putUserData(r.get("userdata")),_.isUndefined(l.asc_putDocumentFlag)||l.asc_putDocumentFlag(r.get("unattached")),(s=r.get("replys"))&&s.length&&s.forEach((function(e){(a=t())&&(a.asc_putText(e.get("reply")),a.asc_putTime(n.utcDateToString(new Date(e.get("time")))),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date(e.get("time")))),a.asc_putUserId(e.get("userid")),a.asc_putUserName(e.get("username")),a.asc_putUserData(e.get("userdata")),l.asc_addReply(a))})),a=t()))return a.asc_putText(i),a.asc_putTime(n.utcDateToString(new Date)),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date)),a.asc_putUserId(n.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),l.asc_addReply(a),n.api.asc_changeComment(e,l),n.mode&&n.mode.canRequestSendNotify&&n.view.pickEMail(l.asc_getGuid(),i),!0}return!1},onRemoveReplyComment:function(e,i){if(!_.isUndefined(e)&&!_.isUndefined(i)){var n=this,o=null,s=null,a=t(),l=n.findComment(e);if(a&&l)return a.asc_putText(l.get("comment")),a.asc_putQuoteText(l.get("quote")),a.asc_putTime(n.utcDateToString(new Date(l.get("time")))),a.asc_putOnlyOfficeTime(n.ooDateToString(new Date(l.get("time")))),a.asc_putUserId(l.get("userid")),a.asc_putUserName(l.get("username")),a.asc_putSolved(l.get("resolved")),a.asc_putGuid(l.get("guid")),a.asc_putUserData(l.get("userdata")),_.isUndefined(a.asc_putDocumentFlag)||a.asc_putDocumentFlag(l.get("unattached")),(o=l.get("replys"))&&o.length&&o.forEach((function(e){e.get("id")!==i&&(s=t())&&(s.asc_putText(e.get("reply")),s.asc_putTime(n.utcDateToString(new Date(e.get("time")))),s.asc_putOnlyOfficeTime(n.ooDateToString(new Date(e.get("time")))),s.asc_putUserId(e.get("userid")),s.asc_putUserName(e.get("username")),s.asc_putUserData(e.get("userdata")),a.asc_addReply(s))})),n.api.asc_changeComment(e,a),!0}return!1},onShowEditReplyComment:function(t,e,i){var n,o,s,a;if(!_.isUndefined(t)&&!_.isUndefined(e))if(i){if((o=this.popoverComments.findWhere({uid:t}))&&(s=o.get("replys"),a=_.clone(o.get("replys"))))for(n=0;n<a.length;++n)if(e===a[n].get("id"))return a[n].set("editTextInPopover",!0),s.length=0,o.set("replys",a),!0}else if((o=this.collection.findWhere({uid:t}))&&(s=o.get("replys"),a=_.clone(o.get("replys"))))for(n=0;n<a.length;++n)if(e===a[n].get("id"))return a[n].set("editText",!0),s.length=0,o.set("replys",a),!0;return!1},onUpdateFilter:function(t,e){if(t){this.view.isVisible()||(this.view.needUpdateFilter=t,e=!0),this.filter=t;var i=this,n=[];if(this.filter.forEach((function(t){i.groupCollection[t]||(i.groupCollection[t]=new Backbone.Collection([],{model:Common.Models.Comment})),n=n.concat(i.groupCollection[t].models)})),this.collection.reset(n),this.collection.groups=this.filter,!e){this.getPopover()&&this.getPopover().hide(),this.view.needUpdateFilter=!1;for(var o=!0,s=this.collection.length-1;s>=0;--s){var a=this.collection.at(s);!o||a.get("hide")||a.get("filtered")?a.get("last")&&a.set("last",!1,{silent:!0}):(a.set("last",!0,{silent:!0}),o=!1)}this.view.render(),this.view.update()}}},onAppAddComment:function(t,e){this.api.can_AddQuotedComment&&!1===this.api.can_AddQuotedComment()||e||this.addDummyComment()},addCommentToGroupCollection:function(t){var e=t.get("groupName");this.groupCollection[e]||(this.groupCollection[e]=new Backbone.Collection([],{model:Common.Models.Comment})),this.groupCollection[e].push(t)},onApiAddComment:function(t,e){var i=this.readSDKComment(t,e);i&&(i.get("groupName")?(this.addCommentToGroupCollection(i),_.indexOf(this.collection.groups,i.get("groupName"))>-1&&this.collection.push(i)):this.collection.push(i),this.updateComments(!0,"position-asc"===this.getComparator()||"position-desc"===this.getComparator()),this.showPopover&&(null!==e.asc_getQuoteText()&&(this.api.asc_selectComment(t),this._dontScrollToComment=!0,this.api.asc_showComment(t,!0)),this.showPopover=void 0,this.editPopover=!1))},onApiAddComments:function(t){for(var e=0;e<t.length;++e){var i=this.readSDKComment(t[e].asc_getId(),t[e]);i.get("groupName")?this.addCommentToGroupCollection(i):this.collection.push(i)}this.updateComments(!0,"position-asc"===this.getComparator()||"position-desc"===this.getComparator())},onApiRemoveComment:function(t,e){for(var i in this.groupCollection){var n=this.groupCollection[i];if(o=n.findWhere({uid:t})){n.remove(o);break}}var o;this.collection.length&&((o=this.collection.findWhere({uid:t}))&&(this.collection.remove(o),e||this.updateComments(!0)),this.popoverComments.length&&(o=this.popoverComments.findWhere({uid:t}))&&(this.popoverComments.remove(o),0===this.popoverComments.length&&this.getPopover()&&this.getPopover().hideComments()))},onChangeComments:function(t){for(var e=0;e<t.length;++e)this.onApiChangeCommentData(t[e].Comment.Id,t[e].Comment,!0);this.updateComments(!0)},onApiRemoveComments:function(t){for(var e=0;e<t.length;++e)this.onApiRemoveComment(t[e],!0);this.updateComments(!0)},onApiChangeCommentData:function(t,e,i){var n=this,o=0,s=null,a=null,l=0,r=null,c=this.findComment(t)||this.findCommentInGroup(t);if(c){n=this,s=e.asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getOnlyOfficeTime())):""==e.asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(e.asc_getTime()));var d=this.userCollection.findOriginalUser(e.asc_getUserId()),h=("author-asc"==this.getComparator()||"author-desc"==this.getComparator())&&e.asc_getUserName()!==c.get("username");if(c.set("comment",e.asc_getText()),c.set("userid",e.asc_getUserId()),c.set("username",e.asc_getUserName()),c.set("parsedName",AscCommon.UserInfoParser.getParsedName(e.asc_getUserName())),c.set("parsedGroups",AscCommon.UserInfoParser.getParsedGroups(e.asc_getUserName())),c.set("usercolor",d?d.get("color"):null),c.set("resolved",e.asc_getSolved()),c.set("quote",e.asc_getQuoteText()),c.set("userdata",e.asc_getUserData()),c.set("time",s.getTime()),c.set("date",n.dateToLocaleTimeString(s)),c.set("editable",(n.mode.canEditComments||e.asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getUserName())),c.set("removable",(n.mode.canDeleteComments||e.asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getUserName())),c.set("hide",!AscCommon.UserInfoParser.canViewComment(e.asc_getUserName())),!c.get("hide")){var p=c.get("parsedGroups");n.fillUserGroups(p);var m=Common.Utils.InternalSettings.get(n.appPrefix+"comments-filtergroups"),u=!!m&&-1!==m&&(!p||p.length<1||p.indexOf(m)<0);c.set("filtered",u)}for((a=_.clone(c.get("replys"))).length=0,l=e.asc_getRepliesCount(),o=0;o<l;++o)r=e.asc_getReply(o).asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getReply(o).asc_getOnlyOfficeTime())):""==e.asc_getReply(o).asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(e.asc_getReply(o).asc_getTime())),d=this.userCollection.findOriginalUser(e.asc_getReply(o).asc_getUserId()),a.push(new Common.Models.Reply({id:Common.UI.getId(),userid:e.asc_getReply(o).asc_getUserId(),username:e.asc_getReply(o).asc_getUserName(),parsedName:AscCommon.UserInfoParser.getParsedName(e.asc_getReply(o).asc_getUserName()),usercolor:d?d.get("color"):null,date:n.dateToLocaleTimeString(r),reply:e.asc_getReply(o).asc_getText(),userdata:e.asc_getReply(o).asc_getUserData(),time:r.getTime(),editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:n.view,editable:(n.mode.canEditComments||e.asc_getReply(o).asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getReply(o).asc_getUserName()),removable:(n.mode.canDeleteComments||e.asc_getReply(o).asc_getUserId()==n.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getReply(o).asc_getUserName())}));c.set("replys",a),this.popoverComments.findWhere({hide:!1})||this.getPopover()&&this.getPopover().hideComments(),i||this.updateComments(h,!h)}},onApiLockComment:function(t,e){var i=this.findComment(t)||this.findCommentInGroup(t),n=null;i&&this.userCollection&&(n=this.userCollection.findUser(e))&&(this.getPopover()&&this.getPopover().saveText(),this.view.saveText(),i.set("lock",!0),i.set("lockuserid",this.view.getUserName(n.get("username"))))},onApiUnLockComment:function(t){var e=this.findComment(t)||this.findCommentInGroup(t);e&&(e.set("lock",!1),this.getPopover()&&this.getPopover().loadText(),this.view.loadText())},onApiShowComment:function(t,e,i,n,o,s){var a=s,l=0===_.difference(this.uids,t).length&&0===_.difference(t,this.uids).length;if(!(s&&this.isSelectedComment&&l)||this.isModeChanged){var r=this.getPopover();if(r){if(this.clearDummyComment(),this.isSelectedComment&&l&&!this.isModeChanged)return void(this.api&&(r.commentsView&&r.commentsView.setFocusToTextBox(!0),this.api.asc_enableKeyEvents(!0)));var c=0,d="",h="",p=null,m="",u=!0,g=[];for(c=0;c<t.length;++c)d=t[c],h=t[c]+"-R",(p=this.findComment(d))&&(this.subEditStrings[d]&&!s?(p.set("editTextInPopover",!0),m=this.subEditStrings[d]):this.subEditStrings[h]&&!s&&(p.set("showReplyInPopover",!0),m=this.subEditStrings[h]),p.set("hint",!_.isUndefined(s)&&s),!s&&this.hintmode&&(l&&0===this.uids.length&&(u=!1),this.oldUids.length&&0===_.difference(this.oldUids,t).length&&0===_.difference(t,this.oldUids).length&&(u=!1,this.oldUids=[])),this.animate&&(u=this.animate,this.animate=!1),this.isSelectedComment=!a||!this.hintmode,this.uids=_.clone(t),g.push(p),this._dontScrollToComment||this.view.commentsView.scrollToRecord(p),this._dontScrollToComment=!1);g.sort((function(t,e){return t.get("time")-e.get("time")})),this.popoverComments.reset(g),this.popoverComments.findWhere({hide:!1})?(r.isVisible()&&r.hide(),r.setLeftTop(e,i,n),r.showComments(u,!1,!0,m)):r.hideComments()}this.isModeChanged=!1}},onApiHideComment:function(t){var e=this;if(this.getPopover()){if(this.isSelectedComment&&t)return;if(t&&this.getPopover().isCommentsViewMouseOver())return;this.popoverComments.each((function(t){t.get("editTextInPopover")&&(e.subEditStrings[t.get("uid")]=e.getPopover().getEditText()),t.get("showReplyInPopover")&&(e.subEditStrings[t.get("uid")+"-R"]=e.getPopover().getEditText())})),this.getPopover().saveText(!0),this.getPopover().hideComments(),this.collection.clearEditing(),this.popoverComments.clearEditing(),this.oldUids=_.clone(this.uids),this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset()}},onApiUpdateCommentPosition:function(t,e,i,n){var o,s=!1,a=null,l=void 0,r="",c="";if(this.getPopover())if(this.getPopover().saveText(),this.getPopover().hideTips(),i<0||this.getPopover().sdkBounds.height<i||!_.isUndefined(n)&&this.getPopover().sdkBounds.width<n)this.getPopover().hide();else{if(this.isModeChanged&&this.onApiShowComment(t,e,i,n),0===this.popoverComments.length){var d=[];for(o=0;o<t.length;++o)r=t[o],c=t[o]+"-R",(a=this.findComment(r))&&(this.subEditStrings[r]?(a.set("editTextInPopover",!0),l=this.subEditStrings[r]):this.subEditStrings[c]&&(a.set("showReplyInPopover",!0),l=this.subEditStrings[c]),d.push(a));d.sort((function(t,e){return t.get("time")-e.get("time")})),this.popoverComments.reset(d),this.popoverComments.findWhere({hide:!1})?(s=!0,this.getPopover().showComments(s,void 0,void 0,l)):this.getPopover().hideComments()}else!this.getPopover().isVisible()&&this.popoverComments.findWhere({hide:!1})&&this.getPopover().showComments(!1,void 0,void 0,l);this.getPopover().setLeftTop(e,i,n,void 0,!0)}},onDocumentPlaceChanged:function(){if(this.isDummyComment&&this.getPopover()&&this.getPopover().isVisible()){var t=this.api.asc_getAnchorPosition();t&&this.getPopover().setLeftTop(t.asc_getX()+t.asc_getWidth(),t.asc_getY(),this.hintmode?t.asc_getX():void 0)}},onDeleteComment:function(t,e){this.api&&this.api.asc_RemoveAllComments(!this.mode.canDeleteComments,!0)},onApiChangeCommentLogicalPosition:function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=this.findComment(e)||this.findCommentInGroup(e);i&&i.set("position",t[e])}("position-asc"===this.getComparator()||"position-desc"===this.getComparator())&&this.updateComments(!0)},updateComments:function(t,e,i){var n=this;n.updateCommentsTime=new Date,n.disableSort=!!e,void 0===n.timerUpdateComments&&(n.timerUpdateComments=setInterval((function(){new Date-n.updateCommentsTime>100&&(clearInterval(n.timerUpdateComments),n.timerUpdateComments=void 0,n.updateCommentsView(t,n.disableSort,i))}),25))},updateCommentsView:function(t,e,i){if(t&&!this.view.isVisible())return this.view.needRender=t,void this.onUpdateFilter(this.filter,!0);var n,o=!0;if(e||this.collection.sort(),t){for(this.onUpdateFilter(this.filter,!0),n=this.collection.length-1;n>=0;--n){var s=this.collection.at(n);!o||s.get("hide")||s.get("filtered")?s.get("last")&&s.set("last",!1,{silent:!0}):(s.set("last",!0,{silent:!0}),o=!1)}this.view.render(),this.view.needRender=!1}this.view.update(),i&&this.view.loadText()},findComment:function(t){return this.collection.findWhere({uid:t})},findPopupComment:function(t){return this.popoverComments.findWhere({id:t})},findCommentInGroup:function(t){for(var e in this.groupCollection){var i=this.groupCollection[e].findWhere({uid:t});if(i)return i}},closeEditing:function(t){if(!_.isUndefined(t)){var e=this.findPopupComment(t);e&&(e.set("editTextInPopover",!1),e.set("showReplyInPopover",!1)),this.subEditStrings[t]&&delete this.subEditStrings[t],this.subEditStrings[t+"-R"]&&delete this.subEditStrings[t+"-R"]}this.collection.clearEditing(),this.collection.each((function(t){var e=_.clone(t.get("replys"));t.get("replys").length=0,e.forEach((function(t){t.get("editText")&&t.set("editText",!1),t.get("editTextInPopover")&&t.set("editTextInPopover",!1)})),t.set("replys",e)})),this.view.showEditContainer(!1),this.view.update()},disableHint:function(t){t&&this.mode.canComments&&(t.set("hint",!1),this.api.asc_showComment(t.get("uid"),!1),this.isSelectedComment=!0)},blockPopover:function(t){this.isSelectedComment=t,t&&this.getPopover().isVisible()&&this.getPopover().hide()},getPopover:function(){return _.isUndefined(this.popover)&&(this.popover=Common.Views.ReviewPopover.prototype.getPopover({commentsStore:this.popoverComments,renderTo:this.sdkViewName,canRequestUsers:this.mode?this.mode.canRequestUsers:void 0,canRequestSendNotify:this.mode?this.mode.canRequestSendNotify:void 0,mentionShare:!this.mode||this.mode.mentionShare,api:this.api}),this.popover.setCommentsStore(this.popoverComments)),this.popover},onUpdateUsers:function(){var t=this.userCollection,e=!1;for(var i in this.groupCollection)e=!0,this.groupCollection[i].each((function(e){var i=t.findOriginalUser(e.get("userid")),n=i?i.get("color"):null,o=!1;n!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0})),e.get("replys").forEach((function(e){i=t.findOriginalUser(e.get("userid")),(n=i?i.get("color"):null)!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0}))})),o&&e.trigger("change")}));!e&&this.collection.each((function(e){var i=t.findOriginalUser(e.get("userid")),n=i?i.get("color"):null,o=!1;n!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0})),e.get("replys").forEach((function(e){i=t.findOriginalUser(e.get("userid")),(n=i?i.get("color"):null)!==e.get("usercolor")&&(o=!0,e.set("usercolor",n,{silent:!0}))})),o&&e.trigger("change")}))},readSDKComment:function(t,e){var i=e.asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getOnlyOfficeTime())):""==e.asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(e.asc_getTime())),n=this.userCollection.findOriginalUser(e.asc_getUserId()),o=t.substr(0,t.lastIndexOf("_")+1).match(/^(doc|sheet[0-9_]+)_/),s=new Common.Models.Comment({uid:t,guid:e.asc_getGuid(),userid:e.asc_getUserId(),username:e.asc_getUserName(),parsedName:AscCommon.UserInfoParser.getParsedName(e.asc_getUserName()),parsedGroups:AscCommon.UserInfoParser.getParsedGroups(e.asc_getUserName()),usercolor:n?n.get("color"):null,date:this.dateToLocaleTimeString(i),quote:e.asc_getQuoteText(),comment:e.asc_getText(),resolved:e.asc_getSolved(),unattached:!_.isUndefined(e.asc_getDocumentFlag)&&e.asc_getDocumentFlag(),userdata:e.asc_getUserData(),id:Common.UI.getId(),time:i.getTime(),showReply:!1,editText:!1,last:void 0,editTextInPopover:!!this.editPopover,showReplyInPopover:!1,hideAddReply:_.isUndefined(this.hidereply)?!!this.showPopover:this.hidereply,scope:this.view,editable:(this.mode.canEditComments||e.asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getUserName()),removable:(this.mode.canDeleteComments||e.asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getUserName()),hide:!AscCommon.UserInfoParser.canViewComment(e.asc_getUserName()),hint:!this.mode.canComments,groupName:o&&o.length>1?o[1]:null});if(s){if(!s.get("hide")){var a=s.get("parsedGroups");this.fillUserGroups(a);var l=Common.Utils.InternalSettings.get(this.appPrefix+"comments-filtergroups"),r=!!l&&-1!==l&&(!a||a.length<1||a.indexOf(l)<0);s.set("filtered",r)}var c=this.readSDKReplies(e);c.length&&s.set("replys",c)}return s},readSDKReplies:function(t){var e=0,i=[],n=null,o=t.asc_getRepliesCount();if(o)for(e=0;e<o;++e){n=t.asc_getReply(e).asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(t.asc_getReply(e).asc_getOnlyOfficeTime())):""==t.asc_getReply(e).asc_getTime()?new Date:new Date(this.stringUtcToLocalDate(t.asc_getReply(e).asc_getTime()));var s=this.userCollection.findOriginalUser(t.asc_getReply(e).asc_getUserId());i.push(new Common.Models.Reply({id:Common.UI.getId(),userid:t.asc_getReply(e).asc_getUserId(),username:t.asc_getReply(e).asc_getUserName(),parsedName:AscCommon.UserInfoParser.getParsedName(t.asc_getReply(e).asc_getUserName()),usercolor:s?s.get("color"):null,date:this.dateToLocaleTimeString(n),reply:t.asc_getReply(e).asc_getText(),userdata:t.asc_getReply(e).asc_getUserData(),time:n.getTime(),editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:this.view,editable:(this.mode.canEditComments||t.asc_getReply(e).asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canEditComment(t.asc_getReply(e).asc_getUserName()),removable:(this.mode.canDeleteComments||t.asc_getReply(e).asc_getUserId()==this.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(t.asc_getReply(e).asc_getUserName())}))}return i},addDummyComment:function(){if(this.api){var t=this,e=null,i=new Date,n=this.getPopover();if(n){if(this.popoverComments.length){if(this.isDummyComment)return void _.delay((function(){n.commentsView.setFocusToTextBox()}),200);this.closeEditing()}var o=this.userCollection.findOriginalUser(this.currentUserId),s=new Common.Models.Comment({id:-1,time:i.getTime(),date:this.dateToLocaleTimeString(i),userid:this.currentUserId,username:AscCommon.UserInfoParser.getCurrentName(),parsedName:AscCommon.UserInfoParser.getParsedName(AscCommon.UserInfoParser.getCurrentName()),usercolor:o?o.get("color"):null,editTextInPopover:!0,showReplyInPopover:!1,hideAddReply:!0,scope:this.view,dummy:!0});this.popoverComments.reset(),this.popoverComments.push(s),this.uids=[],this.isSelectedComment=!0,this.isDummyComment=!0,_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||t.api.asc_SetDocumentPlaceChangedEnabled(!0),n.handlerHide=function(){},n.isVisible()&&n.hide(),n.handlerHide=function(e){t.clearDummyComment(e)},(e=this.api.asc_getAnchorPosition())&&(n.setLeftTop(e.asc_getX()+e.asc_getWidth(),e.asc_getY(),this.hintmode?e.asc_getX():void 0),Common.NotificationCenter.trigger("comments:showdummy"),n.showComments(!0,!1,!0,n.getDummyText()))}}},onAddDummyComment:function(e){if(this.api&&e&&e.length>0){var i=t();i&&(this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset(),this.getPopover().isVisible()&&this.getPopover().hideComments(),this.isDummyComment=!1,i.asc_putText(e),i.asc_putTime(this.utcDateToString(new Date)),i.asc_putOnlyOfficeTime(this.ooDateToString(new Date)),i.asc_putUserId(this.currentUserId),i.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),i.asc_putSolved(!1),_.isUndefined(i.asc_putDocumentFlag)||i.asc_putDocumentFlag(!1),this.api.asc_addComment(i),this.view.showEditContainer(!1),this.mode&&this.mode.canRequestSendNotify&&this.view.pickEMail(i.asc_getGuid(),e),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1))}},clearDummyComment:function(t){if(this.isDummyComment){this.isDummyComment=!1,this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[];var e=this.getPopover();e&&(t&&e.clearDummyText(),e.saveDummyText(),e.handlerHide=function(){},e.isVisible()&&e.hideComments()),this.popoverComments.reset(),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1),Common.NotificationCenter.trigger("comments:cleardummy")}},onEditComments:function(t){if(this.api){var e=0,i=null,n=this.api.asc_getAnchorPosition();if(n){for(this.isSelectedComment=!0,this.popoverComments.reset(),e=0;e<t.length;++e)(i=this.findComment(t[e].asc_getId()))&&(i.set("editTextInPopover",this.mode.canEditComments&&AscCommon.UserInfoParser.canEditComment(i.username)),i.set("hint",!1),this.popoverComments.push(i));this.getPopover()&&this.popoverComments.length>0&&this.popoverComments.findWhere({hide:!1})&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(n.asc_getX()+n.asc_getWidth(),n.asc_getY(),this.hintmode?n.asc_getX():void 0),this.getPopover().showComments(!0,!1,!0))}}},onAfterShow:function(){if(this.view&&this.api){var t=$(".new-comment-ct",this.view.el);t&&t.length&&"none"!==t.css("display")&&this.view.txtComment.focus(),this.view.needRender?this.updateComments(!0):this.view.needUpdateFilter&&this.onUpdateFilter(this.view.needUpdateFilter),this.view.update()}},onBeforeHide:function(){this.view&&this.view.showEditContainer(!1)},timeZoneOffsetInMs:6e4*(new Date).getTimezoneOffset(),stringOOToLocalDate:function(t){return"string"==typeof t?parseInt(t):0},ooDateToString:function(t){return"[object Date]"===Object.prototype.toString.call(t)?t.getTime().toString():""},stringUtcToLocalDate:function(t){return"string"==typeof t?parseInt(t)+this.timeZoneOffsetInMs:0},utcDateToString:function(t){return"[object Date]"===Object.prototype.toString.call(t)?(t.getTime()-this.timeZoneOffsetInMs).toString():""},dateToLocaleTimeString:function(t){return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+" "+function(t){var e=t.getHours(),i=t.getMinutes(),n=e>=12?"pm":"am";return(e=(e%=12)||12)+":"+(i=i<10?"0"+i:i)+" "+n}(t)},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,t&&(this.prevcanComments=this.mode.canComments),this.mode.canComments=!t&&this.prevcanComments,this.closeEditing(),this.setMode(this.mode),this.updateComments(!0),this.getPopover()&&(t?this.getPopover().hide():this.getPopover().update(!0)))},clearCollections:function(){this.collection.reset(),this.groupCollection=[]},fillUserGroups:function(t){if(this.mode.canUseCommentPermissions){var e=AscCommon.UserInfoParser.getCommentPermissions("view");if(t&&t.length>0&&(e&&(t=_.intersection(t,e)),t=_.uniq(this.userGroups.concat(t))),this.view&&this.view.buttonSort&&_.difference(t,this.userGroups).length>0){this.userGroups=t;var i=this.view.buttonSort.menu;i.items[i.items.length-1].setVisible(this.userGroups.length>0),i.items[i.items.length-2].setVisible(this.userGroups.length>0),(i=i.items[i.items.length-1].menu).removeAll();var n=Common.Utils.InternalSettings.get(this.appPrefix+"comments-filtergroups");i.addItem(new Common.UI.MenuItem({checkable:!0,checked:-1===n||void 0===n,toggleGroup:"filtercomments",caption:this.view.textAll,value:-1})),this.userGroups.forEach((function(t){i.addItem(new Common.UI.MenuItem({checkable:!0,checked:n===t,toggleGroup:"filtercomments",caption:Common.Utils.String.htmlEncode(t),value:t}))}))}}},setFilterGroups:function(t){Common.Utils.InternalSettings.set(this.appPrefix+"comments-filtergroups",t);var e,i=!0;for(e=this.collection.length-1;e>=0;--e){var n=this.collection.at(e);if(!n.get("hide")){var o=n.get("parsedGroups");n.set("filtered",!!t&&-1!==t&&(!o||o.length<1||o.indexOf(t)<0),{silent:!0})}!i||n.get("hide")||n.get("filtered")?n.get("last")&&n.set("last",!1,{silent:!0}):(n.set("last",!0,{silent:!0}),i=!1)}this.updateComments(!0)}},Common.Controllers.Comments||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/User",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.User=e.Model.extend({defaults:function(){return{iid:Common.UI.getId(),id:void 0,idOriginal:void 0,username:"Guest",color:"#fff",colorval:null,online:!1,view:!1,hidden:!1}}})})),define("common/main/lib/collection/Users",["backbone","common/main/lib/model/User"],(function(t){"use strict";Common.Collections=Common.Collections||{},Common.Collections.Users=t.Collection.extend({model:Common.Models.User,getOnlineCount:function(){var t=0;return this.each((function(e){e.get("online")&&++t})),t},getEditingCount:function(){return this.filter((function(t){return t.get("online")&&!t.get("view")})).length},getVisibleEditingCount:function(){return this.filter((function(t){return t.get("online")&&!t.get("view")&&!t.get("hidden")})).length},getEditingOriginalCount:function(){return this.chain().filter((function(t){return t.get("online")&&!t.get("view")})).groupBy((function(t){return t.get("idOriginal")})).size().value()},getVisibleEditingOriginalCount:function(){return this.chain().filter((function(t){return t.get("online")&&!t.get("view")&&!t.get("hidden")})).groupBy((function(t){return t.get("idOriginal")})).size().value()},findUser:function(t){return this.find((function(e){return e.get("id")==t}))},findOriginalUser:function(t){return this.find((function(e){return e.get("idOriginal")==t}))}}),Common.Collections.HistoryUsers=t.Collection.extend({model:Common.Models.User,findUser:function(t){return this.find((function(e){return e.get("id")==t}))}})})),define("common/main/lib/model/ChatMessage",["backbone"],(function(t){"use strict";Common.Models=Common.Models||{},Common.Models.ChatMessage=t.Model.extend({defaults:{type:0,userid:null,username:"",message:""}})})),define("common/main/lib/collection/ChatMessages",["backbone","common/main/lib/model/ChatMessage"],(function(t){"use strict";!Common.Collections&&(Common.Collections={}),Common.Collections.ChatMessages=t.Collection.extend({model:Common.Models.ChatMessage})})),define("common/main/lib/controller/Chat",["core","common/main/lib/collection/Users","common/main/lib/collection/ChatMessages","common/main/lib/view/Chat"],(function(){"use strict";Common.Controllers.Chat=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Users","Common.Collections.ChatMessages"],views:["Common.Views.Chat"],initialize:function(){this.addListeners({"Common.Views.Chat":{"message:add":_.bind(this.onSendMessage,this)}});var t=this;Common.NotificationCenter.on("layout:changed",(function(e){Common.Utils.asyncCall((function(e){"toolbar"!=e&&"status"!=e||!t.panelChat.$el.is(":visible")||(t.panelChat.updateLayout(!0),t.panelChat.setupAutoSizingTextBox())}),this,e)}))},events:{},onLaunch:function(){this.panelChat=this.createView("Common.Views.Chat",{storeUsers:this.getApplication().getCollection("Common.Collections.Users"),storeMessages:this.getApplication().getCollection("Common.Collections.ChatMessages")}),this.panelChat.on("render:after",_.bind(this.onAfterRender,this))},onAfterRender:function(t){this.getApplication().getController("Viewport").getView("Viewport").hlayout.on("layout:resizedrag",_.bind((function(){t&&t.updateScrolls()}),this))},setMode:function(t){return this.mode=t,this.currentUserId=t.user.id,this.api&&(this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onReceiveMessage,this)),this.mode.isEditDiagram||this.mode.isEditMailMerge||this.mode.isEditOle||(this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onUsersChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(this.onUserConnection,this)),this.api.asc_coAuthoringGetUsers()),this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_coAuthoringChatGetMessages()),this},setApi:function(t){return this.api=t,this},onUsersChanged:function(t,e){if(!this.mode.canLicense||!this.mode.canCoAuthoring){var i=0;for(o in t)void 0!==o&&i++;if(i>1&&null==this._isCoAuthoringStopped)return this._isCoAuthoringStopped=!0,this.api.asc_coAuthoringDisconnect(),void Common.NotificationCenter.trigger("api:disconnect")}var n=this.getApplication().getCollection("Common.Collections.Users");if(n){var o,s,a=[];for(o in t)if(void 0!==o&&(s=t[o])){var l=new Common.Models.User({id:s.asc_getId(),idOriginal:s.asc_getIdOriginal(),username:s.asc_getUserName(),online:!0,color:s.asc_getColor(),view:s.asc_getView(),hidden:!(s.asc_getIdOriginal()===this.currentUserId||AscCommon.UserInfoParser.isUserVisible(s.asc_getUserName()))});a[s.asc_getId()==e?"unshift":"push"](l)}n[n.size()>0?"add":"reset"](a)}},onUserConnection:function(t){var e=this.getApplication().getCollection("Common.Collections.Users");if(e){var i=e.findUser(t.asc_getId());i?(i.set({online:t.asc_getState()}),i.set({username:t.asc_getUserName()})):e.add(new Common.Models.User({id:t.asc_getId(),idOriginal:t.asc_getIdOriginal(),username:t.asc_getUserName(),online:t.asc_getState(),color:t.asc_getColor(),view:t.asc_getView(),hidden:!(t.asc_getIdOriginal()===this.currentUserId||AscCommon.UserInfoParser.isUserVisible(t.asc_getUserName()))}))}},onReceiveMessage:function(t,e){var i=this.getApplication().getCollection("Common.Collections.ChatMessages");if(i){var n=[];t.forEach((function(t){n.push(new Common.Models.ChatMessage({userid:t.useridoriginal,message:t.message,username:t.username}))})),i[i.size()<1||e?"reset":"add"](n)}},onSendMessage:function(t,e){if(e.length>0){var i=this;(function(t,e){for(var i=[];t;){if(t.length<e){i.push(t);break}i.push(t.substr(0,e)),t=t.substr(e)}return i})(e,2048).forEach((function(t){i.api.asc_coAuthoringChatSendMessage(t)}))}},notcriticalErrorTitle:"Warning"},Common.Controllers.Chat||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Plugin",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.PluginVariation=e.Model.extend({defaults:function(){return{description:"",url:"",index:0,icons:void 0,isSystem:!1,isViewer:!1,isDisplayedInViewer:!0,EditorsSupport:["word","cell","slide"],isVisual:!1,isCustomWindow:!1,isModal:!0,isInsideMode:!1,initDataType:0,initData:"",isUpdateOleOnResize:!1,buttons:[],size:[800,600],initOnSelectionChanged:!1,visible:!0}}}),Common.Models.Plugin=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:"",baseUrl:"",guid:Common.UI.getId(),variations:[],currentVariation:0,pluginObj:void 0,allowSelected:!1,selected:!1,visible:!0,groupName:"",groupRank:0}}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Plugins",["underscore","backbone","common/main/lib/model/Plugin"],(function(t,e){"use strict";Common.Collections.Plugins=e.Collection.extend({model:Common.Models.Plugin,hasVisible:function(){return!!this.findWhere({visible:!0})}})})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/PluginDlg",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t){"use strict";Common.Views.PluginDlg=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};_.extend(e,{header:!0,enableKeyEvents:!1},t);var i=e.buttons&&_.size(e.buttons)>0?85:34;e.header||(i-=34),this.bordersOffset=40,e.width=Common.Utils.innerWidth()-2*this.bordersOffset-e.width<0?Common.Utils.innerWidth()-2*this.bordersOffset:e.width,e.height+=i,e.height=Common.Utils.innerHeight()-2*this.bordersOffset-e.height<0?Common.Utils.innerHeight()-2*this.bordersOffset:e.height,e.cls+=" advanced-settings-dlg",this.template=['<div id="id-plugin-container" class="box" style="height:'+(e.height-i)+'px;">','<div id="id-plugin-placeholder" style="width: 100%;height: 100%;"></div>',"</div>",'<% if ((typeof buttons !== "undefined") && _.size(buttons) > 0) { %>','<div class="separator horizontal"></div>',"<% } %>"].join(""),e.tpl=_.template(this.template)(e),this.url=t.url||"",this.loader=void 0===t.loader||t.loader,this.frameId=t.frameId||"plugin_iframe",Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"}),this.boxEl=this.$window.find(".body > .box"),this._headerFooterHeight=this.options.buttons&&_.size(this.options.buttons)>0?85:34,this.options.header||(this._headerFooterHeight-=34),this._headerFooterHeight+=parseInt(this.$window.css("border-top-width"))+parseInt(this.$window.css("border-bottom-width")),this.$window.find(".header").prepend($('<div class="tools left hidden"></div>'));var t=document.createElement("iframe");t.id=this.frameId,t.name="pluginFrameEditor",t.width="100%",t.height="100%",t.align="top",t.frameBorder=0,t.scrolling="no",t.allow="camera; microphone; display-capture",t.onload=_.bind(this._onLoad,this);var e=this;this.loader&&setTimeout((function(){e.isLoaded||(e.loadMask=new Common.UI.LoadMask({owner:$("#id-plugin-placeholder")}),e.loadMask.setTitle(e.textLoading),e.loadMask.show(),e.isLoaded&&e.loadMask.hide())}),500),t.src=this.url,$("#id-plugin-placeholder").append(t),this.on("resizing",(function(t){e.boxEl.css("height",parseInt(e.$window.css("height"))-e._headerFooterHeight)}));var i=function(){e.onWindowResize()};$(window).on("resize",i),this.on("close",(function(){$(window).off("resize",i)}))},_onLoad:function(){this.isLoaded=!0,this.loadMask&&this.loadMask.hide()},setInnerSize:function(t,e){var i=Common.Utils.innerHeight(),n=Common.Utils.innerWidth(),o=parseInt(this.$window.css("border-left-width"))+parseInt(this.$window.css("border-right-width")),s=2*this.bordersOffset;i-s<e+this._headerFooterHeight&&(e=i-s-this._headerFooterHeight),n-s<t+o&&(t=n-s-o),this.boxEl.css("height",e),Common.UI.Window.prototype.setHeight.call(this,e+this._headerFooterHeight),Common.UI.Window.prototype.setWidth.call(this,t+o),this.$window.css("left",(n-t-o)/2),this.$window.css("top",(i-e-this._headerFooterHeight)/2)},onWindowResize:function(){var t=Common.Utils.innerWidth(),e=Common.Utils.innerHeight(),i=this.getWidth(),n=this.getHeight(),o=this.resizable?0:this.bordersOffset;if(n<e-2*o+.1&&i<t-2*o+.1){var s=this.getLeft(),a=this.getTop();a<o?this.$window.css("top",o):a+n>e-o&&this.$window.css("top",e-o-n),s<o?this.$window.css("left",o):s+i>t-o&&this.$window.css("left",t-o-i)}else n>e-2*o&&(this.setHeight(Math.max(e-2*o,this.initConfig.minheight)),this.boxEl.css("height",Math.max(e-2*o,this.initConfig.minheight)-this._headerFooterHeight),this.$window.css("top",o)),i>t-2*o&&(this.setWidth(Math.max(t-2*o,this.initConfig.minwidth)),this.$window.css("left",o))},showButton:function(t){var e=this.$window.find(".header .tools.left");if("back"==t){var i=e.find("#id-plugindlg-"+t);i.length<1&&((i=$('<div id="id-plugindlg-'+t+'" class="tool help" style="font-size:20px;">←</div>')).on("click",_.bind((function(){this.fireEvent("header:click",t)}),this)),e.prepend(i)),i.show(),e.removeClass("hidden")}},hideButton:function(t){var e=this.$window.find(".header .tools.left");if("back"==t){var i=e.find("#id-plugindlg-"+t);i.length>0&&i.hide()}},textLoading:"Loading"},Common.Views.PluginDlg||{}))})),define("common/main/lib/controller/Plugins",["core","common/main/lib/collection/Plugins","common/main/lib/view/Plugins","common/main/lib/view/PluginDlg"],(function(){"use strict";Common.Controllers.Plugins=Backbone.Controller.extend(_.extend({models:[],appOptions:{},configPlugins:{autostart:[]},serverPlugins:{autostart:[]},collections:["Common.Collections.Plugins"],views:["Common.Views.Plugins"],initialize:function(){var t=this;this.addListeners({Toolbar:{"render:before":function(e){var i=t.getApplication().getController("Main").appOptions;if(!i.isEditMailMerge&&!i.isEditDiagram&&!i.isEditOle){var n={action:"plugins",caption:t.panelPlugins.groupCaption,dataHintTitle:"E",layoutname:"toolbar-plugins"};t.$toolbarPanelPlugins=t.panelPlugins.getPanel(),e.addTab(n,t.$toolbarPanelPlugins,10)}}},"Common.Views.Plugins":{"plugin:select":function(e,i){t.api.asc_pluginRun(e,i,"")}}})},events:function(){return{"click #id-plugin-close":_.bind(this.onToolClose,this)}},onLaunch:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins");this.panelPlugins=this.createView("Common.Views.Plugins",{storePlugins:t}),this.panelPlugins.on("render:after",_.bind(this.onAfterRender,this)),t.on({add:this.onAddPlugin.bind(this),reset:this.onResetPlugins.bind(this)}),this._moveOffset={x:0,y:0},this.autostart=[],Common.Gateway.on("init",this.loadConfig.bind(this)),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this)),Common.NotificationCenter.on("uitheme:changed",this.updatePluginsButtons.bind(this)),Common.NotificationCenter.on("window:resize",this.updatePluginsButtons.bind(this))},loadConfig:function(t){this.configPlugins.config=t.config.plugins,this.editor=window.DE?"word":window.PE?"slide":"cell"},loadPlugins:function(){this.configPlugins.config?this.getPlugins(this.configPlugins.config.pluginsData).then((function(e){t.configPlugins.plugins=e,t.mergePlugins()})).catch((function(e){t.configPlugins.plugins=!1})):this.configPlugins.plugins=!1;var t=this;Common.Utils.loadConfig("../../../../plugins.json",(function(e){"error"!=e?(t.serverPlugins.config=e,t.getPlugins(t.serverPlugins.config.pluginsData).then((function(e){t.serverPlugins.plugins=e,t.mergePlugins()})).catch((function(e){t.serverPlugins.plugins=!1}))):t.serverPlugins.plugins=!1}))},onAppShowed:function(t){},setApi:function(t){return this.api=t,this.appOptions.customization&&!1===this.appOptions.customization.plugins||(this.api.asc_registerCallback("asc_onPluginShow",_.bind(this.onPluginShow,this)),this.api.asc_registerCallback("asc_onPluginClose",_.bind(this.onPluginClose,this)),this.api.asc_registerCallback("asc_onPluginResize",_.bind(this.onPluginResize,this)),this.api.asc_registerCallback("asc_onPluginMouseUp",_.bind(this.onPluginMouseUp,this)),this.api.asc_registerCallback("asc_onPluginMouseMove",_.bind(this.onPluginMouseMove,this)),this.api.asc_registerCallback("asc_onPluginsReset",_.bind(this.resetPluginsList,this)),this.api.asc_registerCallback("asc_onPluginsInit",_.bind(this.onPluginsInit,this)),this.api.asc_registerCallback("asc_onPluginShowButton",_.bind(this.onPluginShowButton,this)),this.api.asc_registerCallback("asc_onPluginHideButton",_.bind(this.onPluginHideButton,this)),this.loadPlugins()),this},setMode:function(t,e){return this.appOptions=t,this.api=e,this.customPluginsComplete=!this.appOptions.canBrandingExt,this.appOptions.canBrandingExt&&this.getAppCustomPlugins(this.configPlugins),this},onAfterRender:function(t){t.viewPluginsList&&t.viewPluginsList.on("item:click",_.bind(this.onSelectPlugin,this)),this.bindViewEvents(this.panelPlugins,this.events);var e=this;Common.NotificationCenter.on({"layout:resizestart":function(t){if(e.panelPlugins.isVisible()){var i=e.panelPlugins.currentPluginFrame.offset();e._moveOffset={x:i.left+parseInt(e.panelPlugins.currentPluginFrame.css("padding-left")),y:i.top+parseInt(e.panelPlugins.currentPluginFrame.css("padding-top"))},e.api.asc_pluginEnableMouseEvents(!0)}},"layout:resizestop":function(t){e.panelPlugins.isVisible()&&e.api.asc_pluginEnableMouseEvents(!1)}})},refreshPluginsList:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins"),e=[];t.each((function(t){var i=new Asc.CPlugin;i.deserialize(t.get("original")),t.set("pluginObj",i),e.push(i)})),this.api.asc_pluginsRegister("",e),t.hasVisible()&&Common.NotificationCenter.trigger("tab:visible","plugins",Common.UI.LayoutManager.isElementVisible("toolbar-plugins")),Common.Gateway.pluginsReady()},onAddPlugin:function(t){var e=this;if(e.$toolbarPanelPlugins){var i=e.panelPlugins.createPluginButton(t);if(!i)return;var n=$("> .group",e.$toolbarPanelPlugins),o=$('<span class="btn-slot text x-huge"></span>').appendTo(n);i.render(o)}},onResetPlugins:function(t){var e=this;if(e.appOptions.canPlugins=!t.isEmpty(),e.$toolbarPanelPlugins){e.$toolbarPanelPlugins.empty();var i=$('<div class="group"></div>'),n=-1,o=0;t.each((function(t){var s=t.get("groupRank");s!==n&&n>-1&&o>0?(i.appendTo(e.$toolbarPanelPlugins),$('<div class="separator long"></div>').appendTo(e.$toolbarPanelPlugins),i=$('<div class="group"></div>'),o=0):(i.appendTo(e.$toolbarPanelPlugins),$('<div class="separator long invisible"></div>').appendTo(e.$toolbarPanelPlugins),i=$('<div class="group" style="padding-left: 0;"></div>'));var a=e.panelPlugins.createPluginButton(t);if(a){var l=$('<span class="btn-slot text x-huge"></span>').appendTo(i);a.render(l),o++}n=s})),i.appendTo(e.$toolbarPanelPlugins)}else console.error("toolbar panel isnot created")},updatePluginsButtons:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins"),e=this;t.each((function(t){e.panelPlugins.updatePluginIcons(t)}))},onSelectPlugin:function(t,e,i,n){var o=$(n.target);if(o&&o.hasClass("plugin-caret")){var s=this.panelPlugins.pluginMenu;if(s.isVisible())return void s.hide();var a,l=this,r=$(n.currentTarget),c=$(this.panelPlugins.el),d=r.offset(),h=c.offset();if(a=[d.left-h.left+r.width(),d.top-h.top+r.height()/2],null!=i){for(var p=0;p<s.items.length;p++)s.removeItem(s.items[p]),p--;s.removeAll();var m=i.get("variations");for(p=0;p<m.length;p++){var u=m[p],g=new Common.UI.MenuItem({caption:p>0?u.get("description"):l.panelPlugins.textStart,value:parseInt(u.get("index"))}).on("click",(function(t,e){l.api&&l.api.asc_pluginRun(i.get("guid"),t.value,"")}));s.addItem(g)}}var f=c.find("#menu-plugin-container");s.rendered||(f.length<1&&(f=$('<div id="menu-plugin-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',s.id),c.append(f)),s.render(f),s.cmpEl.attr({tabindex:"-1"}),s.on({"show:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)},"hide:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}})),f.css({left:a[0],top:a[1]}),s.menuAlignEl=r,s.setOffset(-20,-r.height()/2-3),s.show(),_.delay((function(){s.cmpEl.focus()}),10),n.stopPropagation(),n.preventDefault()}else this.api.asc_pluginRun(i.get("guid"),0,"")},onPluginShow:function(t,e,i,n){var o=t.get_Variations()[e];if(o.get_Visual()){var s=o.get_Url();if(s=(0==t.get_BaseUrl().length?s:t.get_BaseUrl())+s,n&&(s+=n),o.get_InsideMode())this.panelPlugins.openInsideMode(t.get_Name(),s,i)||this.api.asc_pluginButtonClick(-1);else{var a=this,l=o.get_CustomWindow(),r=o.get_Buttons(),c=[],d=o.get_Size(),h=o.get_Modal();(!d||d.length<2)&&(d=[800,600]),_.isArray(r)&&_.each(r,(function(t,e){t.visible&&(c[e]={caption:t.text,value:e,primary:t.primary})}));var p=o.get_Help();a.pluginDlg=new Common.Views.PluginDlg({cls:l?"plain":"",header:!l,title:t.get_Name(),width:d[0],height:d[1],url:s,frameId:i,buttons:l?void 0:c,toolcallback:_.bind(this.onToolClose,this),help:!!p,loader:t.get_Loader(),modal:void 0===h||h}),a.pluginDlg.on({"render:after":function(t){t.getChild(".footer .dlg-btn").on("click",_.bind(a.onDlgBtnClick,a)),a.pluginContainer=a.pluginDlg.$window.find("#id-plugin-container")},close:function(t){a.pluginDlg=void 0},drag:function(t){a.api.asc_pluginEnableMouseEvents("start"==t[1])},resize:function(t){a.api.asc_pluginEnableMouseEvents("start"==t[1])},help:function(){p&&window.open(p,"_blank")},"header:click":function(t){a.api.asc_pluginButtonClick(t)}}),a.pluginDlg.show()}}this.panelPlugins.openedPluginMode(t.get_Guid())},onPluginClose:function(t){this.pluginDlg?this.pluginDlg.close():this.panelPlugins.iframePlugin&&this.panelPlugins.closeInsideMode(),this.panelPlugins.closedPluginMode(t.get_Guid()),this.runAutoStartPlugins()},onPluginResize:function(t,e,i,n){if(this.pluginDlg){var o=e&&e.length>1&&i&&i.length>1&&(i[0]>e[0]||i[1]>e[1]||0==i[0]||0==i[1]);this.pluginDlg.setResizable(o,e,i),this.pluginDlg.setInnerSize(t[0],t[1]),n&&n.call()}},onDlgBtnClick:function(t){var e=t.currentTarget.attributes.result.value;this.api.asc_pluginButtonClick(parseInt(e))},onToolClose:function(){this.api.asc_pluginButtonClick(-1)},onPluginMouseUp:function(t,e){this.pluginDlg?(this.pluginDlg.binding.dragStop&&this.pluginDlg.binding.dragStop(),this.pluginDlg.binding.resizeStop&&this.pluginDlg.binding.resizeStop()):Common.NotificationCenter.trigger("frame:mouseup",{pageX:t*Common.Utils.zoom()+this._moveOffset.x,pageY:e*Common.Utils.zoom()+this._moveOffset.y})},onPluginMouseMove:function(t,e){if(this.pluginDlg){var i=this.pluginContainer.offset();this.pluginDlg.binding.drag&&this.pluginDlg.binding.drag({pageX:t*Common.Utils.zoom()+i.left,pageY:e*Common.Utils.zoom()+i.top}),this.pluginDlg.binding.resize&&this.pluginDlg.binding.resize({pageX:t*Common.Utils.zoom()+i.left,pageY:e*Common.Utils.zoom()+i.top})}else Common.NotificationCenter.trigger("frame:mousemove",{pageX:t*Common.Utils.zoom()+this._moveOffset.x,pageY:e*Common.Utils.zoom()+this._moveOffset.y})},onPluginsInit:function(t){!(t instanceof Array)&&(t=t.pluginsData),this.parsePlugins(t)},onPluginShowButton:function(t){this.pluginDlg&&this.pluginDlg.showButton(t)},onPluginHideButton:function(t){this.pluginDlg&&this.pluginDlg.hideButton(t)},runAutoStartPlugins:function(){this.autostart&&this.autostart.length>0&&this.api.asc_pluginRun(this.autostart.shift(),0,"")},resetPluginsList:function(){this.getApplication().getCollection("Common.Collections.Plugins").reset()},applyUICustomization:function(){var me=this;return new Promise((function(resolve,reject){var timer_sl=setInterval((function(){if(me.customPluginsComplete){clearInterval(timer_sl);try{me.configPlugins.UIplugins&&me.configPlugins.UIplugins.forEach((function(c){c.code&&eval(c.code)}))}catch(t){}resolve()}}),10)}))},parsePlugins:function(t,e){var i=this,n=this.getApplication().getCollection("Common.Collections.Plugins"),o=i.appOptions.isEdit,s=i.editor,a=i.api?i.api.GetVersion():void 0;if(t instanceof Array){var l=[],r=[],c=i.appOptions.lang.split(/[\-_]/)[0];t.forEach((function(t){if(!(l.some((function(e){return e.get("baseUrl")==t.baseUrl||e.get("guid")==t.guid}))||n.findWhere({baseUrl:t.baseUrl})||n.findWhere({guid:t.guid}))){var e=[],d=!1;if(t.variations.forEach((function(i){var n=(o||i.isViewer&&!1!==i.isDisplayedInViewer)&&_.contains(i.EditorsSupport,s)&&!i.isSystem;if(n&&(d=!0),t.isUICustomizer)n&&r.push({url:t.baseUrl+i.url});else{var a=new Common.Models.PluginVariation(i),l=i.description;"object"==typeof i.descriptionLocale&&(l=i.descriptionLocale[c]||i.descriptionLocale.en||l||""),_.each(i.buttons,(function(t,e){"object"==typeof t.textLocale&&(t.text=t.textLocale[c]||t.textLocale.en||t.text||""),t.visible=o||!1!==t.isViewer})),a.set({description:l,index:e.length,url:i.url,icons:i.icons2||i.icons,buttons:i.buttons,visible:n,help:i.help}),e.push(a)}})),e.length>0&&!t.isUICustomizer){var h=t.name;"object"==typeof t.nameLocale&&(h=t.nameLocale[c]||t.nameLocale.en||h||""),d&&(d=i.checkPluginVersion(a,t.minVersion)),l.push(new Common.Models.Plugin({name:h,guid:t.guid,baseUrl:t.baseUrl,variations:e,currentVariation:0,visible:d,groupName:t.group?t.group.name:"",groupRank:t.group?t.group.rank:0,minVersion:t.minVersion,original:t}))}}})),!1!==e&&(i.configPlugins.UIplugins=r),!e&&n&&((l=n.models.concat(l)).sort((function(t,e){var i=t.get("groupRank"),n=e.get("groupRank");return i<n?0==i?1:-1:i>n?0==n?-1:1:0})),n.reset(l),this.appOptions.canPlugins=!n.isEmpty())}else e||(this.appOptions.canPlugins=!1);e||this.getApplication().getController("LeftMenu").enablePlugins(),this.appOptions.canPlugins&&(this.refreshPluginsList(),this.runAutoStartPlugins())},checkPluginVersion:function(t,e){if(t&&"develop"!==t&&e&&"string"==typeof e){var i=e.match(/^([0-9]+)(?:.([0-9]+))?(?:.([0-9]+))?$/),n=t.match(/^([0-9]+)(?:.([0-9]+))?(?:.([0-9]+))?$/);if(i&&i.length>1&&n&&n.length>1)for(var o=0;o<3;o++){var s=i[o+1]?parseInt(i[o+1]):0,a=n[o+1]?parseInt(n[o+1]):0;if(s>a)return!1;if(s<a)return!0}}return!0},getPlugins:function(t,e){if(!t||t.length<1)return Promise.resolve([]);e=e||function(t){return fetch(t).then((function(e){return e.ok?e.json():Promise.reject(t)})).then((function(e){return e.baseUrl=t.substring(0,t.lastIndexOf("config.json")),e}))};var i=[];return t.map(e).reduce((function(t,e){return t.then((function(){return e})).then((function(t){return i.push(t),Promise.resolve(t)})).catch((function(t){return Promise.resolve(t)}))}),Promise.resolve()).then((function(){return Promise.resolve(i)}))},mergePlugins:function(){if(void 0!==this.serverPlugins.plugins&&void 0!==this.configPlugins.plugins){var t=[],e=[],i=this.configPlugins,n=!1;if(i.plugins&&i.plugins.length>0&&(e=i.plugins),i&&i.config){var o=i.config.autostart||i.config.autoStartGuid;"string"==typeof o&&(o=[o]),n=!!i.config.autoStartGuid,t=o||[]}(i=this.serverPlugins).plugins&&i.plugins.length>0&&(e=e.concat(i.plugins)),i&&i.config&&("string"==typeof(o=i.config.autostart||i.config.autoStartGuid)&&(o=[o]),(n||i.config.autoStartGuid)&&console.warn("Obsolete: The autoStartGuid parameter is deprecated. Please check the documentation for new plugin connection configuration."),t=t.concat(o||[])),this.autostart=t,this.parsePlugins(e,!1)}},getAppCustomPlugins:function(t){var e=this,i=function(){e.customPluginsComplete=!0};t.config?this.getPlugins(t.config.UIpluginsData).then((function(n){e.parsePlugins(n,!0),e.getPlugins(t.UIplugins,(function(t){return fetch(t.url).then((function(t){return t.ok?t.text():Promise.reject()})).then((function(e){return t.code=e,e}))})).then(i,i)}),i):i()}},Common.Controllers.Plugins||{}))})),define("common/main/lib/view/ExternalOleEditor",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.ExternalOleEditor=Common.UI.Window.extend(_.extend({initialize:function(t){var e={},i=Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top");_.extend(e,{title:this.textTitle,width:910,height:i-700<0?i:700,cls:"advanced-settings-dlg",header:!0,toolclose:"hide",toolcallback:_.bind(this.onToolClose,this)},t),this.template=['<div id="id-ole-editor-container" class="box" style="height:'+(e.height-85)+'px;">','<div id="id-ole-editor-placeholder" style="width: 100%;height: 100%;"></div>',"</div>",'<div class="separator horizontal"></div>','<div class="footer" style="text-align: center;">','<button id="id-btn-ole-editor-apply" class="btn normal dlg-btn primary custom" result="ok" data-hint="1" data-hint-direction="bottom" data-hint-offset="big">'+this.textSave+"</button>",'<button id="id-btn-ole-editor-cancel" class="btn normal dlg-btn" result="cancel" data-hint="1" data-hint-direction="bottom" data-hint-offset="big">'+this.textClose+"</button>","</div>"].join(""),e.tpl=_.template(this.template)(e),this.handler=e.handler,this._oleData=null,this._isNewOle=!0,Common.UI.Window.prototype.initialize.call(this,e)},render:function(){Common.UI.Window.prototype.render.call(this),this.btnSave=new Common.UI.Button({el:$("#id-btn-ole-editor-apply"),disabled:!0}),this.btnCancel=new Common.UI.Button({el:$("#id-btn-ole-editor-cancel")}),this.$window.find(".dlg-btn").on("click",_.bind(this.onDlgBtnClick,this))},show:function(){this.setPlaceholder(),Common.UI.Window.prototype.show.apply(this,arguments)},setOleData:function(t){this._oleData=t,this._isExternalDocReady&&this.fireEvent("setoledata",this)},setEditMode:function(t){this._isNewOle=!t},isEditMode:function(){return!this._isNewOle},setControlsDisabled:function(t){this.btnSave.setDisabled(t),this.btnCancel.setDisabled(t),t?this.$window.find(".tool.close").addClass("disabled"):this.$window.find(".tool.close").removeClass("disabled")},onDlgBtnClick:function(t){this.handler?this.handler.call(this,t.currentTarget.attributes.result.value):this.hide()},onToolClose:function(){this.handler?this.handler.call(this,"cancel"):this.hide()},setHeight:function(t){if(t>=0){var e=parseInt(this.$window.css("min-height"));t<e&&(t=e),this.$window.height(t);var i=this.initConfig.header?parseInt(this.$window.find("> .header").css("height")):0;this.$window.find("> .body").css("height",t-i),this.$window.find("> .body > .box").css("height",t-85);var n=(Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top")-parseInt(t))/2,o=(Common.Utils.innerWidth()-parseInt(this.initConfig.width))/2;this.$window.css("left",o),this.$window.css("top",Common.Utils.InternalSettings.get("window-inactive-area-top")+n)}},setPlaceholder:function(t){this._placeholder=t},getPlaceholder:function(){return this._placeholder},textSave:"Save & Exit",textClose:"Close",textTitle:"Spreadsheet Editor"},Common.Views.ExternalOleEditor||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ExternalOleEditor",["core","common/main/lib/view/ExternalOleEditor"],(function(){"use strict";var t,e,i,n,o,s;Common.Controllers.ExternalOleEditor=Backbone.Controller.extend(_.extend((t="en",e=void 0,i="",n=null,o=!0,s=function(){e&&(e.uiTheme=Common.localStorage.getItem("ui-theme-id","theme-light")),n=new DocsAPI.DocEditor("id-ole-editor-placeholder",{width:"100%",height:"100%",documentType:"cell",document:{url:"_chart_",permissions:{edit:!0,download:!1}},editorConfig:{mode:"editole",targetApp:i,lang:t,canCoAuthoring:!1,canBackToFolder:!1,canCreateNew:!1,customization:e,user:{id:"uid-"+Date.now()}},events:{onAppReady:function(){},onDocumentStateChange:function(){},onError:function(){},onInternalMessage:_.bind(this.onInternalMessage,this)}}),Common.Gateway.on("processmouse",_.bind(this.onProcessMouse,this))},{views:["Common.Views.ExternalOleEditor"],initialize:function(){this.addListeners({"Common.Views.ExternalOleEditor":{setoledata:_.bind(this.setOleData,this),drag:_.bind((function(t,e){n&&n.serviceCommand("window:drag","start"==e)}),this),show:_.bind((function(t){var e=this.oleEditorView.getHeight(),i=Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top");(i>e&&e<700||i<e)&&(e=Math.min(i,700),this.oleEditorView.setHeight(e)),n?(n.serviceCommand("setAppDisabled",!1),o&&this.oleEditorView._isExternalDocReady&&(o=!1,this.oleEditorView._oleData&&this.setOleData()),this.needDisableEditing&&this.oleEditorView._isExternalDocReady&&this.onOleEditingDisabled(),n.attachMouseEvents()):s.apply(this),this.isExternalEditorVisible=!0,this.isHandlerCalled=!1}),this),hide:_.bind((function(t){n&&(n.detachMouseEvents(),this.isExternalEditorVisible=!1)}),this)}})},onLaunch:function(){this.oleEditorView=this.createView("Common.Views.ExternalOleEditor",{handler:_.bind(this.handler,this)})},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onCloseOleEditor",_.bind(this.onOleEditingDisabled,this)),this.api.asc_registerCallback("asc_sendFromGeneralToFrameEditor",_.bind(this.onSendFromGeneralToFrameEditor,this)),this},handler:function(t,e){this.isHandlerCalled||(this.isHandlerCalled=!0,this.oleEditorView._isExternalDocReady?n&&n.serviceCommand("queryClose",{mr:t}):(this.oleEditorView.hide(),this.isHandlerCalled=!1))},setOleData:function(){o||(n&&n.serviceCommand("setOleData",this.oleEditorView._oleData),this.oleEditorView._oleData=null)},loadConfig:function(n){n&&n.config&&(n.config.lang&&(t=n.config.lang),n.config.customization&&(e=n.config.customization),n.config.targetApp&&(i=n.config.targetApp))},onOleEditingDisabled:function(){this.oleEditorView.isVisible()&&this.oleEditorView._isExternalDocReady?(this.oleEditorView.setControlsDisabled(!0),Common.UI.alert({title:this.warningTitle,msg:this.warningText,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.oleEditorView.setControlsDisabled(!1),this.oleEditorView.hide()}),this)}),this.needDisableEditing=!1):this.needDisableEditing=!0},onInternalMessage:function(t){var e=t.data;if(this.oleEditorView)if("documentReady"==e.type)this.oleEditorView._isExternalDocReady=!0,this.isExternalEditorVisible&&(o=!1),this.oleEditorView._oleData&&this.setOleData(),this.needDisableEditing&&this.onOleEditingDisabled();else if("oleEditorReady"==e.type)void 0===this.needDisableEditing&&this.oleEditorView.setControlsDisabled(!1);else if("shortcut"==e.type)"escape"==e.data.key&&this.oleEditorView.hide();else if("canClose"==e.type)!0===e.data.answer&&(n&&(n.serviceCommand("setAppDisabled",!0),"ok"==e.data.mr&&n.serviceCommand("getOleData")),this.oleEditorView.hide()),this.isHandlerCalled=!1;else if("processMouse"==e.type){if("mouse:up"==e.data.event)this.oleEditorView.binding.dragStop();else if("mouse:move"==e.data.event){var i=parseInt(this.oleEditorView.$window.css("left"))+e.data.pagex,s=parseInt(this.oleEditorView.$window.css("top"))+e.data.pagey+34;this.oleEditorView.binding.drag({pageX:i,pageY:s})}}else"frameToGeneralData"==e.type?this.api&&this.api.asc_getInformationBetweenFrameAndGeneralEditor(e.data):this.oleEditorView.fireEvent("internalmessage",this.oleEditorView,e)},onProcessMouse:function(t){"mouseup"==t.type&&this.isExternalEditorVisible&&n&&n.serviceCommand("processmouse",t)},onSendFromGeneralToFrameEditor:function(t){n&&n.serviceCommand("generalToFrameData",t)},warningTitle:"Warning",warningText:"The object is disabled because of editing by another user.",textClose:"Close",textAnonymous:"Anonymous"}),Common.Controllers.ExternalOleEditor||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/ReviewChange",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.ReviewChange=e.Model.extend({defaults:{uid:0,userid:0,username:"Guest",usercolor:null,date:void 0,changetext:"",lock:!1,lockuser:"",type:0,changedata:null,hint:!1,editable:!1,id:Common.UI.getId(),scope:null}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/ReviewChanges",["underscore","backbone","common/main/lib/model/ReviewChange"],(function(t,e){"use strict";Common.Collections.ReviewChanges=e.Collection.extend({model:Common.Models.ReviewChange})})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/ReviewChanges",["common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(){"use strict";Common.enumLock||(Common.enumLock={});var t={noSpellcheckLangs:"no-spellcheck-langs",isReviewOnly:"review-only",reviewChangelock:"review-change-lock",hasCoeditingUsers:"has-coediting-users",previewReviewMode:"preview-review-mode",viewFormMode:"view-form-mode",viewMode:"view-mode",hideComments:"hide-comments",cantShare:"cant-share"};for(var e in t)t.hasOwnProperty(e)&&(Common.enumLock[e]=t[e]);Common.Views.ReviewChanges=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.canReview&&(this.btnAccept.on("click",(function(e){t.fireEvent("reviewchange:accept",[t.btnAccept,"current"])})),this.btnAccept.menu&&this.btnAccept.menu.on("item:click",(function(e,i,n){t.fireEvent("reviewchange:accept",[e,i])})),this.btnReject.on("click",(function(e){t.fireEvent("reviewchange:reject",[t.btnReject,"current"])})),this.btnReject.menu&&this.btnReject.menu.on("item:click",(function(e,i,n){t.fireEvent("reviewchange:reject",[e,i])})),t.appConfig.canFeatureComparison&&(this.btnCompare.on("click",(function(e){t.fireEvent("reviewchange:compare",["file"])})),this.btnCompare.menu.on("item:click",(function(e,i,n){t.fireEvent("reviewchange:compare",[i.value])}))),this.btnsTurnReview.forEach((function(e){e.on("click",(function(t,e){Common.NotificationCenter.trigger("reviewchanges:turn",t.pressed),Common.NotificationCenter.trigger("edit:complete")})),!t.appConfig.isReviewOnly&&e.menu.on("item:toggle",(function(e,i,n,o){n&&(2==i.value?Common.UI.warning({title:t.textWarnTrackChangesTitle,msg:t.textWarnTrackChanges,maxwidth:600,buttons:[{value:"enable",caption:t.textEnable},"cancel"],primary:"enable",callback:function(e){if("enable"==e)Common.NotificationCenter.trigger("reviewchanges:turn",0==i.value||2==i.value,i.value>1);else{var n=Common.Utils.InternalSettings.get(t.appPrefix+"track-changes");t.turnChanges(0==n||2==n,n>1)}Common.NotificationCenter.trigger("edit:complete")}}):Common.NotificationCenter.trigger("reviewchanges:turn",0==i.value||2==i.value,i.value>1))}))}))),this.appConfig.canViewReview&&(this.btnPrev.on("click",(function(e){t.fireEvent("reviewchange:preview",[t.btnPrev,"prev"])})),this.btnNext.on("click",(function(e){t.fireEvent("reviewchange:preview",[t.btnNext,"next"])})),this.btnReviewView&&this.btnReviewView.menu.on("item:click",(function(e,i,n){t.fireEvent("reviewchange:view",[e,i])}))),this.btnsSpelling.forEach((function(e){e.on("click",(function(e,i){Common.NotificationCenter.trigger("spelling:turn",e.pressed?"on":"off"),Common.NotificationCenter.trigger("edit:complete",t)}))})),this.btnsDocLang.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("lang:document",this)}))})),this.btnSharing&&this.btnSharing.on("click",(function(t,e){Common.NotificationCenter.trigger("collaboration:sharing")})),this.btnCoAuthMode&&this.btnCoAuthMode.menu.on("item:click",(function(e,i,n){t.fireEvent("collaboration:coauthmode",[e,i])})),this.btnHistory&&this.btnHistory.on("click",(function(t,e){Common.NotificationCenter.trigger("collaboration:history")})),this.btnChat&&this.btnChat.on("click",(function(e,i){t.fireEvent("collaboration:chat",[e.pressed])})),this.btnCommentRemove&&(this.btnCommentRemove.on("click",(function(e){t.fireEvent("comment:removeComments",["current"])})),this.btnCommentRemove.menu.on("item:click",(function(e,i,n){t.fireEvent("comment:removeComments",[i.value])}))),this.btnCommentResolve&&(this.btnCommentResolve.on("click",(function(e){t.fireEvent("comment:resolveComments",["current"])})),this.btnCommentResolve.menu.on("item:click",(function(e,i,n){t.fireEvent("comment:resolveComments",[i.value])})))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode,this.lockedControls=[];var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"";var i=Common.enumLock;if(this.appConfig.canReview&&(this.btnAccept=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtAccept,split:!this.appConfig.canUseReviewPermissions,iconCls:"toolbar__icon btn-review-save",lock:[i.reviewChangelock,i.isReviewOnly,i.previewReviewMode,i.viewFormMode,i.lostConnect],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnAccept),this.btnReject=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtReject,split:!this.appConfig.canUseReviewPermissions,iconCls:"toolbar__icon btn-review-deny",lock:[i.reviewChangelock,i.isReviewOnly,i.previewReviewMode,i.viewFormMode,i.lostConnect],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnReject),this.appConfig.canFeatureComparison&&(this.btnCompare=new Common.UI.Button({cls:"btn-toolbar  x-huge icon-top",caption:this.txtCompare,split:!0,iconCls:"toolbar__icon btn-compare",lock:[i.hasCoeditingUsers,i.previewReviewMode,i.viewFormMode,i.lostConnect],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCompare)),this.btnTurnOn=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-review",lock:[i.previewReviewMode,i.viewFormMode,i.lostConnect],caption:this.txtTurnon,split:!this.appConfig.isReviewOnly,enableToggle:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnsTurnReview=[this.btnTurnOn],this.lockedControls.push(this.btnTurnOn)),this.appConfig.canViewReview&&(this.btnPrev=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-review-prev",lock:[i.previewReviewMode,i.viewFormMode,i.lostConnect],caption:this.txtPrev,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPrev),this.btnNext=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-review-next",lock:[i.previewReviewMode,i.viewFormMode,i.lostConnect],caption:this.txtNext,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnNext),!(this.appConfig.isRestrictedEdit||this.appConfig.customization&&this.appConfig.customization.review&&this.appConfig.customization.review.hideReviewDisplay))){var n=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><%= caption %></div><% if (options.description !== null) { %><label style="display: block;color: #a5a5a5;cursor: pointer;white-space: normal;"><%= options.description %></label><% } %></a>');this.btnReviewView=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-reviewview",lock:[i.viewFormMode,i.lostConnect],caption:this.txtView,menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:this.txtMarkupCap,checkable:!0,toggleGroup:"menuReviewView",checked:!0,value:"markup",template:n,description:Common.Utils.String.format(this.txtMarkup,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtEditing+")":"")},{caption:this.txtMarkupSimpleCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,value:"simple",template:n,description:Common.Utils.String.format(this.txtMarkupSimple,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtEditing+")":"")},{caption:this.txtFinalCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,template:n,description:Common.Utils.String.format(this.txtFinal,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtPreview+")":""),value:"final"},{caption:this.txtOriginalCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,template:n,description:Common.Utils.String.format(this.txtOriginal,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtPreview+")":""),value:"original"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnReviewView)}(this.appConfig.sharingSettingsUrl&&this.appConfig.sharingSettingsUrl.length||this.appConfig.canRequestSharingSettings)&&!0!==this._readonlyRights&&(this.btnSharing=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-sharing",lock:[i.viewFormMode,i.cantShare,i.lostConnect],caption:this.txtSharing,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnSharing)),this.appConfig.isEdit&&!this.appConfig.isOffline&&this.appConfig.canCoAuthoring&&this.appConfig.canChangeCoAuthoring&&(this.btnCoAuthMode=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-coedit",lock:[i.viewFormMode,i.lostConnect],caption:this.txtCoAuthMode,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCoAuthMode)),this.btnsSpelling=[],this.btnsDocLang=[],this.appConfig.canUseHistory&&!this.appConfig.isDisconnected&&(this.btnHistory=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-history",lock:[i.lostConnect],caption:this.txtHistory,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnHistory)),this.appConfig.canCoAuthoring&&this.appConfig.canChat&&(this.btnChat=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-chat",lock:[i.lostConnect],caption:this.txtChat,enableToggle:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnChat)),this.appConfig.canCoAuthoring&&this.appConfig.canComments&&(this.btnCommentRemove=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtCommentRemove,split:!0,iconCls:"toolbar__icon btn-rem-comment",lock:[i.previewReviewMode,i.viewFormMode,i.hideComments,i.Objects,i.lostConnect],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCommentRemove),this.btnCommentResolve=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtCommentResolve,split:!0,iconCls:"toolbar__icon btn-resolve-all",lock:[i.previewReviewMode,i.viewFormMode,i.hideComments,i.Objects,i.lostConnect],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCommentResolve)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){var n=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><%= caption %></div><% if (options.description !== null) { %><label style="display: block;color: #a5a5a5;cursor: pointer;white-space: normal;"><%= options.description %></label><% } %></a>');if(e.canReview){var o=Common.Utils.InternalSettings.get(i.appPrefix+"track-changes");!e.isReviewOnly&&i.btnTurnOn.setMenu(new Common.UI.Menu({items:[{caption:i.txtOn,value:0,checkable:!0,checked:0==o,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOff,value:1,checkable:!0,checked:1==o,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOnGlobal,value:2,checkable:!0,checked:2==o,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOffGlobal,value:3,checkable:!0,checked:3==o,toggleGroup:"menuTurnReviewTlb"}]})),i.btnTurnOn.updateHint(i.tipReview),i.appConfig.canUseReviewPermissions||(i.btnAccept.setMenu(new Common.UI.Menu({items:[{caption:i.txtAcceptCurrent,value:"current"},{caption:i.txtAcceptAll,value:"all"}]})),i.btnReject.setMenu(new Common.UI.Menu({items:[{caption:i.txtRejectCurrent,value:"current"},{caption:i.txtRejectAll,value:"all"}]}))),i.btnAccept.updateHint([i.tipAcceptCurrent,i.txtAcceptChanges]),i.btnReject.updateHint([i.tipRejectCurrent,i.txtRejectChanges]),e.canFeatureComparison&&(i.btnCompare.setMenu(new Common.UI.Menu({items:[{caption:i.mniFromFile,value:"file"},{caption:i.mniFromUrl,value:"url"},{caption:i.mniFromStorage,value:"storage"}]})),i.btnCompare.menu.items[2].setVisible(i.appConfig.canRequestCompareFile||i.appConfig.fileChoiceUrl&&i.appConfig.fileChoiceUrl.indexOf("{documentType}")>-1),i.btnCompare.updateHint(i.tipCompare)),Common.Utils.lockControls(Common.enumLock.isReviewOnly,e.isReviewOnly,{array:[i.btnAccept,i.btnReject]})}if(i.appConfig.canViewReview&&(i.btnPrev.updateHint(i.hintPrev),i.btnNext.updateHint(i.hintNext),i.btnReviewView&&i.btnReviewView.updateHint(i.tipReviewView)),i.btnSharing&&i.btnSharing.updateHint(i.tipSharing),i.btnHistory&&i.btnHistory.updateHint(i.tipHistory),i.btnChat&&i.btnChat.updateHint(i.txtChat+Common.Utils.String.platformKey("Alt+Q")),i.btnCoAuthMode&&(i.btnCoAuthMode.setMenu(new Common.UI.Menu({cls:"ppm-toolbar",style:"max-width: 220px;",items:[{caption:i.strFast,checkable:!0,toggleGroup:"menuCoauthMode",checked:!0,template:n,description:i.strFastDesc,value:1},{caption:i.strStrict,checkable:!0,toggleGroup:"menuCoauthMode",checked:!1,template:n,description:i.strStrictDesc,value:0}]})),i.btnCoAuthMode.updateHint(i.tipCoAuthMode),i.turnCoAuthMode(Common.Utils.InternalSettings.get(i.appPrefix+"settings-coauthmode"))),i.btnCommentRemove){var s=[{caption:e.canDeleteComments?i.txtCommentRemCurrent:i.txtCommentRemMyCurrent,value:"current"},{caption:i.txtCommentRemMy,value:"my"}];e.canDeleteComments&&s.push({caption:i.txtCommentRemAll,value:"all"}),i.btnCommentRemove.setMenu(new Common.UI.Menu({items:s})),i.btnCommentRemove.updateHint([i.tipCommentRemCurrent,i.tipCommentRem])}if(i.btnCommentResolve){s=[{caption:e.canEditComments?i.txtCommentResolveCurrent:i.txtCommentResolveMyCurrent,value:"current"},{caption:i.txtCommentResolveMy,value:"my"}];e.canEditComments&&s.push({caption:i.txtCommentResolveAll,value:"all"}),i.btnCommentResolve.setMenu(new Common.UI.Menu({items:s})),i.btnCommentResolve.updateHint([i.tipCommentResolveCurrent,i.tipCommentResolve])}var a,l=i.btnSharing||i.btnCoAuthMode?".separator.sharing":i.$el.find(".separator.sharing"),r=e.canComments&&e.canCoAuthoring?".separator.comments":i.$el.find(".separator.comments"),c=e.canReview||e.canViewReview?".separator.review":i.$el.find(".separator.review"),d=e.canReview&&e.canFeatureComparison?".separator.compare":i.$el.find(".separator.compare"),h=i.btnChat?".separator.chat":i.$el.find(".separator.chat");"object"==typeof l?l.hide().prev(".group").hide():a=l,"object"==typeof r?r.hide().prev(".group").hide():a=r,"object"==typeof c?c.hide().prevUntil(".separator.comments").hide():a=c,"object"==typeof d?d.hide().prev(".group").hide():a=d,"object"==typeof h?h.hide().prev(".group").hide():a=h,!i.btnHistory&&a&&i.$el.find(a).hide(),Common.NotificationCenter.trigger("tab:visible","review",(e.isEdit||e.canViewReview||e.canCoAuthoring&&e.canComments)&&Common.UI.LayoutManager.isElementVisible("toolbar-collaboration")),t.call(i)}))},getPanel:function(){return this.$el=$(_.template('<section id="review-changes-panel" class="panel" data-tab="review"><div class="group no-group-mask review"><span id="slot-btn-sharing" class="btn-slot text x-huge"></span><span id="slot-btn-coauthmode" class="btn-slot text x-huge"></span></div><div class="separator long sharing"></div><div class="group"><span class="btn-slot text x-huge slot-comment"></span><span class="btn-slot text x-huge" id="slot-comment-remove"></span><span class="btn-slot text x-huge" id="slot-comment-resolve"></span></div><div class="separator long comments"></div><div class="group"><span id="btn-review-on" class="btn-slot text x-huge"></span></div><div class="group no-group-mask review" style="padding-left: 0;"><span id="btn-review-view" class="btn-slot text x-huge"></span></div><div class="group move-changes" style="padding-left: 0;"><span id="btn-change-prev" class="btn-slot text x-huge"></span><span id="btn-change-next" class="btn-slot text x-huge"></span><span id="btn-change-accept" class="btn-slot text x-huge"></span><span id="btn-change-reject" class="btn-slot text x-huge"></span></div><div class="separator long review"></div><div class="group"><span id="btn-compare" class="btn-slot text x-huge"></span></div><div class="separator long compare"></div><div class="group no-group-mask review form-view"><span id="slot-btn-chat" class="btn-slot text x-huge"></span></div><div class="separator long chat"></div><div class="group no-group-mask review form-view"><span id="slot-btn-history" class="btn-slot text x-huge"></span></div></section>')({})),this.appConfig.canReview&&(this.btnAccept.render(this.$el.find("#btn-change-accept")),this.btnReject.render(this.$el.find("#btn-change-reject")),this.appConfig.canFeatureComparison&&this.btnCompare.render(this.$el.find("#btn-compare")),this.btnTurnOn.render(this.$el.find("#btn-review-on"))),this.btnPrev&&this.btnPrev.render(this.$el.find("#btn-change-prev")),this.btnNext&&this.btnNext.render(this.$el.find("#btn-change-next")),this.btnReviewView&&this.btnReviewView.render(this.$el.find("#btn-review-view")),this.btnSharing&&this.btnSharing.render(this.$el.find("#slot-btn-sharing")),this.btnCoAuthMode&&this.btnCoAuthMode.render(this.$el.find("#slot-btn-coauthmode")),this.btnHistory&&this.btnHistory.render(this.$el.find("#slot-btn-history")),this.btnChat&&this.btnChat.render(this.$el.find("#slot-btn-chat")),this.btnCommentRemove&&this.btnCommentRemove.render(this.$el.find("#slot-comment-remove")),this.btnCommentResolve&&this.btnCommentResolve.render(this.$el.find("#slot-comment-resolve")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButton:function(t,e){if("turn"==t&&"statusbar"==e){var i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-review",lock:[Common.enumLock.viewMode,Common.enumLock.previewReviewMode,Common.enumLock.viewFormMode,Common.enumLock.lostConnect],hintAnchor:"top",hint:this.tipReview,split:!this.appConfig.isReviewOnly,enableToggle:!0,menu:!this.appConfig.isReviewOnly&&new Common.UI.Menu({menuAlign:"bl-tl",style:"margin-top:-5px;",items:[{caption:this.txtOn,value:0,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOff,value:1,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOnGlobal,value:2,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOffGlobal,value:3,checkable:!0,toggleGroup:"menuTurnReviewStb"}]}),dataHint:"0",dataHintDirection:"top",dataHintOffset:"2, -16"});return this.btnsTurnReview.push(i),this.lockedControls.push(i),i}return"spelling"==t?(i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-docspell",lock:[Common.enumLock.viewMode,Common.enumLock.viewFormMode,Common.enumLock.previewReviewMode],hintAnchor:"top",hint:this.tipSetSpelling,enableToggle:!0,dataHint:"0",dataHintDirection:"top",dataHintOffset:"small",visible:Common.UI.FeaturesManager.canChange("spellcheck")}),this.btnsSpelling.push(i),this.lockedControls.push(i),i):"doclang"==t&&"statusbar"==e?(i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-doclang",lock:[Common.enumLock.viewMode,Common.enumLock.previewReviewMode,Common.enumLock.viewFormMode,Common.enumLock.noSpellcheckLangs,Common.enumLock.lostConnect],hintAnchor:"top",hint:this.tipSetDocLang,dataHint:"0",dataHintDirection:"top",dataHintOffset:"small"}),this.btnsDocLang.push(i),this.lockedControls.push(i),Common.Utils.lockControls(Common.enumLock.noSpellcheckLangs,!0,{array:[i]}),i):void 0},getButtons:function(){return this.lockedControls},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},turnChanges:function(t,e){this.btnsTurnReview.forEach((function(i){i&&i.pressed!=t&&i.toggle(t,!0),i.menu&&(i.menu.items[0].setChecked(t&&!e,!0),i.menu.items[1].setChecked(!t&&!e,!0),i.menu.items[2].setChecked(t&&!!e,!0),i.menu.items[3].setChecked(!t&&!!e,!0))}),this)},markChanges:function(t){this.btnsTurnReview.forEach((function(e){e&&$(".icon",e.cmpEl)[t?"addClass":"removeClass"]("btn-ic-changes")}),this)},turnSpelling:function(t){this.btnsSpelling&&this.btnsSpelling.forEach((function(e){e&&e.pressed!=t&&e.toggle(t,!0)}),this)},turnCoAuthMode:function(t){this.btnCoAuthMode&&(this.btnCoAuthMode.menu.items[0].setChecked(t,!0),this.btnCoAuthMode.menu.items[1].setChecked(!t,!0))},turnChat:function(t){this.btnChat&&this.btnChat.toggle(t,!0)},turnDisplayMode:function(t){this.btnReviewView&&(this.btnReviewView.menu.items[0].setChecked("markup"==t,!0),this.btnReviewView.menu.items[1].setChecked("simple"==t,!0),this.btnReviewView.menu.items[2].setChecked("final"==t,!0),this.btnReviewView.menu.items[3].setChecked("original"==t,!0))},onLostEditRights:function(){this._readonlyRights=!0},txtAccept:"Accept",txtAcceptCurrent:"Accept current Changes",txtAcceptAll:"Accept all Changes",txtReject:"Reject",txtRejectCurrent:"Reject current Changes",txtRejectAll:"Reject all Changes",hintNext:"To Next Change",hintPrev:"To Previous Change",txtPrev:"Previous",txtNext:"Next",txtTurnon:"Turn On",txtSpelling:"Spell checking",txtDocLang:"Language",tipSetDocLang:"Set Document Language",tipSetSpelling:"Spell checking",tipReview:"Review",txtAcceptChanges:"Accept Changes",txtRejectChanges:"Reject Changes",txtView:"Display Mode",txtMarkup:"Text with changes {0}",txtFinal:"All changes like accept {0}",txtOriginal:"Text without changes {0}",tipReviewView:"Select the way you want the changes to be displayed",tipAcceptCurrent:"Accept current changes",tipRejectCurrent:"Reject current changes",txtSharing:"Sharing",tipSharing:"Manage document access rights",txtCoAuthMode:"Co-editing Mode",tipCoAuthMode:"Set co-editing mode",strFast:"Fast",strStrict:"Strict",txtHistory:"Version History",tipHistory:"Show version history",txtChat:"Chat",txtMarkupCap:"Markup",txtFinalCap:"Final",txtOriginalCap:"Original",strFastDesc:"Real-time co-editing. All changes are saved automatically.",strStrictDesc:"Use the 'Save' button to sync the changes you and others make.",txtCompare:"Compare",tipCompare:"Compare current document with another one",mniFromFile:"Document from File",mniFromUrl:"Document from URL",mniFromStorage:"Document from Storage",mniSettings:"Comparison Settings",txtCommentRemove:"Remove",tipCommentRemCurrent:"Remove current comments",tipCommentRem:"Remove comments",txtCommentRemCurrent:"Remove Current Comments",txtCommentRemMyCurrent:"Remove My Current Comments",txtCommentRemMy:"Remove My Comments",txtCommentRemAll:"Remove All Comments",txtCommentResolve:"Resolve",tipCommentResolveCurrent:"Resolve current comments",tipCommentResolve:"Resolve comments",txtCommentResolveCurrent:"Resolve Current Comments",txtCommentResolveMyCurrent:"Resolve My Current Comments",txtCommentResolveMy:"Resolve My Comments",txtCommentResolveAll:"Resolve All Comments",txtOnGlobal:"ON for me and everyone",txtOffGlobal:"OFF for me and everyone",txtOn:"ON for me",txtOff:"OFF for me",textWarnTrackChangesTitle:"Enable Track Changes for everyone?",textWarnTrackChanges:"Track Changes will be switched ON for all users with full access. The next time anyone opens the doc, Track Changes will remain enabled.",textEnable:"Enable",txtMarkupSimpleCap:"Simple Markup",txtMarkupSimple:"All changes {0}<br>Turn off balloons",txtEditing:"Editing",txtPreview:"Preview"}}(),Common.Views.ReviewChanges||{})),Common.Views.ReviewChangesDialog=Common.UI.Window.extend(_.extend({options:{width:330,height:90,title:"Review Changes",modal:!1,cls:"review-changes modal-dlg",alias:"Common.Views.ReviewChangesDialog"},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div class="input-row">','<div id="id-review-button-prev" style=""></div>','<div id="id-review-button-next" style=""></div>','<div id="id-review-button-accept" style=""></div>','<div id="id-review-button-reject" style="margin-right: 0;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.popoverChanges=this.options.popoverChanges,this.mode=this.options.mode;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.btnPrev=new Common.UI.Button({cls:"dlg-btn iconic",iconCls:"img-commonctrl prev",hint:this.txtPrev,hintAnchor:"top"}),this.btnPrev.render(this.$window.find("#id-review-button-prev")),this.btnNext=new Common.UI.Button({cls:" dlg-btn iconic",iconCls:"img-commonctrl next",hint:this.txtNext,hintAnchor:"top"}),this.btnNext.render(this.$window.find("#id-review-button-next")),this.btnAccept=new Common.UI.Button({cls:"btn-toolbar",caption:this.txtAccept,split:!0,disabled:this.mode.isReviewOnly||!!Common.Utils.InternalSettings.get(this.appPrefix+"accept-reject-lock"),menu:!this.mode.canUseReviewPermissions&&new Common.UI.Menu({items:[this.mnuAcceptCurrent=new Common.UI.MenuItem({caption:this.txtAcceptCurrent,value:"current"}),this.mnuAcceptAll=new Common.UI.MenuItem({caption:this.txtAcceptAll,value:"all"})]})}),this.btnAccept.render(this.$window.find("#id-review-button-accept")),this.btnReject=new Common.UI.Button({cls:"btn-toolbar",caption:this.txtReject,split:!0,disabled:this.mode.isReviewOnly||!!Common.Utils.InternalSettings.get(this.appPrefix+"accept-reject-lock"),menu:!this.mode.canUseReviewPermissions&&new Common.UI.Menu({items:[this.mnuRejectCurrent=new Common.UI.MenuItem({caption:this.txtRejectCurrent,value:"current"}),this.mnuRejectAll=new Common.UI.MenuItem({caption:this.txtRejectAll,value:"all"})]})}),this.btnReject.render(this.$window.find("#id-review-button-reject"));var t=this;return this.btnPrev.on("click",(function(e){t.fireEvent("reviewchange:preview",[t.btnPrev,"prev"])})),this.btnNext.on("click",(function(e){t.fireEvent("reviewchange:preview",[t.btnNext,"next"])})),this.btnAccept.on("click",(function(e){t.fireEvent("reviewchange:accept",[t.btnAccept,"current"])})),this.btnAccept.menu&&this.btnAccept.menu.on("item:click",(function(e,i,n){t.fireEvent("reviewchange:accept",[e,i])})),this.btnReject.on("click",(function(e){t.fireEvent("reviewchange:reject",[t.btnReject,"current"])})),this.btnReject.menu&&this.btnReject.menu.on("item:click",(function(e,i,n){t.fireEvent("reviewchange:reject",[e,i])})),this},textTitle:"Review Changes",txtPrev:"To previous change",txtNext:"To next change",txtAccept:"Accept",txtAcceptCurrent:"Accept Current Change",txtAcceptAll:"Accept All Changes",txtReject:"Reject",txtRejectCurrent:"Reject Current Change",txtRejectAll:"Reject All Changes"},Common.Views.ReviewChangesDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/view/LanguageDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.LanguageDialog=Common.UI.Window.extend(_.extend({options:{header:!1,width:350,cls:"modal-dlg",buttons:["ok","cancel"]},template:'<div class="box"><div class="input-row"><label><%= label %></label></div><div class="input-row" id="id-document-language"></div></div>',initialize:function(t){_.extend(this.options,t||{},{label:this.labelSelect}),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.cmbLanguage=new Common.UI.ComboBox({el:t.find("#id-document-language"),cls:"input-group-nr",menuStyle:"min-width: 318px; max-height: 285px;",editable:!1,template:_.template(['<span class="input-group combobox <%= cls %> combo-langs" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control">','<span class="icon input-icon spellcheck-lang toolbar__icon btn-ic-docspell"></span>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret" />',"</button>",'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>">','<a tabindex="-1" type="menuitem" style="padding-left: 28px !important;" langval="<%= item.value %>">','<i class="icon <% if (item.spellcheck) { %> toolbar__icon btn-ic-docspell spellcheck-lang <% } %>"></i>',"<%= scope.getDisplayValue(item) %>","</a>","</li>","<% }); %>","</ul>","</span>"].join("")),data:this.options.languages,takeFocusOnClose:!0,search:!0,scrollAlwaysVisible:!0}),this.cmbLanguage.scroller&&this.cmbLanguage.scroller.update({alwaysVisibleY:!0}),this.cmbLanguage.on("selected",_.bind(this.onLangSelect,this));var e=Common.util.LanguageInfo.getLocalLanguageName(this.options.current);this.cmbLanguage.setValue(e[0],e[1]),this.onLangSelect(this.cmbLanguage,this.cmbLanguage.getSelectedRecord());var i=this;setTimeout((function(){i.cmbLanguage.focus()}),100)},close:function(t){var e=this.getChild();e.find(".combobox.open").length||Common.UI.Window.prototype.close.call(this,arguments)},onBtnClick:function(t){this.options.handler&&this.options.handler.call(this,t.currentTarget.attributes.result.value,this.cmbLanguage.getValue()),this.close()},onLangSelect:function(t,e,i){t.$el.find(".input-icon").toggleClass("spellcheck-lang",e&&e.spellcheck),t._input.css("padding-left",e&&e.spellcheck?25:3)},onPrimary:function(){return this.options.handler&&this.options.handler.call(this,"ok",this.cmbLanguage.getValue()),this.close(),!1},labelSelect:"Select document language"},Common.Views.LanguageDialog||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ReviewChanges",["core","common/main/lib/model/ReviewChange","common/main/lib/collection/ReviewChanges","common/main/lib/view/ReviewChanges","common/main/lib/view/ReviewPopover","common/main/lib/view/LanguageDialog","common/main/lib/view/OptionsDialog"],(function(){"use strict";Common.Controllers.ReviewChanges=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.ReviewChanges"],views:["Common.Views.ReviewChanges","Common.Views.ReviewPopover"],sdkViewName:"#id_main",initialize:function(){this.addListeners({FileMenu:{"settings:apply":this.applySettings.bind(this)},LeftMenu:{"comments:show":_.bind(this.commentsShowHide,this,"show"),"comments:hide":_.bind(this.commentsShowHide,this,"hide")},"Common.Views.ReviewChanges":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:delete":_.bind(this.onDeleteClick,this),"reviewchange:preview":_.bind(this.onBtnPreviewClick,this),"reviewchange:view":_.bind(this.onReviewViewClick,this),"reviewchange:compare":_.bind(this.onCompareClick,this),"lang:document":_.bind(this.onDocLanguage,this),"collaboration:coauthmode":_.bind(this.onCoAuthMode,this)},"Common.Views.ReviewChangesDialog":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:preview":_.bind(this.onBtnPreviewClick,this)},"Common.Views.ReviewPopover":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:delete":_.bind(this.onDeleteClick,this),"reviewchange:goto":_.bind(this.onGotoClick,this)}})},onLaunch:function(){this.collection=this.getApplication().getCollection("Common.Collections.ReviewChanges"),this.userCollection=this.getApplication().getCollection("Common.Collections.Users"),this.viewmode=!1,this._state={posx:-1e3,posy:-1e3,popoverVisible:!1,previewMode:!1,compareSettings:null,wsLock:!1,wsProps:[]},Common.NotificationCenter.on("reviewchanges:turn",this.onTurnPreview.bind(this)),Common.NotificationCenter.on("spelling:turn",this.onTurnSpelling.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("collaboration:sharing",this.changeAccessRights.bind(this)),Common.NotificationCenter.on("collaboration:sharingdeny",this.onLostEditRights.bind(this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this)),this.userCollection.on("reset",_.bind(this.onUpdateUsers,this)),this.userCollection.on("add",_.bind(this.onUpdateUsers,this))},setConfig:function(t,e){return this.setApi(e),t&&(this.currentUserId=t.config.user.id,this.sdkViewName=t.sdkviewname||this.sdkViewName),this},setApi:function(t){t&&(this.api=t,(this.appConfig.canReview||this.appConfig.canViewReview)&&(this.api.asc_registerCallback("asc_onShowRevisionsChange",_.bind(this.onApiShowChange,this)),this.api.asc_registerCallback("asc_onUpdateRevisionsChangesPosition",_.bind(this.onApiUpdateChangePosition,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onChangeDisplayModeInReview",_.bind(this.onChangeDisplayModeInReview,this))),this.appConfig.canReview&&this.api.asc_registerCallback("asc_onOnTrackRevisionsChange",_.bind(this.onApiTrackRevisionsChange,this)),this.api.asc_registerCallback("asc_onAcceptChangesBeforeCompare",_.bind(this.onAcceptChangesBeforeCompare,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.Gateway.on("setrevisedfile",_.bind(this.setRevisedFile,this)))},setMode:function(t){return this.appConfig=t,this.popoverChanges=new Common.Collections.ReviewChanges,this.view=this.createView("Common.Views.ReviewChanges",{mode:t}),(this.appConfig.sharingSettingsUrl&&this.appConfig.sharingSettingsUrl.length||this.appConfig.canRequestSharingSettings)&&(Common.Gateway.on("showsharingsettings",_.bind(this.changeAccessRights,this)),Common.Gateway.on("setsharingsettings",_.bind(this.setSharingSettings,this))),this},loadDocument:function(t){this.document=t.doc},SetDisabled:function(t,e,i){this.dlgChanges&&this.dlgChanges.close(),e?this.lockToolbar(Common.enumLock.previewReviewMode,t):i?this.lockToolbar(Common.enumLock.viewFormMode,t):this.lockToolbar(Common.enumLock.viewMode,t),this.setPreviewMode(t)},lockToolbar:function(t,e,i){Common.Utils.lockControls(t,e,i,this.view.getButtons())},setPreviewMode:function(t){if(this.viewmode!==t){this.viewmode=t,t&&(this.prevcanReview=this.appConfig.canReview),this.appConfig.canReview=!t&&this.prevcanReview;var e=this;this.popoverChanges&&this.popoverChanges.each((function(t){t.set("hint",!e.appConfig.canReview)}))}},isSelectedChangesLocked:function(t,e){if(!t||t.length<1)return!0;if(e)return t[0].get("lock")||!t[0].get("editable");for(var i=0;i<t.length;i++){var n=t[i];if(n.get("lock")||!n.get("editable"))return!0}return!1},onApiShowChange:function(t,e){var i,n=!0;if(this.appConfig.canReview&&!this.appConfig.isReviewOnly&&(t&&t.length>0&&(i=this.readSDKChange(t),n=this.isSelectedChangesLocked(i,e)),this._state.lock!==n&&(Common.Utils.lockControls(Common.enumLock.reviewChangelock,n,{array:[this.view.btnAccept,this.view.btnReject]}),this.dlgChanges&&(this.dlgChanges.btnAccept.setDisabled(n),this.dlgChanges.btnReject.setDisabled(n)),this._state.lock=n,Common.Utils.InternalSettings.set(this.view.appPrefix+"accept-reject-lock",n))),this.getPopover())if(!this.appConfig.reviewHoverMode&&t&&t.length>0&&e){var o=t[0].get_X(),s=t[0].get_Y(),a=Math.abs(this._state.posx-o)>.001||Math.abs(this._state.posy-s)>.001||t.length!==this._state.changes_length,l=null!==t[0].get_LockUserId(),r=this.getUserName(t[0].get_LockUserId());this.getPopover().hideTips(),this.popoverChanges.reset(i||this.readSDKChange(t)),a&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(o,s)),this.getPopover().showReview(a,l,r),this._state.posx=o,this._state.posy=s,this._state.changes_length=t.length,this._state.popoverVisible=!0}else this._state.popoverVisible&&(this._state.posx=this._state.posy=-1e3,this._state.changes_length=0,this._state.popoverVisible=!1,this.getPopover().hideTips(),this.popoverChanges.reset(),this.getPopover().hideReview())},onApiUpdateChangePosition:function(t,e){this.getPopover()&&(e<0||this.getPopover().sdkBounds.height<e?this.getPopover().hide():this.popoverChanges.length>0&&(this.getPopover().isVisible()||this.getPopover().show(!1),this.getPopover().setLeftTop(t,e)))},findChange:function(t,e){return _.isUndefined(t)?this.collection.findWhere({id:e}):this.collection.findWhere({uid:t})},getPopover:function(){return(this.appConfig.canReview||this.appConfig.canViewReview)&&_.isUndefined(this.popover)&&(this.popover=Common.Views.ReviewPopover.prototype.getPopover({reviewStore:this.popoverChanges,renderTo:this.sdkViewName,canRequestUsers:this.appConfig?this.appConfig.canRequestUsers:void 0,canRequestSendNotify:this.appConfig?this.appConfig.canRequestSendNotify:void 0,mentionShare:!this.appConfig||this.appConfig.mentionShare,api:this.api}),this.popover.setReviewStore(this.popoverChanges)),this.popover},readSDKChange:function(t){var e=this,i=[];return _.each(t,(function(t){var n="",o="",s=t.get_Value(),a=t.get_MoveType();switch(t.get_Type()){case Asc.c_oAscRevisionsChangeType.TextAdd:n=a==Asc.c_oAscRevisionsMove.NoMove?e.textInserted:e.textParaMoveTo,"object"==typeof s?_.each(s,(function(t){if("string"==typeof t)n+=" "+Common.Utils.String.htmlEncode(t);else switch(t){case 0:n+=" &lt;"+e.textImage+"&gt;";break;case 1:n+=" &lt;"+e.textShape+"&gt;";break;case 2:n+=" &lt;"+e.textChart+"&gt;";break;case 3:n+=" &lt;"+e.textEquation+"&gt;"}})):"string"==typeof s&&(n+=" "+Common.Utils.String.htmlEncode(s));break;case Asc.c_oAscRevisionsChangeType.TextRem:n=a==Asc.c_oAscRevisionsMove.NoMove?e.textDeleted:t.is_MovedDown()?e.textParaMoveFromDown:e.textParaMoveFromUp,"object"==typeof s?_.each(s,(function(t){if("string"==typeof t)n+=" "+Common.Utils.String.htmlEncode(t);else switch(t){case 0:n+=" &lt;"+e.textImage+"&gt;";break;case 1:n+=" &lt;"+e.textShape+"&gt;";break;case 2:n+=" &lt;"+e.textChart+"&gt;";break;case 3:n+=" &lt;"+e.textEquation+"&gt;"}})):"string"==typeof s&&(n+=" "+Common.Utils.String.htmlEncode(s));break;case Asc.c_oAscRevisionsChangeType.ParaAdd:n=e.textParaInserted;break;case Asc.c_oAscRevisionsChangeType.ParaRem:n=e.textParaDeleted;break;case Asc.c_oAscRevisionsChangeType.TextPr:n="<b>"+e.textFormatted,void 0!==s.Get_Bold()&&(o+=(s.Get_Bold()?"":e.textNot)+e.textBold+", "),void 0!==s.Get_Italic()&&(o+=(s.Get_Italic()?"":e.textNot)+e.textItalic+", "),void 0!==s.Get_Underline()&&(o+=(s.Get_Underline()?"":e.textNot)+e.textUnderline+", "),void 0!==s.Get_Strikeout()&&(o+=(s.Get_Strikeout()?"":e.textNot)+e.textStrikeout+", "),void 0!==s.Get_DStrikeout()&&(o+=(s.Get_DStrikeout()?"":e.textNot)+e.textDStrikeout+", "),void 0!==s.Get_Caps()&&(o+=(s.Get_Caps()?"":e.textNot)+e.textCaps+", "),void 0!==s.Get_SmallCaps()&&(o+=(s.Get_SmallCaps()?"":e.textNot)+e.textSmallCaps+", "),void 0!==s.Get_VertAlign()&&(o+=(1==s.Get_VertAlign()?e.textSuperScript:2==s.Get_VertAlign()?e.textSubScript:e.textBaseline)+", "),void 0!==s.Get_Color()&&(o+=e.textColor+", "),void 0!==s.Get_Highlight()&&(o+=e.textHighlight+", "),void 0!==s.Get_Shd()&&(o+=e.textShd+", "),void 0!==s.Get_FontFamily()&&(o+=s.Get_FontFamily()+", "),void 0!==s.Get_FontSize()&&(o+=s.Get_FontSize()+", "),void 0!==s.Get_Spacing()&&(o+=e.textSpacing+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_Spacing()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_Position()&&(o+=e.textPosition+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_Position()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_Lang()&&(o+=Common.util.LanguageInfo.getLocalLanguageName(s.Get_Lang())[1]+", "),_.isEmpty(o)||(n+=": ",o=o.substring(0,o.length-2)),n+="</b>",n+=o;break;case Asc.c_oAscRevisionsChangeType.ParaPr:if(n="<b>"+e.textParaFormatted,s.Get_ContextualSpacing()&&(o+=(s.Get_ContextualSpacing()?e.textContextual:e.textNoContextual)+", "),void 0!==s.Get_IndLeft()&&(o+=e.textIndentLeft+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_IndLeft()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_IndRight()&&(o+=e.textIndentRight+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_IndRight()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_IndFirstLine()&&(o+=e.textFirstLine+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_IndFirstLine()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),void 0!==s.Get_Jc())switch(s.Get_Jc()){case 0:o+=e.textRight+", ";break;case 1:o+=e.textLeft+", ";break;case 2:o+=e.textCenter+", ";break;case 3:o+=e.textJustify+", "}if(void 0!==s.Get_KeepLines()&&(o+=(s.Get_KeepLines()?e.textKeepLines:e.textNoKeepLines)+", "),s.Get_KeepNext()&&(o+=(s.Get_KeepNext()?e.textKeepNext:e.textNoKeepNext)+", "),s.Get_PageBreakBefore()&&(o+=(s.Get_PageBreakBefore()?e.textBreakBefore:e.textNoBreakBefore)+", "),void 0!==s.Get_SpacingLineRule()&&void 0!==s.Get_SpacingLine()&&(o+=e.textLineSpacing,o+=(s.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_LEAST?e.textAtLeast:s.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_AUTO?e.textMultiple:e.textExact)+" ",o+=(s.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_AUTO?s.Get_SpacingLine():Common.Utils.Metric.fnRecalcFromMM(s.Get_SpacingLine()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName())+", "),s.Get_SpacingBeforeAutoSpacing()?o+=e.textSpacingBefore+" "+e.textAuto+", ":void 0!==s.Get_SpacingBefore()&&(o+=e.textSpacingBefore+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_SpacingBefore()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),s.Get_SpacingAfterAutoSpacing()?o+=e.textSpacingAfter+" "+e.textAuto+", ":void 0!==s.Get_SpacingAfter()&&(o+=e.textSpacingAfter+" "+Common.Utils.Metric.fnRecalcFromMM(s.Get_SpacingAfter()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+", "),s.Get_WidowControl()&&(o+=(s.Get_WidowControl()?e.textWidow:e.textNoWidow)+", "),void 0!==s.Get_Tabs()&&(o+=e.textTabs+", "),void 0!==s.Get_NumPr()&&(o+=e.textNum+", "),void 0!==s.Get_PStyle()){var l=e.api.asc_GetStyleNameById(s.Get_PStyle());_.isEmpty(l)||(o+=l+", ")}_.isEmpty(o)||(n+=": ",o=o.substring(0,o.length-2)),n+="</b>",n+=o;break;case Asc.c_oAscRevisionsChangeType.TablePr:n=e.textTableChanged;break;case Asc.c_oAscRevisionsChangeType.RowsAdd:n=e.textTableRowsAdd;break;case Asc.c_oAscRevisionsChangeType.RowsRem:n=e.textTableRowsDel}var r=""==t.get_DateTime()?new Date:new Date(t.get_DateTime()),c=e.userCollection.findOriginalUser(t.get_UserId()),d=new Common.Models.ReviewChange({uid:Common.UI.getId(),userid:t.get_UserId(),username:t.get_UserName(),usercolor:c?c.get("color"):null,date:e.dateToLocaleTimeString(r),changetext:n,id:Common.UI.getId(),lock:null!==t.get_LockUserId(),lockuser:e.getUserName(t.get_LockUserId()),type:t.get_Type(),changedata:t,scope:e.view,hint:!e.appConfig.canReview,goto:t.get_MoveType()==Asc.c_oAscRevisionsMove.MoveTo||t.get_MoveType()==Asc.c_oAscRevisionsMove.MoveFrom,editable:e.appConfig.isReviewOnly&&t.get_UserId()==e.currentUserId||!e.appConfig.isReviewOnly&&(!e.appConfig.canUseReviewPermissions||AscCommon.UserInfoParser.canEditReview(t.get_UserName()))});i.push(d)})),i},getUserName:function(t){if(this.userCollection&&null!==t){var e=this.userCollection.findUser(t);if(e)return AscCommon.UserInfoParser.getParsedName(e.get("username"))}return""},dateToLocaleTimeString:function(t){return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+" "+function(t){var e=t.getHours(),i=t.getMinutes(),n=e>=12?"pm":"am";return(e=(e%=12)||12)+":"+(i=i<10?"0"+i:i)+" "+n}(t)},onBtnPreviewClick:function(t,e){switch(e){case"prev":this.api.asc_GetPrevRevisionsChange();break;case"next":this.api.asc_GetNextRevisionsChange()}Common.NotificationCenter.trigger("edit:complete",this.view)},onAcceptClick:function(t,e,i){this.api&&(e?"all"===e.value?this.api.asc_AcceptAllChanges():this.api.asc_AcceptChangesBySelection(!0):this.api.asc_AcceptChanges(t)),Common.NotificationCenter.trigger("edit:complete",this.view)},onRejectClick:function(t,e,i){this.api&&(e?"all"===e.value?this.api.asc_RejectAllChanges():this.api.asc_RejectChangesBySelection(!0):this.api.asc_RejectChanges(t)),Common.NotificationCenter.trigger("edit:complete",this.view)},onDeleteClick:function(t){this.api&&this.api.asc_RejectChanges(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onGotoClick:function(t){this.api&&this.api.asc_FollowRevisionMove(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onTurnPreview:function(t,e,i){this.appConfig.isReviewOnly?this.view.turnChanges(!0):this.appConfig.canReview&&(t="off"!=t&&t,e?(this.api.asc_SetLocalTrackRevisions(null),this.api.asc_SetGlobalTrackRevisions(!!t)):this.api.asc_SetLocalTrackRevisions(!!t))},onApiTrackRevisionsChange:function(t,e,i){if(this.appConfig.isReviewOnly)this.view.turnChanges(!0);else if(this.appConfig.canReview){var n=null===t,o=n?e:t;if(Common.Utils.InternalSettings.set(this.view.appPrefix+"track-changes",(o?0:1)+(n?2:0)),this.view.turnChanges(o,n),i&&this.userCollection){var s=this.userCollection.findOriginalUser(i);s&&Common.NotificationCenter.trigger("showmessage",{msg:Common.Utils.String.format(e?this.textOnGlobal:this.textOffGlobal,AscCommon.UserInfoParser.getParsedName(s.get("username")))},{timeout:5e3,hideCloseTip:!0})}}},onTurnSpelling:function(t,e){t="on"==t,this.view&&this.view.turnSpelling(t),Common.UI.FeaturesManager.canChange("spellcheck")&&!e&&(Common.localStorage.setItem(this.view.appPrefix+"settings-spellcheck",t?1:0),this.api.asc_setSpellCheck(t),Common.Utils.InternalSettings.set(this.view.appPrefix+"settings-spellcheck",t))},onReviewViewClick:function(t,e,i){this.turnDisplayMode(e.value),this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"markup"!=e.value&&"simple"!=e.value||Common.localStorage.setItem(this.view.appPrefix+"review-mode-editor",e.value):Common.localStorage.setItem(this.view.appPrefix+"review-mode",e.value),Common.NotificationCenter.trigger("edit:complete",this.view)},onCompareClick:function(t){if(this.api){var e=this;if(this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),"file"===t)this.api&&this.api.asc_CompareDocumentFile(this._state.compareSettings),Common.NotificationCenter.trigger("edit:complete",this.view);else if("url"===t)new Common.Views.ImageFromUrlDialog({title:e.textUrl,handler:function(t,i){if("ok"==t){if(e.api){var n=i.replace(/ /g,"");_.isEmpty(n)||e.api.asc_CompareDocumentUrl(n,e._state.compareSettings)}Common.NotificationCenter.trigger("edit:complete",e.view)}}}).show();else if("storage"===t)this.appConfig.canRequestCompareFile?Common.Gateway.requestCompareFile():new Common.Views.SelectFileDlg({fileChoiceUrl:this.appConfig.fileChoiceUrl.replace("{fileExt}","").replace("{documentType}","DocumentsOnly")}).on("selectfile",(function(t,i){e.setRevisedFile(i,e._state.compareSettings)})).show();else if("settings"===t){var i=!e._state.compareSettings||e._state.compareSettings.getWords();new Common.Views.OptionsDialog({title:e.textTitleComparison,items:[{caption:e.textChar,value:!1,checked:!1===i},{caption:e.textWord,value:!0,checked:!1!==i}],label:e.textShow,handler:function(t,i){"ok"==i&&(e._state.compareSettings=new AscCommonWord.ComparisonOptions,e._state.compareSettings.putWords(t.getSettings())),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show()}}Common.NotificationCenter.trigger("edit:complete",this.view)},setRevisedFile:function(t){this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),t&&t.url&&this.api.asc_CompareDocumentUrl(t.url,this._state.compareSettings,t.token)},onAcceptChangesBeforeCompare:function(t){Common.UI.warning({width:550,msg:this.textAcceptBeforeCompare,buttons:["yes","no"],primary:"yes",callback:function(e){_.defer((function(){t&&t("yes"==e)})),Common.NotificationCenter.trigger("edit:complete",this.view)}})},turnDisplayMode:function(t){if(this.api){var e=Asc.c_oAscDisplayModeInReview.Edit;switch(t){case"final":e=Asc.c_oAscDisplayModeInReview.Final;break;case"original":e=Asc.c_oAscDisplayModeInReview.Original;break;case"simple":e=Asc.c_oAscDisplayModeInReview.Simple}this.api.asc_SetDisplayModeInReview(e)}this.disableEditing("final"==t||"original"==t),this._state.previewMode="final"==t||"original"==t},onChangeDisplayModeInReview:function(t){this.disableEditing(t===Asc.c_oAscDisplayModeInReview.Final||t===Asc.c_oAscDisplayModeInReview.Original);var e="markup";switch(t){case Asc.c_oAscDisplayModeInReview.Final:e="final";break;case Asc.c_oAscDisplayModeInReview.Original:e="original";break;case Asc.c_oAscDisplayModeInReview.Simple:e="simple"}this.view&&this.view.turnDisplayMode(e),this._state.previewMode=t===Asc.c_oAscDisplayModeInReview.Final||t===Asc.c_oAscDisplayModeInReview.Original},isPreviewChangesMode:function(){return this._state.previewMode},onCoAuthMode:function(t,e,i){if(Common.localStorage.setItem(this.view.appPrefix+"settings-coauthmode",e.value),Common.Utils.InternalSettings.set(this.view.appPrefix+"settings-coauthmode",e.value),this.api){if(this.api.asc_SetFastCollaborative(1==e.value),this.api.SetCollaborativeMarksShowType){var n=Common.localStorage.getItem(e.value?this.view.appPrefix+"settings-showchanges-fast":this.view.appPrefix+"settings-showchanges-strict");null!==n?this.api.SetCollaborativeMarksShowType("all"==n?Asc.c_oAscCollaborativeMarksShowType.All:"none"==n?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges):this.api.SetCollaborativeMarksShowType(e.value?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges)}null===(n=Common.localStorage.getItem(this.view.appPrefix+"settings-autosave"))&&this.appConfig.customization&&!1===this.appConfig.customization.autosave&&(n=0),n=e.value||null===n?1:parseInt(n),Common.localStorage.setItem(this.view.appPrefix+"settings-autosave",n),Common.Utils.InternalSettings.set(this.view.appPrefix+"settings-autosave",n),this.api.asc_setAutoSaveGap(n)}Common.NotificationCenter.trigger("edit:complete",this.view),this.view.fireEvent("settings:apply",[this])},disableEditing:function(t){Common.NotificationCenter.trigger("editing:disable",t,{viewMode:!1,reviewMode:!0,fillFormMode:!1,allowMerge:!1,allowSignature:!1,allowProtect:!1,rightMenu:{clear:t,disable:!0},statusBar:!0,leftMenu:{disable:!1,previewMode:!0},fileMenu:{protect:!0},navigation:{disable:!1,previewMode:!0},comments:{disable:!1,previewMode:!0},chat:!1,review:!0,viewport:!1,documentHolder:!0,toolbar:!0,plugins:!0,protect:!0},"review")},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){var e=this;if(t.canReview)new Promise((function(t){t()})).then((function(){var i=e.appConfig.customization&&e.appConfig.customization.review?e.appConfig.customization.review.trackChanges:void 0;void 0===i&&(i=e.appConfig.customization?e.appConfig.customization.trackChanges:void 0),t.isReviewOnly||void 0!==i?e.api.asc_SetLocalTrackRevisions(t.isReviewOnly||!0===i):e.onApiTrackRevisionsChange(e.api.asc_GetLocalTrackRevisions(),e.api.asc_GetGlobalTrackRevisions()),e.api.asc_HaveRevisionsChanges()&&e.view.markChanges(!0);var n=Common.localStorage.getItem(e.view.appPrefix+"review-mode-editor");if(null===n&&(!(n=e.appConfig.customization&&e.appConfig.customization.review?e.appConfig.customization.review.reviewDisplay:void 0)&&(n=e.appConfig.customization?e.appConfig.customization.reviewDisplay:void 0),n=/^(original|final|markup|simple)$/i.test(n)?n.toLocaleLowerCase():"markup"),e.turnDisplayMode(n),e.view.turnDisplayMode(n),"object"==typeof e.appConfig.customization&&(e.appConfig.customization.review&&1==e.appConfig.customization.review.showReviewChanges||(!e.appConfig.customization.review||void 0===e.appConfig.customization.review.showReviewChanges)&&1==e.appConfig.customization.showReviewChanges)){e.dlgChanges=new Common.Views.ReviewChangesDialog({popoverChanges:e.popoverChanges,mode:e.appConfig});var o=$("#editor_sdk"),s=o.offset();e.dlgChanges.show(Math.max(10,s.left+o.width()-300),Math.max(10,s.top+o.height()-150))}}));else if(t.canViewReview){var i;if(t.canViewReview=t.isEdit||e.api.asc_HaveRevisionsChanges(!0),t.canViewReview)null===(i=Common.localStorage.getItem(e.view.appPrefix+(t.isEdit||t.isRestrictedEdit?"review-mode-editor":"review-mode")))&&(!(i=e.appConfig.customization&&e.appConfig.customization.review?e.appConfig.customization.review.reviewDisplay:void 0)&&(i=e.appConfig.customization?e.appConfig.customization.reviewDisplay:void 0),i=/^(original|final|markup|simple)$/i.test(i)?i.toLocaleLowerCase():t.isEdit||t.isRestrictedEdit?"markup":"original"),e.turnDisplayMode(i),e.view.turnDisplayMode(i)}e.view&&e.view.btnChat&&e.getApplication().getController("LeftMenu").leftMenu.btnChat.on("toggle",(function(t,i){i!==e.view.btnChat.pressed&&e.view.turnChat(i)})),e.onChangeProtectSheet(),e.view&&(e.lockToolbar(Common.enumLock.hideComments,!Common.localStorage.getBool(e.view.appPrefix+"settings-livecomment",!0),{array:[e.view.btnCommentRemove,e.view.btnCommentResolve]}),e.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects,{array:[e.view.btnCommentRemove,e.view.btnCommentResolve]})),i=null===(i=Common.localStorage.getItem(e.view.appPrefix+"settings-review-hover-mode"))?!(!e.appConfig.customization||!e.appConfig.customization.review)&&!!e.appConfig.customization.review.hoverMode:!!parseInt(i),Common.Utils.InternalSettings.set(e.view.appPrefix+"settings-review-hover-mode",i),e.appConfig.reviewHoverMode=i},applySettings:function(t){this.view&&this.view.turnSpelling(Common.localStorage.getBool(this.view.appPrefix+"settings-spellcheck",!0)),this.view&&this.view.turnCoAuthMode(Common.localStorage.getBool(this.view.appPrefix+"settings-coauthmode",!0)),(this.appConfig.canReview||this.appConfig.canViewReview)&&this.appConfig.reviewHoverMode&&this.onApiShowChange()},synchronizeChanges:function(){this.appConfig&&this.appConfig.canReview&&this.view.markChanges(this.api.asc_HaveRevisionsChanges())},setLanguages:function(t){this.langs=t,this.lockToolbar(Common.enumLock.noSpellcheckLangs,this.langs.length<1,{array:this.view.btnsDocLang})},onDocLanguage:function(){var t=this;new Common.Views.LanguageDialog({languages:t.langs,current:t.api.asc_getDefaultLanguage(),handler:function(e,i){if("ok"==e){var n=_.findWhere(t.langs,{value:i});n&&t.api.asc_setDefaultLanguage(n.code)}}}).show()},onLostEditRights:function(){this._readonlyRights=!0,this.view&&this.view.onLostEditRights(),this.view&&this.lockToolbar(Common.enumLock.cantShare,!0,{array:[this.view.btnSharing]})},changeAccessRights:function(t,e,i){if(!this._docAccessDlg&&!this._readonlyRights)if(this.appConfig.canRequestSharingSettings)Common.Gateway.requestSharingSettings();else{var n=this;n._docAccessDlg=new Common.Views.DocumentAccessDialog({settingsurl:this.appConfig.sharingSettingsUrl}),n._docAccessDlg.on("accessrights",(function(t,e){n.setSharingSettings({sharingSettings:e})})).on("close",(function(t){n._docAccessDlg=void 0})),n._docAccessDlg.show()}},setSharingSettings:function(t){t&&(this.document.info.sharingSettings=t.sharingSettings,Common.NotificationCenter.trigger("collaboration:sharingupdate",t.sharingSettings),Common.NotificationCenter.trigger("mentions:clearusers",this))},onCoAuthoringDisconnect:function(){this.lockToolbar(Common.enumLock.lostConnect,!0)},onUpdateUsers:function(){var t=this.userCollection;this.popoverChanges&&this.popoverChanges.each((function(e){var i=t.findOriginalUser(e.get("userid"));e.set("usercolor",i?i.get("color"):null)}))},onAuthParticipantsChanged:function(t){if(this.view&&this.view.btnCompare){var e=0;_.each(t,(function(t){t.asc_getView()||e++})),Common.Utils.lockControls(Common.enumLock.hasCoeditingUsers,e>1,{array:[this.view.btnCompare]})}},commentsShowHide:function(t){if(this.view){var e=Common.Utils.InternalSettings.get(this.view.appPrefix+"settings-livecomment");void 0!==e&&this.lockToolbar(Common.enumLock.hideComments,"show"!=t&&!e,{array:[this.view.btnCommentRemove,this.view.btnCommentResolve]})}},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}this._state.wsProps=t?t.wsProps:[],this._state.wsLock=!!t&&t.wsLock,this.view&&this.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects,{array:[this.view.btnCommentRemove,this.view.btnCommentResolve]})},textInserted:"<b>Inserted:</b>",textDeleted:"<b>Deleted:</b>",textParaInserted:"<b>Paragraph Inserted</b> ",textParaDeleted:"<b>Paragraph Deleted</b> ",textFormatted:"Formatted",textParaFormatted:"Paragraph Formatted",textNot:"Not ",textBold:"Bold",textItalic:"Italic",textStrikeout:"Strikeout",textUnderline:"Underline",textColor:"Font color",textBaseline:"Baseline",textSuperScript:"Superscript",textSubScript:"Subscript",textHighlight:"Highlight color",textSpacing:"Spacing",textDStrikeout:"Double strikeout",textCaps:"All caps",textSmallCaps:"Small caps",textPosition:"Position",textFontSize:"Font size",textShd:"Background color",textContextual:"Don't add interval between paragraphs of the same style",textNoContextual:"Add interval between paragraphs of the same style",textIndentLeft:"Indent left",textIndentRight:"Indent right",textFirstLine:"First line",textRight:"Align right",textLeft:"Align left",textCenter:"Align center",textJustify:"Align justify",textBreakBefore:"Page break before",textKeepNext:"Keep with next",textKeepLines:"Keep lines together",textNoBreakBefore:"No page break before",textNoKeepNext:"Don't keep with next",textNoKeepLines:"Don't keep lines together",textLineSpacing:"Line Spacing: ",textMultiple:"multiple",textAtLeast:"at least",textExact:"exactly",textSpacingBefore:"Spacing before",textSpacingAfter:"Spacing after",textAuto:"auto",textWidow:"Widow control",textNoWidow:"No widow control",textTabs:"Change tabs",textNum:"Change numbering",textEquation:"Equation",textImage:"Image",textChart:"Chart",textShape:"Shape",textTableChanged:"<b>Table Settings Changed</b>",textTableRowsAdd:"<b>Table Rows Added</b>",textTableRowsDel:"<b>Table Rows Deleted</b>",textParaMoveTo:"<b>Moved:</b>",textParaMoveFromUp:"<b>Moved Up:</b>",textParaMoveFromDown:"<b>Moved Down:</b>",textUrl:"Paste a document URL",textAcceptBeforeCompare:"In order to compare documents all the tracked changes in them will be considered to have been accepted. Do you want to continue?",textTitleComparison:"Comparison Settings",textShow:"Show changes at",textChar:"Character level",textWord:"Word level",textOnGlobal:"{0} enabled Track Changes for everyone.",textOffGlobal:"{0} disabled Track Changes for everyone.",textOn:"{0} is now using Track Changes.",textOff:"{0} is no longer using Track Changes."},Common.Controllers.ReviewChanges||{}))})),define("common/main/lib/view/PasswordDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.PasswordDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e=this,i={};_.extend(i,{width:395,height:270,header:!0,cls:"modal-dlg",contentTemplate:"",title:e.txtTitle,buttons:["ok","cancel"]},t),this.handler=t.handler,this.template=t.template||['<div class="box">','<div class="input-row" style="margin-bottom: 10px;">',"<label>"+e.txtDescription+"</label>","</div>",'<div class="input-row">',"<label>"+e.txtPassword+(e.passwordOptional?" ("+e.txtOptional+")":"")+"</label>","</div>",'<div id="id-password-txt" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+e.txtRepeat+"</label>","</div>",'<div id="id-repeat-txt" class="input-row" style="margin-bottom: 10px;"></div>',"<label>"+e.txtWarning+"</label>","</div>"].join(""),i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){if(Common.UI.Window.prototype.render.call(this),this.$window){var t=this;this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.repeatPwd=new Common.UI.InputField({el:$("#id-repeat-txt"),type:"password",allowBlank:!1,style:"width: 100%;",maxLength:255,validateOnBlur:!1,validation:function(e){return t.txtIncorrectPwd}}),this.inputPwd=new Common.UI.InputFieldBtnPassword({el:$("#id-password-txt"),type:"password",allowBlank:!1,style:"width: 100%;",maxLength:255,validateOnBlur:!1,repeatInput:this.repeatPwd})}},getFocusedComponents:function(){return[this.inputPwd,this.repeatPwd]},getDefaultFocusableComponent:function(){return this.inputPwd},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.handler){if("ok"==t){if(!0!==this.inputPwd.checkValidate())return void this.inputPwd.focus();if(this.inputPwd.getValue()!==this.repeatPwd.getValue())return this.repeatPwd.checkValidate(),void this.repeatPwd.focus()}this.handler.call(this,t,this.inputPwd.getValue())}this.close()},txtTitle:"Set Password",txtPassword:"Password",txtDescription:"A Password is required to open this document",txtRepeat:"Repeat password",txtIncorrectPwd:"Confirmation password is not identical",txtWarning:"Warning: If you lose or forget the password, it cannot be recovered. Please keep it in a safe place."},Common.Views.PasswordDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/view/SignDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts"],(function(){"use strict";Common.Views.SignDialog=Common.UI.Window.extend(_.extend({options:{width:370,style:"min-width: 350px;",cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.api=this.options.api,this.signType=this.options.signType||"invisible",this.signSize=this.options.signSize||{width:0,height:0},this.certificateId=null,this.signObject=null,this.fontStore=this.options.fontStore,this.font={size:11,name:"Arial",bold:!1,italic:!1};var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",this.template=['<div class="box" style="height: '+("invisible"==this.signType?"132px;":"300px;")+'">','<div id="id-dlg-sign-invisible">','<div class="input-row">',"<label>"+this.textPurpose+"</label>","</div>",'<div id="id-dlg-sign-purpose" class="input-row"></div>',"</div>",'<div id="id-dlg-sign-visible">','<div class="input-row">',"<label>"+this.textInputName+"</label>","</div>",'<div id="id-dlg-sign-name" class="input-row" style="margin-bottom: 5px;"></div>','<div id="id-dlg-sign-fonts" class="input-row" style="display: inline-block;"></div>','<div id="id-dlg-sign-font-size" class="input-row" style="display: inline-block;margin-left: 3px;"></div>','<div id="id-dlg-sign-bold" style="display: inline-block;margin-left: 3px;"></div>','<div id="id-dlg-sign-italic" style="display: inline-block;margin-left: 3px;"></div>','<div style="margin: 10px 0 5px 0;">',"<label>"+this.textUseImage+"</label>","</div>",'<button id="id-dlg-sign-image" class="btn btn-text-default auto">'+this.textSelectImage+"</button>",'<div class="input-row" style="margin-top: 10px;">','<label style="font-weight: bold;">'+this.textSignature+"</label>","</div>",'<div style="border: 1px solid #cbcbcb;"><div id="signature-preview-img" style="width: 100%; height: 50px;position: relative;"></div></div>',"</div>",'<table style="margin-top: 30px;">',"<tr>",'<td><label style="font-weight: bold;margin-bottom: 3px;">'+this.textCertificate+'</label></td><td rowspan="2" style="vertical-align: top; padding-left: 20px;"><button id="id-dlg-sign-change" class="btn btn-text-default" style="float:right;">'+this.textSelect+"</button></td>","</tr>",'<tr><td><div id="id-dlg-sign-certificate" class="hidden" style="max-width: 240px;overflow: hidden;white-space: nowrap;"></td></tr>',"</table>","</div>"].join(""),this.templateCertificate=_.template(['<label style="display: block;margin-bottom: 3px;overflow: hidden;text-overflow: ellipsis;"><%= Common.Utils.String.htmlEncode(name) %></label>','<label style="display: block;"><%= Common.Utils.String.htmlEncode(valid) %></label>'].join("")),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();t.inputPurpose=new Common.UI.InputField({el:$("#id-dlg-sign-purpose"),style:"width: 100%;"}),t.inputName=new Common.UI.InputField({el:$("#id-dlg-sign-name"),style:"width: 100%;",validateOnChange:!0}).on("changing",_.bind(t.onChangeName,t)),t.cmbFonts=new Common.UI.ComboBoxFonts({el:$("#id-dlg-sign-fonts"),cls:"input-group-nr",style:"width: 234px;",menuCls:"scrollable-menu",menuStyle:"min-width: 234px;max-height: 270px;",store:new Common.Collections.Fonts,recent:0,takeFocusOnClose:!0,hint:t.tipFontName}).on("selected",(function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),i.name,t.font.size,t.font.italic,t.font.bold),t.font.name=i.name})),this.cmbFontSize=new Common.UI.ComboBox({el:$("#id-dlg-sign-font-size"),cls:"input-group-nr",style:"width: 55px;",menuCls:"scrollable-menu",menuStyle:"min-width: 55px;max-height: 270px;",hint:this.tipFontSize,takeFocusOnClose:!0,data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}]}).on("selected",(function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),t.font.name,i.value,t.font.italic,t.font.bold),t.font.size=i.value})),this.cmbFontSize.setValue(this.font.size),this.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),this.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.btnBold=new Common.UI.Button({parentEl:$("#id-dlg-sign-bold"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",enableToggle:!0,hint:t.textBold}),t.btnBold.on("click",(function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),t.font.name,t.font.size,t.font.italic,e.pressed),t.font.bold=e.pressed})),t.btnItalic=new Common.UI.Button({parentEl:$("#id-dlg-sign-italic"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",enableToggle:!0,hint:t.textItalic}),t.btnItalic.on("click",(function(e,i){t.signObject&&t.signObject.setText(t.inputName.getValue(),t.font.name,t.font.size,e.pressed,t.font.bold),t.font.italic=e.pressed})),t.btnSelectImage=new Common.UI.Button({el:"#id-dlg-sign-image"}),t.btnSelectImage.on("click",_.bind(t.onSelectImage,t)),t.btnChangeCertificate=new Common.UI.Button({el:"#id-dlg-sign-change"}),t.btnChangeCertificate.on("click",_.bind(t.onChangeCertificate,t)),t.btnOk=new Common.UI.Button({el:e.find(".primary"),disabled:!0}),t.cntCertificate=$("#id-dlg-sign-certificate"),t.cntVisibleSign=$("#id-dlg-sign-visible"),t.cntInvisibleSign=$("#id-dlg-sign-invisible"),"visible"==t.signType?t.cntInvisibleSign.addClass("hidden"):t.cntVisibleSign.addClass("hidden"),e.find(".dlg-btn").on("click",_.bind(t.onBtnClick,t)),t.afterRender()},getFocusedComponents:function(){return[this.inputPurpose,this.inputName,this.cmbFonts,this.cmbFontSize]},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay((function(){("visible"==t.signType?t.inputName:t.inputPurpose).cmpEl.find("input").focus()}),500)},close:function(){this.api.asc_unregisterCallback("on_signature_defaultcertificate_ret",this.binding.certificateChanged),this.api.asc_unregisterCallback("on_signature_selectsertificate_ret",this.binding.certificateChanged),Common.UI.Window.prototype.close.apply(this,arguments),this.signObject&&this.signObject.destroy()},afterRender:function(){this.api&&(this.binding||(this.binding={}),this.binding.certificateChanged=_.bind(this.onCertificateChanged,this),this.api.asc_registerCallback("on_signature_defaultcertificate_ret",this.binding.certificateChanged),this.api.asc_registerCallback("on_signature_selectsertificate_ret",this.binding.certificateChanged),this.api.asc_GetDefaultCertificate()),"visible"==this.signType&&(this.cmbFonts.fillFonts(this.fontStore),this.cmbFonts.selectRecord(this.fontStore.findWhere({name:this.font.name})||this.fontStore.at(0)),this.signObject=new AscCommon.CSignatureDrawer("signature-preview-img",this.api,this.signSize.width,this.signSize.height))},getSettings:function(){var t={};return t.certificateId=this.certificateId,"invisible"==this.signType?t.purpose=this.inputPurpose.getValue():t.images=this.signObject?this.signObject.getImages():[null,null],t},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.options.handler){if("ok"==t&&(this.btnOk.isDisabled()||this.signObject&&!this.signObject.isValid()))return void(this.btnOk.isDisabled()||(this.inputName.showError([this.textNameError]),this.inputName.focus()));this.options.handler.call(this,this,t)}this.close()},onChangeCertificate:function(){this.api.asc_SelectCertificate()},onCertificateChanged:function(t){this.certificateId=t.id;var e=t.date,i="string"==typeof e?e.split(" - "):["",""];this.cntCertificate.html(this.templateCertificate({name:t.name,valid:this.textValid.replace("%1",i[0]).replace("%2",i[1])})),this.cntCertificate.toggleClass("hidden",_.isEmpty(this.certificateId)||this.certificateId<0),this.btnChangeCertificate.setCaption(_.isEmpty(this.certificateId)||this.certificateId<0?this.textSelect:this.textChange),this.btnOk.setDisabled(_.isEmpty(this.certificateId)||this.certificateId<0)},onSelectImage:function(){this.signObject&&(this.signObject.selectImage(),this.inputName.setValue(""))},onChangeName:function(t,e){this.signObject&&this.signObject.setText(e,this.font.name,this.font.size,this.font.italic,this.font.bold)},onFontSizeChanged:function(t,e,i,n){var o;if(t){if(!e.store.findWhere({displayValue:i.value})&&!(o=/^\+?(\d*(\.|,)?\d+)$|^\+?(\d+(\.|,)?\d*)$/.exec(i.value)))return o=e.getValue(),e.setRawValue(o),n.preventDefault(),!1}else{var s="sse-"==this.appPrefix?409:300;o=(o=Common.Utils.String.parseFloat(i.value))>s?s:o<1?1:Math.floor(2*(o+.4))/2,e.setRawValue(o),this.signObject&&this.signObject.setText(this.inputName.getValue(),this.font.name,o,this.font.italic,this.font.bold),this.font.size=o}},textTitle:"Sign Document",textPurpose:"Purpose for signing this document",textCertificate:"Certificate",textValid:"Valid from %1 to %2",textChange:"Change",textInputName:"Input signer name",textUseImage:"or click 'Select Image' to use a picture as signature",textSelectImage:"Select Image",textSignature:"Signature looks as",tipFontName:"Font Name",tipFontSize:"Font Size",textBold:"Bold",textItalic:"Italic",textSelect:"Select",textNameError:"Signer name must not be empty."},Common.Views.SignDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/view/SignSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/InputField","common/main/lib/component/CheckBox","common/main/lib/component/Window"],(function(){"use strict";Common.Views.SignSettingsDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 350px;",cls:"modal-dlg",type:"edit"},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box" style="height: 260px;">','<div class="input-row">',"<label>"+this.textInfo+"</label>","</div>",'<div class="input-row">',"<label>"+this.textInfoName+"</label>","</div>",'<div id="id-dlg-sign-settings-name" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textInfoTitle+"</label>","</div>",'<div id="id-dlg-sign-settings-title" class="input-row" style="margin-bottom: 5px;"></div>','<div class="input-row">',"<label>"+this.textInfoEmail+"</label>","</div>",'<div id="id-dlg-sign-settings-email" class="input-row" style="margin-bottom: 10px;"></div>','<div class="input-row">',"<label>"+this.textInstructions+"</label>","</div>",'<textarea id="id-dlg-sign-settings-instructions" class="form-control" style="width: 100%;height: 35px;margin-bottom: 10px;resize: none;"></textarea>','<div id="id-dlg-sign-settings-date"></div>',"</div>",'<div class="footer center">','<button class="btn normal dlg-btn primary" result="ok">'+this.okButtonText+"</button>",'<% if (type == "edit") { %>','<button class="btn normal dlg-btn" result="cancel">'+this.cancelButtonText+"</button>","<% } %>","</div>"].join(""),this.api=this.options.api,this.type=this.options.type||"edit",this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this,e=this.getChild();t.inputName=new Common.UI.InputField({el:$("#id-dlg-sign-settings-name"),style:"width: 100%;",disabled:"view"==this.type}),t.inputTitle=new Common.UI.InputField({el:$("#id-dlg-sign-settings-title"),style:"width: 100%;",disabled:"view"==this.type}),t.inputEmail=new Common.UI.InputField({el:$("#id-dlg-sign-settings-email"),style:"width: 100%;",disabled:"view"==this.type}),t.textareaInstructions=this.$window.find("textarea"),t.textareaInstructions.keydown((function(t){t.keyCode==Common.UI.Keys.RETURN&&t.stopPropagation()})),"view"==this.type?this.textareaInstructions.attr("disabled","disabled"):this.textareaInstructions.removeAttr("disabled"),this.textareaInstructions.toggleClass("disabled","view"==this.type),this.chDate=new Common.UI.CheckBox({el:$("#id-dlg-sign-settings-date"),labelText:this.textShowDate,disabled:"view"==this.type}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},getFocusedComponents:function(){return[this.inputName,this.inputTitle,this.inputEmail,this.textareaInstructions,this.chDate]},getDefaultFocusableComponent:function(){return this.inputName},setSettings:function(t){if(t){var e=this,i=t.asc_getSigner1();e.inputName.setValue(i||""),i=t.asc_getSigner2(),e.inputTitle.setValue(i||""),i=t.asc_getEmail(),e.inputEmail.setValue(i||""),i=t.asc_getInstructions(),e.textareaInstructions.val(i||""),e.chDate.setValue(t.asc_getShowDate()),e._currentGuid=t.asc_getGuid()}},getSettings:function(){var t=this,e=new AscCommon.asc_CSignatureLine;return e.asc_setSigner1(t.inputName.getValue()),e.asc_setSigner2(t.inputTitle.getValue()),e.asc_setEmail(t.inputEmail.getValue()),e.asc_setInstructions(t.textareaInstructions.val()),e.asc_setShowDate("checked"==t.chDate.getValue()),void 0!==t._currentGuid&&e.asc_setGuid(t._currentGuid),e},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onPrimary:function(t){return this._handleInput("ok"),!1},_handleInput:function(t){this.options.handler&&this.options.handler.call(this,this,t),this.close()},textInfo:"Signer Info",textInfoName:"Name",textInfoTitle:"Signer Title",textInfoEmail:"E-mail",textInstructions:"Instructions for Signer",txtEmpty:"This field is required",textAllowComment:"Allow signer to add comment in the signature dialog",textShowDate:"Show sign date in signature line",textTitle:"Signature Setup"},Common.Views.SignSettingsDialog||{}))})),void 0===Common)var Common={};Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Protection",["core","common/main/lib/view/Protection","common/main/lib/view/PasswordDialog","common/main/lib/view/SignDialog","common/main/lib/view/SignSettingsDialog"],(function(){"use strict";Common.Controllers.Protection=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Common.Views.Protection"],sdkViewName:"#id_main",initialize:function(){this.addListeners({"Common.Views.Protection":{"protect:password":_.bind(this.onPasswordClick,this),"protect:signature":_.bind(this.onSignatureClick,this)}})},onLaunch:function(){this._state={},Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))},setConfig:function(t,e){this.setApi(e),t&&(this.sdkViewName=t.sdkviewname||this.sdkViewName)},setApi:function(t){t&&(this.api=t,this.appConfig.isPasswordSupport&&this.api.asc_registerCallback("asc_onDocumentPassword",_.bind(this.onDocumentPassword,this)),this.appConfig.isSignatureSupport&&(Common.NotificationCenter.on("protect:sign",_.bind(this.onSignatureRequest,this)),Common.NotificationCenter.on("protect:signature",_.bind(this.onSignatureClick,this)),this.api.asc_registerCallback("asc_onSignatureClick",_.bind(this.onSignatureSign,this)),this.api.asc_registerCallback("asc_onUpdateSignatures",_.bind(this.onApiUpdateSignatures,this))),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)))},setMode:function(t){return this.appConfig=t,this.view=this.createView("Common.Views.Protection",{mode:t}),this},onDocumentPassword:function(t,e){this.view&&this.view.onDocumentPassword(t,e)},SetDisabled:function(t,e){this.view&&this.view.SetDisabled(t,e)},onPasswordClick:function(t,e){switch(e){case"add":this.addPassword();break;case"delete":this.deletePassword()}Common.NotificationCenter.trigger("edit:complete",this.view)},onSignatureRequest:function(t){this.api.asc_RequestSign(t)},onSignatureClick:function(t,e,i){switch(t){case"invisible":this.onSignatureRequest("unvisibleAdd");break;case"visible":this.addVisibleSignature(e,i)}},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){},addPassword:function(){var t=this;new Common.Views.PasswordDialog({api:t.api,handler:function(e,i){"ok"==e&&t.api.asc_setCurrentPassword(i),Common.NotificationCenter.trigger("edit:complete")}}).show()},deletePassword:function(){this.api.asc_resetPassword()},addInvisibleSignature:function(){var t=this;new Common.Views.SignDialog({api:t.api,signType:"invisible",handler:function(e,i){if("ok"==i){var n=e.getSettings();t.api.asc_Sign(n.certificateId)}Common.NotificationCenter.trigger("edit:complete")}}).show()},addVisibleSignature:function(t,e){var i=this,n=new Common.Views.SignSettingsDialog({type:t?"view":"edit",handler:function(e,n){t||"ok"!=n||i.api.asc_AddSignatureLine2(e.getSettings()),Common.NotificationCenter.trigger("edit:complete")}});n.show(),e&&n.setSettings(this.api.asc_getSignatureSetup(e))},signVisibleSignature:function(t,e,i){var n=this;if(_.isUndefined(n.fontStore)){n.fontStore=new Common.Collections.Fonts;var o=n.getApplication().getController("Toolbar").getView("Toolbar").cmbFontName.store.toJSON(),s=[];_.each(o,(function(t,e){t.cloneid||s.push(_.clone(t))})),n.fontStore.add(s)}new Common.Views.SignDialog({api:n.api,signType:"visible",fontStore:n.fontStore,signSize:{width:e||0,height:i||0},handler:function(e,i){if("ok"==i){var o=e.getSettings();n.api.asc_Sign(o.certificateId,t,o.images[0],o.images[1])}Common.NotificationCenter.trigger("edit:complete")}}).show()},onSignatureSign:function(t,e,i,n){n?this.signVisibleSignature(t,e,i):this.addInvisibleSignature()},onApiUpdateSignatures:function(t,e){this.SetDisabled(t&&t.length>0,!0)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)}},Common.Controllers.Protection||{}))})),require.config({baseUrl:"../../",paths:{jquery:"../vendor/jquery/jquery",underscore:"../vendor/underscore/underscore",backbone:"../vendor/backbone/backbone",bootstrap:"../vendor/bootstrap/dist/js/bootstrap",text:"../vendor/requirejs-text/text",perfectscrollbar:"common/main/lib/mods/perfect-scrollbar",jmousewheel:"../vendor/perfect-scrollbar/src/jquery.mousewheel",xregexp:"../vendor/xregexp/xregexp-all-min",sockjs:"../vendor/sockjs/sockjs.min",allfonts:"../../sdkjs/common/AllFonts",sdk:"../../sdkjs/cell/sdk-all-min",api:"api/documents/api",core:"common/main/lib/core/application",notification:"common/main/lib/core/NotificationCenter",keymaster:"common/main/lib/core/keymaster",tip:"common/main/lib/util/Tip",localstorage:"common/main/lib/util/LocalStorage",analytics:"common/Analytics",gateway:"common/Gateway",locale:"common/locale",irregularstack:"common/IrregularStack"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},bootstrap:{deps:["jquery"]},perfectscrollbar:{deps:["jmousewheel"]},notification:{deps:["backbone"]},core:{deps:["backbone","notification","irregularstack"]},sdk:{deps:["jquery","underscore","allfonts","xregexp","sockjs"]},gateway:{deps:["jquery"]},analytics:{deps:["jquery"]}}}),require(["backbone","bootstrap","core","sdk","api","analytics","gateway","locale"],(function(t,e,i){if(!t.History||!t.History.started){t.history.start();var n=new t.Application({nameSpace:"SSE",autoCreate:!1,controllers:["Viewport","DocumentHolder","CellEditor","FormulaDialog","Print","Toolbar","Statusbar","RightMenu","LeftMenu","Spellcheck","Main","PivotTable","DataTab","ViewTab","Search","WBProtection","Common.Controllers.Fonts","Common.Controllers.History","Common.Controllers.Chat","Common.Controllers.Comments","Common.Controllers.Plugins","Common.Controllers.ExternalOleEditor","Common.Controllers.ReviewChanges","Common.Controllers.Protection"]});Common.Locale.apply((function(){require(["common/main/lib/util/LocalStorage","common/main/lib/controller/Themes","common/main/lib/controller/Desktop","spreadsheeteditor/main/app/controller/Viewport","spreadsheeteditor/main/app/controller/DocumentHolder","spreadsheeteditor/main/app/controller/CellEditor","spreadsheeteditor/main/app/controller/Toolbar","spreadsheeteditor/main/app/controller/Statusbar","spreadsheeteditor/main/app/controller/RightMenu","spreadsheeteditor/main/app/controller/LeftMenu","spreadsheeteditor/main/app/controller/Spellcheck","spreadsheeteditor/main/app/controller/Main","spreadsheeteditor/main/app/controller/Print","spreadsheeteditor/main/app/controller/PivotTable","spreadsheeteditor/main/app/controller/DataTab","spreadsheeteditor/main/app/controller/ViewTab","spreadsheeteditor/main/app/controller/Search","spreadsheeteditor/main/app/controller/WBProtection","spreadsheeteditor/main/app/view/FileMenuPanels","spreadsheeteditor/main/app/view/ParagraphSettings","spreadsheeteditor/main/app/view/ImageSettings","spreadsheeteditor/main/app/view/ChartSettings","spreadsheeteditor/main/app/view/ShapeSettings","spreadsheeteditor/main/app/view/TextArtSettings","spreadsheeteditor/main/app/view/PivotSettings","spreadsheeteditor/main/app/view/FieldSettingsDialog","spreadsheeteditor/main/app/view/ValueFieldSettingsDialog","spreadsheeteditor/main/app/view/SignatureSettings","common/main/lib/util/utils","common/main/lib/controller/Fonts","common/main/lib/controller/History","common/main/lib/controller/Comments","common/main/lib/controller/Chat","common/main/lib/controller/Plugins","common/main/lib/controller/ExternalOleEditor","common/main/lib/controller/ReviewChanges","common/main/lib/controller/Protection"],(function(){n.start()}))}))}}),(function(t){"timeout"==t.requireType&&!reqerr&&window.requireTimeourError&&(reqerr=window.requireTimeourError(),window.alert(reqerr),window.location.reload())})),define("../apps/spreadsheeteditor/main/app.js",(function(){}));